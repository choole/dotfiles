"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[9447],{57641:(e,n,t)=>{t.r(n),t.d(n,{addTypesToFormulaASTAsync:()=>G,analyzeFormula:()=>U,convertCollectionFormulaToFormula2:()=>T,convertFormulaCSTToAST:()=>r.K,createFormulaDataRequestHandler:()=>F.yf,createFormulaDataRequestSyncHandler:()=>F.lc,evaluateFormulaASTAsync:()=>s.kg,executeFormulaAsync:()=>S,executeFormulaSync:()=>q,formulaResultAndOldFormulaValueEqual:()=>F.hV,getFormula2Dependencies:()=>D,getFormulaEditorInfoAtPosition:()=>V,getMessageForFormulaEvaluatorError:()=>x.OY,getMessageForFormulaTypecheckError:()=>x.ic,getNodeOfInterestForFormulaTypecheckError:()=>x.sB,isUniqueFormulaEvaluatorError:()=>F.hp,parseFormulaInput:()=>C.K,processFormulaInput:()=>i.dJ});var o=t(68626),r=t(42253),s=t(33063),i=t(51849),a=(t(57658),t(29477)),p=t(606),u=t(21202),l=t(97880),c=t(23790),d=t(84116),y=(t(21703),t(76725)),f=t(70203),v=t(91905),m=t(32620);const h={slice:"substring",start:"dateStart",end:"dateEnd"},g={unaryMinus:"-",unaryPlus:"+"},b=["add","subtract","multiply","divide","pow","mod","and","or","equal","unequal","larger","largerEq","smaller","smallerEq"];function k(e,n,t){return o=e,r=T(e,n,t),"conditional"===o.type||"function"===o.type&&(b.includes(o.name)||["unaryPlus","unaryMinus"].includes(o.name))||"operator"===o.type&&void 0!==o.args&&o.args.length>=2?[["("],...r,[")"]]:r;var o,r}function T(e,n,t){switch(e.type){case"conditional":return[...k(e.condition,n,t),[" ? "],...k(e.true,n,t),[" : "],...k(e.false,n,t)];case"constant":switch(e.value_type){case"number":return(0,f.TP)(`${e.value}`);case"string":return(0,f.TP)(`"${e.value.replace(/"/g,'\\"')}"`);case"boolean":return(0,f.TP)(""+(e.value?"true":"false"));default:throw new Error(`unexpected constant type: ${e.value_type}`)}case"function":if(b.includes(e.name)){const o="equal"===e.name?"==":"concat"===e.name?"+":v.Gn[e.name].operator;return[...k(e.args[0],n,t),[` ${o} `],...k(e.args[1],n,t)]}switch(e.name){case"unaryMinus":return[["-"],...k(e.args[0],n,t)];case"unaryPlus":return[["toNumber("],...T(e.args[0],n,t),[")"]];case"month":return[["month("],...T(e.args[0],n,t),[") - 1"]];case"day":return[["day("],...T(e.args[0],n,t),[") % 7"]];case"concat":return[["("],...(0,y.Z)((e.args??[]).map((e=>T(e,n,t))),(()=>[[" + "]])).flat(),[")"]];case"join":return[["join("],["["],...(0,y.Z)((e.args??[]).slice(1).map((e=>T(e,n,t))),(()=>[[", "]])).flat(),["]"],[", "],...T(e.args[0],n,t),[")"]];default:if("id"===e.name)return(0,f.TP)("id()");const o=h[e.name]??e.name;if(void 0===m.Vr[o])throw new Error(`unexpected formula: ${o}`);return[[`${o}(`],...(0,y.Z)((e.args??[]).map((e=>T(e,n,t))),(()=>[[", "]])).flat(),[")"]]}case"operator":var o,r;if(1===(null===(o=e.args)||void 0===o?void 0:o.length))switch(e.operator){case"not":return[["!"],...k(e.args[0],n,t)];case"+":return[["toNumber("],...T(e.args[0],n,t),[")"]];default:return[[`${e.operator}`],...k(e.args[0],n,t)]}if(2===(null===(r=e.args)||void 0===r?void 0:r.length))return[...k(e.args[0],n,t),[` ${e.operator} `],...k(e.args[1],n,t)];switch(e.operator){case"?":return[...k(e.args[0],n,t),[" ? "],...k(e.args[0],n,t),[" : "],...k(e.args[0],n,t)];default:throw new Error(`unhandled operator: ${e.operator}`)}case"symbol":switch(e.name){case"pi":return(0,f.TP)("pi()");case"e":return(0,f.TP)("e()");case"true":return(0,f.TP)("true");case"false":return(0,f.TP)("false");default:throw new Error(`unexpected constant: ${e.name}`)}case"property":{const o=t[e.id];if(void 0===o)return[[e.name]];const r=(0,f.YC)((0,f.kb)({collection:n,property:e.id,name:o.name}));switch(o.type){case"person":case"relation":return[["join(map("],r,[', format(currentValue)), ", ")']];case"rollup":return o.aggregation&&"show_unique"!==o.aggregation?[r]:[["join(map("],r,[', format(currentValue)), ",")']];case"file":case"multi_select":return[["join("],r,[', ", ")']];default:return[r]}}case"error":throw new Error("unexpected formula error node")}}var x=t(5998),w=t(47218),F=t(78106);function*P(e,n){switch(e.kind){case w.bG.Number:return{node:{...e,type:{type:"number"},valueTypes:n},errors:[]};case w.bG.String:return{node:{...e,type:{type:"text"},valueTypes:n},errors:[]};case w.bG.Boolean:return{node:{...e,type:{type:"checkbox"},valueTypes:n},errors:[]};case w.bG.NotionToken:{const r=e.token;switch(r.type){case d.Oy.Checkbox:return{node:{...e,type:{type:"checkbox"},valueTypes:n},errors:[]};case d.Oy.BlockProperty:{var t;const o=null===(t=n.find((e=>e.kind===d.yp.ThisRow)))||void 0===t?void 0:t.type;if(void 0===o)return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:w.h4.ThisRowTypeNotFound,node:e}]};if("block"!==o.type||void 0===o.collection)return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:w.h4.ThisRowNotBlockWithCollection,node:e}]};if(void 0===r.collection)return{node:{...e,type:d.dy[r.property],valueTypes:n},errors:[]};const s=(yield{recordPointers:[o.collection]}).getRecordModel(o.collection),i=null==s?void 0:s.getNormalizedSchema(),a=(0,F.SR)(r.property),p=null==i?void 0:i[a];if(void 0===p||void 0===i)return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:w.h4.MissingPropertyOnThisRow,node:e,token:r}]};const[u,l]=yield*(0,F.IP)(a,i,p);return{node:{...e,type:u,valueTypes:n},errors:!0===l?[{type:w.h4.MemberPropertyButtonType,node:e,token:r}]:[]}}case d.Oy.ContextValue:{var o;const t=null===(o=n.find((e=>e.kind===d.yp.ContextValue&&e.id===(0,F.Kv)(r.valueId))))||void 0===o?void 0:o.type;return void 0===t?{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:w.h4.MissingContextVariable,node:e,token:r}]}:{node:{...e,type:t,valueTypes:n},errors:[]}}case d.Oy.Block:{const t={table:u.iU,id:r.blockId,spaceId:r.spaceId},o=(yield{recordPointers:[t]}).getRecordModel(t);if(void 0===o)return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[{type:w.h4.MissingBlock,node:e,token:r}]};const s=o.getCollectionPointer();return{node:{...e,type:{type:"block",collection:s},valueTypes:n},errors:[]}}case d.Oy.Person:return{node:{...e,type:{type:"person"},valueTypes:n},errors:[]};case d.Oy.Date:return{node:{...e,type:{type:"date"},valueTypes:n},errors:[]};default:(0,l.t1)(r)}break}case w.bG.Array:{const t=yield*(0,F.LD)(e.elements.map((e=>P(e,n))));let o={type:"unknown"};if(t.length>0){o=t[0].node.type;for(let e=1;e<t.length;e++)if(!(0,c.Jy)(o,t[e].node.type)){o={type:"unknown"};break}}return{node:{...e,elements:t.map((e=>e.node)),type:{type:"array",of:o},valueTypes:n},errors:t.flatMap((e=>e.errors))}}case w.bG.Identifier:{var r;const t=null===(r=n.find((n=>n.kind===d.yp.Binding&&n.id===e.text)))||void 0===r?void 0:r.type;if(void 0!==t)return{node:{...e,type:t,valueTypes:n},errors:[]};const o=m.Vr[e.text];if(void 0===o){const t=[{type:w.h4.UndefinedIdentifier,node:e}];return e.text in h?t.push({type:w.h4.RenamedIdentifier,node:e,identifier:e.text,renamedTo:h[e.text]}):e.text in g&&t.push({type:w.h4.RemovedFunction,node:e,functionName:e.text,alternative:g[e.text]}),{node:{...e,type:{type:"unknown"},valueTypes:n},errors:t}}return{node:{...e,type:{type:"function",libraryFunction:o,calledFromUnifiedFunctionProperty:!1},valueTypes:n},errors:[]}}case w.bG.Conditional:{const t=yield*P(e.condition,n),o=yield*P(e.expIfTrue,n),r=void 0!==e.expIfFalse?yield*P(e.expIfFalse,n):void 0;let s={type:"unknown"};return void 0===o.node.type||void 0!==(null==r?void 0:r.node.type)&&!(0,c.Jy)(o.node.type,r.node.type)||(s=o.node.type),{node:{...e,condition:t.node,expIfTrue:o.node,expIfFalse:null==r?void 0:r.node,type:s,valueTypes:n},errors:[...t.errors,...o.errors??[],...(null==r?void 0:r.errors)??[]]}}case w.bG.LogicalOr:case w.bG.LogicalAnd:const s=yield*(0,F.LD)(e.elements.map((e=>P(e,n)))),i=s.flatMap((e=>e.errors));return{node:{...e,elements:s.map((e=>e.node)),type:{type:"checkbox"},valueTypes:n},errors:i};case w.bG.Equality:case w.bG.Relational:{const t=yield*P(e.lhs,n),o=yield*P(e.rhs,n),r=[...t.errors,...o.errors];if(e.kind===w.bG.Relational){const n=t.node.type,s=o.node.type;"unknown"===n.type||"unknown"===s.type||n.type===s.type&&["number","date","text","boolean"].includes(n.type)||r.push({type:w.h4.CannotRelativelyCompareTypes,node:e,lhsType:n,rhsType:s})}return{node:{...e,lhs:t.node,rhs:o.node,type:{type:"checkbox"},valueTypes:n},errors:r}}case w.bG.Additive:case w.bG.Multiplicative:case w.bG.Exponentiation:{const t=yield*P(e.lhs,n),o=yield*P(e.rhs,n),r=[...t.errors,...o.errors];if("+"===e.op)return"number"===t.node.type.type&&"number"===o.node.type.type?{node:{...e,lhs:t.node,rhs:o.node,type:{type:"number"},valueTypes:n},errors:r}:{node:{...e,lhs:t.node,rhs:o.node,type:["unknown","number"].includes(t.node.type.type)&&["unknown","number"].includes(o.node.type.type??"unknown")?{type:"unknown"}:{type:"text"},valueTypes:n},errors:r};const s=function(e,n,t){const o=n.type,r=(null==t?void 0:t.type)??{type:"unknown"};if(!["unknown","number"].includes(o.type)||!["unknown","number"].includes(r.type))return{type:w.h4.CannotDoMathOnType,node:e,lhsType:o,rhsType:r}}(e,t.node,o.node);return void 0!==s&&r.push(s),{node:{...e,lhs:t.node,rhs:o.node,type:{type:"number"},valueTypes:n},errors:r}}case w.bG.Unary:{const t=yield*P(e.expression,n),o=[...t.errors];let r;switch(e.op){case"-":["number","unknown"].includes(t.node.type.type)||o.push({type:w.h4.UnaryMinusOnNonNumber,node:e,expression:t.node}),r={type:"number"};break;case"!":case"not":r={type:"checkbox"};break;default:(0,l.t1)(e)}return{node:{...e,expression:t.node,type:r,valueTypes:n},errors:o}}case w.bG.Call:{const{node:t,errors:o}=yield*P(e.expression,n),r=[...o];if(t.kind===w.bG.Identifier&&("lets"===t.text||"let"===t.text)){const t=[];let o=[...n];for(let n=0;n<e.arguments.length-1;n+=2){const s=e.arguments[n],i=e.arguments[n+1];if(s.kind!==w.bG.Identifier){r.push({type:w.h4.IdentifierExpected,node:s});continue}const{node:a,errors:p}=yield*P(i,o);t[n+1]=a,r.push(...p);const u=s.text;o=[{kind:d.yp.Binding,id:u,name:u,type:a.type},...o],t[n]={...s,type:a.type,valueTypes:o}}const s=e.arguments[e.arguments.length-1],{node:i,errors:a}=yield*P(s,o);return t[e.arguments.length-1]=i,r.push(...a),{node:{...e,expression:i,arguments:t,type:i.type,valueTypes:o},errors:r}}["function","unknown"].includes(t.type.type)||r.push({type:w.h4.CallingNotFunction,node:e,callee:t});const s="function"===t.type.type?t.type.libraryFunction:void 0,i="function"===t.type.type?t.type.boundTargetType:void 0;if(void 0!==s){const n=(0,F.P2)(s),o=e.arguments.length+(void 0!==i?1:0);o<n&&("function"===t.type.type&&t.type.calledFromUnifiedFunctionProperty?r.push({type:w.h4.FunctionCallTooFewArguments,node:e,libraryFunction:s,numArguments:o-1,minNumParameters:n-1}):r.push({type:w.h4.FunctionCallTooFewArguments,node:e,libraryFunction:s,numArguments:o,minNumParameters:n}))}const a=[],p=[];void 0!==i&&p.push(i);for(let u=0;u<e.arguments.length;u++){const t=e.arguments[u],o=void 0!==i?u+1:u,l=void 0!==s?(0,F.J3)(s,o):void 0;if(void 0!==s&&void 0===l&&r.push({type:w.h4.FunctionCallUnexpectedArgument,node:e,libraryFunction:s,argument:t,parameterIndex:o}),void 0!==(null==l?void 0:l.augmentScope)){const e=a.map((e=>(null==e?void 0:e.type)??{type:"unknown"})),o=l.augmentScope(void 0!==i?[i,...e]:e),{node:s,errors:c}=yield*P(t,[...Object.entries(o).map((e=>{let[n,t]=e;return{kind:d.yp.Binding,id:n,type:t}})),...n]);a[u]=s,p.push(s.type),r.push(...c)}else{const{node:o,errors:i}=yield*P(t,n);if(a[u]=o,void 0!==s&&void 0!==l){const n=(0,c.xK)(o.type,l.type);"boolean"==typeof n?(p.push(o.type),n||r.push({type:w.h4.FunctionCallArgumentWrongType,node:e,libraryFunction:s,argument:o,expectedParameter:l})):p.push(n)}else p.push(o.type);r.push(...i)}}return{node:{...e,expression:t,arguments:a,type:void 0!==s?"function"==typeof s.returnType?s.returnType(p):s.returnType:{type:"unknown"},valueTypes:n},errors:r}}case w.bG.UnifiedFunctionProperty:{const t=m.Vr[e.name],{node:o,errors:r}=yield*P(e.expression,n),s=[...r];let i={type:"unknown"};if(void 0===t)s.push({type:w.h4.UnifiedFunctionCannotFindFunction,node:e,name:e.name});else{const n=(0,F.J3)(t,0);if(void 0===n)s.push({type:w.h4.UnifiedFunctionNoArguments,node:e,libraryFunction:t});else{const r=(0,c.xK)(o.type,n.type);"boolean"==typeof r?(i=o.type,r||s.push({type:w.h4.UnifiedFunctionTargetWrongType,node:e,expression:o,libraryFunction:t})):i=r}}return{node:{...e,expression:o,type:void 0!==t?{type:"function",boundTargetType:i,libraryFunction:t,calledFromUnifiedFunctionProperty:!0}:{type:"unknown"},valueTypes:n},errors:s}}case w.bG.MemberBlockProperty:{const{node:t,errors:o}=yield*P(e.expression,n),r=[...o];let s;if("block"===t.type.type)if(void 0===e.propertyToken.collection)s=d.dy[e.propertyToken.property];else{const n=(yield{recordPointers:[e.propertyToken.collection]}).getRecordModel(e.propertyToken.collection),o=null==n?void 0:n.getNormalizedSchema(),i=(0,F.SR)(e.propertyToken.property),a=null==o?void 0:o[i];if(void 0===a||void 0===o)r.push({type:w.h4.MemberPropertyMissing,node:e,token:e.propertyToken});else if(void 0!==t.type.collection)if((0,p.qo)(e.propertyToken.collection,t.type.collection)){const n=yield*(0,F.IP)(i,o,a);s=n[0],!0===n[1]&&r.push({type:w.h4.MemberPropertyButtonType,node:e,token:e.propertyToken})}else r.push({type:w.h4.MemberPropertyMismatchCollection,node:e,token:e.propertyToken})}else"unknown"!==t.type.type&&r.push({type:w.h4.MemberPropertyTargetNotBlock,node:e,expression:t});return{node:{...e,expression:t,type:s??{type:"unknown"},valueTypes:n},errors:r}}case w.bG.RecoveryNode:return{node:{...e,type:{type:"unknown"},valueTypes:n},errors:[]};default:(0,l.t1)(e)}}async function G(e,n,t){const o=P(e,n.valueTypes);let r=o.next();for(;!r.done;){const e=n.handleDataRequest(r.value);r=o.next((0,a.tI)(e)?await e:e)}if(!t)return r.value;const s=r.value.errors.map((e=>{const n=(0,x.sB)(e);return{...e,node:(0,i.tE)(n,t)}}));if(n.sourceProperty){(0,F.JT)(e).includes(n.sourceProperty)&&s.push({type:w.h4.CircularDependency,node:(0,i.tE)(e,t)})}return{node:r.value.node,errors:s}}var C=t(83158),I=t(77090),E=t(58573),M=t(73152);function N(e,n){if(n<e.startOffset||n>e.endOffset+1)return[];const t=e.kind;switch(t){case w.bG.Number:case w.bG.String:case w.bG.Boolean:case w.bG.NotionToken:case w.bG.Identifier:case w.bG.RecoveryNode:return[e];case w.bG.Conditional:{const t=N(e.condition,n);if(t.length>0)return[e,...t];const o=N(e.expIfTrue,n);if(o.length>0)return[e,...o];if(void 0!==e.expIfFalse){const t=N(e.expIfFalse,n);if(t.length>0)return[e,...t]}return[e]}case w.bG.Equality:case w.bG.Relational:case w.bG.Additive:case w.bG.Multiplicative:case w.bG.Exponentiation:{const t=N(e.lhs,n);if(t.length>0)return[e,...t];const o=N(e.rhs,n);return o.length>0?[e,...o]:[e]}case w.bG.LogicalOr:case w.bG.LogicalAnd:case w.bG.Array:for(const t of e.elements){const o=N(t,n);if(o.length>0)return[e,...o]}return[e];case w.bG.Unary:{const t=N(e.expression,n);return t.length>0?[e,...t]:[e]}case w.bG.Call:{const t=N(e.expression,n);if(t.length>0)return[e,...t];for(const o of e.arguments){const t=N(o,n);if(t.length>0)return[e,...t]}return[e]}case w.bG.UnifiedFunctionProperty:case w.bG.MemberBlockProperty:const o=N(e.expression,n);return o.length>0?[e,...o]:[e];default:(0,l.t1)(t)}}async function O(e,n,t){const o=[];if(void 0!==e){const r=n.handleDataRequest({recordPointers:[e]}),s=((0,a.tI)(r)?await r:r).getRecordModel(e),i=null==s?void 0:s.getNormalizedSchema();if(i)for(const[a,p]of Object.entries(i))a!==n.sourceProperty&&null!=p&&p.name&&R(t,p.name)&&o.push({kind:d.WY.Token,name:p.name,token:{type:d.Oy.BlockProperty,property:(0,F.Uw)(a),collection:e}})}for(const r of Object.values(d.vz)){if(r===d.vz.Title)continue;const e=(0,F.Ve)(r);(""===t||R(t,e))&&o.push({kind:d.WY.Token,token:{type:d.Oy.BlockProperty,property:r,collection:void 0},name:e})}return o}function R(e,n){return""===e||(0,E.C6)(e,n)}async function A(e){const{prefix:n,context:t,receiverType:o,hideDeprecatedCompletions:r,dotMemberExpression:s}=e,i=[],a=new Set;if(void 0===o){var p;t.valueTypes.forEach((e=>{if(e.kind===d.yp.Binding){const t=e.id;!a.has(t)&&R(n,e.id)&&(i.push({kind:d.WY.Binding,text:t,type:e.type}),a.add(t))}}));const e=null===(p=t.valueTypes.find((e=>e.kind===d.yp.ThisRow)))||void 0===p?void 0:p.type;"block"===(null==e?void 0:e.type)&&void 0!==e.collection&&i.push(...await O(e.collection,t,n)),t.valueTypes.forEach((e=>{if(e.kind===d.yp.ContextValue&&R(n,e.name)){const n=(0,F.ij)(e.id);i.push({kind:d.WY.Token,token:{type:d.Oy.ContextValue,valueId:n}})}}))}else"block"===o.type&&i.push(...await O(o.collection,t,n));for(const y in m.Vr)if(!a.has(y)&&R(n,y)&&(!r||!y.startsWith("_")&&"joinText"!==y)&&("toNumber"!==y||null==o||!o.type||!m.N7.includes(o.type))&&(!s||!m.rq.includes(y))){const e=m.Vr[y];if(void 0!==o){var u,l;const n=(null===(u=e.parameters)||void 0===u||null===(u=u.expected)||void 0===u||null===(u=u[0])||void 0===u?void 0:u.type)??(null===(l=e.parameters)||void 0===l||null===(l=l.varargs)||void 0===l||null===(l=l[0])||void 0===l?void 0:l.type);if(void 0===n||!(0,c.qT)(o,n))continue}i.push({kind:d.WY.LibraryFunction,libraryFunction:e}),a.add(y)}return i}function B(e,n){const t=[...e].reverse().find((e=>e.kind===w.bG.Call));if((null==t?void 0:t.kind)===w.bG.Call){let e=-1;if(n>t.lParenOffset&&(void 0===t.rParenOffset||n<=t.rParenOffset))for(e=0;e<t.commaOffsets.length&&!(t.commaOffsets[e]>n);e++);return{expression:t.expression,parameterIndex:e}}}async function V(e){const{formula:n,inputPosition:t,context:s,hideDeprecatedCompletions:a}=e,[p,u]=(0,i.dJ)(n),l=(0,i.Eh)(u,t);let c=p.substring(0,l);if(""===c.trim())return{value:{inputPosition:t,mappedPosition:l,completions:await A({prefix:"",context:s,hideDeprecatedCompletions:a,dotMemberExpression:!1})}};const y=c[c.length-1],f=/[\s.]/.test(y);f&&(c=`${c}_`);const v=(0,M.XR)(),h=(0,M.s)(v).tokenize(c).tokens,g=(0,M.Z8)(v);g.input=h;const b=g.expression(),k=(0,r.K)(b);if(o.x.isFail(k))return{value:void 0};const T=await G(k.value,s,u),{node:x}=T,F=h[h.length-1];let P=!1,C=h;void 0!==F&&(0,I.ol)(F,v.IdentifierName)&&(C=[...C],C.pop(),P=!0);const E=g.computeContentAssist("expression",C),O=P?F.image.substring(0,F.image.length-(f?1:0)):void 0,V=N(x,l),q={inputPosition:t,mappedPosition:l,nodePath:V,callParameter:B(V,l)},S=[],U=B(V,l);if(U&&(U.expression.kind===w.bG.UnifiedFunctionProperty&&0===U.parameterIndex||U.expression.kind===w.bG.Identifier&&1===U.parameterIndex)){const e=U.expression.kind===w.bG.UnifiedFunctionProperty?U.expression.name:U.expression.text,n=m.Vr[e];if((null==n?void 0:n.parameters)===m.yx&&R(O??"",m.GV)&&O!==m.GV&&O!==`${m.GV}.`){var D,K;const e=U.expression,n="function"===e.type.type&&"array"===(null===(D=e.type.boundTargetType)||void 0===D?void 0:D.type)&&(null===(K=e.type.boundTargetType)||void 0===K?void 0:K.of)||{type:"unknown"};S.push({kind:d.WY.Binding,text:m.GV,type:n})}}const J={handleDataRequest:s.handleDataRequest,valueTypes:x.valueTypes,sourceProperty:s.sourceProperty};for(const o of E)if(o.nextTokenType===v.IdentifierName){const e="dotMemberExpression"===o.ruleStack[o.ruleStack.length-1];if(e){const n=C[C.length-1];if(!(0,I.ol)(n,v.Dot))return{value:void 0};const t=V[V.length-1];if(void 0!==t&&(t.kind===w.bG.UnifiedFunctionProperty||t.kind===w.bG.MemberBlockProperty)){const n=t.expression;q.completionsInfo={type:"member dot receiver",prefix:O,receiverNode:n};const o=await A({prefix:O??"",context:J,receiverType:n.type,hideDeprecatedCompletions:a,dotMemberExpression:e});S.push(...o)}}else{q.completionsInfo={type:"free identifier",prefix:O};const n=await A({prefix:O??"",context:J,hideDeprecatedCompletions:a,dotMemberExpression:e});S.push(...n)}}return q.completions=S,{value:q}}function q(e,n){const[t,a]=(0,i.dJ)(e),[p,u]=(0,C.K)(t);if(u.length>0)return{error:u[0]};const l=(0,r.K)(p);return o.x.isFail(l)?l:(0,s.u6)(l.value,n)}async function S(e,n){const[t,a]=(0,i.dJ)(e),[p,u]=(0,C.K)(t);if(u.length>0)return{error:u[0]};const l=(0,r.K)(p);return o.x.isFail(l)?l:(0,s.kg)(l.value,n)}async function U(e,n){const[t]=(0,i.dJ)(e),[s,a]=(0,C.K)(t);if(a.length>0)return{value:{parseErrors:a}};const p=(0,r.K)(s);if(o.x.isFail(p))return{value:{parseErrors:[p.error]}};const u=await G(p.value,n),{node:l,errors:c}=u;return{value:{type:l.type,typeErrors:c}}}function D(e){const[n,t]=(0,i.dJ)(e),[s,a]=(0,C.K)(n);if(a.length>0)return[];const p=(0,r.K)(s);return o.x.isFail(p)?[]:(0,F.JT)(p.value)}}}]);