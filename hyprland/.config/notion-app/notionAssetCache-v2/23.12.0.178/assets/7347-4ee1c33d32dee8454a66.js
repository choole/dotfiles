"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[7347],{23321:(e,t,o)=>{o.d(t,{OF:()=>A,L6:()=>F,ZP:()=>O});var r=o(23174),i=o.n(r),n=o(10434),s=o.n(n),a=(o(57658),o(96486)),l=o.n(a),p=o(67294),d=o(83355),c=o(8848),u=o(15095),h=o(54153),g=o(5366),m=o(50906),y=o(34809),f=o(5385),S=o(33929),v=o(4391),b=o(29798),P=o(73657),M=o(68785),w=o(32163),C=o(77137),Z=o(43145),I=o(72495),k=o(38797),T=o(57670);const R=k.tg,x=k.Nm,A=k.II,F=k.pq,E=(0,g.defineMessages)({noResults:{defaultMessage:"No results",id:"emojiPicker.noResults.message"}});class B extends d.Z{constructor(){super(...arguments),this.filter="",this.splitFilter=[],this.storeTypes={store:v.Z,menuListStore:b.Z},this.insertIcon=e=>{const t=this.getNormalizedIconPath(e);this.props.onSubmit(t);const o=t.split(/[/_.]/),r=o[2],i=o[3];this.addToRecentIcons(r),this.props.iconLoggingData&&m.fAb(this.environment,"pick_colored_icon",{icon:r,color:i,...this.props.iconLoggingData})},this.createListItem=(e,t)=>{const o=f.x(),r=this.props.enforceIconColor??o,i=`/icons/${`${e}${r?`_${r}`:""}`}.svg`;return{key:i,action:e=>this.handleIconButtonClick(i),render:o=>p.createElement(T.Z,s()({},o,{icon:e,color:r??"gray",variations:t,insertIcon:this.insertIcon,shouldOpenVariations:!Boolean(r)}))}},this.performGetAllIconsRequest=async e=>{const{store:t}=this.stores;if(!l().isEmpty(t.getState().allIcons))return t.getState().allIcons;const o=await(0,y.ZP)({environment:this.environment,url:e,method:"GET",format:"json",mode:"cors"});if("success"===o.type)return t.setState({...t.state,allIcons:o.data}),o.data;throw o.error},this.createCategory=(e,t)=>{if(!t)return;let o=[];return o="recent"===e.id?this.stores.store.state.recentIcons||[]:Object.keys(t),0!==o.length?{key:e.id,items:o.map((e=>{if(void 0!==t[e])return this.createListItem(e,t[e])})).filter(Boolean),render:t=>i()(I.Z,{isTitleUppercase:!0,title:e.title},t.key,i()("div",{style:this.getIconSectionWrapStyle()},void 0,t.children))}:void 0},this.handleScroll=e=>{if(Math.abs(e)<B.loadMoreCategoryEdgeDistance){const{loadIconCount:e,allIcons:t}=this.stores.store.state,o=this.getNumIconsPerRow()*this.getNumRowsPerPage(),r=Math.max(o,this.getAllSectionsIconCount(t));this.stores.store.setState({...this.stores.store.state,loadIconCount:Math.min(r,e+o)})}},this.handleIconButtonClick=e=>{this.insertIcon(e)},this.getNormalizedIconPath=e=>e.replace("_dark","")}willMount(e){super.willMount(e);const t=h.Z.get(B.localRecentIconsKey);this.stores.store.setState({...this.stores.store.state,recentIcons:t||[]})}renderComponent(){return i()(C.Z,{request:"/icons/all",performRequest:this.performGetAllIconsRequest,render:(e,t,o)=>o?this.renderIconPicker(t):i()("div",{style:this.getLoadingContainerStyle()},void 0,i()(M.Z,{}))})}getNumIconsPerRow(){var e,t;const{device:o,WindowSizeStore:r}=this.environment;return o.isPhone?(window.innerWidth-r.getSafePaddingLeftPx(B.phonePaddingLeft)-r.getSafePaddingRightPx(B.phonePaddingRight))/T.Z.mobileButtonSize:o.isTablet?R:null!==(e=this.props)&&void 0!==e&&null!==(e=e.menuRef)&&void 0!==e&&null!==(e=e.current)&&void 0!==e&&e.offsetWidth?((null===(t=this.props)||void 0===t||null===(t=t.menuRef)||void 0===t||null===(t=t.current)||void 0===t?void 0:t.offsetWidth)-2*B.desktopPopupPaddingHorizontal)/T.Z.desktopButtonSize:o.isTablet?R:8}getNumRowsPerPage(){return this.environment.device.isMobile?F:A}renderIconPicker(e){const{menuListStore:t}=this.stores,o=this.getVisibleSections(this.getAllSections(e)),r=this.environment.device.isDesktop&&o.length>0?0:void 0;return 0===o.length&&(this.props.onNoResults&&this.props.onNoResults(),o.push({key:"no results",items:[{key:"no results",action:e=>{},render:(e,t)=>p.createElement(P.Z,s()({},e,{caption:S.default.formatMessage(E.noResults)}))}],render:e=>p.createElement(I.Z,e)})),i()("div",{style:B.wrapStyle},void 0,i()("div",{style:{flexGrow:1}},void 0,p.createElement(w.Z,s()({},this.getMenuListProps(),{store:t,initialFocus:r,sections:o,disableKeyboardArrowWrap:!0,unfocusOnScroll:this.environment.device.isMobile}))),i()(Z.Z,{onChange:this.handleScroll}))}getCategories(){return l().compact([!this.props.filter&&{id:"recent",title:i()(g.FormattedMessage,{id:"iconPicker.section.recent",defaultMessage:"Recent"})},!this.props.filter&&{id:"icons",title:i()(g.FormattedMessage,{id:"iconPicker.section.icons",defaultMessage:"Icons"})}])}createFilteredSection(e){if(!e)return[];const t=this.filterAndSortIcons(e);return 0===t.length?[]:[{key:"search-results",items:t.map((t=>this.createListItem(t,e[t]))),render:e=>i()(I.Z,{},e.key,i()("div",{style:this.getIconSectionWrapStyle()},void 0,e.children))}]}getMenuListProps(){return{type:w.i.Grid,itemsPerRow:this.getNumIconsPerRow(),renderRow:(e,t)=>i()("div",{style:B.rowStyle},t,e)}}addToRecentIcons(e){const t=h.Z.get(B.localRecentIconsKey),o=l().union([e],t),r=l().take(o,this.getNumIconsPerRow()*x);h.Z.set(B.localRecentIconsKey,r),this.stores.store.setState({...this.stores.store.state,recentIcons:r})}getAllSections(e){this.filter=u.rJ(this.props.filter)??"",this.splitFilter=this.filter?this.filter.split(" ").filter(Boolean):[];const t=l().compact(this.getCategories().map((t=>this.createCategory(t,e))));return this.props.filter&&this.filter?this.createFilteredSection(e):t}getAllSectionsIconCount(e){const t=this.getAllSections(e);let o=0;for(const r of t)o+=r.items.length;return o}getVisibleSections(e){let{loadIconCount:t}=this.stores.store.state;0===t&&(t+=this.getNumIconsPerRow()*this.getNumRowsPerPage());const o=[];let r=0;for(const i of e){if(!(r+i.items.length<=t)){o.push({...i,items:i.items.slice(0,t-r)});break}o.push(i),r+=i.items.length}return o}filterAndSortIcons(e){const{filter:t}=this,o=l().compact(Object.keys(e).map((o=>{const r=e[o],i=((null==r?void 0:r.tooltip)??o).replace("-"," "),n=[i,...r.tags],s=n.findIndex((e=>e===t));if(-1!==s)return[0===s?100:50,o];const a=n.findIndex((e=>e.startsWith(t))),l=i.includes(t);return 0!==a&&l?[40,o]:-1!==a?[0===a?80:30,o]:void 0})));return l().sortBy(o,(e=>-e[0])).map((e=>e[1]))}getLoadingContainerStyle(){return{display:"flex",width:"100%",height:"100%",justifyContent:"center",alignItems:"center",paddingBottom:"10px"}}getIconSectionWrapStyle(){const{device:e,WindowSizeStore:t}=this.environment;return{display:"flex",flexDirection:"column",flexWrap:"wrap",alignItems:"flex-start",...e.isPhone?{background:this.theme.popoverBackground,paddingTop:10,paddingBottom:10,paddingLeft:t.getSafePaddingLeftCSS(B.phonePaddingLeft),paddingRight:t.getSafePaddingLeftCSS(B.phonePaddingRight),boxShadow:`0 1px 0 ${this.theme.regularDividerColor}`,marginBottom:1}:{background:c.ZP.transparent,paddingLeft:e.isTablet?B.tabletPopupPaddingHorizontal:B.desktopPopupPaddingHorizontal,paddingRight:e.isTablet?B.tabletPopupPaddingHorizontal:B.desktopPopupPaddingHorizontal}}}}B.displayName="IconPicker",B.loadMoreCategoryEdgeDistance=100,B.localRecentIconsKey="recentIcons",B.desktopPopupPaddingHorizontal=k.ZP.desktopPopupPaddingHorizontal,B.tabletPopupPaddingHorizontal=k.ZP.tabletPopupPaddingHorizontal,B.desktopIconPickerOnlyPopupWidth=8*T.Z.desktopButtonSize+2*B.desktopPopupPaddingHorizontal,B.desktopIconPickerOnlyPopupHeight=356,B.phonePaddingLeft=k.ZP.phonePaddingLeft,B.phonePaddingRight=k.ZP.phonePaddingRight,B.wrapStyle={display:"flex",flexDirection:"column"},B.rowStyle={display:"flex"};const O=B},57670:(e,t,o)=>{o.d(t,{Z:()=>b});var r=o(10434),i=o.n(r),n=o(23174),s=o.n(n),a=o(67294),l=o(83355),p=o(79362),d=o(98742),c=o(61766),u=o(64921),h=o(31945),g=o(1743),m=o(3386),y=o(32163),f=o(58032),S=o(79920);class v extends l.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:c.Z},this.renderIconWithVariations=()=>{const{icon:e,focused:t}=this.props,{buttonPopupStore:o}=this.stores;return s()(m.Z,{capture:t,onEnter:this.handleOpenMenu,onEsc:this.handleCloseMenu},e,s()(h.ZP,{buttonPopupStore:o,popupType:h.Z4.Popup,renderOrigin:e=>this.renderSingleIcon(e),render:this.renderVariationMenu}))},this.renderSingleIcon=e=>{const{icon:t,focused:o,color:r,onClick:n,onMouseEnter:l,variations:p,hideTooltip:c}=this.props,h=p.tooltip?p.tooltip:t,g="dark"===this.theme.mode?p.dark:p.light;return s()(f.Z,{allowHover:Boolean(t&&!c),disableTooltip:c,renderTooltip:()=>h.replaceAll("-"," ").replaceAll("_"," "),closeDelay:0,render:p=>a.createElement(u.Z,i()({key:t,focused:o,onClick:n},(0,d.Z)(e||{},(0,d.Z)({onMouseEnter:l},p)),{ignoreLocalHoverState:!0,style:this.styles.iconButton}),s()("img",{src:`data:image/svg+xml;utf8,${encodeURIComponent(g[r])}`,style:this.styles.iconImage,onContextMenu:e=>e.preventDefault()}))})},this.renderVariationMenu=e=>{const{icon:t,variations:o,insertIcon:r}=this.props,n="dark"===this.theme.mode?o.light:o.dark,l=Object.keys(n).sort(((e,t)=>p.Oe.indexOf(e)-p.Oe.indexOf(t))).map((n=>{const s=`${t}_${n}`;return{key:s,action:t=>{e.close(),r(`/icons/${s}.svg`)},render:e=>a.createElement(v,i()({},this.props,e,{icon:s,color:n,variations:o,shouldOpenVariations:!1,hideTooltip:!0}))}}));return s()(g.Z,{capture:!0,allowEsc:!0},void 0,s()(y.Z,{type:y.i.Grid,itemsPerRow:5,initialFocus:0,sections:[{key:"variations",render:e=>a.createElement("div",e),items:l}],renderRow:(e,t)=>s()("div",{style:this.styles.variationMenu},t,e)}))},this.handleOpenMenu=e=>{e.preventDefault();const{buttonPopupStore:t}=this.stores;t.setState({...t.state,open:!0})},this.handleCloseMenu=()=>{const{buttonPopupStore:e}=this.stores;e.setState({...e.state,open:!1})},this.styles={iconButton:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:4,...this.getButtonStyles()},variationMenu:{display:"flex",padding:2,gap:1},iconImage:{...this.environment.device.isMobile?{width:v.mobileFontSize,height:v.mobileFontSize}:{width:v.desktopFontSize,height:v.desktopFontSize}}}}renderComponent(){const{shouldOpenVariations:e}=this.props;return e?this.renderIconWithVariations():this.renderSingleIcon()}getButtonStyles(){const{device:e}=this.environment;return e.isMobile?{width:v.mobileButtonSize,height:v.mobileButtonSize,fontSize:v.mobileFontSize}:{width:v.desktopButtonSize,height:v.desktopButtonSize,fontSize:v.desktopFontSize}}}v.displayName="IconPickerMenuItem",v.desktopButtonSize=S.Z.desktopButtonSize,v.desktopFontSize=S.Z.desktopFontSize,v.mobileButtonSize=S.Z.mobileButtonSize,v.mobileFontSize=S.Z.mobileFontSize;const b=v},3072:(e,t,o)=>{o.d(t,{Z:()=>k});var r=o(10434),i=o.n(r),n=o(23174),s=o.n(n),a=(o(57658),o(96486)),l=o.n(a),p=o(67294),d=o(83355),c=o(2032),u=o(5366),h=o(47853),g=o(16187),m=o(87279),y=o(98742),f=o(52275),S=o(78140),v=o(32163),b=o(40721),P=o(44532),M=o(72495),w=o(58032),C=o(95030);const Z=(0,u.defineMessages)({noneText:{defaultMessage:"None",id:"database.propertyAggregationMenu.noneText"}});class I extends d.Z{renderComponent(){const{device:e}=this.environment;let t;return t=e.isMobile?{menuType:m.og.Modal,title:s()(u.FormattedMessage,{defaultMessage:"Table aggregation",id:"database.mobilePropertyAggregationMenu.title"}),right:s()(b.DoneMenuText,{}),onClickRight:this.props.onClose}:{menuType:m.og.Popup,width:200},p.createElement(S.Z,t,s()(v.Z,{type:v.i.Vertical,initialFocus:0,sections:[{key:0,render:e=>p.createElement(M.Z,e),items:this.getAggregationActions()}],onAccept:this.props.onClose}))}getAggregationActions(){const e=[],{property:t,schema:o,source:r}=this.props,n=o[t];if(!n)return[];e.push({key:"none",render:e=>p.createElement(f.Z,i()({},e,{title:this.props.noneText||this.props.intl.formatMessage(Z.noneText)})),action:()=>this.props.onChange(void 0)});for(const i of c.o5)e.push(this.createAggregationAction(i));if((0,c.iV)(n))for(const i of c.Sy){const t=this.createAggregationAction(i);if("show_unique"===i)switch(r){case"tableAggregation":continue;case"rollupPropertyMenu":e.splice(1,0,t);continue}e.push(t)}if((0,c.O4)(n))for(const i of c.k$)e.push(this.createAggregationAction(i));if((0,c.dN)(n))for(const i of c.f8)e.push(this.createAggregationAction(i));if((0,c.Mv)(n))for(const i of c.gC)e.push(this.createAggregationAction(i));if((0,c.Ei)(n))for(const i of c.OK)e.push(this.getStatusPropAggregationAction(t,i));return e}createAggregationAction(e){const t=g.VN[e],o=g.Sn[e];return{key:t,render:r=>s()(w.Z,{placement:P.GI.Placement.Right,delayThreshold:0,render:e=>p.createElement(f.Z,i()({title:t},(0,y.Z)(e,r))),renderTooltip:()=>s()("div",{style:{width:140,whiteSpace:"normal"}},void 0,o&&s()("img",{src:(0,h.D)(o),style:{borderRadius:3,width:140,marginTop:4}}),g.BG[e])},r.key),action:()=>{this.props.onChange(e)}}}getStatusPropAggregationAction(e,t){const{device:o}=this.environment,r=g.VN[t],n=l().compact(this.createStatusPropGroupAggregationAction(e,t));return{key:t,render:(e,t)=>p.createElement(C.Z,i()({},e,{onFocus:t.onFocus,renderOrigin:e=>p.createElement(f.Z,i()({},e,{title:r})),renderExtension:(e,i)=>{let a;return a=o.isMobile?{menuType:m.og.Modal,title:r,right:s()(b.DoneMenuText,{}),onClickRight:i.close,...e}:{menuType:m.og.Popup,width:200,...e},p.createElement(S.Z,a,s()(v.Z,{type:v.i.Vertical,initialFocus:0,sections:[{key:"groups",render:e=>p.createElement(M.Z,e),items:n}],onAccept:t.onAccept}))}})),action:()=>null}}createStatusPropGroupAggregationAction(e,t){const o=this.props.schema[e];if(!o||"status"!==o.type)return;const r=o.groups;return r?r.map((e=>({key:`${t}${e.name}`,render:o=>this.renderAggregationGroupMenuItem(t,e.name,o),action:()=>{this.props.onChange({operator:t,groupName:e.name})}}))):void 0}renderAggregationGroupMenuItem(e,t,o){const r=g.Sn[e];return s()(w.Z,{placement:P.GI.Placement.Right,delayThreshold:0,render:e=>p.createElement(f.Z,i()({title:t},(0,y.Z)(e,o))),renderTooltip:()=>s()("div",{style:{width:140,whiteSpace:"normal"}},void 0,r&&s()("img",{src:(0,h.D)(r),style:{borderRadius:3,width:140,marginTop:4}}),g.BG[e])},o.key)}}I.displayName="PropertyAggregationMenu";const k=(0,u.injectIntl)(I)},86765:(e,t,o)=>{o.d(t,{Z:()=>u});var r=o(23174),i=o.n(r),n=(o(67294),o(480)),s=o(81954),a=o(24405),l=o(5366),p=o(86355),d=o(31278),c=o(76798);const u=(0,l.injectIntl)((function(e){window.__c={n:"RelationCreateItemText"};const{title:t,targetCollectionStore:o}=e,r=(0,n.Fy)(),u=(0,s.VK)((()=>o.getIcon()),[o]),h=(0,a.yK)((e=>({medium:{color:e.mediumTextColor},dbName:{display:"flex",alignItems:"center",marginLeft:4},title:{marginLeft:p.Qi*(r.isRetina?.5:1)}})),[r.isRetina]),g=t?i()("span",{},void 0," ",t," "):i()("span",{},void 0," "),m=i()("div",{style:h.dbName},void 0,i()(d.Z,{disabled:!0,icon:u,isEmptyPage:!1,size:r.isMobile?24:20}),i()(c.Z,{store:o,style:h.title}));return i()("div",{style:{display:"flex",alignItems:"center"}},void 0,i()(l.FormattedMessage,{id:"database.searchRelation.createNewPageFooter",defaultMessage:"<medium>New</medium> {pageName} <medium> in</medium> {databaseNameWithIcon}",values:{medium:e=>i()("span",{style:h.medium},void 0,e),pageName:g,databaseNameWithIcon:m}}))}))},18145:(e,t,o)=>{o.d(t,{t:()=>O,Z:()=>z});var r=o(10434),i=o.n(r),n=o(23174),s=o.n(n),a=o(96486),l=o(67294),p=o(83355),d=o(2032),c=o(99036),u=o(53397),h=o(5366),g=o(50906),m=o(66890),y=o(16187),f=o(75079),S=o(87279),v=o(98742),b=o(61766),P=o(68216),M=o(42917),w=o(52275),C=o(31945),Z=o(78140),I=o(32163),k=o(40721),T=o(44532),R=o(72495),x=o(58032),A=o(19387),F=o(3072),E=o(69872),B=o(77498);let O=function(e){return e[e.BlockPropertyOverlay=0]="BlockPropertyOverlay",e[e.ViewSettings=1]="ViewSettings",e}({});class Y extends p.Z{constructor(){super(...arguments),this.storeTypes={relationButtonPopupStore:b.Z,targetPropertyButtonPopupStore:b.Z,aggregationButtonPopupStore:b.Z},this.renderRelationSelect=e=>s()(B.Z,{schema:this.props.schema,isRelationProperty:!0,onAccept:this.handleRelationAccept,onClose:e.close,allowProperty:this.handleRelationAllowProperty}),this.renderTargetPropertyTooltip=()=>s()(h.FormattedMessage,{id:"database.rollupProperty.editProperty.tooltip",defaultMessage:"Select an existing relation first."}),this.renderTargetPropertySelect=e=>{const t=this.getRenderState();if(t)return s()(B.Z,{isRelationProperty:!1,schema:t.relatedCollectionSchema,onAccept:this.handleTargetPropertyAccept,allowProperty:this.handleTargetPropertyAllowProperty,onClose:e.close})},this.renderAggregationTooltip=()=>s()(h.FormattedMessage,{id:"database.rollupProperty.editAggregate.tooltip",defaultMessage:"Select an existing relation and property first."}),this.renderAggregationSelect=e=>{const t=this.getRenderState();if(t&&t.propertySchema.target_property)return s()(F.Z,{property:t.propertySchema.target_property,schema:t.relatedCollectionSchema,onChange:this.handlePropertyAggregationMenuChange,onClose:e.close,noneText:s()(h.FormattedMessage,{id:"database.rollupProperty.aggregate.showOriginal",defaultMessage:"Show original"}),source:"rollupPropertyMenu"})},this.handleRelationAccept=e=>{const{onChange:t,analyticsFrom:o}=this.props,r=this.getRenderState();if(!r)return;const i={...r.propertySchema,relation_property:e,target_property:"title",target_property_type:"title",aggregation:void 0};null==t||t({propertySchema:i}),g.Zrf(this.environment,{...(0,f.Pn)(this.context.collectionContextStore),from:o})},this.handleTargetPropertyAccept=e=>{const{onChange:t,analyticsFrom:o}=this.props,r=this.getRenderState();if(!r||!r.relatedCollectionValue||!r.relatedCollectionSchema)return;const i=r.relatedCollectionSchema[e];if(!i)return;const n={...r.propertySchema,target_property:e,target_property_type:i.type,aggregation:void 0};null==t||t({propertySchema:n}),g.yjq(this.environment,{...(0,f.Pn)(this.context.collectionContextStore),from:o,property_type:i.type})},this.handlePropertyAggregationMenuChange=e=>{const{onChange:t,analyticsFrom:o}=this.props,r=this.getRenderState();if(!r)return;const i={...r.propertySchema,aggregation:e,show_as:void 0};null==t||t({propertySchema:i});const n=e?(0,d.gu)(e):void 0;g.enk(this.environment,{...(0,f.Pn)(this.context.collectionContextStore),from:o,aggregation:n})},this.handleRelationAllowProperty=e=>"relation"===e.type,this.handleTargetPropertyAllowProperty=e=>"rollup"!==e.type&&!c.Eu.includes(e.type)}renderComponent(){const{device:e}=this.environment,{context:t}=this.props,o=this.getRenderState();if(!o)return;const r=Boolean(o.propertySchema.relation_property),n=Boolean(o.propertySchema.relation_property&&o.propertySchema.target_property);if(t===O.BlockPropertyOverlay){let t;return t=e.isMobile?{menuType:S.og.Modal,title:o.propertySchema.name,right:s()(k.DoneMenuText,{}),onClickRight:this.props.onDismiss}:{menuType:S.og.Popup},l.createElement(Z.Z,t,s()(I.Z,{type:I.i.Vertical,initialFocus:void 0,sections:a.compact([this.renderRelationSection(),this.renderTargetPropertySection(r),this.renderAggregationSection(n)])}))}return l.createElement(l.Fragment,null,s()(C.ZP,{popupType:e.isMobile?T.kQ.SlideUp:T.kQ.Popup,alignmentToOrigin:C.vR.End,renderOrigin:e=>l.createElement(M.Z,i()({title:s()(h.FormattedMessage,{defaultMessage:"Relation",id:"database.viewSettings.rollupOptions.relationProperty"}),disabled:this.props.disabled,showChevron:!0,rotateChevron:this.stores.relationButtonPopupStore.state.open,right:o.relationPropertySchema?s()(A.Z,{propertySchema:o.relationPropertySchema,showIcon:!0}):s()(h.FormattedMessage,{id:"database.viewSettings.rollupOptions.selectRelation",defaultMessage:"Select"})},e)),render:this.renderRelationSelect,buttonPopupStore:this.stores.relationButtonPopupStore}),s()(x.Z,{renderTooltip:this.renderTargetPropertyTooltip,disableTooltip:r,render:t=>s()(C.ZP,{popupType:e.isMobile?T.kQ.SlideUp:T.kQ.Popup,alignmentToOrigin:C.vR.End,renderOrigin:e=>l.createElement(M.Z,i()({title:s()("span",{style:{...!n&&{color:this.theme.mediumTextColor}}},void 0,s()(h.FormattedMessage,{defaultMessage:"Property",id:"database.viewSettings.rollupOptions.targetProperty"})),disabled:!r||this.props.disabled,showChevron:!0,rotateChevron:this.stores.targetPropertyButtonPopupStore.state.open,right:r&&(o.targetPropertySchema?s()(A.Z,{propertySchema:o.targetPropertySchema,showIcon:!0}):s()(h.FormattedMessage,{id:"database.viewSettings.rollupOptions.selectTargetProperty",defaultMessage:"Select"}))},(0,v.Z)(t,e))),render:this.renderTargetPropertySelect,buttonPopupStore:this.stores.targetPropertyButtonPopupStore})}),s()(x.Z,{renderTooltip:this.renderAggregationTooltip,disableTooltip:n,render:t=>s()(C.ZP,{popupType:e.isMobile?T.kQ.SlideUp:T.kQ.Popup,alignmentToOrigin:C.vR.End,renderOrigin:e=>l.createElement(M.Z,i()({disabled:!n||this.props.disabled,title:s()("span",{style:{...!n&&{color:this.theme.mediumTextColor}}},void 0,s()(h.FormattedMessage,{defaultMessage:"Calculate",id:"database.viewSettings.rollupOptions.calculate"})),showChevron:!0,rotateChevron:this.stores.aggregationButtonPopupStore.state.open,right:n&&this.renderCurrentAggregation()},(0,v.Z)(t,e))),render:this.renderAggregationSelect,buttonPopupStore:this.stores.aggregationButtonPopupStore})}))}renderRelationSection(){const{device:e}=this.environment,{disabled:t}=this.props,o=this.getRenderState();if(o)return{key:0,render:e=>l.createElement(R.Z,i()({},e,{title:s()(h.FormattedMessage,{id:"database.rollupProperty.editRelation.title",defaultMessage:"Relation"}),isTitleUppercase:!0})),items:[{key:0,render:r=>s()(C.ZP,{popupType:e.isMobile?T.kQ.SlideUp:T.kQ.Popup,renderOrigin:e=>o.relationPropertySchema?l.createElement(E.Z,i()({},(0,v.Z)(r,e),{propertySchema:o.relationPropertySchema,format:E.L.Name,right:this.getMenuItemChevron(t),disabled:t})):l.createElement(w.Z,i()({},(0,v.Z)(r,e),{title:s()(h.FormattedMessage,{id:"database.rollupProperty.editRelation.buttonTitle",defaultMessage:"Select an existing relation…"}),right:this.getMenuItemChevron(t),style:{color:this.theme.mediumTextColor},disabled:t})),render:this.renderRelationSelect,buttonPopupStore:this.stores.relationButtonPopupStore},r.key),action:()=>{this.stores.relationButtonPopupStore.setState({open:!0})}}]}}renderTargetPropertySection(e){const{device:t}=this.environment,{disabled:o}=this.props,r=this.getRenderState();if(r)return{key:1,render:e=>l.createElement(R.Z,i()({},e,{title:s()(h.FormattedMessage,{id:"database.rollupProperty.editProperty.title",defaultMessage:"Property"}),topBorder:!0,isTitleUppercase:!0})),items:[{key:0,render:n=>s()(x.Z,{renderTooltip:this.renderTargetPropertyTooltip,disableTooltip:e,render:a=>s()(C.ZP,{popupType:t.isMobile?T.kQ.SlideUp:T.kQ.Popup,renderOrigin:t=>r.targetPropertySchema?l.createElement(E.Z,i()({},(0,v.Z)(n,t),{propertySchema:r.targetPropertySchema,format:E.L.Name,right:this.getMenuItemChevron(o),disabled:o})):l.createElement(w.Z,i()({},(0,v.Z)(n,a),{title:s()(h.FormattedMessage,{id:"database.rollupProperty.editProperty.buttonTitle",defaultMessage:"Select a property to display…"}),right:this.getMenuItemChevron(!e||o),disabled:!e||o,disabledFeedback:!0})),render:this.renderTargetPropertySelect,buttonPopupStore:this.stores.targetPropertyButtonPopupStore})},n.key),action:()=>{this.stores.targetPropertyButtonPopupStore.setState({open:!0})}}]}}renderAggregationSection(e){const{device:t}=this.environment,{disabled:o}=this.props;if(this.getRenderState())return{key:2,render:e=>l.createElement(R.Z,i()({},e,{title:s()(h.FormattedMessage,{id:"database.rollupProperty.editAggregate.title",defaultMessage:"Calculate"}),topBorder:!0,isTitleUppercase:!0})),items:[{key:0,render:r=>s()(x.Z,{renderTooltip:this.renderAggregationTooltip,disableTooltip:e,render:n=>e?s()(C.ZP,{popupType:t.isMobile?T.kQ.SlideUp:T.kQ.Popup,renderOrigin:e=>l.createElement(w.Z,i()({},(0,v.Z)(r,e),{title:this.renderCurrentAggregation(),right:this.getMenuItemChevron(o),disabled:o})),render:this.renderAggregationSelect,buttonPopupStore:this.stores.aggregationButtonPopupStore}):l.createElement(w.Z,i()({},(0,v.Z)(r,n),{title:s()(h.FormattedMessage,{id:"database.rollupProperty.aggregate.showOriginal",defaultMessage:"Show original"}),right:this.getMenuItemChevron(o),disabled:!0,disabledFeedback:!0}))},r.key),action:()=>{this.stores.aggregationButtonPopupStore.setState({open:!0})}}]}}renderCurrentAggregation(){const e=this.getRenderState();if(e)return e.propertySchema.aggregation?y.VN[(0,d.gu)(e.propertySchema.aggregation)]:s()(h.FormattedMessage,{id:"database.rollupProperty.aggregate.showOriginal",defaultMessage:"Show original"})}getMenuItemChevron(e){return e?void 0:u.Z.chevronDown({width:11,fill:this.theme.mediumIconColor})}getRenderState(){const{schema:e,property:t,parentStore:o}=this.props,r=e[t];if(!r)return;let i,n;if(r.relation_property){const t=e[r.relation_property];t&&"relation"===t.type&&(i=t)}if(i){const e=c.j0(i);if(e){n=P.NW.createChildStore(o,e).getValue()}}const s=n?c.oC(n):{};let a;return n&&r.target_property&&(a=s[r.target_property]),{propertySchema:r,relationPropertySchema:i,relatedCollectionValue:n,relatedCollectionSchema:s,targetPropertySchema:a}}}Y.displayName="RollupPropertyMenu",Y.contextTypes={...p.w,...m.xm};const z=Y},9050:(e,t,o)=>{o.d(t,{Z:()=>g});var r=o(23174),i=o.n(r),n=o(10434),s=o.n(n),a=o(67294),l=o(83355),p=o(8848),d=o(80025),c=o(87279),u=o(52275);class h extends l.Z{renderComponent(){return a.createElement(u.Z,s()({},this.props,{icon:this.renderColorTile(),title:(0,d.Vn)(this.props.color)}))}renderColorTile(){const e=(0,p.KR)(this.theme,this.props.color);return i()("div",{style:{width:this.environment.device.isMobile?24:18,height:this.environment.device.isMobile?24:18,background:e.menuBackgroundColor,color:e.textColor,boxShadow:this.theme.innerBorderBoxShadow,borderRadius:3}})}}h.displayName="SelectColorMenuItem",h.contextTypes={...c.mw,...l.w};const g=h},73456:(e,t,o)=>{o.d(t,{Z:()=>Y});var r=o(10434),i=o.n(r),n=o(23174),s=o.n(n),a=(o(57658),o(96486)),l=o.n(a),p=o(67294),d=o(83355),c=o(99036),u=o(8848),h=o(84619),g=o(53397),m=o(6287),y=o(82990),f=o(5366),S=o(50906),v=o(47307),b=o(66890),P=o(75079),M=o(87279),w=o(33846),C=o(13709),Z=o(97180),I=o(93405),k=o(68894),T=o(78140),R=o(32163),x=o(40721),A=o(44532),F=o(72495),E=o(9050),B=o(22084);class O extends d.Z{constructor(){super(...arguments),this.storeTypes={renameInputStore:w.Z},this.renderPopup=()=>{const{device:e}=this.environment,{option:t,statusGroup:o,propertySchema:r}=this.props,{renameInputStore:n}=this.stores,a={key:"action",render:e=>p.createElement(F.Z,e),items:[]};a.items.push({key:"delete",render:e=>p.createElement(I.Z,i()({},e,{title:s()(f.FormattedMessage,{id:"database.selectPropertyOptionEditMenu.deleteLabel",defaultMessage:"Delete"}),svg:g.Z.trash})),action:this.handleDelete}),o&&"status"===r.type&&(a.items.push({key:"setAsDefault",render:e=>p.createElement(I.Z,i()({},e,{title:s()(f.FormattedMessage,{id:"database.selectPropertyOptionEditMenu.setAsDefault",defaultMessage:"Set as default"}),svg:g.Z.flag})),action:this.handleSetAsDefault}),a.items.push({key:"Group",render:e=>p.createElement("div",e,p.createElement(C.Z,i()({},e,{title:s()(f.FormattedMessage,{id:"database.selectPropertyOptionEditMenu.Group",defaultMessage:"Group"}),selectedKey:o.name,options:(r.groups??[]).map((e=>({key:e.name,title:Z.ZA[e.name]??e.name}))),icon:e=>g.Z.checkboxSquareChecked({...e,width:16,marginRight:0}),onChange:e=>{this.handleChangeGroup(e)}}))),action:()=>{}}));const l={key:"color",render:e=>p.createElement(F.Z,i()({},e,{title:s()(f.FormattedMessage,{id:"database.selectPropertyOptionEditMenu.colorsSection",defaultMessage:"Colors"}),isTitleUppercase:!0,topBorder:!0})),items:u.AP.map((e=>({key:e,render:o=>p.createElement(E.Z,i()({},o,{color:e,checkState:t.color===e})),action:()=>{this.handleSelectPropertyColorPickerChange(e)}})))};let d;return d=e.isMobile?{menuType:M.og.Modal,title:s()(B.a,{format:h.l.Large,value:t.value,color:t.color,showRemoveButton:!1,isSingle:!0}),right:s()(x.DoneMenuText,{}),onClickRight:this.handleRenameInputSubmit}:{menuType:M.og.Popup,width:220},p.createElement(T.Z,d,s()(F.Z,{isInput:!0},void 0,s()(k.ZP,{focus:!e.isMobile||void 0,selectAll:!e.isMobile,value:n.state.inputValue,onChange:this.handleRenameInputChange,onSubmit:this.handleRenameInputSubmit,rightMobileEditLabel:s()(f.FormattedMessage,{defaultMessage:"Rename",id:"database.editProperty.select.mobileLabel"})})),s()(R.Z,{type:R.i.Vertical,disableKeyboard:!0,initialFocus:void 0,sections:[a,l]}))},this.handleDelete=()=>{const{option:e,collectionId:t,onChange:o,analyticsFrom:r,statusGroup:i,propertySchema:n,property:a}=this.props;"status"!==n.type||e.value!==n.defaultOption?v.showDialog({showCancel:!0,keepFocus:!1,message:s()(f.FormattedMessage,{id:"database.selectPropertyOptionEditMenu.deleteModal.prompt",defaultMessage:"Are you sure you want to remove this option?"}),items:[{label:s()(f.FormattedMessage,{id:"database.selectPropertyOptionEditMenu.deleteModal.confirmButton",defaultMessage:"Remove"}),color:"red",onAccept:()=>{if(!c.cu(n)&&"status"!==n.type)return;const s={table:m.v,id:t},l=[],p={pointer:s,command:"keyedObjectListRemove",path:["schema",a,"options"],args:{remove:{id:e.id}}};if(l.push(p),i&&"status"===n.type){const t=(n.groups??[]).findIndex((e=>e.id===i.id)),o={pointer:s,command:"listRemove",path:["schema",a,"groups",t,"optionIds"],args:{id:e.id}};l.push(o)}o(l),this.props.onClose(),S.$qu(this.environment,{...(0,P.Pn)(this.context.collectionContextStore),property_type:n.type,action:"select_delete_option",from:r})}}]}):v.showErrorMessage(s()(f.FormattedMessage,{defaultMessage:"Cannot delete default option.",id:"database.editProperty.errorDialog.forbidDeleteDefaultOption.message"}))},this.handleSetAsDefault=async()=>{const{collectionId:e,property:t,propertySchema:o,onChange:r,statusGroup:i,analyticsFrom:n,option:a}=this.props;if("status"!==o.type||!i)return;if(a.value===o.defaultOption)return;if(!(await v.confirmUserAction({message:s()("span",{},void 0,s()(f.FormattedMessage,{defaultMessage:"Change default to <b>{defaultValue}</b>?",id:"database.editProperty.setAsDefault.confirm.title",values:{defaultValue:a.value,b:e=>s()("span",{style:{fontWeight:y.Z.fontWeight.semibold}},void 0,e)}})),description:s()("span",{},void 0,s()(f.FormattedMessage,{defaultMessage:"New pages will start with {defaultValue} as the default status. Existing pages <b>without a status set</b> will switch to {defaultValue}.",id:"database.editProperty.setAsDefault.confirm.description",values:{defaultValue:a.value,b:e=>s()("span",{style:{fontWeight:y.Z.fontWeight.semibold}},void 0,e)}})),acceptLabel:s()(f.FormattedMessage,{defaultMessage:"Continue",id:"database.editProperty.setAsDefault.confirm.continueButton"})})))return;const l=[],p={pointer:{table:m.v,id:e},command:"update",path:["schema",t],args:{defaultOption:a.value}};l.push(p),r(l),this.props.onClose(),S.$qu(this.environment,{property_type:o.type,action:"status_set_default",from:n,collection_id:e})},this.handleChangeGroup=e=>{const{collectionId:t,option:o,property:r,onChange:i,statusGroup:n,analyticsFrom:s,propertySchema:a}=this.props;if("status"!==a.type||!n)return;const l={table:m.v,id:t},p=[],d=a.groups??[],c=d.findIndex((e=>e.id===n.id)),u=d.findIndex((t=>t.name===e));if(c===u)return;const h={pointer:l,command:"listRemove",path:["schema",r,"groups",c,"optionIds"],args:{id:o.id}},g={pointer:l,command:"listAfter",path:["schema",r,"groups",u,"optionIds"],args:{id:o.id}};p.push(h,g);const y=a.options??[],f={pointer:l,command:"set",path:["schema",r,"options"],args:d.flatMap((e=>{const t=e.optionIds??[];return y.filter((e=>t.includes(e.id)))}))};p.push(f),i(p),S.$qu(this.environment,{property_type:a.type,action:"status_set_default",from:s,collection_id:t})},this.handleRenameInputChange=e=>{const{renameInputStore:t}=this.stores,o=e.target.value.replace(/,/g,"");t.setState({...t.state,inputValue:o}),t.emit()},this.handleRenameInputSubmit=()=>{this.props.onClose(),this.performRename()},this.handleSelectPropertyColorPickerChange=e=>{const{option:t,collectionId:o,property:r,propertySchema:i,onChange:n,analyticsFrom:s}=this.props,a={...t,color:e};n([{pointer:{table:m.v,id:o},command:"keyedObjectListUpdate",path:["schema",r,"options"],args:{value:a}}]),S.$qu(this.environment,{property_type:i.type,action:"select_change_color",from:s,collection_id:o})}}willMount(e){super.willMount(e),this.stores.renameInputStore.setState({...this.stores.renameInputStore.state,inputValue:e.option.value})}renderComponent(){const{origin:e,open:t,alignmentToOrigin:o}=this.props,{device:r}=this.environment;return s()(A.ZP,{popupType:r.isMobile?A.ZP.PopupType.SlideUp:A.ZP.PopupType.Popup,open:t,onDismiss:this.handleRenameInputSubmit,origin:e,render:this.renderPopup,alignmentToOrigin:o})}performRename(){const{collectionId:e,propertySchema:t,property:o,onChange:r,option:i}=this.props,{renameInputStore:n}=this.stores,a=n.state.inputValue,p=t.options||[],d=p.find((e=>e.id!==i.id&&e.value.trim().toLowerCase()===a.trim().toLowerCase()));if(i.value!==a)if(a)if(d)v.showErrorMessage(s()(f.FormattedMessage,{defaultMessage:"This select option already exists.",id:"database.editProperty.errorDialog.duplicateSelectValue.message"}));else{const n=p.find((e=>e.id===i.id));if(!n)return;const s={...n,value:a},d={pointer:{table:m.v,id:e},command:"keyedObjectListUpdate",path:["schema",o,"options"],args:{value:s}},c="status"===t.type&&i.value===t.defaultOption?{pointer:{table:m.v,id:e},command:"update",path:["schema",o],args:{defaultOption:a}}:void 0;r(l().compact([d,c]))}else v.showErrorMessage(s()(f.FormattedMessage,{defaultMessage:"Please type a value.",id:"database.editProperty.errorDialog.missingSelectValue.message"}))}}O.displayName="SelectOptionActionMenu",O.contextTypes={...d.w,...b.xm};const Y=O},97680:(e,t,o)=>{o.d(t,{Z:()=>v});var r=o(10434),i=o.n(r),n=o(23174),s=o.n(n),a=o(67294),l=o(83355),p=o(66897),d=o(97880),c=o(33929),u=o(87279),h=o(98742),g=o(52275),m=o(58032),y=o(70301),f=o(45653);class S extends l.Z{renderComponent(){const{actor:e,userTitle:t,useEmailAsTooltip:o,tooltip:r,tooltipPlacement:n}=this.props,l=c.default.getIntl(),u=e.asActor&&e.isUser()?e.email:void 0,S=o&&u?u:r,v=this.environment.device.isMobile?24:20;let b;return(0,p.YU)(e)?b=s()(y.Z,{botValue:null==e?void 0:e.asActor,size:v}):(0,p.$S)(e)?b=s()(f.Z,{userValue:null==e?void 0:e.asActor,size:v}):(0,p.Iq)(e)?b=s()(f.Z,{userValue:void 0,size:v}):(0,d.t1)(e),s()(m.Z,{placement:n??m.Z.Placement.Bottom,alignment:m.Z.Alignment.Start,textWrap:!0,render:o=>a.createElement(g.Z,i()({},(0,h.Z)(o,this.props),{icon:b,title:t??(0,p.$4)(l,e),className:"notranslate"})),disableTooltip:!S,renderTooltip:()=>S})}}S.displayName="UserMenuItem",S.contextTypes={...u.mw,...l.w};const v=S},49122:(e,t,o)=>{o.d(t,{Z:()=>c});var r=o(23174),i=o.n(r),n=(o(67294),o(480)),s=o(24405),a=o(41892),l=o(82990),p=o(5366),d=o(32662);function c(e){window.__c={n:"CollectionSettingsGithubPrTaskPreview"};const t=(0,p.useIntl)(),o=function(e){const{isMobile:t}=(0,n.Fy)(),o=t?18:14,r=1,i=6,a=20;return(0,s.yK)((t=>({githubContainer:{display:"flex",alignSelf:"center",flexDirection:"column",width:e||"90%",padding:a,border:`${r}px solid ${t.tableDividerColor}`,borderRadius:i,borderBottomRightRadius:4,cursor:"default"},githubPrTitleRow:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-start",width:`calc(100% + ${a}px)`,overflow:"hidden"},githubPrTitle:{display:"inline-flex",fontSize:o,fontWeight:500,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",background:t.whiteButtonBackground,padding:"2px 4px",borderTopLeftRadius:5,borderBottomLeftRadius:5,borderLeft:`2px solid ${t.blueColor}`,borderTop:`2px solid ${t.blueColor}`,borderBottom:`2px solid ${t.blueColor}`,width:"100%"},githubTask:{background:"light"===t.mode?t.accentColors.blue[50]:t.accentColors.blue[400]},githubPrInfoRow:{display:"inline-flex"},githubPrInfoPill:{display:"flex",flexDirection:"row",alignItems:"center",width:"fit-content",padding:"4px 10px",borderRadius:"2em",background:"#238636",flexShrink:0,...l.Z.textOverflowStyle},githubPrInfoOpenText:{color:"white",fontSize:o-2,fontWeight:500},githubPrInfoMergeInto:{display:"inline-flex",alignItems:"center",fontSize:o-2,color:t.lightTextColor,...l.Z.textOverflowStyle},githubPrInfoMain:{padding:"0px 4px",fontFamily:l.Z.baseFontFamily.githubMono,background:t.cardPressedBackground,borderRadius:i,color:t.regularTextColor,verticalAlign:"text-bottom",...l.Z.textOverflowStyle}})),[o,e])}(e.width),r=i()("div",{id:"github-preview-github-pr-title-row",style:o.githubPrTitleRow},void 0,i()("div",{id:"github-preview-github-pr-title-wrapper",style:o.githubPrTitle},void 0,i()(d.Z,{size:2}),"[",i()("div",{id:"github-preview-github-pr-task",style:o.githubTask},void 0,e.uniqueIdPrefix||t.formatMessage(u.idPrefix),e.uniqueIdValue?`-${e.uniqueIdValue}`:"-1"),"]",i()(d.Z,{size:2}),t.formatMessage(u.prTitle))),c=i()("div",{id:"github-preview-github-pr-info-row",style:o.githubPrInfoRow},void 0,i()("div",{id:"github-preview-github-open-pr-pill",style:o.githubPrInfoPill},void 0,i()("img",{src:a.Z.images.externalIntegrations.githubPullOpenIconWhitePng,style:{width:16,height:16}}),i()(d.Z,{size:2}),i()("div",{style:o.githubPrInfoOpenText},void 0,t.formatMessage(u.open))),i()(d.Z,{size:8}),i()("div",{id:"github-preview-github-merge-into-main",style:o.githubPrInfoMergeInto},void 0,i()("span",{style:o.githubPrInfoMergeInto},void 0,t.formatMessage(u.mergeInto),i()(d.Z,{size:4}),i()("span",{style:o.githubPrInfoMain},void 0,t.formatMessage(u.main)))));return i()("div",{id:"github-preview-github-container",style:o.githubContainer},void 0,r,i()(d.Z,{size:12}),c)}const u=(0,p.defineMessages)({dismissButtonAriaLabel:{defaultMessage:"A button to dismiss the user education preview.",id:"database.viewSettings.githubConfigTab.preview.dismissButtonAriaLabel"},idPrefix:{defaultMessage:"TASK",id:"database.viewSettings.githubConfigTab.preview.idPrefix"},prTitle:{defaultMessage:"GitHub PR Title",id:"database.viewSettings.githubConfigTab.preview.prTitle"},open:{defaultMessage:"Open",id:"database.viewSettings.githubConfigTab.preview.open"},mergeInto:{defaultMessage:"Merge into",id:"database.viewSettings.githubConfigTab.preview.mergeInto"},main:{defaultMessage:"main",id:"database.viewSettings.githubConfigTab.preview.main"}})},96525:(e,t,o)=>{o.d(t,{Z:()=>g});var r=o(10434),i=o.n(r),n=o(96486),s=o.n(n),a=o(67294),l=o(83355),p=o(39500),d=o(25464),c=o(61766),u=o(44532);class h extends l.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:c.Z},this.renderPopup=()=>this.props.render({close:this.handleClose}),this.handleButtonClick=e=>{const{buttonPopupStore:t}=this.stores;this.props.stopClickPropagation&&(null==e||e.stopPropagation()),e&&p.uG(e)||(this.props.onClick&&this.props.onClick(e),this.props.disablePopup||t.setState({...t.state,open:!0}))},this.handleClose=()=>{this.props.onClose&&this.props.onClose(),this.props.persistOnClose||this.stores.buttonPopupStore.reset()}}willUnmount(){this.stores.buttonPopupStore.setState({open:!1})}renderComponent(){const{buttonPopupStore:e}=this.stores,t={...this.props,onClick:this.props.disabled?s().identity:this.handleButtonClick};return a.createElement(u.ZP,i()({},this.props,{forceInitialInbound:Boolean(this.props.forceInitialInbound),render:this.renderPopup,open:e.state.open,onDismiss:this.handleClose,origin:this.props.renderOrigin(t),originGap:this.props.originGap,borderRadius:this.props.borderRadius,popupWrapStyle:this.props.popupWrapStyle}))}}h.displayName="ButtonPopupMenuItem",h.Alignment=d.v,h.Placement=d.u,h.PopupType=u.kQ;const g=h},72589:(e,t,o)=>{o.d(t,{Z:()=>I});var r=o(23174),i=o.n(r),n=o(67294),s=o(81954),a=o(24405),l=o(35011),p=o(84619),d=o(84116),c=o(42875),u=o(66673),h=o(55384),g=o(74446),m=o(68626),y=o(82990),f=o(33929),S=o(87279),v=o(79315),b=o(19629),P=o(64887),M=o(8606),w=o(53876),C=o(78140),Z=o(28405);function I(e){var t,o,r;window.__c={n:"CollectionFormulaEditor"};const{property:a,disabled:p,formulas:c,getRecordValue:y,propertySchema:f,collectionStore:b,handleSave:P,handleClose:M,blockStore:w}=e,[I,T]=(0,n.useState)(null==f||null===(t=f.formula2)||void 0===t?void 0:t.code),R=(0,u.Kt)(I,200,Object.is),x=(0,n.useRef)(I),A=(0,n.useRef)(null==f||null===(o=f.formula2)||void 0===o?void 0:o.result_type),F=(0,n.useCallback)((e=>{x.current=e,T(e)}),[]),E=(0,n.useCallback)((e=>{A.current=e}),[]);(0,n.useEffect)((()=>()=>{const e=x.current,t=A.current;P({newValue:e,newType:(0,l.x9)(t??{type:"unknown"}),propertySchema:f,collectionStore:b,property:a})}),[]);const B=(0,s.VK)((()=>b.pointer),[b.pointer]),O=(0,n.useMemo)((()=>{const e={type:"block",collection:B};return{kind:d.yp.ThisRow,type:e}}),[B]),Y=(0,n.useMemo)((()=>{const e=g.zF.fromGetRecordValueFn(y);return{sourceProperty:a,valueTypes:[O],handleDataRequest:c.createFormulaDataRequestHandler(y,e)}}),[c,y,a,O]),z=(0,s.VK)((()=>{if("v2"!==f.version&&f.formula)return c.convertCollectionFormulaToFormula2(f.formula,B,b.getSchema())}),[B,b,c,f.formula,f.version]);(0,n.useEffect)((()=>{!async function(){if(!z)return;const e=await c.analyzeFormula(z,Y);let t;t=m.x.isFail(e)?{type:"unknown"}:e.value.type??{type:"unknown"},F(z),E(t)}()}),[b,c,F,E,a,f,z,Y]);const L=(0,n.useMemo)((()=>{var e;return"v2"===f.version?null===(e=f.formula2)||void 0===e?void 0:e.code:z}),[null===(r=f.formula2)||void 0===r?void 0:r.code,f.version,z]),_=(0,s.VK)((()=>{var e;return null===(e=v.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]);if(!Y||!_)return null;const V=w&&!(null==R||!R.length);return i()(C.Z,{menuType:S.og.Popup,maxHeight:"60vh",width:720,height:380,disableHeaderBorder:!0,disableScroller:!0},void 0,i()(Z.Z,{initialCode:L??[],outputFooter:V&&i()(k,{blockStore:w,collectionStore:b,currentCode:R,formulaSchema:f}),formulas:c,getRecordModel:h.om.fromGetRecordValueFn(y),focus:!0,disabled:p,parentSpaceId:_,typecheckContext:Y,onCodeChange:F,onTypeChange:E,handleClose:M,parentCollection:b,evaluationErrors:[]}))}const k=n.memo((e=>{let{currentCode:t,blockStore:o,collectionStore:r,formulaSchema:d}=e;window.__c={n:"FormulaOutputFooter"};const u=(0,s.VK)((()=>{const e=o.getModel(),i=r.getModel();if(i&&e&&i&&t)return(0,l.NM)({block:e,formulaCode:t,getRecordModel:o.getRecordModel,intl:f.default.getIntl(),userTimeZone:(0,c.r)(),depth:0,visitedProperties:new Set})}),[o,r,t]),[h,g]=(0,s.VK)((()=>{var e;if(!u||"undefined"===u.type)return[null,"text"];const t=(0,P.$I)(u,o.getRecordModel,(0,c.r)());return[t,(null===(e=t[0])||void 0===e?void 0:e.type)??"text"]}),[o.getRecordModel,u]),m=(0,s.VK)((()=>{if(null==h||!h.length)return[];const e=(0,b.vQ)(g,d);return i()(b.E1,{propertyType:g,rootPropertySchema:d,numberRightAlign:!1},void 0,h.map(((t,r)=>i()(b.gZ,{token:t,targetPropertySchema:d,blockStore:o,withComma:e&&r<h.length-1,numberRightAlign:!1},`${t.id}-${r}`))))}),[o,d,h,g]),S=(0,a.yK)((e=>({output:{display:"flex",alignItems:"center",zIndex:1,fontSize:y.Z.fontSize.UISmall.desktop,padding:"10px 12px",height:38,minHeight:38,width:"100%",borderTop:`1px solid ${e.outlineButtonBorder}`,position:"sticky",bottom:0,left:0,overflow:"hidden"},equals:{marginRight:6}})),[]),v=(0,n.useMemo)((()=>({baseStyles:{sizing:"small",tokenFormat:p.l.Small,textStyle:{overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap"},tokenWrapStyle:{display:"flex",flexWrap:"nowrap",...w.RQ[p.l.Medium]}},store:o,isEmpty:!1,isReadOnly:!0,shouldRenderTooltip:!1,shouldWrap:!1,collectionContextStore:void 0,propertySchema:d,trackEditBlockProperty:()=>{},format:0,containerRef:null})),[o,d]);return null===h?null:i()(M.O.Provider,{value:v},void 0,i()("div",{style:S.output},void 0,i()("span",{style:S.equals},void 0,"="),m))}))},5385:(e,t,o)=>{o.d(t,{x:()=>i});var r=o(79315);function i(){var e;return null===(e=r.default.state)||void 0===e||null===(e=e.currentUserSettingsStore)||void 0===e||null===(e=e.getSettings())||void 0===e?void 0:e.icon_picker_color}},12205:(e,t,o)=>{o.d(t,{J:()=>n});var r=o(81954),i=o(79315);function n(){const{currentSpaceStore:e}=(0,r.Kw)(i.default);return(0,r.VK)((()=>(null==e?void 0:e.canAdmin())??!1),[e])}},4391:(e,t,o)=>{o.d(t,{Z:()=>n});var r=o(49085);class i extends r.default{getInitialState(){return{allIcons:{},recentIcons:[],loadIconCount:0}}}const n=i},11843:(e,t,o)=>{o.d(t,{S:()=>i,E:()=>n});const r={"de-DE":{time:{"12h":"LT","24h":"H:mm"},month:"MMMM YYYY"},"da-DK":{time:{"12h":"LT","24h":"H:mm"},month:"MMMM YYYY"},"fi-FI":{time:{"12h":"LT","24h":"H:mm"},month:"MMMM YYYY"},"nb-NO":{time:{"12h":"LT","24h":"H:mm"},month:"MMMM YYYY"},"nl-NL":{time:{"12h":"LT","24h":"H:mm"},month:"MMMM YYYY"},"sv-SE":{time:{"12h":"LT","24h":"H:mm"},month:"MMMM YYYY"},"en-US":{time:{"12h":"LT","24h":"H:mm"},month:"MMMM YYYY"},"es-ES":{time:{"12h":"LT","24h":"H:mm"},month:"MMMM YYYY"},"es-LA":{time:{"12h":"LT","24h":"H:mm"},month:"MMMM YYYY"},"fr-FR":{time:{"12h":"LT","24h":"H:mm"},month:"MMMM YYYY"},"pt-BR":{time:{"12h":"LT","24h":"H:mm"},month:"MMMM YYYY"},"ko-KR":{time:{"12h":"LT","24h":"H:mm"},month:"YYYY[년] MMMM"},"zh-CN":{time:{"12h":"LT","24h":"H:mm"},month:"YYYY[年]MMM"},"zh-TW":{time:{"12h":"LT","24h":"H:mm"},month:"YYYY[年]MMM"},"ja-JP":{time:{"12h":"A h:mm","24h":"H:mm"},month:"YYYY[年]MMM"},pseudo:{time:{"12h":"A h:mm","24h":"H:mm"},month:"MMMM YYYY"}},i=["de-DE","fr-FR"],n=e=>r[e]}}]);