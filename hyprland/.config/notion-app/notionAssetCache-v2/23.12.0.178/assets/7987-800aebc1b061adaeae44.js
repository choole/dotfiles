"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[7987],{89074:(e,t,n)=>{n.d(t,{ZP:()=>R,N_:()=>P});var a=n(23174),o=n.n(a),r=n(10434),c=n.n(r),i=(n(57658),n(52262),n(24506),n(96486)),l=n.n(i),s=n(67294),u=n(480),h=n(81954),d=n(24405),m=n(41892),g=n(53397),f=n(68626),p=n(5500),k=n(97880),w=n(5366),S=n(54642),C=n(77719),y=n(33929),v=n(18441),N=n(79315),Z=n(30874),b=n(49085),I=n(88108);class F extends b.default{getStateForBot(e){return this.state[e]??{channels:{},fetching:!1,lastRefreshed:0}}updateStateForBot(e,t){this.setState({...this.state,[e]:{...this.getStateForBot(e),...t}})}addChannelsForBot(e,t){const n=this.getStateForBot(e);this.setState({...this.state,[e]:{...n,channels:{...n.channels,...t}}})}}const L=new F;(0,I.exposeDebugValue)("ExternalNotificationChannelsStore",L);const x=L;var A=n(52275),E=n(68894),B=n(68785),M=n(72495),_=n(33411);const V=(0,w.defineMessages)({channelSearchPlaceholder:{id:"notificationRuleSettings.selectChannelView.searchInput.placeholder",defaultMessage:"Search…"}});function R(e){window.__c={n:"SlackSelectChannelView"};const{currentNotificationChannel:t,onNotificationChannelSelect:n,onClose:a,onNewSlackAccountAdded:r,renderMenu:i,channelFilter:b}=e,I=(0,u.O7)(),{isMobile:F}=(0,u.Fy)(),L=(0,h.VK)((()=>Z.Z.completeSlackAuthentications.state),[]),R=e.currentExternalAuthentication??l().first(L);s.useEffect((()=>{R&&async function(e){const{environment:t,botId:n,spaceId:a}=e,o=x.getStateForBot(n);if(o.fetching||Date.now()-o.lastRefreshed<15e3)return;let r;x.updateStateForBot(n,{fetching:!0,lastRefreshed:Date.now()});for(;;){const e=await S.getExternalNotificationChannels(t,{botId:n,spaceId:a,cursor:r});if("success"!==e.type){console.error(e.error);break}{const t={};for(const n of e.data.channels)t[n.id]=n;if(x.addChannelsForBot(n,t),r=e.data.cursor,!r)break}}x.updateStateForBot(n,{fetching:!1})}({environment:I,botId:R.id,spaceId:R.space_id})}),[I,R]);const[O,j]=s.useState(""),{loadedChannelsForAccount:z,isLoading:W}=(0,h.VK)((()=>{if(!R)return{loadedChannelsForAccount:[],isLoading:!1};const e=x.getStateForBot(R.id);return{loadedChannelsForAccount:Object.values(e.channels),isLoading:e.fetching}}),[R]),q=(0,h.VK)((()=>Z.Z.integrations.state.find((e=>e.id===p.nO))),[]),D=(0,h.VK)((()=>{var e;return null===(e=N.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),$=s.useCallback((e=>{R&&n(e,R),a()}),[n,R,a]),J=(0,d.yK)((e=>({icon:{marginLeft:8,width:12,height:12,color:e.lightTextColor},container:{backgroundColor:e.popoverBackground,marginTop:12,marginBottom:6},searchIcon:{width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,color:e.regularIconColor}})),[]),T=s.useCallback((e=>{const{channel:n}=e;return{key:n.id,render:e=>s.createElement(A.Z,c()({},e,{icon:P({channel:n,styles:J.icon}),desktopIconStyle:{width:8},title:n.name,right:n.id===(null==t?void 0:t.id)&&g.Z.check(J.icon)})),action:()=>{$(n)}}}),[$,J.icon,t]),{publicChannels:Y,privateChannels:G,personalChannels:H}=s.useMemo((()=>function(e,t){const n=[],a=[],o=[];for(const r of e)t&&!t(r)||("public"===r.type?n.push(r):"private"===r.type?a.push(r):"me"===r.type?o.push(r):(0,k.t1)(r.type));return{publicChannels:n,privateChannels:a,personalChannels:o}}(z,b)),[b,z]),U=s.useCallback((()=>Y.map((e=>({menuListItem:T({channel:e}),channelName:e.name})))),[Y,T]),Q=s.useCallback((()=>G.map((e=>({menuListItem:T({channel:e}),channelName:e.name})))),[G,T]),X=s.useCallback((()=>H.map((e=>({menuListItem:T({channel:e}),channelName:e.name})))),[H,T]),ee=s.useCallback((()=>U().map((e=>{let{menuListItem:t,channelName:n}=e;if(K({channelName:n,query:O}))return t})).filter(k.$K)),[U,O]),te=s.useCallback((()=>Q().map((e=>{let{menuListItem:t,channelName:n}=e;if(K({channelName:n,query:O}))return t})).filter(k.$K)),[Q,O]),ne=s.useCallback((()=>X().map((e=>{let{menuListItem:t,channelName:n}=e;if(K({channelName:n,query:O}))return t})).filter(k.$K)),[X,O]),ae=s.useCallback((()=>{if(!R)return[];const e=[],t=ee(),n=te(),a=ne();return a.length>0&&e.push({key:"personal-channels",render:e=>s.createElement(M.Z,c()({},e,{title:(0,v.jg)(R).organizationName})),items:a}),t.length>0&&e.push({key:"public-channels",render:e=>s.createElement(M.Z,c()({},e,{topBorder:a.length>0,title:0===a.length&&(0,v.jg)(R).organizationName})),items:t}),n.length>0&&e.push({key:"private-channels",render:e=>s.createElement(M.Z,c()({},e,{topBorder:t.length>0,title:0===a.length&&t.length>0&&(0,v.jg)(R).organizationName})),items:n}),e}),[ee,te,ne,R]);if(!R||!q)return null;const oe=[{key:"search-input-section",items:[{key:"search-input-item",action:()=>{},render:e=>o()("div",{},void 0,s.createElement(E.ZP,c()({},e,{inputLeft:o()(E.f_,{icon:g.Z.search}),inputRight:o()(_.Z,{show:W,showDelay:500,showHold:300,render:e=>e&&o()(B.Z,{style:{marginRight:2}})}),showClearButton:!0,placeholder:y.default.formatMessage(V.channelSearchPlaceholder),focusInitial:!F,value:O,onChange:e=>{j(e.target.value)}})))}],render:e=>s.createElement(M.Z,e)},...ae()];return t||oe.push({key:"add-another-slack-account-section",items:[{key:"add-another-slack-account-item",action:async()=>{if(!D)return;const e=await C.hM({environment:I,integration:q,spaceId:D,from:"collection_view_settings"});f.x.isFail(e)||r()},render:e=>s.createElement(A.Z,c()({},e,{icon:o()("img",{src:m.Z.images.externalIntegrations.slackIconPng,style:{width:18,height:"auto"}}),title:o()(w.FormattedMessage,{id:"notificationRuleSettings.selectChannelView.setupAnotherSlackAccount.label",defaultMessage:"Add another Slack account"})}))}],render:e=>s.createElement(M.Z,c()({},e,{topBorder:!0}))}),s.createElement(s.Fragment,null,i(oe))}function K(e){const{channelName:t,query:n}=e;return 0===n.length||t.toLocaleLowerCase().indexOf(n.trim().toLocaleLowerCase())>=0}function P(e){const{channel:t,styles:n}=e;return"private"===t.type?g.Z.locked(n):"me"===t.type?g.Z.at(n):g.Z.typesNumber(n)}},93364:(e,t,n)=>{n.d(t,{U:()=>b});var a=n(10434),o=n.n(a),r=n(23174),c=n.n(r),i=(n(30541),n(57658),n(67294)),l=n(480),s=n(81954),u=n(24405),h=n(41892),d=n(53397),m=n(5366),g=n(68626),f=n(5500),p=n(77719),k=n(33929),w=n(18441),S=n(79315),C=n(30874),y=n(52275),v=n(68894),N=n(72495);const Z=(0,m.defineMessages)({workspaceSearchPlaceholder:{id:"notificationRuleSettings.selectWorkspaceView.searchInput.placeholder",defaultMessage:"Search…"}});function b(e){window.__c={n:"SlackSelectWorkspaceView"};const{onWorkspaceSelect:t,renderMenu:n,workspaceFilter:a,onNewSlackAccountAdded:r}=e,b=(0,l.O7)(),{isMobile:I}=(0,l.Fy)(),F=(0,s.VK)((()=>{var e;return null===(e=S.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),L=(0,s.VK)((()=>(0,w.P9)(C.Z.completeSlackAuthentications.state,a)),[a]),x=(0,s.VK)((()=>C.Z.integrations.state.find((e=>e.id===f.nO))),[]),[A,E]=i.useState(""),B=(0,u.yK)((e=>({chevronRight:{width:12,height:"auto",color:e.lightIconColor}})),[]);if(!x)return null;const M=Object.entries((0,w.YJ)(L,A)).map(((e,n)=>{let[a,r]=e;return{key:a,items:r.map((e=>{let{workspaceName:n,externalAuthentication:a}=e;return{key:a.id,action:()=>{t(a)},render:e=>i.createElement(y.Z,o()({},e,{title:n??c()(m.FormattedMessage,{id:"notificationRuleSettings.selectWorkspace.untitledWorkspace",defaultMessage:"Slack workspace"}),right:d.Z.chevronRight(B.chevronRight)}))}})),render:e=>i.createElement(N.Z,o()({},e,{title:a,topBorder:0!==n}))}}));return M.unshift({key:"search-input-section",items:[{key:"search-input-item",action:()=>{},render:e=>c()("div",{},void 0,i.createElement(v.ZP,o()({},e,{inputLeft:c()(v.f_,{icon:d.Z.search}),showClearButton:!0,placeholder:k.default.formatMessage(Z.workspaceSearchPlaceholder),focus:!I||void 0,value:A,onChange:e=>{E(e.target.value)}})))}],render:e=>i.createElement(N.Z,e)}),M.push({key:"add-another-slack-account-section",items:[{key:"add-another-slack-account-item",action:async()=>{if(!F)return;const e=await p.hM({environment:b,integration:x,spaceId:F,from:"collection_view_settings"});g.x.isFail(e)||e.value.externalAuthentication&&(t(e.value.externalAuthentication),null==r||r())},render:e=>i.createElement(y.Z,o()({},e,{icon:c()("img",{src:h.Z.images.externalIntegrations.slackIconPng,style:{width:18,height:"auto"}}),title:c()(m.FormattedMessage,{id:"notificationRuleSettings.selectWorkspaceView.setupAnotherSlackAccount.label",defaultMessage:"Add another Slack account"})}))}],render:e=>i.createElement(N.Z,o()({},e,{topBorder:!0}))}),i.createElement(i.Fragment,null,n(M))}},18441:(e,t,n)=>{n.d(t,{jg:()=>c,jc:()=>i,P9:()=>l,YJ:()=>s});n(57658);var a=n(55384),o=n(32161),r=n(5500);function c(e){if(e.integration_id!==r.nO)throw"Cannot render account for integration.";const t=/(.+) - (.+)/.exec(e.account_name);if(!t)return{accountName:e.account_name};const[,n,a]=t;return{organizationName:n,accountName:a}}function i(e){return a.kk.fromValue(o.P,e).getSlackWorkspaceId()}function l(e,t){return t?e.filter((e=>{const n=i(e);return!!n&&t(n)})):e}function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n={};for(const a of e){const{accountName:e,organizationName:o}=c(a);u({query:t,accountName:e,organizationName:o})&&(n[e]||(n[e]=[]),n[e].push({externalAuthentication:a,workspaceName:o}))}return n}function u(e){const{accountName:t,organizationName:n,query:a}=e;if(0===a.length)return!0;const o=t.toLocaleLowerCase().indexOf(a.trim().toLocaleLowerCase())>=0,r=!!n&&n.toLocaleLowerCase().indexOf(a.trim().toLocaleLowerCase())>=0;return o||r}}}]);