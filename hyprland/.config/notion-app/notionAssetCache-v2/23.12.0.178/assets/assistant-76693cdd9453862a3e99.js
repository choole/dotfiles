"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[8721],{9995:(e,t,i)=>{i.r(t),i.d(t,{AssistantButton:()=>Ye,AssistantChatStep:()=>a.H,AssistantLabelerBar:()=>R,TopbarAssistantButton:()=>H,UpdateSidebarTabAssistant:()=>j.m,assistantActions:()=>n});var n=i(37507),a=i(54749),o=i(10434),r=i.n(o),l=i(23174),s=i.n(l),c=i(96486),d=i.n(c),u=i(67294),p=i(480),m=i(81954),v=i(24405),g=i(94568),f=i(42875),h=i(59054),y=i(21202),S=i(70203),k=i(82990),w=i(54642),b=i(98104),C=i(52275),x=i(88359),I=i(1743),Z=i(74194),V=i(84076),_=i(68785),E=i(63296),T=i(44532),A=i(14871),B=i(95477),P=i(5737),K=i(82375),L=i(68216),F=i(24666);function R(){window.__c={n:"AssistantLabelerBar"};const e=(0,p.O7)(),t=(0,v.yK)((e=>({wrap:{padding:8,backgroundColor:e.contentBackground,width:400},samplingPicker:{display:"flex",alignItems:"center",marginBottom:8,gap:4},error:{fontSize:14,color:e.accentColors.red[600],maxHeight:150,overflow:"scroll"},observation:{fontSize:14,maxHeight:150,overflow:"scroll"},tooltip:{width:500,whiteSpace:"pre-wrap",fontFamily:k.Z.baseFontFamily.mono},input:{marginTop:5,marginBottom:5,fontFamily:k.Z.baseFontFamily.githubMono,fontSize:12},inputInner:{height:100}})),[]),i=(0,m.VK)((()=>K.Hl.state),[]),a=(0,m.VK)((()=>K.XN.state),[]),o=(0,m.VK)((()=>P.N.state),[]),r=(0,m.VK)((()=>Boolean(a&&a.sampledSteps.length>0)),[a]),l=(0,m.VK)((()=>Boolean(o&&(o.sampling||o.evaluating))),[o]),c=(0,m.VK)((()=>null==a?void 0:a.previewingStepIndex),[a]),d=(0,m.VK)((()=>{const e=null==a?void 0:a.previewingStepIndex;var t;if("number"==typeof e)return null==a||null===(t=a.sampledSteps)||void 0===t?void 0:t[e]}),[a],{useDeepEqual:!0}),g=(0,m.VK)((()=>(null==a?void 0:a.previewingStepObservations)||[]),[a],{useDeepEqual:!0}),f=g.filter((e=>"error"===e.observationType)),h=g.filter((e=>"error"!==e.observationType)),y=(0,u.useCallback)((()=>{n.cancelPreviewStep()}),[]),S=(0,u.useCallback)((async t=>{if(!d||!a)return;const i={...d,value:t.target.value};(0,K.zZ)({store:K.XN,step:i}),await n.simulateOrCommitStep({environment:e,step:i,commit:!1,isStreaming:!1,preventSelection:!0})}),[e,d,a]),w=(0,u.useCallback)((async t=>{a&&await n.simulateOrCommitStep({environment:e,step:a.sampledSteps[t],commit:!1,isStreaming:!1})}),[e,a]),C=(0,u.useCallback)((async()=>{if(!a)return;const t=a.previewingStepObservations.length>0;await n.commitPreviewAssistantStep({environment:e}),t||await n.applyUncommittedOperations({environment:e})}),[e,a]),x=(0,u.useCallback)((async()=>{await n.retryNextAssistantSteps({environment:e})}),[e]),V=(0,m.VK)((()=>({top:20,left:0,right:0,bottom:0,width:e.WindowSizeStore.state.width,height:0})),[e],{useDeepEqual:!0}),[A,L]=(0,u.useState)(!1),R=(0,u.useCallback)((()=>{F.default.hasSelection()&&b.ZH(e),L(!0)}),[e,L]),W=(0,u.useCallback)((()=>{L(!1)}),[L]),z=B.default.isLocalhost||!1;return s()(T.ZP,{popupType:T.kQ.Popup,open:!0,originRect:V,originGap:6,disableMouseCapture:!0,render:()=>s()(I.Z,{capture:A},void 0,s()("div",{style:t.wrap},void 0,s()(M,{}),r&&u.createElement(u.Fragment,null,s()("div",{style:t.samplingPicker},void 0,s()(E.Z,{hovered:void 0===c||void 0,onClick:y},void 0,"Original"),s()(E.Z,{hovered:0===c||void 0,onClick:()=>w(0)},void 0,"A"),s()(E.Z,{hovered:1===c||void 0,onClick:()=>w(1)},void 0,"B"),s()("div",{style:{flexGrow:1}}),l&&s()(_.Z,{style:{marginRight:4}}),s()(E.Z,{disabled:!z&&(void 0===c||l||!i),disabledFeedback:!0,onClick:x},void 0,"Retry"),s()(E.Z,{disabled:!z&&(void 0===c||l||!i),disabledFeedback:!0,onClick:C,isBlue:!0},void 0,"Accept")),d&&s()(Z.Z,{style:t.input,inputStyle:t.inputInner,value:d.value,onChange:S,onFocus:R,onBlur:W,textarea:!0,spellCheck:!1}),f.length>0&&!l&&s()("div",{style:t.error},void 0,f.map((e=>e.value)).join("\n")),h.length>0&&!l&&s()("div",{style:t.observation},void 0,"Results: ",h.map((e=>e.value)).join("\n")))))})}function M(e){var t;window.__c={n:"TaskPicker"};const i=(0,p.O7)(),n=(0,m.VK)((()=>K.Hl.state),[]),[a]=(0,h.r5)((async()=>{const e="results",t={type:"reducer",filter:{operator:"and",filters:[{property:"ouFf",filter:{operator:"status_is",value:{type:"is_group",value:"In progress"}}}]},sort:[],userId:i.currentUser.id,userTimeZone:(0,f.r)(),searchQuery:void 0,reducers:{[e]:{type:"results",limit:100}}},n=await w.queryCollection(i,{source:{type:"collection",id:"f704a995-6417-457a-8038-ca9e1cb2c65f",spaceId:g.vj},collectionView:{id:"1dee420b-aa96-4e48-8eba-c2a0613e179e",spaceId:g.vj},loader:t},void 0,{src:"queryCollectionAction"});if("failed"===n.type)return;const a=n.data.result.reducerResults.results;if(!a||"results"!==a.type)return;const{blockIds:o}=a;let r=d().compact(o.map((e=>new L.G(i,{table:y.iU,id:e}).getValue()))).map((e=>{var t,i,n;return{id:e.id,name:(0,S.Q)(null==e||null===(t=e.properties)||void 0===t?void 0:t.title),url:(0,S.Q)(null==e||null===(i=e.properties)||void 0===i?void 0:i["}v_K"]),type:(0,S.Q)(null==e||null===(n=e.properties)||void 0===n?void 0:n.pdfW)}}));return r=d().sortBy(r,(e=>e.name.toLowerCase())),r}),[i]),o=(0,u.useCallback)((e=>{var t;const i=null===(t=a.value)||void 0===t?void 0:t.find((t=>t.id===e));i&&K.Hl.setState(i)}),[a]),l={menuTitle:"",items:(null===(t=a.value)||void 0===t?void 0:t.map((e=>e.id)))??[],getKey:e=>e,selectedItem:null==n?void 0:n.id,onSelect:o,renderItem:e=>{var t;const i=null===(t=a.value)||void 0===t?void 0:t.find((t=>t.id===e.value));return u.createElement(C.Z,r()({},e,{title:null==i?void 0:i.name}))},renderOrigin:e=>u.createElement(x.Z,r()({focused:!1,title:"",right:(null==n?void 0:n.name)||s()("span",{style:{color:"red"}},void 0,"Please select a task")},e)),width:300},c=(0,v.yK)((e=>({wrap:{marginBottom:8},inner:{display:"flex",alignItems:"center",marginBottom:4,gap:4},label:{fontSize:14,flexShrink:0},link:{fontSize:14,textDecoration:"underline"}})),[]);return s()("div",{style:c.wrap},void 0,s()("div",{style:c.inner},void 0,s()("div",{style:c.label},void 0,"Current task:"),u.createElement(A.Z,l)),n&&s()(V.Z,{style:c.link,href:n.url,external:!0},void 0,"Instructions for task"))}var W=i(53397),z=i(74647),D=i(73063),O=i(43250),N=i(34700),q=i(45094),U=i(7011);function H(e){window.__c={n:"TopbarAssistantButton"};const{blockStore:t}=e,i=(0,p.O7)(),{isElectronMac:n}=i.device,a=(0,v.yK)((e=>({icon:{height:20,width:20,fill:e.aiPurpleColor},button:{...(0,N.X)(n,!1),width:33,height:28,marginRight:2}})),[n]),o=(0,u.useCallback)((()=>{z.handleSidebarButtonClick(i,t,U.gY.Assistant,"topbar")}),[i,t]),r=(0,m.VK)((()=>(0,q.Sx)(i)&&U.ZP.state.currentTab===U.gY.Assistant),[i]);return s()(D.Z,{icon:W.Z.sparkles,iconStyle:a.icon,style:a.button,ariaLabel:"Assistant",className:O.N27,onClick:o,hovered:r})}var j=i(24908),G=i(41892),Q=i(55031),Y=i(64921),J=i(31945),$=(i(21703),i(31299)),X=i(10052),ee=i(89728),te=i(72495),ie=i(99417),ne=i(77907),ae=i(79315),oe=i(49085),re=i(88108);class le extends oe.default{getInitialState(){return{currentView:"chat"}}}const se=new le;function ce(e){se.setState({...se.state,currentView:e.view})}(0,re.exposeDebugValue)("AssistantMenuStore",se);var de=i(41432),ue=i(91644),pe=i(19889),me=i(9953);class ve extends oe.default{getInitialState(){return{serverSkillIds:new Set,locallyCreatedSkillIds:new Set}}getSkillIds(){return Array.from(new Set([...this.state.serverSkillIds,...this.state.locallyCreatedSkillIds]))}addLocallyCreatedSkillId(e){this.state.locallyCreatedSkillIds.add(e),this.emit()}}const ge=new ve;async function fe(e){const{environment:t,clientSkill:i}=e,a=K.Pl.state,o=Boolean(a),r=(0,ie.lN)();ce({view:"chat"}),await(0,n.resetAssistantStore)({environment:t,isLabelerSlackMode:o,isQnA:r,fakeSlackChannel:null==a?void 0:a.selectedFakeChannel,clientSkill:i}),i.contextSettings.requiresInput||await(0,n.sampleNextAssistantSteps)({environment:t})}(0,re.exposeDebugValue)("AssistantSkillsStore",ge);var he=i(47307),ye=i(24677),Se=i(993),ke=i(12359),we=i(18647),be=i(17809),Ce=i(34859),xe=(i(57658),i(20518)),Ie=i(5366);function Ze(){const{currentSpaceStore:e}=ae.default.state;if(!e)return[];const t=[];for(const n of Object.values(xe.n))n.globalContextSettings&&t.push({key:n.type,type:"global",skillType:n.type,contextSettings:n.globalContextSettings});const i=ge.getSkillIds();for(const n of i){const i=L.Vf.createChildStore(e,{table:ue.A,id:n,spaceId:e.id}),a=i.getValue();if(a&&a.alive){const e=xe.n[a.type];e.getPersistedContextSettings&&t.push({key:n,type:"persisted",skillType:a.type,skillStore:i,contextSettings:e.getPersistedContextSettings({settings:a.settings||{}})})}}return t}const Ve=(0,Ie.defineMessages)({summarize:{defaultMessage:"Summarize",id:"skills.summarize"},custom:{defaultMessage:"Custom skill",id:"skills.custom"}}),_e={summarize:Ve.summarize,custom:Ve.custom},Ee={summarize:W.Z.assistSummarize,custom:W.Z.magicWand};var Te=i(2405),Ae=i(82476),Be=i(67593);function Pe(e){window.__c={n:"AssistantSkillName"};const{clientSkill:t}=e,i=(0,Ie.useIntl)(),n=(0,m.VK)((()=>{if("persisted"===t.type){const e=t.skillStore.getValue();if("custom"===(null==e?void 0:e.type)&&e.settings.name)return e.settings.name}return i.formatMessage(_e[t.skillType])}),[t,i]);return u.createElement(u.Fragment,null,n)}function Ke(e){var t;window.__c={n:"AssistantChat"};const{store:i}=e,o=(0,u.useRef)(void 0),r=(0,m.VK)((()=>i.state),[i]),l=(0,m.VK)((()=>P.N.state),[]),d=(0,p.O7)(),g=(0,m.VK)((()=>Ze()),[]),f=(0,m.VK)((()=>ae.default.state.mainEditorCurrentBlockStore),[]),h=(0,m.VK)((()=>ae.default.state.currentSpaceStore),[]),y=(0,m.VK)((()=>(0,ie.lN)()),[]),w=void 0!==(null==r?void 0:r.clientSteps.find((e=>"human"===e.type))),C=(0,v.yK)((e=>({wrap:{display:"flex",flexDirection:"column",background:e.contentBackground,width:400,height:"max(40vh, 600px)"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",pointerEvents:"auto",paddingTop:8,paddingLeft:12,paddingRight:12},labeledInput:{display:"flex",gap:8,alignItems:"center"},reset:{color:e.mediumIconColor},toggleSlackMode:{color:e.mediumIconColor},closeButton:{borderRadius:"100%",marginLeft:4},input:{width:void 0,marginLeft:8,marginRight:8},scroller:{flexGrow:1,paddingTop:8,paddingBottom:8,paddingLeft:8,paddingRight:8,backgroundColor:e.contentBackground},samplesLabel:{fontSize:12,marginTop:8,marginBottom:8},inputLabel:{fontSize:14,color:e.mediumTextColor},previewLabel:{fontSize:12},editLink:{fontSize:14,color:e.mediumTextColor,textDecoration:"underline",paddingLeft:8,paddingRight:8},error:{fontSize:14,color:e.errorText},addCustomInstructionsIcon:{fill:e.aiPurpleColor},suggestionsLabel:{fontSize:12,color:e.mediumTextColor,marginTop:18,marginBottom:12},emptyStateIntro:{marginLeft:18,marginRight:18},faceImgWrap:{width:64,height:64,borderRadius:"100%",background:"white",boxShadow:e.largeLightBoxShadow,overflow:"hidden"},faceImg:{width:64,pointerEvents:"none"},emptyStateText:{marginTop:28,fontSize:16,color:e.regularTextColor,fontFamily:k.Z.baseFontFamily.serif},inputWrap:{paddingTop:8,paddingBottom:8},skillsCaption:{fontSize:12,color:e.mediumTextColor,marginBottom:8},skillIcon:{fill:e.aiPurpleColor},skillsWrap:{display:"flex",flexDirection:"row",flexWrap:"wrap",gap:8}})),[]),x=(0,m.VK)((()=>{var e;const t=null===(e=i.state)||void 0===e?void 0:e.previewingStepObservations.filter((e=>"observation"===e.type&&"error"===e.observationType));return null==t?void 0:t.map((e=>e.value)).join("\n")}),[i]),I=(0,m.VK)((()=>(0,ie.Gw)()),[]),Z=(0,m.VK)((()=>K.Pl.state),[]),V=Boolean(Z),_=(0,u.useCallback)((()=>{ce({view:"skillSwitcher"})}),[]),E=(0,u.useCallback)((async e=>{!V||null!=Z&&Z.selectedFakeUser?(i.state||await n.resetAssistantStore({environment:d,isLabelerSlackMode:V,isQnA:y,fakeSlackChannel:null==Z?void 0:Z.selectedFakeChannel}),i.state&&e&&n.commitHumanStep({environment:d,text:e,fakeUser:null==Z?void 0:Z.selectedFakeUser})):he.showErrorMessage("Please select a user to send the message as")}),[d,V,Z,y,i]),T=(0,u.useCallback)((async e=>{await fe({environment:d,clientSkill:e})}),[d]),{store:A}=(0,be.useMockTextStore)({initialValue:void 0,onChange:c.identity});return(0,u.useEffect)((()=>{ye.ZH({device:d.device}),b.N_({store:A}),null!=r&&r.primeTextInput&&(ke.createAndCommit({userAction:"assistant.primeTextFromSearch",environment:d,perform:e=>{Se.sO({environment:d,store:A,value:S.TP(r.primeTextInput),transaction:e})}}),n.clearPrimedText())}),[d,A,null==r?void 0:r.primeTextInput]),(0,u.useEffect)((()=>{o.current&&o.current.scrollToBottom(),ye.ZH({device:d.device}),b.N_({store:A})}),[null==r?void 0:r.clientSteps,A,d.device]),h&&f?u.createElement(u.Fragment,null,u.createElement(we.Z,{ref:o,type:Ce.Z.Y,style:C.scroller},!r&&!y&&s()("div",{style:C.emptyStateIntro},void 0,s()("div",{style:C.faceImgWrap},void 0,s()("img",{style:C.faceImg,src:G.Z.images.aiFaceLookleftPng})),s()("div",{style:C.emptyStateText},void 0,s()("p",{},void 0,"Hi! I'm Notion AI."),s()("p",{},void 0,"I can answer questions about this workspace, help you analyze and edit pages, and search and manipulate databases.")),g.length>0&&u.createElement(u.Fragment,null,s()("div",{style:C.skillsCaption},void 0,"Things to try"),s()("div",{style:C.skillsWrap},void 0,g.slice(0,10).map((e=>s()(Te.Z,{icon:Ee[e.skillType],iconStyle:C.skillIcon,onClick:async()=>{await T(e)},title:s()(Pe,{clientSkill:e})},e.key))),s()(Te.Z,{onClick:_,title:"More"})))),!y||w&&r?null:u.createElement(u.Fragment,null,s()(a.H,{clientStep:{type:"assistantChatText",text:"Hi! I'm Notion AI. I can search through your Notion workspace and answer questions based on what I find."},parentStore:h,parentSpaceId:h.id})),null==r||null===(t=r.clientSteps)||void 0===t?void 0:t.map(((e,t)=>s()(a.H,{clientStep:e,parentStore:h,parentSpaceId:h.id,fakeSlackUser:"human"===e.type?e.fakeUser:void 0},t))),(null==r?void 0:r.temporaryClientSteps)&&r.temporaryClientSteps.map(((e,t)=>s()(a.H,{clientStep:e,parentStore:h,parentSpaceId:h.id},t))),l&&x&&!l.sampling&&!l.evaluating&&s()("div",{style:C.error},void 0,x),!I&&r&&l&&(r.temporaryClientSteps.length>0||x)&&!l.sampling&&!l.evaluating&&s()(Ae.y,{type:x?"error":Boolean(r.temporaryClientSteps.find((e=>"assistantTransaction"===e.type)))?"accept_action":"feedback"}),r&&l&&(l.sampling||l.evaluating)&&!r.temporaryClientSteps.find((e=>"assistantChat"===e.type||"assistantTransaction"===e.type))&&s()(a.H,{clientStep:{type:"assistantLoading"},parentStore:h,parentSpaceId:h.id})),s()("div",{style:C.inputWrap},void 0,s()(Be.H,{store:A,placeholder:y?"Ask a question…":"Ask for anything…",onSubmit:E}))):null}var Le=i(98114),Fe=i(61134),Re=i(68709),Me=i(17748),We=i(92628),ze=i(6148),De=i(12534);function Oe(e){window.__c={n:"EditSkillMenu"};const{clientSkill:t,onClose:i}=e,{skillStore:n}=t,a=(0,p.O7)(),o=(0,v.yK)((e=>({scroller:{maxHeight:"50vh"},skillIcon:{width:16,fill:e.aiPurpleColor,marginRight:4},rowWrap:{display:"flex",alignItems:"center",margin:"0 8px",gap:8,fontSize:14},listWrap:{background:e.contentBackground,boxShadow:e.inputBoxShadow,padding:"3px 9px",margin:"0 8px",borderRadius:5,minHeight:64,..."dark"===e.mode?{backgroundColor:e.inputBackground}:{},fontSize:14},emptyPlaceholder:{caretColor:e.mediumTextColor,color:e.lightTextColor,fontSize:14,padding:"5px 0",display:"inline-block"}})),[]),r=(0,m.VK)((()=>{const e=n.getValue();return"custom"===(null==e?void 0:e.type)&&e.settings.name||""}),[n]),l=(0,m.VK)((()=>{const e=n.getParentPointer();if(e)return L.G.createChildStore(n,e)}),[n]),[c,d]=u.useState(r),g=u.useCallback((e=>{const t=e.target.value;d(t),ke.createAndCommit({userAction:"EditSkillMenu.handleNameChange",environment:a,perform:e=>{!function(e){const{store:t,update:i,transaction:n}=e;me.sW({store:t.getSettingsStore(),data:i,transaction:n})}({store:n,update:{name:t},transaction:e})}})}),[n,a]),f=(0,m.VK)((()=>!n.canEdit()),[n]),h=(0,m.VK)((()=>{const{currentSpaceStore:e}=ae.default.state;if(!e)return;const t=n.getValue();return"custom"===(null==t?void 0:t.type)&&t.settings.instructions_block_id?L.G.createChildStore(e,{table:y.iU,id:t.settings.instructions_block_id,spaceId:e.id}):void 0}),[n]),S=(0,m.VK)((()=>{if(h)return h.getContentStore()}),[h]),k=(0,u.useCallback)((e=>{(0,De.ZP)({event:e,context:De.Af.EditorClick,callback:()=>{if(!S)return;(S.getValue()||[]).length>0||ke.createAndCommit({userAction:"EditSkillMenu.handleListClick",environment:a,perform:e=>{Le.Nj({environment:a,parentStore:S,transaction:e})}})}})}),[a,S]),w=(0,u.useCallback)((()=>{ke.createAndCommit({userAction:"EditSkillMenu.handleDelete",environment:a,perform:e=>{!function(e){const{store:t,transaction:i}=e;me.sW({store:t,data:{alive:!1},transaction:i})}({store:n,transaction:e})}}),i()}),[a,n,i]);return s()(we.Z,{type:Ce.Z.Y,style:o.scroller},void 0,s()(te.Z,{},void 0,s()("div",{style:o.rowWrap},void 0,s()(Z.Z,{value:c,onChange:g,placeholder:"Custom skill name"}),s()(ee.Z,{onClick:i,isBlue:!0},void 0,"Done"))),l&&s()(te.Z,{},void 0,s()("div",{style:o.rowWrap},void 0,s()("div",{},void 0,"From"),s()(ze.q,{navigableParentStore:l}))),S&&h&&s()(te.Z,{},void 0,s()(We.Z,{store:h,analyticsName:"duplicate_blocks_action",isListContainer:!0},void 0,s()(Re.p,{allowSelectionWithin:!0},void 0,s()("div",{style:o.listWrap,onClick:k,className:O.Wh_},void 0,s()(Fe.O,{displayName:"EditSkillMenuContent",disabled:f},void 0,s()(Me.Z,{disabled:f,store:S,emptyPlaceholder:s()("div",{style:o.emptyPlaceholder},void 0,s()(Ie.FormattedMessage,{id:"automations.EditSkillMenu.emptyPlaceholder",defaultMessage:"Click to edit instructions…"})),disableCommentMenu:!0,disableHoverMenu:!1,disableDrag:!1})))))),s()(te.Z,{},void 0,s()("div",{style:o.rowWrap},void 0,s()(ee.Z,{onClick:w,isRed:!0},void 0,"Delete"))))}function Ne(e){window.__c={n:"AssistantSkillPopup"};const{clientSkill:t,renderOrigin:i,buttonPopupStore:n}=e,a=(0,p.O7)(),o=(0,v.yK)((e=>({skillIcon:{width:16,fill:e.aiPurpleColor,marginRight:4},headerWrap:{display:"flex",alignItems:"center",margin:"0 4px"},editPopupWrap:{borderRadius:12,boxShadow:e.largeLightBoxShadow,width:392}})),[]);return s()(J.ZP,{popupType:a.device.isMobile?J.Z4.SlideUp:J.Z4.Popup,preventScaleTransition:!0,preventOpacityTransition:!0,popupWrapStyle:o.editPopupWrap,renderOrigin:i,render:e=>t&&s()(Oe,{clientSkill:t,onClose:e.close}),buttonPopupStore:n})}var qe=i(68894),Ue=i(32163),He=i(61766);function je(e){window.__c={n:"AssistantSkillSwitcher"};const t=(0,p.O7)(),i=(0,v.yK)((e=>({skillIcon:{width:16,fill:e.aiPurpleColor,marginRight:4},headerWrap:{display:"flex",alignItems:"center",margin:"0 4px"},editPopupWrap:{borderRadius:12,boxShadow:e.largeLightBoxShadow,width:392}})),[]),n=(0,m.VK)((()=>Ze()),[]),[a,o]=u.useState(""),l=u.useCallback((e=>{o(e.target.value)}),[]),[c,d]=u.useState(void 0),g=(0,m.qz)(void 0,He.Z),f=c?n.find((e=>"persisted"===e.type&&e.skillStore.id===c.id)):void 0,h=(0,u.useCallback)((()=>{const{performResult:e}=ke.createAndCommit({userAction:"AssistantSkillSwitcher.handleAddSkillClick",environment:t,perform:e=>function(e){const{environment:t,transaction:i}=e,{inMemoryRecordCache:n}=t.defaultRecordCache,a=t.currentUser.id,o=Date.now(),{currentSpaceStore:r,mainEditorCurrentBlockStore:l}=ae.default.state;if(!a)throw new Error("No current user.");if(!r)throw new Error("No current space.");if(!l)throw new Error("No current block.");const s=me.j4({environment:t,type:de.Ti.page,inMemoryRecordCache:n,transaction:i,spaceId:r.id}),c=me.ae({environment:t,table:ue.A,value:{type:"custom",settings:{instructions_block_id:s.id},parent_id:l.id,parent_table:y.iU,space_id:r.id,alive:!0,created_time:o,created_by_id:a,created_by_table:pe.KJ,last_edited_time:o,last_edited_by_id:a,last_edited_by_table:pe.KJ},inMemoryRecordCache:n,transaction:i});return me.sW({store:s,data:{parent_id:c.id,parent_table:ue.A,alive:!0},transaction:i}),ge.addLocallyCreatedSkillId(c.id),c}({environment:t,transaction:e})});d(e),g.setState({...g.state,open:!0})}),[t,g]),S=n.map((e=>({key:e.key,render:t=>"persisted"===e.type?s()(Ne,{clientSkill:e,renderOrigin:n=>u.createElement(C.Z,r()({},t,{title:s()(Pe,{clientSkill:e}),icon:Ee[e.skillType](i.skillIcon),right:"persisted"===e.type&&t.focused&&u.createElement(D.Z,r()({icon:W.Z.pencil,ariaLabel:"edit"},n))}))}):u.createElement(C.Z,r()({},t,{title:s()(Pe,{clientSkill:e}),icon:Ee[e.skillType](i.skillIcon)})),action:async()=>{await fe({environment:t,clientSkill:e})}})));return u.createElement(u.Fragment,null,s()(te.Z,{},void 0,s()(qe.ZP,{value:a,onChange:l,placeholder:"Search for a skill…",focusInitial:!0})),s()(te.Z,{},void 0,s()("div",{style:i.headerWrap},void 0,s()("div",{style:{flexGrow:1}}),s()(Ne,{clientSkill:f,renderOrigin:()=>s()(ee.Z,{onClick:h,isBlue:!0},void 0,"New skill"),buttonPopupStore:g})),s()(Ue.Z,{type:Ue.i.Vertical,initialFocus:0,sections:[{key:"dialog",render:e=>u.createElement(te.Z,r()({topBorder:!1,disableMobileBorders:!0},e)),items:S}]})))}function Ge(e){window.__c={n:"AssistantSkillSwitcherButton"};const{store:t}=e,i=(0,m.VK)((()=>t.state),[t]),n=(0,v.yK)((e=>({skillIcon:{fill:e.aiPurpleColor},chevronDown:{fill:e.mediumIconColor,width:12,marginLeft:4}})),[]),a=(0,u.useCallback)((()=>{ce({view:"skillSwitcher"})}),[]);if(null==i||!i.selectedSkill)return null;const{selectedSkill:o}=i;return s()(ee.Z,{onClick:a,icon:Ee[o.skillType],iconStyle:n.skillIcon},void 0,s()(Pe,{clientSkill:o}),W.Z.chevronDown(n.chevronDown))}function Qe(e){var t;window.__c={n:"AssistantMenu"};const{store:i,onClose:a}=e,o=(0,m.VK)((()=>i.state),[i]),l=(0,p.O7)(),c=(0,u.useCallback)((()=>{n.clearAssistantStores()}),[]),d=(0,u.useCallback)((()=>{var e;const t=(null===(e=i.state)||void 0===e?void 0:e.evaluator.getTranscript())??[];navigator.clipboard.writeText(JSON.stringify(t,null,2))}),[i]),g=(0,v.yK)((e=>({wrap:{display:"flex",flexDirection:"column",background:e.contentBackground,width:400,height:"max(40vh, 600px)"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",pointerEvents:"auto",paddingTop:8,paddingLeft:12,paddingRight:12},labeledInput:{display:"flex",gap:8,alignItems:"center"},headerButton:{color:e.mediumIconColor},closeButton:{borderRadius:"100%",marginLeft:6},input:{width:void 0,marginLeft:8,marginRight:8},inputLabel:{fontSize:14,color:e.mediumTextColor},faceImgWrap:{width:64,height:64,borderRadius:"100%",background:"white",boxShadow:e.largeLightBoxShadow,overflow:"hidden"},faceImg:{width:64,pointerEvents:"none"},emptyStateText:{marginTop:28,fontSize:16,color:e.regularTextColor,fontFamily:k.Z.baseFontFamily.serif},inputWrap:{paddingTop:8,paddingBottom:8},skillsCaption:{fontSize:12,color:e.mediumTextColor,marginBottom:8},skillIcon:{fill:e.aiPurpleColor},skillsWrap:{display:"flex",flexDirection:"row",flexWrap:"wrap",gap:8}})),[]),f=(0,m.VK)((()=>{var e;return null===(e=ae.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]);(0,h.r5)((async()=>{f&&await async function(e){const{environment:t,spaceId:i}=e,n=await w.getSkillsInSpace(t,{spaceId:i});if("success"!==n.type)throw new Error("Failed to fetch skills in space.");const{skillIds:a}=n.data;ge.setState({...ge.state,serverSkillIds:new Set(a)})}({environment:l,spaceId:f})}),[l,f]);const y=(0,m.VK)((()=>(0,ie.Gw)()),[]),S=(0,m.VK)((()=>se.state),[]),b=B.default.isLocalhost||!1,I=(0,m.VK)((()=>K.Pl.state),[]),Z=Boolean(I),V=(0,u.useCallback)((()=>{ce({view:"chat"})}),[]),_=(0,u.useCallback)((()=>{n.clearAssistantStores(),Z?K.Pl.setState(void 0):K.Pl.setState({enabled:!0,selectedFakeUser:void 0,selectedFakeChannel:"#"})}),[Z]),[E,T]=(0,u.useState)([]);return(0,u.useEffect)((()=>{Z&&$.Yu({environment:l,query:"",membersOnly:!1}).then((e=>T(e))).catch((e=>{throw new Error(e)}))}),[l,Z]),s()("div",{style:g.wrap},void 0,s()(te.Z,{},void 0,s()("div",{style:g.header},void 0,"chat"===S.currentView&&u.createElement(u.Fragment,null,o&&s()(Ge,{store:i}),"persisted"===(null==o||null===(t=o.selectedSkill)||void 0===t?void 0:t.type)&&s()(Ne,{clientSkill:o.selectedSkill,renderOrigin:e=>u.createElement(ee.Z,r()({},e,{style:g.headerButton}),"Edit")}),s()("div",{style:{flexGrow:1}}),y&&s()(ee.Z,{style:g.headerButton,onClick:_},void 0,Z?"Disable Slack mode":"Enable Slack mode"),o&&s()(ee.Z,{style:g.headerButton,onClick:c},void 0,"Reset"),(y||b)&&o&&s()(D.Z,{icon:W.Z.copy,onClick:d,ariaLabel:"copy"})),"skillSwitcher"===S.currentView&&u.createElement(u.Fragment,null,s()(D.Z,{icon:W.Z.arrowLeft,onClick:V,ariaLabel:"back"}),s()("div",{style:{marginLeft:4,fontSize:14}},void 0,"All skills"),s()("div",{style:{flexGrow:1}})),"chat"===S.currentView&&!o&&s()(J.ZP,{popupType:l.device.isMobile?J.Z4.SlideUp:J.Z4.Popup,renderOrigin:e=>u.createElement(D.Z,r()({icon:W.Z.help,ariaLabel:"help"},e)),render:()=>s()(ne.LazyHelpButtonContent,{shouldRenderAsStaticModal:!1})}),s()(D.Z,{style:g.closeButton,hovered:!0,icon:W.Z.close,onClick:a,ariaLabel:"close"})),Z&&s()("div",{style:{...g.header,flexDirection:"column",gap:6}},void 0,s()("div",{style:g.labeledInput},void 0,s()("div",{style:g.inputLabel},void 0,"Channel"),s()(X.b,{value:(null==I?void 0:I.selectedFakeChannel)||"",onChange:e=>{if(!I)throw new Error("slackModeState is undefined");K.Pl.setState({...I,selectedFakeChannel:e})},disabled:Boolean(o),placeholder:"Channel name",style:g.input})),s()("div",{style:g.labeledInput},void 0,s()("div",{style:g.inputLabel},void 0,"User"),s()(A.Z,{items:E,selectedItem:null==I?void 0:I.selectedFakeUser,getKey:e=>e.name||e.id,renderItem:e=>u.createElement(C.Z,r()({},e,{title:e.key})),onSelect:e=>{if(!I)throw new Error("slackModeState is undefined");K.Pl.setState({...I,selectedFakeUser:e})},renderOrigin:e=>u.createElement(x.Z,r()({focused:!1,title:null!=I&&I.selectedFakeUser?null==I?void 0:I.selectedFakeUser.name:"Select a user"},e))})))),"chat"===S.currentView&&s()(Ke,{store:i}),"skillSwitcher"===S.currentView&&s()(je,{}))}function Ye(e){window.__c={n:"AssistantButton"};const t=(0,p.O7)(),i=(0,v.Fg)(),n=(0,v.yK)((e=>({wrap:{borderRadius:12,boxShadow:e.largeLightBoxShadow},faceImg:{width:42,pointerEvents:"none"}})),[]),a=(0,m.VK)((()=>(0,Q.y)(t,{theme:i,rightEdgeDistance:16,isInPeekRenderer:!1,width:48})),[t,i]);return s()(J.ZP,{popupType:t.device.isMobile?J.Z4.SlideUp:J.Z4.Popup,disableMouseCapture:!0,preventScaleTransition:!0,popupWrapStyle:n.wrap,renderOrigin:e=>u.createElement(Y.Z,r()({ariaLabel:"ai",className:"notion-ai-button",style:a},e),s()("img",{style:n.faceImg,src:G.Z.images.aiFaceLookleftPng})),render:e=>s()(Qe,{store:K.XN,onClose:e.close})})}},47240:(e,t,i)=>{i.d(t,{Z:()=>I});var n=i(23174),a=i.n(n),o=(i(57658),i(67294)),r=i(81954),l=i(24405),s=i(80951),c=i(14215),d=(i(30541),i(21703),i(67266)),u=i.n(d),p=i(96486),m=i.n(p),v=i(5242),g=i.n(v),f=i(15095),h=i(70203),y=i(97880);let S=function(e){return e[e.removed=-1]="removed",e[e.added=1]="added",e[e.same=0]="same",e}({});function k(e){const{before:t,after:i}=e,n={count:0,encoding:{},decoding:{},annotationEncoding:{},annotationDecoding:{}},a=e=>{const t=n.encoding[e];if(t)return t;{const t=String.fromCharCode(n.count);return n.count++,n.encoding[e]=t,n.decoding[t]=e,t}},o=e=>{const t=u()(e),i=n.annotationEncoding[t];if(i)return i;{const i=String.fromCharCode(n.count);return n.count++,n.annotationEncoding[t]=i,n.annotationDecoding[i]=e,i}},r=e=>m().flatten(h.lz(e).map((e=>{const t=f.p4(e[0]).map(a);if(h.km(e)){const i=h.hD(e),n=h.I$(i);n&&(t[0]=o({type:"mention",value:n}),i.forEach((e=>{h.ZA(e)||h.ku(e)||h.QV(e)||(t.unshift(o({type:"start",value:e})),t.push(o({type:"end",value:e})))})))}else if(h.Yr(e)){const i=h.hD(e),n=h.Ap(i);if(n){t[0]=o({type:"equation",value:n});for(const e of i)h.ZA(e)||h.ku(e)||h.QV(e)||(t.unshift(o({type:"start",value:e})),t.push(o({type:"end",value:e})))}}else if(h.AJ(e)){h.hD(e).forEach((e=>{t.unshift(o({type:"start",value:e})),t.push(o({type:"end",value:e}))}))}return t}))).join("");if(n.count>65535)throw new Error("This string has way too many different characters.");const l=function(e,t){const i=new(g())({timeout:2,editCost:6}),n=i.main(t,e);return i.cleanupSemantic(n),n}(r(i),r(t)),s=[];let c=[];return l.forEach((e=>{let[t,i]=e;i.split("").forEach((e=>{if(n.decoding[e]){const i=n.decoding[e];t===S.added?s.push([i,[...c,["+"]]]):t===S.removed?s.push([i,[...c,["-"]]]):t===S.same&&s.push([i,c])}else{const i=n.annotationDecoding[e];if(t===S.added)if("mention"===i.type)s.push([h.qy,[...c,["+"],i.value]]);else if("start"===i.type)c=[...c,i.value];else if("end"===i.type)c=c.filter((e=>!m().isEqual(e,i.value)));else if("equation"===i.type){const e=h.xe(i.value),t=h.qZ(e,[...c,["+"]]);s.push(t)}else(0,y.t1)(i);else if(t===S.removed){if("mention"===i.type)s.push([h.qy,[...c,["-"],i.value]]);else if("equation"===i.type){const e=h.xe(i.value),t=h.qZ(e,[...c,["-"]]);s.push(t)}}else if(t===S.same)if("mention"===i.type)s.push([h.qy,[...c,i.value]]);else if("start"===i.type)c=[...c,i.value];else if("end"===i.type)c=c.filter((e=>!m().isEqual(e,i.value)));else if("equation"===i.type){const e=h.xe(i.value),t=h.qZ(e,c);s.push(t)}else(0,y.t1)(i)}}))})),h.Zx(s)}var w=i(53397),b=i(21202),C=i(68216),x=i(63867);function I(e){const t=e.propertySchema.type;switch(t){case"title":case"text":return o.createElement(Z,e);case"relation":return a()(V,{propertySchema:e.propertySchema,beforeValue:e.beforeValue,afterValue:e.afterValue,rootStore:e.rootStore});case"checkbox":case"number":case"person":case"file":case"url":case"email":case"phone_number":case"created_time":case"created_by":case"last_edited_time":case"last_edited_by":case"last_visited_time":case"formula":case"rollup":case"select":case"multi_select":case"date":case"button":case"status":case"auto_increment_id":case"location":case"verification":return o.createElement(_,e);default:(0,y.t1)(t)}}function Z(e){const t={value:k({before:e.beforeValue.value,after:e.afterValue.value}),spaceId:e.beforeValue.spaceId};return a()(x.Z,{value:t,propertySchema:e.propertySchema,rootStore:e.rootStore})}function V(e){window.__c={n:"RelationPropertyDiff"};const{beforeValue:t,afterValue:i,propertySchema:n,rootStore:o}=e,l=(0,r.VK)((()=>{const e=(0,s.rq)(t.value),a=(0,s.rq)(i.value),r=(0,c.N)(e,a,(e=>`${e.id}${e.table}`)),l=new Set(s.j$({relationValue:r.created,getRecordValue:o.getRecordValue,propertySchema:n})),d=new Set(s.j$({relationValue:r.deleted,getRecordValue:o.getRecordValue,propertySchema:n})),u=[...l,...d];return u.flatMap(((e,t)=>{const i=C.G.createChildStore(o,{table:b.iU,id:e.id}).getPropertyValue("title")||[],n=[],a=h.lz(i);for(const o of a)if(h.QJ(o)){const t=l.has(e)?"+":"-",i=[o[0],[[t]]];n.push(i)}else n.push(o);return t<u.length-1&&n.push(h.V3("\n")),n}))}),[t,i,n,o]);return a()(x.Z,{value:{value:l,spaceId:t.spaceId},propertySchema:{type:"title",name:"Title"},rootStore:o})}function _(e){window.__c={n:"ArrowPropertyDiff"};const t=(0,l.yK)((()=>({arrowDiffWrap:{display:"inline-flex",alignItems:"center"}})),[]);return a()("div",{style:t.arrowDiffWrap},void 0,a()(x.Z,{value:e.beforeValue,propertySchema:e.propertySchema,rootStore:e.rootStore}),a()(E,{}),a()(x.Z,{value:e.afterValue,propertySchema:e.propertySchema,rootStore:e.rootStore}))}function E(){window.__c={n:"Arrow"};const e=(0,l.yK)((e=>({container:{padding:"0px 8px"},icon:{width:15,height:15,fill:e.mediumIconColor}})),[]);return a()("div",{style:e.container},void 0,w.Z.arrowRightSmaller(e.icon))}}}]);