"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[5403],{63123:(e,t,o)=>{o.d(t,{V:()=>n});o(21703);var r=o(67294);function n(e){const{value:t,validateLoaded:o}=e,n=e.waitTimeInMs||500,[i,s]=(0,r.useState)(!0),a=(0,r.useRef)(),l=void 0!==t&&(!o||i&&o(t));return(0,r.useEffect)((()=>(a.current=window.setTimeout((()=>{s(!1),a.current=void 0}),n),()=>{a.current&&(clearTimeout(a.current),a.current=void 0)})),[n]),(0,r.useEffect)((()=>{l&&a.current&&(s(!1),clearTimeout(a.current),a.current=void 0)}),[l]),void 0!==t&&l?{status:"resolved",value:t}:i?{status:"pending",value:void 0}:{status:"rejected",value:void 0,error:new Error("Reached end of timeout before value became defined.")}}},68500:(e,t,o)=>{o.d(t,{Z:()=>G});var r=o(10434),n=o.n(r),i=o(23174),s=o.n(i),a=o(96486),l=o.n(a),c=o(67294),p=o(83355),d=o(66897),u=o(14714),m=o(99036),h=o(53397),g=o(4615),S=o(23014),y=o(21202),f=o(6287),v=o(97880),C=o(5366),b=o(47307),w=o(31299),x=o(66890),_=o(87279),M=o(63725),P=o(33846),I=o(29798),k=o(68216),T=o(42922),F=o(52275),Z=o(36488),R=o(74194),A=o(68894),V=o(78140),B=o(32163),O=o(43765),N=o(11470),D=o(77137),E=o(72495),L=o(86765),q=o(97680);class K extends p.Z{constructor(){super(...arguments),this.storeTypes={inputStore:P.Z,menuListStore:I.Z,collectionContextStore:M.Z},this.performRelationSearchRequest=async e=>{const{groupBy:t,schema:o,parentStore:r}=this.props,n=o[t.property];if(!n||!(0,m.p_)(n))return;const i=n.collection_pointer;if(!i)return;const s=k.NW.createChildStore(r,{table:f.v,id:i.id});if(await s.load(),!s.isDefined())return;const a=s.getSpaceId();return(await w.df({environment:this.environment,query:e,collectionId:i.id,spaceId:a,excludeTemplates:!0,source:"collection_group_value",limit:20,includePublicPagesWithoutExplicitAccess:!1,boostRecentlyViewedPages:!1})).results.map((e=>({table:y.iU,id:e,spaceId:a})))},this.handleTextInputChange=e=>{const{inputStore:t,menuListStore:o}=this.stores;t.setState({...t.state,inputValue:e.target.value}),o.setState({...o.state,focus:{section:0,indexLocal:0,indexGlobal:0}})},this.handleTextInputKeydown=e=>{if(13===e.keyCode)this.acceptTextInputValue();else if(27===e.keyCode){var t,o;null===(t=(o=this.props).onClose)||void 0===t||t.call(o)}},this.handleMenuClickRight=()=>{this.acceptTextInputValue()},this.handleClickSubmitButton=()=>{this.acceptTextInputValue()},this.performUserSearchRequest=async e=>(await w.Yu({environment:this.environment,query:e,membersOnly:!1})).slice(0,20)}willMount(e){var t;super.willMount(e);const{inputStore:o}=this.stores,{groupFormat:r}=this.props;r&&("select"===r.value.type||"multi_select"===r.value.type)&&r.value.value?o.setState({...o.state,inputValue:r.value.value}):r&&(0,u.R7)(r.value)&&"exact"===(null===(t=r.value.value)||void 0===t?void 0:t.type)&&o.setState({...o.state,inputValue:r.value.value.value})}renderComponent(){const{groupFormat:e,onClose:t}=this.props;let o;return o=this.environment.device.isPhone?{menuType:_.og.Modal,title:s()(C.FormattedMessage,e?{defaultMessage:"Rename group",id:"codeBlock.databaseEditGroupMenu.renameGroupTitle"}:{defaultMessage:"Add a group",id:"codeBlock.databaseEditGroupMenu.addGroupTitle"}),left:s()(C.FormattedMessage,{defaultMessage:"Cancel",id:"codeBlock.databaseEditGroupMenu.cancelButton.label"}),right:s()(C.FormattedMessage,{defaultMessage:"Done",id:"codeBlock.databaseEditGroupMenu.doneButton.label"}),onClickRight:this.handleMenuClickRight,onClickLeft:t}:{menuType:_.og.Popup,width:this.isTextInputType()?300:240,maxHeight:"50vh"},s()(Z.Z,{capture:!0,render:e=>c.createElement(V.Z,n()({},o,e),this.renderMenuInner())})}renderMenuInner(){const{groupBy:e,schema:t}=this.props;if(t[e.property])return"select"===e.type||"multi_select"===e.type?this.renderTextInput():"person"===e.type?this.renderPersonValue():"relation"===e.type?this.renderRelationValue():(0,u.HB)(e.type)?this.renderTextInput():void("number"!==e.type&&"status"!==e.type&&"date"!==e.type&&"formula"!==e.type&&"checkbox"!==e.type&&"created_time"!==e.type&&"last_edited_time"!==e.type&&"created_by"!==e.type&&"last_edited_by"!==e.type&&"last_visited_time"!==e.type&&"location"!==e.type&&(0,v.t1)(e.type))}renderTextInput(){const{intl:e,groupFormat:t}=this.props,{inputValue:o}=this.stores.inputStore.state,r=t?e.formatMessage({id:"database.collectionEditGroupMenu.renameGroupLabel.placeholder",defaultMessage:"Rename group"}):e.formatMessage({id:"database.collectionEditGroupMenu.newGroupLabel.placeholder",defaultMessage:"New group"});return this.environment.device.isPhone?s()(E.Z,{},void 0,s()(A.ZP,{value:o,focus:!0,selectAll:!0,showClearButton:!1,focusInitial:!0,placeholder:r,onChange:this.handleTextInputChange,onKeyDown:this.handleTextInputKeydown})):s()("div",{style:{display:"flex",alignItems:"center",padding:"8px 10px",width:"100%",background:this.theme.inputBackground}},void 0,s()(R.Z,{value:o,focus:!0,selectAll:!0,focusInitial:!0,placeholder:r,onChange:this.handleTextInputChange,onKeyDown:this.handleTextInputKeydown,format:R.B.Transparent}),s()(T.Z,{onClick:this.handleClickSubmitButton},void 0,s()(C.FormattedMessage,{defaultMessage:"Done",id:"database.collectionEditGroupMenu.submitButton.label"}),h.Z.enter({height:14,width:14,fill:"currentColor",marginLeft:6,marginTop:2})))}renderPersonValue(){const{currentGroups:e,intl:t}=this.props,{inputValue:o}=this.stores.inputStore.state;return s()(D.Z,{request:o,performRequest:this.performUserSearchRequest,debounce:w.vp,render:(r,i,a)=>{i||(i=[]);const p=l().compact(i.map((t=>({key:t.id,render:e=>c.createElement(q.Z,n()({actor:(0,d.dp)(t)},e)),action:()=>{const{onChange:o,groupFormat:r}=this.props,n={type:"person",value:{table:"notion_user",id:t.id}};var i,s;r&&l().isEqual(n,r.value)?null===(i=(s=this.props).onClose)||void 0===i||i.call(s):e.some((e=>(0,u.we)(n,e.value)))?b.showErrorMessage(this.renderGroupAlreadyExistsMessage()):o({newGroupValue:n})}}))));let m;return m=a&&i&&0===p.length?s()(E.Z,{},void 0,s()(O.Z,{title:s()(C.FormattedMessage,{defaultMessage:"No results",id:"database.noPersonSearchResults.message"})})):s()(B.Z,{type:B.i.Vertical,initialFocus:0,sections:[{key:0,render:e=>c.createElement(E.Z,e),items:p}],store:this.stores.menuListStore}),c.createElement(c.Fragment,null,s()(E.Z,{},void 0,s()(A.ZP,{value:o,focus:!0,placeholder:t.formatMessage({defaultMessage:"Search for a person…",id:"database.searchPerson.placeholder"}),onChange:e=>{this.stores.inputStore.setState({...this.stores.inputStore.state,inputValue:e.target.value}),this.stores.menuListStore.setState({...this.stores.menuListStore.state,focus:{section:0,indexLocal:0,indexGlobal:0}})}})),m)}})}getCreateNewPageMenuListItem(){const{parentStore:e,schema:t,groupBy:o}=this.props,{inputValue:r}=this.stores.inputStore.state,i=t[o.property];if(!i||"relation"!==i.type)return null;const a=m.j0(i);if(!a)return null;const l=k.NW.createChildStore(e,a);return l.isDefined()&&r.length>0?{key:"new-page",render:e=>c.createElement(F.Z,n()({title:s()(L.Z,{targetCollectionStore:l,title:r})},e)),action:()=>{const{onChange:e}=this.props,t={table:y.iU,id:(0,g.ZP)(),spaceId:l.getSpaceId()};e({newGroupValue:{type:"relation",value:t},newPage:{id:t.id,spaceId:t.spaceId,name:r}})}}:null}getMenuListItemsForRelatedRecords(e,t){var o;const{currentGroups:r,parentStore:i}=this.props,s=null===(o=this.context.collectionContextStore)||void 0===o?void 0:o.relativeVariableStore.state,a=s&&s[t.id],p=e=>{const o=k.NW.createChildStore(i,t);if(!o.isDefined())return;const r=o.getFormat().app_config_uri;return r&&e?S.qB[r][e].formattedMessage:void 0};return e.map((e=>{const t=k.G.createChildStore(i,e);if(t.isTemplate())return;const o=a?(0,S.P8)(t.id,a):void 0;return{key:t.id,render:e=>c.createElement(N.Z,n()({store:t,titlePrefix:p(o)},e)),action:()=>{const{onChange:t,groupFormat:n}=this.props;let i={type:"relation",value:e};var s,a;(o&&(i={type:"relation",value:{type:"relative",value:{type:"builtin",variable:o}}}),n&&l().isEqual(i,n.value))?null===(s=(a=this.props).onClose)||void 0===s||s.call(a):r.some((e=>(0,u.we)(i,e.value)))?b.showErrorMessage(this.renderGroupAlreadyExistsMessage()):t({newGroupValue:i})}}}))}renderRelationValue(){const{intl:e,parentStore:t,schema:o,groupBy:r}=this.props,{inputValue:n}=this.stores.inputStore.state,i=o[r.property];if(!i||"relation"!==i.type)return;const a=m.j0(i);if(!a)return;return k.NW.createChildStore(t,a).isDefined()?s()(D.Z,{request:n,performRequest:this.performRelationSearchRequest,debounce:w.vp,render:(t,o,r)=>{o||(o=[]);const i=l().compact([...this.getMenuListItemsForRelatedRecords(o,a),this.getCreateNewPageMenuListItem()]);let p;return p=r&&o&&0===i.length?s()(E.Z,{},void 0,s()(O.Z,{title:s()(C.FormattedMessage,{defaultMessage:"No results",id:"database.noRelationSearchResults.message"})})):s()(B.Z,{type:B.i.Vertical,initialFocus:0,sections:[{key:0,render:e=>c.createElement(E.Z,e),items:i}],store:this.stores.menuListStore}),c.createElement(c.Fragment,null,s()(E.Z,{},void 0,s()(A.ZP,{value:n,focus:!0,placeholder:e.formatMessage({defaultMessage:"Type to search...",id:"database.searchRelation.placeholder"}),onChange:e=>{this.stores.inputStore.setState({...this.stores.inputStore.state,inputValue:e.target.value}),this.stores.menuListStore.setState({...this.stores.menuListStore.state,focus:{section:0,indexLocal:0,indexGlobal:0}})}})),p)}}):void 0}renderGroupAlreadyExistsMessage(){return s()(C.FormattedMessage,{defaultMessage:"Group already exists.",id:"database.groupExistsAlreadyError.message"})}acceptTextInputValue(){const{onChange:e,currentGroups:t,groupBy:o,groupFormat:r}=this.props,{inputStore:n}=this.stores,i=n.state.inputValue.trim().replace(/,/g,"");let s;var a,c,p,d,m,h;("select"===o.type||"multi_select"===o.type?s={type:o.type,value:i}:(0,u.aB)(o)&&(s={type:o.type,value:{type:"exact",value:i}}),s)?i?r&&l().isEqual(s,r.value)?null===(a=(c=this.props).onClose)||void 0===a||a.call(c):t.some((e=>s&&(0,u.we)(s,e.value)))?b.showErrorMessage(this.renderGroupAlreadyExistsMessage()):e({newGroupValue:s}):null===(p=(d=this.props).onClose)||void 0===p||p.call(d):null===(m=(h=this.props).onClose)||void 0===m||m.call(h)}isTextInputType(){const{groupBy:e}=this.props;return"select"===e.type||"multi_select"===e.type||(0,u.HB)(e.type)}}K.displayName="CollectionEditGroupMenu",K.contextTypes={...p.w,...x.xm};const G=(0,C.injectIntl)(K)},87052:(e,t,o)=>{o.d(t,{Z:()=>H});var r=o(10434),n=o.n(r),i=o(23174),s=o.n(i),a=o(67294),l=o(83355),c=o(66897),p=o(15145),d=o(14714),u=o(99036),m=o(80951),h=o(84619),g=o(7057),S=o(53877),y=o(42875),f=o(53397),v=o(32056),C=o(23014),b=o(97880),w=o(82990),x=o(5366),_=o(29637),M=o(26991),P=o(23482),I=o(10161),k=o(29376);var T=o(78316),F=o(84210),Z=o(33929),R=o(79315),A=o(61766),V=o(68216),B=o(68500),O=o(97180),N=o(64921),D=o(31945),E=o(12508),L=o(84076),q=o(31278),K=o(76798),G=o(58032),U=o(92864),W=o(69265),z=o(22084);class $ extends l.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:A.Z},this.renderEditPopup=()=>{const{schema:e,currentGroups:t,groupBy:o,groupFormat:r}=this.props,n=this.groupParentStore.state;if(n)return s()(B.Z,{groupFormat:r,groupBy:o,currentGroups:t,schema:e,onChange:e=>{var t,o;this.stores.buttonPopupStore.reset(),null===(t=(o=this.props).onChange)||void 0===t||t.call(o,e)},onClose:()=>{var e,t;this.stores.buttonPopupStore.reset(),null===(e=(t=this.props).onClose)||void 0===e||e.call(t)},parentStore:n})},this.groupParentStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupFormat:t}=this.props,o=e.groupsStore.getGroupState(t);return null==o?void 0:o.groupUiParentStore})),this.getRelatedCollectionAppConfigUri=this.createComputedStore((()=>{const{schema:e,groupFormat:t}=this.props,o=this.groupParentStore.state,r=e[t.property];if(r&&(0,u.p_)(r)&&o)return(0,k.ke)(r,o)}))}renderGroupType(e,t){return"select"===e.type||"multi_select"===e.type?this.renderSelectValue():"status"===e.type?this.renderStatusValue():(0,d.pd)(e.type)?this.renderPersonValue(e):"relation"===e.type?this.renderRelationValue(e):"location"===e.type?this.renderLocationValue(e):(0,d.A1)(e.type)?this.renderDateValue(e):(0,d.HB)(e.type)?this.renderTextValue(e):"number"===e.type?this.renderNumberValue(e,"number"===t.type?t:void 0):"checkbox"===e.type?this.renderCheckboxValue(e):void(0,b.t1)(e.type)}renderComponent(){const{groupFormat:e,schema:t}=this.props,o=e.value,r=void 0===o.value,n=t[e.property];if(n){if(r)return this.renderEmptyGroupLabel();if("formula"===o.type){if("formula"!==o.type)return;const e=o.value;if(!e)return;return this.renderGroupType(e,n)}return this.renderGroupType(o,n)}}renderEmptyGroupLabel(){const{groupFormat:e,schema:t,isHiddenGroup:o,collectionContextStore:r}=this.props,n=t[e.property],i=r.collectionStore(),a=this.groupParentStore.state;if(!n)return;const{name:l}=n;let c=!1;return null!=i&&i.isDefined()&&(0,u.p_)(n)&&a&&(c=function(e){const{collectionStore:t,property:o,propertySchema:r,parentStore:n}=e;let i=!1;if(null!=t&&t.isDefined()){const e=t.getPropertyMapping();i=(null==e?void 0:e[P.Es.TaskToSprintRelation])===o}const s=(0,k.ke)(r,n)===P.p$;return I.default.checkGate("proj_management_sprints")&&(s||i)}({collectionStore:i,property:e.property,propertySchema:n,parentStore:a})),s()(Y,c?{style:this.props.style,uncategorizedIconStyle:this.props.uncategorizedIconStyle,isHiddenGroup:o,formattedLabelMessage:s()(x.FormattedMessage,{defaultMessage:"Backlog (No {name})",values:{name:l},id:"database.sprintDatabaseView.uncategorizedGroupLabel"})}:{style:this.props.style,uncategorizedIconStyle:this.props.uncategorizedIconStyle,isHiddenGroup:o,formattedLabelMessage:s()(x.FormattedMessage,{defaultMessage:"No {name}",values:{name:l},id:"database.boardView.uncategorizedColumnTitle"})})}renderSelectValue(){var e;const{groupFormat:t,schema:o}=this.props,r=o[t.property];if(!r||!u.cu(r))return;const i=t.value;if(null===(e=r.options)||void 0===e||!e.length||void 0===i.value||i.type!==r.type)return;const l=(0,m.i7)(r.options,i.value);return l?s()(D.ZP,{render:this.renderEditPopup,disabled:this.props.disabled,buttonPopupStore:this.stores.buttonPopupStore,popupType:this.environment.device.isMobile?D.Z4.SlideUp:D.Z4.Popup,originGap:4,renderOrigin:e=>a.createElement(N.Z,n()({style:{...$.personTokenStyle,...this.props.style},disabled:this.props.disabled},e),s()(z.a,{format:h.l.Medium,isSingle:!0,value:l.value,color:l.color,showRemoveButton:!1}))}):void 0}renderStatusValue(){const{groupFormat:e,schema:t}=this.props,o=t[e.property];if(!o||"status"!==o.type)return;const r=e.value;if(r.type!==o.type)return;const{value:n}=r;if(!n)return;const i=o.options??[],a=o.groups??[];if("by_group"===n.type){const e=a.find((e=>e.name===n.group));return e&&s()(O.r_,{group:e,style:{fontWeight:500},showIcon:!0,showColor:!0})}if("by_option"===n.type){const e=(0,m.i7)(i,n.option),t=e&&a.find((t=>{var o;return null===(o=t.optionIds)||void 0===o?void 0:o.includes(e.id)}));return e&&s()("span",{style:{fontWeight:500,lineHeight:"normal"}},void 0,s()(z.F,{format:h.l.Medium,isSingle:!0,value:e.value,color:e.color,showRemoveButton:!1,groupColor:null==t?void 0:t.color}))}(0,b.t1)(n)}renderPersonValue(e){if(!(0,d.q6)(e))return;const{value:t}=e;if(!t)return;const o=this.groupParentStore.state;if(!o)return;const r=(0,c.Hl)({pointer:t,getRecordValue:o.getRecordValue});return r.asActor?s()(D.ZP,{render:this.renderEditPopup,disabled:this.props.disabled,buttonPopupStore:this.stores.buttonPopupStore,popupType:this.environment.device.isMobile?D.Z4.SlideUp:D.Z4.Popup,originGap:4,renderOrigin:e=>a.createElement(N.Z,n()({style:{...$.personTokenStyle,...this.props.style},disabled:this.props.disabled},e),s()(U.ZP,{format:U.ZP.Format.Medium,actor:r,showRemoveButton:!1,isSingle:!0,disableAvatarTooltip:this.props.isHiddenGroup,shouldShrink:!0}))}):void 0}renderLocationValue(e){const t=this.groupParentStore.state;if("location"!==e.type)return;if(!e.value)return;if(!t)return;const o=V.NW.createChildStore(t,e.value);return a.createElement(a.Fragment,null,s()(q.Z,{disabled:!0,icon:o.getIcon(),size:20,isEmptyPage:!1,style:{marginTop:2,marginRight:6}}),s()(K.Z,{store:o,underline:!0,style:{fontWeight:w.Z.fontWeight.medium}}))}renderRelationValue(e){const{schema:t,groupFormat:o,collectionContextStore:r}=this.props,n=this.groupParentStore.state;if(!n)return;if("relation"!==e.type)return;const i=t[o.property];if(!i||"relation"!==i.type)return;const l=u.j0(i);if(!l)return;const c=V.NW.createChildStore(n,l);if(c.isDefined()&&e.value){if((0,d.t2)(e.value)){var m;const t=this.getRelatedCollectionAppConfigUri.state;if(!t)return;const o=Z.default.formatMessage(_.sY.tasksCurrentSprintV2ViewNamePrefix),i=Z.default.formatMessage(_.sY.tasksNextSprintV2ViewNamePrefix),d=e.value.value.variable,u=null===(m=C.qB[t])||void 0===m?void 0:m[d];if(null!=c&&c.isDefined()){const e=(0,M.As)(r,d,l,c);if(!e)return s()("div",{style:{fontWeight:w.Z.fontWeight.medium}},void 0,null==u?void 0:u.formattedMessage);const{mainEditorCurrentBlockStore:t}=R.default.state,m=T.mb({store:e,mainEditorCurrentBlockStore:t,collectionContextStore:r})??(0,F.ZP)({store:e,pageVisitSource:p.tY.LinkInPage});if(e)return a.createElement(a.Fragment,null,s()("div",{style:{fontWeight:w.Z.fontWeight.medium,marginBottom:.25}},void 0,"current"===d?o:i,":"),s()(L.Z,{style:{...this.props.style,marginLeft:1},innerStyle:{...$.personTokenStyle},href:m},void 0,s()(W.Z,{format:U.ZP.Format.Medium,blockId:e.id,isSingle:!0,shouldShrink:!0,parentStore:n})))}return s()("div",{style:{fontWeight:w.Z.fontWeight.medium,marginBottom:.25}},void 0,null==u?void 0:u.formattedMessage)}if((0,d.RA)(e.value)){const t=V.G.createChildStore(n,e.value),{mainEditorCurrentBlockStore:o}=R.default.state,i=T.mb({store:t,mainEditorCurrentBlockStore:o,collectionContextStore:r})??(0,F.ZP)({store:t,pageVisitSource:p.tY.LinkInPage});return s()(L.Z,{style:this.props.style,innerStyle:{...$.personTokenStyle},href:i},void 0,s()(W.Z,{format:U.ZP.Format.Medium,blockId:e.value.id,isSingle:!0,shouldShrink:!0,parentStore:n}))}}}renderDateValue(e){if((0,d.Mc)(e)&&e.value)return s()("div",{style:{...$.personTokenStyle,...w.Z.textOverflowStyle,...this.props.style}},void 0,this.renderDateGroupValue(e.value))}renderDateGroupValue(e){if("today"===e.type)return s()(x.FormattedMessage,{defaultMessage:"Today",id:"database.collectionGroupValue.dateGroup.today"});if("yesterday"===e.type)return s()(x.FormattedMessage,{defaultMessage:"Yesterday",id:"database.collectionGroupValue.dateGroup.yesterday"});if("last_7_days"===e.type)return s()(x.FormattedMessage,{defaultMessage:"Last 7 days",id:"database.collectionGroupValue.dateGroup.last7Days"});if("last_30_days"===e.type)return s()(x.FormattedMessage,{defaultMessage:"Last 30 days",id:"database.collectionGroupValue.dateGroup.last_30Days"});if("tomorrow"===e.type)return s()(x.FormattedMessage,{defaultMessage:"Tomorrow",id:"database.collectionGroupValue.dateGroup.tomorrow"});if("next_7_days"===e.type)return s()(x.FormattedMessage,{defaultMessage:"Next 7 days",id:"database.collectionGroupValue.dateGroup.next7Days"});if("next_30_days"===e.type)return s()(x.FormattedMessage,{defaultMessage:"Next 30 days",id:"database.collectionGroupValue.dateGroup.next30Days"});if("day"===e.type){const t=(0,S.NK)(e.range,(0,y.r)(),this.props.intl.locale);return(0,g.ZW)(t.start,"medium")}if("week"===e.type){const t=(0,S.NK)(e.range,(0,y.r)(),this.props.intl.locale),o=(0,g.ZW)(t.start,"month_short"),r=(0,g.ZW)(t.start,"day"),n=t.start.year,i=(0,g.ZW)(t.end,"month_short"),a=(0,g.ZW)(t.end,"day"),l=t.end.year;return s()(x.FormattedMessage,n!==l?{defaultMessage:"Week of {startMonth} {startDay} {startYear} - {endMonth} {endDay} {endYear}",id:"database.collectionGroupValue.dateGroup.week.differingStartAndEndYear",values:{startMonth:o,startDay:r,endMonth:i,endDay:a,startYear:n,endYear:l}}:o!==i?{defaultMessage:"Week of {startMonth} {startDay} - {endMonth} {endDay} {startYear}",id:"database.collectionGroupValue.dateGroup.week.differingStartAndEndMonth",values:{startMonth:o,startDay:r,endMonth:i,endDay:a,startYear:n}}:{defaultMessage:"Week of {startMonth} {startDay}-{endDay} {startYear}",id:"database.collectionGroupValue.dateGroup.week.sameStartAndEndMonth",values:{startMonth:o,startDay:r,endDay:a,startYear:n}})}if("month"===e.type){const t=(0,S.NK)(e.range,(0,y.r)(),this.props.intl.locale);return(0,g.ZW)(t.start,"month_year_short")}if("year"===e.type){return(0,S.NK)(e.range,(0,y.r)(),this.props.intl.locale).start.year.toString()}(0,b.t1)(e)}renderTextValue(e){if((0,d.R7)(e)&&void 0!==e.value){const t=this.renderTextGroupValue(e.value);return"exact"===e.value.type?s()(D.ZP,{render:this.renderEditPopup,disabled:this.props.disabled,buttonPopupStore:this.stores.buttonPopupStore,popupType:this.environment.device.isMobile?D.Z4.SlideUp:D.Z4.Popup,originGap:4,renderOrigin:e=>a.createElement(N.Z,n()({style:{...$.selectStyle,...w.Z.textOverflowStyle,...this.props.style},disabled:this.props.disabled},e),t)}):s()("div",{style:$.selectStyle},void 0,t)}}renderTextGroupValue(e){return"other"===e.type?s()(x.FormattedMessage,{defaultMessage:"Other",id:"database.collectionGroupValue.textGroup.other"}):"alphabet_prefix"===e.type||"exact"===e.type?e.value:void(0,b.t1)(e)}renderNumberValue(e,t){if("number"!==e.type||!e.value)return;const o=(null==t?void 0:t.number_format)||v.dk;return s()("div",{style:{...$.personTokenStyle,...this.props.style}},void 0,this.renderNumberGroupValue(e.value,o))}renderNumberGroupValue(e,t){if("out_of_range"===e.type)return s()(x.FormattedMessage,{defaultMessage:"Out of range",id:"database.collectionGroupValue.numberGroup.outOfRange"});if("range"===e.type){const o=v.uf(e.start,t,this.props.intl),r=v.uf(e.end,t,this.props.intl);return s()(x.FormattedMessage,{defaultMessage:"{start} to {end}",id:"database.collectionGroupValue.numberGroup.range",values:{start:o,end:r}})}(0,b.t1)(e)}renderCheckboxValue(e){if("checkbox"===e.type)return s()("div",{style:{...$.checkboxStyle,...this.props.style}},void 0,s()(E.Z,{checked:e.value,size:14,disabled:!0}))}}$.displayName="CollectionGroupValue",$.selectStyle={overflow:"hidden",padding:3,borderRadius:3,fontWeight:w.Z.fontWeight.medium},$.personTokenStyle={overflow:"hidden",padding:3,paddingRight:6,borderRadius:3,fontWeight:w.Z.fontWeight.medium},$.checkboxStyle={padding:3,paddingRight:6};const H=(0,x.injectIntl)($);function Y(e){const{isHiddenGroup:t}=e;return t?a.createElement(j,n()({},e,{tooltipEvents:void 0})):s()(G.Z,{renderTooltip:()=>s()(x.FormattedMessage,{defaultMessage:"Any items with an empty <b>{name}</b> property will go here. This group cannot be removed.",values:{name,b:e=>s()("span",{style:{fontWeight:w.Z.fontWeight.semibold}},void 0,e)},id:"database.boardView.uncategorizedColumnTooltip"}),style:{width:240},textWrap:!0,render:t=>a.createElement(j,n()({},e,{tooltipEvents:t}))})}function j(e){const t={display:"flex",alignItems:"center",fontSize:14,lineHeight:1.2,paddingLeft:2,paddingRight:4,whiteSpace:"nowrap",overflow:"hidden",fontWeight:w.Z.fontWeight.medium},{style:o,uncategorizedIconStyle:r,tooltipEvents:i,formattedLabelMessage:l}=e;return a.createElement("div",n()({style:{...t,paddingLeft:0,...o}},i),f.Z.collectionInbox({width:14,marginLeft:6,marginRight:6,...r}),s()("span",{style:{...w.Z.textOverflowStyle}},void 0,l))}},75498:(e,t,o)=>{o.d(t,{Z:()=>u});var r=o(96486),n=o.n(r),i=o(83355),s=o(1302),a=o(49085),l=o(71644),c=o(97880),p=o(64434);class d extends i.Z{constructor(){super(...arguments),this.reducerId=this.props.id,this.instanceId=(0,l.ZP)(),this.localResultStoreChangeIsQueued=!1,this.storeTypes={resultStore:a.default.createClass(void 0)},this.handleLocalResultStoreChange=()=>{this.localResultStoreChangeIsQueued||(this.localResultStoreChangeIsQueued=!0,s.default.afterNextFlush(this.dequeueLocalResultStoreChange))},this.dequeueLocalResultStoreChange=()=>{const{resultStore:e}=this.stores;if(this.localResultStoreChangeIsQueued=!1,!this.componentIsMounted)return;const t=this.getCurrentResult();n().isEqual(t,e.state)||e.setState(t)}}willMount(e){const{collectionContextStore:t}=e;t.remoteResult.addListener(this.handleLocalResultStoreChange),t.localResultStore.addListener(this.handleLocalResultStoreChange),this.updateReducer(e),this.handleLocalResultStoreChange()}willUpdate(e){this.updateReducer(e)}willUnmount(){super.willUnmount();const{collectionContextStore:e,groupsPointer:t}=this.props;p.$D({reducerId:this.reducerId,instanceId:this.instanceId,reducer:void 0,collectionContextStore:e,groupsPointer:t}),e.remoteResult.removeListener(this.handleLocalResultStoreChange),e.localResultStore.removeListener(this.handleLocalResultStoreChange)}renderComponent(){const{render:e}=this.props;if(e)return e(this.stores.resultStore)}updateReducer(e){const{reducer:t,collectionContextStore:o,groupsPointer:r}=e;p.$D({reducerId:this.reducerId,instanceId:this.instanceId,reducer:t,collectionContextStore:o,groupsPointer:r})}getCurrentResult(){const{collectionContextStore:e}=this.props,t=e.localResultStore.state,o=e.remoteResult.state,r=t&&"reducer"===t.type?t.reducerResults[this.reducerId]:void 0,n=o&&"reducer"===o.type?o.reducerResults[this.reducerId]:void 0;return this.getResultFromLocalAndRemote(r,n)}getResultFromLocalAndRemote(e,t){const{collectionContextStore:o,reducer:r}=this.props,i=o.reducers.state,s=o.remoteResult.state,a=o.isClientModeEnabled.state;if("aggregation"===r.type||"groups"===r.type){if(a)return e;if(null!=s&&s.reducerResults[this.reducerId])return s.reducerResults[this.reducerId];return Boolean(s&&"reducer"===s.type&&n().find(s.reducerResults,((e,t)=>{const o=i[t];return Boolean(o&&"results"===o.reducer.type&&!o.reducer.searchQuery&&"results"===e.type&&e.hasMore&&n().isEqual(r.filter,o.reducer.filter))})))?e:t}if("results"===r.type){const r=o.wasCreatedThisSession.state;if((Boolean(s&&"reducer"===s.type&&s.reducerResults[this.reducerId])||r||a)&&e&&"results"===e.type){return{...e,hasMore:t&&"results"===t.type?t.hasMore:e.hasMore}}return t}throw(0,c.t1)(r)}}d.displayName="CollectionReducerRequest";const u=d},49670:(e,t,o)=>{o.d(t,{V:()=>k,Z:()=>T});var r=o(10434),n=o.n(r),i=o(23174),s=o.n(i),a=o(67294),l=o(83355),c=o(49085),p=o(34296),d=o(53397),u=o(4615),m=o(82990),h=o(5366),g=o(77162),S=o(5149),y=o(64434),f=o(94419),v=o(12359),C=o(93959),b=o(89014),w=o(83319),x=o(13005),_=o(42917),M=o(71846),P=o(72495);class I extends l.Z{constructor(){super(...arguments),this.storeTypes={inputStore:c.default.createClass("")},this.searchSessionId="",this.handleNewCollectionClick=()=>{const{collectionContextStore:e,collectionSettingsStore:t}=this.props;g.wd({environment:this.environment,collectionContextStore:e,action:"select_new_collection"});const o=this.stores.inputStore.state;S.E3({collectionSettingsStore:t});const r=e.collectionViewStore(),n=e.collectionViewBlockStore();r&&n&&S.nr({environment:this.environment,selectedDBType:"untyped",collectionName:o,collectionContextStore:e,collectionViewBlockStore:n,collectionViewStore:r,useTemporaryRecordCache:!1,baseViewType:"table"})},this.handleSourcePickerAccept=e=>{const{collectionContextStore:t,collectionSettingsStore:o}=this.props;v.createAndCommit({userAction:"CollectionSettingsCreateViewSource.handleSourcePickerAccept",environment:this.environment,perform:o=>{y.yc({environment:this.environment,collectionContextStore:t,collectionStore:e,transaction:o});const r=t.collectionViewStore(),n=t.collectionViewBlockStore(),i=e.getParentBlockStore();r&&i&&null!=n&&n.isDefined()&&(0,C.h7)(n)&&f.BE({parent:i.getCollectionViewsStore(),insert:r,transaction:o})}}),k({collectionStore:e,collectionContextStore:t,collectionSettingsStore:o})}}renderComponent(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,{inputStore:o}=this.stores,r=e.collectionViewBlockStore(),i=e.collectionStore();if(!r)return;const l=e.getCollectionViewBlockSourceState(),c=o.state;return a.createElement(x.ZP,n()({},this.props,{title:s()(h.FormattedMessage,{defaultMessage:"Select data source",id:"database.viewSettings.createViewSourceTab.title"}),handleClose:()=>{g.tW({environment:this.environment,eventName:"abandoned_search",queryLength:c.length,sessionId:this.searchSessionId,source:p.S.Source}),S.E3({collectionSettingsStore:t})},footer:"uninitialized"===l&&s()(P.Z,{topBorder:!0},void 0,s()(_.Z,{icon:d.Z.plus,isGray:!0,title:s()(h.FormattedMessage,c?{defaultMessage:"New database “{filterText}”",id:"database.viewSettings.createViewSourceTab.newCollectionWithNameButton.title",values:{filterText:s()("span",{style:{...m.Z.textOverflowStyle,fontWeight:m.Z.fontWeight.medium,maxWidth:160,display:"inline-block",verticalAlign:"bottom"}},void 0,c)}}:{defaultMessage:"New database",id:"database.viewSettings.createViewSourceTab.newCollectionButton.title"}),onClick:this.handleNewCollectionClick}))}),s()(M.Z,{collectionContextStore:e,selectedCollectionStore:i,parentStore:r,onAccept:this.handleSourcePickerAccept,context:p.S.Source,inputStore:o,searchSessionId:this.searchSessionId}))}willMount(){this.searchSessionId=(0,u.ZP)()}}async function k(e){const{collectionStore:t,collectionContextStore:o,collectionSettingsStore:r}=e,n=o.collectionViewBlockStore(),i=o.collectionViewStore(),s=t.getParentBlockStore();if(!n||!s||!i)return;await Promise.all([...s.getCollectionViewStores().map((e=>e.load())),...n.getCollectionViewStores().map((e=>e.load()))]);(0,w.g)({collectionStore:t,sourceCollectionViewBlockStore:s,currentCollectionViewBlockStore:n,currentCollectionViewStore:i,constraints:(0,b.x)(i.id)}).length>0?S.H4({collectionSettingsStore:r,item:{type:"duplicateExistingView"}}):S.H4({collectionSettingsStore:r,item:{type:"createView"}})}I.displayName="CollectionSettingsCreateViewSource";const T=(0,h.injectIntl)(I)},83319:(e,t,o)=>{o.d(t,{g:()=>B,Z:()=>O});var r=o(10434),n=o.n(r),i=o(23174),s=o.n(i),a=(o(57658),o(96486)),l=o(67294),c=o(83355),p=o(26263),d=o(49085),u=o(53397),m=o(5366),h=o(77162),g=o(5149),S=o(64434),y=o(9953),f=o(12359),v=o(78316),C=o(33929),b=o(89014),w=o(29798),x=o(68216),_=o(73657),M=o(13005),P=o(42917),I=o(1136),k=o(45669),T=o(52275),F=o(68894),Z=o(32163),R=o(72495);const A=(0,m.defineMessages)({inputPlaceholder:{defaultMessage:"Search for a view…",id:"database.viewSettings.duplicateExistingViewTab.inputPlaceholder"}});class V extends c.Z{constructor(){super(...arguments),this.temporaryRecordCache=new p.Z({name:"CollectionSettingsDuplicateExistingView"}),this.lastDuplicatedViewId=void 0,this.originalCollectionPointer=void 0,this.didAccept=!1,this.preselectedViewPointer=void 0,this.storeTypes={inputStore:d.default.createClass(""),menuListStore:w.Z,limitStore:d.default.createClass(!0)},this.handlePreviewCollectionView=e=>{this.duplicateViewSettings(e,!0)},this.handlePreviewCollectionViewDebounced=a.debounce(this.handlePreviewCollectionView,500),this.handleMenuListStoreChange=()=>{const e=this.stores.menuListStore.state,{device:t}=this.environment;if(void 0===e.focus.indexGlobal||t.isMobile)return;const o=this.getCurrentResult().viewStores[e.focus.indexGlobal];o&&this.handlePreviewCollectionViewDebounced(o)},this.handleDuplicateViewAccept=e=>{const{collectionSettingsStore:t,collectionContextStore:o}=this.props;this.environment.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(this.temporaryRecordCache),h.wd({environment:this.environment,collectionContextStore:o,action:"click_duplicate_view"}),this.duplicateViewSettings(e,!1),g.wl({collectionSettingsStore:t,item:{type:"main",selectViewNameInitial:!0}}),this.didAccept=!0},this.handleNewEmptyViewClick=()=>{const{collectionSettingsStore:e,collectionContextStore:t}=this.props;h.wd({environment:this.environment,collectionContextStore:t,action:"click_new_empty_view"}),g.E3({collectionSettingsStore:e}),g.H4({collectionSettingsStore:e,item:{type:"createView"}}),this.didAccept=!0}}willMount(e){const{collectionContextStore:t}=e,{device:o}=this.environment,r=t.collectionStore(),n=t.collectionViewStore();if(!n)return;const i=(0,b.x)(n.id);this.preselectedViewPointer=null==i?void 0:i.viewPointer,this.originalCollectionPointer=null==r?void 0:r.pointer,this.environment.defaultRecordCache.inMemoryRecordCache.addCacheOverride(this.temporaryRecordCache),this.stores.menuListStore.addListener(this.handleMenuListStoreChange);const{viewStores:s}=this.getCurrentResult(),[a]=s;!o.isMobile&&a&&this.duplicateViewSettings(a,!0)}willUnmount(){if(this.environment.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(this.temporaryRecordCache),this.stores.menuListStore.removeListener(this.handleMenuListStoreChange),!this.didAccept){const{viewStores:e}=this.getCurrentResult(),t=this.lastDuplicatedViewId?e.find((e=>e.id===this.lastDuplicatedViewId)):e[0];if(!t)return;this.duplicateViewSettings(t,!1)}}renderComponent(){const{inputStore:e,menuListStore:t,limitStore:o}=this.stores,{device:r}=this.environment,i=e.state,{viewStores:c,showMore:p}=this.getCurrentResult(),d=a.compact(c.map((e=>{const t=e.getType(),o=e.getFormat().collection_view_icon;if(!t||"page"===t)return;const r=e.getName(),i=e.id;return{key:i,render:e=>{var a;return l.createElement(T.Z,n()({},e,{title:s()(k.Z,{collectionViewType:t,collectionViewName:r}),icon:s()(I.F,{color:"regular",viewIcon:o,viewType:t,style:{marginRight:6}}),checkState:(null===(a=this.preselectedViewPointer)||void 0===a?void 0:a.id)===i}))},action:()=>{this.handleDuplicateViewAccept(e)}}})));if(p>0){const e={key:"showMore",render:e=>l.createElement(T.Z,n()({},e,{icon:u.Z.dots({width:16,height:16,color:this.theme.mediumTextColor}),style:{color:this.theme.mediumTextColor},title:s()(m.FormattedMessage,{defaultMessage:"Show {showMore} more",id:"database.viewSettings.duplicateExistingViewTab.showMore.title",values:{showMore:p}})})),action:()=>{o.setState(!1)}};d.push(e)}return l.createElement(M.ZP,n()({},this.props,{title:s()(m.FormattedMessage,{defaultMessage:"Copy an existing view",id:"database.viewSettings.duplicateExistingViewTab.title"}),footer:s()(R.Z,{topBorder:!0},void 0,s()(P.Z,{icon:u.Z.plus,isGray:!0,title:s()(m.FormattedMessage,{defaultMessage:"New empty view",id:"database.viewSettings.duplicateExistingViewTab.newEmptyViewButton.title"}),onClick:this.handleNewEmptyViewClick}))}),(p>0||i)&&s()(R.Z,{},void 0,s()(F.ZP,{focusInitial:!r.isMobile||void 0,value:i,onChange:r=>{e.setState(r.target.value),t.setState({focus:{section:0,indexLocal:0,indexGlobal:0}}),o.setState(!0)},placeholder:C.default.formatMessage(A.inputPlaceholder),showClearButton:!0})),d.length>0&&s()(Z.Z,{type:Z.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>l.createElement(R.Z,e),items:d}],store:t}),0===d.length&&s()(_.Z,{caption:s()(m.FormattedMessage,{defaultMessage:"No results",id:"database.viewSettings.duplicateExistingViewTab.noResultsTitle"})}))}getCurrentResult(){const{collectionContextStore:e}=this.props,t=e.collectionViewBlockStore(),o=e.collectionStore(),r=e.collectionViewStore();if(!t||!o||!r)return{viewStores:[],showMore:0};const{inputStore:n,limitStore:i}=this.stores,s=n.state,a=o.getParentBlockStore();if(!t||!a)return{viewStores:[],showMore:0};let l=B({collectionStore:o,sourceCollectionViewBlockStore:a,currentCollectionViewBlockStore:t,currentCollectionViewStore:r,constraints:(0,b.x)(r.id)}),c=0;return s?l=l.filter((e=>(0,v.D)(e,s))):i.state&&(c=l.length-7,l=l.slice(0,7)),{viewStores:l,showMore:c}}duplicateViewSettings(e,t){if(e.id===this.lastDuplicatedViewId&&t)return;this.lastDuplicatedViewId=e.id;const{collectionContextStore:o}=this.props,r=o.collectionViewStore(),n=e.getType();if(!r||!n)return;const i=e.getName(),s=e.getPageSort(),a=e.getFormat(),l=e.getKeyStore("query2").getValue();let c=r;t&&(c=r.clone(this.temporaryRecordCache)),f.createAndCommit({userAction:"CollectionSettingsDuplicateExistingView.duplicateViewSettings",environment:this.environment,perform:e=>{y.sW({store:c,data:{name:i,type:n,page_sort:s,format:{...a,collection_pointer:this.originalCollectionPointer},query2:l},transaction:e})}}),S.Ip({collectionContextStore:o})}}function B(e){const{collectionStore:t,sourceCollectionViewBlockStore:o,currentCollectionViewBlockStore:r,currentCollectionViewStore:n,constraints:i}=e;let s=a.uniqBy([...r.getCollectionViewStores(),...o.getCollectionViewStores()],(e=>e.id)).filter((e=>{var o;return(null===(o=e.getCollectionStore())||void 0===o?void 0:o.id)===t.id&&e.id!==n.id&&"page"!==e.getType()}));if(null!=i&&i.viewType&&(s=[...s.filter((e=>e.getType()===i.viewType)),...s.filter((e=>e.getType()!==i.viewType))]),null!=i&&i.viewPointer){const{id:e}=i.viewPointer,t=s.find((t=>t.pointer.id===e))||x.Xr.createChildStore(o,i.viewPointer);s=[t,...s.filter((t=>t.pointer.id!==e))]}return s}V.displayName="CollectionSettingsDuplicateExistingView";const O=(0,m.injectIntl)(V)},80072:(e,t,o)=>{o.d(t,{Z:()=>Z});var r=o(23174),n=o.n(r),i=o(96486),s=o.n(i),a=o(67294),l=o(480),c=o(81954),p=o(24405),d=o(53397),u=o(27006),m=o(5366),h=o(77162),g=o(12534),S=o(29376),y=o(25464),f=o(86825),v=o(58032);function C(e){window.__c={n:"CollectionSettingsAutoRelateSwitch"};const{temporaryAutoRelateState:t,handleAutoRelateToggle:o,collectionContextStore:r,targetCollectionStore:i,autoRelate:s,hasInverseRelation:l}=e,u=(0,c.VK)((()=>r.collectionStore()),[r]),h=(0,c.VK)((()=>Boolean(null==u?void 0:u.isSyncedCollection())),[u]),g=(0,c.VK)((()=>(null==u?void 0:u.getFormat().bot_id)||i.getFormat().bot_id),[u,i]),S=(0,c.VK)((()=>!!g&&(h||!h&&l)),[g,h,l]),C=(0,p.yK)((e=>({errorLabel:{margin:"0px 14px",color:e.errorText},helpIcon:{width:16,fill:e.lightIconColor,marginLeft:6}})),[]),b=n()("div",{style:{display:"flex",alignItems:"center",whiteSpace:"pre"}},void 0,n()(m.FormattedMessage,{defaultMessage:"Automatically Relate",id:"database.viewSettings.setupRelationTab.autoRelate.title"}),n()(v.Z,{render:e=>a.createElement("div",e,d.Z.help(C.helpIcon)),style:{width:200},placement:y.u.Bottom,textWrap:!0,renderTooltip:()=>n()(m.FormattedMessage,{defaultMessage:"Relations will automatically populate based on links found in page properties.",id:"database.viewSettings.setupRelationTab.autoRelateTooltip"})}));return S?n()(f.Z,{title:b,on:t?t.enabled:!!s&&(null==s?void 0:s.enabled),focused:!1,onClick:()=>o(g),textWrapperStyle:{opacity:1}}):null}var b=o(82990),w=o(31278),x=o(76798),_=o(72495),M=o(64369);function P(e){window.__c={n:"CollectionSettingsRelationVisualizer"};const{collectionContextStore:t,targetCollectionStore:o,propertySchema:r,propertyName:i,temporaryInverseState:s,hasInverseRelation:l,inverseRelationName:d,isInitialPropertyName:u}=e,h=(0,m.useIntl)(),g=(0,c.VK)((()=>t.collectionStore()),[t]),y=s?s.hasInverseRelation:l,f=(0,c.VK)((()=>Boolean(g&&o.id===g.id)),[g,o]),v=(0,c.VK)((()=>{const e=s?s.inverseName:d;return e||(null!=g&&g.isDefined()?S.aI(h,{sourceCollection:g.getModel(),isSelfRelation:f,targetCollectionStore:o,createUnique:!0}):"")}),[g,h,d,f,s,o]),C=(0,c.VK)((()=>null!=g&&g.isDefined()?v===S.aI(h,{sourceCollection:g.getModel(),isSelfRelation:f,targetCollectionStore:o,createUnique:!1}):void 0),[g,h,v,f,o]),b=Boolean(!f&&u&&(!y||y&&C)),w=(0,p.yK)((e=>({preview:{background:e.inputBackground,marginLeft:14,marginRight:14,padding:b?"42px 12px":12,boxShadow:e.inputBoxShadow,borderRadius:3,display:"flex",flexDirection:"column",justifyContent:"center"},condensedView:{height:22,display:"flex",justifyContent:"center",alignItems:"center"},condensedProperties:{width:33,height:y?20:10,margin:"0px 12px",display:"flex",flexDirection:"column",justifyContent:"center"},databasesRow:{height:22}})),[b,y]);return g?n()(_.Z,{title:n()(M.Z,{isSmall:!0,isSecondaryColor:!0},void 0,n()(m.FormattedMessage,{defaultMessage:"Preview",id:"database.viewSettings.setupRelationTab.relationVisualizer.title"})),disableMobileBorders:!0},void 0,n()("div",{style:w.preview},void 0,b?n()("div",{style:w.condensedView},void 0,n()(k,{collectionStore:g,condensedView:!0}),n()("div",{style:w.condensedProperties},void 0,n()(I,{propertyName:i||(null==r?void 0:r.name),condensedView:!0}),y&&n()(I,{propertyName:v,condensedView:!0,isInverse:!0})),n()(k,{collectionStore:o,condensedView:!0,isTarget:!0})):a.createElement(a.Fragment,null,n()(I,{propertyName:i||(null==r?void 0:r.name),bidirectional:f&&!y}),n()("div",{style:w.databasesRow},void 0,n()(k,{collectionStore:g}),n()(k,{collectionStore:o,isTarget:!0})),y&&n()(I,{propertyName:v,isInverse:!0})))):null}function I(e){window.__c={n:"RelationVisualizerProperty"};const{propertyName:t,bidirectional:o,isInverse:r,condensedView:i}=e,s=(0,p.yK)((e=>({propertyLabel:{fontSize:12,wordBreak:"break-word",...b.Z.textOverflowStyle,maxWidth:200,alignSelf:"center",color:e.mediumTextColor,fill:e.mediumIconColor},arrow:{width:136,height:25,alignSelf:"center",transform:r?"rotate(180deg)":void 0,margin:r?"6px 12px 0px 6px":"0px 6px 6px 6px",opacity:.3,fill:e.regularIconColor},smallArrow:{height:8,paddingLeft:1,marginTop:r?2:void 0,display:"inherit",transform:r?"rotate(180deg)":void 0,opacity:.3,fill:e.regularIconColor}})),[r]),l=n()("div",{style:s.propertyLabel},void 0,t||"");return a.createElement(a.Fragment,null,!r&&!i&&l,i?d.Z.collectionRelationSmallArrowRight(s.smallArrow):o?d.Z.collectionSelfRelationArrow(s.arrow):d.Z.collectionRelationArrow(s.arrow),r&&!i&&l)}function k(e){window.__c={n:"RelationVisualizerDatabase"};const{collectionStore:t,condensedView:o,isTarget:r}=e,i=(0,c.VK)((()=>t.getIcon()),[t]),s=(0,p.yK)((e=>({wrapper:{display:"flex",alignItems:"center",padding:2,color:e.mediumTextColor,fill:e.mediumIconColor,position:o?void 0:"absolute",left:o?void 0:r?"72%":"28%",transform:o?void 0:"translate(-50%, 0)",width:"fit-content"},icon:{marginRight:4,width:12,height:12},title:{fontSize:12,wordBreak:"break-word",...b.Z.textOverflowStyle,maxWidth:100}})),[o,r]);return n()("div",{style:s.wrapper},void 0,i?n()(w.Z,{icon:i,isEmptyPage:!1,size:12,disabled:!0,style:s.icon}):d.Z.collectionTable(s.icon),n()(x.Z,{store:t,style:s.title}))}var T=o(42922),F=o(68894);function Z(e){window.__c={n:"CollectionSettingsInverseRelationConfig"};const{collectionContextStore:t,property:o,propertyName:r,targetCollectionStore:i,onSubmit:s,buttonContents:b,isInitialPropertyName:w,temporaryInverseState:M,setTemporaryInverseState:I,from:k}=e,F=(0,l.O7)(),Z=(0,c.VK)((()=>o?S.KV(t,o):void 0),[t,o]),A=(0,c.VK)((()=>t.collectionStore()),[t]),V=(0,c.VK)((()=>Boolean(A&&A.id===i.id)),[A,i]),B=(0,c.VK)((()=>Boolean(o?S.OP(t,o,i):void 0)),[t,o,i]),O=(0,c.VK)((()=>{if("relation"!==(null==Z?void 0:Z.type))return"";const e=Z.property;if(!e||e===o)return"";const t=i.getRole();if(!t||!u.YX(t))return"";const r=i.getSchema()[e];return(null==r?void 0:r.name)||""}),[i,o,Z]),N=(0,c.VK)((()=>"relation"===(null==Z?void 0:Z.type)&&Z.autoRelate?Z.autoRelate:{enabled:!1}),[Z]),D=(0,c.VK)((()=>Boolean(S.gZ(i))),[i]),E=(0,c.VK)((()=>Boolean((null==A?void 0:A.getDatabaseType())&&o&&(null==A?void 0:A.isTypedProperty(o)))),[A,o]),L=(0,c.VK)((()=>t.contextType),[t]),q=(0,p.yK)((e=>({errorLabel:{margin:"0px 14px",color:e.errorText},helpIcon:{width:16,fill:e.lightIconColor,marginLeft:6}})),[]),K=(0,a.useMemo)((()=>M?M.hasInverseRelation:B),[M,B]),G=(0,a.useMemo)((()=>M?M.inverseName:O),[M,O]),U=(0,a.useMemo)((()=>M?M.autoRelate:N),[M,N]),W=(0,a.useCallback)((()=>{const e=null!=A&&A.isSyncedCollection()?U:K?{enabled:!1}:U;I({hasInverseRelation:!K,inverseName:K?void 0:G,autoRelate:e}),o&&h.$q({environment:F,collectionContextStore:t,property:o,from:"collectionPage"===L?"page_properties":"view_settings",action:K?"relation_toggle_inverse_off":"relation_toggle_inverse_on",is_self_relation:V})}),[I,K,G,U,t,A,o,L,V,F]),z=(0,a.useCallback)((e=>{I({hasInverseRelation:!0,inverseName:e.target.value,autoRelate:U})}),[I,U]),$=(0,a.useCallback)((e=>{const r=null!=U&&U.enabled?{enabled:!1}:{enabled:!0,bot_id:e};I({hasInverseRelation:K,inverseName:G,autoRelate:r}),o&&h.$q({environment:F,collectionContextStore:t,property:o,from:"collectionPage"===L?"page_properties":"view_settings",action:r.enabled?"auto_relation_toggle_on":"auto_relation_toggle_off"})}),[o,I,t,L,G,K,U,F]),H=(0,a.useCallback)((e=>{(0,g.ZP)({event:e,context:g.Af.CollectionSettingsClick,callback:s})}),[s]),Y=n()("div",{style:{display:"flex",alignItems:"center",whiteSpace:"pre"}},void 0,n()(m.FormattedMessage,V?{id:"database.viewSettings.setupRelationTab.selfRelation.reverse",defaultMessage:"Separate directions"}:{id:"database.viewSettings.setupRelationTab.relation.reverse",defaultMessage:"Show on {databaseName}",values:{databaseName:n()(x.Z,{style:{display:"inline"},store:i})}}),n()(v.Z,{render:e=>a.createElement("div",e,d.Z.help(q.helpIcon)),style:{width:200},placement:y.u.Bottom,textWrap:!0,renderTooltip:()=>n()(m.FormattedMessage,!D||E?{defaultMessage:"Cannot edit target database.",id:"database.viewSettings.setupRelationTab.inverseDisabledWarning.title"}:V?{defaultMessage:"Create separate properties for each direction of a two-way relation. Useful for modeling Parent task/Sub-tasks, Blocked by/Blocking, and more.",id:"database.viewSettings.setupRelationTab.inverseRelationTooltip.selfRelation"}:{defaultMessage:"Create a property on {databaseName} showing backlinks to the current database",id:"database.viewSettings.setupRelationTab.inverseRelationTooltip",values:{databaseName:n()(x.Z,{style:{display:"inline"},store:i})}})}));return a.createElement(a.Fragment,null,!(V&&B)&&!k&&n()(f.Z,{title:Y,on:K,focused:!1,onClick:W,disabled:!D||V&&B||E,textWrapperStyle:{opacity:1}}),n()(R,{collectionContextStore:t,targetCollectionStore:i,isSelfRelation:V,temporaryInverseState:M,hasInverseRelation:B,inverseRelationName:O,disabled:!D||E,onChange:z,from:k}),n()(C,{handleAutoRelateToggle:$,temporaryAutoRelateState:null==M?void 0:M.autoRelate,collectionContextStore:t,autoRelate:N,targetCollectionStore:i,hasInverseRelation:K}),(()=>{if("relation"!==(null==Z?void 0:Z.type))return!0;if(M){if(M.hasInverseRelation!==B)return!0;if(M.inverseName&&M.inverseName!==O)return!0;if(M.autoRelate&&M.autoRelate.enabled!==N.enabled)return!0}return!1})()&&n()(_.Z,{},void 0,n()(T.Z,{style:{display:"flex",margin:"6px 12px 0px 12px"},onClick:H},void 0,b)),"subitem"!==k&&"timeline_arrows_by"!==k&&n()(P,{propertySchema:Z,propertyName:r,collectionContextStore:t,targetCollectionStore:i,temporaryInverseState:M,hasInverseRelation:B,inverseRelationName:O,isInitialPropertyName:w}))}function R(e){window.__c={n:"CollectionSettingsInverseRelationName"};const{collectionContextStore:t,targetCollectionStore:o,isSelfRelation:r,temporaryInverseState:i,hasInverseRelation:a,inverseRelationName:l,disabled:p,onChange:d,from:u}=e,h=(0,m.useIntl)(),g=(0,c.VK)((()=>{const e=t.collectionStore();return null!=e&&e.isDefined()?S.aI(h,{sourceCollection:e.getModel(),isSelfRelation:r,targetCollectionStore:o,createUnique:!0,from:u}):h.formatMessage({id:"database.viewSettings.setupRelationTab.inverseRelationName.placeholder",defaultMessage:"Related to target"})}),[t,h,r,o,u]);return(i?i.hasInverseRelation:a)?n()(_.Z,{title:!u&&n()(M.Z,{isSmall:!0,isSecondaryColor:!0},void 0,n()(m.FormattedMessage,{defaultMessage:"Related property on {databaseName}",id:"database.viewSettings.setupRelationTab.inverseRelationNameInput.title",values:{databaseName:n()(x.Z,{style:{display:"inline"},store:o})}}))},void 0,n()(F.ZP,{value:"subitem"!==u&&"timeline_arrows_by"!==u?(null==i?void 0:i.inverseName)||l:g,placeholder:g,onChange:d,onBlur:s().identity,onSubmit:s().identity,focusInitial:!1,selectAll:!1,disabled:p})):null}},71554:(e,t,o)=>{o.d(t,{C:()=>S,U:()=>y});var r=o(23174),n=o.n(r),i=o(67294),s=o(480),a=o(99036),l=o(5366),c=o(77162),p=o(64434),d=o(12359),u=o(52821);function m(e,t,o){return"1"===e?n()(l.FormattedMessage,"relation"===t?o&&!0===o?{defaultMessage:"1 item",id:"database.viewSettings.collectionPropertyLimitHelpers.limitOne.connectedRelation"}:{defaultMessage:"1 page",id:"database.viewSettings.collectionPropertyLimitHelpers.limitOne.relation"}:{defaultMessage:"1 {type}",id:"database.viewSettings.collectionPropertyLimitHelpers.limitOne",values:{type:u.SO[t]}}):"no_limit"===e?n()(l.FormattedMessage,{defaultMessage:"No limit",id:"database.viewSettings.collectionPropertyLimitHelpers.noLimit"}):void 0}function h(e,t,o){return{key:e,title:m(e,t,o)}}var g=o(13709);function S(e){window.__c={n:"CollectionSettingsLimitOptions"};const{property:t,propertySchema:o,collectionContextStore:r}=e,l=(0,s.O7)(),u=(0,i.useCallback)((e=>{const n=r.collectionStore();if(!n||!(0,a.en)(o))return;const i={...o,limit:Number(e)?1:void 0};d.createAndCommit({userAction:"CollectionSettingsLimitOptions.handleLimitChange",environment:l,perform:e=>{p.xO({environment:l,collectionStore:n,update:{[t]:i},transaction:e})}});const s=Number(e)?`${o.type}_toggle_limit_on`:`${o.type}_toggle_limit_off`;c.$q({environment:l,collectionContextStore:r,property:t,from:"view_settings",action:s})}),[r,l,t,o]);return(0,a.en)(o)?"relation"===o.type&&o.connectedRelation?n()(y,{propertyType:o.type,connectedRelation:!0,selectedKey:o.limit?"1":"no_limit",onChange:u}):n()(y,{propertyType:o.type,selectedKey:o.limit?"1":"no_limit",onChange:u}):null}function y(e){const{propertyType:t,selectedKey:o,connectedRelation:r,onChange:i}=e;return n()(g.Z,{title:n()(l.FormattedMessage,{defaultMessage:"Limit",id:"database.viewSettings.collectionPropertyLimitHelpers.limit"}),selectedKey:o,popupStyle:{minWidth:190},options:[h("1",t,r),h("no_limit",t)],onChange:i})}},26122:(e,t,o)=>{o.d(t,{Z:()=>u});var r=o(23174),n=o.n(r),i=(o(67294),o(83355)),s=o(49085),a=o(27153),l=o(33929),c=o(68894),p=o(23321);class d extends i.Z{constructor(){super(...arguments),this.storeTypes={inputStore:s.default.createClass("")},this.handleBlur=()=>{this.props.onBlur(this.stores.inputStore.state)},this.handleSubmit=()=>{this.props.onSubmit(this.stores.inputStore.state)},this.showMediaPicker=e=>{if(!this.props.iconButton)return;const t=l.default.getIntl(),{onSubmit:o,enforceIconColor:r,includeEmojiTab:n}=this.props.iconButton;a.$(this.environment,{originRect:e.target.getBoundingClientRect(),originGap:3,popupHeight:p.ZP.desktopIconPickerOnlyPopupHeight,popupWidth:p.ZP.desktopIconPickerOnlyPopupWidth,showArrow:!0,title:t.formatMessage({defaultMessage:"Icon",id:"mediaPicker.tabs.icon"}),currentTab:"icon",tabs:n?[{type:"emoji",onChange:(e,t)=>{o(e),t&&t.keepVisible||a.Z()}},{type:"icon",enforceIconColor:r,onChange:(e,t)=>{o(e),t&&t.keepVisible||a.Z()}}]:[{type:"icon",enforceIconColor:r,onChange:(e,t)=>{o(e),t&&t.keepVisible||a.Z()}}],onDelete:()=>{o(),a.Z()}})}}willMount(e){super.willMount(e),this.stores.inputStore.setState(e.initialValue)}willUnmount(){const{initialValue:e,onBlur:t}=this.props,o=this.stores.inputStore.state;e!==o&&t(o)}renderComponent(){const{placeholder:e,focusInitial:t,selectAll:o,disabled:r,inputOuterStyle:i,iconButton:s}=this.props,{inputStore:a}=this.stores,l=a.state;return n()(c.ZP,{focusInitial:t,selectAll:o,value:l,onChange:e=>{a.setState(e.target.value)},onBlur:this.handleBlur,onSubmit:this.handleSubmit,placeholder:e,disabled:r,textWrapperStyle:{opacity:r?.7:void 0},inputOuterStyle:i,left:s&&n()(c.DO,{icon:s.icon,iconStyle:s.iconStyle,onClick:this.showMediaPicker,disabled:r})})}}d.displayName="CollectionSettingsNameInput";const u=d},41837:(e,t,o)=>{o.d(t,{mJ:()=>_t,ZP:()=>Mt,sY:()=>wt});var r=o(10434),n=o.n(r),i=o(23174),s=o.n(i),a=(o(21703),o(67294)),l=o(73935),c=o(83355),p=o(1302),d=o(49085),u=o(99036),m=o(80951),h=o(8848),g=o(39068),S=o(79362),y=o(53397),f=o(97880),v=o(82990),C=o(5366),b=o(77162),w=o(16956),x=o(5149),_=o(87085),M=o(64434),P=o(96802),I=o(80402),k=o(12359),T=o(93959),F=o(52821),Z=o(78316),R=o(99417),A=o(75081),V=o(33929),B=o(33665),O=o(77546),N=o(85644),D=o(67695),E=o(61766),L=o(10161),q=o(33846),K=o(13162),G=o(27788),U=o(480),W=o(81954),z=o(98963),$=o(9953),H=o(66580),Y=o(68910),j=o(68216),Q=o(68894),X=o(72495);function J(e){window.__c={n:"CollectionSettingsButtonOptions"};const{collectionContextStore:t,propertySchema:o,propertyId:r}=e,n=(0,U.O7)(),i=n.currentUser.id,l=(0,W.Kw)(t.permissionScopes),c=(0,W.VK)((()=>t.collectionStore()),[t]),p=(0,W.VK)((()=>o.automation_id&&c?j.Mz.createChildStore(c,{table:z.cv,id:o.automation_id,spaceId:c.getSpaceId()}):void 0),[c,o]),d=(0,W.VK)((()=>null==p?void 0:p.getTrigger()),[p]),u=(0,a.useMemo)((()=>{if(p)return new Y.L({type:"button_property",persisted:!0,automationStore:p,collectionContextStore:t,propertyId:r,propertySchema:o,intl:V.default.getIntl(),parentRecordStore:p,currentUserId:i})}),[r,o,p,t,i]),m=(0,W.VK)((()=>(null==p?void 0:p.getNameStore().getValue())??""),[p]),h=(0,a.useCallback)((e=>{if(!p)return;const t=e.currentTarget.value;k.createAndCommit({userAction:"CollectionSettingsButtonOptions.setName",environment:n,perform:e=>{$.sO({store:p.getNameStore(),transaction:e,value:t})}})}),[p,n]);return c&&p&&d&&"button"===d.type&&u?a.createElement(a.Fragment,null,s()(X.Z,{topBorder:!0,title:s()(C.FormattedMessage,{id:"database.buttonProperty.label",defaultMessage:"Label"})},void 0,s()(Q.ZP,{disabled:!l.canConfigureCollection,placeholder:V.default.formatMessage(ee.inputPlaceholder),value:m,onChange:h})),s()(X.Z,{title:s()(C.FormattedMessage,{id:"database.buttonProperty.actions",defaultMessage:"Actions"})},void 0,s()(H.AutomationButtonActionList,{contextStore:u,disabled:!l.canConfigureCollection,suppressErrors:!0,onActionAdded:()=>{}}),s()("div",{}))):null}const ee=(0,C.defineMessages)({inputPlaceholder:{defaultMessage:"Type a name for this button...",id:"database.buttonProperty.label.inputPlaceholder"}});var te=o(13991),oe=o(40506),re=o(11843),ne=o(13709);class ie extends c.Z{constructor(){super(...arguments),this.handleDateFormatChange=e=>{const{collectionContextStore:t,property:o}=this.props,r=t.collectionStore(),n=this.getPropertySchema();if(!r||!n)return;const i={...n,date_format:e};k.createAndCommit({userAction:"CollectionSettingsDateOptions.handleDateFormatChange",environment:this.environment,perform:e=>{M.xO({environment:this.environment,collectionStore:r,update:{[o]:i},transaction:e})}}),b.$q({environment:this.environment,collectionContextStore:t,property:o,from:"view_settings",action:"date_change_format"})},this.handleClockFormatChange=e=>{const{collectionContextStore:t,property:o}=this.props,r=t.collectionStore(),n=this.getPropertySchema();if(!r||!n)return;const i=this.getTimeFormatOptions()[e],s={...n,time_format:i};k.createAndCommit({userAction:"CollectionSettingsDateOptions.handleClockFormatChange",environment:this.environment,perform:e=>{M.xO({environment:this.environment,collectionStore:r,update:{[o]:s},transaction:e})}}),b.$q({environment:this.environment,collectionContextStore:t,property:o,from:"view_settings",action:"date_change_time_format"})},this.getTimeFormatOptions=()=>(0,re.E)(te.SP).time}renderComponent(){const{intl:e}=this.props,t=this.getPropertySchema();if(!t)return;const o=t.date_format||oe.sF,r=t.time_format||oe.c_,n=this.getClockFormatFromTimeFormat(r);return a.createElement(a.Fragment,null,s()(ne.Z,{title:s()(C.FormattedMessage,{defaultMessage:"Date format",id:"database.viewSettings.dateOptions.dateFormat"}),selectedKey:o,popupStyle:{minWidth:190},options:oe.Zy.map((t=>({key:t,title:e.formatMessage(oe.fy[t])}))),onChange:this.handleDateFormatChange}),s()(ne.Z,{title:s()(C.FormattedMessage,{defaultMessage:"Time format",id:"database.viewSettings.dateOptions.timeFormat"}),selectedKey:n,popupStyle:{minWidth:190},options:oe.L7.map((t=>({key:t,title:e.formatMessage(oe.Fi[t])}))),onChange:this.handleClockFormatChange}))}getPropertySchema(){const{collectionContextStore:e,property:t}=this.props,o=e.normalizedSchemaStore.state[t];if(o)return"date"===o.type||"created_time"===o.type||"last_edited_time"===o.type||"last_visited_time"===o.type?o:void 0}getClockFormatFromTimeFormat(e){const t=this.getTimeFormatOptions();for(const o in t)if(t[o]===e)return o;return"12h"}}ie.displayName="CollectionSettingsDateOptions";const se=(0,C.injectIntl)(ie);o(57658);function ae(e){window.__c={n:"CollectionSettingsDefaultPersonPicker"};const{collectionContextStore:t,property:o,propertySchema:r}=e,n=(0,U.O7)(),i=(0,a.useCallback)((e=>{const i={...r,default:"created_by"===e?"created_by":void 0},s=t.collectionStore();if(!s)return;const a=[],l={pointer:s.pointer,command:"update",path:["schema",o],args:{default:e}};a.push(l),M.HW({environment:n,collectionStore:s,performTransaction:e=>{for(const t of a)k.applyOperation({store:(0,j.Kv)(s,t.pointer),operation:t,transaction:e})}}),k.createAndCommit({userAction:"CollectionSettingsDefaultPersonPicker.handleChange",environment:n,perform:e=>{M.xO({environment:n,collectionStore:s,update:{[o]:i},transaction:e})}})}),[t,n,o,r]);return s()(ne.Z,{title:s()(C.FormattedMessage,{defaultMessage:"Default",id:"CollectionSettingsDefaultPersonPicker.default.title"}),selectedKey:r.default?"created_by":"no_default",popupStyle:{minWidth:190},options:[{key:"no_default",title:s()(C.FormattedMessage,{defaultMessage:"No default",id:"CollectionSettingsDefaultPersonPicker.options.noDefault"})},{key:"created_by",title:s()(C.FormattedMessage,{defaultMessage:"Created by",id:"CollectionSettingsDefaultPersonPicker.options.creator"}),icon:y.Z.person({width:16})}],onChange:i})}var le=o(21202),ce=o(17809),pe=o(77907),de=o(42917),ue=o(31945),me=o(44532),he=o(73240),ge=o(72589);class Se extends c.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:E.Z},this.renderPopup=e=>{const{collectionContextStore:t,property:o}=this.props,r=t.collectionStore();if(!r)return;const n=t.normalizedSchemaStore.state,i=n[o];if("formula"!==(null==i?void 0:i.type))return;const a=r.pointer.spaceId,l=Array.from(t.resultSet.state.blockIds.values())[0],c=l?j.G.createChildStore(r,{table:le.iU,id:l,spaceId:a}):void 0,p=Boolean(r.getDatabaseType()&&r.isTypedProperty(o));return(0,ce.formulasPrototypeEnabled)()?s()(pe.DependencyConsumer,{dependency:pe.deps.formulas},void 0,(t=>s()(ge.Z,{handleClose:e.close,property:o,getRecordValue:r.getRecordValue,propertySchema:i,collectionStore:r,handleSave:this.handleFormula2CodeChange,formulas:t,disabled:p}))):s()(he.default,{property:o,schema:n,analyticsFrom:"view_settings",exampleBlock:null==c?void 0:c.getValue(),disabled:p,onChange:this.handleFormulaChange,onClickCancel:e.close})},this.handleFormula2CodeChange=e=>{const{newValue:t,newType:o,propertySchema:r,property:n,collectionStore:i}=e,s=t?{...r,formula2:{code:t,result_type:o},version:"v2"}:{...r,formula2:void 0,version:"v2"};k.createAndCommit({userAction:"CollectionSettingsFormulaOptions.handleFormulaChange",environment:this.environment,perform:e=>{M.xO({environment:this.environment,collectionStore:i,update:{[n]:s},transaction:e})}})},this.handleFormulaChange=e=>{let{propertySchema:t,close:o}=e;const{collectionContextStore:r,property:n}=this.props,i=r.collectionStore();i&&(k.createAndCommit({userAction:"CollectionSettingsFormulaOptions.handleFormulaChange",environment:this.environment,perform:e=>{M.xO({environment:this.environment,collectionStore:i,update:{[n]:t},transaction:e})}}),o&&this.stores.buttonPopupStore.reset(),b.$q({environment:this.environment,collectionContextStore:r,property:n,from:"view_settings",action:"formula_edit"}))}}renderComponent(){const{device:e}=this.environment,{buttonPopupStore:t}=this.stores;return s()(ue.ZP,{popupType:e.isMobile?me.kQ.SlideUp:me.kQ.Popup,alignmentToOrigin:ue.vR.End,renderOrigin:e=>a.createElement(de.Z,n()({title:s()(C.FormattedMessage,{defaultMessage:"Formula",id:"database.viewSettings.formulaOptions.title"}),right:s()(C.FormattedMessage,{defaultMessage:"Edit",id:"database.viewSettings.formulaOptions.edit"}),showChevron:!0,rotateChevron:t.state.open},e)),render:this.renderPopup,buttonPopupStore:t})}}Se.displayName="CollectionSettingsFormulaOptions";const ye=(0,C.injectIntl)(Se);var fe=o(21269),ve=o(71554),Ce=o(13005),be=o(26122),we=o(24405),xe=o(35011),_e=o(34299),Me=o(78106),Pe=o(32056),Ie=o(66890),ke=o(16187),Te=o(64921),Fe=o(74194),Ze=o(85248),Re=o(78942),Ae=o(24006),Ve=o(58573),Be=o(15157),Oe=o(87279),Ne=o(29798),De=o(52275),Ee=o(78140),Le=o(32163);class qe extends c.Z{constructor(){super(...arguments),this.storeTypes={numberFormatFilterStore:d.default.createClass(""),menuListStore:Ne.Z},this.handleNumberFormatFilterChange=e=>{this.stores.numberFormatFilterStore.setState(e.target.value),this.stores.menuListStore.setState({...this.stores.menuListStore.state,focus:{section:0,indexLocal:0,indexGlobal:0}})},this.handleNumberFormatChange=e=>{const{collectionStore:t,property:o,schema:r,onClose:n}=this.props,i=r[o];if(!i)return;if("number"!==i.type&&"formula"!==i.type)return;const s={...i,number_format:e,..."percent"===e&&void 0!==(null==i?void 0:i.show_as)?{show_as:{...null==i?void 0:i.show_as,maxValue:1}}:{}};"number"===i.type&&(0,Pe.b3)(e)&&Be.Z.set({userId:this.environment.currentUser.id,key:qe.localLastUsedCurrencyPreferenceKey,value:e}),k.createAndCommit({userAction:"NumberFormatMenu.handleNumberFormatChange",environment:this.environment,perform:e=>{M.xO({environment:this.environment,collectionStore:t,update:{[o]:s},transaction:e})}}),null==n||n()}}renderComponent(){const{device:e}=this.environment;let t;t=e.isMobile?{menuType:Oe.og.ActionSheet}:{menuType:Oe.og.Popup};const o=!e.isMobile&&s()(X.Z,{isInput:!0},void 0,s()(Q.ZP,{value:this.stores.numberFormatFilterStore.state,onChange:this.handleNumberFormatFilterChange,focus:!0,focusAfterAnimation:!0,placeholder:V.default.getIntl().formatMessage({defaultMessage:"Filter formats…",id:"blockPropertyValue.filterForNumberFormats.placeholder"}),preventCaptureDeleteWhenEmpty:!0}));return a.createElement(Ee.Z,n()({},t,{header:o}),s()(Le.Z,{type:Le.i.Vertical,initialFocus:0,sections:[{key:0,render:e=>a.createElement(X.Z,e),items:this.getMenuItems()}],store:this.stores.menuListStore}))}getMenuItems(){const e=Be.Z.get({userId:this.environment.currentUser.id,key:qe.localLastUsedCurrencyPreferenceKey});return(0,Ve.ZP)(this.stores.numberFormatFilterStore.state,(0,Pe.jD)(e),(e=>e)).map((e=>({key:e,render:t=>this.renderMenuItem(e,t),action:()=>this.handleNumberFormatChange(e)})))}renderMenuItem(e,t){return a.createElement(De.Z,n()({},t,{title:(0,Pe.Bo)(V.default.getIntl(),e)}))}}qe.displayName="NumberFormatMenu",qe.localLastUsedCurrencyPreferenceKey="LastUsedCurrency";const Ke=qe;var Ge=o(9050);function Ue(e){let{collectionContextStore:t,property:o}=e;window.__c={n:"CollectionSettingsNumberOptions"};const{propertySchema:r,numberFormat:n}=(0,W.VK)((()=>{const e=t.collectionStore(),r=t.normalizedSchemaStore.state[o];if(!r||!e)return{};if("number"===r.type)return{propertySchema:r,numberFormat:r.number_format??Pe.dk};if("formula"===r.type)return"number"===(0,xe.mm)(r)||r.formula2&&(0,ce.formulasPrototypeEnabled)()&&"number"===(0,Me.aL)(r.formula2.result_type).type?{propertySchema:r,numberFormat:r.number_format??Pe.dk}:{};if("rollup"===r.type){var n;if(r.aggregation&&"show_unique"!==r.aggregation){var i;const n=null===(i=(0,_e.gT)({property:o,schema:t.normalizedSchemaStore.state,getRecordValue:e.getRecordValue}))||void 0===i?void 0:i.targetPropertySchema;if(void 0===(null==n?void 0:n.type))return{};const s=(0,ke.SD)(r.aggregation,(0,ke.SD)(r.aggregation,"number_format"in n?n.number_format:void 0));return s?{propertySchema:r,numberFormat:s}:{}}const s=null===(n=(0,_e.gT)({property:o,schema:t.normalizedSchemaStore.state,getRecordValue:e.getRecordValue}))||void 0===n?void 0:n.targetPropertySchema;if("number"===(null==s?void 0:s.type)||"formula"===(null==s?void 0:s.type)&&"number"===(0,xe.r9)(s))return{propertySchema:r,numberFormat:s.number_format??Pe.dk}}return{}}),[t,o]);if(!r)return null;const i="rollup"!==r.type;return a.createElement(a.Fragment,null,i?s()(We,{numberFormat:n,property:o}):null,s()(ze,{property:o,propertySchema:r,numberFormat:n}))}function We(e){let{numberFormat:t,property:o}=e;window.__c={n:"NumberFormatSection"};const r=(0,Ie.Y$)(),i=(0,W.qz)(void 0,E.Z),l=(0,C.useIntl)(),c=(0,U.O7)();return s()(ue.ZP,{popupType:c.device.isMobile?me.kQ.SlideUp:me.kQ.Popup,alignmentToOrigin:ue.vR.End,renderOrigin:e=>a.createElement(de.Z,n()({title:s()(C.FormattedMessage,{defaultMessage:"Number format",id:"database.viewSettings.numberOptions.numberFormat"}),right:s()("span",{style:{...v.Z.textOverflowStyle}},void 0,(0,Pe.Bo)(l,Pe.dX.find((e=>e===t))??Pe.dk)),showChevron:!0,rotateChevron:i.state.open},e)),render:e=>{const t=r.collectionStore(),n=r.normalizedSchemaStore.state;if(t)return s()(Ke,{collectionStore:t,property:o,schema:n,onClose:e.close})},buttonPopupStore:i})}function ze(e){let{property:t,propertySchema:o,numberFormat:r}=e;window.__c={n:"NumberShowAsSection"};const{show_as:i}=o,l=(0,Ie.Y$)(),c=(0,U.O7)(),p=(0,we.Fg)(),d=a.useRef({color:(null==i?void 0:i.color)??"green",maxValue:(null==i?void 0:i.maxValue)??100,showValue:(null==i?void 0:i.showValue)??!0}),u={type:(null==i?void 0:i.type)??"number",color:(null==i?void 0:i.color)??d.current.color,maxValue:(null==i?void 0:i.maxValue)??d.current.maxValue,showValue:(null==i?void 0:i.showValue)??d.current.showValue},m=(0,we.yK)((e=>({card:{boxSizing:"content-box",height:36,flex:1,margin:1,boxShadow:`0 0 0 1px ${e.regularDividerColor}`,color:e.mediumTextColor,borderRadius:3,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",paddingLeft:12,paddingRight:12,paddingTop:6,paddingBottom:6,cursor:"pointer"},selectedCard:{boxShadow:`0 0 0 2px ${e.blueColor}`,color:e.blueColor},cardVisual:{height:20,marginBottom:4,width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},cardText:{lineHeight:1,fontSize:12},progressBar:{width:"100%"},showAsTypeOption:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginLeft:16,marginRight:16,marginTop:6,gap:12},extraOptionStyle:{display:"flex",flexDirection:"row",alignItems:"center",paddingLeft:16,paddingRight:16,gap:16,height:28,width:"100%"}})),[]),g=(0,a.useCallback)((e=>{const r=l.collectionStore();o&&r&&(k.createAndCommit({userAction:"CollectionSettingsProperty.handleNumberShowAsChange",environment:c,perform:n=>{M.xO({environment:c,collectionStore:r,update:{[t]:{...o,show_as:e}},transaction:n})}}),b.$q({environment:c,collectionContextStore:l,property:t,from:"view_settings",action:"number_change_show_as",number_show_as:(null==e?void 0:e.type)??"number"}))}),[l,c,t,o]),S=[{key:"number",visual:s()("div",{style:{fontSize:16,fontWeight:v.Z.fontWeight.medium}},void 0,"42"),text:s()(C.FormattedMessage,{defaultMessage:"Number",id:"database.viewSettings.numberOptions.showAsNumber"})},{key:"bar",visual:s()(Ze.k,{percentage:50,filledColor:"bar"===u.type?p.blueColor:p.regularDividerColor,unfilledColor:"bar"===u.type?p.accentColors.blue[50]:p.regularDividerColor,style:{width:"100%"}}),text:s()(C.FormattedMessage,{defaultMessage:"Bar",id:"database.viewSettings.numberOptions.showAsBar"})},{key:"ring",visual:s()(Re.e,{size:20,percentage:40,filledColor:"ring"===u.type?p.blueColor:p.regularDividerColor,unfilledColor:"ring"===u.type?p.accentColors.blue[50]:p.accentColors.gray[100],style:{width:"100%"}}),text:s()(C.FormattedMessage,{defaultMessage:"Ring",id:"database.viewSettings.numberOptions.showAsRing"})}],f=s()("div",{style:m.showAsTypeOption},void 0,S.map((e=>{const t=u.type===e.key;return s()(Te.Z,{onClick:()=>{const t="number"===e.key?void 0:{type:e.key,color:u.color,maxValue:"percent"===r?1:u.maxValue,showValue:u.showValue};void 0!==t&&(d.current=t),g(t)},style:{...m.card,...t?m.selectedCard:{}}},e.key,s()("div",{style:m.cardVisual},void 0,e.visual),s()("div",{style:m.cardText},void 0,e.text))}))),w=e=>{const t="number"!==u.type?{...u,type:u.type,...e}:void 0;void 0!==t&&(d.current=t),g(t)},x="number"!==u.type?s()("div",{style:m.extraOptionStyle},void 0,s()("div",{style:{flex:6,fontSize:14}},void 0,s()(C.FormattedMessage,{defaultMessage:"Color",id:"database.viewSettings.numberOptions.color"})),s()("div",{style:{display:"flex",flexWrap:"wrap",flex:6,gap:7}},void 0,s()(ue.ZP,{popupType:c.device.isMobile?ue.Z4.SlideUp:ue.Z4.Popup,renderOrigin:e=>a.createElement("div",n()({style:{width:"100%",display:"flex",justifyContent:"end"}},e),s()(Ge.Z,{color:u.color,focused:!1,buttonStyle:{width:"auto",marginLeft:0,marginRight:0,borderRadius:3,color:p.lightTextColor},style:{minHeight:36},right:y.Z.chevronDown({width:12,height:12})})),render:e=>{const t=h.AP.map((t=>s()(Ge.Z,{color:t,checkState:t===u.color,focused:!1,style:{width:"100%"},onClick:()=>{w({color:t}),e.close()}},t)));return s()("div",{style:{minWidth:150,paddingTop:8,paddingBottom:8}},void 0,t)}}))):null,_="number"!==u.type?"percent"!==r&&s()("div",{style:m.extraOptionStyle},void 0,s()("div",{style:{flex:6,fontSize:14}},void 0,s()(C.FormattedMessage,{defaultMessage:"Divide by",id:"database.viewSettings.numberOptions.divideBy"})),s()("div",{style:{flex:6}},void 0,s()(Fe.Z,{value:u.maxValue.toString(),onChange:e=>{const t=e.target.value.replace(/[^0-9]/g,""),o=parseFloat(t);!isNaN(o)&&o>0&&w({maxValue:o})},inputStyle:{textAlign:"right"}}))):null,P="number"!==u.type?s()("div",{style:m.extraOptionStyle},void 0,s()("div",{style:{flex:6,fontSize:14}},void 0,s()(C.FormattedMessage,{defaultMessage:"Show number",id:"database.viewSettings.numberOptions.showValue"})),s()("div",{style:{flex:6,display:"flex",justifyContent:"flex-end"}},void 0,s()(Ae.Z,{on:u.showValue,onClick:()=>{w({showValue:!u.showValue})},disabled:!1}))):null,I=Boolean(x||_||P),T=s()("div",{style:{backgroundColor:p.accentColors.gray[30],borderRadius:5,marginTop:I?12:0,marginLeft:I?14:0,marginRight:I?14:0,paddingTop:I?12:0,paddingBottom:I?12:0,maxHeight:I?1e3:0,transition:"max-height 0.5s ease-in-out",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"center",gap:8}},void 0,x,_,P);return s()(X.Z,{title:s()(C.FormattedMessage,{defaultMessage:"Show as",id:"database.viewSettings.numberPercentOptions.showAs"}),topBorder:!0,disableMobileBorders:!0},void 0,f,T,s()("div",{style:{marginTop:12,marginLeft:18,marginRight:18,fontSize:12,color:p.lightTextColor}},void 0,s()(C.FormattedMessage,{id:"database.CollectionSettings.NumberOptions.applyAllViews",defaultMessage:"Changes apply to all views showing this property."})))}var $e=o(31869),He=o(29376),Ye=o(80072),je=o(79892);function Qe(e){window.__c={n:"CollectionSettingsRelationOptions"};const{collectionContextStore:t,property:o}=e,r=(0,U.O7)(),n=(0,C.useIntl)(),[i,l]=(0,a.useState)(void 0),c=(0,W.VK)((()=>t.collectionStore()),[t]),p=(0,W.VK)((()=>t.normalizedSchemaStore.state),[t]),d=(0,W.VK)((()=>He.KV(t,o)),[t,o]),h=d&&(0,u.NK)(d)?d.connectedRelation:void 0,g=(0,W.VK)((()=>Xe(t.collectionViewBlockStore(),d)),[t,d]),S=Boolean(g&&(null==c?void 0:c.id)===g.id),y=(0,W.VK)((()=>Boolean(g&&(null==d?void 0:d.name)===He.m8(n,{targetCollectionStore:g,isSelfRelation:S,sourceSchema:p,createUnique:!1}))),[d,n,g,S,p]),f=(0,W.VK)((()=>t.contextType),[t]),v=(0,a.useCallback)((()=>{if(!i)return;const{hasInverseRelation:e,inverseName:s,autoRelate:a}=i;k.createAndCommit({userAction:"CollectionSettingsRelationOptions.handleEditRelation",environment:r,perform:i=>{$e.gy({environment:r,collectionContextStore:t,property:o,hasInverseRelation:e,inverseName:s,autoRelate:a,intl:n,transaction:i})}}),b.$q({environment:r,collectionContextStore:t,property:o,from:"collectionPage"===f?"page_properties":"view_settings",action:"relation_edit",is_self_relation:S,has_inverse:e,auto_relate:null==a?void 0:a.enabled}),l(void 0)}),[i,r,t,o,f,S,n]);if(!g)return null;const w=d&&!(0,m.gg)(d)&&!(0,m.ic)(d);return a.createElement(a.Fragment,null,w&&s()(je.Z,{isSelfRelation:S,collectionStore:g,showAs:"link",disabled:!0}),w&&s()(ve.C,{collectionContextStore:t,propertySchema:d,property:o}),!Boolean(h)&&s()(Ye.Z,{collectionContextStore:t,targetCollectionStore:g,property:o,buttonContents:s()(C.FormattedMessage,{defaultMessage:"Update relation",id:"database.viewSettings.editRelation.updateButton.title"}),temporaryInverseState:i,setTemporaryInverseState:l,isInitialPropertyName:y,onSubmit:v}))}function Xe(e,t){if("relation"!==(null==t?void 0:t.type))return;const o=null==t?void 0:t.collection_pointer;return o&&e?j.NW.createChildStore(e,o):void 0}var Je=o(71644),et=o(47307),tt=o(84619),ot=o(25464),rt=o(73456),nt=o(22084);function it(e){window.__c={n:"CollectionSettingsSelectOptionRow"};const t=(0,U.O7)(),{isMobile:o}=(0,U.Fy)(),{property:r,option:n,statusGroup:i,propertySchema:l,isDefault:c,disabled:p}=e,d=(0,Ie.Y$)(),u=(0,W.VK)((()=>{var e;return null===(e=d.collectionStore())||void 0===e?void 0:e.id}),[d]),m=(0,W.qz)(void 0,E.Z),h=(0,W.VK)((()=>m.state.open),[m]),g=(0,a.useCallback)((()=>{m.setState({open:!0})}),[m]),S=(0,a.useCallback)((()=>{m.setState({open:!1})}),[m]),y=(0,a.useCallback)((e=>{const o=d.collectionStore();o&&M.HW({environment:t,collectionStore:o,performTransaction:t=>{for(const r of e)k.applyOperation({store:(0,j.Kv)(o,r.pointer),operation:r,transaction:t})}})}),[d,t]),f=(0,we.yK)((()=>({defaultText:{fontSize:12,fontWeight:500,textTransform:"uppercase"}})),[]);return u?s()(rt.Z,{open:h,origin:s()(de.Z,{showDragHandle:!0,showChevron:!0,disabled:p,rotateChevron:h,title:"status"===l.type?s()(nt.F,{format:o?tt.l.Large:tt.l.Medium,value:n.value,color:n.color,showRemoveButton:!1,isSingle:!0,groupColor:null==i?void 0:i.color}):s()(nt.a,{format:o?tt.l.Large:tt.l.Medium,value:n.value,color:n.color,showRemoveButton:!1,isSingle:!0}),right:c?s()("span",{style:f.defaultText},void 0,s()(C.FormattedMessage,{id:"database.statusProperty.default",defaultMessage:"Default"})):void 0,onClick:g}),option:n,property:r,propertySchema:l,statusGroup:i,collectionId:u,analyticsFrom:"view_settings",alignmentToOrigin:ot.v.End,onChange:y,onClose:S}):null}var st=o(97180),at=o(79131),lt=o(73063),ct=o(3386);class pt extends c.Z{constructor(){super(...arguments),this.storeTypes={inputStore:q.Z,inputGroupIndexState:d.default.createClass(void 0)},this.handleAutoSortChange=e=>{const{collectionContextStore:t,property:o}=this.props,r=t.collectionStore(),n=t.normalizedSchemaStore.state,i=this.getPropertySchema();if(!r||!i)return;if(!(0,u.cu)(i))return;const s=[{pointer:r.pointer,command:"update",path:["schema",o],args:{auto_sort_options:e}}];"alphabetical"!==e&&"reverse_alphabetical"!==e||s.push(...(0,Z.L5)({collectionId:r.id,property:o,propertySchema:i,schema:n,isAscending:"alphabetical"===e})||[]),M.HW({environment:this.environment,collectionStore:r,performTransaction:e=>{for(const t of s)k.applyOperation({store:(0,j.Kv)(r,t.pointer),operation:t,transaction:e})}}),b.$q({environment:this.environment,collectionContextStore:t,property:o,from:"view_settings",action:"select_change_auto_sort_options"})},this.handleNewOptionClick=e=>{this.stores.inputStore.setState({focus:!0,inputValue:""}),void 0!==e&&this.stores.inputGroupIndexState.setState(e)},this.handleInputChange=e=>{const t=e.target.value.replace(/,/g,"");this.stores.inputStore.setState({focus:!0,inputValue:t})},this.handleInputBlur=()=>{this.stores.inputStore.setState({focus:!1,inputValue:""})},this.handleInputSubmit=()=>{const{collectionContextStore:e,property:t}=this.props,o=e.collectionStore(),r=this.getPropertySchema();if(!r||!o)return;const n=r.options||[],i=this.stores.inputStore.state.inputValue;if(i){let e=(0,u.TL)(n);if("status"===r.type){var s;const t=null===(s=this.stores.inputGroupIndexState)||void 0===s?void 0:s.state;if(void 0!==t){var a;const o=null===(a=r.groups)||void 0===a||null===(a=a[t])||void 0===a?void 0:a.color;o&&(e=o)}}if(n.find((e=>e.value===i)))return et.showErrorMessage(this.renderOptionAlreadyExistsMessage()),void this.handleInputBlur();const c={id:(0,Je.ZP)(),value:i,color:e};let p,d;if(p=(0,u.cu)(r)&&("alphabetical"===r.auto_sort_options||"reverse_alphabetical"===r.auto_sort_options)&&L.default.checkGate("collection_properties_select_auto_sort_options")?(0,Z.Ch)({collectionId:o.id,property:t,propertySchema:r,newOption:c,isAscending:"alphabetical"===r.auto_sort_options}):{pointer:o.pointer,command:"keyedObjectListBefore",path:["schema",t,"options"],args:{value:c}},"status"===r.type){var l;const e=null===(l=this.stores.inputGroupIndexState)||void 0===l?void 0:l.state;void 0!==e&&(d={pointer:o.pointer,command:"listBefore",path:["schema",t,"groups",e,"optionIds"],args:{id:c.id}})}M.HW({environment:this.environment,collectionStore:o,performTransaction:e=>{k.applyOperation({store:(0,j.Kv)(o,p.pointer),operation:p,transaction:e}),d&&k.applyOperation({store:(0,j.Kv)(o,d.pointer),operation:d,transaction:e})}})}this.stores.inputStore.setState({focus:!0,inputValue:""}),b.$q({environment:this.environment,collectionContextStore:e,property:t,from:"view_settings",action:"select_add_option"})},this.handleSelectDraggableListDrop=e=>{const{property:t,collectionContextStore:o}=this.props,r=o.normalizedSchemaStore.state,n=o.collectionStore();if(!n)return;const i=r[t];let s;if("status"===(null==i?void 0:i.type)){s=[[]];for(const t of e)t.startsWith("group-header-")?s.push([]):s[s.length-1].push(t)}else s=e;const a=(0,Z.YL)({newOptions:s,collectionId:n.id,property:t,schema:r});if(a){if(i&&(0,u.cu)(i)){"manual"!==(i.auto_sort_options||"manual")&&a.push({pointer:n.pointer,command:"update",path:["schema",t],args:{auto_sort_options:"manual"}})}M.HW({environment:this.environment,collectionStore:n,performTransaction:e=>{for(const t of a)k.applyOperation({store:(0,j.Kv)(n,t.pointer),operation:t,transaction:e})}})}b.$q({environment:this.environment,collectionContextStore:o,property:t,from:"view_settings",action:"select_options_reorder"})}}renderComponent(){var e,t;const{collectionContextStore:o,property:r,disabled:n}=this.props,i=null===(e=o.collectionStore())||void 0===e?void 0:e.getSchema(),l=null===(t=o.collectionStore())||void 0===t?void 0:t.getFormat().app_config_uri,c=this.getPropertySchema();if(!i||!c)return;const{inputStore:p,inputGroupIndexState:d}=this.stores,u=p.state,m=d.state;if("status"===c.type){const e=c.groups??[];if(0===e.length)return;const t=c.options??[],o=e.map((e=>{const o=t.filter((t=>{var o;return null===(o=e.optionIds)||void 0===o?void 0:o.includes(t.id)}));return{group:e,groupOptions:o}})),p=c.defaultOption,d=[...o[0].groupOptions.map((e=>e.value))];for(const{group:r,groupOptions:n}of o.slice(1))d.push({key:`group-header-${r.name}`,draggable:!1}),d.push(...n.map((e=>e.value)));const h=(0,T.Hw)(l,i,r)?{tooltipCaption:s()(C.FormattedMessage,{defaultMessage:"These options are core to the property and cannot be changed.",id:"database.viewSettings.selectOptions.disabledGroupMessage"})}:void 0,g=(i,l)=>{if(i.startsWith("group-header-")){const e=i.substring("group-header-".length),t=o.findIndex((t=>{let{group:o}=t;return o.name===e})),{group:r,groupOptions:l}=o[t];return this.renderSectionHeader(s()(st.r_,{disableGroup:h,group:r,showIcon:!1}),!u.focus&&this.renderNewOptionButton((()=>this.handleNewOptionClick(t))),a.createElement(a.Fragment,null,m===t&&this.renderNewOptionInput(),!u.focus&&0===l.length&&this.renderNewOptionItem(t)),n)}{const o=t.find((e=>e.value===i));if(!o)return;const a=e.find((e=>{var t;return null===(t=e.optionIds)||void 0===t?void 0:t.includes(o.id)}));return s()(it,{option:o,statusGroup:a,propertySchema:c,property:r,isDefault:o.value===p,disabled:n},o.value)}};return[this.renderSectionHeader(s()(st.r_,{disableGroup:h,group:o[0].group}),!u.focus&&this.renderNewOptionButton((()=>this.handleNewOptionClick(0))),a.createElement(a.Fragment,null,0===m&&this.renderNewOptionInput(),!u.focus&&0===o[0].groupOptions.length&&this.renderNewOptionItem(0)),n),s()(at.ZP,{direction:"vertical",keys:d,renderKey:g,onDrop:this.handleSelectDraggableListDrop,disabled:n})]}{const e=c.options??[],t=e.map((e=>e.value)),o=c.auto_sort_options||"manual";return[L.default.checkGate("collection_properties_select_auto_sort_options")&&s()(ne.Z,{title:s()(C.FormattedMessage,{defaultMessage:"Sort",id:"database.viewSettings.selectOptions.autoSort"}),selectedKey:o,options:[{key:"manual",title:s()(C.FormattedMessage,{defaultMessage:"Manual",id:"database.viewSettings.selectOptions.autoSort.none"})},{key:"alphabetical",title:s()(C.FormattedMessage,{defaultMessage:"Alphabetical",id:"database.viewSettings.selectOptions.autoSort.alphabetical"})},{key:"reverse_alphabetical",title:s()(C.FormattedMessage,{defaultMessage:"Reverse alphabetical",id:"database.viewSettings.selectOptions.autoSort.reverseAlphabetical"})}],onChange:this.handleAutoSortChange,popupStyle:{minWidth:190}},"autoSortMenuItem"),this.renderSectionHeader(s()(C.FormattedMessage,{defaultMessage:"Options",id:"database.viewSettings.selectOptions.title"}),!u.focus&&t.length>0&&this.renderNewOptionButton((()=>this.handleNewOptionClick())),this.renderNewOptionInput(),n),t.length>0&&s()(at.ZP,{direction:"vertical",keys:t,renderKey:t=>{const o=e.find((e=>e.value===t));if(o)return s()(it,{option:o,property:r,propertySchema:c,isDefault:!1,statusGroup:void 0,disabled:n},o.value)},onDrop:this.handleSelectDraggableListDrop}),!u.focus&&0===t.length&&this.renderNewOptionItem()]}}renderSectionHeader(e,t,o,r){return s()(X.Z,{topBorder:!0,title:e,desktopTitleStyle:{height:20},right:!r&&t,style:{width:"100%",paddingBottom:0}},void 0,!r&&o)}renderNewOptionInput(){const{inputStore:e}=this.stores,t=e.state;if(t.focus)return s()(ct.Z,{capture:!0,onEsc:this.handleInputBlur},void 0,s()(Q.ZP,{value:t.inputValue,focus:!0,placeholder:this.props.intl.formatMessage({defaultMessage:"Type a new option…",id:"database.viewSettings.selectOptions.newSelectOption.inputPlaceholder"}),style:{marginTop:2,marginBottom:8},onChange:this.handleInputChange,onBlur:this.handleInputBlur,onSubmit:this.handleInputSubmit}))}renderNewOptionItem(e){return s()(De.Z,{icon:y.Z.plus({width:14}),focused:!1,title:s()(C.FormattedMessage,{defaultMessage:"Add an option",id:"database.viewSettings.selectOptions.noOptions"}),style:{width:"100%"},onClick:()=>this.handleNewOptionClick(e)})}renderNewOptionButton(e){if(this.getPropertySchema())return s()(lt.Z,{icon:y.Z.plus,onClick:e,style:{width:20,height:20}})}renderOptionAlreadyExistsMessage(){return s()(C.FormattedMessage,{defaultMessage:"Option already exists.",id:"database.optionExistsAlreadyError.message"})}getPropertySchema(){const{collectionContextStore:e,property:t}=this.props,o=e.normalizedSchemaStore.state[t];if(o&&((0,u.cu)(o)||"status"===o.type))return o}}pt.displayName="CollectionSettingsSelectOptions";const dt=(0,C.injectIntl)(pt),ut=(0,C.defineMessages)({statusShowAsLabel:{id:"database.viewSettings.statusOptions.showAs",defaultMessage:"Show as"},statusCheckboxLabel:{id:"database.viewSettings.statusOptions.showAs.checkbox",defaultMessage:"Checkbox"},statusSelectLabel:{id:"database.viewSettings.statusOptions.showAs.select",defaultMessage:"Select"}});class mt extends c.Z{constructor(){super(...arguments),this.handleShowAsChange=e=>{const{collectionContextStore:t,property:o}=this.props,r=t.formatStore();if(!r)return;const n=t.getPropertyFormatKey();n&&(k.createAndCommit({userAction:"CollectionSettingsStatusOptions.handleShowAsChange",environment:this.environment,perform:t=>{w.er({formatStore:r,formatKey:n,property:o,update:{statusShowAs:e,visible:!0},transaction:t})}}),b.$q({environment:this.environment,collectionContextStore:t,property:o,from:"view_settings",action:"status_change_format"}))},this.iconStyle={width:16,height:16,fill:this.theme.mediumIconColor}}renderComponent(){var e;const{collectionContextStore:t,property:o,disabled:r}=this.props;if(!this.getPropertySchema())return;const n=[{key:"checkbox",title:V.default.formatMessage(ut.statusCheckboxLabel),icon:y.Z.typesCheckbox(this.iconStyle)},{key:"select",title:V.default.formatMessage(ut.statusSelectLabel),icon:y.Z.typesSelect(this.iconStyle)}],i=(null===(e=t.getPropertyFormat(o))||void 0===e?void 0:e.statusShowAs)??"select";return s()(ne.Z,{title:V.default.formatMessage(ut.statusShowAsLabel),selectedKey:i,popupStyle:{minWidth:190},options:n,onChange:e=>this.handleShowAsChange(e),disabled:r})}getPropertySchema(){const{collectionContextStore:e,property:t}=this.props,o=e.normalizedSchemaStore.state[t];if(o&&"status"===o.type)return o}}mt.displayName="CollectionSettingsStatusOptions";const ht=(0,C.injectIntl)(mt);var gt=o(74420),St=o(31278),yt=o(76798),ft=o(32662),vt=o(58032),Ct=o(64369),bt=o(18145);const wt=(0,C.defineMessages)({inputPlaceholder:{defaultMessage:"Property name",id:"database.viewSettings.propertyTab.propertyName"},autofillOffLabel:{defaultMessage:"Off",id:"database.viewSettings.propertyTab.autofillOffLabel"},keptUpToDateWithNotionAITooltip:{defaultMessage:"Auto-updated by AI",id:"database.tableHeaderCell.tooltipAiAutofillDescription"}});class xt extends c.Z{constructor(){super(...arguments),this.storeTypes={inputStore:d.default.createClass(""),propertyTypeButtonPopupStore:E.Z,newSelectOptionInputStore:q.Z},this.renderLearnAboutRelationsMenuItem=()=>{const{collectionContextStore:e,property:t}=this.props,o=e.normalizedSchemaStore.state[t];let r;return r=(0,m.Kp)(o)?s()(fe.Z,{href:(0,B.UY)("guides.githubRelation"),title:s()(C.FormattedMessage,{defaultMessage:"Learn about GitHub Pull Requests",id:"database.viewSettings.propertyTab.githubPrRelation.learnMoreButton.title"}),analyticsFrom:"view_settings_property_github_pr_relation"}):s()(fe.Z,{href:(0,B.UY)("guides.relations"),title:s()(C.FormattedMessage,{defaultMessage:"Learn about relations",id:"database.viewSettings.propertyTab.relations.learnMoreButton.title"}),analyticsFrom:"view_settings_property_relation"}),s()(X.Z,{topBorder:!0},void 0,r)},this.handlePropertyTypeClick=()=>{const{collectionSettingsStore:e,collectionContextStore:t}=this.props,o=this.getPropertySchema(),r=t.collectionStore();r&&x.H4({collectionSettingsStore:e,item:{type:"propertyType",propertySchema:o,propertyTypes:(0,F.TP)({isSyncedCollection:r.isSyncedCollection(),collectionContextStore:t,environment:this.environment}),onAccept:this.handlePropertyTypeAccept}})},this.handleAiAutofillClick=()=>{const{collectionSettingsStore:e,collectionContextStore:t,property:o}=this.props,r=this.getPropertySchema();t.collectionStore()&&r&&x.H4({collectionSettingsStore:e,item:{type:"propertyAiAutofill",propertySchema:r,property:o}})},this.handlePropertyNameSubmit=e=>{if(this.shouldShowDuplicateError())return;const{property:t,collectionContextStore:o}=this.props,r=this.getCollectionStore();if(!r)return;const n=r.getSchema()[t];n&&n.name!==e&&(k.createAndCommit({userAction:"CollectionSettingsProperty.handlePropertyNameSubmit",environment:this.environment,perform:o=>{w.Bv({collectionStore:r,property:t,name:e,transaction:o})}}),b.$q({environment:this.environment,collectionContextStore:o,property:t,from:"view_settings",action:"rename"}))},this.handlePropertyIconSubmit=e=>{const{property:t,collectionContextStore:o}=this.props,r=this.getCollectionStore();r&&(k.createAndCommit({userAction:"CollectionSettingsProperty.handlePropertyIconSubmit",environment:this.environment,perform:o=>{w.OK({collectionStore:r,property:t,icon:e,transaction:o})}}),b.$q({environment:this.environment,collectionContextStore:o,property:t,icon:e,from:"view_settings",action:"change_icon"}))},this.handleToggleVisibilityClick=()=>{const{collectionContextStore:e,formatKey:t}=this.props,o=this.getPropertyFormat(),r=e.collectionViewStore(),n=e.normalizedFormatStore.state,i=this.getPropertySchema();if(!i)return;if(!(o&&r&&t&&i))return;const s={...n,[t]:this.getPropertyFormats().map((e=>e.property===o.property?{...o,visible:!o.visible}:e))};k.createAndCommit({userAction:"CollectionSettingsProperty.handleToggleVisibilityClick",environment:this.environment,perform:t=>{M.iG({collectionViewStore:r,update:{format:s},transaction:t});const n=this.getVisiblePropertyIndex();I.oz({environment:this.environment,collectionContextStore:e,currentIndex:n,entrypoint:"CollectionSettingsProperty",transaction:t,propertyAction:o.visible?"hide":"show"})}}),b.wd({environment:this.environment,collectionContextStore:e,action:"toggle_property_visibility",original_view_type:r.getType(),property_type:i.type})},this.handleDuplicateClick=async()=>{const{property:e,collectionContextStore:t,collectionSettingsStore:o,formatKey:r}=this.props,n=this.getPropertyFormats(),i=this.getSchema(),s=this.getCollectionStore(),a=t.collectionViewStore(),l=null==s?void 0:s.getSpaceId();if(!s||!a||!l)return;const c=this.getPropertySchema();if(!c)return;const p=await(0,Z.xy)({environment:this.environment,schema:i,property:e,properties:n,parentStore:s,spaceId:l});p&&(k.createAndCommit({userAction:"CollectionSettingsProperty.handleDuplicateClick",environment:this.environment,perform:e=>{M.xO({environment:this.environment,collectionStore:s,update:{[p.newProperty]:p.newPropertySchema},transaction:e});const o=this.getVisiblePropertyIndex();I.oz({environment:this.environment,collectionContextStore:t,currentIndex:o,entrypoint:"CollectionSettingsProperty",transaction:e,propertyAction:"duplicate"}),p.automationUpdate&&M.Ki({environment:this.environment,collectionStore:s,update:p.automationUpdate,transaction:e}),r&&P.FH({stores:[a],update:{[r]:p.newProperties},transaction:e})}}),x.FK({collectionSettingsStore:o,item:{type:"property",property:p.newProperty,formatKey:r}}),b.wd({environment:this.environment,collectionContextStore:t,action:"duplicate_property",original_view_type:null==a?void 0:a.getType(),property_type:c.type}))},this.handleDeleteClick=async()=>{const{collectionContextStore:e,property:t}=this.props;await w.TI({environment:this.environment,collectionContextStore:e,property:t,handleDeleteAccept:this.handleDeleteAccept,theme:this.theme,from:"view_settings"})},this.handleDeleteAccept=()=>{const{property:e,collectionContextStore:t,collectionSettingsStore:o}=this.props,r=this.getPropertySchema(),n=this.getSchema(),i=this.getCollectionStore();r&&(i&&k.createAndCommitAsync({environment:this.environment,userAction:"CollectionSettingsProperty.handleDeleteAccept",waitForServerCommit:!1,perform:async o=>{await w.yV({environment:this.environment,collectionStore:i,schema:n,property:e,transaction:o});const r=this.getVisiblePropertyIndex();I.oz({environment:this.environment,collectionContextStore:t,currentIndex:r,entrypoint:"CollectionSettingsProperty",transaction:o,propertyAction:"delete"})}}),x.z$({collectionSettingsStore:o}),b.wd({environment:this.environment,collectionContextStore:t,action:"delete_property",property_type:null==r?void 0:r.type}),b.y9({environment:this.environment,collectionContextStore:t,property_type:r.type,from:"view_settings",property:e}))},this.handleRollupPropertyMenuChange=e=>{const{property:t}=this.props,o=this.getCollectionStore();o&&k.createAndCommit({userAction:"CollectionSettingsProperty.handleRollupPropertyMenuChange",environment:this.environment,perform:r=>{M.xO({environment:this.environment,collectionStore:o,update:{[t]:e.propertySchema},transaction:r})}})},this.handlePropertyTypeAccept=e=>{const{property:t,collectionContextStore:o,collectionSettingsStore:r,formatKey:n}=this.props,i=this.getCollectionStore();i&&(b.$q({environment:this.environment,collectionContextStore:o,property:t,new_property_type:(0,u.TN)(e),from:"view_settings",action:"change_type"}),"relation"===e?x.H4({collectionSettingsStore:r,item:{type:"selectRelationSource",property:t,formatKey:n}}):(k.createAndCommit({userAction:"CollectionSettingsProperty.handlePropertyTypeAccept",environment:this.environment,perform:o=>{w.LC({environment:this.environment,collectionStore:i,property:t,type:e,transaction:o})}}),x.z$({collectionSettingsStore:r}),(0,u.XU)(e)&&_.K7({propertyType:e,propertyId:t,collectionContextStore:o})),this.stores.propertyTypeButtonPopupStore.reset())},this.isFreezeColumnsEnabled=this.createComputedStore((()=>(0,Z.eL)(this.environment.device.isMobile,this.getCurrentViewType())))}didMount(){p.default.afterNextFlush((()=>{p.default.afterNextFlush((()=>{this.scrollTableCellIntoView()}))}))}renderComponent(){const{theme:e}=this,{property:t,collectionContextStore:o,selectNameInitial:r,formatKey:i}=this.props,l=this.getPropertySchema(),c=this.getPropertyFormat();if(!l)return;const p=o.collectionStore(),d="collectionTypedView"===o.contextType,h=i&&("title"!==t||(0,Z.XO)({viewType:this.getCurrentViewType(),format:o.normalizedFormatStore.state})),f=p&&p.getDatabaseType(),v=Boolean(f&&p&&p.isTypedProperty(t)),b=this.createComputedStore((()=>Boolean(p&&f&&T.cR(f,t,p)))),w=!(0,m.Kp)(l),x=d,_=d||(0,m.sh)({propertySchema:l,isTypedProperty:v}),M=F.Tr.includes(l.type)&&!(0,u.dx)(l)&&p,P=F.Tr.includes(l.type)&&p,I=h||M||P,k="collectionViewBlock"===o.contextType;return a.createElement(Ce.ZP,n()({},this.props,{title:s()(C.FormattedMessage,p?{defaultMessage:"Edit property",id:"database.viewSettings.propertyTab.title"}:{defaultMessage:"View property",id:"database.viewSettings.propertyTab.title.viewProperty"}),unconstrainedWidth:k}),s()(X.Z,{},void 0,s()(be.Z,{disabled:x,initialValue:l.name||"",placeholder:V.default.formatMessage(wt.inputPlaceholder),onBlur:this.handlePropertyNameSubmit,onSubmit:this.handlePropertyNameSubmit,focusInitial:r,selectAll:r,inputStore:this.stores.inputStore,inputOuterStyle:k?{background:e.contentBackground}:void 0,iconButton:{icon:t=>s()(g.ZP,{type:l.type,icon:l.icon,size:16,theme:e,style:t}),iconStyle:{fill:S.Lr[e.mode].gray},enforceIconColor:"gray",onSubmit:this.handlePropertyIconSubmit}}),this.shouldShowDuplicateError()&&s()(_t,{propertyName:this.stores.inputStore.state})),s()(X.Z,{},void 0,w&&this.renderPropertyTypeMenuItem(_,v,f),d?null:a.createElement(a.Fragment,null,(0,R.Zt)(this.environment)&&this.renderAiAutofillMenuItem(),(0,u.cu)(l)&&this.renderSelectOptions(l),"status"===l.type&&this.renderStatusOptions(l),"formula"===l.type&&this.renderFormulaOptions(),"rollup"===l.type&&this.renderRollupOptions(),("date"===l.type||"created_time"===l.type||"last_edited_time"===l.type)&&this.renderDateOptions(),"relation"===l.type&&this.renderRelationOptions(),"person"===l.type&&this.renderPersonOptions(),this.renderNumberOptions(),"auto_increment_id"===l.type&&this.renderAutoIncrementId())),"button"===l.type&&this.renderButtonOptions(),I&&s()(X.Z,{topBorder:!0},void 0,h&&c&&(null!=c&&c.visible?s()(de.Z,{icon:y.Z.eyeHidePadded,isPadded:!0,title:s()(C.FormattedMessage,{defaultMessage:"Hide in view",id:"database.viewSettings.propertyTab.hideInViewButton.title"}),onClick:this.handleToggleVisibilityClick}):s()(de.Z,{icon:y.Z.eyePadded,isPadded:!0,title:s()(C.FormattedMessage,{defaultMessage:"Show in view",id:"database.viewSettings.propertyTab.showInViewButton.title"}),onClick:this.handleToggleVisibilityClick})),M&&s()(de.Z,{icon:y.Z.duplicate,title:s()(C.FormattedMessage,{defaultMessage:"Duplicate property",id:"database.viewSettings.propertyTab.duplicateButton.title"}),onClick:this.handleDuplicateClick}),P&&this.renderDeletePropertyMenuItem(b.state,f)),"formula"===l.type&&s()(X.Z,{topBorder:!0},void 0,s()(fe.Z,{href:(0,B.UY)("guides.formulas"),title:s()(C.FormattedMessage,{defaultMessage:"Learn about formulas",id:"database.viewSettings.propertyTab.formulas.learnMoreButton.title"}),analyticsFrom:"view_settings_property_formula"})),"relation"===l.type&&this.renderLearnAboutRelationsMenuItem(),"rollup"===l.type&&s()(X.Z,{topBorder:!0},void 0,s()(fe.Z,{href:(0,B.UY)("guides.relations"),title:s()(C.FormattedMessage,{defaultMessage:"Learn about rollups",id:"database.viewSettings.propertyTab.rollups.learnMoreButton.title"}),analyticsFrom:"view_settings_property_relation"})))}renderPropertyTypeMenuItem(e,t,o){const{propertyTypeButtonPopupStore:r}=this.stores,i=this.props.collectionContextStore.collectionViewBlockStore(),l=this.getPropertySchema(),c=Xe(i,l);if(!l)return;const p=null==c?void 0:c.getIcon(),{theme:d}=this,u=(0,m.gg)(l)||(0,m.ic)(l);return s()(vt.Z,{placement:vt.Z.Placement.Left,disableTooltip:!e,renderTooltip:e=>t?a.createElement(C.FormattedMessage,n()({},e,{defaultMessage:"{type} type is required for this property in {databaseType}.",id:"database.viewSettings.propertyTab.restrictedProperty",values:{type:F.SO[l.type],databaseType:(0,A.r1)(o)}})):a.createElement(C.FormattedMessage,n()({},e,{defaultMessage:"{type}'s type cannot be changed.",id:"database.viewSettings.propertyTab.untypedRestrictedProperty",values:{type:F.SO[l.type]}})),render:t=>a.createElement(de.Z,n()({},t,{disabled:e,rotateChevron:r.state.open,title:s()(C.FormattedMessage,{defaultMessage:"Type",id:"database.viewSettings.propertyTab.propertyType"}),showChevron:!0,right:a.createElement(a.Fragment,null,e?a.createElement("div",t,y.Z.lockedFilled({width:14,fill:d.regularIconColor})):s()(g.ZP,{type:l.type,icon:void 0,size:16,theme:d}),s()(ft.Z,{size:4}),u?s()("div",{style:{color:e?d.darkTextColor:void 0,display:"flex",alignItems:"center"}},void 0,s()(St.Z,{icon:p,isEmptyPage:!1,size:20,disabled:!0}),s()(yt.Z,{store:c,style:{display:"inline",wordBreak:"break-word",...v.Z.textOverflowStyle}})):s()("span",{style:{color:e?d.darkTextColor:void 0}},void 0,F.SO[l.type])),onClick:this.handlePropertyTypeClick}))})}renderAiAutofillMenuItem(){var e,t,o,r,n;const i=this.getPropertySchema();if(!i||!(0,u.qQ)(i)||"translate"===(null===(e=i.ai_inference)||void 0===e?void 0:e.type)&&!(0,R.hu)())return;let a;return"summarize"===(null===(t=i.ai_inference)||void 0===t?void 0:t.type)?a=R.Dr.autofillSummary:"extract"===(null===(o=i.ai_inference)||void 0===o?void 0:o.type)?a=R.Dr.autofillExtract:"custom"===(null===(r=i.ai_inference)||void 0===r?void 0:r.type)?a=R.Dr.autofillCustom:"translate"===(null===(n=i.ai_inference)||void 0===n?void 0:n.type)?a=R.Dr.autofillTranslate:void 0===i.ai_inference?a=wt.autofillOffLabel:(0,f.t1)(i.ai_inference),s()(de.Z,{title:s()("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"}},void 0,s()(C.FormattedMessage,{defaultMessage:"AI autofill",id:"database.viewSettings.propertyTab.aiAutofill.open"}),s()(gt.Z,{style:{display:"inline-block"}})),showChevron:!0,right:V.default.formatMessage(a),onClick:this.handleAiAutofillClick})}renderSelectOptions(e){const{collectionContextStore:t,property:o}=this.props;return s()(dt,{collectionContextStore:t,property:o,disabled:!1})}renderStatusOptions(e){var t;const{collectionContextStore:o,property:r}=this.props,n=T.Hw(null===(t=o.collectionStore())||void 0===t?void 0:t.getDatabaseType(),o.normalizedSchemaStore.state,r);return a.createElement(a.Fragment,null,n?null:s()(ht,{collectionContextStore:o,property:r,disabled:n}),s()(dt,{collectionContextStore:o,property:r,disabled:n}))}renderRollupOptions(){const{property:e}=this.props,t=this.getCollectionStore(),o=this.getSchema();if(!t)return;const r=Boolean(t.getDatabaseType()&&t.isTypedProperty(e));return s()(bt.Z,{disabled:r,context:bt.t.ViewSettings,property:e,schema:o,analyticsFrom:"view_settings",parentStore:t,onChange:this.handleRollupPropertyMenuChange})}renderFormulaOptions(){const{collectionContextStore:e,property:t}=this.props;return s()(ye,{collectionContextStore:e,property:t})}renderDateOptions(){const{collectionContextStore:e,property:t}=this.props;return s()(se,{collectionContextStore:e,property:t})}renderNumberOptions(){const{collectionContextStore:e,property:t}=this.props,o=this.getPropertySchema();if(o)return"number"===o.type||"formula"===o.type||"rollup"===o.type?s()(Ue,{collectionContextStore:e,property:t}):void 0}renderRelationOptions(){const{collectionContextStore:e,property:t}=this.props,o=e.normalizedSchemaStore.state[t];return(0,m.Kp)(o)?s()(G.Z,{collectionContextStore:e,property:t}):s()(Qe,{collectionContextStore:e,property:t})}renderPersonOptions(){const e=this.renderLimitOptions(),t=(L.default.checkGate("default_person_property")||(0,N.iL)())&&this.renderDefaultPersonPicker();return a.createElement(a.Fragment,null,e,t)}renderDefaultPersonPicker(){const{collectionContextStore:e,property:t}=this.props,o=this.getPropertySchema();if(o&&"person"===o.type)return s()(ae,{collectionContextStore:e,propertySchema:o,property:t})}renderButtonOptions(){const{collectionContextStore:e,property:t}=this.props,o=this.getPropertySchema();if(o&&"button"===o.type)return s()(J,{collectionContextStore:e,propertySchema:o,propertyId:t})}renderLimitOptions(){const{collectionContextStore:e,property:t}=this.props,o=this.getPropertySchema();if(o)return s()(ve.C,{collectionContextStore:e,propertySchema:o,property:t})}renderAutoIncrementId(){const{collectionContextStore:e,property:t}=this.props,o=this.getPropertySchema();if(o&&"auto_increment_id"===o.type){var r;const n=null===(r=e.collectionStore())||void 0===r?void 0:r.getRecordKeyStore(),i=null==n?void 0:n.getRecordKey();return s()(K.Z,{uniqueIdProperty:{propertyId:t,propertySchema:o},prefixValue:i,collectionContextStore:e})}}renderDeletePropertyMenuItem(e,t){return s()(vt.Z,{disableTooltip:!e,placement:vt.Z.Placement.Left,renderTooltip:e=>(0,A.A7)(t,e),render:o=>a.createElement(de.Z,n()({},o,{isRed:!0,disabled:e,onClick:this.handleDeleteClick,icon:()=>e?a.createElement("div",n()({},o,{style:{display:"inline-flex"}}),y.Z.lockedFilled({width:14,marginLeft:4,marginRight:4})):y.Z.trash({width:14,marginLeft:4,marginRight:4}),title:s()(C.FormattedMessage,{defaultMessage:"Delete property",id:"database.viewSettings.propertyTab.deleteButton.title"}),caption:this.environment.device.isMobile&&e?(0,A.A7)(t):null}))})}getCollectionStore(){const{collectionContextStore:e}=this.props;if(e.collectionViewBlockStore())return e.collectionStore()}getSchema(){const e=this.getCollectionStore();return e?e.getSchema():this.props.collectionContextStore.normalizedSchemaStore.state||{}}getPropertySchema(e){const t=e||this.props,{property:o}=t;return this.getSchema()[o]}getPropertyFormat(){const{property:e}=this.props,t=this.getPropertyFormats();return null==t?void 0:t.find((t=>t.property===e))}getPropertyFormats(){const{formatKey:e,collectionContextStore:t}=this.props;if(!e)return[];return t.normalizedFormatStore.state[e]||[]}getVisiblePropertyIndex(){const{property:e}=this.props,t=this.getPropertyFormats();if(0===t.length)return-1;return t.filter((e=>e.visible)).findIndex((t=>t.property===e))}shouldShowDuplicateError(){const{property:e}=this.props,{inputStore:t}=this.stores,o=this.getSchema(),r=t.state,n=Object.keys(o).find((t=>{var n;return t!==e&&(null===(n=o[t])||void 0===n?void 0:n.name)===r}));return Boolean(n)}getCurrentViewType(){const{collectionContextStore:e}=this.props,t=e.getViewType();if(!t)throw new Error("View type was not defined.");return t}scrollTableCellIntoView(){const{property:e,collectionContextStore:t}=this.props,o=t.collectionViewStore();if(!o||"table"!==o.getType())return;const r=D.Z.findTableHeaderCell(t,e);if(!r)return;const n=l.findDOMNode(r),i=l.findDOMNode(this);if(!n||!i)return;const s=(0,O.xH)(n);if(!s)return;const a=i.getBoundingClientRect(),c=n.getBoundingClientRect().right+20-a.left;s.scrollLeft=s.scrollLeft+c}}function _t(e){return s()(Ct.Z,{isMultiline:!0,style:{paddingTop:8,marginLeft:16,marginRight:16,color:h.ZP.red,...e.styles}},void 0,s()(C.FormattedMessage,{id:"database.viewSettings.propertyTab.duplicatePropertyNameError",defaultMessage:"A property named {propertyName} already exists in this database.",values:{propertyName:e.propertyName}}))}xt.displayName="CollectionSettingsProperty";const Mt=(0,C.injectIntl)(xt)},79892:(e,t,o)=>{o.d(t,{Z:()=>y});var r=o(23174),n=o.n(r),i=o(67294),s=o(480),a=o(81954),l=o(24405),c=o(15145),p=o(82990),d=o(5366),u=o(84210),m=o(42917),h=o(84076),g=o(31278),S=o(76798);function y(e){window.__c={n:"CollectionSettingsRelationTarget"};const{isSelfRelation:t,collectionStore:o,showAs:r,disabled:y,onClick:f}=e,v=(0,a.VK)((()=>Boolean(o)),[o]),C=(0,a.VK)((()=>null==o?void 0:o.getIcon()),[o]),b=(0,a.VK)((()=>{if(t)return;const e=null==o?void 0:o.getParentBlockStore();return e&&(0,u.ZP)({store:e,pageVisitSource:c.tY.LinkInPage})}),[o,t]),w=(0,s.Fy)(),x=(0,l.yK)((e=>({linkBox:{display:"flex",alignItems:"center"},linkTitle:{color:e.regularTextColor,fontWeight:p.Z.fontWeight.semibold,fontSize:14,marginLeft:4*(w.isRetina?.5:1),wordBreak:"break-word",...p.Z.textOverflowStyle},chevronTitle:{display:"inline",wordBreak:"break-word",...p.Z.textOverflowStyle}})),[w]),_=n()(g.Z,{icon:C,isEmptyPage:!1,size:20,disabled:!0});return n()(m.Z,{title:n()(d.FormattedMessage,{defaultMessage:"Related to",id:"database.viewSettings.editRelation.targetLink.title"}),showChevron:"chevron"===r,onClick:f,disabled:y,right:t?n()(d.FormattedMessage,{defaultMessage:"This database",id:"database.viewSettings.editRelation.selfRelationTarget.title"}):"link"===r&&b?n()(h.Z,{href:b,innerStyle:x.linkBox},void 0,_,n()(S.Z,{store:o,underline:!0,style:x.linkTitle,maxLength:15})):v?i.createElement(i.Fragment,null,_,n()(S.Z,{store:o,style:x.chevronTitle})):n()(d.FormattedMessage,{defaultMessage:"No target",id:"database.viewSettings.editRelation.noTarget.title"}),rightStyle:{flexShrink:1},textWrapperStyle:{flexShrink:0}})}},37709:(e,t,o)=>{o.d(t,{P:()=>G,Z:()=>W});var r=o(10434),n=o.n(r),i=o(23174),s=o.n(i),a=o(96486),l=o(67294),c=o(83355),p=o(49085),d=o(53397),u=o(51454),m=o(5366),h=o(77162),g=o(90985),S=o(5149),y=o(64434),f=o(24677),v=o(98104),C=o(97004),b=o(68641),w=o(13273),x=o(34859),_=o(61766),M=o(54634),P=o(28398),I=o(58814),k=o(97774),T=o(82990),F=o(33338),Z=o(44532);class R extends c.Z{constructor(){super(...arguments),this.storeTypes={collectionSettingsStore:p.default.createClass({open:!1,stack:[]})},this.renderPopup=()=>{const{collectionContextStore:e}=this.props,{collectionSettingsStore:t}=this.stores;return s()(M.P,{context:b.HV.FilterBar,collectionContextStore:e,collectionSettingsStore:t,hideDesktopHeader:!0})},this.handleClick=()=>{const{collectionContextStore:e}=this.props,{collectionSettingsStore:t}=this.stores;h.wd({environment:this.environment,collectionContextStore:e,action:"click_sort"}),S.wl({collectionSettingsStore:t,item:{type:"sort"}})},this.handlePopupDismiss=e=>{if(e&&(0,w.yT)(e.target))return;const{collectionSettingsStore:t}=this.stores;S.E3({collectionSettingsStore:t})}}willUnmount(){S.E3({collectionSettingsStore:this.stores.collectionSettingsStore})}renderComponent(){const{device:e}=this.environment,{collectionSettingsStore:t}=this.stores;return s()(Z.ZP,{popupType:e.isMobile?Z.ZP.PopupType.SlideUp:Z.ZP.PopupType.Popup,open:t.state.open,origin:this.renderOrigin(),onDismiss:this.handlePopupDismiss,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,render:this.renderPopup})}renderOrigin(){const{collectionContextStore:e}=this.props,t=e.currentSortsStore.state,o=e.localStateDiffStore.state,r=t[0],n=e.permissionScopes.state,i=e.normalizedSchemaStore.state,a=r?i[r.property]:void 0;let l;return l=1===t.length?r&&"descending"===r.direction?d.Z.arrowDownThick({width:12,marginRight:4,fill:this.theme.blueColor}):d.Z.arrowUpThick({width:12,marginRight:4,fill:this.theme.blueColor}):d.Z.arrowsUpDown({width:16,marginRight:4,fill:this.theme.blueColor}),s()(F.Z,{on:!0,hasDiff:Boolean(n.canConfigureBlock&&o.sorts),icon:l,title:s()("span",{style:{marginTop:-1,maxWidth:220,...T.Z.textOverflowStyle}},void 0,1===t.length&&a?a.name:s()(m.FormattedMessage,{defaultMessage:"{sortCount} sorts",id:"database.filterBar.sorts.label",values:{sortCount:t.length}})),onClick:this.handleClick})}}R.displayName="CollectionViewFilterBarSort";const A=(0,m.injectIntl)(R);var V=o(68689),B=o(23063),O=o(37601),N=o(79131),D=o(21199),E=o(1743),L=o(74194),q=o(89728),K=o(18647);let G=function(e){return e[e.FilterBar=0]="FilterBar",e[e.SettingsFilters=1]="SettingsFilters",e}({});class U extends c.Z{constructor(){super(...arguments),this.storeTypes={createFilterSettingsStore:p.default.createClass({open:!1,stack:[]}),saveControlMoreActionsButtonPopupStore:_.Z},this.renderPropertyFilter=e=>{const{collectionContextStore:t}=this.props;return s()(k.Z,{id:e.id,context:G.FilterBar,collectionContextStore:t,collectionSettingsStore:t.getFilterBarItemSettingsStore(e)},e.id)},this.renderViewSettingsPopup=()=>{const{collectionContextStore:e}=this.props,{createFilterSettingsStore:t}=this.stores;return s()(M.P,{context:b.HV.FilterBar,collectionContextStore:e,collectionSettingsStore:t,hideDesktopHeader:!0})},this.handleNewFilterPopupClick=()=>{const{collectionContextStore:e}=this.props,{createFilterSettingsStore:t}=this.stores;h.wd({environment:this.environment,collectionContextStore:e,action:"click_new_filter"}),S.wl({collectionSettingsStore:t,item:{type:"createFilter"}})},this.handlePopupDismiss=e=>{const{createFilterSettingsStore:t}=this.stores;e&&(0,w.yT)(e.target)||S.E3({collectionSettingsStore:t})},this.handleSearchClick=()=>{const{collectionContextStore:e}=this.props;v.ZH(this.environment),f.ZH(this.environment),y.wG(),e.searchOpen.setState(!0),e.searchQuery.setState(""),h.wd({environment:this.environment,collectionContextStore:e,action:"click_mobile_search"})},this.handleSearchQueryChange=e=>{const{collectionContextStore:t}=this.props;t.searchQuery.setState(e.target.value)},this.handleSearchBlur=()=>{const{collectionContextStore:e}=this.props;e.searchQuery.state||this.handleSearchClearButtonClick()},this.handleSearchClearButtonClick=()=>{const{collectionContextStore:e}=this.props;e.searchOpen.setState(!1),e.searchQuery.setState("")},this.handleFiltersDrop=e=>{const{collectionContextStore:t}=this.props;if(!t.collectionViewBlockStore())return;const o=t.currentPropertyFiltersStore.state,r=a.compact(e.map((e=>o.find((t=>t.id===e)))));g.iU({environment:this.environment,collectionContextStore:t,temporaryState:{...t.temporaryState.state,propertyFilters:{value:r}}}),h.wd({environment:this.environment,collectionContextStore:t,action:"reorder_filters"})},this.handleClick=e=>{const{collectionContextStore:t}=this.props;t.filtersBarOpen.setState(!0)},this.localStateHasChangesStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return(0,C.Nq)(e)}))}renderComponent(){const{collectionContextStore:e}=this.props,{device:t}=this.context.environment,{isPhone:o}=t,r=o&&e.searchOpen.state,n=e.currentPropertyFiltersStore.state,i=e.currentSortsStore.state,a=this.localStateHasChangesStore.state,c=this.props.collectionContextStore.shouldShowSource.state?8:12,p=e.filterBarSortSettingsStore.state.open,d=i.length>0||p,m=e.permissionScopes.state.canConfigureBlock?e.currentCombinatorFilterStore.state:void 0;return s()("div",{style:{width:"100%",zIndex:u._Y},onClick:this.handleClick},void 0,s()("div",{style:{display:"flex",alignItems:"center"}},void 0,r&&this.renderMobileSearchInput(),!r&&s()("div",{style:{position:"relative",flexGrow:0,overflow:"hidden"}},void 0,s()(K.Z,{type:x.Z.X,style:{display:"flex",alignItems:"center",paddingTop:c,paddingBottom:t.isPhone?12:8},showLeftRightOverlay:!t.isPhone},void 0,o?l.createElement(l.Fragment,null,this.renderMobileSearchButton(),d&&this.renderSort(),d&&!t.isPhone&&this.renderDivider(),m&&this.renderCombinatorFilter(),this.renderPropertyFilters(n),this.renderAddFilterButton()):l.createElement(l.Fragment,null,d&&this.renderSort(),d&&!t.isPhone&&this.renderDivider(),m&&this.renderCombinatorFilter(),this.renderPropertyFilters(n),this.renderAddFilterButton()))),s()("div",{style:{display:"flex",alignItems:"center",paddingTop:4,marginLeft:"auto"}},void 0,!o&&a&&this.renderSaveControl(),!o&&this.renderCompleteSprintButton())),o&&!r&&s()("div",{style:{display:"flex",alignItems:"center",marginBottom:4}},void 0,a&&this.renderSaveControl(),this.renderCompleteSprintButton()))}renderSaveControl(){const{collectionContextStore:e,showHoverActionsStore:t}=this.props;return s()(P.ZP,{context:P.R1.FilterBar,collectionContextStore:e,showHoverActionsStore:t,moreActionsButtonPopupStore:this.stores.saveControlMoreActionsButtonPopupStore})}renderPropertyFilters(e){const{collectionContextStore:t}=this.props;if(t.permissionScopes.state.canConfigureBlock){const t=e.map((e=>e.id));return s()(N.ZP,{direction:"horizontal",keys:t,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,renderKey:t=>{const o=e.find((e=>e.id===t));if(o)return this.renderPropertyFilter(o)},style:{display:"flex",flexShrink:0},onDrop:this.handleFiltersDrop})}return e.map(this.renderPropertyFilter)}renderCombinatorFilter(){const{collectionContextStore:e}=this.props;return s()(I.Z,{context:G.FilterBar,collectionSettingsStore:e.filterBarCombinatorFilterSettingsState,collectionContextStore:e})}renderSort(){const{collectionContextStore:e}=this.props;return s()(A,{collectionContextStore:e,collectionSettingsStore:e.filterBarSortSettingsStore},"sort")}renderDivider(){return s()("div",{style:{borderRight:`1px solid ${this.theme.regularDividerColor}`,height:24,marginRight:12,marginLeft:8}})}renderAddFilterButton(){const{showHoverActionsStore:e}=this.props,t=this.stores.createFilterSettingsStore.state.open,o=e.state||t;return s()(Z.ZP,{open:t,popupType:this.environment.device.isMobile?Z.kQ.SlideUp:Z.kQ.Popup,origin:s()(B.Z,{isVisible:!0,animationStyle:{opacity:o?1:0},render:()=>s()(q.Z,{icon:d.Z.plus,isSmall:!0,isLightGray:!0,hovered:t,onClick:this.handleNewFilterPopupClick,style:{fontSize:14}},void 0,s()(m.FormattedMessage,{defaultMessage:"Add filter",id:"database.filterBar.addButton.title"}))}),render:this.renderViewSettingsPopup,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,onDismiss:this.handlePopupDismiss})}renderCompleteSprintButton(){const{collectionContextStore:e}=this.props,t=e.getCompleteSprintButtonContext.state;if(t)return s()(V.v,{collectionContextStore:e,completeSprintAutomationContext:t})}renderMobileSearchInput(){const{collectionContextStore:e,intl:t}=this.props,o=e.searchQuery.state;return s()(E.Z,{capture:!0},void 0,s()(D.Z,{capture:!0,render:e=>l.createElement("div",n()({},e,{style:{width:"100%",paddingTop:this.environment.device.isMobile?8:12,paddingBottom:6}}),s()(F.Z,{wrapStyle:{width:"100%"},innerStyle:{width:"100%"},icon:d.Z.collectionSearch({width:14,fill:this.theme.mediumIconColor,marginRight:6}),hideChevron:!0,title:l.createElement(l.Fragment,null,s()(L.Z,{format:L.B.Transparent,value:o,placeholder:t.formatMessage({defaultMessage:"Type to search…",id:"database.filterBar.mobileSearch.placeholder"}),onChange:this.handleSearchQueryChange,autoComplete:"on",autoCorrect:"on",onBlur:this.handleSearchBlur,onClearButtonClick:this.handleSearchClearButtonClick,showClearButton:!0,focus:!this.environment.device.isIOS||void 0,focusInitial:!0,inputStyle:{height:"100%"}}),s()(O.Z,{show:!0}))}))}))}renderMobileSearchButton(){return s()(F.Z,{wrapStyle:{display:"flex",alignItems:"center"},icon:d.Z.collectionSearch({width:14,fill:this.theme.mediumIconColor,marginRight:6}),hideChevron:!0,title:s()("span",{style:{marginTop:-1,color:this.theme.mediumTextColor}},void 0,s()(m.FormattedMessage,{defaultMessage:"Search",id:"database.filterBar.search.title"})),onClick:this.handleSearchClick},"search")}}U.displayName="CollectionViewFilterBar";const W=(0,m.injectIntl)(U)},58814:(e,t,o)=>{o.d(t,{Z:()=>v});var r=o(23174),n=o.n(r),i=(o(67294),o(83355)),s=o(49085),a=o(53397),l=o(82990),c=o(5366),p=o(77162),d=o(90985),u=o(5149),m=o(68641),h=o(13273),g=o(54634),S=o(33338),y=o(44532);class f extends i.Z{constructor(){super(...arguments),this.storeTypes={collectionSettingsStore:s.default.createClass({open:!1,stack:[]})},this.renderPopup=()=>{const{collectionContextStore:e}=this.props,{collectionSettingsStore:t}=this.stores;return n()(g.P,{context:m.HV.FilterBar,collectionContextStore:e,collectionSettingsStore:t,hideDesktopHeader:!0})},this.handleClick=()=>{const{collectionContextStore:e}=this.props,{collectionSettingsStore:t}=this.stores;this.getFilter()&&(u.wl({collectionSettingsStore:t,item:{type:"filter"}}),p.wd({environment:this.environment,collectionContextStore:e,action:"click_combinator_filter"}))},this.handlePopupDismiss=e=>{var t;if(e&&(0,h.yT)(e.target))return;const{collectionContextStore:o}=this.props,{collectionSettingsStore:r}=this.stores;u.E3({collectionSettingsStore:r});const n=this.getFilter();n&&0===(null===(t=n.filters)||void 0===t?void 0:t.length)&&d.iU({environment:this.environment,collectionContextStore:o,temporaryState:{...o.temporaryState.state,combinatorFilter:{value:void 0}}})},this.hasFilterDiff=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.localStateDiffStore.state;return Boolean(t.combinatorFilter)}))}willUnmount(){u.E3({collectionSettingsStore:this.stores.collectionSettingsStore})}renderComponent(){const{device:e}=this.environment,{collectionSettingsStore:t}=this.stores;return n()(y.ZP,{popupType:e.isMobile?y.ZP.PopupType.SlideUp:y.ZP.PopupType.Popup,open:t.state.open,origin:this.renderOrigin(),onDismiss:this.handlePopupDismiss,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,render:this.renderPopup})}renderOrigin(){var e;const{environment:t}=this,o=this.getFilter();if(o)return n()(S.Z,{icon:a.Z.filter({width:void 0,height:t.device.isMobile?14:12,fill:this.theme.blueColor,marginRight:6}),title:n()("span",{style:this.getTitleStyle()},void 0,n()(c.FormattedMessage,{defaultMessage:"{ruleCount, plural, one {{ruleCount} rule} other {{ruleCount} rules}}",id:"database.filterBar.advancedFilterRulesCount.title",values:{ruleCount:(null===(e=o.filters)||void 0===e?void 0:e.length)||0}})),on:!0,hasDiff:this.hasFilterDiff.state,onClick:this.handleClick},"combinator")}getFilter(){return this.props.collectionContextStore.currentCombinatorFilterStore.state}getTitleStyle(){return{maxWidth:180,...l.Z.textOverflowStyle}}}f.displayName="CollectionViewFilterBarCombinatorFilter";const v=(0,c.injectIntl)(f)},97774:(e,t,o)=>{o.d(t,{Z:()=>H});var r=o(10434),n=o.n(r),i=o(23174),s=o.n(i),a=o(67294),l=o(83355),c=o(49085),p=o(76205),d=o(39068),u=o(82990),m=o(5366),h=o(77162),g=o(90985),S=o(5149),y=o(93959),f=o(97004),v=o(75079),C=o(13273),b=o(29987),w=o(19777),x=o(37709),_=o(33338),M=o(96486),P=o.n(M),I=o(15070),k=o(99036),T=o(40506),F=o(76725),Z=o(23014),R=o(21202),A=o(77420),V=o(6287),B=o(19889),O=o(97880),N=o(7928),D=o(17335),E=o(29376),L=o(68216),q=o(76798),K=o(89845);class G extends l.Z{constructor(){super(...arguments),this.renderSeparator=e=>s()("span",{style:{whiteSpace:"pre"}},e,s()(m.FormattedMessage,{defaultMessage:", ",id:"database.filterValue.commaSeparator"})),this.getRelatedCollectionAppConfigUri=this.createComputedStore((()=>{const{schema:e,propertyFilter:t,parentStore:o}=this.props,r=e[t.property];if(r&&(0,k.p_)(r))return(0,E.ke)(r,o)}))}renderComponent(){const{valueOnly:e,propertyFilter:t,style:o}=this.props,{filter:r}=t,n=(0,p.a_)(r)?r.subfilter:r,i=(0,p.h6)(n)&&!(0,p.mv)(r),a={...o,maxWidth:void 0};return s()("span",{style:(0,p.gE)(n)?a:o},void 0,s()(m.FormattedMessage,{defaultMessage:"{propertyName}{colonSeparator} {filterOperator} {propertyValue}",id:"database.filterBarFilterValue.title",values:{propertyName:e?void 0:this.renderPropertyName(),colonSeparator:e||i?void 0:":",filterOperator:this.renderFilterOperator(),propertyValue:this.renderValue()}}))}renderPropertyName(){const{propertyFilter:e,schema:t}=this.props,o=t[e.property];if(o)return s()("span",{style:{fontWeight:u.Z.fontWeight.medium}},void 0,o.name)}renderFilterOperator(){const{propertyFilter:e}=this.props,{filter:t}=e,o=(0,p.a_)(t)?t.subfilter:t;if((0,p.Ly)(o))return"string_contains"===o.operator||"string_is"===o.operator?void 0:"string_does_not_contain"===o.operator||"string_is_not"===o.operator?this.renderNotOperatorMessage():(0,D.WC)(o.operator);if((0,p.h6)(o))return(0,D.WC)(o.operator);if((0,p.XA)(o)){if("checkbox_is_not"===o.operator)return this.renderNotOperatorMessage()}else{if((0,p.dx)(o))return"enum_is"===o.operator?void 0:"enum_is_not"===o.operator?this.renderNotOperatorMessage():(0,D.WC)(o.operator);if((0,p.NU)(o))return"enum_contains"===o.operator?void 0:"enum_does_not_contain"===o.operator?this.renderNotOperatorMessage():(0,D.WC)(o.operator);if((0,p.r2)(o))return"status_is"===o.operator?void 0:"status_is_not"===o.operator?this.renderNotOperatorMessage():(0,D.WC)(o.operator);if((0,p.e)(o))return"relation_contains"===o.operator?void 0:"relation_does_not_contain"===o.operator?this.renderNotOperatorMessage():(0,D.WC)(o.operator);if((0,p.Gb)(o))return"person_contains"===o.operator?void 0:"person_does_not_contain"===o.operator?this.renderNotOperatorMessage():(0,D.WC)(o.operator);if((0,p.Mp)(o)){if("location_is"===o.operator)return;if("location_is_not"===o.operator)return this.renderNotOperatorMessage()}else if((0,p.gE)(o)){if("date_is"===o.operator)return;if("date_is_after"===o.operator)return s()(m.FormattedMessage,{defaultMessage:"After",id:"database.filterValue.dateType.dateIsAfter.title"});if("date_is_before"===o.operator)return s()(m.FormattedMessage,{defaultMessage:"Before",id:"database.filterValue.dateType.dateIsBefore.title"});if("date_is_on_or_after"===o.operator)return s()(m.FormattedMessage,{defaultMessage:"On or after",id:"database.filterValue.dateType.dateIsOnOrAfter.title"});if("date_is_on_or_before"===o.operator)return s()(m.FormattedMessage,{defaultMessage:"On or before",id:"database.filterValue.dateType.dateIsOnOrBefore.title"});if(!(0,p.TQ)(o))return(0,D.WC)(o.operator);{const e=o.value;if(!e.value||"exact"!==e.type||!(0,T.gR)(e.value))return(0,D.ip)(e);if(e.value.start_date&&e.value.end_date)return;if(e.value.start_date)return s()(m.FormattedMessage,{defaultMessage:"Starting",id:"database.filterValue.dateType.starting.title"});if(e.value.end_date)return s()(m.FormattedMessage,{defaultMessage:"Ending",id:"database.filterValue.dateType.ending.title"})}}else{if((0,p.Jw)(o))return"verification_is"===o.operator?void 0:"verification_is_not"===o.operator?this.renderNotOperatorMessage():(0,D.WC)(o.operator);(0,O.t1)(o)}}}renderNotOperatorMessage(){return s()(m.FormattedMessage,{defaultMessage:"Not",id:"database.filterBarFilterValue.notOperator"})}renderValue(){const{propertyFilter:e,schema:t,intl:o,parentStore:r}=this.props,{filter:n}=e,i=(0,p.a_)(n)?n.subfilter:n;if((0,p.vR)(i))if((0,p.Ly)(i)||(0,p.h6)(i)){const e=i.value.value;if(void 0!==e)return s()("span",{},void 0,e)}else if((0,p.XA)(i)){const e=i.value.value;if(!0===e)return s()("span",{},void 0,s()(m.FormattedMessage,{defaultMessage:"Checked",id:"database.filterValue.checkboxType.checked.title"}));if(!1===e)return s()("span",{},void 0,s()(m.FormattedMessage,{defaultMessage:"Unchecked",id:"database.filterValue.checkboxType.unchecked.title"}))}else{if((0,p.dx)(i)||(0,p.NU)(i)){const e=(0,p.dx)(i)?(0,p.mg)(i):(0,p.qC)(i),t=P().compact(e.map((e=>{let{value:t}=e;return t})));if(0===t.length)return;return s()("span",{},void 0,(0,F.Z)(t,this.renderSeparator))}if((0,p.r2)(i)){const e=(0,p.wB)(i),t=P().compact(e.map((e=>{let{value:t}=e;return t})));if(0===t.length)return;return s()("span",{},void 0,(0,F.Z)(t,this.renderSeparator))}if((0,p.e)(i)){const e=(0,p.YO)(i),t=P().compact(e.map((e=>{if(!e.value)return;const t=e.type;if("exact"===t){const t=L.G.createChildStore(r,{table:R.iU,id:e.value});return s()(q.Z,{style:{display:"inline"},store:t})}if("relative"===t){var o;const t=this.getRelatedCollectionAppConfigUri.state;if(!t)return;return s()("span",{},void 0,null===(o=Z.qB[t])||void 0===o||null===(o=o[e.value.variable])||void 0===o?void 0:o.formattedMessage)}(0,O.t1)(t)})));return(0,F.Z)(t,this.renderSeparator)}if((0,p.Gb)(i)){const e=(0,p.R8)(i),t=P().compact(e.map((e=>{if("relative"===e.type)return s()("span",{},void 0,s()(m.FormattedMessage,{defaultMessage:"Me",id:"database.filterValue.personType.firstPersonPropertyValue.title"}));if(e.value){const t=e.value;if(t.table===B.KJ){const e=L.t1.createChildStore(r,{table:t.table,id:t.id});return s()("span",{},void 0,(0,N.Nz)(o,e.getModel()))}if(t.table===A.cZ){const e=L.t1.createChildStore(r,{table:t.table,id:t.id});return s()("span",{},void 0,(0,I.Mh)(e.getModel()))}}})));return(0,F.Z)(t,this.renderSeparator)}if((0,p.Mp)(i)){const e=(0,p.u0)(i),t=P().compact(e.map((e=>{if(e.value){const t=e.value,o=L.t1.createChildStore(r,{table:V.v,id:t});return s()(q.Z,{style:{display:"inline"},store:o})}})));return(0,F.Z)(t,this.renderSeparator)}if((0,p.gE)(i)){const o=t[e.property],r=(o&&"date"===o.type?o.date_format:void 0)||T.sF;let n;if("exact"===i.value.type){const e=i.value;if(e.value)if((0,T.J_)(e.value))n=e.value;else if((0,T.gR)(e.value)){const t=(0,T.Gc)(e.value);t&&(n=t.value)}}else if(!(0,p.TQ)(i))return(0,D.x)(i.value);if(n)return s()(K.Z,{style:{display:"inline"},value:n,dateFormat:r,shortenDateAndRange:!0})}else{if((0,p.Jw)(i)){const e=(0,p.fl)(i).filter((e=>{let{value:t}=e;return Boolean(t)})).map(D.cq);if(0===e.length)return;return s()("span",{},void 0,(0,F.Z)(e,this.renderSeparator))}(0,O.t1)(i)}}}}G.displayName="CollectionViewFilterValue";const U=(0,m.injectIntl)(G);var W=o(44532),z=o(58032);class $ extends l.Z{constructor(){super(...arguments),this.storeTypes={collectionSettingsStore:c.default.createClass({open:!1,stack:[]})},this.renderPopup=()=>{var e;const{collectionContextStore:t}=this.props,o=this.getFilter();if(!o)return;const r=o.filter,n=t.normalizedSchemaStore.state,i=t.collectionViewStore(),a=t.permissionScopes.state;if(!i)return;const l=null==t||null===(e=t.collectionStore())||void 0===e||null===(e=e.getSchema()[o.filter.property])||void 0===e?void 0:e.type;return s()(w.ZP,{collectionViewId:i.id,propertyFilter:r,schema:n,parentStore:i,onChange:e=>this.handleValueChange(e,l),onClose:this.handleFilterValueMenuClose,onDelete:this.handleDeleteFilter,onAddToCombinatorFilter:this.handleAddToCombinatorFilter,context:w.Qv.PropertyFilter,allowAddingToCombinatorFilter:a.canConfigureBlock,allowRelativeDateFilter:!0,allowRelativePersonFilter:!0})},this.handleClick=()=>{var e;const{collectionContextStore:t}=this.props,{collectionSettingsStore:o}=this.stores,r=this.getFilter();r&&(S.wl({collectionSettingsStore:o,item:{type:"filter"}}),h.wd({environment:this.environment,collectionContextStore:t,action:"click_property_filter",original_view_type:void 0,property_type:null==t||null===(e=t.collectionStore())||void 0===e||null===(e=e.getSchema()[r.filter.property])||void 0===e?void 0:e.type}))},this.handleValueChange=(e,t)=>{var o;const{collectionContextStore:r}=this.props,n=this.getFilter();if(!n)return;const i=null===(o=r.remoteResult.state)||void 0===o?void 0:o.sizeHint,s=b.default.mark("collections.update_filter_lag");b.default.measureAfterNextFlush(s,{environment:this.environment,getData:()=>v.Y5({from:"property_filter",property_type:t,collectionContextStore:r,sizeHintAtStart:i})});const a=n.filter,l=r.currentPropertyFiltersStore.state.map((t=>{if(t.id===n.id){return{...n,filter:{...a,filter:e}}}return t}));g.iU({environment:this.environment,collectionContextStore:r,temporaryState:{...r.temporaryState.state,propertyFilters:{value:l}}}),h.wd({environment:this.environment,collectionContextStore:r,action:"update_property_filter",original_view_type:void 0,property_type:t})},this.handlePopupDismiss=e=>{if(e&&(0,C.yT)(e.target))return;const{collectionSettingsStore:t}=this.stores;S.E3({collectionSettingsStore:t})},this.handleFilterValueMenuClose=()=>{const{collectionSettingsStore:e}=this.stores;S.E3({collectionSettingsStore:e})},this.handleDeleteFilter=()=>{var e;const{collectionContextStore:t}=this.props,o=this.getFilter();if(!o)return;const r=t.currentPropertyFiltersStore.state.filter((e=>e.id!==o.id));g.iU({environment:this.environment,collectionContextStore:t,temporaryState:{...t.temporaryState.state,propertyFilters:{value:r}}}),h.wd({environment:this.environment,collectionContextStore:t,action:"delete_property_filter",original_view_type:void 0,property_type:null==t||null===(e=t.collectionStore())||void 0===e||null===(e=e.getSchema()[o.filter.property])||void 0===e?void 0:e.type})},this.handleAddToCombinatorFilter=()=>{var e;const{collectionContextStore:t,context:o}=this.props,r=this.getFilter();if(!r)return;const{combinatorFilter:n,propertyFilters:i}=(0,f.Gz)(t,r);g.iU({environment:this.environment,collectionContextStore:t,temporaryState:{...t.temporaryState.state,propertyFilters:{value:i},combinatorFilter:{value:n}}});const s=o===x.P.FilterBar?t.filterBarCombinatorFilterSettingsState:t.filterOptionsCombinatorFilterSettingsState;S.wl({collectionSettingsStore:s,item:{type:"filter"}}),h.wd({environment:this.environment,collectionContextStore:t,action:"merge_filter_into_combinator",property_type:null==t||null===(e=t.collectionStore())||void 0===e||null===(e=e.getSchema()[r.filter.property])||void 0===e?void 0:e.type})},this.hasFilterDiff=this.createComputedStore((()=>{const{id:e,collectionContextStore:t}=this.props,o=t.localStateDiffStore.state;return o.filters.updated.includes(e)||o.filters.added.includes(e)}))}willUnmount(){S.E3({collectionSettingsStore:this.stores.collectionSettingsStore})}renderComponent(){const{device:e}=this.environment,{collectionSettingsStore:t}=this.stores,o=this.getFilter(),r=Boolean(o&&(0,y.EE)(o.id));return s()(W.ZP,{popupType:e.isMobile?W.ZP.PopupType.SlideUp:W.ZP.PopupType.Popup,open:t.state.open,origin:r?this.renderReadOnlyOrigin():this.renderOrigin(void 0,!1),onDismiss:this.handlePopupDismiss,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,render:this.renderPopup})}renderReadOnlyOrigin(){return s()(z.Z,{placement:z.Z.Placement.Left,render:e=>this.renderOrigin(e,!0),renderTooltip:()=>s()(m.FormattedMessage,{id:"database.filterBarPropertyFilter.cannotConfigure",defaultMessage:"This filter can’t be deleted on this view."})})}renderOrigin(e,t){const{collectionContextStore:o}=this.props,{device:r}=this.environment,i=this.getFilter(),l=o.normalizedSchemaStore.state,c=o.collectionViewStore();if(!c||!i)return;const u=i.filter,m=!(0,p.Oo)(u),h=l[u.property],{theme:g}=this;return a.createElement(_.Z,n()({icon:h&&s()(d.ZP,{type:h.type,icon:h.icon,size:r.isMobile?18:16,theme:g,style:{fill:m?g.blueColor:g.mediumIconColor,marginRight:6}}),title:m?s()(U,{propertyFilter:u,schema:l,style:this.getTitleStyle(),parentStore:c}):s()("span",{style:this.getTitleStyle()},void 0,null==h?void 0:h.name),key:i.id,on:m,hasDiff:this.hasFilterDiff.state,onClick:this.handleClick,disabled:t,hideChevron:t},e))}getFilter(){const{id:e,collectionContextStore:t}=this.props;return t.currentPropertyFiltersStore.state.find((t=>t.id===e))}getTitleStyle(){return{maxWidth:180,...u.Z.textOverflowStyle}}}$.displayName="CollectionViewFilterBarPropertyFilter";const H=(0,m.injectIntl)($)},33338:(e,t,o)=>{o.d(t,{Z:()=>c});var r=o(23174),n=o.n(r),i=(o(67294),o(480)),s=o(24405),a=o(53397),l=o(64921);function c(e){window.__c={n:"CollectionViewFilterPill"};const{icon:t,title:o,on:r,hasDiff:c,wrapStyle:d,innerStyle:u,hideChevron:m}=e,h=(0,s.Fg)(),g=(0,i.O7)();return n()("div",{style:{borderRadius:14,marginRight:6,display:"inline-flex",...c&&{position:"relative"},...d}},void 0,n()(l.Z,{disabled:e.disabled,style:p(Boolean(r),h,u,g.device.isMobile),hoveredStyle:r?{background:h.outlineBlueButtonHoveredBackground}:void 0,pressedStyle:r?{background:h.outlineBlueButtonPressedBackground}:void 0,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,onClick:e.onClick,onDoubleClick:e.onDoubleClick},void 0,t,o,!m&&a.Z.chevronDown({width:10,marginLeft:4,marginTop:1,fill:r?h.blueColor:h.lightIconColor})),c&&n()("div",{style:{position:"absolute",top:-2,right:-2,background:"dark"===h.mode?h.accentColors.orange[500]:h.accentColors.orange[300],border:`1px solid ${h.contentBackground}`,width:9,height:9,borderRadius:9}}))}function p(e,t,o,r){return{fontSize:14,display:"inline-flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",borderRadius:32,height:r?28:24,lineHeight:r?"28px":"24px",padding:"0 8px",border:`1px solid ${t.outlineButtonBorder}`,color:t.mediumTextColor,...e&&{color:t.blueColor,border:`1px solid ${t.filterPillBorder}`,background:t.filterPillBackground},...o}}},68689:(e,t,o)=>{o.d(t,{v:()=>ht});var r=o(23174),n=o.n(r),i=o(67294),s=o(480),a=o(81954),l=o(24405),c=o(5366),p=o(82990),d=o(50906),u=o(27370),m=o(97004),h=o(75079),g=o(64856),S=o(79315),y=o(10161),f=o(64203),v=o(10434),C=o.n(v),b=(o(21703),o(53150)),w=o(63123),x=o(49085),_=o(15145),M=o(99036),P=o(23482),I=(o(57658),o(30541),o(21202)),k=o(77420),T=o(19889),F=o(70203),Z=o(97880);class R{}R.text=e=>new B(e),R.mentionDate=e=>new N(e),R.mentionUser=e=>new D(e),R.mentionGroup=(e,t)=>new K(e,t),R.mentionBot=e=>new D(e),R.mentionPage=e=>new D(e),R.mentionTemplateVariable=e=>new E(e),R.mentionFormulaContextVariable=e=>new L(e),R.mentionFormulaPagePropertyVariable=e=>new q(e),R.equation=e=>new O(e),R.concat=e=>new A(e);class A{constructor(e){this.build=()=>{const e=[];for(const t of this.tokens){const o=t.build();e.push(o[0])}return e},this.tokens=e}}class V{constructor(e){this.styles={},this.highlight=void 0,this.bold=()=>(this.styles[F.GK.Bold]=!0,this),this.italic=()=>(this.styles[F.GK.Italic]=!0,this),this.strike=()=>(this.styles[F.GK.Strike]=!0,this),this.code=()=>(this.styles[F.GK.Code]=!0,this),this.underline=()=>(this.styles[F.GK.Underline]=!0,this),this.color=e=>(this.highlight=e,this),this.build=()=>{const e=[];for(const t of(0,Z.Yd)(this.styles))e.push([t]);return this.highlight&&e.push([F.GK.Highlight,this.highlight]),this.onBuild(e)},this.onBuild=e}}class B extends V{constructor(e){super((t=>{if(this.url&&t.unshift(F.ed(this.url)),t.length>0){return[[e,t]]}return[[e]]})),this.url=void 0,this.link=e=>(this.url=e,this)}}class O extends V{constructor(e){super((t=>[F.qZ(e,t)]))}}class N extends V{constructor(e){super((t=>{let o;"date"in e?o=this.getDateAnnotationData(e.date):"time"in e?o=this.getTimeAnnotationData(e.time):(0,Z.t1)(e);const r=F.pZ(o);return[F.YC(r,t)]})),this.getDateString=e=>e.toISOString().split("T")[0],this.getTimeString=e=>e.toISOString().split("T")[1].slice(0,5)}getDateAnnotationData(e){if(Array.isArray(e)){const[t,o]=e;return{type:"daterange",start_date:this.getDateString(t),end_date:this.getDateString(o)}}return{type:"date",start_date:this.getDateString(e)}}getTimeAnnotationData(e){if(Array.isArray(e)){const[t,o]=e;return{type:"datetimerange",start_date:this.getDateString(t),start_time:this.getTimeString(t),end_date:this.getDateString(o),end_time:this.getTimeString(o),time_zone:"Etc/GMT"}}return{type:"datetime",start_date:this.getDateString(e),start_time:this.getTimeString(e),time_zone:"Etc/GMT"}}}class D extends V{constructor(e){super((t=>{let o;return e.table===T.KJ?o=F.tE(e.id):e.table===k.cZ?o=F.Cb(e.id):e.table===I.iU?o=F.$0(e.id,e.spaceId):(0,Z.t1)(e),[F.YC(o,t)]}))}}class E extends V{constructor(e){super((t=>{const o=F.WB({type:e});return[F.YC(o,t)]}))}}class L extends V{constructor(e){super((t=>{const o=F._Q(e);return[F.YC(o,t)]}))}}class q extends V{constructor(e){super((t=>{const o=F.kb(e);return[F.YC(o,t)]}))}}class K extends V{constructor(e,t){super((o=>{const r=F.XI(e,t);return[F.YC(r,o)]}))}}var G=o(78106),U=o(4615),W=o(23014),z=o(6287);const $=(0,c.defineMessages)({nextSprintName:{id:"structuredAutomations.createNextSprint.nextSprintName",defaultMessage:"Sprint"}});function H(e){const{createNextSprintActionId:t,sprintCollectionPointer:o,sprintStatusNextOptionName:r,intl:n,spaceId:i,getCurrentSprintActionId:s,sprintStatusPropertyId:a,sprintUniqueIdPropertyId:l}=e;return{id:t,type:"create_page",config:{values:{title:{value:{type:"formula",value:re({actionId:s,sprintCollectionPointer:o,sprintUniqueIdPropertyId:l,incrementBy:1,intl:n})},action:"replace"},[a]:{value:{type:"simple",value:[[`"${r}"`]]},action:"replace"}},properties:["title",a],collection:o},space_id:i}}function Y(e){const{getCurrentSprintActionId:t,sprintCollectionPointer:o,sprintCollectionSchema:r,spaceId:n}=e;return{id:t,type:"query_collection",config:{filter:W.qB[P.p$].current.reducer.getCombinatorFilter(r),collection:o},space_id:n}}function j(e){const{getLargestUniqueIdSprintActionId:t,sprintCollectionPointer:o,sprintUniqueIdPropertyId:r,spaceId:n}=e;return{id:t,type:"query_collection",config:{filter:void 0,collection:o,sort:[{property:r,direction:"descending"}],limit:1},space_id:n}}function Q(e){const{createFutureSprintActionId:t,sprintCollectionPointer:o,sprintStatusFutureOptionName:r,intl:n,spaceId:i,getLargestUniqueIdSprintActionId:s,sprintStatusPropertyId:a,sprintUniqueIdPropertyId:l,incrementBy:c}=e;return{id:t,type:"create_page",config:{values:{title:{value:{type:"formula",value:re({actionId:s,sprintCollectionPointer:o,sprintUniqueIdPropertyId:l,intl:n,incrementBy:c})},action:"replace"},[a]:{value:{type:"simple",value:[[`"${r}"`]]},action:"replace"}},properties:["title",a],collection:o},space_id:i}}function X(e){const{updateFutureSprintToNextActionId:t,sprintCollectionPointer:o,sprintStatusNextOptionName:r,sprintStatusFutureOptionName:n,spaceId:i,sprintStatusPropertyId:s,sprintUniqueIdPropertyId:a}=e;return{id:t,type:"update_pages",config:{target:{type:"collection",collection:o,filter:{operator:"and",filters:[{property:s,filter:{operator:"status_is",value:{type:"is_option",value:n}}}]},sort:[{property:a,direction:"ascending"}],limit:1},values:{[s]:{value:{type:"simple",value:[[`"${r}"`]]},action:"replace"}},properties:[s]},space_id:i}}function J(e){const{moveIncompleteTasksActionId:t,createNextSprintActionId:o,taskCollectionPointer:r,taskStatusCompleteGroupName:n,spaceId:i,nextSprintInput:s,taskStatusPropertyId:a,taskSprintRelationPropertyId:l}=e;return{id:t,type:"update_pages",config:{target:{type:"collection",collection:r,filter:{operator:"and",filters:[{property:a,filter:{operator:"status_is_not",value:{type:"is_group",value:n}}},{filter:{operator:"relation_contains",value:{type:"relative",value:{type:"builtin",variable:"current"}}},property:l}]}},properties:[l],values:{[l]:{value:{type:"simple",value:"pointer"===s.type?R.mentionPage(s.pointer).build():R.mentionFormulaContextVariable({id:(0,G.Kd)({source:"action",action_id:o,action_output_type:"page"})}).build()},action:"replace"}}},space_id:i}}function ee(e){const{moveIncompleteTasksToBacklogActionId:t,taskCollectionPointer:o,taskStatusCompleteGroupName:r,spaceId:n,taskStatusPropertyId:i,taskSprintRelationPropertyId:s}=e;return{id:t,type:"update_pages",config:{target:{type:"collection",collection:o,filter:{operator:"and",filters:[{property:i,filter:{operator:"status_is_not",value:{type:"is_group",value:r}}},{filter:{operator:"relation_contains",value:{type:"relative",value:{type:"builtin",variable:"current"}}},property:s}]}},properties:[s],values:{[s]:{value:void 0,action:"remove"}}},space_id:n}}function te(e){const{updateCurrentSprintToPastActionId:t,getCurrentSprintActionId:o,sprintStatusPastOptionName:r,spaceId:n,sprintStatusPropertyId:i}=e;return{id:t,type:"update_pages",config:{target:{id:(0,G.Kd)({source:"action",action_id:o,action_output_type:"pages"}),type:"variable"},values:{[i]:{value:{type:"simple",value:[[`"${r}"`]]},action:"replace"}},properties:[i]},space_id:n}}function oe(e){const{updateNextSprintToCurrentActionId:t,createNextSprintActionId:o,sprintStatusCurrentOptionName:r,spaceId:n,nextSprintInput:i,nextSprintDateRange:s,sprintStatusPropertyId:a,sprintDatePropertyId:l}=e;return{id:t,type:"update_pages",config:{target:"pointer"===i.type?{type:"page",page:i.pointer}:{id:(0,G.Kd)({source:"action",action_id:o,action_output_type:"page"}),type:"variable"},values:{[a]:{value:{type:"simple",value:[[`"${r}"`]]},action:"replace"},[l]:{value:{type:"simple",value:[(0,F.YC)(["d",s])]},action:"replace"}},properties:[a,l]},space_id:n}}function re(e){const{actionId:t,sprintCollectionPointer:o,sprintUniqueIdPropertyId:r,incrementBy:n,intl:i}=e;return R.concat([R.text(`joinText(" ", "${i.formatMessage($.nextSprintName)}", _toPlainText(`),R.mentionFormulaContextVariable({id:(0,G.Kd)({source:"action",action_id:t,action_output_type:"pages"})}),R.text(".first()."),R.mentionFormulaPagePropertyVariable({collection:o,property:r}),R.text(`+${n}))`)]).build()}var ne=o(8848),ie=o(84619),se=o(40506),ae=o(7057),le=o(53397),ce=o(29477),pe=o(606),de=o(68626),ue=o(63143),me=o(98114),he=o(64434),ge=o(5978),Se=o(87279),ye=o(37034),fe=o(29376),ve=o(58484),Ce=o(68216),be=o(16790),we=o(78030),xe=o(42922),_e=o(52275),Me=o(31945),Pe=o(36596),Ie=o(78140),ke=o(32163),Te=o(40721),Fe=o(89728),Ze=o(31278),Re=o(76798),Ae=o(72495),Ve=o(83264),Be=o(53953),Oe=o(44532);function Ne(e){window.__c={n:"DefaultPopupOrModalFunctional"};const{isOpen:t,onDismiss:o,render:r,origin:i,style:a,innerStyle:l,ariaLabel:c,ariaLabelledBy:p}=e,{isMobile:d}=(0,s.Fy)();return d?n()(Oe.ZP,{ariaLabel:c,ariaLabelledBy:p,open:t,popupType:Oe.ZP.PopupType.SlideUp,origin:i,onDismiss:o,render:r,style:a}):n()(Be.Z,{ariaLabel:c,ariaLabelledBy:p,open:t,preventHideChildrenWhileOpening:!0,render:r,onDismiss:o,style:a,innerStyle:l})}var De=o(85567);const Ee=(0,c.defineMessages)({completedPercentSummary:{id:"completeAutomationSprintModal.sprintSummary.completedPercentSummary",defaultMessage:"{completedTaskCount} / {totalTaskCount} total tasks"},selectNextSprintLabel:{id:"completeAutomationSprintModal.sprintSummary.selectNextSprintLabel",defaultMessage:"Next sprint"},selectDatesForNextSprintLabel:{id:"completeAutomationSprintModal.sprintSummary.selectDatesForNextSprintLabel",defaultMessage:"Start and end dates"},nextSprintDatesLabel:{id:"completeAutomationSprintModal.sprintSummary.nextSprintDatesLabel",defaultMessage:"Next sprint dates"},cancelButton:{id:"completeAutomationSprintModal.sprintSummary.cancel",defaultMessage:"Cancel"},fallbackSprintName:{id:"completeAutomationSprintModal.sprintName.placeholder",defaultMessage:"Sprint"}});function Le(e){let{onDismiss:t,...o}=e;window.__c={n:"CompleteSprintAutomationModal"};const{isOpen:r}=o,a=(0,s.O7)(),l=(0,b.C)(),c=e=>{t();let r=!1;(0,Z.Kn)(e)&&(0,Z.$K)(e.clickedCancel)&&(r=!0===e.clickedCancel),d.$Xl(a,{...(0,h.Pn)(o.taskCollectionContextStore),action:r?"cancel_modal":"dismiss_modal"})};return n()(Ne,{ariaLabelledBy:l,isOpen:r,onDismiss:()=>c(),render:()=>i.createElement(qe,C()({},o,{onDismiss:c,titleAriaId:l}))})}function qe(e){window.__c={n:"SprintSummaryModal"};const{completeSprintAutomationContext:t,setIsLoading:o,taskCollectionContextStore:r,onDismiss:l,completeSprintAutomationState:p,onAutomationComplete:u,titleAriaId:m}=e,{sprintCollectionStore:g}=t,{currentSprintId:S,querySprintsResult:y,currentSprintTaskSummary:f}=p,v=(0,c.useIntl)(),C=(0,s.O7)(),{isMobile:b}=(0,s.Fy)(),_=(0,a.VK)((()=>g.getSpaceId()),[g]),k=(0,a.VK)((()=>{if(S)return Ce.G.createChildStore(g,{id:S,table:I.iU,spaceId:g.getSpaceId()})}),[S,g]),T=(0,a.VK)((()=>k?(0,ye.vU)({intl:v,environment:C,store:k,untitledFallback:Ee.fallbackSprintName}):v.formatMessage(Ee.fallbackSprintName)),[k,v,C]),F=(0,a.VK)((()=>$e({sprintDateRange:ze({sprintBlockStore:k,sprintCollectionStore:g}),intl:v})),[k,g,v]),[R,A]=i.useState(),V=(0,a.VK)((()=>x.default.createValue("complete_sprint_and_move_incomplete_tasks_to_next_sprint")),[]),B=(0,a.VK)((()=>{if("pointer"!==(null==R?void 0:R.type))return;return ze({sprintBlockStore:Ce.G.createChildStore(g,R.pointer),sprintCollectionStore:g})}),[R,g]),[O,N]=i.useState(void 0),D=i.useMemo((()=>{if(O&&(0,se.h)(O))return O}),[O]),E=i.useMemo((()=>{if(!y)return;const{nextSprintIds:e,futureSprintIds:t}=y;return e.length>0?e:t}),[y]),L=(0,a.VK)((()=>{if(void 0===E)return;const e=E[0];return e?{type:"pointer",pointer:{id:e,table:I.iU,spaceId:_}}:{type:"actionId"}}),[E,_]);i.useEffect((()=>{L&&A(L)}),[L,A]),i.useEffect((()=>{N(B)}),[B,N]);const q=i.useCallback((async()=>{if(l(),!R||!D)return;o(!0);const e=0===(null==f?void 0:f.incompleteTaskCount)?"complete_sprint":V.state,n=function(e){var t,o,r,n,i,s,a;const{sprintCollectionValue:l,nextSprintInput:c,intl:p,nextSprintDateRange:d}=e,u=l.space_id,m={id:l.id,table:z.v,spaceId:u},h=(0,U.ZP)(),g=(0,U.ZP)(),S=(0,U.ZP)(),y=(0,U.ZP)(),f=(0,U.ZP)(),v=(0,U.ZP)(),C=(0,U.ZP)(),b=(0,M.oC)(l),w=null===(t=l.format)||void 0===t||null===(t=t.app_uri_map)||void 0===t?void 0:t[P.b0.StatusV2];if(!w)return{error:{message:`${P.b0.StatusV2} not found.`}};const x=null===(o=l.format)||void 0===o||null===(o=o.app_uri_map)||void 0===o?void 0:o[P.b0.UniqueId];if(!x)return{error:{message:`${P.b0.UniqueId} not found.`}};const _=null===(r=l.format)||void 0===r||null===(r=r.app_uri_map)||void 0===r?void 0:r[P.b0.Dates];if(!_)return{error:{message:`${P.b0.Dates} not found.`}};const I=b[w];if(!I||"status"!==I.type)return{error:{message:`${P.b0.StatusV2} not found.`}};const k=null===(n=I.options)||void 0===n||null===(n=n.find((e=>e.id===P.J1)))||void 0===n?void 0:n.value,T=null===(i=I.options)||void 0===i||null===(i=i.find((e=>e.id===P.SF)))||void 0===i?void 0:i.value,F=null===(s=I.options)||void 0===s||null===(s=s.find((e=>e.id===P.YE)))||void 0===s?void 0:s.value,R=null===(a=I.options)||void 0===a||null===(a=a.find((e=>e.id===P.eH)))||void 0===a?void 0:a.value;if(!(k&&T&&F&&R))return{error:{message:`Could not find required options for ${P.b0.StatusV2}.`}};const A="pointer"===c.type?1:2;if("complete_sprint"===e.type)return{value:[j({getLargestUniqueIdSprintActionId:v,sprintCollectionPointer:m,sprintUniqueIdPropertyId:x,spaceId:u}),Y({getCurrentSprintActionId:h,sprintCollectionPointer:m,sprintCollectionSchema:b,spaceId:u}),..."pointer"===c.type?[]:[H({createNextSprintActionId:C,getCurrentSprintActionId:h,sprintCollectionPointer:m,sprintStatusNextOptionName:F,intl:p,spaceId:u,sprintStatusPropertyId:w,sprintUniqueIdPropertyId:x})],te({updateCurrentSprintToPastActionId:g,getCurrentSprintActionId:h,sprintStatusPastOptionName:k,sprintStatusPropertyId:w,spaceId:u}),oe({updateNextSprintToCurrentActionId:S,createNextSprintActionId:C,nextSprintInput:c,sprintStatusCurrentOptionName:T,sprintStatusPropertyId:w,spaceId:u,nextSprintDateRange:d,sprintDatePropertyId:_}),Q({createFutureSprintActionId:f,sprintCollectionPointer:m,sprintStatusFutureOptionName:R,getLargestUniqueIdSprintActionId:v,intl:p,spaceId:u,sprintStatusPropertyId:w,sprintUniqueIdPropertyId:x,incrementBy:A}),X({updateFutureSprintToNextActionId:y,sprintCollectionPointer:m,sprintStatusNextOptionName:F,sprintStatusFutureOptionName:R,spaceId:u,sprintStatusPropertyId:w,sprintUniqueIdPropertyId:x})]};if("complete_sprint_and_move_incomplete_tasks_to_next_sprint"===e.type){var V,B,O;const{taskCollectionValue:t}=e,o={id:t.id,table:z.v,spaceId:t.space_id},r=(0,U.ZP)(),n=null===(V=t.format)||void 0===V||null===(V=V.app_uri_map)||void 0===V?void 0:V[P.Es.Status];if(!n)return{error:{message:`${P.Es.Status} not found.`}};const i=null===(B=t.format)||void 0===B||null===(B=B.app_uri_map)||void 0===B?void 0:B[P.Es.TaskToSprintRelation];if(!i)return{error:{message:`${P.Es.TaskToSprintRelation} not found.`}};const s=(0,M.oC)(t)[n];if(!s||"status"!==s.type)return{error:{message:`${P.Es.Status} not found.`}};const a=null===(O=s.groups)||void 0===O||null===(O=O.find((e=>e.id===P.uS)))||void 0===O?void 0:O.name;return a?{value:[j({getLargestUniqueIdSprintActionId:v,sprintCollectionPointer:m,sprintUniqueIdPropertyId:x,spaceId:u}),Y({getCurrentSprintActionId:h,sprintCollectionPointer:m,sprintCollectionSchema:b,spaceId:u}),..."pointer"===c.type?[]:[H({createNextSprintActionId:C,getCurrentSprintActionId:h,sprintCollectionPointer:m,sprintStatusNextOptionName:F,intl:p,spaceId:u,sprintStatusPropertyId:w,sprintUniqueIdPropertyId:x})],J({moveIncompleteTasksActionId:r,createNextSprintActionId:C,nextSprintInput:c,taskCollectionPointer:o,taskStatusCompleteGroupName:a,spaceId:u,taskStatusPropertyId:n,taskSprintRelationPropertyId:i}),te({updateCurrentSprintToPastActionId:g,getCurrentSprintActionId:h,sprintStatusPastOptionName:k,spaceId:u,sprintStatusPropertyId:w}),oe({updateNextSprintToCurrentActionId:S,createNextSprintActionId:C,nextSprintInput:c,sprintStatusCurrentOptionName:T,spaceId:u,sprintStatusPropertyId:w,nextSprintDateRange:d,sprintDatePropertyId:_}),Q({createFutureSprintActionId:f,sprintCollectionPointer:m,sprintStatusFutureOptionName:R,getLargestUniqueIdSprintActionId:v,intl:p,spaceId:u,sprintStatusPropertyId:w,sprintUniqueIdPropertyId:x,incrementBy:A}),X({updateFutureSprintToNextActionId:y,sprintCollectionPointer:m,sprintStatusNextOptionName:F,sprintStatusFutureOptionName:R,spaceId:u,sprintStatusPropertyId:w,sprintUniqueIdPropertyId:x})]}:{error:{message:`Could not find required group for ${P.Es.Status}.`}}}if("complete_sprint_and_move_incomplete_tasks_to_backlog"===e.type){var N,D,E;const{taskCollectionValue:t}=e,o={id:t.id,table:z.v,spaceId:t.space_id},r=(0,U.ZP)(),n=null===(N=t.format)||void 0===N||null===(N=N.app_uri_map)||void 0===N?void 0:N[P.Es.Status];if(!n)return{error:{message:`${P.Es.Status} not found.`}};const i=null===(D=t.format)||void 0===D||null===(D=D.app_uri_map)||void 0===D?void 0:D[P.Es.TaskToSprintRelation];if(!i)return{error:{message:`${P.Es.TaskToSprintRelation} not found.`}};const s=(0,M.oC)(t)[n];if(!s||"status"!==s.type)return{error:{message:`${P.Es.Status} not found.`}};const a=null===(E=s.groups)||void 0===E||null===(E=E.find((e=>e.id===P.uS)))||void 0===E?void 0:E.name;return a?{value:[j({getLargestUniqueIdSprintActionId:v,sprintCollectionPointer:m,sprintUniqueIdPropertyId:x,spaceId:u}),Y({getCurrentSprintActionId:h,sprintCollectionPointer:m,sprintCollectionSchema:b,spaceId:u}),..."pointer"===c.type?[]:[H({createNextSprintActionId:C,getCurrentSprintActionId:h,sprintCollectionPointer:m,sprintStatusNextOptionName:F,intl:p,spaceId:u,sprintStatusPropertyId:w,sprintUniqueIdPropertyId:x})],ee({moveIncompleteTasksToBacklogActionId:r,taskCollectionPointer:o,taskStatusCompleteGroupName:a,spaceId:u,taskStatusPropertyId:n,taskSprintRelationPropertyId:i}),te({updateCurrentSprintToPastActionId:g,getCurrentSprintActionId:h,sprintStatusPastOptionName:k,spaceId:u,sprintStatusPropertyId:w}),oe({updateNextSprintToCurrentActionId:S,createNextSprintActionId:C,nextSprintInput:c,sprintStatusCurrentOptionName:T,spaceId:u,sprintStatusPropertyId:w,nextSprintDateRange:d,sprintDatePropertyId:_}),Q({createFutureSprintActionId:f,sprintCollectionPointer:m,sprintStatusFutureOptionName:R,getLargestUniqueIdSprintActionId:v,intl:p,spaceId:u,sprintStatusPropertyId:w,sprintUniqueIdPropertyId:x,incrementBy:A}),X({updateFutureSprintToNextActionId:y,sprintCollectionPointer:m,sprintStatusNextOptionName:F,sprintStatusFutureOptionName:R,spaceId:u,sprintStatusPropertyId:w,sprintUniqueIdPropertyId:x})]}:{error:{message:`Could not find required group for ${P.Es.Status}.`}}}return(0,Z.t1)(e.type)}({type:e,sprintCollectionValue:t.sprintCollectionValue,taskCollectionValue:t.taskCollectionValue,nextSprintInput:R,nextSprintDateRange:D,intl:v});if(d.$Xl(C,{...(0,h.Pn)(r),action:"complete_sprint",currentSprintTaskSummary:p.currentSprintTaskSummary,completeSprintActionType:e,nextSprintDateRange:D,nextSprintInput:R}),de.x.isFail(n))throw new Error(n.error.message);await me.oS({environment:C,store:t.blockStore,clientContext:{type:"structured_automation",persisted:!1,intl:v,parentRecordStore:t.blockStore,actions:n.value,parentPointer:t.blockStore.getSpaceShardedPointer()}}),u(),await Promise.all([he.dj(C,r,{src:"complete_sprint_automation",queuedTimestamp:Date.now()}),(0,ce.Vs)(1e3)]),o(!1)}),[t,r,C,v,o,l,R,V,D,null==f?void 0:f.incompleteTaskCount,u,p.currentSprintTaskSummary]),K=Ue({isMobile:b}),{status:G}=(0,w.V)({value:p,validateLoaded:e=>!1===e.isLoading,waitTimeInMs:1*ue.hM});if("pending"!==G&&p.isLoading)return n()(Ke,{titleAriaId:m,onDismiss:l,sprintCollectionStore:g});if(p.isLoading)return n()(Ge,{titleAriaId:m,onDismiss:l});const{incompleteTaskCount:W}=p.currentSprintTaskSummary,$=Boolean(R)&&Boolean(D),re=void 0!==E&&E.length>0;return n()("div",{style:K.modalContainer},void 0,n()("div",{style:K.header,id:m},void 0,n()(c.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.title",defaultMessage:"{sprintName} summary",values:{sprintName:T}})),n()(We,{currentSprintFormattedDateRange:F,currentSprintTaskSummary:f}),re&&n()("div",{style:K.flexRow},void 0,v.formatMessage(Ee.selectNextSprintLabel),n()(Xe,{nextSprintInput:R,setNextSprintInput:A,completeSprintAutomationContext:t,sprintPageIds:E})),n()("div",{style:K.flexRow},void 0,re?v.formatMessage(Ee.selectDatesForNextSprintLabel):v.formatMessage(Ee.nextSprintDatesLabel),n()(et,{sprintDateRange:O,setSprintDateRange:N})),W>0&&n()("div",{style:K.flexRow},void 0,n()(c.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.incompleteTasksLabel",defaultMessage:"{incompleteTaskCount, plural, one {{incompleteTaskCount} incomplete task} other {{incompleteTaskCount} incomplete tasks}}",values:{incompleteTaskCount:W}}),n()(Ye,{actionTypeStore:V})),n()(xe.Z,{disabled:!$,onClick:()=>{q()},style:K.button},void 0,n()(c.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.completeSprintButton",defaultMessage:"Complete {sprintName}",values:{sprintName:T}})),n()(Fe.Z,{onClick:()=>l({clickedCancel:!0}),style:K.button},void 0,v.formatMessage(Ee.cancelButton)))}function Ke(e){window.__c={n:"MissingCurrentSprintError"};const{onDismiss:t,sprintCollectionStore:o,titleAriaId:r}=e,i=(0,s.O7)(),l=(0,c.useIntl)(),{isMobile:p}=(0,s.Fy)(),d=(0,a.VK)((()=>o.getParentBlockStore()),[o]),u=Ue({isMobile:p});return n()("div",{style:u.modalContainer},void 0,n()("div",{style:u.header,id:r},void 0,n()(c.FormattedMessage,{id:"completeAutomationSprintModal.missingCurrentSprint.title",defaultMessage:"No current sprint found"})),n()(xe.Z,{onClick:()=>{d&&ge.navigateToBlock({environment:i,store:d,pageVisitSource:_.tY.LinkInPage})},style:{...u.button,marginTop:24}},void 0,n()(c.FormattedMessage,{id:"completeAutomationSprintModal.missingCurrentSprint.navigateToSprintsDatabase",defaultMessage:"Fix in Sprints database"})),n()(Fe.Z,{onClick:t,style:u.button},void 0,l.formatMessage(Ee.cancelButton)))}function Ge(e){window.__c={n:"LoadingStatePlaceholder"};const{onDismiss:t,titleAriaId:o}=e,r=(0,c.useIntl)(),{isMobile:i}=(0,s.Fy)(),a=Ue({isMobile:i});return n()("div",{style:a.modalContainer},void 0,n()("div",{style:a.header,id:o},void 0,n()(c.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.titlePlaceholder",defaultMessage:"Sprint summary"})),n()("div",{style:a.subheader},void 0,n()(Pe.Z,{style:a.subheaderShimmer})),n()("div",{style:a.flexRow},void 0,r.formatMessage(Ee.selectNextSprintLabel),n()(Pe.Z,{style:a.flexRowShimmerBox1})),n()("div",{style:a.flexRow},void 0,r.formatMessage(Ee.selectDatesForNextSprintLabel),n()(Pe.Z,{style:a.flexRowShimmerBox2})),n()("div",{style:a.flexRow},void 0,n()(c.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.incompleteTasksPlaceholder",defaultMessage:"Incomplete tasks"}),n()(Pe.Z,{style:a.flexRowShimmerBox3})),n()(xe.Z,{disabled:!0,onClick:()=>{},style:a.button},void 0,n()(c.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.completeSprintButtonPlaceholder",defaultMessage:"Complete sprint"})),n()(Fe.Z,{onClick:t,style:a.button},void 0,r.formatMessage(Ee.cancelButton)))}function Ue(e){let{isMobile:t}=e;return(0,l.yK)((e=>{const o={height:44,borderRadius:8,display:"flex",alignItems:"center",width:void 0},r={...o,marginTop:12,marginBottom:18};return{modalContainer:{width:400,display:"flex",fontSize:t?p.Z.fontSize.UIRegular.mobile:p.Z.fontSize.UIRegular.desktop,flexDirection:"column",justifyContent:"center",padding:20},header:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:t?18:16,fontWeight:p.Z.fontWeight.semibold},subheader:{display:"flex",alignItems:"center",justifyContent:"center",color:e.lightTextColor,marginBottom:16,gap:8},separator:{height:2,width:2,borderRadius:2,backgroundColor:e.lightIconColor},flexRow:{display:"flex",...t?{flexDirection:"column",fontSize:14,color:e.mediumTextColor}:{justifyContent:"space-between",alignItems:"center",height:24,marginBottom:16}},completedTaskGroup:{display:"flex",gap:4},button:{display:"flex",alignItems:"center",justifyContent:"center",marginTop:8,...t&&o},subheaderShimmer:{borderRadius:3,marginTop:6,width:200,height:16,...t&&{height:22}},flexRowShimmerBox1:{borderRadius:3,width:60,height:16,...t&&r},flexRowShimmerBox2:{borderRadius:3,width:80,height:16,...t&&r},flexRowShimmerBox3:{borderRadius:3,width:140,height:16,...t&&r},dropdownButton:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:4,...t&&{...r,border:`1px solid ${e.accentColors.gray[50]}`,justifyContent:"space-between"}},dropdownChevronIcon:{color:e.lightIconColor,width:12,height:"auto"}}}),[t])}function We(e){window.__c={n:"SprintSummarySubheader"};const{currentSprintFormattedDateRange:t,currentSprintTaskSummary:o}=e,{isMobile:r}=(0,s.Fy)(),a=(0,c.useIntl)(),l=Ue({isMobile:r}),p=o?a.formatMessage(Ee.completedPercentSummary,{completedTaskCount:o.completedTaskCount,totalTaskCount:o.totalTaskCount}):void 0,d=t&&o?i.createElement(i.Fragment,null,t,n()("div",{style:l.separator}),p):t||p;return void 0===d?null:n()("div",{style:l.subheader},void 0,d)}function ze(e){const{sprintBlockStore:t,sprintCollectionStore:o}=e;if(!t)return;const r=o.getPropertyMapping(),n=null==r?void 0:r[P.b0.Dates];if(!n)return;const i=t.getPropertyValue(n);if(!i)return;const s=(0,F.n)(i)[0];return s?(0,se.Ls)(s):void 0}function $e(e){const{sprintDateRange:t,intl:o}=e;if(t&&(0,se.h)(t))return(0,ae.ZV)({value:t,allowRelativeDates:!1,shortenDateAndRange:!0,displayInUserTimezone:!0,intl:o})}const He={complete_sprint_and_move_incomplete_tasks_to_next_sprint:n()(c.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.moveToNextSprintOption",defaultMessage:"Move to next sprint"}),complete_sprint_and_move_incomplete_tasks_to_backlog:n()(c.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.moveToBacklogOption",defaultMessage:"Move to backlog"}),complete_sprint:n()(c.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.keepInThisSprintOption",defaultMessage:"Keep in current sprint"})};function Ye(e){window.__c={n:"SelectIncompleteTaskAutomationPopupButton"};const{actionTypeStore:t}=e,{isMobile:o}=(0,s.Fy)(),r=(0,a.VK)((()=>t.state),[t]),l=Ue({isMobile:o});return n()(Me.ZP,{popupType:o?Me.Z4.SlideUp:Me.Z4.Popup,alignmentToOrigin:Me.vR.Start,placementToOrigin:Me.pO.Bottom,render:e=>n()(Qe,{actionTypeStore:t,buttonPopupParent:e}),renderOrigin:e=>i.createElement(Fe.Z,C()({},e,{style:l.dropdownButton}),He[r],le.Z.chevronDown(l.dropdownChevronIcon))})}const je=["complete_sprint_and_move_incomplete_tasks_to_next_sprint","complete_sprint_and_move_incomplete_tasks_to_backlog","complete_sprint"];function Qe(e){window.__c={n:"AutomationActionOptionsMenu"};const{actionTypeStore:t,buttonPopupParent:o}=e,{isMobile:r}=(0,s.Fy)(),c=(0,l.yK)((e=>({checkIcon:{color:e.lightIconColor,width:12,height:"auto",marginLeft:4}})),[]),p=(0,a.VK)((()=>je.map((e=>{const r=e===t.state;return{key:e,action:()=>{t.setState(e),o.close()},render:t=>i.createElement(_e.Z,C()({},t,{title:He[e],right:r&&le.Z.check(c.checkIcon)}))}}))),[t,c.checkIcon,o]);let d;return d=r?{menuType:Se.og.ActionSheet}:{menuType:Se.og.Popup,maxHeight:"50vh",minWidth:230},i.createElement(Ie.Z,d,n()(ke.Z,{type:ke.i.Vertical,initialFocus:0,sections:[{key:"sprint_automations",items:p,render:e=>i.createElement(Ae.Z,e)}]}))}function Xe(e){window.__c={n:"SelectSprintPopupButton"};const{nextSprintInput:t,completeSprintAutomationContext:o,setNextSprintInput:r,sprintPageIds:p}=e,{sprintCollectionStore:d}=o,{isMobile:u}=(0,s.Fy)(),m=(0,s.O7)(),h=(0,c.useIntl)(),g=(0,a.VK)((()=>{if(void 0===t)return n()(c.FormattedMessage,{id:"completeAutomationSprintModal.sprintSelect.empty",defaultMessage:"Select sprint"});if("actionId"===t.type)return n()(c.FormattedMessage,{id:"completeAutomationSprintModal.sprintSelect.newSprint",defaultMessage:"New sprint"});if("pointer"===t.type){const e=Ce.G.createChildStore(d,t.pointer);return(0,ye.vU)({intl:h,environment:m,store:e,untitledFallback:Ee.fallbackSprintName})}(0,Z.t1)(t)}),[t,h,d,m]),S=Ue({isMobile:u}),y=(0,l.yK)((e=>({button:{...void 0===t&&{color:e.lightTextColor}}})),[t]),f={...S.dropdownButton,...y.button};return 0===p.length||1===p.length?n()(Fe.Z,{style:f,disabled:!0},void 0,g):n()(Me.ZP,{popupType:u?Me.Z4.SlideUp:Me.Z4.Popup,alignmentToOrigin:Me.vR.Start,placementToOrigin:Me.pO.Bottom,render:e=>n()(Je,{buttonPopupParent:e,completeSprintAutomationContext:o,sprintPageIds:p,nextSprintInput:t,setNextSprintInput:r}),renderOrigin:e=>i.createElement(Fe.Z,C()({},e,{style:f}),g,le.Z.chevronDown(S.dropdownChevronIcon))})}function Je(e){window.__c={n:"SelectSprintDropdown"};const{sprintPageIds:t,completeSprintAutomationContext:o,buttonPopupParent:r,nextSprintInput:p,setNextSprintInput:d}=e,{sprintCollectionStore:u}=o,{isMobile:m}=(0,s.Fy)(),h=(0,a.VK)((()=>u.getSpaceId()),[u]),g=(0,a.VK)((()=>(0,fe.U1)({collectionStore:o.taskCollectionStore,property:P.Es.TaskToSprintRelation}).filter((e=>e.visible&&("title"===e.property||o.sprintCollectionSchema[e.property])))),[o]),S=(0,a.VK)((()=>new ve.Z),[]),y=(0,l.yK)((e=>({checkIcon:{color:e.lightIconColor,width:12,height:"auto",marginLeft:4},plusIcon:{color:e.lightIconColor,width:12,height:"auto"},createSprintRow:{display:"flex",gap:4},sprintRow:{display:"flex",maxHeight:22,alignItems:"center"},recordTitle:{...m&&{marginRight:12}}})),[m]),f="purple",v=(0,l.Fg)(),b=(0,ne.KR)(v,f),w=i.useMemo((()=>{const e="actionId"===(null==p?void 0:p.type);return{key:"new_sprint",action:()=>{d({type:"actionId"}),r.close()},render:t=>i.createElement(_e.Z,C()({},t,{icon:le.Z.plus(y.plusIcon),title:n()("div",{style:y.createSprintRow},void 0,n()(c.FormattedMessage,{id:"completeAutomationSprintModal.selectSprintDropdown.createNew",defaultMessage:"New sprint"}),n()(De.Z,{isRound:!0,showRemoveButton:!1,value:n()(c.FormattedMessage,{id:"completeAutomationSprintModal.selectSprintDropdown.createNewToken",defaultMessage:"Next"}),format:ie.l.Medium,isSingle:!0,color:b.textColor,backgroundColor:b.backgroundColor,showColoredDot:f})),right:e&&le.Z.check(y.checkIcon)}))}}),[p,r,d,y,b]),x=(0,a.VK)((()=>t.map((e=>{const t={id:e,table:I.iU,spaceId:h},o=Ce.G.createChildStore(u,t),s=o.getIcon(),a="pointer"===(null==p?void 0:p.type)&&pe.dr.isEqual(p.pointer,t);return{key:e,action:()=>{d({type:"pointer",pointer:t}),r.close()},render:e=>i.createElement(_e.Z,C()({},e,{icon:s&&n()(Ze.Z,{disabled:!0,icon:s,isEmptyPage:!1,size:20}),title:n()("div",{style:y.sprintRow},void 0,g.map((e=>"title"===e.property?n()(Re.Z,{store:o,style:y.recordTitle}):n()(be.Z,{store:o,property:e.property,disabled:!1,locked:!1,format:we.C.Relation,tableWrap:!1,blockPropertyValueOverlayStore:S,collectionStore:u},e.property))).filter(Z.$K)),right:a&&le.Z.check(y.checkIcon)}))}}))),[u,S,r,p,g,h,d,y,t]),_=[{key:"sprints",items:i.useMemo((()=>x.length>0?x:[w]),[x,w]),render:e=>i.createElement(Ae.Z,e)}];let M;return M=m?{menuType:Se.og.ActionSheet}:{menuType:Se.og.Popup,maxHeight:"50vh",minWidth:230},i.createElement(Ie.Z,M,n()(ke.Z,{type:ke.i.Vertical,initialFocus:0,sections:_}))}function et(e){window.__c={n:"SelectNextSprintDate"};const{sprintDateRange:t,setSprintDateRange:o}=e,r=(0,c.useIntl)(),{isMobile:p}=(0,s.Fy)(),d=i.useMemo((()=>$e({sprintDateRange:t,intl:r})),[t,r]),u=Ue({isMobile:p}),m=(0,l.yK)((e=>({button:{...!d&&{color:e.lightTextColor}}})),[d]),h=(0,a.VK)((()=>d||n()(c.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.nextSprintDate.placeholder",defaultMessage:"Select dates"})),[d]);return n()(Me.ZP,{popupType:p?Me.Z4.SlideUp:Me.Z4.Popup,alignmentToOrigin:Me.vR.Start,placementToOrigin:Me.pO.Bottom,render:e=>n()(tt,{sprintDateRange:t,setSprintDateRange:o,onDismiss:()=>{e.close()}}),renderOrigin:e=>i.createElement(Fe.Z,C()({},e,{style:{...u.dropdownButton,...m.button}}),h,le.Z.chevronDown(u.dropdownChevronIcon))})}function tt(e){window.__c={n:"SprintDateRangePicker"};const{sprintDateRange:t,setSprintDateRange:o,onDismiss:r}=e,{isMobile:a}=(0,s.Fy)(),l=i.useMemo((()=>({starting:null!=t&&t.start_date?{type:"date",start_date:t.start_date}:void 0,ending:null!=t&&t.end_date?{type:"date",start_date:t.end_date}:void 0})),[t]);let p;return p=a?{menuType:Se.og.Modal,right:n()(Te.DoneMenuText,{}),onClickRight:r}:{menuType:Se.og.Popup,maxHeight:"50vh",paddingTop:6},i.createElement(Ie.Z,p,n()(Ae.Z,{},void 0,n()(Ve.Z,{title:void 0,disableMenuWrap:!0,allowRelativeRangeFilter:!0,value:l,onUpdate:e=>{var t,r;if(e.error)return;const n={...l,...e.value},i=null===(t=n.starting)||void 0===t?void 0:t.start_date,s=null===(r=n.ending)||void 0===r?void 0:r.start_date;o({type:"daterange",start_date:i,end_date:s})},onDismiss:r})),n()(Ae.Z,{topBorder:!0},void 0,n()(_e.Z,{focused:!1,onClick:()=>{o(void 0)},title:n()(c.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.datePicker.clear",defaultMessage:"Clear"})})))}var ot=o(42875),rt=o(59054),nt=o(54642),it=o(29637);function st(e){if(!e)return;const t=e.getPropertyMapping(),o=null==t?void 0:t[P.Es.TaskToSprintRelation];if(!o)return;return it.Aq.filter.property=o,{...it.Aq.filter,property:o}}class at extends x.default{getInitialState(){return{isLoading:!0,currentSprintId:void 0,querySprintsResult:void 0,currentSprintTaskSummary:void 0}}updateCurrentSprint(e){const{querySprintsResult:t,currentSprintTaskSummary:o}=this.state;void 0!==e&&void 0!==t&&void 0!==o?this.setState({isLoading:!1,currentSprintId:e,querySprintsResult:t,currentSprintTaskSummary:o}):e?this.setState({...this.state,currentSprintId:e}):this.setState({...this.state,isLoading:!0,currentSprintId:e})}updateNextAndFutureSprints(e){const{currentSprintId:t,currentSprintTaskSummary:o}=this.state;void 0!==t&&void 0!==e&&void 0!==o?this.setState({isLoading:!1,currentSprintId:t,querySprintsResult:e,currentSprintTaskSummary:o}):e?this.setState({...this.state,querySprintsResult:e}):this.setState({...this.state,isLoading:!0,querySprintsResult:e})}updateCurrentSprintTaskSummary(e){const{currentSprintId:t,querySprintsResult:o}=this.state;void 0!==t&&void 0!==o&&void 0!==e?this.setState({isLoading:!1,currentSprintId:t,querySprintsResult:o,currentSprintTaskSummary:e}):e?this.setState({...this.state,currentSprintTaskSummary:e}):this.setState({...this.state,isLoading:!0,currentSprintTaskSummary:e})}}const lt=at;function ct(e){window.__c={n:"CompleteSprintAutomationButtonLoader"};const{taskCollectionContextStore:t,completeSprintAutomationContext:o,children:r,isModalOpen:n}=e,{sprintCollectionStore:l}=o,c=l.id,p=(0,s.O7)(),d=(0,a.VK)((()=>new lt),[]),u=(0,a.VK)((()=>d.state),[d]),m=(0,a.VK)((()=>{var e;const o=t.relativeVariableStore.state;return null==o||null===(e=o[c])||void 0===e?void 0:e.current}),[c,t]);i.useEffect((()=>{d.updateCurrentSprint(m)}),[m,d]);const[{value:h}]=(0,rt.r5)((async()=>await async function(e){var t;const{environment:o,completeSprintAutomationContext:r}=e,{sprintCollectionStore:n}=r,i=function(e){var t,o;const{sprintCollectionStore:r,sprintCollectionSchema:n}=e,i=r.getPropertyMapping(),s=null==i?void 0:i[P.b0.StatusV2];if(!s)return;const a=n[s];if(!a||"status"!==a.type)return;const l=null===(t=a.options)||void 0===t||null===(t=t.find((e=>e.id===P.YE)))||void 0===t?void 0:t.value,c=null===(o=a.options)||void 0===o||null===(o=o.find((e=>e.id===P.eH)))||void 0===o?void 0:o.value;if(!l||!c)return;const p=W.qB[P.p$].next.reducer.getCombinatorFilter(n);if(!p)return;const d={type:"results",filter:p,limit:5},u={type:"results",filter:{operator:"and",filters:[{property:s,filter:{operator:"status_is",value:{type:"is_option",value:c}}}]},limit:5};return{[P.YE]:d,[P.eH]:u}}(r),s=n.getPropertyMapping(),a=null==s?void 0:s[P.b0.Dates],l=null==s?void 0:s[P.b0.UniqueId];if(!i||!a||!l)return;const c={type:"reducer",userId:o.currentUser.id,userTimeZone:(0,ot.r)(),searchQuery:void 0,sort:[{property:a,direction:"ascending"},{property:l,direction:"ascending"}],reducers:i},p=null===(t=n.getParentBlockStore())||void 0===t?void 0:t.getCollectionViewStores()[0],d=n.getSpaceId();if(!p)return;const u=await nt.queryCollection(o,{source:{type:"collection",id:n.id,spaceId:d},collectionView:{id:p.id,spaceId:d},loader:c},void 0,{src:"complete_sprint_modal_sprint_picker"});if("success"!==u.type)return;const m=u.data.result.reducerResults[P.YE],h=u.data.result.reducerResults[P.eH];if("results"!==m.type||"results"!==h.type)return;const g=m.blockIds,S=h.blockIds;return{nextSprintIds:g,futureSprintIds:S}}({environment:p,completeSprintAutomationContext:o})),[m,p,o]);i.useEffect((()=>{d.updateNextAndFutureSprints(h)}),[h,d]);const[{value:g}]=(0,rt.r5)((async()=>await async function(e){var t;const{environment:o,completeSprintAutomationContext:r}=e,{taskCollectionStore:n}=r,i=function(e){var t;if(!e)return;const o=e.getPropertyMapping(),r=st(e);if(!r)return;const n=null==o?void 0:o[P.Es.Status];if(!n)return;const i=e.getSchema()[n];if(!i||"status"!==i.type)return;const s=null===(t=i.groups)||void 0===t||null===(t=t.find((e=>(null==e?void 0:e.id)===P.uS)))||void 0===t?void 0:t.name;return s?{type:"aggregation",filter:{operator:"and",filters:[r]},aggregation:{aggregator:{operator:"count_per_group",groupName:s},property:n}}:void 0}(n);if(!i)return;const s=st(n);if(!s)return;const a={type:"reducer",filter:{operator:"and",filters:[s]},userId:o.currentUser.id,userTimeZone:(0,ot.r)(),searchQuery:"",sort:[],reducers:{completed_tasks_in_current_sprint:i}},l=null===(t=n.getParentBlockStore())||void 0===t?void 0:t.getCollectionViewStores()[0],c=n.getSpaceId();if(!l)return;const p=await nt.queryCollection(o,{source:{type:"collection",id:n.id,spaceId:c},collectionView:{id:l.id,spaceId:c},loader:a},void 0,{src:"complete_sprint_modal_sprint_picker"});if("success"!==p.type)return;return function(e){if(!e)return;if("aggregation"!==e.type)return;if("text"!==e.aggregationResult.type)return;const t=e.aggregationResult.value,o=null==t?void 0:t.split("/");if(!o||2!==o.length)return;const r=Number(o[0]),n=Number(o[1]);return{completedTaskCount:r,incompleteTaskCount:n-r,totalTaskCount:n,completedTaskPercent:0===n?0:r/n}}(p.data.result.reducerResults.completed_tasks_in_current_sprint)}({environment:p,completeSprintAutomationContext:o})),[m,p,o,n]);return i.useEffect((()=>{d.updateCurrentSprintTaskSummary(g)}),[g,d]),i.createElement(i.Fragment,null,r({completeSprintAutomationState:u,onAutomationComplete:()=>{d.reset()}}))}var pt=o(56247);function dt(e){const{percentage:t}=e;return n()(pt.b,{numberValue:t,numberFormat:void 0,numberShowAs:{type:"ring",maxValue:1,color:"blue",showValue:!1},shouldRenderTooltip:!1,progressSize:15})}var ut=o(68785),mt=o(63296);function ht(e){window.__c={n:"CompleteSprintAutomationButton"};const{collectionContextStore:t,completeSprintAutomationContext:o}=e,r=(0,s.O7)(),l=(0,a.VK)((()=>y.default.checkGate("proj_management_sprints")),[]),[c,p]=i.useState(!1),[m,f]=i.useState(!1),v=i.useCallback((()=>{f(!1)}),[f]),C=(0,a.VK)((()=>S.default.state.currentUserSettingsStore),[]);if(!l)return null;const b=()=>{f(!0);"complete-sprint-button-tooltip"===(0,g.wF)(C,"sprints-onboarding")&&u.tutorialGoToNextStep(r,"sprints-onboarding"),d.$Xl(r,{...(0,h.Pn)(t),action:"open_modal"})};return n()(ct,{completeSprintAutomationContext:o,taskCollectionContextStore:t,isModalOpen:m},void 0,(e=>{let{completeSprintAutomationState:r,onAutomationComplete:s}=e;return i.createElement(i.Fragment,null,n()(Le,{completeSprintAutomationContext:o,isOpen:m,onDismiss:v,setIsLoading:p,taskCollectionContextStore:t,completeSprintAutomationState:r,onAutomationComplete:s}),n()(gt,{taskCollectionContextStore:t,onClick:b,isLoading:c,currentSprintTasksInView:r.currentSprintTaskSummary}))}))}function gt(e){window.__c={n:"SprintSummaryAndButton"};const{currentSprintTasksInView:t,taskCollectionContextStore:o,onClick:r,isLoading:d}=e,{isPhone:u}=(0,s.Fy)(),h=i.useRef(null),g=(0,a.VK)((()=>(0,m.Nq)(o)),[o]),y=function(e){const{isPhone:t}=e;return(0,l.yK)((e=>({icon:{fill:e.accentColors.blue[400]},button:{height:26,marginLeft:8,fontWeight:p.Z.fontWeight.medium,...t&&{flexGrow:1,borderRadius:8,height:44}},summary:{color:e.lightTextColor,fontSize:t?p.Z.fontSize.UIRegular.mobile:p.Z.fontSize.UIRegular.desktop,fontWeight:p.Z.fontWeight.regular,whiteSpace:"nowrap"}})),[t])}({isPhone:u}),v=(0,a.VK)((()=>o.collectionViewBlockStore()),[o]),C=(0,a.VK)((()=>S.default.state.currentSpaceStore),[]);if(!v)return i.createElement(i.Fragment,null);const b=v.getSpaceId()===(null==C?void 0:C.id);return i.createElement(i.Fragment,null,!g&&t&&!u&&n()("div",{style:y.summary},void 0,n()(c.FormattedMessage,{id:"completeAutomationSprintAutomation.inlineSummary.completedPercentSummary",defaultMessage:"{completedTaskCount} / {totalTaskCount} tasks",values:{completedTaskCount:t.completedTaskCount,totalTaskCount:t.totalTaskCount}})),i.createElement(mt.Z,{ref:h,onClick:r,iconStyle:y.icon,icon:St({isLoading:d,taskSummary:t}),style:y.button,disabled:d,disabledFeedback:d},n()(c.FormattedMessage,{defaultMessage:"Complete sprint",id:"completeSprintAutomationButton.label"})),b&&n()(f.Yy,{origin:h}))}function St(e){const{isLoading:t,taskSummary:o}=e;if(t)return e=>n()("div",{style:e},void 0,n()(ut.Z,{}));const r=o?o.completedTaskPercent:0;return e=>n()("div",{style:e},void 0,n()(dt,{percentage:r}))}},30905:(e,t,o)=>{o.d(t,{qQ:()=>f,Xh:()=>v,ZP:()=>C,Y7:()=>b});var r=o(23174),n=o.n(r),i=o(10434),s=o.n(i),a=o(67294),l=o(81954),c=o(24405),p=o(53397),d=o(32056),u=o(3791),m=o(5366),h=o(4636),g=o(14976),S=o(78291),y=o(91839);function f(e){let{collectionStore:t,propertySchema:o}=e;window.__c={n:"AiAutofillFillAllPagesTooltip"};const r=(0,l.VK)((()=>(0,g.Xh)(t.getName(),t)),[t]),i=(0,l.VK)((()=>{var e;const t=(null===(e=S.default.state.data)||void 0===e?void 0:e.addOns)??[];return(0,u.de)(t)}),[]);return n()("div",{},void 0,n()("div",{style:{color:"white",fontWeight:500,wordWrap:"break-word",whiteSpace:"pre-wrap"}},void 0,a.createElement(m.FormattedMessage,s()({},h.gL.fillAllPagesTooltip,{values:{hasNames:Boolean(r)&&Boolean(o.name),collectionName:r,propertyName:o.name}}))),!i&&n()("div",{style:{color:"#ACABA9",fontWeight:500}},void 0,a.createElement(m.FormattedMessage,h.gL.fillAllPagesAddOnMessage)))}function v(e){let{updateAiInferencesTaskStatus:t,iconStyle:o,progressIconStyle:r}=e;window.__c={n:"AiAutofillFillAllPagesButtonIcon"};const i=(0,c.Fg)();return t.isRunning?n()("div",{style:r},void 0,n()(y.Z,{})):p.Z.magicWand({width:14,color:i.accentColors.purple[400],...o})}function C(e){let{updateAiInferencesTaskStatus:t,style:o}=e;window.__c={n:"AiAutofillFillAllPagesButtonInner"};const r=(0,m.useIntl)();return n()("div",{style:o},void 0,t.isRunning?n()("div",{style:{display:"flex",alignItems:"center",width:"100%"}},void 0,void 0===t.numPagesFilled||void 0===t.numPagesRequested?n()(m.FormattedMessage,{defaultMessage:"Updating all pages",id:"aiAutofill.fillallPages.updatingAllPages"}):n()(m.FormattedMessage,{defaultMessage:"{numPagesRequested, plural, one {Updating {numPagesFilled} of {numPagesRequested} page} other {Updating {numPagesFilled} of {numPagesRequested} pages}}",id:"aiAutofill.fillallPages.updatingAllPagesWithProgress",values:{numPagesFilled:(0,d.uf)(t.numPagesFilled,"compact",r),numPagesRequested:(0,d.uf)(t.numPagesRequested,"compact",r)}})):n()(m.FormattedMessage,{defaultMessage:"Update all pages",id:"aiAutofill.fillAllPages.buttonTitle"}))}function b(e){let{updateAiInferencesTaskStatus:t}=e;window.__c={n:"AiAutofillFillAllPagesButtonCaption"};const{numPagesFilled:o,numPagesRequested:r}={numPagesFilled:void 0,numPagesRequested:void 0,...t},i=(0,c.yK)((e=>({inner:{background:e.accentColors.purple[400],height:"100%",transition:"width .5s"},outer:{background:e.accentColors.gray[100],height:3,borderRadius:2,minWidth:120,overflow:"hidden",marginTop:8}})),[]);return void 0===o||void 0===r?null:n()("div",{style:i.outer,role:"progressbar"},void 0,n()("div",{style:{...i.inner,width:100*Math.min(o/r,1)+"%"}}))}},82994:(e,t,o)=>{o.d(t,{Z:()=>a});var r=o(23174),n=o.n(r),i=o(67294),s=o(65742);o(57658);function a(e){const{startPoint:t,endPoint:o,style:r,showArrowHead:a,useRightAngles:p,cornerRadiusOverride:d,handleMouseMove:u,handleMouseLeave:m}=e;return i.createElement(i.Fragment,null,n()(c,{startPoint:t,startCurvePoint:p?void 0:{x:t.x+s.i2,y:t.y},endPoint:a?{x:o.x-1.5,y:o.y}:o,endCurvePoint:p?void 0:{x:o.x-s.i2,y:o.y},cornerRadiusOverride:d,style:r,handleMouseMove:u,handleMouseLeave:m},void 0,e.children),a&&n()(l,{endPoint:o,style:r}))}function l(e){const{endPoint:t,style:o}=e;return n()("polyline",{points:`${t.x-5},${t.y-6} ${t.x},${t.y} ${t.x-5},${t.y+6}`,style:o,fill:"transparent"})}function c(e){const{startPoint:t,startCurvePoint:o,endPoint:r,endCurvePoint:s,style:a,cornerRadiusOverride:l,handleMouseMove:c,handleMouseLeave:p}=e;let d="";d=o&&s?`M ${t.x} ${t.y} L ${o.x} ${o.y} L ${s.x} ${s.y} L ${r.x} ${r.y}`:`M ${t.x} ${t.y} L ${t.x} ${r.y} L ${r.x} ${r.y}`;const u=function(e,t){function o(e,t,o){const n=t.x-e.x,i=t.y-e.y,s=Math.sqrt(n*n+i*i);return r(e,t,Math.min(1,o/s))}function r(e,t,o){return{x:e.x+(t.x-e.x)*o,y:e.y+(t.y-e.y)*o}}function n(e,t){e.length>2&&(e[e.length-2]=t.x.toString(),e[e.length-1]=t.y.toString())}function i(e){return{x:parseFloat(e[e.length-2]),y:parseFloat(e[e.length-1])}}const s=e.split(/[,\s]/).reduce(((e,t)=>{const o=t.match("([a-zA-Z])(.+)");return o?(e.push(o[1]),e.push(o[2])):e.push(t),e}),[]).reduce((function(e,t){return!isNaN(parseFloat(t))&&e.length?e[e.length-1].push(t):e.push([t]),e}),[]);let a=[];if(s.length>1){const e=i(s[0]);let l=null;"Z"===s[s.length-1][0]&&s[0].length>2&&(l=["L",e.x.toString(),e.y.toString()],s[s.length-1]=l),a.push(s[0]);for(let c=1;c<s.length;c++){const e=a[a.length-1],p=s[c],d=p===l?s[1]:s[c+1];if(d&&e&&e.length>2&&"L"===p[0]&&d.length>2&&"L"===d[0]){const s=i(e),l=i(p),c=i(d),u=o(l,s,t),m=o(l,c,t);n(p,u),a.push(p);const h=r(u,l,.5),g=r(l,m,.5),S=["C",h.x.toString(),h.y.toString(),g.x.toString(),g.y.toString(),m.x.toString(),m.y.toString()];a.push(S)}else a.push(p)}if(l){const e=i(a[a.length-1]);a.push(["Z"]),n(a[0],e)}}else a=s;return a.reduce((function(e,t){return`${e}${t.join(" ")} `}),"")}(d,l||16);return i.createElement(i.Fragment,null,n()("path",{d:u,style:a,fill:"transparent"}),(c||p)&&n()("g",{onMouseMove:c,onMouseLeave:p},void 0,n()("path",{d:u,style:{strokeOpacity:0,strokeWidth:16,pointerEvents:"stroke",cursor:"default"},fill:"transparent"}),e.children))}},64203:(e,t,o)=>{o.d(t,{Yy:()=>C,FF:()=>f,bZ:()=>v});var r=o(23174),n=o.n(r),i=o(67294),s=o(5366),a=o(10434),l=o.n(a),c=o(480),p=o(81954),d=o(9163),u=o(27370),m=o(64856);const h=new Map;var g=o(79315),S=o(81415);function y(e){let{tutorialId:t,tutorialStepId:o,...r}=e;window.__c={n:"ManagedTutorialTooltip"};const n=(0,c.O7)(),s=function(e){const t=!h.get(e),o=(0,i.useRef)(t);return o.current&&h.set(e,!0),(0,i.useEffect)((()=>()=>{o.current&&h.set(e,!1)})),o.current}(`${t}.${o}`),{currentStep:a,isLoading:y}=(0,p.VK)((()=>{var e;return{isLoading:!(null!==(e=g.default.state.currentUserSettingsStore)&&void 0!==e&&e.getSettings()),currentStep:(0,m.wF)(g.default.state.currentUserSettingsStore,t)}}),[t]);if(y||a!==o||!s)return null;const f=d.eU[t],v=f.steps.findIndex((e=>e.id===o));return i.createElement(S.U,l()({onCloseClick:()=>{u.dismissTutorial(n,t)},onPrimaryButtonClick:()=>{u.tutorialGoToNextStep(n,t)},onBackButtonClick:()=>{u.tutorialGoToPrevStep(n,t)},numSteps:f.steps.length,currStepIndex:v},r))}function f(e){let{origin:t}=e;return n()(y,{origin:t,placementToOrigin:"bottom",style:{minWidth:240},tutorialId:"sprints-onboarding",tutorialStepId:"current-sprint-view-tooltip",header:n()(s.FormattedMessage,{id:"SprintsBoardOnboardingTooltip.SprintBoardView.header",defaultMessage:"Manage the current sprint"}),content:n()(s.FormattedMessage,{id:"SprintsBoardOnboardingTooltip.SprintBoardView.content",defaultMessage:"Add tasks and update task status as your team makes progress during the sprint."})})}function v(e){let{origin:t}=e;return n()(y,{origin:t,placementToOrigin:"bottom",tutorialId:"sprints-onboarding",tutorialStepId:"sprint-task-tooltip",header:n()(s.FormattedMessage,{id:"SprintsBoardOnboardingTooltip.SprintBoardItem.header",defaultMessage:"Change tasks status"}),content:n()(s.FormattedMessage,{id:"SprintsBoardOnboardingTooltip.SprintBoardItem.content",defaultMessage:'Drag this task to "In progress".'})})}function C(e){let{origin:t}=e;return n()(y,{origin:t,placementToOrigin:"bottom",style:{minWidth:240},tutorialId:"sprints-onboarding",tutorialStepId:"complete-sprint-button-tooltip",header:n()(s.FormattedMessage,{id:"SprintsBoardOnboardingTooltip.CompleteSprintButton.header",defaultMessage:"Complete this sprint"}),content:n()(s.FormattedMessage,{id:"SprintsBoardOnboardingTooltip.CompleteSprintButton.content",defaultMessage:"Click the button when you're done with this sprint."})})}},13162:(e,t,o)=>{o.d(t,{Z:()=>F});var r=o(23174),n=o.n(r),i=o(67294),s=o(12183),a=o(480),l=o(81954),c=o(24405),p=o(56373),d=o(8848),u=o(59054),m=o(53397),h=o(5366),g=o(6287),S=o(82990),y=o(54642),f=o(77162),v=o(16956),C=o(47307),b=o(12359),w=o(33929),x=o(42922),_=o(68894),M=o(68785),P=o(76798),I=o(32662),k=o(64369);const T=(0,h.defineMessages)({autoIncrementIdPrefixPlaceholder:{defaultMessage:"Prefix",id:"database.viewSettings.propertyTab.autoIncrementIdPrefixPlaceholder"},duplicatePrefixNameError:{defaultMessage:"{prefixName} isn't available for use.",id:"database.viewSettings.propertyTab.duplicatePrefixNameError"}});function F(e){window.__c={n:"CollectionSettingsAutoIncrementIdProperty"};const{uniqueIdProperty:t,prefixValue:o,collectionContextStore:r}=e,d=(0,a.O7)(),M=(0,l.VK)((()=>r.collectionStore()),[r]),[F,R]=(0,i.useState)(o??""),[A,V]=(0,i.useState)(!0),[B,O]=(0,i.useState)(),N=(0,i.useCallback)((()=>{V(!0),O(void 0)}),[V,O]),D=(0,i.useCallback)((e=>{V(!0),O(w.default.formatMessage(T.duplicatePrefixNameError,{prefixName:`"${e}"`}))}),[]),E=(0,i.useCallback)(((e,t,o)=>{const r=o.collectionStore();r&&(V(!1),y.setRecordKey(d,{spaceId:r.getSpaceId(),table:r.table,key:e,id:r.id}).then((r=>{V(!0),200!==r.status?D(e):f.$q({environment:d,collectionContextStore:o,property:t,from:"view_settings",action:"unique_id_change_collection_key"})})).catch((()=>D(e))))}),[d,D]),L=(0,i.useCallback)((async e=>{if(!M)return!1;const t=await y.isRecordKeyAvailable(d,{spaceId:M.getSpaceId(),table:M.table,key:e.trim()});return"success"===t.type&&t.data.isAvailable}),[M,d]),q=(0,s.v)((e=>{L(e).then((t=>{t||D(e),V(!0)})).catch((()=>D(e)))}),500),[K]=(0,u.r5)((async()=>{if(M)return y.suggestRecordKey(d,{spaceId:M.getSpaceId(),table:g.v,id:M.id,shouldSetSuccessfullySuggestedRecord:!1})}),[M,d]);(0,i.useEffect)((()=>{var e;if(!o&&"resolved"===K.status)return"success"===(null===(e=K.value)||void 0===e?void 0:e.type)&&K.value.data?(O(void 0),void R(K.value.data.key)):void 0}),[o,K]),(0,i.useEffect)((()=>()=>{q.cancel()}),[q]);const G=(0,i.useCallback)((e=>{const t=e.target.value.toUpperCase();R(t),N(),t&&t!==o&&((0,p.k5)(t)||O(w.default.formatMessage(p.sY.prefixInvalidError)),V(!1),q(t))}),[N,o,q]),U=(0,i.useCallback)((()=>{q.flush()}),[q]),W=(0,i.useCallback)((e=>{const n=null==M?void 0:M.getRecordKeyStore();e!==o&&!B&&n&&M&&null!=t&&t.propertySchema?E(e,null==t?void 0:t.propertyId,r):V(!0)}),[M,o,B,t,E,r]),z=(0,i.useCallback)((()=>{const e=r.collectionStore();e&&b.createAndCommit({userAction:"CollectionSettingsAutoIncrementIdPropertyCreateNewIdProperty",environment:d,perform:t=>{const o=v.G3({environment:d,collectionStore:e,collectionViewArgs:void 0,propertyType:"auto_increment_id",transaction:t});E(F,o,r)}})}),[r,d,F,E]),$=(0,i.useCallback)((e=>{if(!M)return;const t=[{label:n()(h.FormattedMessage,{id:"database.viewSettings.propertyTab.autoIncrementIdPrefixSubmit",defaultMessage:"Update ID Prefix"}),color:"red",onAccept:()=>W(e)}];C.showDialog({message:n()("span",{},void 0,n()(h.FormattedMessage,{id:"database.viewSettings.propertyTab.changePrefixConfirmationMessage",defaultMessage:"Updating the prefix will stop 3rd party automations that rely on this ID (e.g., GitHub PR status automation).",values:{databaseName:n()(P.Z,{style:{display:"inline",fontWeight:S.Z.fontWeight.medium},shouldWrap:!0,store:M})}})),showCancel:!0,keepFocus:!0,items:t})}),[M,W]),H=(0,i.useCallback)((e=>{o?$(e):W(e)}),[o,W,$]),Y=(0,i.useCallback)((()=>t?t&&!o?i.createElement(i.Fragment,null,m.Z.plus({width:14,height:14}),n()(I.Z,{size:4}),n()(h.FormattedMessage,{defaultMessage:"Add ID prefix",id:"database.viewSettings.propertyTab.autoIncrementIdCreatePrefix"})):n()(h.FormattedMessage,{defaultMessage:"Update ID Prefix",id:"database.viewSettings.propertyTab.autoIncrementIdPrefixSubmit"}):i.createElement(i.Fragment,null,m.Z.plus({width:14,height:14}),n()(I.Z,{size:4}),n()(h.FormattedMessage,{defaultMessage:"Add ID property",id:"database.viewSettings.propertyTab.autoIncrementIdCreateProperty"}))),[o,t]),j=(0,c.yK)((e=>({prefixInputOuterStyle:{color:void 0===o?e.lightTextColor:e.regularTextColor}})),[o]);return i.createElement(i.Fragment,null,n()(_.ZP,{left:n()(k.Z,{style:{marginLeft:4,marginRight:7}},void 0,n()(h.FormattedMessage,{defaultMessage:"Prefix",id:"database.viewSettings.propertyTab.autoIncrementIdPrefix"})),value:F,inputOuterStyle:j.prefixInputOuterStyle,onChange:G,onBlur:U,placeholder:T.autoIncrementIdPrefixPlaceholder.defaultMessage,onSubmit:()=>H(F.trim()),focusInitial:!1,selectAll:!1,disabled:!1}),B||!A?n()(Z,{prefixName:F,hasRequestCompleted:A,errorMessage:B}):i.createElement(i.Fragment,null,n()(k.Z,{isSmall:!0,isSecondaryColor:!0,style:{marginTop:16,marginLeft:16}},void 0,n()(h.FormattedMessage,{defaultMessage:"{prefixWithHyphen}1, {prefixWithHyphen}2, {prefixWithHyphen}3, ...",id:"database.viewSettings.propertyTab.autoIncrementIdPrefixPreview",values:{prefixWithHyphen:F?`${F}-`:""}}))),n()(x.Z,{isLarge:!0,style:{margin:"8px 16px",width:"90%"},onClick:()=>{t?H(F.trim()):z()},disabled:F===o||Boolean(B)||!A},void 0,Y()))}function Z(e){const{errorMessage:t,hasRequestCompleted:o}=e;return n()(k.Z,{isMultiline:!0,style:{paddingTop:12,marginLeft:16,marginRight:16,...o?{color:d.ZP.red}:{},...e.styles},isSecondaryColor:!o},void 0,o&&t?t:n()("div",{style:{paddingTop:3,paddingBottom:3}},void 0,n()(M.Z,{style:{width:14,height:14}})))}},27788:(e,t,o)=>{o.d(t,{Z:()=>ge});var r=o(23174),n=o.n(r),i=o(67294),s=o(480),a=o(81954),l=o(24405),c=o(23482),p=o(5366),d=o(5500),u=o(97880),m=o(47307),h=o(77719),g=o(29637),S=o(12205),y=o(30874),f=o(89728),v=o(72495),C=o(32662),b=o(13162),w=o(10434),x=o.n(w),_=(o(57658),o(99036)),M=o(39068),P=o(84619),I=o(74487);const k={pull_request_review_edited:!0,pull_request_review_submitted:!0,pull_request_review_requested:!0,pull_request_review_request_removed:!0,pull_request_closed:!0,pull_request_opened:!0,pull_request_reopened:!0,installation_deleted:!0,installation_suspend:!0,installation_unsuspend:!0,pull_request_converted_to_draft:!0,pull_request_edited:!0,pull_request_assigned:!0},T={pull_request_opened:!0,pull_request_review_requested:!0,pull_request_review_submitted:!0,pull_request_closed:!0};(0,u.AO)((e=>{const t=(0,u.Yd)(k);return(0,u.DE)(t,e)?{true:e}:{false:e}}));I.literals(...(0,u.Yd)({pull_request:!0,pull_request_review:!0,installation:!0})),I.literals(...(0,u.Yd)(k));var F=o(53397),Z=o(77162),R=o(16956),A=o(64434),V=o(12359),B=o(66890),O=o(33929),N=o(87279),D=o(29376),E=o(42917),L=o(42922),q=o(52275),K=o(31945),G=o(96525),U=o(61519),W=o(78140),z=o(32163),$=o(40721),H=o(22084);const Y=(0,p.defineMessages)({autoUpdate:{defaultMessage:"Auto-update",id:"collectionSettingsGithubAutomationConfig.statusPicker.autoUpdate"},when:{defaultMessage:"when PR is",id:"collectionSettingsGithubAutomationConfig.statusPicker.when"},addStatusDescription:{defaultMessage:"Add a status property to set up automations.",id:"collectionSettingsGithubAutomationConfig.addStatusDescription"},addStatusButton:{defaultMessage:"Add status property",id:"collectionSettingsGithubAutomationConfig.statusPicker.addStatusButton"},newStatusPropertyButton:{defaultMessage:"New status",id:"collectionSettingsGithubAutomationConfig.statusPicker.newStatusPropertyButton"},pull_request_opened:{defaultMessage:"Opened",id:"collectionSettingsGithubAutomationConfig.pullRequestOpened"},pull_request_review_requested:{defaultMessage:"Review requested",id:"collectionSettingsGithubAutomationConfig.pullRequestReviewRequested"},pull_request_review_submitted:{defaultMessage:"Approved",id:"collectionSettingsGithubAutomationConfig.pullRequestApproved"},pull_request_closed:{defaultMessage:"Merged",id:"collectionSettingsGithubAutomationConfig.pullRequestMerged"},noAutomations:{defaultMessage:"None",id:"collectionSettingsGithubAutomationConfig.noAutomation"},removeStatusOption:{defaultMessage:"Clear",id:"collectionSettingsGithubAutomationConfig.removeStatusOption"}}),j={pull_request_opened:O.default.formatMessage(Y.pull_request_opened),pull_request_review_requested:O.default.formatMessage(Y.pull_request_review_requested),pull_request_review_submitted:O.default.formatMessage(Y.pull_request_review_submitted),pull_request_closed:O.default.formatMessage(Y.pull_request_closed)},Q=O.default.formatMessage(Y.noAutomations),X={pull_request_opened:null,pull_request_review_requested:null,pull_request_review_submitted:null,pull_request_closed:null};function J(e){window.__c={n:"CollectionSettingsGithubAutomationConfig"};const{gitHubProperty:t,selectedStatusProperty:o,setSelectedStatusProperty:r,intl:l}=e,c=(0,s.O7)(),p=(0,B.Y$)(),d=(0,s.Fy)(),m=re(),h=(0,a.VK)((()=>{const e=(0,D.KV)(p,t);if(e&&(0,_.NK)(e))return e}),[p,t]),g=(0,a.VK)((()=>{const e=p.normalizedSchemaStore.state;return(0,u.qP)(e).flatMap((e=>{let[t,o]=e;return o&&(0,_.gB)(o)?[{id:t,schema:o}]:[]}))}),[p.normalizedSchemaStore]);(0,i.useEffect)((()=>{if(!o&&g.length>0){if(null!=h&&h.connectedRelation.automation)for(const t of g)if(h.connectedRelation.automation[t.id])return void r(t);const e=g[0];r(e)}}),[g,h,o,r]);const[S,y]=(0,i.useState)(X);(0,i.useEffect)((()=>{var e,t;o&&h&&(0,_.NK)(h)&&null!==(e=h.connectedRelation.automation)&&void 0!==e&&e[o.id]?y(null===(t=h.connectedRelation.automation)||void 0===t?void 0:t[o.id]):y(X)}),[h,o]);const f=(0,i.useCallback)((e=>{const r=p.collectionStore();if(!(r&&o&&h&&(0,_.p_)(h)))return;const n=h.connectedRelation;if(!n||!o.id)return;n.automation={...n.automation,...e};const i={...h,connectedRelation:{...n}};Z.$q({environment:c,collectionContextStore:p,property:o.id,from:"github_pull_requests_property",action:"configure_github_pr_automation",githubAutomationConfigured:e}),V.createAndCommit({userAction:"CollectionSettingsConfigureGithubAutomation",environment:c,perform:e=>{A.xO({environment:c,collectionStore:r,update:{[t]:i},transaction:e})}})}),[p,o,h,c,t]),b=(0,a.VK)((()=>o&&o.schema.options?o.schema.options:[]),[o]),w=(0,a.VK)((()=>{const e={};return b.forEach((t=>{e[t.id]=t})),e}),[b]),M=(0,a.VK)((()=>{var e,t;const r=null==o||null===(e=o.schema)||void 0===e?void 0:e.groups,n=null==o||null===(t=o.schema)||void 0===t?void 0:t.options;return r&&n?r.map((e=>{const t=n.filter((t=>{var o;return null===(o=e.optionIds)||void 0===o?void 0:o.includes(t.id)}));if(0!==t.length)return{group:e,groupOptions:t}})).filter(u.$K):[]}),[o]);function I(e,t){const r=M.map((t=>{let{group:r,groupOptions:s}=t;const a=s.map((t=>({key:t.id,render:e=>i.createElement(q.Z,x()({},e,{focused:e.focused,isTokenTitle:!0,title:n()(H.F,{format:P.l.Small,value:t.value,color:t.color,showRemoveButton:!1,groupColor:r.color,isSingle:!0})})),action:()=>{const r={...S,[e]:t.id};o&&(f({[o.id]:r}),y(r))}}))).filter(u.$K);return{key:r.name,render:e=>i.createElement(v.Z,x()({},e,{title:r.name,topBorder:e.index>0})),items:a}}));if(S[e]){function n(){const r={...S,[e]:null};o&&(f({[o.id]:r}),y(r)),t.close()}const s={key:"removeOptionSection",render:e=>i.createElement(v.Z,x()({},e,{topBorder:!0})),items:[{key:"removeOptionButton",render:e=>i.createElement(q.Z,x()({},e,{focused:!1,title:l.formatMessage(Y.removeStatusOption),left:F.Z.trash({width:12}),onClick:n})),action:e=>{n()}}]};r.push(s)}return r}return o?n()(v.Z,{topBorder:!1,disableDesktopPadding:!0,disableMobilePadding:!0,title:n()(te,{selectedStatusProperty:o,setSelectedStatusProperty:r,existingStatusProperties:g,intl:l})},void 0,(0,u.Yd)(T).map((e=>n()(G.Z,{focused:!1,placementToOrigin:K.pO.Top,alignmentToOrigin:K.vR.End,popupType:d.isMobile?K.Z4.SlideUp:K.Z4.Popup,render:t=>{const o=d.isMobile?{menuType:N.og.Modal,right:n()($.DoneMenuText,{}),onClickRight:t.close}:{menuType:N.og.Popup,width:150};return i.createElement(W.Z,o,n()(z.Z,{type:z.i.Vertical,sections:I(e,t),initialFocus:void 0,onAccept:t.close}))},renderOrigin:t=>{const r=S[e];let s=n()("div",{style:m.noneText},void 0,Q);if(r){const e=w[r];if(e){var a;const t=null==o||null===(a=o.schema)||void 0===a||null===(a=a.groups)||void 0===a||null===(a=a.find((e=>{var t;return null===(t=e.optionIds)||void 0===t?void 0:t.includes(r)})))||void 0===a?void 0:a.color;s=n()(H.F,{format:P.l.Small,showRemoveButton:!1,isSingle:!0,value:e.value,color:e.color,groupColor:t})}}return i.createElement(E.Z,x()({},t,{focused:!1,icon:()=>n()("div",{style:{display:"inline-flex",alignItems:"center",justifyContent:"flex-start",whiteSpace:"nowrap"}},void 0,j[e],n()(C.Z,{size:8}),F.Z.arrowRight(m.automationMenuItemArrow)),title:n()("div",{style:{width:"100%",display:"inline-flex",justifyContent:"flex-end"}},void 0,s),showChevron:!0,chevronStyle:{margin:0}}))}},e)))):n()(ee,{setSelectedStatusProperty:r,intl:l})}function ee(e){window.__c={n:"AddStatusProperty"};const{setSelectedStatusProperty:t,intl:o}=e,r=(0,s.O7)(),i=(0,B.Y$)(),a=re();return n()("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},void 0,n()(U.Z,{size:"100%",innerStyle:a.addStatusDivider}),n()("div",{style:a.addStatusDescription},void 0,o.formatMessage(Y.addStatusDescription)),n()(L.Z,{style:a.addStatusButton,onClick:e=>{e.stopPropagation(),oe(r,i,t)}},void 0,F.Z.plus({width:14}),n()(C.Z,{size:4}),o.formatMessage(Y.addStatusButton)),n()(C.Z,{size:4}))}function te(e){window.__c={n:"GithubStatusPropertyPicker"};const{selectedStatusProperty:t,setSelectedStatusProperty:o,existingStatusProperties:r,intl:a}=e,c=(0,s.O7)(),p=(0,B.Y$)(),d=(0,s.Fy)(),m=re(),h=(0,l.Fg)(),g=r.map((e=>{const{id:t,schema:r}=e;return{key:t,action:()=>{o(e)},render:t=>i.createElement(q.Z,x()({},t,{icon:n()(M.ZP,{size:14,theme:h,icon:e&&e.schema.icon,type:"status"}),title:r.name}))}})).filter(u.$K),S={key:"newStatusProperty",action:()=>{oe(c,p,o)},render:e=>i.createElement(q.Z,x()({},e,{icon:F.Z.plus(m.statusPickerIcon),title:a.formatMessage(Y.newStatusPropertyButton)}))};return n()("div",{style:m.statusPickerWrapper},void 0,n()("div",{style:{display:"inline-flex",alignItems:"center"}},void 0,a.formatMessage(Y.autoUpdate),d.isMobile&&n()(C.Z,{size:4}),n()(K.ZP,{placementToOrigin:K.pO.Bottom,alignmentToOrigin:K.vR.Start,popupType:d.isMobile?K.Z4.SlideUp:K.Z4.Popup,renderOrigin:e=>i.createElement(q.Z,x()({},e,{title:t.schema.name,focused:!1,style:m.statusPickerButtonCore,textWrapperStyle:m.statusPickerButtonTextWrapper,left:n()(M.ZP,{size:14,theme:h,icon:t.schema.icon,type:"status"}),leftStyle:{marginLeft:2},showExtensionArrow:!0,extensionArrowStyle:m.statusPickerExtensionArrow})),render:e=>{const t=d.isMobile?{menuType:N.og.ActionSheet}:{menuType:N.og.Popup,width:150};return i.createElement(W.Z,t,n()(z.Z,{type:z.i.Vertical,sections:[{key:0,render:e=>i.createElement(v.Z,e),items:[...g,S]}],initialFocus:0,onAccept:e.close}))}})),d.isMobile&&n()(C.Z,{size:4}),a.formatMessage(Y.when))}function oe(e,t,o){const r=t.collectionStore();r&&V.createAndCommit({userAction:"CollectionSettingsConfigureGithubAutomationCreateNewStatusProperty",environment:e,perform:n=>{const i=R.G3({environment:e,collectionStore:r,collectionViewArgs:void 0,propertyType:"status",transaction:n}),s=(0,D.KV)(t,i);s&&(0,_.gB)(s)&&o({id:i,schema:s})}})}function re(){const e=(0,s.Fy)().isMobile;return(0,l.yK)((t=>({addStatusDivider:{borderColor:t.tableDividerColor},addStatusDescription:{width:"calc(100% - 24px)",padding:e?"16px 8px":"14px 0px",fontSize:e?16:12,color:t.lightTextColor},addStatusButton:{width:"calc(100% - 24px)",display:"inline-flex",alignItems:"center",justifyContent:"center"},noneText:{color:t.lightTextColor},automationMenuItemArrow:{width:12,fill:t.lightIconColor,stroke:t.lightIconColor,strokeOpacity:.5,strokeWidth:2},statusPickerWrapper:{display:"inline-flex",alignItems:"center",flexWrap:"wrap",rowGap:2,marginBottom:e?10:void 0},statusPickerButtonTextWrapper:{margin:"0px 4px",fontSize:12},statusPickerButtonCore:{minHeight:e?28:20,borderRadius:5,maxWidth:e?150:100},statusPickerIcon:{width:14,height:14},statusPickerExtensionArrow:{transform:"rotate(180deg)",marginRight:2}})),[e])}var ne=o(49122);const ie=(0,p.defineMessages)({tabTitle:{defaultMessage:"GitHub Pull Requests",id:"database.viewSettings.githubConfigTab.tabTitle"},connect:{defaultMessage:"Connect to GitHub (Workspace)",id:"database.viewSettings.githubConfigTab.connect"},connectDescriptionAdmin:{defaultMessage:"Ask your workspace admin to configure the GitHub (Workspace) connection.",id:"database.viewSettings.githubConfigTab.connectDescriptionAdmin"},authError:{defaultMessage:"Auth failed. Please try again or contact Notion support.",id:"database.viewSettings.githubConfigTab.authError"},tabDescriptionNoIdPrefix:{defaultMessage:"This feature requires a prefixed ID property to link GitHub PRs to Notion {pluralItemName}.",id:"database.viewSettings.githubConfigTab.tabDescriptionNoIdPrefix"},tabDescriptionNoStatus:{defaultMessage:"Link PRs by adding the {singleItemName} ID to the PR title.",id:"database.viewSettings.githubConfigTab.tabDescriptionNoStatus"},tabDescription:{defaultMessage:"Link PRs by adding the {singleItemName} ID to the PR title. Set up automated status updates in Notion based on PR status changes.",id:"database.viewSettings.githubConfigTab.tabDescription"}});function se(e){let{collectionContextStore:t,intl:o}=e;window.__c={n:"UnauthedFallback"};const r=he(),{hoveredBackground:i,pressedBackground:l}=me(),c=(0,S.J)(),p=(0,s.O7)(),d=ue(),u=function(e){return(0,a.VK)((()=>{var t;return null===(t=e.collectionStore())||void 0===t?void 0:t.getSpaceId()}),[e])}(t);return n()(v.Z,{disableMobileBorders:!0,mobileStyle:r.previewContentContainer,style:r.previewContentContainer},void 0,n()("img",{src:"/images/external_integrations/github-icon.png",style:{width:36,height:36}}),n()("p",{style:r.connectDescription},void 0,c?(0,g.GT)().description:o.formatMessage(ie.connectDescriptionAdmin)),n()(f.Z,{style:r.connectButton,hoveredStyle:{background:i},pressedStyle:{background:l},disabled:!c,disabledFeedback:!c,onClick:async e=>{if(e.preventDefault(),u&&d)try{await h.hM({environment:p,spaceId:u,integration:d,from:"connected_relation_property_menu"})}catch(t){const e=o.formatMessage(ie.authError);m.showErrorMessage(e)}}},void 0,o.formatMessage(ie.connect)),n()(C.Z,{size:4}))}function ae(e){let{collectionContextStore:t}=e;window.__c={n:"UserEducationSection"};const o=he(),{isMobile:r}=(0,s.Fy)(),i=de(t);return n()(v.Z,{disableDesktopPadding:!0,disableMobilePadding:!0,disableMobileBorders:!0,mobileStyle:o.previewContentContainer,style:o.previewContentContainer},void 0,n()(C.Z,{size:r?16:8}),n()(ne.Z,{width:"calc(100% - 24px)",uniqueIdPrefix:null==i?void 0:i.prefix}))}function le(e){let{collectionContextStore:t,intl:o,selectedStatusProperty:r}=e;window.__c={n:"DescriptionSection"};const i=(0,a.VK)((()=>t.databaseType),[t]),s=de(t),l=he(),p=(0,c.hf)(i).defaultMessage,d=(0,c.u5)(i).defaultMessage;let u;return u=s&&s.prefix?r?o.formatMessage(ie.tabDescription,{singleItemName:p}):o.formatMessage(ie.tabDescriptionNoStatus,{singleItemName:p}):o.formatMessage(ie.tabDescriptionNoIdPrefix,{pluralItemName:d}),n()(v.Z,{disableMobileBorders:!0,disableMobilePadding:!0,mobileStyle:l.tabDescription,style:l.tabDescription},void 0,u)}function ce(e){let{collectionContextStore:t}=e;window.__c={n:"UniqueIdSection"};const o=de(t);return o&&o.prefix?null:n()(b.Z,{collectionContextStore:t,uniqueIdProperty:o&&{propertyId:o.id,propertySchema:o.schema},prefixValue:null==o?void 0:o.prefix})}function pe(e){let{collectionContextStore:t,selectedStatusProperty:o,setSelectedStatusProperty:r,property:i,intl:s}=e;window.__c={n:"AutomationConfigSection"};const a=de(t);return a&&a.prefix?n()(J,{selectedStatusProperty:o,setSelectedStatusProperty:r,gitHubProperty:i,intl:s}):null}function de(e){return(0,a.VK)((()=>{var t,o;const r=null===(t=e.collectionStore())||void 0===t||null===(t=t.getRecordKeyStore())||void 0===t?void 0:t.getRecordKey(),n=null===(o=e.collectionStore())||void 0===o?void 0:o.getSchema(),i=n&&(0,u.qP)(n).find((e=>{let[,t]=e;return t&&"auto_increment_id"===t.type}));if(i){const[e,t]=i;if(t&&"auto_increment_id"===t.type)return{id:e,schema:t,prefix:r}}}),[e])}function ue(){return(0,a.VK)((()=>y.Z.integrations.state.find((e=>e.id===d.U9))),[])}function me(){const e=ue(),t=(0,l.Fg)();return(0,a.VK)((()=>(0,d.dg)(e,t.mode)),[e,t.mode])}function he(){const{isMobile:e}=(0,s.Fy)(),{background:t}=me();return(0,l.yK)((o=>({previewContentContainer:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},connectButton:{fontSize:14,maxWidth:"calc(100% - 24px)",height:void 0,color:o.regularInvertedTextColor,background:t,whiteSpace:"normal",padding:8,textAlign:"center"},connectDescription:{maxWidth:"calc(100% - 24px)",color:o.lightTextColor,fontSize:14,textAlign:"center"},tabDescription:{padding:e?18:14,fontSize:e?16:12,color:o.lightTextColor}})),[e,t])}const ge=(0,p.injectIntl)((function(e){window.__c={n:"CollectionSettingsGithubConfig"};const{collectionContextStore:t,property:o,intl:r}=e,[s,l]=(0,i.useState)(void 0);return(0,a.VK)((()=>{const e=y.Z.bots.state.find((e=>e.integration_id===d.U9));return Boolean(e)}),[])?i.createElement(i.Fragment,null,n()(ae,{collectionContextStore:t}),n()(le,{collectionContextStore:t,intl:r,selectedStatusProperty:s}),n()(ce,{collectionContextStore:t}),n()(pe,{collectionContextStore:t,selectedStatusProperty:s,setSelectedStatusProperty:l,property:o,intl:r})):n()(se,{collectionContextStore:t,intl:r})}))},67695:(e,t,o)=>{o.d(t,{Z:()=>i});var r=o(35431);class n extends r.Z{findTableHeaderCell(e,t){return this.find((o=>o.props.collectionContextStore===e&&o.props.property===t))}}const i=new n}}]);