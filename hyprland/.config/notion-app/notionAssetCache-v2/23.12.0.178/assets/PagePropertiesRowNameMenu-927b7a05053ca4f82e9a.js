"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[7583],{79257:(e,t,i)=>{i.d(t,{bA:()=>p,xv:()=>d,M0:()=>m,W4:()=>h,Do:()=>u,D2:()=>y});var o=i(85680),n=i(98452),s=i(52258),r=i(50906),a=i(6404),l=i(96802),c=i(12359);function p(e){const{originRect:t}=e;s.Z.reset(),n.Z.reset(),a.xv(),o.Z.setState({isOpen:!0,rect:t})}function d(){o.Z.setState({isOpen:!1})}function m(e){const{format:t,store:i,property:o,visibility:n,transaction:s}=e,r=t.property_visibility;r&&s&&l.FH({stores:[i],update:{property_visibility:Object.values(r||{}).map((e=>({property:e.property,visibility:o===e.property?n:e.visibility})))},transaction:s})}function h(e){const{store:t,pageSection:i,visibility:o,environment:n,format:s}=e,a=s.page_section_visibility;a&&(r.Mzl(n,{section:i,visibility:o}),c.createAndCommit({userAction:"customizePageActions.updatePageSectionVisibility",environment:n,perform:e=>{l.FH({stores:[t],update:{page_section_visibility:{...a,[i]:o}},transaction:e})}}))}function u(e){const{store:t,transaction:i,pageSectionFormats:o}=e;l.FH({stores:[t],update:{collection_page_sections:o},transaction:i})}function y(e){const{store:t,properties:i,environment:o}=e;c.createAndCommit({userAction:"customizePageActions.updateCollectionPageProperties",environment:o,perform:e=>{l.FH({stores:[t],update:{collection_page_properties:i},transaction:e})}})}},43700:(e,t,i)=>{i.d(t,{Z:()=>v});var o=i(23174),n=i.n(o),s=i(10434),r=i.n(s),a=i(67294),l=i(83355),c=i(53397),p=i(5366),d=i(61766),m=i(31194),h=i(31945),u=i(89728),y=i(6318);const g=(0,p.defineMessages)({hideSimpleLabel:{id:"customizePageMenuVisibilitySelect.hideSimple.label",defaultMessage:"Hide"},hideLabel:{id:"customizePageMenuVisibilitySelect.hide.label",defaultMessage:"Always hide"},hidePageLabel:{id:"customizePageMenuVisibilitySelect.off.label",defaultMessage:"Off"},showLabel:{id:"customizePageMenuVisibilitySelect.show.label",defaultMessage:"Always show"},showPageLabel:{id:"customizePageMenuVisibilitySelect.expanded.label",defaultMessage:"Expanded"},hideIfEmptyLabel:{id:"customizePageMenuVisibilitySelect.hideIfEmpty.label",defaultMessage:"Hide when empty"},collapsedLabel:{id:"customizePageMenuVisibilitySelect.collapsed.label",defaultMessage:"Show in popover"},defaultLabel:{id:"customizePageMenuVisibilitySelect.default.label",defaultMessage:"Default"},minimalLabel:{id:"customizePageMenuVisibilitySelect.minimal.label",defaultMessage:"Minimal"},sectionLabel:{id:"customizePageMenuVisibilitySelect.section.label",defaultMessage:"As page section"},propertyLabel:{id:"customizePageMenuVisibilitySelect.property.label",defaultMessage:"As property"}});class b extends l.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:d.Z}}renderComponent(){const{device:e}=this.environment;return n()(h.ZP,{popupType:e.isMobile?h.Z4.SlideUp:h.Z4.Popup,buttonPopupStore:this.stores.buttonPopupStore,renderOrigin:e=>a.createElement(u.Z,r()({style:{color:this.theme.mediumTextColor,paddingRight:0,height:this.environment.device.isMobile?32:22},disabled:this.props.locked},e),b.getVisibilityLabel(this.props.visibility,this.props.showAsMenu),c.Z.chevronDown({width:10,marginLeft:4,marginRight:4,fill:this.theme.lightIconColor})),placementToOrigin:m.Iw.Bottom,onClose:this.props.onClose,render:e=>a.createElement(y.Z,r()({},this.props,{onClose:e.close}))})}static getVisibilityLabel(e,t){switch(e){case"hide":return a.createElement(p.FormattedMessage,g.hideLabel);case"show":return a.createElement(p.FormattedMessage,g.showLabel);case"hide_if_empty":return a.createElement(p.FormattedMessage,g.hideIfEmptyLabel);case"section_hide":return t?a.createElement(p.FormattedMessage,g.propertyLabel):a.createElement(p.FormattedMessage,g.hidePageLabel);case"section_show":return a.createElement(p.FormattedMessage,g.showPageLabel);case"section_collapsed":return a.createElement(p.FormattedMessage,g.collapsedLabel);case"inline":return t?a.createElement(p.FormattedMessage,g.sectionLabel):a.createElement(p.FormattedMessage,g.defaultLabel);case"minimal":return a.createElement(p.FormattedMessage,g.minimalLabel)}}}b.displayName="CustomizePageMenuVisibilitySelect";const v=b},6318:(e,t,i)=>{i.d(t,{Z:()=>S});var o=i(10434),n=i.n(o),s=i(23174),r=i.n(s),a=i(67294),l=i(83355),c=i(6695),p=i(53397),d=i(5366),m=i(11599),h=i(87279),u=i(52275),y=i(78140),g=i(32163),b=i(72495),v=i(43700);class f extends l.Z{constructor(){super(...arguments),this.renderMenuItem=e=>{const{device:t}=this.environment;return{key:e,render:i=>a.createElement(u.Z,n()({},i,{textWrapperStyle:{marginRight:0},title:r()("div",{style:{display:"flex",alignItems:"center",width:150}},void 0,r()("div",{},void 0,v.Z.getVisibilityLabel(e,this.props.showAsMenu))),right:this.props.visibility===e?r()("div",{style:{width:t.isMobile?16:14}},void 0,p.Z.check()):void 0})),action:()=>{if("page"===this.props.type){const t=e;this.props.onSelect(t)}if("relation_property"===this.props.type){const t=e;this.props.onSelect(t)}else if("property"===this.props.type){const t=e;this.props.onSelect(t)}this.props.onClose&&this.props.onClose()}}}}renderComponent(){const{device:e}=this.environment,t=[{key:"visibilityLevels",render:e=>a.createElement(b.Z,n()({},e,{topBorder:0!==e.index})),items:"page"===this.props.type||"relation_property"===this.props.type?this.getPageOrPropertyVisibilityLevels().map((e=>this.renderMenuItem(e))):this.getPropertyVisibilityLevels().filter((e=>"property"!==this.props.type||"hide_if_empty"!==e||m.kq({propertySchema:this.props.propertySchema}))).map((e=>this.renderMenuItem(e)))}];let i;return i=e.isMobile?{menuType:h.og.Modal,title:r()(d.FormattedMessage,{id:"customizePageMenuVisibilitySelect.mobile.title",defaultMessage:"Select visibility"}),right:r()(d.FormattedMessage,{id:"customizePageMenuVisibilitySelect.mobile.doneButton.label",defaultMessage:"Done"}),onClickRight:()=>this.props.onClose&&this.props.onClose()}:{menuType:h.og.Popup,width:"auto",maxWidth:360},a.createElement(y.Z,i,r()(g.Z,{type:g.i.Vertical,initialFocus:void 0,sections:t}))}getPageOrPropertyVisibilityLevels(){return"page"!==this.props.type&&"relation_property"!==this.props.type?[]:this.props.visibilityLevels?this.props.visibilityLevels:c.Sn}getPropertyVisibilityLevels(){return c.AX}}f.displayName="CustomizePageMenuVisibilitySelectMenuItem";const S=f},36510:(e,t,i)=>{i.r(t),i.d(t,{default:()=>R});var o=i(10434),n=i.n(o),s=i(23174),r=i.n(s),a=(i(57658),i(96486)),l=i(67294),c=i(73935),p=i(83355),d=i(99036),m=i(80951),h=i(8848),u=i(53397),y=i(5366),g=i(50906),b=i(77162),v=i(16956),f=i(5149),S=i(64434),M=i(79257),P=i(12359),C=i(66890),w=i(93959),Z=i(52821),_=i(78316),x=i(87279),A=i(98742),E=i(29376),L=i(85526),F=i(93405),V=i(52275),k=i(78140),z=i(32163),D=i(72495),I=i(58032),H=i(6318),T=i(95030);class O extends p.Z{constructor(){super(...arguments),this.renderHideExtension=()=>{const{property:e,schema:t,format:i}=this.props,o=i.property_visibility;if(!o)return;const n=t[e];if(!n)return;const s=o.find((t=>t.property===e));return r()(H.Z,{type:"property",propertySchema:n,visibility:(null==s?void 0:s.visibility)||"show",locked:!1,onSelect:e=>this.handleVisibilitySelectClick(e),onClose:()=>{this.handleClose()}})},this.renderShowAsExtension=(e,t)=>{const{property:i,schema:o,format:n}=this.props,s=n.collection_page_sections||[],a=o[i];if(!a)return;const l=s.findIndex((e=>e.section===i)),c=s[l];return r()(H.Z,{type:"page",propertyType:a.type,visibility:(null==c?void 0:c.visibility)||"section_hide",visibilityLevels:["section_hide","inline","minimal"],locked:!1,onSelect:e=>{this.handleShowAsClick(e),this.handleClose()},onClose:()=>{t.close()},showAsMenu:!0})},this.getPropertyVisibility=()=>{const{property:e,schema:t,format:i}=this.props,o=i.property_visibility;if(!o)return;if(!t[e])return;const n=o.find((t=>t.property===e));return"section"!==(null==n?void 0:n.visibility)?null==n?void 0:n.visibility:void 0},this.handleShowAsClick=e=>{const{property:t,schema:i,collectionStore:o,format:n}=this.props;let s=n.collection_page_sections?a.cloneDeep(n.collection_page_sections):[];if(!i[t])return;const r=s.findIndex((e=>e.section===t));-1!==r?s[r]={section:t,visibility:e}:s=[...s,{section:t,visibility:e}];const l="inline"===e||"minimal"===e?"section":"show";s&&(P.createAndCommit({userAction:"PagePropertiesRowName.handleShowAsClick",environment:this.environment,perform:e=>{M.Do({environment:this.environment,pageSectionFormats:s,store:o,transaction:e}),M.M0({property:t,visibility:l,store:o,format:n,transaction:e})}}),g.K1b(this.environment,{from:"relation_section",mode:"inline"===e?"page_section":"minimal"===e?"minimal_page_section":"property"}))},this.handleDuplicate=async()=>{const{property:e,collectionStore:t,format:i,schema:o}=this.props,n=i.collection_page_properties||[],s=null==t?void 0:t.getSpaceId();if(!t||!s)return;const r=await _.xy({environment:this.environment,schema:o,properties:n,property:e,parentStore:t,spaceId:s});r&&P.createAndCommit({userAction:"PagePropertiesRowName.handleDuplicate",environment:this.environment,perform:e=>{const n={...i,collection_page_properties:r.newProperties};S.Rm({environment:this.environment,collectionStore:t,update:{schema:{...o,[r.newProperty]:r.newPropertySchema},format:n},transaction:e}),r.automationUpdate&&S.Ki({environment:this.environment,collectionStore:t,update:r.automationUpdate,transaction:e})}})},this.handleDelete=async()=>{const{property:e}=this.props,{collectionContextStore:t}=this.context;t&&await v.TI({environment:this.environment,collectionContextStore:t,property:e,handleDeleteAccept:this.handleDeleteAccept,theme:this.theme,from:"table_column"})},this.handleDeleteAccept=()=>{const{property:e,schema:t,collectionStore:i}=this.props,{collectionContextStore:o}=this.context;if(!o)return;P.createAndCommitAsync({environment:this.environment,userAction:"PagePropertiesRowName.handleDeleteAccept",waitForServerCommit:!1,perform:o=>v.yV({environment:this.environment,collectionStore:i,schema:t,property:e,transaction:o})});const n=i.getSchema()[e];n&&b.y9({environment:this.environment,collectionContextStore:o,property_type:n.type,from:"table_column",property:e})},this.handleClose=()=>{var e;L.Z.setState({...L.Z.state,openProperty:void 0});const t=null===(e=this.context.collectionContextStore)||void 0===e?void 0:e.settingsStore;t&&f.E3({collectionSettingsStore:t})}}willMountOrUpdate(e){const{property:t,schema:i}=e,{collectionContextStore:o}=this.context,n=i[t];if(o&&"relation"===(null==n?void 0:n.type)){const e=E.ny(o,n);null==e||e.load()}}renderComponent(){let e;const{device:t}=this.environment;e=t.isMobile?{menuType:x.og.ActionSheet}:{menuType:x.og.Popup,width:220};const i=this.getMenuSections();return l.createElement(k.Z,e,r()(z.Z,{type:z.i.Vertical,initialFocus:void 0,sections:a.compact(null==i?void 0:i.map(((e,t)=>{if(e.length>0)return{key:t,render:e=>l.createElement(D.Z,n()({},e,{topBorder:0!==t})),items:e}})))}))}getMenuSections(){const{property:e,schema:t}=this.props,{environment:i}=this,{device:o}=i,s=t[e],{collectionContextStore:a}=this.context;if(!a)return;const p=a.permissionScopes.state,g=a.settingsStore,b=a.collectionStore();if(!s||!b)return[];const v=[];if(p.canConfigureCollection&&!(0,m.wl)(e)){if("relation"===s.type){const e=[{key:"Show As Property Or Section",action:()=>{},render:(e,t)=>l.createElement(T.Z,n()({},e,{renderOrigin:e=>l.createElement(F.Z,n()({},e,{title:r()(y.FormattedMessage,{defaultMessage:"Show as",id:"database.configureProperty.showAsAction"}),svg:u.Z.collectionShow})),onFocus:t.onFocus,renderExtension:this.renderShowAsExtension}))}];v.push(e)}const t=[];v.push(t),t.push({key:"rename",render:e=>l.createElement(V.Z,n()({},e,{title:r()(y.FormattedMessage,{defaultMessage:"Rename",id:"database.tableHeaderCell.rename"}),icon:u.Z.rename({width:14})})),action:()=>{f.r$({collectionContextStore:a,collectionSettingsStore:g}),f.H4({collectionSettingsStore:g,item:{type:"property",formatKey:"collection_page_properties",property:e,selectNameInitial:!o.isMobile}})}}),t.push({key:"edit_property",render:e=>r()(I.Z,{placement:I.Z.Placement.Left,render:t=>l.createElement(V.Z,n()({title:r()(y.FormattedMessage,{defaultMessage:"Edit property",id:"database.tableHeaderCell.editProperty"}),icon:u.Z.options({width:14})},(0,A.Z)(e,t))),style:{whiteSpace:"normal"},renderTooltip:()=>r()(y.FormattedMessage,{defaultMessage:"Edit property name, type, and other options...",id:"database.tableHeaderCell.editPropertyTooltip"})}),action:()=>{f.r$({collectionContextStore:a,collectionSettingsStore:g}),f.H4({collectionSettingsStore:g,item:{type:"property",formatKey:"collection_page_properties",property:e}})}})}const S=[];if(v.push(S),"title"!==s.type&&p.canConfigureBlock&&S.push({key:"Hide Property",action:()=>{},render:(e,t)=>l.createElement(T.Z,n()({},e,{renderOrigin:e=>l.createElement(F.Z,n()({},e,{title:r()(y.FormattedMessage,{defaultMessage:"Hide property",id:"database.configureProperty.hideAction"}),svg:u.Z.collectionHide})),onFocus:t.onFocus,renderExtension:this.renderHideExtension}))}),Z.Tr.includes(s.type)&&p.canConfigureCollection&&!(0,m.wl)(e)){(0,d.dx)(s)||S.push({key:"Duplicate Property",render:(e,t)=>l.createElement(F.Z,n()({},e,{title:r()(y.FormattedMessage,{defaultMessage:"Duplicate property",id:"database.configureProperty.duplicateAction"}),svg:u.Z.duplicate})),action:async()=>{this.handleClose(),await this.handleDuplicate()}});const t=b.getDatabaseType();Boolean(t&&w.cR(t,e,b))||S.push({key:"delete",render:e=>l.createElement(V.Z,n()({},e,{title:r()(y.FormattedMessage,{defaultMessage:"Delete property",id:"database.tableHeaderCell.deleteProperty"}),icon:u.Z.trash({width:14}),hoveredStyle:{color:h.ZP.red,fill:h.ZP.red}})),action:async()=>{this.handleClose(),await this.handleDelete()}})}const P=[{key:"customizePage",action:()=>{this.handleClose();const e=c.findDOMNode(this.props.popupContainer);if(e&&e instanceof Element){const t=e.getBoundingClientRect();M.bA({originRect:t})}},render:(e,t)=>l.createElement(F.Z,n()({},e,{title:r()(y.FormattedMessage,{defaultMessage:"Customize page",id:"pageProperties.editProperty.customizePage.label"}),svg:u.Z.customizePage}))}];return v.push(P),v}handleVisibilitySelectClick(e){const{property:t,format:i,collectionStore:o}=this.props;P.createAndCommit({userAction:"CustomizePageMenu.handleShowAsClick",environment:this.environment,perform:n=>{M.M0({property:t,visibility:e,format:i,store:o,transaction:n})}})}}O.displayName="PagePropertiesRowNameMenu",O.contextTypes={...p.w,...C.xm};const R=(0,y.injectIntl)(O)},85680:(e,t,i)=>{i.d(t,{Z:()=>s});var o=i(49085);class n extends o.default{getInitialState(){return{isOpen:!1}}}const s=new n}}]);