"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[5991],{65991:(e,t,r)=>{r.d(t,{Z:()=>oe});var i=r(10434),o=r.n(i),d=r(23174),a=r.n(d),n=(r(57658),r(96486)),s=r.n(n),l=r(67294),c=r(83355),p=r(13991),h=r(49085),u=r(40902),m=r(66897),v=r(17215),g=r(41432),b=r(15070),f=r(99036),y=r(80951),k=r(8848),C=r(63144),_=r(83212),S=r(14215),B=r(6695),T=r(38297),E=r(42875),P=r(53397),w=r(55384),M=r(26825),x=r(27006),D=r(98459),I=r(21202),V=r(77420),R=r(70279),F=r(90468),Z=r(29369),L=r(19889),U=r(70203),H=r(97880),G=r(82990),O=r(7928),N=r(5366),q=r(42130),z=r(33929),W=r(17652),A=r(77505),j=r(77907),K=r(30874),$=r(68216),J=r(2456),Q=r(31278);class X extends c.Z{constructor(){super(...arguments),this.renderEdit=()=>{const{edit:e,formatProperty:t}=this.props;if("page_icon"===t){const r=e.block_data.before.block_value.format&&e.block_data.before.block_value.format[t],i=e.block_data.after.block_value.format&&e.block_data.after.block_value.format[t];return this.renderPageIconUpdatedEdit(r,i)}"is_placeholder"!==t&&(0,H.t1)(t)},this.renderPageIconUpdatedEdit=(e,t)=>{const{edit:r}=this.props;if(e||t)return l.createElement(l.Fragment,null,a()("div",{style:{display:"flex",alignItems:"center",color:this.theme.lightTextColor,fontSize:12,lineHeight:1,marginBottom:8}},void 0,P.Z.random({width:12,height:12,marginRight:6}),a()(N.FormattedMessage,{id:"editFormatDiff.pageIcon.label",defaultMessage:"Page Icon"})),a()("div",{style:{display:"flex",alignItems:"center"}},void 0,a()(Q.Z,{disabled:!0,isEmptyPage:!1,size:20,icon:e?{pointer:{table:I.iU,id:r.block_data.before.block_value.id},icon:e}:void 0}),a()("div",{style:{padding:"0px 8px"}},void 0,P.Z.historyForward({width:14,height:14,fill:this.theme.mediumIconColor})),a()(Q.Z,{disabled:!0,isEmptyPage:!1,size:20,icon:t?{pointer:{table:I.iU,id:r.block_data.after.block_value.id},icon:t}:void 0})))}}renderComponent(){return this.renderEdit()||null}}X.displayName="EditFormatDiff";const Y=X;var ee=r(63867),te=r(75561),re=r(47240);class ie extends c.Z{constructor(){super(...arguments),this.storeTypes={isEditHovered:h.default.createClass(!1)},this.renderProperty=(e,t,r)=>a()(J.KX,{value:e,propertySchema:t,labeled:r,rootStore:this.props.rootStore}),this.renderBlockProperty=(e,t,r,i)=>a()(J.Tl,{blockValue:e,prop:t,labeled:r,schema:i,intl:this.props.intl,rootStore:this.props.rootStore}),this.renderBlockEditProperty=(e,t,r)=>{const i=this.getBlockSchema(e)[t],o="block-changed"===e.type?e.block_data.after.block_value:e.block_data.block_value,d=(0,J.SX)(o,t);if(i)return this.renderProperty({value:d,spaceId:(0,D.CG)(o.space_id)},i,r)},this.renderBlockEditPropertyDiff=(e,t,r)=>{const i=this.getBlockSchema(e),o=i[t];if(!o)return;const d=(0,J.SX)(e.block_data.before.block_value,t),n=y.wV({property:t,schema:i,block:w.kk.fromBlock(e.block_data.before.block_value),getRecordModel:this.getRecordModel,userId:this.environment.currentUser.id,userTimeZone:(0,E.r)(),intl:this.props.intl}),s=(0,J.SX)(e.block_data.after.block_value,t),l=o.type;return n&&"text"!==l&&"title"!==l?this.renderProperty({value:s,spaceId:(0,D.CG)(e.block_data.after.block_value.space_id)},o,r):a()(J.Hq,{labeled:r,name:o.name,type:o.type,icon:o.icon},void 0,a()(re.Z,{propertySchema:o,beforeValue:{value:d,spaceId:(0,D.CG)(e.block_data.before.block_value.space_id)},afterValue:{value:s,spaceId:(0,D.CG)(e.block_data.after.block_value.space_id)},rootStore:this.props.rootStore}))},this.renderBlockPropertyEditDiff=e=>{const{labeled:t,propertySchema:r,beforeValue:i,afterValue:o,spaceId:d}=e,n=(0,D.CG)(d);return a()(J.Hq,{labeled:t,name:r.name,type:r.type,icon:r.icon},void 0,a()(re.Z,{propertySchema:r,beforeValue:{value:i,spaceId:n},afterValue:{value:o,spaceId:n},rootStore:this.props.rootStore}))},this.getRecordValue=this.props.rootStore.getRecordValue,this.getRecordModel=this.props.rootStore.getRecordModel}renderComponent(){return this.renderEdit()||null}renderEdit(){if("comment-edit"===this.props.type){const{edit:e,discussionLocation:t,hideAuthorName:r}=this.props;switch(e.type){case"comment-created":return this.renderCommentCreatedEdit({edit:e,discussionLocation:t,hideAuthorName:r});case"comment-changed":return this.renderCommentChangedEdit(e);case"comment-deleted":return this.renderCommentDeletedEdit(e,t);default:(0,H.t1)(e)}}const{edit:e}=this.props;switch(e.type){case"block-created":return this.renderBlockCreatedEdit(e.block_data.block_value);case"block-deleted":return this.renderBlockDeletedEdit(e.block_data.block_value);case"block-changed":return this.renderBlockChangedEdit(e);case"block-property-changed":return this.renderBlockPropertyChangedEdit(e);case"collection-property-changed":return this.renderCollectionPropertyChangedEdit(e);case"collection-changed":return this.renderCollectionChangedEdit(e);case"collection-created":return this.renderCollectionCreatedEdit(e);case"mention-created":return this.renderMentionCreated(e);case"permission-created":return this.renderPermissionCreated(e);case"permission-changed":return this.renderPermissionChanged(e);case"permission-deleted":return this.renderPermissionDeleted(e);case"permission-restriction-created":case"permission-restriction-deleted":return this.renderPermissionInheritanceChanged(e);case"permission-group-created":return this.renderPermissionGroupCreated(e);case"permission-group-changed":return this.renderPermissionGroupChanged(e);case"permission-group-deleted":return this.renderPermissionGroupDeleted(e);case"reminder-created":return this.renderReminderCreated(e);case"permission-group-mention-created":return this.renderPermissionGroupMentionCreated(e);case"permission-group-mention-deleted":case"mention-deleted":return null;default:(0,H.t1)(e)}}renderBlockChanged(e){switch(e.block_data.after.block_value.type){case g.Ti.text:return this.renderTextBlockChanged(e);case g.Ti.header:return this.renderHeaderBlockChanged(e);case g.Ti.subHeader:return this.renderSubHeaderBlockChanged(e);case g.Ti.subSubHeader:return this.renderSubSubHeaderBlockChanged(e);case g.Ti.toggle:return this.renderToggleBlockChanged(e);case g.Ti.bulletedList:return this.renderBulletedListBlockChanged(e);case g.Ti.numberedList:return this.renderNumberedListBlockChanged(e);case g.Ti.quote:return this.renderQuoteBlockChanged(e);case g.Ti.factory:return this.renderFactoryBlockChanged(e);case g.Ti.equation:return this.renderEquationBlockChanged(e);case g.Ti.toDo:return this.renderTodoBlockChanged(e);case g.Ti.code:return this.renderCodeBlockChanged(e);case g.Ti.bookmark:return this.renderBookmarkBlockChanged(e);case g.Ti.page:return this.renderPageBlockChanged(e);case g.Ti.collectionView:case g.Ti.collectionViewPage:return this.renderCollectionBlockChanged(e);case g.Ti.image:return this.renderImageBlockChanged(e);case g.Ti.embed:return this.renderEmbedBlockChanged(e,"embed");case g.Ti.framer:return this.renderEmbedBlockChanged(e,"framer");case g.Ti.tweet:return this.renderEmbedBlockChanged(e,"tweet");case g.Ti.gist:return this.renderEmbedBlockChanged(e,"gist");case g.Ti.drive:return this.renderDriveBlockChanged(e);case g.Ti.maps:return this.renderEmbedBlockChanged(e,"maps");case g.Ti.invision:return this.renderEmbedBlockChanged(e,"invision");case g.Ti.video:return this.renderEmbedBlockChanged(e,"video");case g.Ti.audio:return this.renderEmbedBlockChanged(e,"audio");case g.Ti.file:return this.renderEmbedBlockChanged(e,"file");case g.Ti.callout:return this.renderCalloutBlockChanged(e);case g.Ti.whimsical:return this.renderEmbedBlockChanged(e,"whimsical");case g.Ti.miro:return this.renderEmbedBlockChanged(e,"miro");case g.Ti.abstract:return this.renderEmbedBlockChanged(e,"abstract");case g.Ti.mixpanel:return this.renderEmbedBlockChanged(e,"mixpanel");case g.Ti.sketch:return this.renderEmbedBlockChanged(e,"sketch");case g.Ti.replit:return this.renderEmbedBlockChanged(e,"replit");case g.Ti.excalidraw:return this.renderEmbedBlockChanged(e,"excalidraw");case g.Ti.tableRow:return this.renderSimpleTableRowBlockChanged(e);case g.Ti.hex:return this.renderEmbedBlockChanged(e,"hex");case g.Ti.hex:return this.renderEmbedBlockChanged(e,"deepnote");case g.Ti.externalObjectInstance:return this.renderExternalObjectInstanceBlockChanged(e)}}renderBlockCreatedEdit(e){const t=a()(J.ZP,{blockValue:e,rootStore:this.props.rootStore,created:!0});if(t)switch(e.type){case g.Ti.quote:case g.Ti.video:case g.Ti.code:case g.Ti.equation:case g.Ti.file:case g.Ti.bookmark:case g.Ti.factory:return a()("div",{style:q.v.wrapStyle},void 0,t);case g.Ti.table:return;case g.Ti.tableRow:return e.properties&&(0,H.Yd)(e.properties).length>0?a()("div",{style:{...q.v.wrapStyle,...q.v.addedStyle}},void 0,t):void 0;default:return a()("div",{style:{...q.v.wrapStyle,...q.v.addedStyle}},void 0,t)}}renderBlockDeletedEdit(e){const t=a()(J.ZP,{rootStore:this.props.rootStore,blockValue:e,deleted:!0});if(t)switch(e.type){case g.Ti.quote:case g.Ti.video:case g.Ti.code:case g.Ti.equation:case g.Ti.file:case g.Ti.bookmark:case g.Ti.factory:return a()("div",{},void 0,a()("div",{style:q.v.getLabelStyle(this.theme)},void 0,a()(N.FormattedMessage,{defaultMessage:"Deleted",id:"edit.blockDeletedEditStyles.factoryLabel"})),a()("div",{style:{...q.v.wrapStyle}},void 0,t));case g.Ti.table:return;case g.Ti.tableRow:return e.properties&&(0,H.Yd)(e.properties).length>0?a()("div",{style:{...q.v.wrapStyle,...q.v.deletedStyle}},void 0,t):void 0;default:return a()("div",{},void 0,a()("div",{style:q.v.getLabelStyle(this.theme)},void 0,a()(N.FormattedMessage,{defaultMessage:"Deleted",id:"edit.blockDeletedEditStyles.defaultLabel"})),a()("div",{style:{...q.v.wrapStyle,...q.v.deletedStyle}},void 0,t))}}renderBlockChangedEdit(e){const t=this.renderBlockChanged(e);if(t)return a()("div",{style:q.v.wrapStyle},void 0,t)}renderBlockPropertyChangedEdit(e){return a()("div",{},void 0,Object.entries(e.property_updates).map((t=>{let[r,i]=t;const o=e.filtered_block_schema[r],d=i.before?i.before.value:[],n=i.after?i.after.value:[],s=this.renderBlockPropertyEditDiff({labeled:!0,propertySchema:o,beforeValue:d,afterValue:n,spaceId:e.space_id});if(s)return a()("div",{style:q.v.wrapStyle},void 0,s)})))}renderCheckbox(e){return a()("div",{style:{marginRight:6,marginTop:3}},void 0,this.renderBlockProperty(e,"checked",!1))}renderEditTitle(e){return this.renderBlockEditProperty(e,"title",!1)}renderEditTitleDiff(e){return this.renderBlockEditPropertyDiff(e,"title",!1)}renderTextBlockChanged(e){return this.renderEditTitleDiff(e)}renderCalloutBlockChanged(e){return a()(_.Z,{title:a()(N.FormattedMessage,{defaultMessage:"Callout",id:"edit.calloutBlockChanged.label"}),theme:this.theme},void 0,this.renderEditTitleDiff(e))}renderExternalObjectInstanceBlockChanged(e){const t=t=>{const r=e.block_data[t].block_value,i=w.kk.fromBlock(r);return i.isType("external_object_instance")?v.$F(z.default.getIntl(),i,w.om.fromRecordMap(K.Z.getIntegrationsAsRecordMap())):null};return a()(_.Z,{title:l.createElement(N.FormattedMessage,v.V1.editLabel),theme:this.theme},void 0,a()("div",{style:q.v.deletedStyle},void 0,t("before")),a()("div",{},void 0,t("after")))}renderHeaderBlockChanged(e){return a()("div",{style:q.v.headerStyle},void 0,this.renderEditTitleDiff(e))}renderSubHeaderBlockChanged(e){return a()("div",{style:q.v.subHeaderStyle},void 0,this.renderEditTitleDiff(e))}renderSubSubHeaderBlockChanged(e){return a()("div",{style:q.v.subSubHeaderStyle},void 0,this.renderEditTitleDiff(e))}renderToggleBlockChanged(e){return a()(J.ZD,{},void 0,this.renderEditTitleDiff(e))}renderBulletedListBlockChanged(e){return a()("ul",{style:{margin:0,paddingLeft:28}},void 0,a()("li",{},void 0,this.renderEditTitleDiff(e)))}renderNumberedListBlockChanged(e){return a()("ol",{style:{margin:0,paddingLeft:28}},void 0,a()("li",{},void 0,this.renderEditTitleDiff(e)))}renderQuoteBlockChanged(e){return a()(_.Z,{title:a()(N.FormattedMessage,{defaultMessage:"Quote",id:"edit.quoteBlockChanged.label"}),theme:this.theme},void 0,this.renderEditTitleDiff(e))}renderFactoryBlockChanged(e){return a()(_.Z,{title:a()(N.FormattedMessage,{defaultMessage:"Template Button",id:"edit.templateButtonBlockChanged.label"}),theme:this.theme},void 0,this.renderEditTitleDiff(e))}renderEquationBlockChanged(e){return a()(_.Z,{title:a()(N.FormattedMessage,{defaultMessage:"Equation",id:"edit.equationBlockChanged.label"}),theme:this.theme},void 0,this.renderEditTitleDiff(e))}renderTodoBlockChanged(e){const t=u.j4({before:e.block_data.before.block_value,after:e.block_data.after.block_value,property:"checked"});return a()("div",{style:{display:"inline-flex"}},void 0,t?a()("div",{style:{marginRight:6,marginTop:3,lineHeight:1}},void 0,this.renderBlockEditPropertyDiff(e,"checked",!1)):this.renderCheckbox(e.block_data.after.block_value),this.renderEditTitleDiff(e))}renderCodeBlockChanged(e){return u.j4({before:e.block_data.before.block_value,after:e.block_data.after.block_value,property:"language"})?a()(_.Z,{title:this.getCodeTitle(e.block_data.after.block_value),theme:this.theme},void 0,a()("span",{style:{fontFamily:G.Z.getCompositeFontFamily(p.SP).mono,fontSize:12,tabSize:2}},void 0,this.renderEditTitle(e)),this.renderBlockEditPropertyDiff(e,"language",!0)):a()(_.Z,{title:this.getCodeTitle(e.block_data.after.block_value),theme:this.theme},void 0,a()("span",{style:{fontFamily:G.Z.getCompositeFontFamily(p.SP).mono,fontSize:12,tabSize:2}},void 0,this.renderEditTitle(e)))}renderCaptionChanged(e){return this.propertyChanged(e,"caption")&&this.renderBlockEditPropertyDiff(e,"caption",!1)}renderEmbedBlockChanged(e,t){const{intl:r}=this.props,i=this.propertyChanged(e,"source")&&a()(_.Z,{title:v.xg(r,t),theme:this.theme},void 0,this.renderSource(e.block_data.after.block_value),this.renderBlockEditPropertyDiff(e,"source",!1));return a()(l.Fragment,{},void 0,i,a()("div",{style:{marginBottom:i?4:0}},void 0,this.renderCaptionChanged(e)))}renderImageBlockChanged(e){const t=this.getSource(e.block_data.before.block_value),r=this.getSource(e.block_data.after.block_value),i=t!==r&&a()("div",{style:{marginTop:4,marginBottom:4}},void 0,a()("div",{style:{...q.v.getLabelStyle(this.theme),marginBottom:4}},void 0,a()(N.FormattedMessage,{defaultMessage:"Updated",id:"edit.imageBlockChanged.updatedTitle"})),r&&a()(J.xP,{src:r,permissionRecord:{table:I.iU,id:e.block_id}}));return a()(l.Fragment,{},void 0,i,a()("div",{style:{marginBottom:i?4:0}},void 0,this.renderCaptionChanged(e)))}renderComment(e){let{commentValue:t,discussionLocation:r,showEditedBadge:i,hideAuthorName:o}=e;if(!t.created_by_table||!t.created_by_id)return;if("comment-edit"!==this.props.type)return;const d=this.getRecordValue({table:t.created_by_table,id:t.created_by_id,spaceId:t.space_id}),n=d&&(0,m.LU)({table:t.created_by_table,value:d}),s=n?(0,m.$4)(this.props.intl,n):a()(N.FormattedMessage,{defaultMessage:"Unknown author",id:"edit.unknownAuthor.label"}),l=t.text&&a()(ee.Z,{propertySchema:{type:"text",name:""},value:{spaceId:t.space_id,value:this.props.highlightCurrentUser?this.highlightCurrentUserMentions(t.text):t.text},rootStore:this.props.rootStore}),c=(0,W.mf)(),p=t.content&&t.content.length>0&&t.content.map((e=>{const r=this.getRecordValue({table:"block",id:e,spaceId:t.space_id});return r&&a()(J.ZP,{blockValue:r,rootStore:this.props.rootStore})})).filter(H.$K),h=$.t1.createChildStore(this.props.rootStore,{table:R.x_,id:t.id,spaceId:(0,D.CG)(this.props.rootStore.pointer.spaceId)}),u=h.getUserVisibleReactions().length>0,v=!u,g=this.stores.isEditHovered;return a()("div",{style:{...v&&{position:"relative"}},onMouseEnter:()=>g.setState(!0),onMouseLeave:()=>g.setState(!1)},void 0,!o&&a()("div",{style:{...q.v.getLabelStyle(this.theme),marginBottom:2}},void 0,s),a()("span",{style:{...c&&{display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:6,...G.Z.textOverflowStyle}}},void 0,l),p,a()("div",{style:{...v&&{position:"absolute",top:-3,right:3}}},void 0,(g.state||u)&&a()(j.LazyReactionBar,{parentStore:h,discussionLocation:r,onClick:this.props.onReactionClick})),i&&a()("span",{style:{color:this.theme.mediumTextColor,paddingLeft:4}},void 0,a()(N.FormattedMessage,{id:"edit.editedBadge",defaultMessage:"(edited)"})))}renderCommentDiff(e){var t,r;const{before:i,after:o}=e;if(!o.created_by_table||!o.created_by_id)return;const d=this.getRecordValue({table:o.created_by_table,id:o.created_by_id,spaceId:o.space_id}),n=d&&(0,m.LU)({table:o.created_by_table,value:d}),s=n?(0,m.$4)(this.props.intl,n):a()(N.FormattedMessage,{defaultMessage:"Unknown author",id:"edit.unknownAuthorCommentDiff.label"}),c=i.text&&o.text&&a()(re.Z,{propertySchema:{type:"text",name:""},beforeValue:{value:i.text||[],spaceId:i.space_id},afterValue:{value:o.text||[],spaceId:o.space_id},rootStore:this.props.rootStore}),p=null===(t=o.content)||void 0===t?void 0:t.filter((e=>{var t;return!(null!==(t=i.content)&&void 0!==t&&t.includes(e))})),h=null===(r=i.content)||void 0===r?void 0:r.filter((e=>{var t;return!(null!==(t=o.content)&&void 0!==t&&t.includes(e))})),u=a()(l.Fragment,{},void 0,null==h?void 0:h.map((e=>{const t=this.getRecordValue({table:I.iU,id:e,spaceId:o.space_id});return t&&this.renderBlockDeletedEdit(t)})),null==p?void 0:p.map((e=>{const t=this.getRecordValue({table:I.iU,id:e,spaceId:o.space_id});return t&&a()(J.ZP,{blockValue:t,rootStore:this.props.rootStore})})));return a()("div",{},void 0,a()("div",{style:{...q.v.getLabelStyle(this.theme),marginBottom:2}},void 0,s),c,u)}renderCollectionPropertyChangedDiff(e){if(!e||!e.before||!e.after)return;const{before:t,after:r}=e,i=y.IQ({before:t,after:r});if(!i)return;const{newOptions:d,modifiedOptions:n,removedOptions:s}=i;if([d,n,s].every((e=>0===e.length)))return;const c=e=>{let{option:t,strikethrough:r=!1}=e;const i=(0,k.KR)(this.theme,null==t?void 0:t.color);return l.createElement(te.Z,o()({},i,{strikethrough:r}),t.value)};return a()(J.Hq,{labeled:!0,name:r.name,icon:r.icon,type:r.type},void 0,a()("div",{style:{display:"flex",flexDirection:"column",rowGap:4}},void 0,d.length>0&&a()("div",{style:{display:"inline-flex",alignItems:"center",columnGap:4}},void 0,a()(N.FormattedMessage,{defaultMessage:"Added",id:"Edit.renderCollectionPropertyChangedDiff.addedProperty"}),d.map((e=>a()("span",{},e.id,c({option:e}))))),s.length>0&&a()("div",{style:{display:"inline-flex",alignItems:"center",columnGap:4}},void 0,a()(N.FormattedMessage,{defaultMessage:"Removed",id:"Edit.renderCollectionPropertyChangedDiff.removedProperty"}),s.map((e=>a()("span",{},e.id,c({option:e,strikethrough:!0}))))),n.length>0&&a()("div",{style:{display:"flex",flex:1,flexDirection:"row"}},void 0,a()("span",{},void 0,a()(N.FormattedMessage,{defaultMessage:"Edited",id:"Edit.renderCollectionPropertyChangedDiff.editedProperty"})),a()("div",{style:{display:"flex",flexDirection:"column"}},void 0,n.map((e=>a()("span",{style:{display:"inline-flex",alignItems:"center"}},e.before.id,a()("span",{style:{marginLeft:4}},void 0,c({option:e.before,strikethrough:!0})),a()("span",{style:{padding:"0px 8px"}},void 0,P.Z.historyForward({width:10,height:10,fill:this.theme.mediumIconColor})),c({option:e.after}))))))))}renderCollectionDescriptionChangedDiff(e,t){if(!t||!t.before&&!t.after)return;const r=t.before&&t.before.description||[],i=t.after&&t.after.description||[];return a()(J.Hq,{labeled:!0,name:a()(N.FormattedMessage,{defaultMessage:"Description",id:"edit.descriptionPropertyChanged.label"}),icon:void 0,type:"text"},void 0,a()(re.Z,{propertySchema:{type:"text",name:""},beforeValue:{value:r,spaceId:e},afterValue:{value:i,spaceId:e},rootStore:this.props.rootStore}))}renderCollectionDescriptionCreatedDiff(e){if(e)return a()(J.Hq,{labeled:!0,name:a()(N.FormattedMessage,{defaultMessage:"Description",id:"edit.descriptionPropertyCreated.label"}),type:"text",icon:void 0},void 0,a()(re.Z,{propertySchema:{type:"text",name:""},beforeValue:{value:[],spaceId:e.spaceId},afterValue:e,rootStore:this.props.rootStore}))}renderBookmarkBlockChanged(e){const t=(this.propertyChanged(e,"title")||this.propertyChanged(e,"source"))&&a()(_.Z,{title:a()(N.FormattedMessage,{defaultMessage:"Bookmark",id:"edit.bookmarkBlockPropertyChanged.label"}),theme:this.theme},void 0,this.renderEditTitleDiff(e),this.renderBlockEditPropertyDiff(e,"link",!0));return a()(l.Fragment,{},void 0,t,this.propertyChanged(e,"caption")&&a()("div",{style:{marginBottom:t?4:0}},void 0,this.renderCaptionChanged(e)))}renderDriveBlockChanged(e){const t=(0,B.v0)(e.block_data.before.block_value),r=e.block_data.after.block_value,i=t!==(0,B.v0)(r);return a()(l.Fragment,{},void 0,i&&"drive"===r.type&&a()(J.ZP,{blockValue:r,rootStore:this.props.rootStore}))}renderPageBlockChanged(e){const t=u.OS({before:e.block_data.before.block_value,after:e.block_data.after.block_value,schema:e.block_schema}),r=u.B9({before:e.block_data.before.block_value,after:e.block_data.after.block_value});return a()("div",{},void 0,t.map(((t,r,i)=>a()("div",{},t,this.renderBlockEditPropertyDiff(e,t,!0)))),r.map(((r,i,o)=>{const d=0===t.length&&0===i,n=i===o.length-1;return a()("div",{style:{marginTop:d?6:10,marginBottom:n?0:6}},r,a()(Y,{formatProperty:r,edit:e}))})))}renderCollectionBlockChanged(e){return null}renderSimpleTableRowBlockChanged(e){const t=e.block_data.before.block_value,r=e.block_data.after.block_value,i=u.Yr({before:t,after:r});return a()("div",{style:{display:"flex",alignItems:"stretch",flexDirection:"column"}},void 0,i.map((e=>{const i=t.properties&&e in t.properties?t.properties[e]:void 0,o=r.properties&&e in r.properties?r.properties[e]:void 0,d=A.f7({environment:this.environment,cellValue:i,spaceId:t.space_id,parentStore:this.props.rootStore,theme:this.theme}),n=A.f7({environment:this.environment,cellValue:o,spaceId:r.space_id,parentStore:this.props.rootStore,theme:this.theme});return a()("div",{style:{display:"flex",border:`1px solid ${this.theme.tableDividerColor}`,overflowWrap:"anywhere",width:"max-content",maxWidth:"100%",verticalAlign:"top",lineHeight:G.Z.lineHeight.UIRegular.desktop,padding:4,marginBottom:4}},void 0,a()("span",{style:{...q.v.deletedStyle,marginBottom:void 0}},void 0,d),i&&o&&P.Z.historyForward({width:12,height:12,fill:this.theme.mediumIconColor,alignSelf:"center",margin:4}),a()("span",{style:{...q.v.addedStyle}},void 0,n))})))}renderSource(e){const t=this.getSource(e);return a()("span",{style:{wordBreak:"break-word"}},void 0,t)}renderPermissionCreated(e){return a()("div",{style:{...q.v.permissionStyle,...q.v.addedStyle,marginTop:3,marginBottom:3}},void 0,a()("div",{},void 0,this.renderPermissionTarget(e)),a()("div",{},void 0,this.renderPermissionRole(e.permission_data)))}renderPermissionDeleted(e){return a()("div",{style:{...q.v.permissionStyle,...q.v.deletedStyle}},void 0,a()("div",{},void 0,this.renderPermissionTarget(e)),a()("div",{},void 0,this.renderPermissionRole(e.permission_data)))}renderPermissionChanged(e){return a()("div",{style:q.v.permissionStyle},void 0,a()("div",{},void 0,this.renderPermissionTarget(e)),a()("div",{},void 0,a()("div",{style:q.v.diffWrapStyle},void 0,this.renderPermissionRole(e.permission_data.before),a()("div",{style:{padding:"0px 8px"}},void 0,P.Z.historyForward({width:14,height:14})),this.renderPermissionRole(e.permission_data.after))))}renderPermissionInheritanceChanged(e){var t;return((null===(t=e.permission_data)||void 0===t?void 0:t.calculated_changes)||[]).map(((t,r)=>{let[i,o]=t;const d={timestamp:e.timestamp,space_id:e.space_id,type:"permission-changed",permission_data:{before:i,after:o}};return a()(l.Fragment,{},`inheritance-change-${r}`,this.renderPermissionChanged(d))}))}renderPermissionGroupCreated(e){const t=e.permission_group_data.user_ids||[],r=s().compact(t.map((e=>this.getRecordValue({table:L.KJ,id:e}))));if(0!==r.length)return a()("div",{},void 0,r.map((e=>a()("div",{style:{...q.v.groupStyle,...q.v.addedStyle,marginTop:3,marginBottom:3}},e.id,(0,O.Nz)(this.props.intl,e)))))}renderPermissionGroupDeleted(e){const t=e.permission_group_data.user_ids||[],r=s().compact(t.map((e=>this.getRecordValue({table:L.KJ,id:e}))));if(0!==r.length)return a()("div",{},void 0,r.map((e=>a()("div",{style:{...q.v.groupStyle,...q.v.deletedStyle}},e.id,(0,O.Nz)(this.props.intl,e)))))}renderPermissionGroupChanged(e){const t=e.permission_group_data.before.user_ids||[],r=e.permission_group_data.after.user_ids||[],i=(0,S.E)(t,r),o=s().compact(i.created.map((e=>this.getRecordValue({table:L.KJ,id:e})))),d=s().compact(i.deleted.map((e=>this.getRecordValue({table:L.KJ,id:e}))));if(0!==o.length||0!==d.length)return a()("div",{},void 0,o.map((e=>a()("div",{style:{...q.v.groupStyle,...q.v.addedStyle,marginTop:3,marginBottom:3}},e.id,(0,O.Nz)(this.props.intl,e)))),d.map((e=>a()("div",{style:{...q.v.groupStyle,...q.v.deletedStyle}},e.id,(0,O.Nz)(this.props.intl,e)))))}renderPermissionRole(e){const t=e.role??"none",r=(0,M.kD)(t,void 0);return r?a()("div",{style:q.v.getRoleStyle()},void 0,this.props.intl.formatMessage(r)):void 0}renderPermissionTarget(e){const t="permission-changed"===e.type?e.permission_data.after:e.permission_data;if((0,x.jg)(t)){const e=this.getRecordValue({table:L.KJ,id:t.user_id}),r=(0,O.Nz)(this.props.intl,e);return a()("div",{style:q.v.permissionTypeWrapStyle},void 0,a()("div",{style:q.v.getUserHeaderStyle(this.theme)},void 0,r))}if((0,x.ix)(t)){const t=this.getRecordValue({table:F.bx,id:e.space_id}),r=t?t.name:a()(N.FormattedMessage,{defaultMessage:"Unknown",id:"edit.unknownSpacePermissionTarget.label"});return a()("div",{style:q.v.permissionTypeWrapStyle},void 0,a()("div",{style:q.v.getUserHeaderStyle(this.theme)},void 0,r))}if((0,x.$D)(t))return a()("div",{style:q.v.permissionTypeWrapStyle},void 0,a()("div",{style:q.v.getUserHeaderStyle(this.theme)},void 0,a()(N.FormattedMessage,{defaultMessage:"Published link",id:"edit.publishToWebPermissionTarget.label"})));if((0,x.hV)(t)){const r=this.getRecordValue({table:F.bx,id:e.space_id}),i=(r&&r.permission_groups||[]).find((e=>e.id===t.group_id)),o=i&&i.name||a()(N.FormattedMessage,{defaultMessage:"Deleted group",id:"edit.deletedPermissionGroup.label"});return a()("div",{style:q.v.permissionTypeWrapStyle},void 0,a()("div",{style:q.v.getUserHeaderStyle(this.theme)},void 0,o))}if((0,x.FB)(t)){const r=this.getRecordValue({table:V.cZ,id:t.bot_id,spaceId:e.space_id}),i=(0,b.Mh)(r);return a()("div",{style:q.v.permissionTypeWrapStyle},void 0,a()("div",{style:q.v.getUserHeaderStyle(this.theme)},void 0,i))}if((0,x.zU)(t)){const r=this.getRecordValue({table:Z.e0,id:t.team_id,spaceId:e.space_id});let i=a()(N.FormattedMessage,{defaultMessage:"Members of an unknown teamspace",id:"edit.teamMemberPermissionChanged.unknownTeam"});return null!=r&&r.name&&(i=a()(N.FormattedMessage,{defaultMessage:"Members of {teamName}",id:"edit.teamMemberPermissionChanged.knownTeam",values:{teamName:r.name}})),a()("div",{style:q.v.permissionTypeWrapStyle},void 0,a()("div",{style:q.v.getUserHeaderStyle(this.theme)},void 0,i))}if((0,x.LW)(t)){const r=this.getRecordValue({table:Z.e0,id:t.team_id,spaceId:e.space_id});let i=a()(N.FormattedMessage,{defaultMessage:"Owners of an unknown teamspace",id:"edit.teamOwnerPermissionChanged.unknownTeam"});return null!=r&&r.name&&(i=a()(N.FormattedMessage,{defaultMessage:"Owners of {teamName}",id:"edit.teamOwnerPermissionChanged.knownTeam",values:{teamName:r.name}})),a()("div",{style:q.v.permissionTypeWrapStyle},void 0,a()("div",{style:q.v.getUserHeaderStyle(this.theme)},void 0,i))}}renderCommentCreatedEdit(e){const{edit:t,discussionLocation:r,hideAuthorName:i}=e,o=this.getRecordValue({table:R.x_,id:t.comment_id,spaceId:t.space_id}),d=Boolean(t.comment_data&&o&&(0,C.P)(w.kk.fromValue(R.x_,t.comment_data),w.kk.fromValue(R.x_,o)));if(o)return a()("div",{style:q.v.wrapStyle},void 0,this.renderComment({commentValue:o,discussionLocation:r,showEditedBadge:d,hideAuthorName:i}))}renderCommentChangedEdit(e){return a()("div",{style:q.v.wrapStyle},void 0,this.renderCommentDiff(e.comment_data))}renderCommentDeletedEdit(e,t){const r=this.getRecordValue({table:R.x_,id:e.comment_id,spaceId:e.space_id}),i=e.comment_data||r;if(i)return a()("div",{style:{...q.v.wrapStyle,...q.v.deletedStyle}},void 0,this.renderComment({commentValue:i,discussionLocation:t,showEditedBadge:!1,hideAuthorName:!1}))}renderCollectionPropertyChangedEdit(e){const t=this.renderCollectionPropertyChangedDiff(e.collection_property_data);return t?a()("div",{style:{...q.v.wrapStyle,paddingTop:6,paddingBottom:4}},void 0,t):null}renderCollectionChangedEdit(e){return a()("div",{style:q.v.wrapStyle},void 0,this.renderCollectionDescriptionChangedDiff(e.space_id,e.collection_data))}renderCollectionCreatedEdit(e){var t;const r=null===(t=e.collection_data)||void 0===t?void 0:t.description;return a()("div",{style:q.v.wrapStyle},void 0,this.renderCollectionDescriptionCreatedDiff(r&&{value:r,spaceId:e.space_id}))}renderMentionCreated(e){return this.renderBlockOrProperty({blockId:e.mentioned_block_id,property:e.mentioned_property})}renderPermissionGroupMentionCreated(e){return this.renderBlockOrProperty({blockId:e.mentioned_block_id,property:e.mentioned_property})}renderReminderCreated(e){return this.renderBlockOrProperty({blockId:e.reminder_block_id,property:e.reminder_property})}renderBlockOrProperty(e){const t=this.getRecordValue({table:I.iU,id:e.blockId});if(t){const i=(0,T.ky)({block:t,getRecordValue:this.getRecordValue});if(i){const r=f.oC(i),o=this.renderBlockProperty(t,e.property,!0,r);if(o)return a()("div",{style:{...q.v.wrapStyle}},void 0,o)}else{var r;const e=null===(r=t.properties)||void 0===r?void 0:r.title,i={...t,properties:{...t.properties,title:this.props.highlightCurrentUser&&e?this.highlightCurrentUserMentions(e):e}},o=a()(J.ZP,{blockValue:i,rootStore:this.props.rootStore});if(o)return a()("div",{style:q.v.wrapStyle},void 0,o)}}}highlightCurrentUserMentions(e){const t=[],r=this.environment.currentUser;return U.lz(e).forEach((e=>{if(U.km(e)){const i=[];for(const t of U.hn(e)){const e=U.IW(t)&&t[1]===r.id,o=U._b(t)&&this.currentUserIsMemberOfGroup(t[1],t[2]);e||o?(i.push(t),i.push([U.GK.Highlight,"yellow_background"])):i.push(t)}t.push([e[0],i])}else t.push(e)})),t}currentUserIsMemberOfGroup(e,t){var r;const i=this.environment.currentUser.id;if(!i)return!1;const o=this.getRecordValue({table:F.bx,id:t});return new Set(null==o||null===(r=o.permission_groups)||void 0===r||null===(r=r.find((t=>t.id===e)))||void 0===r?void 0:r.user_ids).has(i)}getBlockSchema(e){return e.block_schema?f.a5(e):f.Kc(this.props.intl)}getCodeTitle(e){const t=e&&e.properties&&e.properties.language;if(!t)return a()(N.FormattedMessage,{defaultMessage:"Code",id:"edit.codeBlockChanged.label"});const r=y.Sj(t,f.fG);return a()(N.FormattedMessage,{defaultMessage:"Code - {codeLanguage}",values:{codeLanguage:r},id:"edit.codeBlockWithLanguageChanged.label"})}getSource(e){const t=e&&e.properties&&e.properties.source;return y.zB(t)}hasProperty(e,t){return Boolean(e&&e.properties&&e.properties[t])}propertyChanged(e,t){return!s().isEqual(e.block_data.before.block_value&&e.block_data.before.block_value.properties&&e.block_data.before.block_value.properties[t],e.block_data.after.block_value&&e.block_data.after.block_value.properties&&e.block_data.after.block_value.properties[t])}}ie.displayName="Edit";const oe=(0,N.injectIntl)(ie)}}]);