"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[4544],{47893:(e,t,o)=>{o.r(t),o.d(t,{default:()=>xd});var n=o(23174),i=o.n(n),r=o(10434),a=o.n(r),l=o(67294),s=o(83355),c=o(4615),d=o(5366),u=o(50906),p=o(5149),g=o(96802),m=o(12359),y=o(12534),S=o(28187),f=o(34859),h=o(58421),v=o(36857),b=o(27788),C=o(480),w=o(81954),M=o(24405),_=o(53397),k=o(97880),x=o(82990);var T=o(78316),P=o(42937),A=o(29376),V=o(61766),F=o(13005),I=o(42917),B=o(64921);function Z(e){window.__c={n:"CollectionSettingsNotification"};const{title:t,icon:o,style:n,children:r,showCloseButton:a,onClose:l}=e,s=(0,M.Fg)();return i()("div",{style:{padding:"12px 16px",margin:"4px 12px",fontSize:12,background:s.accentColors.orange[50],borderRadius:6,...n}},void 0,t&&i()("div",{style:{display:"flex",marginBottom:2}},void 0,o,i()("div",{style:{fontWeight:x.Z.fontWeight.medium,flexGrow:1}},void 0,t),a&&i()(B.Z,{onClick:l,style:{display:"flex",alignItems:"center",justifyContent:"center",background:void 0,borderRadius:6,width:16,height:16}},void 0,_.Z.closeSmall({width:14,fill:s.mediumTextColor}))),r)}var E=o(72495),D=o(64369),K=o(5210);function N(e){window.__c={n:"CollectionSettingsViewSubitemsPreview"};const{propertyName:t,inversePropertyName:o,newDesign:n}=e,r=(0,M.yK)((e=>({togglePreviewParentIcon:{color:e.regularIconColor,marginRight:"4"},togglePreviewChildIcon:{color:e.mediumIconColor,marginLeft:"24px",marginRight:"4"},togglePreviewRowWithDivider:{padding:"4px",margin:"0px 12px",display:"flex",fontSize:14,alignItems:"center",borderBottom:`1px solid ${e.regularDividerColor}`},togglePreviewRow:{padding:"4px",margin:"0px 12px",display:"flex",fontSize:14,alignItems:"center"},togglePreviewOutsideBorder:{margin:"0px 12px",border:`1px solid ${e.regularDividerColor}`,borderRadius:"4px",alignItems:"center",...n?{fontWeight:x.Z.fontWeight.medium,backgroundColor:e.accentColors.gray[30],padding:"9px 0"}:{}}})),[n]);return l.createElement(l.Fragment,null,i()(E.Z,{disableMobileBorders:!0},void 0,i()("div",{style:r.togglePreviewOutsideBorder},void 0,i()("div",{style:r.togglePreviewRowWithDivider},void 0,i()(K.Z,{isSidebar:!1,open:!0,fill:!0,onClick:()=>{},style:r.togglePreviewParentIcon,disabled:!0}),i()("span",{},void 0,"üêî"),i()("div",{style:{marginLeft:"5px"}},void 0,o)),i()("div",{style:r.togglePreviewRowWithDivider},void 0,i()(K.Z,{isSidebar:!1,open:!1,fill:!0,onClick:()=>{},style:r.togglePreviewChildIcon,disabled:!0}),i()("span",{},void 0,"üê£"),i()("div",{style:{marginLeft:"5px"}},void 0,t)),i()("div",{style:r.togglePreviewRow},void 0,i()(K.Z,{isSidebar:!1,open:!1,fill:!0,onClick:()=>{},style:r.togglePreviewChildIcon,disabled:!0}),i()("span",{},void 0,"üê£"),i()("div",{style:{marginLeft:"5px"}},void 0,t)))))}var R=o(96486),O=o.n(R),W=o(80357),G=o(65742),L=(o(21703),o(27731));function*z(e,t){const o=new L.Z;for(o.currentValue=e,o.endValue=t,o.stiffness=35;;){const e=yield o.currentValue;if(o.step(e)){yield o.currentValue;break}}}function*U(e,t,o){let n=0;for(;n<o;){n+=(yield e+n/o*(t-e))}}function*H(e){for(const[t,o]of O().zip(e,e.slice(1)))(0,k.$K)(t)&&(0,k.$K)(o)&&(yield*z(t,o))}function*$(e,t){let o=0;for(;!(0,k.$K)(t)||o<t;){o+=(yield e)}}function*q(e){let t=0;for(;;){const o={};for(const[n,i]of(0,k.qP)(e)){const e=i.next(t);if(e.done)return;o[n]=e.value}t=yield o}}var j=o(28267),Y=o(82994);const Q="inactive-task-filter",X="active-task-filter",J="mouse-cursor-filter",ee=80,te=24;function*oe(e){yield*q({x:e,opacity:$(1)})}function ne(e){window.__c={n:"DateShiftingPreview"};const{mode:t}=e,o=(0,M.yK)((e=>({wrap:{margin:"0px 12px",border:`1px solid ${e.regularDividerColor}`,borderRadius:4,alignItems:"center",position:"relative",height:112}})),[1]),n=(0,l.useRef)(null),r=(0,j.X)(n),a=r?r.width-2:264;return l.createElement("div",{style:o.wrap,ref:n},i()(ie,{mode:t,sceneWidth:a}))}function ie(e){window.__c={n:"DateShiftingPreviewAnimation"};const{mode:t,sceneWidth:o}=e,n=(0,M.yK)((e=>({svgArrowTheme:{stroke:e.collectionValidDependencyArrow,strokeWidth:G.lf},invalidArrow:{stroke:e.collectionInvalidDependencyArrow},svgContainer:{position:"absolute",width:"100%",height:"100%",backgroundColor:e.accentColors.gray[30]}})),[]),r=(0,l.useMemo)((()=>({none:function*(){for(;;)yield*oe(H([o/2,o/2+40+20,o/2-40-20,o/2]))},preserve_gap:function*(){for(;;)yield*oe(H([o/2,o/2+40,o/2-40,o/2]))},consume_gap:function*(){for(;;){yield*oe(H([o/2,o/2-40,o/2+40,o/2+ee]));const e=500;yield*q({x:$(o/2+ee),opacity:U(1,0,e)}),yield*q({x:$(o/2),opacity:U(0,1,e)})}}})),[o]),{x:s,opacity:c}=function(e){const t=(0,l.useMemo)((()=>e()),[e]),[o,n]=(0,l.useState)((()=>{const e=t.next(0);if(e.done)throw new Error("Generator must provide at least one result");return e.value}));return(0,l.useEffect)((()=>{const e=t.next(0);e.done||n(e.value);let o=Date.now(),i=0;return i=requestAnimationFrame((function e(){i=requestAnimationFrame(e);const r=Date.now(),a=r-o;o=r;const l=t.next(a);l.done||n(l.value)})),()=>cancelAnimationFrame(i)}),[t]),o}(r[t??"none"]),d={x:o/2-160,y:10},u={x:s-40,y:42},p={x:o/2+ee,y:74},g={x:u.x+40,y:u.y+12};return(0,k.$K)(t)&&("consume_gap"===t?(d.x=Math.min(d.x,u.x-ee),p.x=Math.max(p.x,u.x+ee)):"preserve_gap"===t?(d.x=d.x+s-o/2,p.x=p.x+s-o/2):(0,k.t1)(t)),i()("svg",{style:n.svgContainer},void 0,O().range(o/2-160,o,40).map(((e,t)=>i()(ae,{startPoint:{x:e,y:0},endPoint:{x:e,y:110}},t))),l.createElement(Y.Z,a()({startPoint:{x:u.x+ee,y:u.y+12},endPoint:{x:p.x-2,y:p.y+12}},(0,W.iv)(n.svgArrowTheme,u.x+ee>p.x?n.invalidArrow:void 0,{opacity:c}),{showArrowHead:!0})),l.createElement(Y.Z,a()({startPoint:{x:d.x+ee,y:d.y+12},endPoint:{x:u.x-2,y:u.y+12}},(0,W.iv)(n.svgArrowTheme,u.x<d.x+ee?n.invalidArrow:void 0,{opacity:c}),{showArrowHead:!0})),i()(re,{point:d,opacity:c}),i()(re,{point:u,active:!0,opacity:c}),i()(re,{point:p,opacity:c}),i()(le,{point:g,opacity:c}),i()(se,{}))}function re(e){window.__c={n:"SvgTaskBox"};const{point:t,active:o,opacity:n}=e,r=(0,M.Fg)(),a=o?"dark"===r.mode?"#28456C":"#E7F3F8":r.buttonBackground;return i()("g",{transform:`translate(${t.x-4},${t.y-2})`,opacity:n},void 0,i()("rect",{filter:`url(#${o?X:Q})`,width:ee,height:te,x:"4",y:"2",fill:a,rx:"3"}))}function ae(e){window.__c={n:"SvgDashedLine"};const{startPoint:t,endPoint:o}=e,n=(0,M.Fg)(),r="dark"===n.mode?n.accentColors.gray[300]:"#E3E2E0";return i()("line",{x1:t.x,y1:t.y,x2:o.x,y2:o.y,stroke:r,strokeDasharray:"3 4"})}function le(e){const{point:t,opacity:o}=e;return i()("g",{filter:"url(#mouse-cursor-filter)",transform:`translate(${t.x},${t.y})`,opacity:o},void 0,i()("path",{fill:"#32302C",d:"M14 12.25h-3.334l2.193 5.294-2.309.956-2.194-5.294L6 15.563l-.75-.75V3.94l1.06-.44L14 11.19v1.06z"}),i()("path",{stroke:"#fff",fill:"#32302C",strokeWidth:"0.5",d:"M14 12.5h.25v-1.413l-.073-.073-7.69-7.69-.12-.12-.154.065-1.059.44L5 3.775v11.142l.073.073.75.75.177.177.177-.177 2.092-2.091 2.05 4.948.096.23.23-.095 2.31-.956.231-.096-.096-.231-2.05-4.948H14z"}))}function se(){return i()("defs",{},void 0,i()("filter",{id:Q,width:88,height:32,x:"0",y:"0",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse"},void 0,i()("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),i()("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),i()("feMorphology",{in:"SourceAlpha",operator:"dilate",radius:"1",result:"effect1_dropShadow_637_7659"}),i()("feOffset",{}),i()("feComposite",{in2:"hardAlpha",operator:"out"}),i()("feColorMatrix",{values:"0 0 0 0 0.0707 0 0 0 0 0.0693 0 0 0 0 0.0693 0 0 0 0.1 0"}),i()("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_637_7659"}),i()("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),i()("feOffset",{dy:"2"}),i()("feGaussianBlur",{stdDeviation:"2"}),i()("feComposite",{in2:"hardAlpha",operator:"out"}),i()("feColorMatrix",{values:"0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0.1 0"}),i()("feBlend",{in2:"effect1_dropShadow_637_7659",result:"effect2_dropShadow_637_7659"}),i()("feBlend",{in:"SourceGraphic",in2:"effect2_dropShadow_637_7659",result:"shape"})),i()("filter",{id:X,width:88,height:32,x:"0",y:"0",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse"},void 0,i()("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),i()("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),i()("feMorphology",{in:"SourceAlpha",operator:"dilate",radius:"1",result:"effect1_dropShadow_637_5084"}),i()("feOffset",{}),i()("feComposite",{in2:"hardAlpha",operator:"out"}),i()("feColorMatrix",{values:"0 0 0 0 0.2 0 0 0 0 0.494118 0 0 0 0 0.662745 0 0 0 0.2 0"}),i()("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_637_5084"}),i()("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),i()("feOffset",{dy:"2"}),i()("feGaussianBlur",{stdDeviation:"2"}),i()("feComposite",{in2:"hardAlpha",operator:"out"}),i()("feColorMatrix",{values:"0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0.1 0"}),i()("feBlend",{in2:"effect1_dropShadow_637_5084",result:"effect2_dropShadow_637_5084"}),i()("feBlend",{in:"SourceGraphic",in2:"effect2_dropShadow_637_5084",result:"shape"})),i()("filter",{id:J,width:"17.75",height:"24.244",x:"0.75",y:"0.91",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse"},void 0,i()("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),i()("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),i()("feOffset",{dy:"2"}),i()("feGaussianBlur",{stdDeviation:"2"}),i()("feComposite",{in2:"hardAlpha",operator:"out"}),i()("feColorMatrix",{values:"0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0.2 0"}),i()("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_637_4925"}),i()("feBlend",{in:"SourceGraphic",in2:"effect1_dropShadow_637_4925",result:"shape"})))}var ce=o(99036),de=o(52936),ue=o(71644),pe=o(77162),ge=o(16956),me=o(64434),ye=o(47307),Se=o(9953),fe=o(42922),he=o(86825),ve=o(87279),be=o(61053),Ce=o(31945),we=o(78140),Me=o(69872);function _e(e){window.__c={n:"CollectionSettingsViewDefaultPropertyPopup"};const{menuProps:t,property:o,defaultProperty:n,checkState:r,propertySchema:s,collectionContextStore:c,handleDefaultPropertySelect:d,handlePropertySelect:u,...p}=e,g=(0,C.MO)(),m=(0,w.VK)((()=>c.permissionScopes.state),[c]);return i()(Ce.ZP,{popupType:g?Ce.Z4.SlideUp:Ce.Z4.Popup,alignmentToOrigin:Ce.vR.End,placementToOrigin:Ce.pO.Bottom,originGap:0,renderOrigin:e=>l.createElement(Me.Z,a()({},t,e,{disabled:!m.canConfigureBlock,propertySchema:s,format:Me.Z.DisplayFormat.Name,right:i()(ke,{property:o,defaultProperty:n,checkState:r,collectionContextStore:c})})),render:e=>l.createElement(xe,a()({},p,{parent:e,property:o,collectionContextStore:c,handleDefaultPropertySelect:d,handlePropertySelect:u}))})}function ke(e){window.__c={n:"DefaultCheck"};const{property:t,defaultProperty:o,checkState:n,collectionContextStore:r}=e,a=(0,C.MO)(),l=(0,w.VK)((()=>{var e;return null===(e=r.collectionStore())||void 0===e||null===(e=e.getName())||void 0===e?void 0:e.toString()}),[r]),s=(0,M.yK)((e=>({defaultText:{color:e.mediumTextColor,fontSize:12,fontWeight:500,textTransform:"uppercase",marginRight:4}})),[]);return i()("div",{style:{display:"flex",justifyContent:"space-between"}},void 0,i()("div",{style:{...s.defaultText}},void 0,t===o&&i()(d.FormattedMessage,{defaultMessage:"Default",id:"database.viewSettings.setViewPropertyDefault.defaultProperty.tag",values:{databaseName:l}})),n&&i()("div",{style:{...a?{marginLeft:"auto",marginRight:20,minWidth:0,flexShrink:0}:{marginLeft:"auto",marginRight:12,minWidth:0,flexShrink:0},width:a?16:14,flexShrink:0}},void 0,_.Z.thinCheck()))}function xe(e){window.__c={n:"PropertySelectPopup"};const{parent:t,property:o,collectionContextStore:n,handleDefaultPropertySelect:r,handlePropertySelect:a,...s}=e,c=(0,C.MO)(),u=(0,w.VK)((()=>n.permissionScopes.state),[n]),p=(0,w.VK)((()=>n.databaseType),[n]),g=(0,w.VK)((()=>{var e;return null===(e=n.collectionStore())||void 0===e||null===(e=e.getName())||void 0===e?void 0:e.toString()}),[n]);let m;m=c?{menuType:ve.og.ActionSheet}:{menuType:ve.og.Popup,width:300};const y=u.canConfigureCollection;let S;return"v1"===e.version?S=i()(E.Z,{topBorder:!0},void 0,y&&i()(I.Z,{isGray:!0,title:i()(d.FormattedMessage,{defaultMessage:"Set on all new {databaseName} views",id:"database.viewSettings.setViewPropertyDefault.allDefaultButton.title",values:{databaseName:g}}),onClick:()=>{r(o),t.close()}}),i()(I.Z,{title:i()(d.FormattedMessage,{id:"database.viewSettings.setViewPropertyDefault.setProperty.title",defaultMessage:"Set on this view"}),isGray:!0,onClick:()=>{a(o),t.close()}})):"v2"===e.version?S=l.createElement(l.Fragment,null,y&&i()(E.Z,{},void 0,i()(I.Z,{title:i()(d.FormattedMessage,{defaultMessage:"Set as default",id:"database.viewSettings.relationFeatures.setViewPropertyDefault.allDefaultButton.title",values:{databaseName:g}}),caption:l.createElement(d.FormattedMessage,(0,P.K9)({feature:e.feature,databaseType:p})),shouldWrapCaption:!0,onClick:()=>{r(o),t.close()}})),i()(E.Z,{topBorder:y},void 0,i()(I.Z,{title:i()(d.FormattedMessage,{id:"database.viewSettings.relationFeatures.setViewPropertyDefault.setProperty.title",defaultMessage:"Set on this view only"}),onClick:()=>{a(o),t.close()}}))):(0,k.t1)(e),l.createElement(we.Z,m,S)}o(57658);var Te=o(43261),Pe=o.n(Te),Ae=o(6695),Ve=o(52821),Fe=o(33929),Ie=o(29798),Be=o(73657),Ze=o(52275),Ee=o(68894),De=o(32163);const Ke=(0,d.defineMessages)({inputPlaceholder:{defaultMessage:"Search for a property‚Ä¶",id:"database.viewSettings.propertySelect.inputPlaceholder"}});function Ne(e){window.__c={n:"CollectionSetttingsGroupedPropertySelectMenu"};const{currentProperty:t,getGroupedProperties:o,onAccept:n,renderProperty:r,inputPlaceholder:s,schema:c,format:u,defaultShowPropertyGroupCount:p}=e,g=(0,C.Fy)(),m=(0,w.qz)(void 0,Ie.Z),y=(0,w.VK)((()=>o()),[o]),[S,f]=(0,l.useState)(!1),[h,v]=(0,l.useState)(""),b=(0,Ae.iB)(u,c,void 0,Ae.j5.Page).collection_page_properties||[],x=(0,l.useCallback)((e=>{v(e.target.value),m.setState({...m.state,focus:{section:0,indexLocal:0,indexGlobal:0}}),f(!1)}),[m]),T=(0,M.yK)((e=>({dotsIcon:{width:16,fill:e.mediumTextColor,marginLeft:4,marginRight:2},showMoreButton:{color:e.mediumTextColor}})),[]),P=R.sortBy(y,(e=>Math.min(...e.map((e=>b.findIndex((t=>t.property===e))))))),A=[{key:"input",comp:i()(E.Z,{},void 0,i()(Ee.ZP,{focusInitial:!g.isMobile||void 0,focus:!g.isMobile||void 0,value:h,onChange:x,placeholder:s||Fe.default.formatMessage(Ke.inputPlaceholder)}))}];if(h){const e=P.map((e=>e.filter((e=>{const t=c[e],o=t?`${t.name} ${Ve.SO[t.type]}`:"";return Boolean(Pe().match(h,o))})))).filter((e=>e.length>0));if(0===e.length)A.push({key:"noResults",comp:i()(Be.Z,{caption:i()(d.FormattedMessage,{defaultMessage:"No results",id:"database.viewSettings.propertySelect.noResultsTitle"})})});else{const o=[{key:"results",render:e=>l.createElement(E.Z,e),items:e.flat().map((e=>Oe({onAccept:n,property:e,schema:c,currentProperty:t,renderProperty:r}))).filter(k.$K)}];A.push(Re({sections:o,menuListStore:m}))}}else{const e=p||2;let o,s;if(!S&&P.length>e){o=P.slice(0,e);const t=R.sum(P.slice(e).map((e=>e.length)));s={key:"show_more",render:e=>l.createElement(Ze.Z,a()({},e,{icon:_.Z.dots(T.dotsIcon),style:T.showMoreButton,title:i()(d.FormattedMessage,{defaultMessage:"{moreCount} more",id:"database.viewSettings.propertySelect.showMoreTitle",values:{moreCount:t}})})),action:()=>{f(!0)}}}else o=P;const u=o.map(((e,i)=>({key:e.join("-"),render:e=>l.createElement(E.Z,a()({},e,{topBorder:0!==i})),items:e.map((e=>Oe({onAccept:n,property:e,schema:c,currentProperty:t,renderProperty:r}))).concat(i===o.length-1?[s]:[]).filter(k.$K)})));A.push(Re({sections:u,menuListStore:m}))}return l.createElement(l.Fragment,null,A.map((e=>{let{key:t,comp:o}=e;return i()(l.Fragment,{},t,o)})))}function Re(e){const{menuListStore:t,sections:o}=e;return{key:"properties",comp:i()(De.Z,{type:De.i.Vertical,initialFocus:0,sections:o,store:t})}}function Oe(e){const{schema:t,currentProperty:o,onAccept:n,renderProperty:i,property:r}=e,s=t[r];if(!s)return;return{key:r,render:e=>{const t=r===o;return i?i(e,r,t,s):l.createElement(Me.Z,a()({},e,{propertySchema:s,format:Me.Z.DisplayFormat.Name,checkState:t}))},action:()=>{n(r)}}}var We=o(44532),Ge=o(31869),Le=o(54281),ze=o(49830);function Ue(e){const{collectionContextStore:t,feature:o}=e,n=(0,d.useIntl)();return{initialPropertyName:(0,w.VK)((()=>{const e=t.collectionStore();if(null!=e&&e.isDefined()){const i=t.normalizedSchemaStore.state;return A.m8(n,{targetCollectionStore:e,isSelfRelation:!0,sourceSchema:i,createUnique:!0,from:o})}return n.formatMessage({id:"database.viewSettings.relationsPropertyTab.initialPropertyName.placeholder",defaultMessage:"Related to target"})}),[t,n,o])}}function He(e){const{feature:t,collectionContextStore:o,collectionSettingsStore:n,onPropertySelect:i}=e,r=(0,C.O7)(),a=(0,d.useIntl)(),{initialPropertyName:s}=Ue({collectionContextStore:o,feature:t}),c=(0,l.useCallback)((e=>{const{collectionViewStore:o,newProperty:n,transaction:i}=e;"subitem"===t?ze.dR({collectionViewStore:o,propertyId:n,transaction:i}):"timeline_arrows_by"===t?Le.tF({collectionViewStore:o,newProperty:n,transaction:i}):(0,k.t1)(t)}),[t]),u=(0,w.VK)((()=>o.normalizedSchemaStore.state),[o]),g=(0,l.useCallback)((()=>A.ND(o,u)),[o,u]),y=(0,l.useCallback)((e=>{const{relationPropertyId:n,transaction:i}=e;"subitem"===t?ze.jA({collectionContextStore:o,relationPropertyId:n,transaction:i}):"timeline_arrows_by"===t?Le._p({collectionContextStore:o,relationPropertyId:n,transaction:i}):(0,k.t1)(t)}),[o,t]),S=(0,l.useCallback)((e=>{const{featureType:t}=e,i=o.collectionStore(),l=i,d=o.collectionViewStore();i&&l&&(m.createAndCommit({userAction:"CollectionSettingsSetupRelation.handleAddRelation",environment:r,perform:n=>{const u=ge.G3({environment:r,collectionStore:i,collectionViewArgs:d?{collectionViewStore:d,format:d.getFormat(),formatKey:"collection_page_properties"}:void 0,propertyType:"relation",transaction:n});return Ge.n7({environment:r,collectionContextStore:o,collectionStore:i,property:u,propertyName:s,targetCollectionStore:l,hasInverseRelation:!0,inverseName:void 0,autoRelate:{enabled:!1},propertyLimit:"no_limit",intl:a,transaction:n,from:t}),d&&(c({collectionViewStore:d,newProperty:u,transaction:n}),y({relationPropertyId:u,transaction:n})),"timeline_arrows_by"===t&&at({environment:r,intl:a,collectionStore:i,transaction:n,newConfig:e.dateShiftingConfig}),u}}),p.wl({collectionSettingsStore:n,item:{type:"main"}}),pe._H({environment:r,collectionContextStore:o,from:t,property_type:"relation"}))}),[o,n,r,s,a,y,c]),f=(0,l.useCallback)((e=>{const n=o.collectionViewStore();if(!n)return;let a;m.createAndCommit({userAction:"CollectionSettingsViewRelationsProperty.handleDefaultPropertySelect",environment:r,perform:t=>{c({collectionViewStore:n,newProperty:e,transaction:t}),y({relationPropertyId:e,transaction:t})}}),i(e),"subitem"===t?a="update_default_subitem":"timeline_arrows_by"===t?a="update_default_timeline_arrows_by":(0,k.t1)(t),pe.wd({action:a,original_view_type:void 0,property_type:e?"relation":void 0,environment:r,collectionContextStore:o})}),[o,r,i,t,c,y]);return{handlePropertySelect:(0,l.useCallback)((e=>{const n=o.collectionViewStore();if(!n)return;let a;m.createAndCommit({userAction:"CollectionSettingsViewRelationsProperty.handlePropertySelect",environment:r,perform:t=>{c({collectionViewStore:n,newProperty:e,transaction:t})}}),i(e),"subitem"===t?a="update_subitem":"timeline_arrows_by"===t?a="update_timeline_arrows_by":(0,k.t1)(t),pe.wd({action:a,original_view_type:void 0,property_type:e?"relation":void 0,environment:r,collectionContextStore:o})}),[o,r,i,t,c]),handleDefaultPropertySelect:f,handleAddRelation:S,getProperties:g}}function $e(e){const{feature:t,collectionContextStore:o}=e;let n,i;var r,a;if("subitem"===t)n=null===(r=o.currentSubitemFormatStore.state)||void 0===r?void 0:r.property,i=null===(a=o.collectionStore())||void 0===a?void 0:a.getFormatStore().getKeyStore("collection_default_subitem").getValue();else if("timeline_arrows_by"===t){var l;n=o.currentArrowsByFormatStore.state,i=null===(l=o.collectionStore())||void 0===l?void 0:l.getFormatStore().getKeyStore("collection_default_arrows_by").getValue()}else(0,k.t1)(t);const s=o.normalizedSchemaStore.state,c=A.NA(o,s);(0,k.$K)(n)&&!c.includes(n)&&(n=void 0),(0,k.$K)(i)&&!c.includes(i)&&(i=void 0);const d=n??i;if(d)return{property:d,isDefault:d===i,enabledOnView:Boolean(n),enabledOnCollection:Boolean(i),supportedInView:lt({feature:t,viewType:o.getViewType()})}}function qe(e){const{feature:t,collectionContextStore:o}=e;return(0,w.VK)((()=>$e({feature:t,collectionContextStore:o})),[o,t])}function je(e){window.__c={n:"RelationPropertyPicker"};const{currentPropertyId:t,feature:o,collectionContextStore:n,collectionSettingsStore:r,permissionScopes:a,onPropertySelect:s,buttonPopupStore:c}=e,u=(0,d.useIntl)(),p=(0,w.VK)((()=>{var e,t;return"subitem"===o?null===(e=n.collectionStore())||void 0===e||null===(e=e.getFormat())||void 0===e?void 0:e.collection_default_subitem:"timeline_arrows_by"===o?null===(t=n.collectionStore())||void 0===t||null===(t=t.getFormat())||void 0===t?void 0:t.collection_default_arrows_by:void(0,k.t1)(o)}),[o,n]),g=(0,w.VK)((()=>n.databaseType),[n]),{handleDefaultPropertySelect:m,handlePropertySelect:y,getProperties:S}=He({collectionContextStore:n,collectionSettingsStore:r,feature:o,onPropertySelect:s});return i()(Qe,{intl:u,icon:_.Z.typesRelation,caption:l.createElement(d.FormattedMessage,(0,P.g3)({feature:o,databaseType:g})),collectionContextStore:n,buttonPopupStore:c,shouldGroupProperties:!0,getGroupedProperties:S,currentProperty:t,onAccept:a.canConfigureBlock&&a.canConfigureCollection?y:()=>{},renderProperty:(e,t,r,a)=>i()(_e,{version:"v2",feature:o,menuProps:e,property:t,defaultProperty:p,checkState:r,propertySchema:a,collectionContextStore:n,handleDefaultPropertySelect:m,handlePropertySelect:y})})}function Ye(e){window.__c={n:"DatePropertyPicker"};const{currentPropertyId:t,collectionContextStore:o,onPropertyChanged:n,disabled:r,title:a}=e,s=(0,d.useIntl)(),c=(0,w.qz)(void 0,V.Z),u=(0,w.VK)((()=>o.normalizedSchemaStore.state),[o]),p=(0,l.useCallback)((()=>Object.keys(u).filter((e=>{const t=u[e];return"date"===(null==t?void 0:t.type)})).filter(k.$K)),[u]);return i()(Qe,{intl:s,buttonPopupStore:c,title:a,collectionContextStore:o,shouldGroupProperties:!1,getProperties:p,currentProperty:t,disabled:r,onAccept:e=>{e&&n(e),c.setState({open:!1})}})}function Qe(e){window.__c={n:"PopupPropertyPicker"};const{currentProperty:t,icon:o,caption:n,buttonPopupStore:r,collectionContextStore:s,disabled:c,title:u,shouldGroupProperties:p}=e,g=(0,C.Fy)(),m=(0,w.VK)((()=>{var e;return(null===(e=s.collectionStore())||void 0===e?void 0:e.getFormat())??{}}),[s]),y=(0,w.VK)((()=>s.normalizedSchemaStore.state),[s]),S=(0,M.yK)((e=>({caption:{fontSize:g.isMobile?x.Z.fontSize.UISmall.mobile:x.Z.fontSize.UISmall.desktop,color:e.mediumTextColor,margin:"0 12px 28px 12px"}})),[g]),f=(0,w.VK)((()=>r.state.open),[r]),h=(0,w.VK)((()=>g.isPhone?{menuType:ve.og.ActionSheet}:{menuType:ve.og.Popup,width:300}),[g.isPhone]);return l.createElement(l.Fragment,null,n&&i()("div",{style:S.caption},void 0,n),i()(Ce.ZP,{popupType:g.isPhone?We.kQ.SlideUp:We.kQ.Popup,alignmentToOrigin:Ce.vR.End,placementToOrigin:Ce.pO.Bottom,disabled:c,originGap:0,renderOrigin:e=>{var n;return l.createElement(I.Z,a()({title:u??i()(d.FormattedMessage,{id:"database.viewSettings.relationFeatures.propertyPicker.default.title",defaultMessage:"Property"}),showChevron:!0,right:t?i()("span",{style:x.Z.textOverflowStyle},void 0,null===(n=y[t])||void 0===n?void 0:n.name):void 0,rightStyle:{flexShrink:1},textWrapperStyle:{flexShrink:0},rotateChevron:f,disabled:c,icon:o},e))},render:t=>l.createElement(we.Z,h,p?l.createElement(Ne,a()({},e,{getGroupedProperties:e.getGroupedProperties,format:m,schema:y})):l.createElement(be.Z,a()({},e,{getProperties:e.getProperties,format:m,schema:y}))),buttonPopupStore:r}))}function Xe(e){var t;window.__c={n:"DateShiftingConfigSection"};const{currentConfig:o,onConfigChange:n,disabled:r,collectionContextStore:a}=e,s=(0,w.VK)((()=>a.databaseType),[a]),c=(0,C.O7)(),u=null===(t=o.configWithoutDates)||void 0===t?void 0:t.mode,[p,g]=(0,l.useState)(!(0,k.$K)(o.configWithoutDates)||Boolean(o.configWithoutDates.avoid_weekends)),m=(0,k.$K)(o.configWithoutDates)?Boolean(o.configWithoutDates.avoid_weekends):p;(0,l.useEffect)((()=>{if((0,k.$K)(o.configWithoutDates)){const e=Boolean(o.configWithoutDates.avoid_weekends);e!==p&&g(e)}}),[o,p]);const y=(0,l.useCallback)((e=>{(0,k.$K)(o.configWithoutDates)&&(n({...o,configWithoutDates:{...o.configWithoutDates,avoid_weekends:e}}),pe.wd({environment:c,collectionContextStore:a,action:"update_dependency_date_shift_avoid_weekends",new_avoid_weekends:e}))}),[a,o,c,n]),S=(0,l.useCallback)((e=>{(0,k.$K)(e)?n({...o,configWithoutDates:{...o.configWithoutDates,mode:e,avoid_weekends:p}}):n({...o,configWithoutDates:void 0}),pe.wd({environment:c,collectionContextStore:a,action:"update_dependency_date_shift_mode",new_date_shift_mode:e??"none"})}),[a,o,c,p,n]);return l.createElement(l.Fragment,null,i()(E.Z,{title:l.createElement(d.FormattedMessage,P.dH.dateShiftingSectionCaption),disableMobileBorders:!0},void 0,i()(ne,{mode:u})),i()(E.Z,{disableMobileBorders:!0},void 0,i()(it,{currentMode:u,onModeChange:S,databaseType:s,disabled:r})),i()(E.Z,{},void 0,i()(nt,{currentValue:m,databaseType:s,onChange:y,disabled:r||!(0,k.$K)(o.configWithoutDates)}),l.createElement(Je,e)))}function Je(e){window.__c={n:"DatePropertiesConfigSection"};const{collectionContextStore:t,currentConfig:o,onConfigChange:n,disabled:r}=e,a=(0,w.VK)((()=>{const e=t.normalizedSchemaStore.state;return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,ce.Lt)(o)}))}),[t]),s=a.length,c=o.datePropertyId?a.find((e=>e!==o.datePropertyId)):void 0,u="string"==typeof o.datePropertyId&&(0,k.$K)(o.endDatePropertyId),p=(0,l.useCallback)(((e,t)=>{const i={[e]:t};if(u&&(0,k.$K)(o.datePropertyId)){const n="datePropertyId"===e?"endDatePropertyId":"datePropertyId";o[n]===t&&(i[n]=a.find((e=>e!==t)))}n({...o,...i})}),[o,a,n,u]);return!(0,k.$K)(o.configWithoutDates)||s<=1?null:l.createElement(l.Fragment,null,i()(Ye,{collectionContextStore:t,currentPropertyId:o.datePropertyId,title:u?l.createElement(d.FormattedMessage,P.dH.startDate):l.createElement(d.FormattedMessage,P.dH.datePropertyPickerTitle),onPropertyChanged:e=>p("datePropertyId",e),disabled:r}),(0,k.$K)(c)&&"string"==typeof o.datePropertyId&&l.createElement(l.Fragment,null,(0,k.$K)(o.endDatePropertyId)&&i()(Ye,{collectionContextStore:t,currentPropertyId:o.endDatePropertyId,title:l.createElement(d.FormattedMessage,P.dH.endDate),onPropertyChanged:e=>p("endDatePropertyId",e),disabled:r}),i()(he.Z,{title:i()(d.FormattedMessage,{id:"database.viewSettings.relationFeatures.datePropertyPicker.separateStartEnd",defaultMessage:"Separate start and end dates"}),focused:!1,on:u,disabled:r,disabledFeedback:!0,onClick:()=>{n({...o,endDatePropertyId:u?void 0:c})}})))}function et(e){const{collectionSettingsStore:t,feature:o,permissionScopes:n}=e,r=!n.canConfigureCollection&&!n.canConfigureBlock;return i()(I.Z,{icon:_.Z.settings,showChevron:!0,disabled:r,title:l.createElement(d.FormattedMessage,P.dH.advancedSettings),onClick:()=>{p.H4({collectionSettingsStore:t,item:{type:"relationFeaturesAdvancedSettings",feature:o}})}})}function tt(e){window.__c={n:"TurnOnFeatureButton"};const{feature:t,handleAddRelation:o,databaseType:n,permissionScopes:r}=e,a=(0,M.yK)((e=>({button:{width:"100%"},buttonWrap:{margin:"0px 12px"}})),[]);return r.canConfigureBlock&&r.canConfigureCollection?i()(E.Z,{disableMobileBorders:!0},void 0,i()("div",{style:a.buttonWrap},void 0,i()(fe.Z,{style:a.button,onClick:o,isLarge:!0},void 0,l.createElement(d.FormattedMessage,(0,P.Tq)({feature:t,databaseType:n}))))):null}function ot(e){window.__c={n:"TurnOffFeatureMenuItem"};const{feature:t,permissionScopes:o,propertyName:n,relationPropertyId:r,inversePropertyName:s,collectionContextStore:c,collectionSettingsStore:u,handleDefaultPropertySelect:g,databaseType:y}=e,S=(0,C.O7)(),f=(0,M.yK)((e=>({modalTitle:{fontWeight:x.Z.fontWeight.semibold,fontSize:18},modalInnerStyle:{textAlign:"center"},modalPropertyName:{color:e.darkTextColor,fontWeight:x.Z.fontWeight.semibold}})),[]);return o.canConfigureCollection&&o.canConfigureBlock&&n&&s?i()(I.Z,{icon:_.Z.trash,title:l.createElement(d.FormattedMessage,(0,P.nB)({feature:t,databaseType:y})),isRed:!0,onClick:()=>{ye.showDialog({description:l.createElement(d.FormattedMessage,a()({},P.dH.turnOffFeatureDeletedProperties,{values:{span:e=>i()("span",{style:f.modalPropertyName},void 0,e),propertyName:n,inversePropertyName:s}})),message:i()("div",{style:f.modalTitle},void 0,l.createElement(d.FormattedMessage,(0,P.OH)({feature:t,databaseType:y}))),innerStyle:f.modalInnerStyle,showCancel:!0,keepFocus:!0,items:[{label:l.createElement(d.FormattedMessage,P.dH.turnOffAndDelete),color:"red",onAccept:async()=>{r&&(await async function(e){const{environment:t,collectionContextStore:o,propertyId:n,feature:i}=e,r=o.normalizedSchemaStore.state,a=o.collectionStore();if(!a)return;await m.createAndCommitAsync({environment:t,userAction:"CollectionSettingsViewRelationFeatures.handleTurnOffFeatureAndDeleteAccept",waitForServerCommit:!1,perform:e=>ge.yV({environment:t,collectionStore:a,schema:r,property:n,transaction:e})});const l=r[n];l&&pe.y9({environment:t,collectionContextStore:o,property_type:l.type,from:i,property:n})}({environment:S,propertyId:r,collectionContextStore:c,feature:t}),g(void 0),p.wl({collectionSettingsStore:u,item:{type:"main"}}))}}]})}}):null}function nt(e){const{currentValue:t,onChange:o,disabled:n,databaseType:r}=e;return i()(he.Z,{title:l.createElement(d.FormattedMessage,P.dH.avoidWeekendsSwitcherTitle),caption:l.createElement(d.FormattedMessage,(0,P.Bq)(r)),shouldWrapCaption:!0,shouldWrapTitle:!0,focused:!1,on:t,disabled:n,disabledFeedback:!0,onClick:()=>o(!t)})}function it(e){window.__c={n:"DateShiftModeSelect"};const{currentMode:t,onModeChange:o,disabled:n,databaseType:r}=e,a=(0,M.yK)((e=>({wrap:{display:"flex",flexDirection:"column",rowGap:8,marginLeft:12,marginRight:12}})),[]);return i()("div",{style:a.wrap},void 0,[...de.Bp,void 0].map((e=>i()(rt,{dateShiftingMode:e,databaseType:r,onClick:()=>o(e),active:e===t,disabled:n},e??"none"))))}function rt(e){window.__c={n:"DateShiftButton"};const{dateShiftingMode:t,onClick:o,active:n,disabled:r,databaseType:a}=e,s=(0,C.Fy)(),c=(0,M.yK)((e=>({buttonStyles:{fontSize:s.isMobile?x.Z.fontSize.UISmall.mobile:x.Z.fontSize.UISmall.desktop,fontWeight:x.Z.fontWeight.medium,borderRadius:3,width:"100%",padding:"8px 8px",boxShadow:`0 0 0 1px ${e.regularDividerColor}`,color:e.darkTextColor,fill:e.mediumTextColor,...n&&{boxShadow:`0 0 0 2px ${e.blueColor}`,color:e.blueColor,fill:e.blueColor},...r&&{opacity:.65}},icon:{width:20,height:20,marginRight:6},buttonContentWrap:{display:"flex",alignItems:"center"}})),[n,s,r]),{title:u,icon:p}=(0,P.lo)({dateShiftingMode:t,databaseType:a});return i()(B.Z,{style:c.buttonStyles,onClick:o,disabled:r},void 0,i()("div",{style:c.buttonContentWrap},void 0,i()("div",{},void 0,p(c.icon)),i()("div",{},void 0,l.createElement(d.FormattedMessage,u))))}function at(e){const{environment:t,newConfig:o,collectionStore:n,transaction:i,intl:r}=e;let a;if((0,k.$K)(o.configWithoutDates))if(o.datePropertyId)a={...o.configWithoutDates,date_property:o.datePropertyId,end_date_property:o.endDatePropertyId};else{const e=(0,ue.ZP)(),l={name:r.formatMessage(P.dH.newDateProperty),type:"date"};me.xO({environment:t,collectionStore:n,update:{[e]:l},transaction:i}),a={...o.configWithoutDates,date_property:e,end_date_property:void 0}}Se.sW({store:n.getFormatStore(),data:{dependency_date_shifting_config:a??null},transaction:i})}function lt(e){const{viewType:t,feature:o}=e;return"timeline_arrows_by"===o?"timeline"===t:"subitem"===o||void(0,k.t1)(o)}function st(e){window.__c={n:"CollectionSettingsViewRelationFeatures"};const{collectionContextStore:t,collectionSettingsStore:o,feature:n}=e,r=(0,d.useIntl)(),s=(0,C.Fy)(),c=(0,w.VK)((()=>t.normalizedSchemaStore.state),[t]),u=(0,w.VK)((()=>t.databaseType),[t]),p=(0,w.VK)((()=>t.collectionStore()),[t]),g=qe({collectionContextStore:t,feature:n}),m=null==g?void 0:g.property,y=(0,l.useMemo)((()=>T.HI(c)),[c]),S=(0,w.VK)((()=>t.permissionScopes.state),[t]),f=(0,w.VK)((()=>{var e;return m&&(null===(e=c[m])||void 0===e?void 0:e.name)}),[c,m]),h=(0,w.VK)((()=>{const e=m&&c[m];if(e&&"relation"===e.type){var t;const o=e.property;return o?null===(t=c[o])||void 0===t?void 0:t.name:void 0}}),[m,c]),v=(0,w.VK)((()=>{const e=t.collectionStore();return null!=e&&e.isDefined()?A.aI(r,{sourceCollection:e.getModel(),isSelfRelation:!0,targetCollectionStore:e,createUnique:!0,from:n}):r.formatMessage({id:"database.viewSettings.relationsPropertyTab.inverseName.placeholder",defaultMessage:"Related to this database"})}),[t,r,n]),b=(0,w.VK)((()=>Boolean(p&&function(e){const{collectionContextStore:t,collectionStore:o}=e,n=o.getFormat().collection_default_arrows_by,i=t.currentArrowsByFormatStore.state;return!(0,k.$K)(i)||i===n}({collectionContextStore:t,collectionStore:p}))),[t,p]),_=(0,w.qz)(void 0,V.Z),I=(0,l.useCallback)((e=>{e&&_.setState({open:!1})}),[_]),{initialPropertyName:B}=Ue({collectionContextStore:t,feature:n}),Z=He({collectionContextStore:t,collectionSettingsStore:o,onPropertySelect:I,feature:n}),{handleAddRelation:D,handleDefaultPropertySelect:K}=Z,R=(0,M.yK)((e=>({container:{marginLeft:12,marginRight:12},captionText:{fontSize:s.isMobile?x.Z.fontSize.UISmall.mobile:x.Z.fontSize.UISmall.desktop,color:e.mediumTextColor,fontWeight:x.Z.fontWeight.regular}})),[s]);if(!p)return null;let O;return"subitem"===n?O=g?i()(E.Z,{disableMobileBorders:!0},void 0,i()(et,{collectionSettingsStore:o,feature:n,permissionScopes:S}),i()(pt,{feature:n,databaseType:u,featuredRelationProperty:g,actions:Z,permissionScopes:S}),i()(ot,{feature:n,databaseType:u,permissionScopes:S,propertyName:f,relationPropertyId:m,collectionContextStore:t,collectionSettingsStore:o,handleDefaultPropertySelect:K,inversePropertyName:h})):l.createElement(l.Fragment,null,i()(N,{propertyName:f||B,inversePropertyName:h||v,newDesign:!0}),i()(tt,{feature:n,permissionScopes:S,databaseType:u,handleAddRelation:()=>{D({featureType:"subitem"})}})):"timeline_arrows_by"===n?O=g?l.createElement(l.Fragment,null,b?i()(dt,{collectionContextStore:t,firstDatePropertyId:y,permissionScopes:S}):i()(ct,{collectionContextStore:t,databaseType:u}),i()(E.Z,{topBorder:!0},void 0,i()(et,{collectionSettingsStore:o,feature:n,permissionScopes:S}),i()(pt,{feature:n,databaseType:u,featuredRelationProperty:g,actions:Z,permissionScopes:S}),i()(ot,{feature:n,databaseType:u,permissionScopes:S,relationPropertyId:m,propertyName:f,inversePropertyName:h,collectionContextStore:t,collectionSettingsStore:o,handleDefaultPropertySelect:K}))):i()(ut,{databaseType:u,collectionContextStore:t,firstDatePropertyId:y,handleAddRelation:D,permissionScopes:S}):(0,k.t1)(n),l.createElement(F.ZP,a()({},e,{title:l.createElement(d.FormattedMessage,(0,P.Gt)({feature:n,databaseType:u}))}),i()(E.Z,{disableMobileBorders:!0},void 0,i()("div",{style:{...R.container,...R.captionText}},void 0,l.createElement(d.FormattedMessage,(0,P.qi)({feature:n,databaseType:u})))),O)}function ct(e){window.__c={n:"DateShiftingNotApplicableToThisViewMessage"};const{collectionContextStore:t,databaseType:o}=e,n=(0,C.MO)(),r=(0,M.yK)((e=>({wrap:{boxShadow:e.plainButtonBoxShadow,...n?{backgroundColor:e.sidebarBackground,margin:void 0,borderRadius:void 0}:{background:"rgba(196, 196, 196, 0.13)",marginTop:14,marginBottom:20}},iconWithMessage:{display:"flex",gap:8},icon:{width:14,height:14,position:"relative",top:1,color:e.mediumTextColor}})),[n]),a=(0,w.VK)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.getNormalizedDependencyDateShiftingConfig()}),[t]);return l.createElement(l.Fragment,null,i()(E.Z,{title:l.createElement(d.FormattedMessage,P.dH.dateShiftingSectionCaption)},void 0,i()(ne,{mode:null==a?void 0:a.mode})),i()(Z,{style:r.wrap,showCloseButton:!1},void 0,i()("div",{style:r.iconWithMessage},void 0,_.Z.info(r.icon),i()(D.Z,{isSmall:!0,isMultiline:!0},void 0,l.createElement(d.FormattedMessage,(0,P.uM)({currentDateShiftConfig:a,databaseType:o}))))))}function dt(e){window.__c={n:"FeatureEnabledDependenciesSection"};const{collectionContextStore:t,firstDatePropertyId:o,permissionScopes:n}=e,r=(0,C.O7)(),a=(0,d.useIntl)(),s=(0,w.VK)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.getNormalizedDependencyDateShiftingConfig()}),[t]),c=(0,l.useCallback)((e=>{const o=t.collectionStore();o&&m.createAndCommit({userAction:"FeatureEnabledDependenciesSection.handleConfigChange",environment:r,perform:t=>{at({collectionStore:o,environment:r,intl:a,newConfig:e,transaction:t})}})}),[t,r,a]),u=(0,l.useMemo)((()=>({configWithoutDates:s,...s?{datePropertyId:s.date_property,endDatePropertyId:s.end_date_property}:{datePropertyId:o}})),[s,o]);return i()(Xe,{collectionContextStore:t,currentConfig:u,disabled:!n.canConfigureBlock||!n.canConfigureCollection,onConfigChange:c})}function ut(e){window.__c={n:"FeatureDisabledDependenciesSection"};const{collectionContextStore:t,handleAddRelation:o,firstDatePropertyId:n,permissionScopes:r,databaseType:a}=e,[s,c]=(0,l.useState)({datePropertyId:n,configWithoutDates:{mode:"consume_gap",avoid_weekends:true}});return l.createElement(l.Fragment,null,i()(Xe,{collectionContextStore:t,currentConfig:s,disabled:!r.canConfigureBlock||!r.canConfigureCollection,onConfigChange:c}),i()(tt,{feature:"timeline_arrows_by",permissionScopes:r,databaseType:a,handleAddRelation:()=>{o({featureType:"timeline_arrows_by",dateShiftingConfig:s})}}))}function pt(e){window.__c={n:"ToggleViewVisibilityMenuItem"};const{feature:t,featuredRelationProperty:o,actions:n,permissionScopes:i,databaseType:r}=e,s=(0,C.Fy)(),c=(0,M.yK)((()=>({eyeHideIcon:{width:20,height:s.isMobile?24:12,marginLeft:3}})),[s]);if(!o.supportedInView)return null;const u=o.enabledOnView,p=u?{icon:_.Z.eyeHide,iconStyle:c.eyeHideIcon}:{icon:_.Z.eye};return l.createElement(I.Z,a()({},p,{onClick:()=>{n.handlePropertySelect(u?void 0:o.property)},title:l.createElement(d.FormattedMessage,(0,P.cn)({feature:t,isOn:u,databaseType:r})),disabled:!i.canConfigureBlock}))}var gt=o(41892),mt=o(80402),yt=o(24006),St=o(58032),ft=o(60442);function ht(e){const{render:t,showImage:o,caption:n,tooltipImage:r}=e,a=e.tooltipImageScale||1,[s,c]=l.useState(!1),[d,u]=l.useState({width:0,height:0});return l.useEffect((()=>{if(r){const e=new Image;e.src=r,e.onload=()=>{u({width:e.width*a,height:e.height*a}),c(!0)}}}),[r,a]),i()(St.Z,{placement:St.Z.Placement.Left,disableTooltip:void 0===n,style:{whiteSpace:"break-spaces"},render:t,renderTooltip:()=>r&&s&&o?i()(ft.Z,{caption:n,imageURL:r,imageWidth:d.width,imageHeight:d.height}):i()("div",{},void 0,n)})}const vt="box1-filter",bt="box2-filter";function Ct(e){window.__c={n:"CollectionSettingsViewDependenciesPreview2"};const{propertyName:t,inversePropertyName:o}=e,n=(0,M.Fg)(),r=(0,M.yK)((e=>({svgWrap:{margin:"0px 12px",border:`1px solid ${e.regularDividerColor}`,borderRadius:4,alignItems:"center",position:"relative",height:112,backgroundColor:e.accentColors.gray[30],display:"flex",justifyContent:"center"}})),[]);return i()(E.Z,{disableMobileBorders:!0},void 0,i()("div",{style:r.svgWrap},void 0,i()("svg",{width:"266",height:"116",fill:"none"},void 0,i()("path",{stroke:"#DFAF49",strokeWidth:"2",d:"M124 20h.426c7.703 0 17.307-.002 25.029 1.93 3.979.994 8.078 2.638 11.248 5.575C164.082 30.635 166 34.868 166 40c0 8.001-6.095 12.917-11.524 15.932-5.553 3.086-12.74 5.481-19.23 7.644l-.349.116c-6.919 2.307-13.074 4.381-17.546 6.866C112.655 73.166 112 75 112 76c0 1.868.582 2.885 1.453 3.692 1.08 1.001 2.981 1.982 6.002 2.737C125.59 83.963 132.773 84 141 84"}),i()("path",{stroke:"#E3E2E0",strokeWidth:"2",d:"M125 32c8.227 0 15.41.037 21.545 1.57 3.021.756 4.922 1.737 6.002 2.738.871.807 1.453 1.824 1.453 3.692 0 .999-.655 2.834-5.351 5.443-4.472 2.484-10.627 4.558-17.546 6.865l-.349.116c-6.49 2.163-13.677 4.558-19.23 7.644C106.095 63.084 100 67.998 100 76c0 5.132 1.918 9.365 5.297 12.495 3.17 2.937 7.269 4.581 11.248 5.576C124.267 96 133.871 96 141.574 96H142"}),i()("path",{fill:n.accentColors.gray[30],d:"M157 27h16v18h-16zM92 70h16v18H92z"}),i()("path",{stroke:"#DFAF49",strokeWidth:"2",d:"M136 88l5-4-5-4"}),i()("path",{stroke:"#E3E2E0",strokeWidth:"2",d:"M130 36l-5-4 5-4"}),i()("g",{filter:"url(#box1-filter)"},void 0,i()("rect",{width:"100",height:"28",x:"24",y:"12",fill:n.buttonBackground,rx:"3"}),i()("text",{x:"67",y:"31",fill:"#000"},void 0,"üå±")),i()("g",{filter:"url(#box2-filter)"},void 0,i()("rect",{width:"100",height:"28",x:"142",y:"76",fill:n.buttonBackground,rx:"3"}),i()("text",{x:"185",y:"95",fill:"#000"},void 0,"üå≥")),i()(wt,{x:"161",y:"26",width:"100",height:"16",textStyles:{fontSize:12,fontWeight:590,color:n.regularTextColor}},void 0,t),i()(wt,{x:"15",y:"69",width:"90",height:"16",textStyles:{color:n.lightTextColor,fontSize:12,fontWeight:500,textAlign:"right"}},void 0,o),i()("defs",{},void 0,i()("filter",{id:vt,width:"108",height:"36",x:"20",y:"10",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse"},void 0,i()("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),i()("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),i()("feMorphology",{in:"SourceAlpha",operator:"dilate",radius:"1",result:"effect1_dropShadow_1034_52436"}),i()("feOffset",{}),i()("feComposite",{in2:"hardAlpha",operator:"out"}),i()("feColorMatrix",{values:"0 0 0 0 0.0707 0 0 0 0 0.0693 0 0 0 0 0.0693 0 0 0 0.1 0"}),i()("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_1034_52436"}),i()("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),i()("feOffset",{dy:"2"}),i()("feGaussianBlur",{stdDeviation:"2"}),i()("feComposite",{in2:"hardAlpha",operator:"out"}),i()("feColorMatrix",{values:"0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0.1 0"}),i()("feBlend",{in2:"effect1_dropShadow_1034_52436",result:"effect2_dropShadow_1034_52436"}),i()("feBlend",{in:"SourceGraphic",in2:"effect2_dropShadow_1034_52436",result:"shape"})),i()("filter",{id:bt,width:"108",height:"36",x:"138",y:"74",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse"},void 0,i()("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),i()("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),i()("feMorphology",{in:"SourceAlpha",operator:"dilate",radius:"1",result:"effect1_dropShadow_1034_52436"}),i()("feOffset",{}),i()("feComposite",{in2:"hardAlpha",operator:"out"}),i()("feColorMatrix",{values:"0 0 0 0 0.0707 0 0 0 0 0.0693 0 0 0 0 0.0693 0 0 0 0.1 0"}),i()("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_1034_52436"}),i()("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),i()("feOffset",{dy:"2"}),i()("feGaussianBlur",{stdDeviation:"2"}),i()("feComposite",{in2:"hardAlpha",operator:"out"}),i()("feColorMatrix",{values:"0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0.1 0"}),i()("feBlend",{in2:"effect1_dropShadow_1034_52436",result:"effect2_dropShadow_1034_52436"}),i()("feBlend",{in:"SourceGraphic",in2:"effect2_dropShadow_1034_52436",result:"shape"}))))))}function wt(e){const{children:t,textStyles:o,...n}=e;return l.createElement("foreignObject",n,i()("div",{style:{...x.Z.textOverflowStyle,...n.width?{width:Number(n.width)}:{},...o}},void 0,t))}function Mt(e){var t;window.__c={n:"CollectionSettingsDependenciesAdvancedSettings"};const{collectionContextStore:o,collectionSettingsStore:n,feature:r}=e,s=(0,d.useIntl)(),c=(0,w.VK)((()=>o.collectionStore()),[o]),u=(0,w.VK)((()=>o.normalizedSchemaStore.state),[o]),p=(0,w.VK)((()=>o.permissionScopes.state),[o]),g=null===(t=qe({collectionContextStore:o,feature:r}))||void 0===t?void 0:t.property,m=(0,w.VK)((()=>{var e;return g&&(null===(e=u[g])||void 0===e?void 0:e.name)}),[g,u]),y=(0,w.VK)((()=>{const e=g&&u[g];if(e&&"relation"===e.type){var t;const o=e.property;return o?null===(t=u[o])||void 0===t?void 0:t.name:void 0}}),[g,u]),S=(0,w.VK)((()=>{const e=o.collectionStore();return null!=e&&e.isDefined()?A.aI(s,{sourceCollection:e.getModel(),isSelfRelation:!0,targetCollectionStore:e,createUnique:!0,from:r}):s.formatMessage({id:"database.viewSettings.relationsPropertyTab.inverseName.placeholder",defaultMessage:"Related to this database"})}),[o,s,r]),f=(0,w.qz)(void 0,V.Z),{initialPropertyName:h}=Ue({collectionContextStore:o,feature:r}),v=(0,l.useCallback)((e=>{e&&f.setState({open:!1})}),[f]);if(!c)return null;let b;return"subitem"===r?b=i()(N,{propertyName:m||h,inversePropertyName:y||S,newDesign:!0}):"timeline_arrows_by"===r?b=i()(Ct,{propertyName:m||h,inversePropertyName:y||S}):(0,k.t1)(r),l.createElement(F.ZP,a()({},e,{title:l.createElement(d.FormattedMessage,P.dH.advancedSettings)}),b,i()(E.Z,{disableMobileBorders:!0},void 0,i()(je,{currentPropertyId:g,feature:r,onPropertySelect:v,buttonPopupStore:f,collectionContextStore:o,collectionSettingsStore:n,permissionScopes:p}),"subitem"===r&&i()(_t,{collectionContextStore:o,permissionScopes:p})))}function _t(e){window.__c={n:"ToggleNestingOnTitleMenuItem"};const{collectionContextStore:t,permissionScopes:o}=e,n=(0,d.useIntl)(),r=(0,C.O7)(),s=(0,w.VK)((()=>"title"===t.normalizedFormatStore.state.table_subitem_toggle_column),[t]),c=!o.canConfigureBlock,u=(0,l.useCallback)((()=>{const e=t.collectionViewStore();e&&(mt.d1({environment:r,collectionViewStore:e,currentValue:t.normalizedFormatStore.state.table_subitem_toggle_column}),pe.wd({environment:r,collectionContextStore:t,action:"toggle_table_subitem_toggle_on_title"}))}),[t,r]);return i()(ht,{showImage:o.canConfigureBlock,caption:n.formatMessage(P.dH.toggleNestingOnTitleMenuItemTooltip),tooltipImage:gt.Z.images.tooltips.collectionSettings.subitemsToggleOnTitlePng,tooltipImageScale:.3,render:e=>l.createElement(I.Z,a()({},e,{icon:e=>_.Z.triangle({width:11,height:11,marginRight:5,marginLeft:6,transform:"rotateZ(180deg)"}),onClick:u,title:i()(d.FormattedMessage,{defaultMessage:"Show nesting toggle on title",id:"database.viewSettings.layoutTab.tableSubitemToggleOnTitle"}),right:i()(yt.Z,{disallowTabbing:!0,on:s,disabled:c,onClick:u}),disabled:c}))})}var kt=o(1302),xt=o(93959),Tt=o(80072),Pt=o(89728);function At(e){window.__c={n:"CollectionSettingsViewDependenciesPreview"};const{propertyName:t}=e,o=(0,M.Fg)(),n=(0,M.yK)((e=>({dependenciesPreviewOutsideBorder:{margin:"0px 12px",border:`1px solid ${e.regularDividerColor}`,borderRadius:4,alignItems:"center",position:"relative",height:112,paddingLeft:19},svgContainer:{position:"absolute",width:"100%",height:"100%"},svgArrowTheme:{stroke:e.collectionValidDependencyArrow,strokeWidth:G.lf},dependencyPropertyNamePreview:{fontSize:12,position:"absolute",background:e.buttonBackground,top:48,left:96},timelineItemPreview:{padding:4,margin:"0px 12px",display:"flex",fontSize:14,alignItems:"center",borderRadius:5,background:e.cardBackground,boxShadow:e.buttonBoxShadow,width:100,justifyContent:"center"}})),[]);return l.createElement(l.Fragment,null,i()(E.Z,{},void 0,i()("div",{style:n.dependenciesPreviewOutsideBorder},void 0,i()("svg",{style:n.svgContainer},void 0,i()(Y.Z,{startPoint:{x:110,y:25},endPoint:{x:110,y:87},style:n.svgArrowTheme,showArrowHead:!0}),i()(Y.Z,{startPoint:{x:210,y:87},endPoint:{x:223,y:87},style:n.svgArrowTheme,showArrowHead:!1}),i()("circle",{cx:223,cy:87,r:G.Wk,style:n.svgArrowTheme,fill:o.white})),i()("div",{style:n.dependencyPropertyNamePreview},void 0,t),i()("div",{style:{...n.timelineItemPreview,marginTop:10,marginLeft:10}},void 0,i()("span",{},void 0,"üå±")),i()("div",{style:{...n.timelineItemPreview,marginTop:34,marginLeft:111}},void 0,i()("span",{},void 0,"üå≥")))))}const Vt=(0,d.defineMessages)({subitemInputPlaceholder:{defaultMessage:"Sub-tasks‚Ä¶",id:"database.viewSettings.relationsPropertyTab.subitemInputPlaceholder"},timelineArrowsByInputPlaceholder:{defaultMessage:"Dependencies‚Ä¶",id:"database.viewSettings.relationsPropertyTab.timelineArrowsByInputPlaceholder"}});const Ft=(0,d.injectIntl)((function(e,t){window.__c={n:"CollectionSettingsViewRelationsProperty"};const{collectionContextStore:o,collectionSettingsStore:n,formatSetting:r}=e,s=(0,C.Fy)(),c=(0,d.useIntl)(),u=(0,C.O7)(),y="collection_page_properties",[S]=(0,l.useState)("no_limit"),f="subitem"===r,h="timeline_arrows_by"===r,v=(0,w.VK)((()=>o.normalizedSchemaStore.state),[o]),b=(0,w.VK)((()=>o.collectionStore()),[o]),k=(0,w.VK)((()=>(null==b?void 0:b.getFormat())??{}),[b]),x=(0,w.VK)((()=>{var e;return f?null===(e=o.currentSubitemFormatStore.state)||void 0===e?void 0:e.property:h?o.currentArrowsByFormatStore.state:void 0}),[o,f,h]),T=(0,w.VK)((()=>{var e,t;return f?null===(e=o.collectionStore())||void 0===e||null===(e=e.getFormat())||void 0===e?void 0:e.collection_default_subitem:h?null===(t=o.collectionStore())||void 0===t||null===(t=t.getFormat())||void 0===t?void 0:t.collection_default_arrows_by:void 0}),[o,f,h]),B=(0,w.VK)((()=>o.permissionScopes.state),[o]),Z=(0,w.VK)((()=>A.NA(o,v)),[o,v]),D=(0,w.VK)((()=>o.normalizedSchemaStore.state),[o]),K=(0,w.VK)((()=>{var e;const t=o.currentSubitemFormatStore.state,n=o.currentArrowsByFormatStore.state;let i;return f?i=t?v[t.property]:void 0:h&&(i=n?v[n]:void 0),null===(e=i)||void 0===e?void 0:e.name}),[o,v,f,h]),O=(0,w.VK)((()=>{const e=o.collectionStore();return null!=e&&e.isDefined()?A.m8(c,{targetCollectionStore:e,isSelfRelation:!0,sourceSchema:D,createUnique:!0,from:r}):c.formatMessage({id:"database.viewSettings.relationsPropertyTab.initialPropertyName.placeholder",defaultMessage:"Related to target"})}),[o,D,c,r]),[W,G]=(0,l.useState)(K||O),L=W===O,z=(0,w.VK)((()=>{const e=o.currentSubitemFormatStore.state,t=o.currentArrowsByFormatStore.state;let n;if(f?n=e?v[e.property]:void 0:h&&(n=t?v[t]:void 0),n&&"relation"===n.type){var i;const e=n.property;return e?null===(i=v[e])||void 0===i?void 0:i.name:void 0}}),[o,v,f,h]),U=(0,w.VK)((()=>{const e=o.collectionStore();return null!=e&&e.isDefined()?A.aI(c,{sourceCollection:e.getModel(),isSelfRelation:!0,targetCollectionStore:e,createUnique:!0,from:r}):c.formatMessage({id:"database.viewSettings.relationsPropertyTab.inverseName.placeholder",defaultMessage:"Related to this database"})}),[o,c,r]),H=(0,w.VK)((()=>"title"===o.normalizedFormatStore.state.table_subitem_toggle_column),[o]),[$,q]=(0,l.useState)({hasInverseRelation:!0,inverseName:z,autoRelate:{enabled:!1}}),[j,Y]=(0,l.useState)(0===Z.length),Q=(0,w.VK)((()=>(0,xt.$4)()),[]),X=(0,w.qz)(void 0,V.Z),J=(0,w.Kw)(X),ee=(0,l.useCallback)((()=>A.NA(o,v)),[o,v]),te=(0,l.useCallback)((e=>{if(e){const t=v[e];if(t&&"relation"===t.type){const e=t.property;if(e){const t=v[e];if(t&&$){const e=t.name;q({hasInverseRelation:null==$?void 0:$.hasInverseRelation,inverseName:e,autoRelate:null==$?void 0:$.autoRelate})}}G(t.name)}}}),[v,$,G]),oe=(0,l.useCallback)((e=>{const{collectionViewStore:t,newProperty:o,transaction:n}=e;f?(ze.dR({collectionViewStore:t,propertyId:o,transaction:n}),(0,R.isUndefined)(t.getFormat().table_subitem_toggle_column)&&g.FH({stores:[t],update:{table_subitem_toggle_column:"title"},transaction:n})):h&&Le.tF({collectionViewStore:t,newProperty:o,transaction:n})}),[f,h]),ne=(0,l.useCallback)((e=>{const{relationPropertyId:t,transaction:n}=e;f&&ze.jA({collectionContextStore:o,relationPropertyId:t,transaction:n}),h&&Le._p({collectionContextStore:o,relationPropertyId:t,transaction:n})}),[o,f,h]),ie=(0,l.useCallback)((e=>{const t=o.collectionViewStore();t&&(m.createAndCommit({userAction:"CollectionSettingsViewRelationsProperty.handleDefaultPropertySelect",environment:u,perform:o=>{oe({collectionViewStore:t,newProperty:e,transaction:o}),ne({relationPropertyId:e,transaction:o})}}),te(e),Y(!1),p.E3({collectionSettingsStore:n}),pe.wd({action:f?"update_default_subitem":"update_default_timeline_arrows_by",original_view_type:void 0,property_type:e?"relation":void 0,environment:u,collectionContextStore:o}))}),[o,u,Y,te,n,f,oe,ne]),re=(0,l.useCallback)((e=>{const t=o.collectionViewStore();t&&(m.createAndCommit({userAction:"CollectionSettingsViewRelationsProperty.handlePropertySelect",environment:u,perform:o=>{oe({collectionViewStore:t,newProperty:e,transaction:o})}}),te(e),Y(!1),p.E3({collectionSettingsStore:n}),pe.wd({action:f?"update_subitem":"update_timeline_arrows_by",original_view_type:void 0,property_type:e?"relation":void 0,environment:u,collectionContextStore:o}))}),[o,u,te,n,f,oe]),ae=(0,l.useCallback)((()=>{kt.default.afterNextFlush((()=>{Y(!0),q({hasInverseRelation:!0,inverseName:U,autoRelate:{enabled:!1}}),G(O)}))}),[U,O]),le=(0,l.useCallback)((()=>{if(!$)return;const{hasInverseRelation:e,inverseName:t,autoRelate:i}=$,a=o.collectionStore(),l=a,s=o.collectionViewStore();a&&l&&(m.createAndCommit({userAction:"CollectionSettingsSetupRelation.handleAddRelation",environment:u,perform:n=>{const d=ge.G3({environment:u,collectionStore:a,collectionViewArgs:s?{collectionViewStore:s,format:s.getFormat(),formatKey:y}:void 0,propertyType:"relation",transaction:n});return Ge.n7({environment:u,collectionContextStore:o,collectionStore:a,property:d,propertyName:W,targetCollectionStore:l,hasInverseRelation:e,inverseName:t,autoRelate:i,propertyLimit:S,intl:c,transaction:n,from:r}),s&&(oe({collectionViewStore:s,newProperty:d,transaction:n}),ne({relationPropertyId:d,transaction:n})),d}}),p.z$({collectionSettingsStore:n}),p.H4({collectionSettingsStore:n,item:{type:"main"}}),pe._H({environment:u,collectionContextStore:o,from:r,property_type:"relation"}))}),[o,u,n,y,c,S,W,$,r,oe,ne]),se=(0,l.useCallback)((()=>{const e=o.collectionViewStore();e&&(mt.d1({environment:u,collectionViewStore:e,currentValue:o.normalizedFormatStore.state.table_subitem_toggle_column}),pe.wd({environment:u,collectionContextStore:o,action:"toggle_table_subitem_toggle_on_title"}))}),[o,u]),ce=!B.canConfigureBlock,de=(0,M.yK)((e=>({emptyStateText:{color:e.mediumTextColor,fontSize:14,margin:"0px 12px"},useExistingTitle:{fontSize:12,color:e.mediumTextColor,marginLeft:12,marginTop:12}})),[]);if(!b)return null;const ue=f&&B.canConfigureBlock&&K&&Q,me=B.canConfigureCollection,ye=(e,t,n,r)=>i()(_e,{version:"v1",menuProps:e,property:t,defaultProperty:T,checkState:n,propertySchema:r,collectionContextStore:o,handleDefaultPropertySelect:ie,handlePropertySelect:re});return l.createElement(F.ZP,a()({},e,{title:i()(d.FormattedMessage,f?{defaultMessage:"Sub-items",id:"database.viewSettings.subItemsTab.title"}:{defaultMessage:"Dependencies",id:"database.viewSettings.dependenciesTab.title"}),footer:i()(E.Z,{topBorder:Z.length>0&&!j},void 0,ue&&!j&&i()(ht,{showImage:!ce,caption:Fe.default.formatMessage(P.dH.toggleNestingOnTitleMenuItemTooltip),tooltipImage:gt.Z.images.tooltips.collectionSettings.subitemsToggleOnTitlePng,tooltipImageScale:.3,render:e=>l.createElement(I.Z,a()({},e,{icon:e=>_.Z.triangle({width:11,height:11,marginRight:5,marginLeft:6,transform:"rotateZ(180deg)"}),title:i()(d.FormattedMessage,{defaultMessage:"Show nesting toggle on title",id:"database.viewSettings.layoutTab.tableSubitemToggleOnTitle"}),right:i()(yt.Z,{disallowTabbing:!0,on:H,onClick:se,disabled:ce}),disabled:ce,isGray:!0,onClick:se}))}),me&&Z.length>0&&!j&&i()(I.Z,{icon:_.Z.plus,title:i()(d.FormattedMessage,{id:"database.viewSettings.subitemTab.newRelation",defaultMessage:"Create new relation"}),isGray:!0,onClick:ae}),!j&&l.createElement(l.Fragment,null,B.canConfigureBlock&&!B.canConfigureCollection?i()(I.Z,{title:i()(d.FormattedMessage,{id:"database.viewSettings.relationsPropertyTab.removeSubitemRelation.removeSubitemButton.title",defaultMessage:"Turn off for this view"}),isRed:!0,onClick:()=>re(void 0)}):B.canConfigureBlock&&i()(Ce.ZP,{popupType:s.isPhone?We.kQ.SlideUp:We.kQ.Popup,alignmentToOrigin:Ce.vR.End,placementToOrigin:Ce.pO.Bottom,originGap:0,renderOrigin:e=>l.createElement(l.Fragment,null,!(!B.canConfigureBlock||!x)&&l.createElement(I.Z,a()({isGray:!0,icon:_.Z.trash,title:i()(d.FormattedMessage,f?{defaultMessage:"Turn off sub-items",id:"database.viewSettings.relationsPropertyTab.removeSubItemsButton.title"}:{defaultMessage:"Turn off dependencies",id:"database.viewSettings.relationsPropertyTab.removeDependenciesButton.title"}),isRed:!0},e))),render:e=>{let t;return t=s.isPhone?{menuType:ve.og.ActionSheet}:{menuType:ve.og.Popup,width:300},l.createElement(we.Z,a()({},t,{footer:i()(E.Z,{topBorder:!0},void 0,B.canConfigureBlock&&i()(I.Z,{title:i()(d.FormattedMessage,{id:"database.viewSettings.relationsPropertyTab.removeRelation.removeRelationButton.title",defaultMessage:"Turn off for this view"}),isRed:!0,onClick:()=>re(void 0)}),B.canConfigureCollection&&i()(I.Z,{title:i()(d.FormattedMessage,{defaultMessage:"Turn off for all new views",id:"database.viewSettings.relationsPropertyTab.removeRelation.removeAllDefaultButton.title"}),isRed:!0,onClick:()=>{ie(void 0)}}))}))}})))}),f&&i()(N,{propertyName:W||O,inversePropertyName:(null==$?void 0:$.inverseName)||U,newDesign:!1}),h&&i()(At,{propertyName:W||O}),!j&&i()("div",{style:de.useExistingTitle},void 0,i()(d.FormattedMessage,{defaultMessage:"Use an existing relation",id:"database.viewSettings.relationsPropertyTab.useExistingRelation.title"})),Z.length>0&&!j?i()("div",{style:{paddingBottom:"6px"}},void 0,i()(E.Z,{},void 0,i()(Ce.ZP,{buttonPopupStore:X,render:e=>{let t;return t=s.isPhone?{menuType:ve.og.ActionSheet}:{menuType:ve.og.Popup,width:300},l.createElement(we.Z,a()({},t,{footer:i()(be.Z,{schema:v,format:k,getProperties:ee,onAccept:B.canConfigureBlock&&!B.canConfigureCollection?re:()=>{},inputPlaceholder:Fe.default.formatMessage(f?Vt.subitemInputPlaceholder:Vt.timelineArrowsByInputPlaceholder),currentProperty:x,defaultShowPropertyCount:5,renderProperty:B.canConfigureBlock&&!B.canConfigureCollection?void 0:ye})}))},renderOrigin:e=>{var t;return l.createElement(I.Z,a()({title:i()(d.FormattedMessage,{id:"database.viewSettings.relationsPropertyTab.existingRelation",defaultMessage:"Property"}),showChevron:!0,right:x?null===(t=v[x])||void 0===t?void 0:t.name:void 0,rotateChevron:J.open,disabled:!1,icon:_.Z.typesRelation},e))},popupType:s.isPhone?We.kQ.SlideUp:We.kQ.Popup,alignmentToOrigin:Ce.vR.End,placementToOrigin:Ce.pO.Bottom,originGap:0}))):me&&l.createElement(l.Fragment,null,i()(E.Z,{},void 0,i()("div",{style:de.emptyStateText},void 0,i()(d.FormattedMessage,{defaultMessage:"Rename (optional)",id:"database.viewSettings.relationsPropertyTab.emptyStateDescription"}))),i()(E.Z,{},void 0,i()(Ee.ZP,{value:W,placeholder:W,onChange:e=>G(e.target.value),onBlur:()=>{},onSubmit:()=>{},focusInitial:!0,selectAll:!1})),i()(Tt.Z,{collectionContextStore:o,targetCollectionStore:b,property:void 0,buttonContents:i()(d.FormattedMessage,{defaultMessage:"Create",id:"database.viewSettings.relationsPropertyTab.createButton.title"}),temporaryInverseState:$,setTemporaryInverseState:q,isInitialPropertyName:L,onSubmit:le,from:r}),Z.length>0&&i()("div",{style:{margin:"auto",textAlign:"center"}},void 0,i()(Pt.Z,{onClick:()=>{kt.default.afterNextFlush((()=>{Y(!1)}))},isGray:!0,style:{margin:"6px 12px 6px 12px",width:"auto"}},void 0,i()(d.FormattedMessage,{id:"database.viewSettings.relationsPropertyTab.newRelation",defaultMessage:"Use existing relation"})))))}));var It=o(77719),Bt=o(98742),Zt=o(30874);function Et(e){window.__c={n:"CollectionSettingsAccountPicker"};const{integration:t,collectionSettingsStore:o,collectionContextStore:n,onAccountSelect:r}=e,s=(0,M.yK)((()=>({settingsMenu:{display:"flex",flexGrow:1,flexDirection:"column",padding:"8px 16px 16px 8px"}})),[]),c=(0,C.O7)(),u=(0,w.VK)((()=>{var e;return null===(e=n.collectionStore())||void 0===e?void 0:e.getSpaceId()}),[n]),g=(0,w.VK)((()=>{const e=Zt.Z.state;return e.loaded?e.externalAuthentications.filter((e=>e.integration_id===t.id)):[]}),[t]);return t&&u?l.createElement(F.ZP,a()({},e,{title:i()(d.FormattedMessage,{defaultMessage:"Choose an account",id:"collectionSettingsAccountPicker.title"}),footer:Dt({environment:c,integration:t,spaceId:u})}),i()("div",{style:s.settingsMenu},void 0,i()(De.Z,{type:De.i.Vertical,initialFocus:0,sections:[{key:"externalAuthentications",items:g.map((e=>({key:e.id,render:o=>i()(St.Z,{renderTooltip:()=>i()("span",{},void 0,e.account_name),placement:St.Z.Placement.Left,textWrap:!0,render:n=>l.createElement(Ze.Z,a()({},(0,Bt.Z)(n||{},o),{title:e.account_name,icon:i()("img",{style:{width:18},src:t.info.icon}),focused:o.focused}))}),action:()=>{p.z$({collectionSettingsStore:o}),r(e)}}))),render:e=>l.createElement(E.Z,e)}]}))):null}function Dt(e){const t=e.environment.device.isMobileBrowser;return i()(E.Z,{topBorder:!0,children:t?void 0:Kt(e)})}function Kt(e){return l.createElement(I.Z,a()({},e,{icon:_.Z.plus,title:i()(d.FormattedMessage,{id:"collectionSettingsAccountPicker.addAccount",defaultMessage:"Connect another account"}),isGray:!0,onClick:async()=>{await It.hM({...e,from:"source_picker_connect_another_account"})}}))}var Nt=o(66897),Rt=o(63362),Ot=o(3865),Wt=o(97428),Gt=o(76205),Lt=o(80951),zt=o(7057),Ut=o(78106),Ht=o(76218),$t=o(42875),qt=o(606),jt=o(21202),Yt=o(23867),Qt=o(70203),Xt=o(98963),Jt=o(51456),eo=o(23290),to=o(1274),oo=o(26825),no=o(68626),io=o(18844),ro=o(77420),ao=o(6287),lo=o(13493),so=o(10161),co=o(68216),uo=o(8323);function po(e){return e.isTriggerType("event")||e.isTriggerType("notification_event")}function go(e){const{action:t,actionValue:o,automationValue:n}=e;var i,r,a,l,s,c;if("create_page"===t.action.type){if(!o||"create_page"===o.type)return function(e){const{actionId:t,automationId:o,collectionPointer:n,properties:i,values:r,spaceId:a}=e;return{...jo({actionId:t,actionType:"create_page",automationId:o,spaceId:a}),config:{collection:n,properties:i,values:r}}}({actionId:t.action.id,automationId:n.id,collectionPointer:(null===(i=t.action.config)||void 0===i?void 0:i.collection)??(null==o||null===(r=o.config)||void 0===r?void 0:r.collection),properties:(null===(a=t.action.config)||void 0===a?void 0:a.properties)??(null==o||null===(l=o.config)||void 0===l?void 0:l.properties),spaceId:n.space_id,values:(null===(s=t.action.config)||void 0===s?void 0:s.values)??(null==o||null===(c=o.config)||void 0===c?void 0:c.values)})}else if("update_pages"===t.action.type){var d,u,p,g,m,y;if(!o||"update_pages"===o.type)return function(e){const{actionId:t,automationId:o,properties:n,spaceId:i,target:r,values:a}=e;return{...jo({actionId:t,actionType:"update_pages",automationId:o,spaceId:i}),config:{target:r,properties:n,values:a}}}({actionId:t.action.id,automationId:n.id,properties:(null===(d=t.action.config)||void 0===d?void 0:d.properties)??(null==o||null===(u=o.config)||void 0===u?void 0:u.properties),spaceId:n.space_id,target:(null===(p=t.action.config)||void 0===p?void 0:p.target)??(null==o||null===(g=o.config)||void 0===g?void 0:g.target),values:(null===(m=t.action.config)||void 0===m?void 0:m.values)??(null==o||null===(y=o.config)||void 0===y?void 0:y.values)})}else if("slack_notification"===t.action.type){var S,f,h,v;if(!o||"slack_notification"===o.type)return function(e){const{actionId:t,automationId:o,externalBotId:n,spaceId:i,target:r}=e;return{...jo({actionId:t,actionType:"slack_notification",automationId:o,spaceId:i}),config:{target:r,external_bot_id:n}}}({actionId:t.action.id,automationId:n.id,externalBotId:(null===(S=t.action.config)||void 0===S?void 0:S.external_bot_id)??(null==o||null===(f=o.config)||void 0===f?void 0:f.external_bot_id),spaceId:n.space_id,target:(null===(h=t.action.config)||void 0===h?void 0:h.target)??(null==o||null===(v=o.config)||void 0===v?void 0:v.target)})}else{if("duplicate_blocks"===t.action.type||"modal_confirmation"===t.action.type||"open_page"===t.action.type||"query_collection"===t.action.type)return;(0,k.t1)(t.action)}}function mo(e){const{automationStore:t,currentUserId:o,inMemoryRecordCache:n}=e;return(0,w.VK)((()=>{const e=null==t?void 0:t.getRole(),i=null==t?void 0:t.getValue(),r=(null==t?void 0:t.getActionStores().map((e=>e.getValue())).filter(k.$K))??[],a=null==t?void 0:t.pointer;return t=>{if(o&&e&&i&&a){if(!(0,Ot.Vd)(i)&&!(0,Ot.nl)(i))return i;if("update_name"===t.type){const r=function(e){var t;const{action:o,automationValue:n}=e;return(null===(t=n.properties)||void 0===t?void 0:t.name)!==o.name?{...n,properties:{...n.properties,name:o.name}}:n}({action:t,automationValue:i});i!==r&&(n.setRecord({pointer:a,userId:o},{role:e,value:r}),n.emitAll())}else if("update_source"===t.type){const r=function(e){const{action:t,automationValue:o}=e,n=t.pointer,i=n.table===ao.v?{pointer:n,type:ao.v}:{pointer:n,type:lo.n};return{...o,trigger:{...o.trigger,event:{...o.trigger.event,source:i}}}}({action:t,automationValue:i});i!==r&&(n.setRecord({pointer:a,userId:o},{role:e,value:r}),n.emitAll())}else if("update_trigger"===t.type){const r=function(e){const{action:t,automationValue:o}=e,n=t.trigger;if("page_added"===n.type)return o.trigger.event.pagesAdded?o:{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagesAdded:!0}}};if("any_page_property_edited"===n.type)return"any"!==o.trigger.event.pagePropertiesEdited.type?{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagePropertiesEdited:{type:"any"}}}}:o;if("property_changed"===n.type){const e="some"===o.trigger.event.pagePropertiesEdited.type?o.trigger.event.pagePropertiesEdited.some:[],t=O().findIndex(e,(e=>e.property===n.property)),i={filter:n.filter,property:n.property},r=-1===t?[...e,i]:e.map((e=>e.property===n.property?i:e));return{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagePropertiesEdited:{some:r,type:"some"}}}}}(0,k.t1)(n)}({action:t,automationValue:i});i!==r&&(n.setRecord({pointer:a,userId:o},{role:e,value:r}),n.emitAll())}else if("update_action"===t.type){var l;const s=r.find((e=>e.id===t.action.id)),c=go({action:t,actionValue:s,automationValue:i});if(!c)return;if(n.setRecord({pointer:{id:c.id,spaceId:i.space_id,table:io.Xj},userId:o},{role:"editor",value:c}),null===(l=i.action_ids)||void 0===l||!l.includes(c.id)){const t={...i,action_ids:[...i.action_ids??[],c.id]};n.setRecord({pointer:a,userId:o},{role:e,value:t})}n.emitAll()}else if("remove_action"===t.type){const r=t.action.id;n.deleteRecord({pointer:{id:r,spaceId:i.space_id,table:io.Xj},userId:o});const l={...i,action_ids:(i.action_ids??[]).filter((e=>e!==r))};n.setRecord({pointer:a,userId:o},{role:e,value:l}),n.emitAll()}else if("remove_trigger"===t.type){const r=function(e){const{action:t,automationValue:o}=e,n=t.trigger;if("page_added"===n.type)return o.trigger.event.pagesAdded?{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagesAdded:!1}}}:o;if("any_page_property_edited"===n.type)return"any"===o.trigger.event.pagePropertiesEdited.type?{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagePropertiesEdited:{type:"none"}}}}:o;if("property_changed"===n.type){const e=("some"===o.trigger.event.pagePropertiesEdited.type?o.trigger.event.pagePropertiesEdited.some:[]).filter((e=>e.property!==n.property));return{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagePropertiesEdited:e.length>0?{some:e,type:"some"}:{type:"none"}}}}}(0,k.t1)(n)}({action:t,automationValue:i});i!==r&&(n.setRecord({pointer:a,userId:o},{role:e,value:r}),n.emitAll())}else(0,k.t1)(t)}}}),[t,o,n])}function yo(e){const{automationStore:t,collectionStore:o}=e,n=o.getSchema(),i=t.getKeyStore("properties").getKeyStore("name").getValue();if(null==i||!i.trim())return!1;const r=t.getTrigger(),a="event"===(null==r?void 0:r.type),l="notification_event"===(null==r?void 0:r.type);if(!a&&!l)return!1;const{pagesAdded:s,pagePropertiesEdited:c}=r.event;if("some"===c.type&&c.some.some((e=>Co({collectionSchema:n,property:e.property}))))return!1;if(!s&&("none"===c.type||"some"===c.type&&0===c.some.length))return!1;const d=t.getActionStores().filter((e=>e.isDefined()));return 0!==d.length&&d.every((e=>function(e,t){if(e.isType("slack_notification"))return(0,k.$K)(e.getConfigStore().getKeyStore("external_bot_id").getValue())&&(0,k.$K)(e.getConfigStore().getKeyStore("target").getValue());if(e.isType("update_pages")){const o=e.getConfigStore().getKeyStore("target").getValue(),n=e.getConfigStore().getKeyStore("properties").getValue()??[];if(!(0,k.$K)(o)||0===n.length)return!1;if("collection"===o.type){const e=co.NW.createChildStore(t,o.collection).getSchema();if(n.some((t=>Co({property:t,collectionSchema:e}))))return!1}else if("variable"===o.type){const e=(0,Ut.MY)(o.id);if("global"!==e.source||"button_page"!==e.global)return!1;{const e=t.getSchema();if(n.some((t=>Co({property:t,collectionSchema:e}))))return!1}}else{if("page"===o.type)return!1;(0,k.t1)(o)}return!0}if(e.isType("create_page")){const o=e.getConfigStore().getKeyStore("collection").getValue();if(!(0,k.$K)(o))return!1;const n=co.NW.createChildStore(t,o).getSchema();return!(e.getConfigStore().getKeyStore("properties").getValue()??[]).some((e=>Co({property:e,collectionSchema:n})))}throw new Error(`isActionStoreComplete not implemented for ${e.getType()}`)}(e,o)))}function So(e){const{collectionStore:t}=e;if(!t)return!1;if((t.getFormat().automation_ids??[]).length>=eo.ss&&!(0,uo.mq)())return!1;const o=t.pointer,n=t.getSpaceId();return(0,to.IC)({targetTriggerType:"event",targetParentPointer:o,targetSpaceId:n}).every((e=>{let{pointer:o,minimumRequiredRole:n}=e;const i=t.getRecordRole(o);return!!i&&(0,oo.yY)(i,n)}))}function fo(e){const{collectionStore:t}=e;if(!t)return!1;const o=t.pointer,n=t.getSpaceId();return(0,to.IC)({targetTriggerType:"notification_event",targetParentPointer:o,targetSpaceId:n}).every((e=>{let{pointer:o,minimumRequiredRole:n}=e;const i=t.getRecordRole(o);return!!i&&(0,oo.yY)(i,n)}))}function ho(e){const{automationStore:t,actionStores:o}=e;if(so.default.checkGate("status_automations_m2")&&!(0,uo.mq)())return!1;const n=t.getMinimumFieldsForPermissions();if(!n)return!1;if(!o.every((e=>e.isDefined())))return!1;return(0,to.fz)({automationValue:n,actionValues:o.map((e=>({config:e.getConfig(),type:e.getType()})))}).every((e=>{let{pointer:o,minimumRequiredRole:n}=e;const i=t.getRecordRole(o);return!!i&&(0,oo.yY)(i,n)}))}function vo(e){const{automationStore:t}=e,o=t.getMinimumFieldsForPermissions();if(!o)return!1;return(0,to.bM)(o).every((e=>{let{pointer:o,minimumRequiredRole:n}=e;const i=t.getRecordRole(o);return!!i&&(0,oo.yY)(i,n)}))}function bo(e){const{anyOptionCheckState:t,currentFilter:o,propertyId:n,updateCurrentState:i}=e;!0===t?i({type:"update_trigger",trigger:{type:"property_changed",property:n,filter:{operator:"changes_to_any"}}}):!1===t?i({type:"remove_trigger",trigger:{type:"property_changed",property:n,filter:{operator:"changes_to_any"}}}):"partial"===t?i({type:"update_trigger",trigger:{type:"property_changed",property:n,filter:o}}):(0,k.t1)(t)}function Co(e){const{property:t,collectionSchema:o}=e;return!!o&&!o[t]}function wo(e){const{automationStore:t,collectionStore:o}=e,n=t.getTrigger();if(!n||"event"!==n.type&&"notification_event"!==n.type)return!1;const i=n.event.source;if(i.type===ao.v||"filter"===i.type)return!1;const r=co.Xr.createChildStore(o,i.pointer);return Mo({collectionSchema:o.getSchema(),collectionViewStore:r})}function Mo(e){const t=_o(e);return(0,k.$K)(t)}function _o(e){var t;const{collectionViewStore:o,collectionSchema:n}=e,i=o.getPropertyFiltersStore().getValue()??[],r=null===(t=o.getQuery(n))||void 0===t?void 0:t.filter,a={operator:"and",filters:(0,Gt.OH)({propertyFilters:i,combinatorFilter:r,schema:n})},l=(0,Gt.SH)(a,(e=>{if((0,Gt.aN)(e)){const t=n[e.property];return!!t&&!(0,Ot.TX)(t)}return!1}));if(l)return(0,Gt.aN)(l)?l.property:(0,Gt.Mm)(l)?l.timestamp:void 0}const ko=(0,d.defineMessages)({actionCheckboxPropertyChecked:{defaultMessage:"checked",id:"automations.action.checkboxProperty.checked"},actionCheckboxPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.checkboxProperty.single"},actionCheckboxPropertyUnchecked:{defaultMessage:"unchecked",id:"automations.action.checkboxProperty.unchecked"},actionDatePropertyClear:{defaultMessage:"Clear {propertyName}",id:"automations.action.dateProperty.clear"},actionDatePropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.dateProperty.single"},actionPersonPropertyClear:{defaultMessage:"Clear {propertyName}",id:"automations.action.personProperty.clear"},actionPersonPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.personProperty.single"},actionPersonPropertySetMultiple:{defaultMessage:"Set {propertyName} to all of {propertyValues}",id:"automations.action.personProperty.multiple"},actionRelationPropertyClear:{defaultMessage:"Clear {propertyName}",id:"automations.action.relationProperty.clear"},actionRelationPropertySetMultiple:{defaultMessage:"Set {propertyName} to all of {propertyValues}",id:"automations.action.relationProperty.multiple"},actionRelationPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.relationProperty.single"},actionSelectPropertyClear:{defaultMessage:"Clear {propertyName}",id:"automations.action.selectProperty.clear"},actionSelectPropertySetMultiple:{defaultMessage:"Set {propertyName} to all of {propertyValues}",id:"automations.action.selectProperty.multiple"},actionSelectPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.selectProperty.single"},actionStatusPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.statusProperty.single"},actionTextPropertyClear:{defaultMessage:"Clear {propertyName}",id:"automations.action.textProperty.clear"},actionTextPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.textProperty.single"},triggerAnyPageAdded:{defaultMessage:"Page added",id:"automations.trigger.pageAdded.title"},triggerAnyPagePropertyEdit:{defaultMessage:"Any page property edited",id:"automations.trigger.anyPagePropertyEdited.title"},triggerAnyPropertyEdit:{defaultMessage:"{propertyName} is edited",id:"automations.trigger.propertyChangesToAny.title"},triggerSelectPropertySet:{id:"automations.trigger.selectPropertySet.title",defaultMessage:"{propertyName} set to {propertyValues}"},triggerStatusPropertySet:{defaultMessage:"{propertyName} set to {propertyValues}",id:"automations.trigger.statusPropertySet.singleProperty"}});function xo(e){const{propertyName:t,propertyValue:o}=e;return{...ko.actionCheckboxPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function To(e){const{propertyName:t}=e;return{...ko.actionDatePropertyClear,values:{propertyName:t}}}function Po(e){const{propertyName:t,propertyValue:o}=e;return{...ko.actionDatePropertySetSingle,values:{propertyName:t,propertyValue:o}}}function Ao(e){const{propertyName:t}=e;return{...ko.actionPersonPropertyClear,values:{propertyName:t}}}function Vo(e){const{propertyName:t,propertyValue:o}=e;return{...ko.actionPersonPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function Fo(e){const{propertyName:t,propertyValue:o}=e;return{...ko.actionPersonPropertySetMultiple,values:{propertyName:t,propertyValues:o}}}function Io(e){const{propertyName:t}=e;return{...ko.actionRelationPropertyClear,values:{propertyName:t}}}function Bo(e){const{propertyName:t,propertyValue:o}=e;return{...ko.actionRelationPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function Zo(e){const{propertyName:t,propertyValue:o}=e;return{...ko.actionRelationPropertySetMultiple,values:{propertyName:t,propertyValues:o}}}function Eo(e){const{propertyName:t}=e;return{...ko.actionSelectPropertyClear,values:{propertyName:t}}}function Do(e){const{propertyName:t,propertyValue:o}=e;return{...ko.actionSelectPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function Ko(e){const{propertyName:t,propertyValue:o}=e;return{...ko.actionSelectPropertySetMultiple,values:{propertyName:t,propertyValues:o}}}function No(e){const{propertyName:t,propertyValue:o}=e;return{...ko.actionStatusPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function Ro(e){const{propertyName:t}=e;return{...ko.actionTextPropertyClear,values:{propertyName:t}}}function Oo(e){const{propertyName:t,propertyValue:o}=e;return{...ko.actionTextPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function Wo(e){return e.formatMessage(ko.triggerAnyPageAdded)}function Go(e){return e.formatMessage(ko.triggerAnyPagePropertyEdit)}function Lo(e,t){const{propertyName:o}=t;return e.formatMessage(ko.triggerAnyPropertyEdit,{propertyName:o})}function zo(e,t){return e.formatMessage(ko.triggerSelectPropertySet,t)}function Uo(e,t){return e.formatMessage(ko.triggerStatusPropertySet,t)}function Ho(e){return no.x.isFail(e.compilationResultStore.state)?[]:e.compilationResultStore.state.value.valueTypes}function $o(e){const{automationId:t,automationName:o,collectionStore:n,userId:i}=e;return function(e){const{actionIds:t,automationId:o,collectionStore:n,eventConfiguration:i,lastEditedTime:r,properties:a,userId:l}=e,s=Date.now();return{action_ids:t,alive:!0,created_by_id:l,created_by_table:"notion_user",created_time:s,id:o,last_edited_by_id:l,last_edited_by_table:"notion_user",last_edited_time:r??s,parent_id:n.id,parent_table:ao.v,properties:a??{},space_id:n.getSpaceId(),status:"active",trigger:{event:i,id:(0,c.ZP)(),type:"event"},version:1}}({actionIds:[],automationId:t,collectionStore:n,eventConfiguration:{pagesAdded:!1,pagePropertiesEdited:{type:"none"},source:{pointer:n.getSpaceShardedPointer(),type:ao.v}},properties:{name:o},userId:i})}function qo(e){const{automationId:t,automationName:o,collectionStore:n,userId:i}=e;return function(e){const{actionIds:t,automationId:o,collectionStore:n,eventConfiguration:i,lastEditedTime:r,properties:a,userId:l}=e,s=Date.now();return{action_ids:t,alive:!0,created_by_id:l,created_by_table:"notion_user",created_time:s,id:o,last_edited_by_id:l,last_edited_by_table:"notion_user",last_edited_time:r??s,parent_id:n.id,parent_table:ao.v,properties:a??{},space_id:n.getSpaceId(),status:"active",trigger:{event:i,id:(0,c.ZP)(),type:"notification_event"},version:1}}({actionIds:[],automationId:t,collectionStore:n,eventConfiguration:{pagesAdded:!1,pagePropertiesEdited:{type:"none"},source:{pointer:n.getSpaceShardedPointer(),type:ao.v}},properties:{name:o},userId:i})}function jo(e){const{actionId:t,actionType:o,automationId:n,spaceId:i}=e;return{alive:!0,id:t??(0,c.ZP)(),parent_id:n,parent_table:Xt.cv,space_id:i,type:o,version:1}}function Yo(){const e=(0,w.VK)((()=>Zt.Z.completeSlackAuthentications.state),[]);return(0,l.useMemo)((()=>0===e.length?{type:"connectToSlackDefault"}:1===e.length?{type:"selectChannelNew"}:{type:"selectWorkspace"}),[e.length])}var Qo=o(98114);const Xo=(0,d.defineMessages)({automationDeleteConfirmationMessage:{id:"slackAutomations.remove.confirmation.message",defaultMessage:"Are you sure you want to delete {automationName}?"},automationDeleteAcceptLabel:{id:"slackAutomations.remove.confirmation.acceptLabel",defaultMessage:"Delete"}});function Jo(e){const{automationStore:t,collectionStore:o,environment:n,intl:i}=e,r=(0,Jt.mc)(n);m.createAndCommit({environment:n,userAction:"collectionSettingsAutomationsActions.createDatabaseAutomation",perform:e=>{m.applyOperation({store:o,operation:{pointer:o.pointer,path:["format","automation_ids"],command:"listAfter",args:{id:t.id}},transaction:e});const r=co.Mz.createChildStore(o,t.pointer),a=t.getActionStores();for(const t of a){const o=t.getType();o&&Qo.zY({actionId:t.id,actionType:o,automationStore:r,config:t.getConfig(),environment:n,intl:i,transaction:e})}const l=an(a);Se.ae({environment:n,inMemoryRecordCache:o.inMemoryRecordCache,table:Xt.cv,transaction:e,value:{action_ids:t.getActionIds(),alive:!0,id:t.id,parent_id:o.id,parent_table:o.table,properties:{name:t.getName()},space_id:o.getSpaceId(),status:"active",trigger:{id:(0,c.ZP)(),event:t.getEventConfiguration()??{pagesAdded:!1,pagePropertiesEdited:{type:"none"},source:{pointer:o.getSpaceShardedPointer(),type:"collection"}},type:l}}})}});const a=ln({automationStore:t,collectionStore:o});Rt.T0(r,a)}function en(e){const{automationStore:t,collectionStore:o,environment:n}=e;m.createAndCommit({environment:n,userAction:"collectionSettingsAutomationsActions.saveDatabaseAutomation",perform:e=>{const n=co.Mz.createChildStore(o,t.pointer),i=t.getName(),r=n.getKeyStore("properties");Se.sW({store:r,data:{name:i},transaction:e});const a=t.getActionStores(),l=an(a),s=n.getTriggerStore();if(Se.sW({store:s,data:{type:l},transaction:e}),po(n)&&po(t)){const o=n.getTriggerStore().getKeyStore("event");Se.sW({store:o,data:t.getTriggerStore().getKeyStore("event").getValue(),transaction:e})}const c=[];for(const t of a){const o=t.getModel();if(!o)continue;const i=co.zq.createChildStore(n,t.pointer);Se.sO({store:i,value:{alive:!0,config:o.getConfig(),id:o.id,parent_id:n.id,parent_table:n.table,space_id:n.getSpaceId(),type:o.type},transaction:e}),c.push(t.id)}Se.sW({store:n,data:{action_ids:c},transaction:e})}});const i=(0,Jt.mc)(n),r=ln({automationStore:t,collectionStore:o});Rt.r4(i,r)}async function tn(e){const{intl:t,environment:o,collectionStore:n,existingAutomationStore:i,triggerType:r,onDelete:a}=e,l=i.getNameWithDefault(t);(await ye.confirmUserActionV2({message:t.formatMessage(Xo.automationDeleteConfirmationMessage,{automationName:l}),acceptLabel:t.formatMessage(Xo.automationDeleteAcceptLabel)})).accept&&(!function(e){const{environment:t,triggerType:o,collectionStore:n,existingAutomationStore:i}=e;m.createAndCommit({environment:t,userAction:"collectionSettingsAutomationsActions.deleteAutomation",perform:e=>{const t=n.getFormatStore().getKeyStore("automation_ids"),o=co.Mz.createChildStore(n,i.pointer);m.applyOperation({store:t,operation:{pointer:t.pointer,path:t.path,command:"listRemove",args:{id:o.id}},transaction:e}),Se.sW({store:o,data:{alive:!1},transaction:e})}});const r=(0,Jt.mc)(t),a=ln({automationStore:i,collectionStore:n});Rt.uO(r,a),"notification_event"===o&&u.xim(t,{type:"granular",source:"collection_view_settings",collection_id:n.id})}({environment:o,triggerType:r,collectionStore:n,existingAutomationStore:i}),null==a||a())}function on(e){const{automationStore:t,collectionStore:o,environment:n}=e;m.createAndCommit({environment:n,userAction:"collectionSettingsAutomationsActions.disableAutomation",perform:e=>{const n=co.Mz.createChildStore(o,t.pointer);Se.sW({store:n,data:{status:"disabled"},transaction:e})}});const i=(0,Jt.mc)(n),r=ln({automationStore:t,collectionStore:o});Rt.ai(i,r)}function nn(e){const{automationStore:t,collectionStore:o,environment:n}=e;m.createAndCommit({environment:n,userAction:"collectionSettingsAutomationsActions.enableAutomation",perform:e=>{const n=co.Mz.createChildStore(o,t.pointer);Se.sW({store:n,data:{status:"active"},transaction:e})}});const i=(0,Jt.mc)(n),r=ln({automationStore:t,collectionStore:o});Rt.Rt(i,r)}function rn(e){const{automationStore:t,collectionStore:o,environment:n}=e;m.createAndCommit({environment:n,userAction:"collectionSettingsAutomationsActions.reactivateNotificationAutomation",perform:e=>{const n=co.Mz.createChildStore(o,t.pointer);Se.sW({store:n,data:{status:"active"},transaction:e})}}),u.sfR(n,{type:"granular",source:"collection_view_settings",collection_id:o.id})}function an(e){return 1===e.length&&e[0].isType("slack_notification")?"notification_event":"event"}function ln(e){const{automationStore:t,collectionStore:o}=e,n=o.getSchema(),i=t.getActionStores().map((e=>{return e.isType("slack_notification")?{type:"slack_notification"}:e.isType("update_pages")?{property_types:((null===(t=e.getConfig())||void 0===t?void 0:t.properties)??[]).map((e=>{var t;return null===(t=n[e])||void 0===t?void 0:t.type})).filter(k.$K),type:"update_pages"}:e.isType("create_page")?{property_types:((null===(o=e.getConfig())||void 0===o?void 0:o.properties)??[]).map((e=>{var t;return null===(t=n[e])||void 0===t?void 0:t.type})).filter(k.$K),type:"create_page"}:void 0;var t,o})).filter(k.$K),r=t.getTriggerStore().getValue(),a=[];if("event"===(null==r?void 0:r.type)||"notification_event"===(null==r?void 0:r.type)){const{pagesAdded:e,pagePropertiesEdited:t}=r.event;e&&a.push({type:"page"}),"any"===t.type?a.push({condition:"any",type:"property"}):"none"===t.type?a.push({condition:"none",type:"property"}):a.push({condition:"some",property_types:t.some.map((e=>{var t;return null===(t=n[e.property])||void 0===t?void 0:t.type})).filter(k.$K),type:"property"})}let l;if(t.isTriggerType("event")||t.isTriggerType("notification_event")){const e=t.getTriggerStore().getKeyStore("event").getKeyStore("source").getValue();e&&"collection_view"===e.type&&(l=e.pointer.id)}return{automation_actions:i,automation_id:t.id,automation_triggers:a,collection_id:o.id,collection_view_id:l}}var sn=o(14976),cn=o(17731),dn=o(67669),un=o(37034),pn=o(68910);function gn(e){const{automationStore:t,collectionStore:o}=e;return(0,w.VK)((()=>{if(!o||!t)return;const e=o.getSpaceShardedPointer();return new pn.L({automationStore:t,parentPointer:e,type:"event",persisted:!0,intl:Fe.default.getIntl(),parentRecordStore:o})}),[o,t])}var mn=o(63474),yn=o(79315),Sn=o(6740);function fn(){const e=(0,l.useRef)(null),[t,o]=(0,l.useState)(!1),n=(0,l.useCallback)((()=>{const t=e.current;t&&o(function(e){try{return e.matches(":focus-within")}catch(t){return!1}}(t))}),[]),i=(0,l.useCallback)((t=>{e.current=t,n()}),[n]);return(0,l.useEffect)((()=>{const t=e.current;if(t){function e(){o(!0),n()}function i(){o(!1),n()}return t.addEventListener("focusin",e),t.addEventListener("focusout",i),()=>{t.removeEventListener("focusin",e),t.removeEventListener("focusout",i)}}}),[n]),(0,l.useEffect)((()=>{if(t)return document.addEventListener("pointerdown",n),document.addEventListener("keydown",n),()=>{document.removeEventListener("pointerdown",n),document.removeEventListener("keydown",n)}}),[t,n]),[i,t]}var hn=o(77744),vn=o(24457),bn=o(1533),Cn=o(73063);const wn=(0,d.defineMessages)({moreLabel:{id:"automationBaseStepElement.moreActionsMenu.title",defaultMessage:"More"}});function Mn(e){window.__c={n:"AutomationBaseStepElement"};const{icon:t,onClick:o,title:n,caption:r,onEdit:a,onDelete:s,disabled:c}=e,{isMobile:d}=(0,C.Fy)(),[u,p]=(0,Sn.Z)(),[g,m]=fn(),y=(0,w.qz)(void 0,bn.Z),S=(0,w.VK)((()=>y.getState()),[y]).hovered||p||m,f=(0,hn.lq)(u,g),h=(0,w.qz)(void 0,V.Z),v=(0,M.yK)((e=>({button:{position:"relative"},moreButtonWrap:{display:S||d?"block":"none",position:"absolute",right:12,top:14},container:{background:e.cardContentBackground,display:"flex",flexDirection:"column",gap:8,justifyContent:"center",paddingBlock:16,paddingInline:12},title:{alignItems:"center",display:"flex",flexDirection:"row",gap:6},iconWrap:{flexShrink:0,alignSelf:"baseline",height:"24px",display:"flex",alignItems:"center"},iconStyle:{width:16,height:16,color:e.mediumIconColor},body:{flex:"1 1 auto",fontSize:14,lineHeight:1.3,minWidth:0,whiteSpace:"pre"}})),[S,d]);return l.createElement(B.Z,{onClick:()=>{null==o||o(h)},style:v.button,disabled:c,disabledFeedback:c,ref:f,focused:S,store:y},!c&&(a||s)&&i()("div",{style:v.moreButtonWrap},void 0,i()(_n,{onEdit:a,onDelete:s,disabled:c,buttonPopupStore:h})),i()("div",{style:v.container},void 0,i()("div",{style:v.title},void 0,t&&i()("div",{"aria-hidden":"true",style:v.iconWrap},void 0,t(v.iconStyle)),i()("div",{style:v.body},void 0,n)),r))}function _n(e){window.__c={n:"MoreActionsButton"};const{onDelete:t,onEdit:o,disabled:n,buttonPopupStore:r}=e,s=(0,C.O7)(),{device:c}=s,u=(0,d.useIntl)(),p=(0,M.yK)((e=>({iconButton:{border:`1px solid ${e.regularDividerColor}`,height:26,width:26},iconButtonIcon:{width:14,height:14}})),[]);return i()(Ce.ZP,{buttonPopupStore:r,popupType:c.isMobile?We.kQ.SlideUp:We.kQ.Popup,alignmentToOrigin:Ce.vR.Center,placementToOrigin:Ce.pO.Bottom,originGap:0,renderOrigin:e=>l.createElement(Cn.Z,a()({},e,{disabled:n,ariaLabel:u.formatMessage(wn.moreLabel),icon:_.Z.dots,hasBackground:!0,iconStyle:p.iconButtonIcon,style:p.iconButton})),render:e=>i()(kn,{onClose:()=>e.close(),onEdit:o,onDelete:t})})}function kn(e){window.__c={n:"MoreActionsMenu"};const{onClose:t,onEdit:o,onDelete:n}=e,r=(0,vn.F)(),s=[o?{action:()=>{t(),o()},key:"edit",render:e=>l.createElement(Ze.Z,a()({},e,{icon:_.Z.pencil({height:16,width:16}),title:i()(d.FormattedMessage,{id:"automationBaseStepElement.moreActionsMenu.edit",defaultMessage:"Edit"})}))}:void 0,n?{action:()=>{t(),n()},key:"delete",render:e=>l.createElement(Ze.Z,a()({},e,{icon:_.Z.trash({height:16,width:16}),title:i()(d.FormattedMessage,{id:"automationBaseStepElement.moreActionsMenu.delete",defaultMessage:"Delete"})}))}:void 0].filter(k.$K);return l.createElement(we.Z,r,i()(De.Z,{type:De.i.Vertical,sections:[{items:s,key:"items",render:e=>l.createElement(E.Z,a()({enableActionSheetTitle:!0,topBorder:!0},e))}],initialFocus:0}))}var xn=o(39068),Tn=o(84619),Pn=o(22084),An=o(85567);function Vn(e){window.__c={n:"AutomationAnyEditPropertyTrigger"};const{disabled:t,onDelete:o,onClick:n,propertySchema:r,onEdit:a}=e,l=(0,d.useIntl)(),s=(0,M.Fg)(),c=(0,M.yK)((()=>({propertyName:{...x.Z.textOverflowStyle,fontWeight:x.Z.fontWeight.semibold},wrap:{display:"inline-flex",width:"100%"}})),[]),u=Lo(l,{propertyName:i()("span",{style:c.propertyName},void 0,r.name)});return i()(Mn,{disabled:t,onClick:n,icon:e=>i()(xn.ZP,{size:16,theme:s,icon:r.icon,style:e,type:r.type}),title:i()("span",{style:c.wrap},void 0,u),onEdit:a,onDelete:o})}const Fn=5;function In(e){const{filter:t,propertySchema:o,onEdit:n,onDelete:r,disabled:s}=e;return"changes_to_any"===t.operator?i()(Vn,{disabled:s,propertySchema:o,onClick:n,onDelete:r,onEdit:n}):l.createElement(Bn,a()({},e,{filter:t}))}function Bn(e){window.__c={n:"ParametrizableStatusPropertyTriggerFilter"};const{filter:t,limit:o=Fn,propertySchema:n,onEdit:r,onDelete:a,disabled:l}=e,s=(0,d.useIntl)(),c=(0,M.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:"24px"},propertyName:{...x.Z.textOverflowStyle,fontWeight:x.Z.fontWeight.semibold}})),[]);if(!(0,Gt.vR)(t))return null;const u=t.value,p=n.name,g=Array.isArray(u)?u:[u],m=Zn({groupValues:g.map((e=>"is_group"===e.type?e.value:void 0)).filter(k.$K),limit:o,optionValues:g.map((e=>"is_option"===e.type?e.value:void 0)).filter(k.$K),propertySchema:n}),y=s.formatList(m,{style:"long",type:"disjunction"}),S={propertyName:i()("span",{style:c.propertyName},void 0,p),propertyValues:En(y)};return i()(Mn,{disabled:l,icon:_.Z.typesStatus,title:i()("div",{style:c.content},void 0,Uo(s,S)),onEdit:r,onDelete:a,onClick:r})}function Zn(e){const{groupValues:t,isText:o,limit:n,optionValues:r,propertySchema:a}=e,l=a.groups||[],s=a.options||[],c=t.map((e=>{const t=l.find((t=>t.name===e));if(t)return o?t.name:i()("span",{},t.id,t.name)})).filter(k.$K),d=r.map((e=>{const t=(0,Lt.i7)(s,e);if(void 0===t)return;if(o)return t.value;const n=l.find((e=>{var o;return null===(o=e.optionIds)||void 0===o?void 0:o.includes(t.id)}));return i()(Pn.F,{format:Tn.l.Medium,isSingle:!0,value:t.value,color:t.color,groupColor:null==n?void 0:n.color,showRemoveButton:!1,showEllipsis:!0},t.id)})).filter(k.$K),u=[...c,...d];let p=[];if(void 0!==n&&u.length>n){const e=d.length-n,t=o?`+${e}`:i()(An.Z,{format:Tn.l.Medium,isRound:!0,isSingle:!0,showRemoveButton:!1,value:`+${e}`},"More tokens");p=[...d.slice(0,n),t]}else p=u;return p}function En(e){if(!Array.isArray(e))return[e];const t=[];for(const o of e)if("string"==typeof o&&" "!==o[0]){const e=t.pop();t.push(i()("div",{},void 0,e,o))}else t.push(o);return t}function Dn(e){const{filter:t,propertySchema:o,onEdit:n,onDelete:r,disabled:a}=e;if("changes_to_any"===t.operator)return i()(Vn,{disabled:a,propertySchema:o,onClick:n,onEdit:n,onDelete:r});{const e={filter:t,propertySchema:o,onEdit:n,onDelete:r,disabled:a};return l.createElement(Kn,e)}}function Kn(e){window.__c={n:"ParametrizableSelectPropertyTriggerFilter"};const{filter:t,propertySchema:o,onEdit:n,onDelete:r,disabled:a}=e,l=(0,d.useIntl)(),s=(0,M.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:"24px"},propertyName:{...x.Z.textOverflowStyle,fontWeight:x.Z.fontWeight.semibold}})),[]);if(!(0,Gt.vR)(t))return null;const c=t.value,u=o.name,p=Nn({limit:5,optionValues:(Array.isArray(c)?c:[c]).map((e=>e.value)).filter(k.$K),propertySchema:o}),g=l.formatList(p,{style:"long",type:"disjunction"}),m={propertyName:i()("span",{style:s.propertyName},void 0,u),propertyValues:En(g)};return i()(Mn,{disabled:a,icon:xn.wG[o.type],title:i()("div",{style:s.content},void 0,zo(l,m)),onClick:n,onEdit:n,onDelete:r})}function Nn(e){const{isText:t,limit:o,optionValues:n,propertySchema:r}=e,a=r.options??[],l=n.map((e=>{const t=(0,Lt.i7)(a,e);if(t)return i()(Pn.a,{value:t.value,color:t.color,format:Tn.l.Medium,isSingle:!0,showRemoveButton:!1},t.id)})).filter(k.$K);let s;if(void 0!==o&&l.length>o){const e=l.length-o,n=t?`+${e}`:i()(An.Z,{format:Tn.l.Medium,isRound:!0,isSingle:!0,showRemoveButton:!1,value:`+${e}`},"More tokens");s=[...l.slice(0,o),n]}else s=l;return s}const Rn=5;function On(e){window.__c={n:"UpdateMultiSelectPropertyAction"};const{disabled:t,limit:o=Rn,onClick:n,onDelete:r,onEdit:a,propertySchema:s,value:c}=e,u=null!=c&&c.value?(0,Ht.A6)(null==c?void 0:c.value):void 0,p=u?Nn({limit:o,optionValues:u.map((e=>"string"==typeof e?e:void 0)).filter(k.$K),propertySchema:s}):void 0,g=(null==p?void 0:p.length)??0,m=(0,d.useIntl)(),y=(0,M.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:g<=1?"nowrap":"wrap",whiteSpace:"pre"},propertyName:{...x.Z.textOverflowStyle,fontWeight:x.Z.fontWeight.semibold}})),[g]),S=i()("span",{style:y.propertyName},void 0,s.name),f=p?En(m.formatList(p,{style:"long",type:"conjunction"})):p;let h;return h=void 0===f?Eo({propertyName:S}):1===g?Do({propertyName:S,propertyValue:f[0]}):Ko({propertyName:S,propertyValue:f}),i()(Mn,{disabled:t,icon:_.Z.typesMultipleSelect,onClick:n,onDelete:r,onEdit:a,title:i()("div",{style:y.content},void 0,l.createElement(d.FormattedMessage,h))})}var Wn=o(69265);function Gn(e){window.__c={n:"UpdateRelationPropertyAction"};const{collectionStore:t,disabled:o,onClick:n,onDelete:r,onEdit:a,propertySchema:s,value:c}=e,u=(0,M.yK)((()=>({content:{alignItems:"center",display:"flex",flex:"1 1 auto",minWidth:0,whiteSpace:"pre"},propertyName:{...x.Z.textOverflowStyle,fontWeight:x.Z.fontWeight.semibold,minWidth:20},propertyValue:{...x.Z.textOverflowStyle,minWidth:40},propertyValueList:{display:"flex",flexBasis:"100%",flexDirection:"column",listStyle:"none",margin:0,marginBlockStart:10,padding:0,rowGap:10}})),[]),p=c?Ln(c,s.limit):[],g=i()("span",{style:u.propertyName},void 0,s.name);let m;return m=0===p.length?i()("div",{style:u.content},void 0,l.createElement(d.FormattedMessage,Io({propertyName:g}))):1===p.length?i()("div",{style:u.content},void 0,l.createElement(d.FormattedMessage,Bo({propertyName:g,propertyValue:i()("span",{style:u.propertyValue},void 0,i()(Wn.Z,{blockId:p[0],format:Tn.l.Medium,isSingle:!0,noUnderline:!0,parentStore:t,shouldShrink:!0}))}))):l.createElement(l.Fragment,null,i()("div",{style:u.content},void 0,l.createElement(d.FormattedMessage,Zo({propertyName:g,propertyValue:[]}))),i()("ul",{style:u.propertyValueList},void 0,p.map((e=>i()("li",{},e,i()(Wn.Z,{blockId:e,format:Tn.l.Medium,isSingle:!0,noUnderline:!0,parentStore:t,shouldShrink:!0})))))),i()(Mn,{disabled:o,icon:_.Z.typesRelation,onClick:n,onDelete:r,onEdit:a,title:m})}function Ln(e,t){return(0,Ht.A6)(e.value).slice(0,t).map((e=>{if(!function(e){return"string"!=typeof e&&"boolean"!=typeof e&&(0,Qt.ST)(e)}(e))return;const t=(0,Qt.TO)(e);return t||void 0})).filter(k.$K)}var zn=o(29502),Un=o(49085);class Hn extends Un.default{getInitialState(){return{stack:[]}}getCurrentTab(){return O().last(this.getState().stack)}pushSettingsItem(e){this.update((t=>({...t,stack:[...t.stack,e]})))}popSettingsItem(){this.update((e=>({stack:e.stack.slice(0,e.stack.length-1)})))}replaceSettingsItem(e){this.update((t=>{const o=[...t.stack.slice(0,t.stack.length-1),e];return{...t,stack:o}}))}}class $n extends Hn{}class qn extends Hn{}var jn=o(98459),Yn=o(71846),Qn=o(40721);const Xn=(0,d.defineMessages)({backButtonAriaLabel:{id:"notificationRuleSettingsMenu.backButton.ariaLabel",defaultMessage:"Back to previous step"}});function Jn(e){window.__c={n:"AutomationTriggerActionMenu"};const{type:t,automationTriggerActionMenuStore:o,headerTitle:n,onClose:i,width:r,onDone:s}=e,c=ni({automationTriggerActionMenuStore:o,onClose:i,onDone:s,title:n,width:r});return"custom"===t?l.createElement(ti,a()({},e,{menuProps:c})):l.createElement(ei,a()({},e,{menuProps:c}))}function ei(e){const{sections:t,menuProps:o}=e;return l.createElement(we.Z,o,i()(De.Z,{type:De.i.Vertical,initialFocus:0,sections:t}))}function ti(e){const{children:t,menuProps:o}=e;return l.createElement(we.Z,o,t)}function oi(e){window.__c={n:"BackToPreviousStepButton"};const{automationActionMenuStore:t,menuHeaderTitle:o,onDone:n}=e,r=(0,d.useIntl)(),a=(0,w.VK)((()=>t.state.stack.length>1),[t]),l=(0,M.yK)((e=>({header:{display:"flex",alignItems:"center",margin:8,color:e.mediumTextColor,fontWeight:x.Z.fontWeight.medium,fontSize:x.Z.fontSize.UISmall.desktop},iconButtonStyle:{marginRight:8,marginLeft:-2,height:22},iconButtonIconStyle:{width:16,height:16},doneButtonStyle:{marginLeft:"auto"}})),[]);return void 0!==o||a?i()("div",{style:l.header},void 0,a&&i()(Cn.Z,{ariaLabel:r.formatMessage(Xn.backButtonAriaLabel),icon:_.Z.arrowLeftThick,style:l.iconButtonStyle,iconStyle:l.iconButtonIconStyle,onClick:()=>{t.popSettingsItem()}}),o,n&&i()(Pt.Z,{onClick:n,isBlue:!0,style:l.doneButtonStyle},void 0,i()(d.FormattedMessage,{id:"automationTriggerActionMenu.doneButton.title",defaultMessage:"Done"}))):null}function ni(e){const{automationTriggerActionMenuStore:t,leftStyle:o,onClose:n,onDone:r,rightStyle:a,title:s,titleStyle:c,width:u}=e,{isMobile:p}=(0,C.Fy)(),g=(0,d.useIntl)(),m=(0,l.useCallback)((()=>{1===t.getState().stack.length?n():t.popSettingsItem()}),[t,n]);return(0,l.useMemo)((()=>{let e;return e=p?{leftOuterStyle:o,menuType:ve.og.Modal,title:s,titleOuterStyle:c,left:i()(Cn.Z,{ariaLabel:g.formatMessage(Xn.backButtonAriaLabel),icon:_.Z.historyBack,onClick:m}),right:i()(Qn.DoneMenuText,{}),rightOuterStyle:a,onClickRight:()=>{null==r||r(),n()}}:{width:u??266,menuType:ve.og.Popup,maxHeight:"50vh",header:i()(oi,{automationActionMenuStore:t,menuHeaderTitle:s,onDone:r})},e}),[t,g,p,o,n,r,m,a,s,c,u])}function ii(e){window.__c={n:"AutomationEventActionCreatePage"};const{automationActionMenuStore:t,automationStore:o,collectionStore:n,onClose:r,updateCurrentState:a}=e,s=(0,c.ZP)(),u=(0,C.O7)(),p=ni({automationTriggerActionMenuStore:t,leftStyle:{flexGrow:0},onClose:r,rightStyle:{flexGrow:0},title:i()(d.FormattedMessage,{defaultMessage:"Add page to‚Ä¶",id:"automationEventActionCreatePage.menu.title"})}),g=(0,l.useCallback)((()=>{pe.tW({environment:u,eventName:"abandoned_search",sessionId:s,source:Yn.S.Automation})}),[u,s]);p.menuType===ve.og.Popup&&(p.onClickOutside=g);const m=gn({automationStore:o,collectionStore:n}),y=(0,l.useCallback)((e=>{a({action:{id:(0,c.ZP)(),config:{collection:{...e.pointer,spaceId:(0,jn.CG)(e.pointer.spaceId)},properties:["title"],values:{}},type:"create_page"},type:"update_action"}),r()}),[r,a]);return m?l.createElement(we.Z,p,i()(Yn.Z,{context:Yn.S.Automation,onAccept:y,parentStore:m.context.parentRecordStore,requireEditPermissions:!0,searchSessionId:s})):null}var ri=o(1865),ai=o(5971);const li=(0,d.defineMessages)({searchInputPlaceholder:{id:"automationEventActionMenu.searchInputPlaceholder.label",defaultMessage:"Search for action‚Ä¶"}});function si(e){window.__c={n:"AutomationEventActionMenu"};const{availableActions:t,automationActionMenuStore:o,automationStore:n,collectionStore:r,updateCurrentState:s,onClose:c}=e,u=(0,M.Fg)(),p=(0,d.useIntl)(),{isMobile:g}=(0,C.Fy)(),m=(0,C.O7)(),[y,S]=l.useState(""),f=(0,w.VK)((()=>r.getSchema()),[r]),h=Yo(),v=(0,w.VK)((()=>function(e){const{automationStore:t,collectionStore:o,searchInput:n}=e,i=new Set(t.getActionStores().flatMap((e=>e.isType("update_pages")?e.getConfigStore().getKeyStore("properties").getValue()??[]:[]))),r=o.getFormat(),a=o.getSchema(),l=(0,Ot.cO)({collectionFormat:r,collectionSchema:a,filter:e=>{let[t]=e;return!i.has(t)}}),s=new Map,c=l.map((e=>{const t=a[e];if(t){const o=`${t.name} ${Ve.SO[t.type]}`;return s.set(e,o),o}})).filter(k.$K),d=new Set(Pe().filter(n,c).map((e=>{let{original:t}=e;return t})));return l.filter((e=>{const t=s.get(e);return t&&d.has(t)}))}({automationStore:n,collectionStore:r,searchInput:y})),[n,r,y]),b=(0,w.VK)((()=>function(e){const{availableActions:t,searchInput:o}=e;if(0===t.length)return[];const n=new Map,i=t.map((e=>{const t=Fe.default.formatMessage(e.display.name);return n.set(e.type,t),t})),r=new Set(Pe().filter(o,i).map((e=>{let{original:t}=e;return t})));return t.filter((e=>{const t=n.get(e.type);return t&&r.has(t)}))}({availableActions:t,searchInput:y})),[t,y]),x=(0,ai.E)("status_automations_m2"),T=(0,w.VK)((()=>x&&!(0,uo.mq)()),[x]),P=(0,l.useCallback)((()=>{c(),ri.y(m,{for:"plus",from:"database_automation_action_item"})}),[m,c]),A=b.length>0?function(e){const{automationActionMenuStore:t,actions:o,initialSlackActionSelectMenuState:n,showTopBorder:i,theme:r}=e,s=o.map((e=>function(e){const{automationActionMenuStore:t,action:o,initialSlackActionSelectMenuState:n,theme:i}=e;if("slack_notification"===o.type)return{key:"slack_action",action:()=>{t.pushSettingsItem(n)},render:e=>l.createElement(Ze.Z,a()({},e,{icon:o.display.icon({fill:i.regularIconColor,marginLeft:2,marginRight:8,width:12,height:"auto"}),right:_.Z.chevronRight({marginInlineStart:6,width:12,height:"auto"}),title:l.createElement(d.FormattedMessage,o.display.name)}))};if("create_page"===o.type)return{key:"create_page",action:()=>{t.pushSettingsItem({actionId:void 0,type:"eventActionCreatePage"})},render:e=>l.createElement(Ze.Z,a()({},e,{icon:o.display.icon({fill:i.regularIconColor,marginInline:"2px 8px",width:14}),right:_.Z.chevronRight({marginInlineStart:6,width:12}),title:l.createElement(d.FormattedMessage,o.display.name)}))};if("update_pages"===o.type)return{key:"update_pages",action:()=>{t.pushSettingsItem({actionId:void 0,automationId:"",type:"eventActionUpdatePages"})},render:e=>l.createElement(Ze.Z,a()({},e,{icon:o.display.icon({fill:i.regularIconColor,marginInline:"2px 8px",width:14}),right:_.Z.chevronRight({marginInlineStart:6,width:12}),title:l.createElement(d.FormattedMessage,o.display.name)}))}}({automationActionMenuStore:t,action:e,initialSlackActionSelectMenuState:n,theme:r}))).filter(k.$K);if(0===s.length)return;return{key:"other_actions_section",items:s,render:e=>l.createElement(E.Z,a()({},e,{topBorder:i}))}}({automationActionMenuStore:o,actions:b,initialSlackActionSelectMenuState:h,theme:u}):void 0,V=v.length>0&&!T?function(e){const{automationActionMenuStore:t,properties:o,collectionSchema:n,theme:r,updateCurrentState:s,onClose:c,showTopBorder:u}=e,p=o.map((e=>function(e){const{automationActionMenuStore:t,propertyId:o,collectionSchema:n,theme:r}=e,s=n[o];if(!s)return;return{key:o,action:()=>{t.pushSettingsItem({propertyId:o,actionId:void 0,type:"eventActionProperty"})},render:e=>l.createElement(Ze.Z,a()({},e,{icon:i()(xn.ZP,{icon:s.icon,size:16,style:{fill:r.regularIconColor,marginRight:6},theme:r,type:s.type}),right:_.Z.chevronRight({marginInlineStart:6,width:12,height:"auto"}),title:s.name}))}}({propertyId:e,collectionSchema:n,theme:r,updateCurrentState:s,automationActionMenuStore:t,onClose:c}))).filter(k.$K);if(0===p.length)return;return{key:"page_properties_edited_section",items:p,render:e=>l.createElement(E.Z,a()({},e,{title:i()(d.FormattedMessage,{id:"automationEventActionMenu.pagePropertiesEditedSection.title",defaultMessage:"Edit property"}),topBorder:u}))}}({automationActionMenuStore:o,properties:v,collectionSchema:f,showTopBorder:(0,k.$K)(A),theme:u,updateCurrentState:s,onClose:c}):void 0,F=T?function(e){const{onUpsellClick:t,theme:o}=e;return{key:"upsell_section",items:[{action:()=>t(),key:"upsell_item",render:e=>l.createElement(Ze.Z,a()({},e,{icon:i()("div",{style:{background:o.accentColors.yellow[50],borderRadius:3,height:20,padding:3,width:20}},void 0,_.Z.boltFilled({fill:o.icon.yellow,height:"100%",width:"100%"})),right:_.Z.alias({height:"auto",marginBlockStart:2,width:12}),rightStyle:{alignSelf:"start"},caption:i()(d.FormattedMessage,{defaultMessage:"Automatically set properties, create new pages, and more with automations.",id:"automationEventActionMenu.upsellSection.caption"}),title:i()(d.FormattedMessage,{defaultMessage:"Upgrade for more actions",id:"automationEventActionMenu.upsellSection.title"}),shouldWrapCaption:!0}))}],render:e=>l.createElement(E.Z,a()({},e,{topBorder:!0}))}}({onUpsellClick:P,theme:u}):void 0,I=(0,vn.F)({width:266,paddingBottom:2});I.header=i()(Ee.ZP,{onChange:e=>{S(e.target.value)},placeholder:p.formatMessage(li.searchInputPlaceholder),style:{marginBlock:"12px 2px"},value:y}),g||(I.maxHeight="50vh");const B=[A,V].filter(k.$K),Z={key:"no_results_section",items:[{key:"no_results_item",action:()=>{},render:e=>l.createElement(Ze.Z,a()({},e,{disabled:!0,disabledFeedback:!0,title:i()(d.FormattedMessage,{defaultMessage:"No results",id:"automations.automationEventActionMenu.noResultsItem"})}))}],render:e=>l.createElement(E.Z,e)},D=(0===B.length?[Z,F]:[...B,F]).filter(k.$K);return l.createElement(we.Z,I,i()(De.Z,{type:De.i.Vertical,sections:D,initialFocus:0}))}var ci=o(10450),di=o(30823),ui=o(55950),pi=o(87494);const gi=(0,d.defineMessages)({menuHeaderTitle:{defaultMessage:"Set {propertyName} to",id:"automations.eventActionProperty.menuHeaderTitle"}});function mi(e){var t;window.__c={n:"AutomationEventActionProperty"};const{actionId:o,automationActionMenuStore:n,automationStore:r,collectionStore:s,onClose:u,propertyId:p,updateCurrentState:g}=e,m=(0,d.useIntl)(),y=gn({automationStore:r,collectionStore:s}),S=o??(0,c.ZP)(),f=(0,w.VK)((()=>s.getSchema()[p]),[s,p]),h=(0,l.useMemo)((()=>!!f&&("multi_select"===f.type||(0,ce.en)(f)&&1!==f.limit)),[f]),v=Boolean(f&&"button"!==f.type&&"rollup"!==f.type&&"formula"!==f.type&&"text"===(0,di.vc)(f.type)),b=Boolean(f&&"button"!==f.type&&"rollup"!==f.type&&"formula"!==f.type&&"number"===(0,di.vc)(f.type)),C=Boolean(f&&"date"===f.type),M=Boolean(f&&"status"===f.type),_=(0,w.VK)((()=>{if(f)return(0,Ht.qW)({table:ao.v,id:s.id,spaceId:s.getSpaceId()},p,f)}),[s,f,p]),k=(0,w.VK)((()=>{const e=r.getActionStores();if(S&&e.length>0){const t=e.find((e=>e.id===S));if(t&&t.isType("update_pages"))return t.getConfigStore().getKeyStore("values").getKeyStore(p).getValue()}}),[r,S,p]),[T,P]=(0,l.useState)(k),A=(0,l.useRef)(null==k?void 0:k.value),V=(0,Ht.A6)(null==T||null===(t=T.value)||void 0===t?void 0:t.value),F=(0,w.VK)((()=>{if(!y)return[];return y.context.automationStore.getActionIds().some((e=>e===S))?y.getContextValuesForAction(S):y.getAllContextValues()}),[y,S]),I=(0,l.useCallback)((e=>{g({action:{id:S,config:{properties:[p],target:{id:(0,ci.J0)(),type:"variable"},values:{[p]:{action:"replace",value:e}}},type:"update_pages"},type:"update_action"})}),[S,p,g]),B=(0,l.useCallback)((()=>{I(A.current),u()}),[I,u]),Z=(0,l.useCallback)((e=>{if(A.current=e,v||b||h)P({action:"replace",value:e});else if(C){const t=(0,Ht.A6)(null==e?void 0:e.value);0===t.length?B():(0,Ht.S3)(t[0])&&(0,Qt.fp)(t[0])&&P({action:"replace",value:e})}}),[C,v,b,h,B]),E=ni({automationTriggerActionMenuStore:n,leftStyle:{flexGrow:0},onClose:B,onDone:h||v||b?B:void 0,rightStyle:{flexGrow:0},title:i()("div",{style:{display:"inline-flex",minWidth:0,whiteSpace:"pre"}},void 0,m.formatMessage(gi.menuHeaderTitle,{propertyName:i()("div",{style:{...x.Z.textOverflowStyle}},void 0,(null==f?void 0:f.name)??"")})),titleStyle:{minWidth:0}});if(!f||!_||!y)return null;const D={type:"collection",collectionStore:s,property:p},K=(0,pi.li)(f.type);return l.createElement(ui.a,a()({context:D,contextStore:y,currentSimpleFormulaValueTokens:V,disabled:!1,formulaTypecheckContextValues:F,menuProps:E,onChange:Z,onClose:B,showClearButton:!M,type:_,value:null==T?void 0:T.value},K))}var yi=o(29758);function Si(e){window.__c={n:"AutomationEventActionUpdatePagesMenu"};const{actionId:t,automationActionMenuStore:o,automationStore:n,collectionStore:r,onClose:a,updateCurrentState:s}=e,u=(0,Wt.z)("update_pages"),p=gn({automationStore:n,collectionStore:r}),g=ni({automationTriggerActionMenuStore:o,leftStyle:{flexGrow:0},onClose:a,rightStyle:{flexGrow:0},title:l.createElement(d.FormattedMessage,u.display.name)}),m=(0,l.useCallback)((e=>{s({action:{id:(0,c.ZP)(),config:{properties:["title"],target:e,values:{}},type:"update_pages"},type:"update_action"}),a()}),[a,s]);return p?l.createElement(we.Z,g,i()(yi.H,{actionId:t,automationContextStore:p,onChange:m,onClose:a,skipPages:!0})):null}var fi=o(32161),hi=o(5500),vi=o(18441);function bi(e){window.__c={n:"AutomationSlackConnectToSlackView"};const{type:t,automationActionMenuStore:o,onClose:n}=e,r=_i(),s=(0,w.VK)((()=>{var e;return null===(e=yn.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),c=(0,w.VK)((()=>yn.default.state.currentUserStore),[]),u=(0,w.VK)((()=>{if("connectToSlackReconnect"===t&&c)return(0,co.Kv)(c,{table:fi.P,id:e.externalBotId,spaceId:s}).getValue()}),[s,c,e,t]);let p,g=Mi({viewType:"connectToSlackDefault"});if("connectToSlackReconnect"===t){if(!u)return null;const{accountName:e,organizationName:t}=(0,vi.jg)(u);p=(0,vi.jc)(u),g=Mi({viewType:"connectToSlackReconnect",accountName:e,organizationName:t})}return i()(Jn,{type:"custom",automationTriggerActionMenuStore:o,onClose:n},void 0,i()(E.Z,{},void 0,i()("div",{style:r.container},void 0,i()(wi,{}),i()("div",{style:r.connectToSlackBody},void 0,i()("div",{style:r.connectToSlackTitleText},void 0,function(e){if("connectToSlackDefault"===e)return i()(d.FormattedMessage,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.title",defaultMessage:"Connect to Slack"});if("connectToSlackReconnect"===e)return i()(d.FormattedMessage,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.reconnect.title",defaultMessage:"Reconnect to Slack"});(0,k.t1)(e)}(t)),i()("div",{style:r.connectToSlackDescriptionText},void 0,g)),l.createElement(Ci,a()({},e,{slackWorkspaceId:p})))))}function Ci(e){window.__c={n:"AuthActionButtons"};const{automationActionMenuStore:t,slackWorkspaceId:o}=e,n=(0,C.O7)(),r=_i(),a=(0,w.VK)((()=>{var e;return null===(e=yn.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),l=(0,w.VK)((()=>Zt.Z.integrations.state.find((e=>e.id===hi.nO))),[]);return l&&a?i()("div",{style:r.buttonGroup},void 0,i()(fe.Z,{style:r.connectToSlackButton,isLarge:!0,onClick:async()=>{const i=await It.hM({environment:n,integration:l,spaceId:a,from:"collection_view_settings",options:{slackWorkspaceId:o}});no.x.isFail(i)?t.replaceSettingsItem({type:"selectWorkspace"}):"connectToSlackReconnect"===e.type||("connectToSlackDefault"===e.type?i.value.externalAuthentication?t.replaceSettingsItem({type:"selectChannelNew",currentExternalAuthentication:i.value.externalAuthentication}):t.replaceSettingsItem({type:"selectWorkspace"}):(0,k.t1)(e))}},void 0,i()(d.FormattedMessage,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.connectButton.label",defaultMessage:"Connect"})),i()(Pt.Z,{style:r.cancelButton,isLarge:!0,onClick:()=>{t.popSettingsItem()}},void 0,i()(d.FormattedMessage,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.cancelButton.label",defaultMessage:"Cancel"}))):null}function wi(){window.__c={n:"SlackIcon"};const e=_i();return i()("div",{},void 0,i()("img",{src:gt.Z.images.externalIntegrations.slackIconPng,style:e.slackIcon}))}function Mi(e){const{viewType:t}=e;return"connectToSlackDefault"===t?i()(d.FormattedMessage,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.description",defaultMessage:"Get notified in channels, see rich previews, and more."}):"connectToSlackReconnect"===t?i()(d.FormattedMessage,{id:"AutomationSlackConnectToSlackView.reconnect.description",defaultMessage:'Reconnect your Slack account ({accountName}) on {hasOrganizationName, select, true {"{organizationName}"} other {your Slack workspace}} to resume your notifications.',values:{accountName:e.accountName,hasOrganizationName:(0,k.$K)(e.organizationName),organizationName:e.organizationName}}):void(0,k.t1)(t)}function _i(){return(0,M.yK)((e=>({container:{display:"flex",flexDirection:"column",margin:"10px 15px",justifyContent:"center",textAlign:"center"},connectToSlackBody:{margin:"0px 25px"},connectToSlackTitleText:{marginBottom:2,fontWeight:x.Z.fontWeight.semibold},connectToSlackDescriptionText:{fontSize:13,color:e.mediumTextColor},slackIcon:{width:23,height:"auto"},buttonGroup:{margin:"10px 10px 0px 10px"},connectToSlackButton:{width:"100%"},cancelButton:{color:e.mediumTextColor,width:"100%",justifyContent:"center",fontWeight:x.Z.fontWeight.medium,fontSize:13,marginTop:8}})),[])}var ki=o(89074);function xi(e){window.__c={n:"AutomationSlackSelectChannelView"};const{automationActionMenuStore:t,updateCurrentAutomationState:o,onClose:n}=e,r="selectChannelUpdate"===e.type?e.actionId:void 0,a=l.useCallback(((e,t)=>{o({type:"update_action",action:{id:r??(0,c.ZP)(),type:"slack_notification",config:{target:e,external_bot_id:t.parent_id}}}),n()}),[r,n,o]),s=(0,l.useCallback)((()=>{const e=t.getState().stack;e.length<2||("selectWorkspace"===e[e.length-2].type?t.popSettingsItem():t.replaceSettingsItem({type:"selectWorkspace"}))}),[t]);return i()(ki.ZP,{currentExternalAuthentication:e.currentExternalAuthentication,currentNotificationChannel:"selectChannelNew"===e.type?void 0:"selectChannelUpdate"===e.type?e.currentNotificationChannel:(0,k.t1)(e),onClose:n,onNotificationChannelSelect:a,onNewSlackAccountAdded:s,renderMenu:e=>i()(Jn,{type:"default",automationTriggerActionMenuStore:t,headerTitle:i()(d.FormattedMessage,{id:"notificationRuleSettings.selectChannelView.title",defaultMessage:"Select Slack channel"}),sections:e,onClose:n})})}var Ti=o(93364);function Pi(e){const{automationActionMenuStore:t,onClose:o}=e,n=l.useCallback((e=>{t.pushSettingsItem({type:"selectChannelNew",currentExternalAuthentication:e})}),[t]);return i()(Ti.U,{onWorkspaceSelect:n,renderMenu:e=>i()(Jn,{type:"default",automationTriggerActionMenuStore:t,headerTitle:i()(d.FormattedMessage,{id:"notificationRuleSettings.selectSlackWorkspace.title",defaultMessage:"Select Slack workspace"}),sections:e,onClose:o})})}function Ai(e){window.__c={n:"AutomationActionMenuController"};const{automationStore:t,collectionStore:o,initialState:n,updateCurrentAutomationState:r,buttonPopupParent:a}=e,s=(0,w.VK)((()=>{const e=new qn;return e.setState({stack:[n]}),e}),[n]),c=(0,w.VK)((()=>s.getCurrentTab()),[s]),d=(0,l.useCallback)((()=>a.close()),[a]);if(!c)return null;if("connectToSlackDefault"===c.type)return i()(bi,{type:"connectToSlackDefault",automationActionMenuStore:s,onClose:d});if("connectToSlackReconnect"===c.type)return i()(bi,{type:"connectToSlackReconnect",externalBotId:c.externalBotId,notificationActionConfigStore:c.notificationActionConfigStore,automationActionMenuStore:s,onClose:d});if("selectWorkspace"===c.type)return i()(Pi,{automationActionMenuStore:s,onClose:d});if("selectChannelNew"===c.type)return i()(xi,{type:"selectChannelNew",updateCurrentAutomationState:r,currentExternalAuthentication:c.currentExternalAuthentication,automationActionMenuStore:s,onClose:d});if("selectChannelUpdate"===c.type)return i()(xi,{type:"selectChannelUpdate",updateCurrentAutomationState:r,actionId:c.actionId,currentExternalAuthentication:c.currentExternalAuthentication,currentNotificationChannel:c.currentNotificationChannel,automationActionMenuStore:s,onClose:d});if("eventActions"===c.type)return i()(si,{availableActions:c.availableActions,automationActionMenuStore:s,automationStore:t,collectionStore:o,onClose:d,updateCurrentState:r});if("eventActionProperty"===c.type){const{propertyId:e,actionId:n}=c;return i()(mi,{actionId:n,automationActionMenuStore:s,automationStore:t,collectionStore:o,onClose:d,propertyId:e,updateCurrentState:r})}return"eventActionCreatePage"===c.type?i()(ii,{automationStore:t,automationActionMenuStore:s,collectionStore:o,onClose:d,updateCurrentState:r}):"eventActionUpdatePages"===c.type?i()(Si,{actionId:c.actionId,automationActionMenuStore:s,automationStore:t,collectionStore:o,onClose:d,updateCurrentState:r}):(0,k.t1)(c)}const Vi=(0,d.defineMessages)({slackNonOwnerPrivateChannel:{id:"slackNotificationAction.slackTargetPersonalChannel.displayName",defaultMessage:"Private channel"}});function Fi(e){window.__c={n:"SlackNotificationAction"};const{actionStore:t,automationStore:o,collectionStore:n,currentUserIsOwner:r,disabled:s,updateCurrentAutomationState:c}=e,u=(0,zn.d)(),p=(0,w.VK)((()=>t.getConfig()),[t]),g=(0,w.VK)((()=>Zt.Z.completeSlackAuthentications.state.find((e=>(null==p?void 0:p.external_bot_id)===e.id))),[p]),m=(0,w.VK)((()=>"disabled_auth"===(null==o?void 0:o.getStatus())),[o]),y=(0,w.VK)((()=>p&&g&&p.target?o&&t&&p.external_bot_id&&m?{type:"connectToSlackReconnect",externalBotId:p.external_bot_id,notificationActionConfigStore:t}:{type:"selectChannelUpdate",actionId:t.id,currentExternalAuthentication:g,currentNotificationChannel:p.target}:{type:"connectToSlackDefault"}),[p,t,o,g,m]),S=Bi();return r?i()(Ce.ZP,{alignmentToOrigin:Ce.vR.Center,placementToOrigin:Ce.pO.Bottom,popupType:u,render:e=>i()(Ai,{automationStore:o,initialState:y,updateCurrentAutomationState:c,buttonPopupParent:e,collectionStore:n}),renderOrigin:e=>l.createElement(Mn,a()({},e,{disabled:s,onClick:()=>{e.onClick()},title:i()(Ii,{actionStore:t,currentUserIsOwner:r}),icon:_.Z.slackLogo,caption:m&&i()("div",{style:S.container},void 0,_.Z.warning(S.warningIcon),i()("div",{style:S.caption},void 0,i()(d.FormattedMessage,{id:"SlackNotificationAction.caption.reconnectNeeded",defaultMessage:"Reconnect Slack to resume"}))),onEdit:()=>{e.onClick()},onDelete:()=>{c({type:"remove_action",action:{id:t.id,type:"slack_notification"}})}}))}):i()(Mn,{disabled:!0,icon:_.Z.slackLogo,title:i()("div",{style:S.container},void 0,i()("div",{style:{fontWeight:500,marginRight:4}},void 0,i()(d.FormattedMessage,{id:"slackNotificationAction.actionTitle.slackNotification",defaultMessage:"Notify"})),i()(Ei,{actionStore:t,isUserAutomationOwner:r}))})}function Ii(e){window.__c={n:"SlackActionTitle"};const{actionStore:t,currentUserIsOwner:o}=e,n=Bi(),r=(0,w.VK)((()=>t.getConfig()),[t]);return r&&r.external_bot_id&&r.target?i()("div",{style:n.container},void 0,i()("div",{style:{fontWeight:500,marginRight:4}},void 0,i()(d.FormattedMessage,{id:"slackNotificationAction.actionTitle.slackNotification",defaultMessage:"Notify"})),i()(Ei,{actionStore:t,isUserAutomationOwner:o})):i()("div",{style:n.container},void 0,i()(d.FormattedMessage,{id:"slackNotificationAction.actionTitle.slackNotificationPlaceholder",defaultMessage:"Send Slack notification to‚Ä¶"}))}function Bi(){return(0,M.yK)((e=>({container:{display:"flex",flexDirection:"row",alignItems:"center",padding:0,gap:4},caption:{fontSize:12,fontWeight:400,color:e.mediumTextColor},warningIcon:{width:12,height:"auto",color:e.accentColors.orange[400]}})),[])}function Zi(e){const{isMobile:t}=e,o=t?x.Z.fontSize.UISmall.mobile:x.Z.fontSize.UISmall.desktop;return(0,M.yK)((()=>({overflow:{...x.Z.textOverflowStyle},container:{display:"inline-flex",alignItems:"baseline",gap:2},lockIcon:{width:o,height:"auto",alignSelf:"center"}})),[o])}function Ei(e){window.__c={n:"SlackChannelWithIcon"};const{actionStore:t,isUserAutomationOwner:o}=e,n=(0,C.O7)(),r=(0,w.VK)((()=>Boolean((0,dn.IJ)(n,t))),[t,n]),a=(0,w.VK)((()=>{var e;return null===(e=t.getConfig())||void 0===e?void 0:e.target}),[t]);return!a||r?i()(Ri,{}):"public"===a.type?i()(Di,{channelName:a.name}):"private"===a.type?i()(Ki,{channelName:a.name,isUserAutomationOwner:o}):"me"===a.type?i()(Ni,{channelName:a.name,isUserAutomationOwner:o}):(0,k.t1)(a.type)}function Di(e){window.__c={n:"PublicSlackChannel"};const{isMobile:t}=(0,C.Fy)(),o=Zi({isMobile:t});return i()("span",{style:o.overflow},void 0,`#${e.channelName}`)}function Ki(e){window.__c={n:"PrivateSlackChannel"};const{channelName:t,isUserAutomationOwner:o}=e,{isMobile:n}=(0,C.Fy)(),r=Zi({isMobile:n});return o?i()("span",{style:{...r.overflow,...r.container}},void 0,_.Z.locked(r.lockIcon),t):i()(Ri,{})}function Ni(e){window.__c={n:"MeSlackChannel"};const{channelName:t,isUserAutomationOwner:o}=e,{isMobile:n}=(0,C.Fy)(),r=Zi({isMobile:n});return o?i()("span",{style:r.overflow},void 0,`@${t}`):i()(Ri,{})}function Ri(){window.__c={n:"NonOwnerPrivateChannel"};const e=(0,d.useIntl)(),{isMobile:t}=(0,C.Fy)(),o=Zi({isMobile:t}),n=e.formatMessage(Vi.slackNonOwnerPrivateChannel);return i()("span",{style:{...o.overflow,...o.container}},void 0,_.Z.locked(o.lockIcon),n)}var Oi=o(92864);const Wi=(0,d.defineMessages)({automationSummaryCardMoreButtonAriaLabel:{defaultMessage:"More",id:"automations.AutomationSummaryCard.MoreActionsButton.ariaLabel"},automationSummaryCardMoreMenuEditTitle:{defaultMessage:"Edit",id:"automations.AutomationSummaryCard.MoreActionsMenu.Edit.title"},automationSummaryCardMoreMenuDuplicateTitle:{defaultMessage:"Duplicate",id:"automations.AutomationSummaryCard.MoreActionsMenu.Duplicate.title"},automationSummaryCardMoreMenuPauseTitle:{defaultMessage:"Pause",id:"automations.AutomationSummaryCard.MoreActionsMenu.Pause.title"},automationSummaryCardMoreMenuResumeTitle:{defaultMessage:"Resume",id:"automations.AutomationSummaryCard.MoreActionsMenu.Resume.title"},automationSummaryCardMoreMenuDeleteTitle:{defaultMessage:"Delete",id:"automations.AutomationSummaryCard.MoreActionsMenu.Delete.title"}});function Gi(e){window.__c={n:"AutomationSummaryMoreActionsButton"};const{focused:t,style:o,onEdit:n,onDelete:r,onDuplicate:s,onDisable:c,onEnable:u}=e,p=(0,d.useIntl)(),g=(0,w.qz)(void 0,V.Z),m=(0,zn.d)();(0,l.useEffect)((()=>{t||g.setState({open:!1})}),[t,g]);const y=(0,M.yK)((e=>({iconButton:{border:`1px solid ${e.regularDividerColor}`,height:26,width:26,...o},iconButtonIcon:{width:16}})),[o]);return l.createElement(l.Fragment,null,i()(Ce.ZP,{stopClickPropagation:!0,popupType:m,alignmentToOrigin:Ce.vR.Center,placementToOrigin:Ce.pO.Bottom,originGap:0,renderOrigin:e=>l.createElement(Cn.Z,a()({ariaLabel:p.formatMessage(Wi.automationSummaryCardMoreButtonAriaLabel),icon:_.Z.dots,iconStyle:y.iconButtonIcon,style:y.iconButton,hasBackground:!0},e)),render:e=>i()(Li,{onClose:()=>e.close(),onEdit:n,onDelete:r,onDuplicate:s,onDisable:c,onEnable:u}),buttonPopupStore:g}))}function Li(e){window.__c={n:"MoreActionsMenu"};const{onClose:t,onEdit:o,onDelete:n,onDuplicate:r,onDisable:s,onEnable:c}=e,u=(0,d.useIntl)(),p=(0,vn.F)(),g=o?{action:()=>{t(),o()},key:"edit",render:e=>l.createElement(Ze.Z,a()({},e,{icon:_.Z.pencil({height:16,width:16}),title:u.formatMessage(Wi.automationSummaryCardMoreMenuEditTitle)}))}:void 0,m=r?{action:()=>{t(),r()},key:"duplicate",render:e=>l.createElement(Ze.Z,a()({},e,{icon:_.Z.duplicate({height:16,width:16}),title:u.formatMessage(Wi.automationSummaryCardMoreMenuDuplicateTitle)}))}:void 0,y=s?{action:()=>{t(),s()},key:"disable",render:e=>l.createElement(Ze.Z,a()({},e,{icon:_.Z.boltSlash({height:16,width:16}),title:u.formatMessage(Wi.automationSummaryCardMoreMenuPauseTitle)}))}:void 0,S=c?{action:()=>{t(),c()},key:"enable",render:e=>l.createElement(Ze.Z,a()({},e,{icon:_.Z.bolt({height:16,width:16}),title:u.formatMessage(Wi.automationSummaryCardMoreMenuResumeTitle)}))}:void 0,f=n?{action:()=>{t(),n()},key:"delete",render:e=>l.createElement(Ze.Z,a()({},e,{icon:_.Z.trash({height:16,width:16}),title:u.formatMessage(Wi.automationSummaryCardMoreMenuDeleteTitle)}))}:void 0;return l.createElement(we.Z,p,i()(De.Z,{type:De.i.Vertical,sections:[{items:[g,m,y,S,f].filter(k.$K),key:"items",render:e=>l.createElement(E.Z,a()({enableActionSheetTitle:!0,topBorder:!0},e))}],initialFocus:0}))}function zi(e){window.__c={n:"AutomationSummaryCard"};const{actions:t,caption:o,focused:n,hasWarning:r,maxIcons:a,onClick:s,onDelete:c,onDisable:d,onDuplicate:u,onEdit:p,onEnable:g,title:m,triggers:y}=e,{isMobile:S}=(0,C.Fy)(),f=(0,l.useRef)(null),[h,v]=(0,Sn.Z)(),[b,k]=fn(),T=(0,w.qz)(void 0,bn.Z),P=(0,w.VK)((()=>T.getState()),[T]),A=S||P.hovered||v||k,V=(0,M.yK)((e=>({wrap:{background:e.cardContentBackground,border:`1px solid ${e.regularDividerColor}`,borderRadius:8,display:"flex",flexDirection:"column",gap:15,padding:15,position:"relative"},moreButtonWrap:{display:A?"block":"none",position:"absolute",right:8,top:8},iconList:{display:"flex",flexWrap:"wrap",gap:5,listStyle:"none",margin:"0 30px 0 0",padding:0},body:{display:"flex",flexDirection:"column",gap:S?4:2},titleWrap:{...r?{alignItems:"center",display:"inline-flex",gap:4}:Xi(2),fontSize:S?16:14,fontWeight:x.Z.fontWeight.medium,lineHeight:"130%"},title:{...r?x.Z.textOverflowStyle:{}},warning:{color:e.accentColors.orange[400],height:"auto",width:S?16:14},caption:{...Xi(2),color:e.lightTextColor,fontSize:S?14:12,fontWeight:x.Z.fontWeight.regular,lineHeight:"130%",margin:0}})),[r,A,S]);(0,l.useEffect)((()=>{n&&null!==f.current&&f.current.focus()}),[n]);const F=(0,hn.lq)(f,h,b),I=function(e){const{actionIcons:t,maxIcons:o,triggerIcons:n}=e,i=n.length,r=t.length,a=i>0&&r>0,l=Math.max(o,3),s=a?l-1:l;let c=Math.max(Math.floor(s/2),1),d=Math.max(Math.ceil(s/2),1);if(i<c&&r>d){d+=c-i,c=i}else if(r<d&&i>c){c+=d-r,d=r}const u=[];if(i>0)if(i>c)if(1===c)u.push({color:"gray",type:"truncate",value:i});else{const e=i-(c-1);u.push(...n.slice(0,c-1)),u.push({color:"gray",type:"truncate",value:e})}else u.push(...n);a&&u.push({type:"arrow"});if(r>0)if(r>d)if(1===d)u.push({color:"gray",type:"truncate",value:r});else{const e=r-(d-1);u.push(...t.slice(0,d-1)),u.push({color:"gray",type:"truncate",value:e})}else u.push(...t);return u}({actionIcons:t,maxIcons:Qi(a),triggerIcons:y}),Z=Boolean(c||d||g||u||p);return l.createElement(B.Z,{onClick:s,ref:F,store:T,style:V.wrap},i()("header",{},void 0,Z&&i()("div",{style:V.moreButtonWrap},void 0,i()(Gi,{focused:A,onDelete:c,onDisable:d,onEnable:g,onDuplicate:u,onEdit:p})),i()("ul",{"aria-hidden":"true",style:V.iconList},void 0,I.map(((e,t)=>i()("li",{},t,i()(Ui,{icon:e})))))),i()("div",{style:V.body},void 0,i()("div",{style:V.titleWrap},void 0,i()("span",{style:V.title},void 0,m),r&&_.Z.warning(V.warning)),o&&i()("p",{style:V.caption},void 0,o)))}function Ui(e){const{icon:t}=e;return"property"===t.type||"page"===t.type||"misc"===t.type?i()(Hi,{color:t.color,icon:t.icon}):"person"===t.type?i()(Yi,{actor:t.actor}):"app"===t.type?i()(qi,{color:"default",icon:t.icon}):"arrow"===t.type?i()($i,{}):"truncate"===t.type?i()(ji,{color:t.color,value:t.value}):void(0,k.t1)(t.type)}function Hi(e){window.__c={n:"StandardIcon"};const{color:t,icon:o}=e,n=Ji(t);return i()("div",{"aria-hidden":"true",style:n.iconWrap},void 0,_.Z[o](n.icon))}function $i(){window.__c={n:"ArrowIcon"};const e=Ji("default");return i()("div",{style:{...e.iconWrap,...e.iconArrowWrap}},void 0,_.Z.arrowRight({...e.icon,...e.iconArrow}))}function qi(e){window.__c={n:"AppIcon"};const{icon:t}=e,o=Ji("default");return i()("div",{"aria-hidden":"true",style:o.iconAppWrap},void 0,_.Z[t](o.iconApp))}function ji(e){window.__c={n:"TruncateIcon"};const{color:t,value:o}=e,n=Ji(t);return i()("div",{style:{...n.iconWrap,...n.truncateWrap}},void 0,"+",o)}function Yi(e){window.__c={n:"PersonIcon"};const{actor:t}=e,o=Ji("default");return i()("div",{"aria-hidden":"true",style:o.iconPersonWrap},void 0,i()(Oi.ZP,{actor:t,avatarSize:26,format:Oi.ZP.Format.Inline,isSingle:!1,showRemoveButton:!1,style:{margin:0}}))}function Qi(e){return void 0===e||e<0?6:e}function Xi(e){return{display:"-webkit-box",overflow:"hidden",WebkitBoxOrient:"vertical",WebkitLineClamp:e}}function Ji(e){const t="default"===e?"gray":e;return(0,M.yK)((e=>{const o="light"===e.mode?400:800,n="light"===e.mode?100:400;return{icon:{fill:e.accentColors[t][o],width:16},iconWrap:{background:e.accentColors[t][n],borderRadius:6,padding:6},iconApp:{width:14},iconAppWrap:{borderRadius:6,borderWidth:1,borderStyle:"solid",borderColor:e.accentColors.gray[n],padding:6},iconPerson:{display:"block",width:"100%"},iconPersonWrap:{alignItems:"center",display:"flex",height:28,justifyContent:"center",width:28},iconArrow:{fill:e.accentColors.gray[600]},iconArrowWrap:{background:void 0},truncateWrap:{alignItems:"center",background:e.accentColors.gray[500],color:e.accentColors[t][o],display:"inline-flex",fontSize:12,fontWeight:x.Z.fontWeight.semibold,height:28,justifyContent:"center",padding:3,width:28}}}),[t])}var er=o(19889);function tr(e){window.__c={n:"AutomationCompactSummaryCard"};const{icon:t,title:o,caption:n,hasWarning:r,onEdit:a,onDelete:s}=e,[c,d]=(0,Sn.Z)(),[u,p]=fn(),g=(0,w.qz)(void 0,bn.Z),m=(0,w.VK)((()=>g.getState()),[g]).hovered||d||p,y=(0,hn.lq)(c,u),S=function(e){return(0,M.yK)((t=>({CompactAutomationSummaryCard:{background:t.cardContentBackground},buttonPosition:{position:"relative",paddingTop:8,paddingBottom:8},buttonBorder:{borderWidth:1,borderStyle:"solid",borderColor:t.outlineButtonBorder,borderRadius:8},warning:{width:16,height:"auto",color:t.accentColors.orange[400]},title:{display:"flex",flexDirection:"row",alignItems:"center",padding:0,gap:6},moreButtonWrap:{display:e?"block":"none",position:"absolute",right:8,top:8},hoveredStyle:{background:t.selectLightGray[100]},textOverflow:{textOverflow:"ellipsis",overflow:"hidden",minWidth:0,whiteSpace:"nowrap"}})),[e])}(m);return l.createElement(Ze.Z,{ref:y,focused:m,interactionStore:g,shouldWrapCaption:!0,buttonStyle:{...S.buttonPosition,...S.buttonBorder},hoveredStyle:S.hoveredStyle,title:i()("div",{},void 0,i()("header",{},void 0,i()("div",{style:S.moreButtonWrap},void 0,i()(Gi,{focused:m,onEdit:a,onDelete:s}))),i()("div",{style:S.title},void 0,t,i()("div",{style:S.textOverflow},void 0,o),r&&_.Z.warning(S.warning))),caption:n,onClick:a})}var or=o(62385);function nr(e){window.__c={n:"AutomationCreatorAttribution"};const{automationCreatorPointer:t}=e,o=(0,C.O7)(),n=(0,d.useIntl)(),r=(0,w.VK)((()=>t&&new co.U6(o,{table:er.KJ,id:t.id,spaceId:t.spaceId}).getDisplayName(n)),[t,o,n]);return i()(d.FormattedMessage,{id:"sendToSlack.automationCreatorCaption.label",defaultMessage:"Added by {automationCreatorName}",values:{automationCreatorName:r}})}const ir=(0,d.defineMessages)({pausedNotifications:{id:"NotificationRulesViewMain.slackChannel.notificationsPaused",defaultMessage:"Paused ‚Ä¢"},pagesAddedWithViewName:{id:"configureNotificationRuleMenu.sendToSlack.existingRule.createPageEventCaptionWithView",defaultMessage:"New pages{hasViewName, select, true { in {collectionViewName}} other {}}"},pagesEditedWithViewName:{id:"configureNotificationRuleMenu.sendToSlack.existingRule.updatePageEventCaptionWithView",defaultMessage:"Property edits{hasViewName, select, true { in {collectionViewName}} other {}}"},pagesAddedAndEditedWithViewName:{id:"configureNotificationRuleMenu.sendToSlack.existingRule.createdAndUpdatedEventCaptionWithView",defaultMessage:"New pages & edits{hasViewName, select, true { in {collectionViewName}} other {}}"},placeholder:{id:"database.viewSettings.notificationsTab.slack.placeholderCaption",defaultMessage:"None"}});function rr(e){var t;window.__c={n:"SlackAutomationCaption"};const{parentBlockStore:o,slackNotificationAutomation:n,currentUserId:r}=e,a=n.createdByPointer,l=a.id===r&&a.table===er.KJ,s=null===(t=n.trigger)||void 0===t?void 0:t.event,c=(0,d.useIntl)(),u=(0,C.O7)(),p=(0,w.VK)((()=>{if("collection_view"===s.source.type){const e=co.Xr.createChildStore(o,s.source.pointer);return(0,un.vU)({environment:u,intl:c,store:e})}}),[o,s,c,u]),g=c.formatMessage(function(e){const t=Boolean(e.pagesAdded),o="none"!==e.pagePropertiesEdited.type;return t?o?ir.pagesAddedAndEditedWithViewName:ir.pagesAddedWithViewName:o?ir.pagesEditedWithViewName:ir.placeholder}(s),{hasViewName:Boolean(p),collectionViewName:p});return i()("div",{style:{overflow:"hidden",textOverflow:"ellipsis"}},void 0,function(e,t){if("disabled_permissions"!==e)return"";return t.formatMessage(ir.pausedNotifications)}(n.automationStatus,c),l?g:i()(nr,{automationCreatorPointer:a}))}function ar(e){window.__c={n:"CollectionSettingsSlackAutomationsView"};const{collectionSettingsStore:t,collectionContextStore:o}=e,n=(0,d.useIntl)(),r=(0,w.VK)((()=>{var e;return null===(e=yn.default.state.currentUserStore)||void 0===e?void 0:e.id}),[]),s=(0,w.VK)((()=>o.collectionViewBlockStore()),[o]),c=(0,w.VK)((()=>o.collectionStore()),[o]),[u,g]=l.useState(!1),m=(0,w.VK)((()=>{if(!s||!c)return[];return c.getAutomationStores().map((e=>{const t=e.getModel();if(null==t||!t.getAlive())return;if(!e.isTriggerType("notification_event"))return;const o=e.getTrigger();if(!o)return;const i=O().first(e.getActionStores());if(!i||!i.isType("slack_notification"))return;const r=i.getConfig();if(!(0,Ot.E7)(r))return;const a=sr({automationTrigger:o,blockStore:s,collectionStore:c});return{name:e.getNameWithDefault(n),trigger:o,config:r,createdByPointer:t.getCreatedByPointer(),notificationAutomationStore:e,notificationActionConfigStore:i,automationStatus:t.getStatus(),hasIncompatibleCollectionViewFilters:a,lastEditedTime:t.getLastEditedTime()}})).filter(k.$K)}),[c,s,n]),y=[],S=[];for(const i of m)r&&qt.dr.isEqual(i.createdByPointer,{id:r,table:er.KJ})?y.push(i):S.push(i);y.sort(((e,t)=>t.lastEditedTime-e.lastEditedTime)),S.sort(((e,t)=>t.lastEditedTime-e.lastEditedTime));let f=[];f=u?[...y,...S]:y.length>0?y:S;const h=m.length-f.length,v=(0,w.VK)((()=>fo({collectionStore:c})),[c]),b=!u&&h>0,C=lr();return i()(F.ZP,{title:i()(d.FormattedMessage,{id:"collectionSettings.slackAutomationsView.header",defaultMessage:"Slack notifications"}),collectionSettingsStore:t,collectionContextStore:o,fullHeight:!0,footer:v&&i()(E.Z,{topBorder:!0},void 0,i()(I.Z,{icon:_.Z.plus,isGray:!0,title:i()(d.FormattedMessage,{id:"collectionSettings.slackAutomationsView.createNew",defaultMessage:"New Slack notification"}),onClick:()=>{p.H4({collectionSettingsStore:t,item:{type:"createSlackAutomation"}})}}))},void 0,i()("div",{style:C.list},void 0,f.map((e=>l.createElement(cr,a()({},e,{key:e.notificationAutomationStore.id,blockStore:s,collectionStore:c,currentUserId:r,collectionContextStore:o,collectionSettingsStore:t})))),b&&i()(or.Z,{style:C.showMoreButtonContainer,onClick:e=>{e.stopPropagation(),g(!0)}},void 0,i()("div",{style:C.showMoreButtonContent},void 0,i()(d.FormattedMessage,{id:"collectionSettings.slackAutomationsView.showMore",defaultMessage:"Show {number} more",values:{number:h}})))))}function lr(){return(0,M.yK)((e=>({slackIcon:{width:16,height:"auto"},list:{display:"flex",flexDirection:"column",padding:12,gap:8},showMoreButtonContent:{fontSize:12},showMoreButtonContainer:{marginLeft:4,marginRight:"auto"}})),[])}function sr(e){const{automationTrigger:t,blockStore:o,collectionStore:n}=e,i=t.event;if(!("source"in i))return!1;if("collection_view"!==i.source.type)return!1;return Mo({collectionViewStore:co.Xr.createChildStore(o,i.source.pointer),collectionSchema:n.getSchema()})}function cr(e){window.__c={n:"CardForAutomationStuff"};const{notificationAutomationStore:t,name:o,automationStatus:n,hasIncompatibleCollectionViewFilters:r,blockStore:a,collectionStore:s,currentUserId:c,collectionSettingsStore:u,collectionContextStore:g,notificationActionConfigStore:m}=e,y=(0,C.O7)(),S=(0,d.useIntl)(),f=lr(),h=(0,w.VK)((()=>g.aliveSlackAutomationCount.state),[g]),v=(0,w.VK)((()=>vo({automationStore:t})),[t]),b=l.useCallback((()=>{s&&tn({intl:S,environment:y,collectionStore:s,existingAutomationStore:t,triggerType:"notification_event",onDelete:()=>{1===h&&p.E3({collectionSettingsStore:u})}})}),[S,y,s,t,h,u]);return i()(tr,{icon:_.Z.slackLogo(f.slackIcon),title:o,caption:a&&c&&i()(rr,{parentBlockStore:a,currentUserId:c,slackNotificationAutomation:e}),hasWarning:"active"!==n||r,onEdit:()=>{p.H4({collectionSettingsStore:u,item:{type:"editSlackAutomation",automationId:t.id,automationActionId:m.id}})},onDelete:v?b:void 0},t.id)}var dr=o(16354),ur=o(21396),pr=o(75311);const gr=(0,d.defineMessages)({automationTabTitle:{defaultMessage:"Automations",id:"database.viewSettings.automationTab.title"},automationTabFilterButton:{defaultMessage:"Filter",id:"database.viewSettings.automationTab.filterButton"},automationTabAddFilterButton:{defaultMessage:"Add filter",id:"database.viewSettings.automationTab.addFilterButton"},automationTabFilterMenuSearchInputPlaceholder:{defaultMessage:"Filter by‚Ä¶",id:"database.viewSettings.automationTab.filterMenuSearchInputPlaceholder"},automationTabFilterMenuNoResults:{defaultMessage:"No results",id:"database.viewSettings.automationTab.filterMenuNoResults"},automationNewAutomationTitle:{defaultMessage:"New automation",id:"database.viewSettings.automationTab.newAutomationTitle"},automationLearnAutomationTitle:{defaultMessage:"Learn about automations",id:"database.viewSettings.automationTab.learnAutomationTitle"},automationDisabledCaption:{defaultMessage:"Paused",id:"database.viewSettings.automationTab.disabledCaption"},automationEmptyViewEditorPublic:{defaultMessage:"Automatically set status, assignees, property values and more with automations",id:"database.viewSettings.automationTab.automationEmptyViewEditorPublic"},automationEmptyViewReadOnly:{defaultMessage:"You're a content viewer. Content viewers cannot create automations.",id:"database.viewSettings.automationTab.automationEmptyViewReadOnly"},automationEmptyViewContentOnly:{defaultMessage:"You're a content editor. Content editors can edit pages, but cannot create automations.",id:"database.viewSettings.automationTab.automationEmptyViewContentOnly"},automationSearchPlaceholder:{defaultMessage:"Search for an automation‚Ä¶",id:"database.viewSettings.automationTab.automationSearchPlaceholder"}});function mr(e){window.__c={n:"CollectionSettingsAutomationsView"};const{collectionContextStore:t,collectionSettingsStore:o,tabSettings:n}=e,r=(0,d.useIntl)(),s=(0,mn.D)(),{isMobile:c}=(0,C.Fy)(),[u,g]=(0,l.useState)(""),m=(0,w.VK)((()=>t.collectionStore()),[t]),y=(0,w.VK)((()=>t.collectionViewBlockStore()),[t]),S=(0,w.VK)((()=>m&&m.id),[m]),f=(0,w.VK)((()=>null==m?void 0:m.getSchema()),[m]),h=(0,w.VK)((()=>null==m?void 0:m.getFormat()),[m]),v=(0,w.VK)((()=>function(e){const{collectionStore:t,collectionViewBlockStore:o}=e;if(!t||!o)return[];const n=t.getAutomationStores(),i=[];for(const r of n){const e=r.getModel();null!=e&&e.getAlive()&&((r.isTriggerType("event")||r.isTriggerType("notification_event"))&&i.push(r))}return i}({collectionStore:m,collectionViewBlockStore:y})),[m,y]),b=(0,w.VK)((()=>function(e){const{automationStores:t,collectionSchema:o,intl:n}=e,i=new Map,r=[];for(const s of t){var a;if(!s.isDefined())continue;const e=[],t=s.getName();void 0!==t&&e.push(t);const c=null===(a=s.getOwnerStore())||void 0===a?void 0:a.getDisplayName(n);if(void 0!==c&&e.push(c),s.isTriggerType("event")||s.isTriggerType("notification_event")){const t=s.getEventConfiguration(),i=null==t?void 0:t.pagePropertiesEdited;if("some"===(null==i?void 0:i.type))for(const n of i.some){const t=null==o?void 0:o[n.property];t&&e.push(`${t.name} ${Ve.SO[t.type]}`)}const r=s.getActionStores();for(const a of r){const t=a.getType();if(t){const o=(0,Wt.z)(t);e.push(n.formatMessage(o.display.name))}if(a.isType("create_page")||a.isType("update_pages")){var l;const t=a.getConfig();null==t||null===(l=t.properties)||void 0===l||l.forEach((t=>{const n=null==o?void 0:o[t];n&&e.push(`${n.name} ${Ve.SO[n.type]}`)}))}}}const d=e.join(" ");i.set(s.id,d),r.push(d)}return function(e){const o=new Set(Pe().filter(e,r).map((e=>{let{original:t}=e;return t})));return t.filter((0,k.AO)((e=>{if(!e.isTriggerType("event")&&!e.isTriggerType("notification_event"))return{false:e};const t=i.get(e.id);return t&&o.has(t)?{true:e}:{false:e}})))}}({automationStores:v,collectionSchema:f,intl:r})),[v,f,r]),x=(0,w.VK)((()=>b(u)),[b,u]),T=(0,w.VK)((()=>So({collectionStore:m})),[m]),P=(0,l.useCallback)((()=>{p.H4({collectionSettingsStore:o,item:{type:"automationCreateSettings"}})}),[o]),A=(0,l.useCallback)((e=>g(e.target.value)),[]),V=(0,l.useCallback)((()=>{s&&S&&Rt.qu(s,{collection_id:S})}),[s,S]);(0,l.useEffect)((()=>{if(!s||!S)return;const e="collection_table_header"===n.source?{property_type:n.propertyType,source:n.source}:{source:n.source};Rt.d(s,{...e,collection_id:S})}),[s,S,n]);const[B,Z]=l.useState(!1),D=(0,w.VK)((()=>function(e){var t;const o=null===(t=yn.default.state.currentUserStore)||void 0===t?void 0:t.pointer,n=[],i=[];for(const r of e){const e=r.getCreatedByPointer();o&&e&&qt.dr.isEqual(o,e)?n.push(r):i.push(r)}return n.sort(((e,t)=>t.getLastEditedTime()-e.getLastEditedTime())),i.sort(((e,t)=>t.getLastEditedTime()-e.getLastEditedTime())),{currentUserAutomations:n,otherUserAutomations:i}}(x)),[x]),K=(0,l.useMemo)((()=>{const{currentUserAutomations:e,otherUserAutomations:t}=D;return B?[...e,...t]:e.length>0?e:t}),[D,B]),N=x.length-K.length,R=!B&&N>0,O=K.length>0,W=!O&&!(""!==u),G=(0,M.yK)((e=>({buttonList:{display:"flex",flexDirection:"column",flexShrink:1,gap:12,overflow:"hidden auto",paddingBlockEnd:c?0:12,paddingBlockStart:c?12:0,paddingInline:12},emptyViewWrap:{paddingBlockEnd:42,paddingInline:12},menuScrollerStyle:{marginBlockStart:c?12:8},wrap:{display:"flex",flexDirection:"column"},showMoreButtonContainer:{marginLeft:12,marginBottom:12,marginRight:"auto"},showMoreButtonContent:{fontSize:12},noResultsTitle:{color:e.text.secondary,fontSize:12,margin:0}})),[c]);return m&&f&&h&&y?l.createElement(F.ZP,a()({},e,{header:!W&&i()(E.Z,{},void 0,i()(Ee.ZP,{focusInitial:!c,onChange:A,placeholder:r.formatMessage(gr.automationSearchPlaceholder),showClearButton:!0,value:u})),footer:i()(E.Z,{topBorder:!0},void 0,T&&i()(I.Z,{icon:_.Z.plus,onClick:P,title:r.formatMessage(gr.automationNewAutomationTitle),isGray:!0}),i()(dr.Z,{href:"https://www.notion.so/help/database-automations",external:!0,onClick:V},void 0,i()(I.Z,{icon:_.Z.help,title:r.formatMessage(gr.automationLearnAutomationTitle),isGray:!0}))),menuScrollerStyle:G.menuScrollerStyle,title:O||u?r.formatMessage(gr.automationTabTitle):null}),i()("div",{style:G.wrap},void 0,W?i()("div",{style:G.emptyViewWrap},void 0,i()(yr,{collectionStore:m})):l.createElement(l.Fragment,null,i()("div",{style:G.buttonList},void 0,K.length>0?K.map(((e,n)=>i()(fr,{collectionContextStore:t,collectionStore:m,collectionSettingsStore:o,collectionViewBlockStore:y,focused:!1,schema:f,automationStore:e},e.id))):i()("p",{style:G.noResultsTitle},void 0,i()(d.FormattedMessage,{defaultMessage:"No results",id:"collectionSettings.automationsView.noResults"}))),R&&i()(or.Z,{style:G.showMoreButtonContainer,onClick:e=>{e.stopPropagation(),Z(!0)}},void 0,i()("div",{style:G.showMoreButtonContent},void 0,i()(d.FormattedMessage,{id:"collectionSettings.automationsView.showMore",defaultMessage:"Show {number} more",values:{number:N}})))))):null}function yr(e){window.__c={n:"EmptyView"};const{collectionStore:t}=e,o=(0,C.O7)(),n=(0,M.yK)((e=>({wrap:{alignItems:"center",display:"flex",flexDirection:"column",gap:7.5,justifyContent:"center",minHeight:250,textAlign:"center"},icon:{fill:e.icon.yellow,height:24,width:24},title:{fontSize:17,fontWeight:x.Z.fontWeight.medium,margin:0},copy:{color:e.text.secondary,fontSize:14,margin:0,lineHeight:1.5}})),[]),r=(0,w.VK)((()=>t.getRole()),[t]);let a;return a=(0,w.VK)((()=>Boolean((0,dn.IJ)(o,t))),[t,o])||!r||"editor"===r?gr.automationEmptyViewEditorPublic:"reader"===r||"comment_only"===r?gr.automationEmptyViewReadOnly:"content_only_editor"===r||"read_and_write"===r?gr.automationEmptyViewContentOnly:gr.automationEmptyViewEditorPublic,i()("div",{style:n.wrap},void 0,i()("div",{"aria-hidden":!0},void 0,_.Z.boltFilled(n.icon)),i()("p",{style:n.title},void 0,l.createElement(d.FormattedMessage,gr.automationTabTitle)),i()("p",{style:n.copy},void 0,l.createElement(d.FormattedMessage,a)))}const Sr={number:"typesNumber",person:"typesPerson",date:"typesDate",checkbox:"typesCheckbox",select:"typesSelect",multi_select:"typesMultipleSelect",status:"typesStatus",relation:"typesRelation",title:"typesTitle",text:"typesText",url:"typesUrl",email:"typesEmail",phone_number:"typesPhoneNumber"};function fr(e){window.__c={n:"AutomationSummaryCardWrapper"};const{automationStore:t,collectionContextStore:o,collectionStore:n,collectionSettingsStore:r,collectionViewBlockStore:a,focused:s,schema:c}=e,u=(0,d.useIntl)(),g=(0,C.O7)(),m=gn({automationStore:t,collectionStore:n}),y=(0,w.VK)((()=>t.getActionStores()),[t]),S=(0,w.VK)((()=>t.getTriggerStore().getValue()),[t]),f=(0,w.VK)((()=>t.getNameWithDefault(u)),[u,t]),h=(0,w.VK)((()=>"active"===t.getStatus()),[t]),v=(0,w.VK)((()=>o.aliveAutomationCount.state),[o]),b=(0,w.VK)((()=>ho({actionStores:y,automationStore:t})),[y,t]),M=(0,w.VK)((()=>vo({automationStore:t})),[t]),_=(0,l.useCallback)((async()=>{await tn({collectionStore:n,environment:g,existingAutomationStore:t,intl:u,triggerType:"event",onDelete:()=>{1===v&&p.wl({collectionSettingsStore:r,item:{type:"main"}})}})}),[u,g,n,r,t,v]),x=(0,l.useCallback)((()=>{on({automationStore:t,collectionStore:n,environment:g})}),[n,g,t]),T=(0,l.useCallback)((()=>{p.H4({collectionSettingsStore:r,item:{type:"automationEditSettings",automationId:t.id}})}),[r,t]),P=(0,l.useCallback)((()=>{nn({automationStore:t,collectionStore:n,environment:g})}),[n,g,t]),A=S?function(e){const{schema:t,triggerConfig:o}=e;if("notification_event"!==o.type&&"event"!==o.type)return[];const n=[];o.event.pagesAdded&&n.push({color:"blue",icon:"plus",type:"page"});const i=o.event.pagePropertiesEdited;if("any"===i.type)n.push({color:"blue",icon:"pencil",type:"misc"});else if("some"===i.type)for(const r of i.some){const e=t[r.property],o=r.filter;if(!e)continue;const i=ce.gB(e),a=ce.cu(e);if("changes_to_any"===o.operator)n.push({color:i||a?"gray":"blue",icon:Sr[e.type],type:"property"});else if(i&&!Gt.mv(o)&&Gt.r2(o)){const t=Gt.wB(o);if(t.length>1)n.push({color:"gray",icon:Sr[e.type],type:"property"});else if(1===t.length){const o=t[0];if("is_group"===o.type){const t=(e.groups??[]).find((e=>e.name===o.value));t&&n.push({color:t.color??"gray",icon:Sr[e.type],type:"property"})}else{const t=(e.options??[]).find((e=>e.value===o.value));t&&n.push({color:t.color??"gray",icon:Sr[e.type],type:"property"})}}}else if(a&&!Gt.mv(o)&&(Gt.dx(o)||Gt.NU(o))){const t=Gt.dx(o)?Gt.mg(o):Gt.qC(o);if(1===t.length){const o=t[0],i=(e.options??[]).find((e=>e.value===o.value));i&&n.push({color:i.color??"gray",icon:Sr[e.type],type:"property"})}else t.length>1&&n.push({color:"gray",icon:Sr[e.type],type:"property"})}}return n}({schema:c,triggerConfig:S}):[],V=(0,w.VK)((()=>function(e){const{actionStores:t,collectionStore:o,schema:n}=e,i=[];for(const c of t)if(c.isType("slack_notification"))i.push({icon:"slackLogo",type:"app"});else if(c.isType("update_pages")){const e=c.getConfig(),t=(null==e?void 0:e.properties)??[];if(1===t.length){var r,a;const s=t[0],c=n[s],d=null==e||null===(r=e.values)||void 0===r?void 0:r[s];if(!c||!d)continue;const u=(0,Ht.A6)(null===(a=d.value)||void 0===a?void 0:a.value);if(ce.gB(c)){const e=(c.options||[]).find((e=>e.value===u[0]));e&&i.push({color:e.color??"gray",icon:Sr[c.type],type:"property"})}else if(ce.cu(c))if(1===u.length){const e=(c.options||[]).find((e=>e.value===u[0]));e&&i.push({color:e.color??"gray",icon:Sr[c.type],type:"property"})}else u.length>1&&i.push({color:"gray",icon:Sr[c.type],type:"property"});else if(ce.KR(c)){var l;const e=(0,Lt.DW)({textValue:null===(l=d.value)||void 0===l?void 0:l.value,propertySchema:c}).map((e=>(0,Nt.Hl)({pointer:e,getRecordValue:o.getRecordValue})));1===e.length?i.push({actor:e[0],type:"person"}):i.push({color:"gray",icon:Sr[c.type],type:"property"})}else i.push({color:"gray",icon:Sr[c.type],type:"property"})}else t.length>1&&i.push({color:"gray",icon:"pencil",type:"misc"})}else if(c.isType("create_page")){var s;(null===(s=c.getConfig())||void 0===s?void 0:s.collection)&&i.push({color:"blue",icon:"plus",type:"page"})}return i}({actionStores:y,collectionStore:n,schema:c})),[c,n,y]),F=(0,w.VK)((()=>h?m&&function(e){const{actionStores:t,automationContextStore:o,collectionStore:n,canUserManageAutomation:r,intl:a,schema:l,triggerConfig:s}=e;if(!s||"event"!==s.type&&"notification_event"!==s.type)return;const{event:c}=s,u=[];c.pagesAdded&&u.push(Wo(a));if("none"===c.pagePropertiesEdited.type);else if("any"===c.pagePropertiesEdited.type)u.push(Go(a));else if("some"===c.pagePropertiesEdited.type)for(const i of c.pagePropertiesEdited.some){const e=l[i.property];if(!e)continue;const{filter:t}=i;if("changes_to_any"===t.operator)u.push(Lo(a,{propertyName:e.name}));else if(Ot.bD(e))if("status"===e.type){if(!Gt.r2(t)||!Gt.vR(t))continue;const o=Array.isArray(t.value)?t.value:[t.value],n=Zn({groupValues:o.map((e=>"is_group"===e.type?e.value:void 0)).filter(k.$K),isText:!0,optionValues:o.map((e=>"is_option"===e.type?e.value:void 0)).filter(k.$K),propertySchema:e}),i=a.formatList(n,{style:"long",type:"disjunction"});u.push(Uo(a,{propertyName:e.name,propertyValues:i}))}else if("select"===e.type||"multi_select"===e.type){if(Gt.mv(t)||!Gt.dx(t)&&!Gt.NU(t))continue;const o=Nn({isText:!0,optionValues:(Array.isArray(t.value)?t.value:[t.value]).map((e=>e.value)).filter(k.$K),propertySchema:e}),n=a.formatList(o,{style:"long",type:"disjunction"});u.push(zo(a,{propertyName:e.name,propertyValues:n}))}else(0,k.t1)(e)}const p=a.formatList(u,{style:"long",type:"disjunction"}),g=[];for(const S of t)if(S.isType("slack_notification"))g.push(i()(d.FormattedMessage,{defaultMessage:"notify {channel}",id:"CollectionSettingsAutomationsView.summaryCard.slackAction",values:{channel:i()(Ei,{actionStore:S,isUserAutomationOwner:r})}}));else if(S.isType("update_pages")){const e=S.getConfig(),t=null==e?void 0:e.properties,r=null==e?void 0:e.values;if(!t||0===t.length||!r)continue;if(t.length>1)continue;const a=t[0],s=l[a],c=r[a];if(!s||!c||!Ot.SF(s))continue;if("person"===s.type)g.push(i()(hr,{collectionStore:n,propertyActionValue:c,propertySchema:s}));else if("status"===s.type){const e=i()(vr,{propertyActionValue:c,propertySchema:s});e&&g.push(e)}else if("select"===s.type||"multi_select"===s.type)g.push(i()(br,{propertyActionValue:c,propertySchema:s}));else if("checkbox"===s.type)g.push(i()(Cr,{propertyActionValue:c,propertySchema:s}));else if("relation"===s.type)g.push(i()(wr,{collectionStore:n,propertyActionValue:c,propertySchema:s}));else if("date"===s.type){const e=i()(Mr,{automationContextStore:o,collectionStore:n,propertyActionValue:c,propertyId:a,propertySchema:s});e&&g.push(e)}else"number"===s.type||"phone_number"===s.type||"text"===s.type||"title"===s.type||"email"===s.type||"url"===s.type?g.push(i()(_r,{automationStore:o.context.automationStore,propertyActionValue:c,propertySchema:s})):(0,k.t1)(s)}else if(S.isType("create_page")){var m;const e=null===(m=S.getConfig())||void 0===m?void 0:m.collection;if(!e)continue;e.id===n.pointer.id?g.push(i()(d.FormattedMessage,{defaultMessage:"create a page in this database",id:"automation.summaryCard.createPageThisDatabase"})):g.push(i()(d.FormattedMessage,{defaultMessage:"create a page in another database",id:"automation.summaryCard.createPageAnotherDatabase"}))}const y=a.formatList(g,{style:"long",type:"conjunction"});return a.formatMessage({defaultMessage:"When {triggers}, {actions}.",id:"automation.summaryCard.caption"},{actions:y,triggers:p})}({actionStores:y,automationContextStore:m,canUserManageAutomation:b,collectionStore:n,intl:u,schema:c,triggerConfig:S}):u.formatMessage(gr.automationDisabledCaption)),[h,m,y,n,u,c,S,b]),I=(0,w.VK)((()=>{if(!t.isTriggerType("event")&&!t.isTriggerType("notification_event"))return!0;const e=t.getTrigger();return!e||sr({automationTrigger:e,blockStore:a,collectionStore:n})}),[t,n,a]),B=!h||I;return i()(zi,{actions:V,caption:F,focused:s,hasWarning:B,onClick:T,onDelete:M?_:void 0,onDisable:h&&M?x:void 0,onEdit:b?T:void 0,onEnable:!h&&M?P:void 0,title:f,triggers:A},t.id)}function hr(e){var t;window.__c={n:"PersonActionTitle"};const{collectionStore:o,propertyActionValue:n,propertySchema:i}=e,r=(0,d.useIntl)(),a=(0,Lt.DW)({textValue:null===(t=n.value)||void 0===t?void 0:t.value,propertySchema:i}),s=(0,w.VK)((()=>a.map((e=>(0,Nt.$4)(r,(0,Nt.Hl)({pointer:e,getRecordValue:o.getRecordValue})))).filter(k.$K)),[a,o,r]),c=i.name,u=r.formatList(s,{style:"long",type:"conjunction"});let p;return p=0===s.length?Ao({propertyName:c}):1===s.length?Vo({propertyName:c,propertyValue:u}):Fo({propertyName:c,propertyValue:u}),l.createElement(d.FormattedMessage,p)}function vr(e){var t;const{propertyActionValue:o,propertySchema:n}=e,i=(0,Ht.A6)(null===(t=o.value)||void 0===t?void 0:t.value)[0];if("string"!=typeof i)return null;const r=Zn({groupValues:[],isText:!0,optionValues:[i],propertySchema:n});return 0===r.length?null:l.createElement(d.FormattedMessage,No({propertyName:n.name,propertyValue:r}))}function br(e){var t,o;window.__c={n:"SelectActionTitle"};const{propertyActionValue:n,propertySchema:i}=e,r=(0,d.useIntl)(),a=null!==(t=n.value)&&void 0!==t&&t.value?(0,Ht.A6)(null===(o=n.value)||void 0===o?void 0:o.value):void 0,s=i.name,c=a?Nn({isText:!0,limit:Rn,optionValues:a.map((e=>"string"==typeof e?e:void 0)).filter(k.$K),propertySchema:i}):void 0,u=(null==c?void 0:c.length)??0;let p;return p=void 0===c?Eo({propertyName:s}):1===u?Do({propertyName:s,propertyValue:c[0]}):Ko({propertyName:s,propertyValue:r.formatList(c,{style:"long",type:"conjunction"})}),l.createElement(d.FormattedMessage,p)}function Cr(e){var t;const{propertyActionValue:o,propertySchema:n}=e,i=(0,Ht.A6)(null===(t=o.value)||void 0===t?void 0:t.value)[0],r=n.name,a=!0===i?l.createElement(d.FormattedMessage,ko.actionCheckboxPropertyChecked):l.createElement(d.FormattedMessage,ko.actionCheckboxPropertyUnchecked);return l.createElement(d.FormattedMessage,xo({propertyName:r,propertyValue:a}))}function wr(e){window.__c={n:"RelationActionTitle"};const{collectionStore:t,propertyActionValue:o,propertySchema:n}=e,i=(0,d.useIntl)(),r=(0,C.O7)(),a=o.value,s=(0,l.useMemo)((()=>void 0!==a?Ln(a,n.limit):[]),[a,n.limit]),c=(0,w.VK)((()=>s.map((e=>{const o=co.G.createChildStore(t,{table:jt.iU,id:e});return(0,un.vU)({environment:r,intl:i,store:o})})).filter(k.$K)),[t,r,i,s]),u=n.name;let p;return p=0===c.length?Io({propertyName:u}):1===c.length?Bo({propertyName:u,propertyValue:c[0]}):Zo({propertyName:u,propertyValue:i.formatList(c,{style:"long",type:"conjunction"})}),l.createElement(d.FormattedMessage,p)}function Mr(e){window.__c={n:"DateActionTitle"};const{automationContextStore:t,collectionStore:o,propertyActionValue:n,propertyId:i,propertySchema:r}=e,a=(0,d.useIntl)(),s=(0,l.useMemo)((()=>({type:"collection",collectionStore:o,property:i})),[o,i]),c=(0,w.VK)((()=>(0,pr._)(s)),[s]),u=(0,w.VK)((()=>Ho(t)),[t]),p=n.value,g=(0,Ht.A6)(null==p?void 0:p.value)[0],m=r.name;if(void 0===g)return l.createElement(d.FormattedMessage,To({propertyName:m}));if("string"==typeof g||"boolean"==typeof g||Qt.IW(g)||Qt.ST(g))return null;if(Qt.fp(g)){const e=Qt.Ot(g);if(!e)return null;const t=(0,zt.ZV)({value:e,date_format:c.dateFormat,time_format:c.timeFormat,userTimeZone:(0,$t.r)(),allowRelativeDates:!0,intl:a,shortenDateAndRange:!0,displayInUserTimezone:!0});return l.createElement(d.FormattedMessage,Po({propertyName:m,propertyValue:t}))}if(Qt.wj(g)){const e=Qt.vm(g).id,t=(0,Ut.vx)(u,e);if(!t)return null;const o=(0,ur.e)(t);return l.createElement(d.FormattedMessage,Po({propertyName:m,propertyValue:o}))}return null}function _r(e){var t;window.__c={n:"TextActionTitle"};const{automationStore:o,propertyActionValue:n,propertySchema:i}=e,r=(0,C.O7)(),a=(0,M.Fg)(),s=i.name,c=(0,w.VK)((()=>{var e,t;return null!==(e=n.value)&&void 0!==e&&e.value?(0,sn.IY)({disabled:!0,disableDateStyleAnnotations:!0,disableHover:!0,disableLinks:!0,disableStyleAnnotations:!0,emojiType:(0,cn.e_)(r),environment:r,formulaValueTypes:[],katex:r.KatexStore.getKatex(),parentStore:o,stopLinkPropagation:!0,textValue:{value:null===(t=n.value)||void 0===t?void 0:t.value,spaceId:(0,Yt.C)(o.pointer.spaceId)},theme:a}):void 0}),[o,r,null===(t=n.value)||void 0===t?void 0:t.value,a]),u=c?Oo({propertyName:s,propertyValue:c}):Ro({propertyName:s});return l.createElement(d.FormattedMessage,u)}var kr=o(8848),xr=o(58573),Tr=o(59054),Pr=o(20270),Ar=o(64002),Vr=o(54642),Fr=o(43132),Ir=o(761),Br=o(70764),Zr=o(75079);function Er(e){window.__c={n:"CollectionSettingsAccountSelectionIndicator"};const{onClick:t,integration:o,accountName:n}=e,r=(0,M.yK)((e=>({accountSelection:{padding:"8px",borderTop:`1px solid ${e.regularDividerColor}`,cursor:"pointer"},accountSelectionLabel:{fontWeight:x.Z.fontWeight.medium,paddingLeft:4,paddingTop:4}})),[]);return i()("div",{style:r.accountSelection},void 0,i()("div",{onClick:t},void 0,i()(D.Z,{isSecondaryColor:!0,isSmall:!0,style:r.accountSelectionLabel},void 0,i()(d.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.currentAccountSection.label",defaultMessage:"Connected to {integration}",values:{integration:o.name}})),i()(St.Z,{renderTooltip:()=>i()("span",{},void 0,n),placement:St.Z.Placement.Left,textWrap:!0,render:t=>l.createElement(Ze.Z,a()({showExtensionArrow:!0,focused:!1},(0,Bt.Z)(t||{},e),{title:n,icon:i()("img",{style:{width:18},src:o.info.icon})}))})))}var Dr=o(1634),Kr=o(31278);function Nr(e){window.__c={n:"CollectionSettingsExternalAuthentication"};const{collectionContextStore:t,integration:o}=e,n=(0,M.Fg)(),r=(0,w.VK)((()=>t.collectionStore()),[t]),s=(0,w.VK)((()=>null==r?void 0:r.getIcon()),[r]),c=(0,C.O7)(),u=(0,w.VK)((()=>{var e;return null===(e=yn.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),p=(0,M.yK)((e=>({settingsMenu:{display:"flex",flexGrow:1,flexDirection:"column",padding:"8px 16px 16px 8px"},authenticationBody:{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",padding:"0px 16px 16px 16px",textAlign:"center"},settingsMenuSubHeading:{display:"inline",fontSize:14,margin:"4px 20px 20px 20px",color:e.mediumTextColor,textAlign:"center"},settingsMenuAuthenticationButton:{fontSize:14,height:32,color:e.regularInvertedTextColor}})),[]),{background:g,hoveredBackground:m,pressedBackground:y}=(0,hi.dg)(o,n.mode);return l.createElement(F.ZP,a()({},e,{title:i()(d.FormattedMessage,{defaultMessage:"Connect to {integration}",id:"collectionSettingsCreateExternalViewPicker.authenticateHeader.title",values:{integration:o.name}})}),i()("div",{style:p.settingsMenu},void 0,i()("div",{style:p.authenticationBody},void 0,i()(Kr.Z,{disabled:!0,bucket:"secure",store:r,icon:s,size:40,isEmptyPage:!1,style:{marginBottom:6}}),i()("div",{style:p.settingsMenuSubHeading},void 0,i()(d.FormattedMessage,{defaultMessage:"Link your {integration} account for richer content previews and seamless imports.",id:"collectionSettingsCreateExternalViewPicker.authenticateBody.title",values:{integration:o.name}})),i()(Pt.Z,{onClick:()=>{u&&(It.hM({environment:c,integration:o,spaceId:u,from:"placeholder_root_external_collection_view_block"}),Dr.Z.reset())},style:{background:g,...p.settingsMenuAuthenticationButton},hoveredStyle:{background:m},pressedStyle:{background:y}},void 0,i()(d.FormattedMessage,{defaultMessage:"Connect to {integration}",id:"collectionSettingsCreateExternalViewPicker.authenticateButton.title",values:{integration:o.name}})))))}var Rr=o(33338),Or=o(68785),Wr=o(18647);function Gr(e){window.__c={n:"CollectionSettingsCreateExternalViewPicker"};const{collectionSettingsStore:t,collectionContextStore:o,externalAuthentication:n}=e,i=(0,w.VK)((()=>o.collectionStore()),[o]),r=(0,w.VK)((()=>{if(!i)return;const e=i.getFormat().integration_id;return Zt.Z.integrations.state.find((t=>t.id===e))}),[i]),s=(0,w.VK)((()=>!!r&&(0,Br.NP)(r.id).length>0),[r]),c=(0,w.VK)((()=>{var e;return null===(e=yn.default.state.currentSpaceStore)||void 0===e?void 0:e.canEdit()}),[]);return i&&c&&r?l.createElement(l.Fragment,null,s?l.createElement(Ur,a()({},e,{collectionContextStore:o,collectionSettingsStore:t,integration:r,externalAuthentication:n})):l.createElement(Nr,a()({},e,{collectionContextStore:o,collectionSettingsStore:t,integration:r}))):null}const Lr=e=>{var t;return null===(t=e.integration.info)||void 0===t||null===(t=t.original_url_patterns)||void 0===t?void 0:t.filter((e=>{var t;return null===(t=e.additional_types)||void 0===t?void 0:t.collection})).find((t=>{let{regex:o}=t;return new RegExp(o).test(e.url)}))},zr=(0,d.defineMessages)({all:{id:"collectionSettingsCreateExternalViewPicker.filters.all",defaultMessage:"All"},issues:{id:"collectionSettingsCreateExternalViewPicker.filters.issues",defaultMessage:"Issues"},pull_requests:{id:"collectionSettingsCreateExternalViewPicker.filters.pullRequests",defaultMessage:"Pull Requests"},board:{id:"collectionSettingsCreateExternalViewPicker.filters.boards",defaultMessage:"Boards"},project:{id:"collectionSettingsCreateExternalViewPicker.filters.projects",defaultMessage:"Projects"},Releases:{id:"collectionSettingsCreateExternalViewPicker.filters.releases",defaultMessage:"Releases"},"Pull Request":{id:"collectionSettingsCreateExternalViewPicker.filters.PullRequests",defaultMessage:"Pull Requests"},Issues:{id:"collectionSettingsCreateExternalViewPicker.filters.Issues",defaultMessage:"Issues"}});function Ur(e){window.__c={n:"CollectionSettingsSourceSelection"};const{integration:t,collectionContextStore:o,collectionSettingsStore:n,externalAuthentication:r}=e,[s,c]=(0,l.useState)(""),g=(0,w.VK)((()=>{const e=Zt.Z.state;return e.loaded?e.externalAuthentications.filter((e=>e.integration_id===t.id)):[]}),[t]),m=(0,w.VK)((()=>r||(g.length?g[0]:null)),[g,r]),[S,h]=(0,l.useState)(!1),[v,b]=(0,l.useState)(null),x=(0,M.yK)((e=>({settingsMenu:{display:"flex",flexGrow:1,flexDirection:"column",padding:"8px"},settingsMenuSearchBox:{background:e.contentBackground,marginBottom:10},syncSourceButton:{width:"100%",display:"flex",justifyContent:"center"},noResults:{width:"100%",paddingBottom:10,display:"flex",justifyContent:"center",fontSize:14,color:e.mediumTextColor},suggestionBox:{display:"flex",alignItems:"center",fontSize:12,color:kr.ZP.white,background:kr.ZP.blue,borderRadius:6,padding:10,boxShadow:e.largeLightBoxShadow,alignSelf:"center",maxWidth:"80%"},errorMessage:{alignSelf:"center",padding:10,fontSize:14,color:e.errorText},syncingData:{width:"100%",paddingBottom:10,display:"flex",justifyContent:"center",fontSize:14,color:e.mediumTextColor},filterContainer:{position:"relative",flexGrow:0,overflow:"hidden"},filterContainerScroller:{display:"flex",alignItems:"center",padding:"8px 12px"}})),[]),T=(0,w.VK)((()=>o.collectionStore()),[o]),P=(0,w.VK)((()=>o.collectionViewBlockStore()),[o]),A=(0,C.O7)(),[{value:V,status:I}]=(0,Tr.r5)((async()=>{if(!m)return;const e=m.parent_id;return Vr.listExternalCollections(A,{bot_id:e})}),[A,m]),B="success"===(null==V?void 0:V.type)&&"data"in V.data?V.data.data:[],Z="success"===(null==V?void 0:V.type)&&"error"in V.data?V.data.error:null,D=B.filter((e=>!v||e.type===v)),K=D.length?(0,xr.ZP)(s,D,(e=>e.title)):[],N=Array.from(new Set(B.map((e=>e.type)))),R=Lr({integration:t,url:s}),O=async e=>{if(h(!0),!T||!P)return;const r=e||s,a=Lr({integration:t,url:r});if(!a)return h(!1),void ye.showDialog({items:[{label:i()(d.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.unsupportedUrlErrorDialog.copyDebuggingInformation",defaultMessage:"Copy debugging information"}),color:"blue",onAccept:()=>{Fr.RD({environment:A,stringValue:JSON.stringify({botId:null==m?void 0:m.parent_id,url:r},null,2),copiedMessage:Fr.tq.copiedToClipboard})}},{label:i()(d.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.unsupportedUrlErrorDialog.closeButton",defaultMessage:"Close"}),onAccept:()=>{}}],showCancel:!1,keepFocus:!1,message:i()(d.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.unsupportedUrlErrorDialog.title",defaultMessage:"This source is currently not supported. Please try a different source."})});const l=(0,Br.NP)(t.id);await Ir.UY({environment:A,url:r,botIds:l.map((e=>e.id)),externalCollectionStore:T,externalCollectionViewBlockStore:P});const{host:c}=(0,Ar.Qc)(r);u.Mp(A,{...(0,Zr.Pn)(o),integrationId:t.id,type:"collection",entity:a.name,domain:c||"",from:"external_picker_settings"}),p.wl({collectionSettingsStore:n,item:{type:"shareSyncedView",integrationName:t.name,integrationIcon:t.info.icon}}),h(!1)};if(!T||!P)return null;const W=N.length>1?i()("div",{style:x.filterContainer},void 0,i()(Wr.Z,{type:f.Z.X,style:x.filterContainerScroller,showLeftRightOverlay:!1},void 0,i()(Rr.Z,{title:i()("span",{},void 0,Fe.default.formatMessage(zr.all)),on:!(0,k.K0)(v),hideChevron:!0,onClick:e=>{(0,y.ZP)({event:e,context:y.Af.CollectionSettingsClick,callback:()=>{b(null)}})}},"all"),N.map((e=>i()(Rr.Z,{title:i()("span",{},void 0,Fe.default.formatMessage(zr[e])),on:v===e,hideChevron:!0,onClick:t=>{(0,y.ZP)({event:t,context:y.Af.CollectionSettingsClick,callback:()=>{b((t=>t===e?null:e))}})}},e))))):null,G=R?i()("div",{style:x.syncSourceButton},void 0,i()(fe.Z,{isLarge:!0,onClick:e=>{(0,y.ZP)({event:e,context:y.Af.CollectionSettingsClick,callback:()=>{O()}})},disabled:!1},void 0,i()(d.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.syncSourceButton.label",defaultMessage:"Sync Source"}))):null,L=R||B.length&&K.length?null:l.createElement(l.Fragment,null,i()("div",{style:x.noResults},void 0,i()(d.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.noResults.text",defaultMessage:"No results"})),i()("div",{style:x.suggestionBox},void 0,_.Z.info({marginRight:8,width:14,height:14}),i()(d.FormattedMessage,{defaultMessage:"Try different search or paste any {integration} URL",id:"collectionSettingsCreateExternalViewPicker.noResults.help",values:{integration:t.name}}))),z=B.length&&K.length?l.createElement(l.Fragment,null,i()(De.Z,{type:De.i.Vertical,initialFocus:0,sections:[{key:"collections",items:K.map((e=>({key:e.url,render:t=>i()(St.Z,{renderTooltip:()=>i()("span",{},void 0,e.title),placement:St.Z.Placement.Left,textWrap:!0,render:o=>l.createElement(Ze.Z,a()({},(0,Bt.Z)(o||{},t),{title:e.title,icon:i()("img",{style:{width:18},src:e.icon}),caption:e.parent.title}))}),action:t=>{"stopPropagation"in t.event&&t.event.stopPropagation(),O(e.url)}}))),render:e=>l.createElement(E.Z,a()({},e,{disableMobilePadding:!0}))}]})):null,U="pending"===I||"idle"===I||S;if(!m||Z&&(Z.status===Pr.mQ.UNAUTHORIZED||Z.status===Pr.mQ.FORBIDDEN))return i()(Nr,{collectionContextStore:o,collectionSettingsStore:n,integration:t});const H="rejected"===I||"failed"===(null==V?void 0:V.type)||Z,$=i()(Er,{onClick:()=>{p.H4({collectionSettingsStore:n,item:{type:"selectAccountForExternalSource",integration:t,onAccountSelect:e=>{p.H4({collectionSettingsStore:n,item:{type:"createSyncedViewSource",externalAuthentication:e}})}}})},integration:t,accountName:m.account_name});return l.createElement(F.ZP,a()({},e,{footer:G||S?null:$,title:i()(d.FormattedMessage,{defaultMessage:"Select from {integration}",id:"collectionSettingsCreateExternalViewPicker.title",values:{integration:t.name}}),header:!U&&"resolved"===I&&l.createElement(l.Fragment,null,i()(Ee.ZP,{inputLeft:i()(Ee.f_,{icon:_.Z.search}),onSubmit:()=>{R&&O()},style:x.settingsMenuSearchBox,focusInitial:!0,value:s,onChange:e=>{c(e.target.value)},placeholder:"Search source or paste a link..."}),R?null:W)}),i()("div",{style:x.settingsMenu},void 0,H&&i()("div",{style:x.errorMessage},void 0,i()(d.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.error.unknown",defaultMessage:"Something went wrong.",values:{integration:t.name}})),U&&i()("div",{style:x.syncingData},void 0,i()("span",{},void 0,i()(d.FormattedMessage,S?{id:"collectionSettingsCreateExternalViewPicker.settingUpSync",defaultMessage:"Setting up sync..."}:{id:"collectionSettingsCreateExternalViewPicker.loadingData",defaultMessage:"Loading available sources..."})),i()(Or.Z,{style:{alignSelf:"center"}})),!U&&"resolved"===I&&l.createElement(l.Fragment,null,G,L,z)))}var Hr=o(26263),$r=o(23482),qr=o(75081),jr=o(26122);function Yr(e){window.__c={n:"CollectionSettingsCreateTypedDB"};const t=(0,M.Fg)(),o=(0,C.O7)(),n=o.device,[r,s]=(0,l.useState)("untyped"),[c,u]=(0,l.useState)(),g=(0,l.useMemo)((()=>Un.default.createValue("")),[]),S=(0,l.useMemo)((()=>new Hr.Z({name:"CollectionSettingsCreateTypedDB"})),[]),f=(0,w.VK)((()=>{const t=e.collectionContextStore.collectionStore();if(t)return t.clone(S).getIcon()}),[e.collectionContextStore,S]);(0,l.useEffect)((()=>{var t;void 0===c&&u(null===(t=e.collectionContextStore.collectionViewStore())||void 0===t?void 0:t.getType())}),[e.collectionContextStore,c]),(0,l.useEffect)((()=>{const e=o.defaultRecordCache.inMemoryRecordCache;return e.addCacheOverride(S),()=>{e.removeCacheOverride(S)}}),[o,S,e.collectionContextStore]);const h=(0,l.useCallback)((e=>{g.setState(e)}),[g]),v=(0,l.useCallback)(((t,n)=>{const{collectionContextStore:i}=e,r=i.collectionViewStore(),a=i.collectionViewBlockStore();r&&a&&p.nr({environment:o,baseViewType:c,selectedDBType:n,collectionName:g.state,collectionContextStore:i,collectionViewBlockStore:a,collectionViewStore:r,useTemporaryRecordCache:t,temporaryRecordCache:S})}),[e,c,o,g,S]);(0,l.useEffect)((()=>{v(!0,"untyped")}),[v]);const b=(0,l.useCallback)((t=>{const{collectionContextStore:o}=e;s(t),v(!0,t),me.Ip({collectionContextStore:o})}),[e,v]);const k=(0,l.useCallback)((t=>{var n;const i=null===(n=e.collectionContextStore.collectionStore())||void 0===n?void 0:n.getIconStore().clone(S);i&&m.createAndCommit({userAction:"SpacePermissionGroup.handleIconChange",environment:o,perform:e=>{Se.sO({store:i,value:t,transaction:e})}})}),[e.collectionContextStore,o,S]),x=(0,l.useCallback)((t=>{(0,y.ZP)({event:t,context:y.Af.CollectionSettingsClick,callback:()=>{const{collectionSettingsStore:t}=e;ye.showDialog({message:i()("span",{},void 0,i()(d.FormattedMessage,{defaultMessage:"Would you like to continue creating this database?",id:"collectionSettingsNewDatabase.confirmDialog.prompt"})),showCancel:!1,keepFocus:!1,items:[{label:i()(d.FormattedMessage,{defaultMessage:"Yes create {selectedType, select, untyped {an {type}} other {a {type}}} database",values:{selectedType:r,type:"untyped"===r?"empty":qr.kd[r]},id:"collectionSettingsNewDatabase.confirmDialog.affirmativeButton.label"}),color:"red",onAccept:()=>{v(!1,r),p.E3({collectionSettingsStore:t})}},{label:i()(d.FormattedMessage,{defaultMessage:"Cancel",id:"collectionSettingsNewDatabase.confirmDialog.cancel.label"}),color:"blue",onAccept:()=>{}}]})}})}),[e,r,v]),T=(0,l.useCallback)((()=>{o.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(S);const{collectionContextStore:t,collectionSettingsStore:n}=e,i=t.collectionViewBlockStore(),r=t.collectionViewStore();void 0!==i&&void 0!==r&&(t.setContext({type:"collectionView",collectionViewBlockStore:i,collectionStore:void 0,collectionViewStore:r}),p.H4({collectionSettingsStore:n,item:{type:"createViewSource"}}))}),[o,e,S]);return l.createElement(F.ZP,a()({},e,{handleClose:x,title:i()(d.FormattedMessage,{defaultMessage:"New database",id:"database.viewSettings.createTypedDBTab.title"}),footer:i()(E.Z,{topBorder:!0},void 0,i()(I.Z,{icon:_.Z.contentSearch,isGray:!0,title:i()(d.FormattedMessage,{defaultMessage:"View an existing database",id:"database.viewSettings.createTypedDBTab.viewExistingDatabaseButton"}),onClick:T}),i()(I.Z,{icon:_.Z.save,isGray:!0,title:i()(d.FormattedMessage,{defaultMessage:"Import or sync from",id:"database.viewSettings.createTypedDB.importDatabaseButton"})}))}),i()(E.Z,{},void 0,i()(jr.Z,{initialValue:"",placeholder:qr.kd[r],inputStore:g,onBlur:h,onSubmit:h,iconButton:{icon:e=>i()(Kr.Z,{isEmptyPage:!0,disabled:!0,defaultIcon:qr.by[r]({width:16,height:16,backfaceVisibility:void 0,marginRight:6}),icon:f,size:16}),onSubmit:k,includeEmojiTab:!0}})),i()("div",{style:{...!n.isMobile&&{width:"100%",paddingLeft:8,paddingRight:8},...n.isMobile&&{background:t.contentBackground,width:"100%",paddingTop:12,paddingBottom:12}}},void 0,i()("div",{style:{display:"flex",flexFlow:"wrap",justifyContent:"center"}},void 0,$r.bY.map((function(e){return i()(Qr,{dbType:e,isCurrentType:r===e,onClick:()=>b(e)})}))),i()(fe.Z,{style:{display:"flex",margin:"14px",height:32},onClick:function(){const{collectionSettingsStore:t}=e;v(!1,r),p.E3({collectionSettingsStore:t})}},void 0,i()(d.FormattedMessage,{defaultMessage:"Create database",id:"database.viewSettings.createTypedDB.createDatabase"}))))}function Qr(e){window.__c={n:"CollectionSettingsTypedDBButton"};const{dbType:t,onClick:o,isCurrentType:n}=e,r=(0,M.Fg)();return i()(B.Z,{style:{display:"flex",width:"95%",height:45,flexGrow:0,flexShrink:0,fontSize:11,borderRadius:3,margin:6,padding:6,boxShadow:`0 0 0 1px ${r.regularDividerColor}`,color:r.mediumTextColor,fill:r.mediumTextColor,...n&&{boxShadow:`0 0 0 2px ${r.blueColor}`,color:r.blueColor,fill:r.blueColor,fontWeight:500}},disabled:n,onClick:o},void 0,i()("div",{},void 0,qr.by[t]({...n&&{fill:r.blueColor,color:r.blueColor},width:17,height:17,marginBottom:4,marginTop:4,marginLeft:4})),i()("div",{style:{position:"relative",width:"100%",marginLeft:12}},void 0,i()("span",{style:{position:"absolute",fontSize:13,fontWeight:500}},void 0,qr.kd[t]),i()("span",{style:{position:"absolute",top:15,fontSize:12,marginTop:1}},void 0,qr.dX[t])))}var Xr=o(79362),Jr=o(98421),ea=o(72711),ta=o(13709);class oa extends s.Z{constructor(){super(...arguments),this.handleFirstLoadLimitChange=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();o&&(m.createAndCommit({userAction:"CollectionSettingsFirstLoadLimit.handleFirstLoadLimitChange",environment:this.environment,perform:t=>{g.FH({stores:[o],update:{inline_collection_first_load_limit:e},transaction:t})}}),t.groupsStore.resetAllLimits(),pe.wd({environment:this.environment,collectionContextStore:t,action:"set_first_load_limit"}))}}renderComponent(){const{collectionContextStore:e}=this.props,t=e.normalizedFormatStore.state,o=e.isFullScreen.state,n=this.getCurrentViewType();if(!(t.collection_group_by||!o&&"calendar"!==n))return;const r=this.getCurrentFirstLoadLimit(),a=e.permissionScopes.state;return i()(ta.Z,{title:i()(d.FormattedMessage,{defaultMessage:"Load limit",id:"database.viewSettings.layoutTab.firstLoadLimitSetting"}),selectedKey:r,popupStyle:{minWidth:190},options:this.getFirstLoadLimitOptions(),onChange:this.handleFirstLoadLimitChange,disabled:!a.canConfigureBlock,icon:_.Z.arrowDown})}getFirstLoadLimitOptions(){return Ae.jk.map((e=>({key:e,title:i()(d.FormattedMessage,{defaultMessage:"{limit} pages",values:{limit:e.limit},id:"database.viewSettings.layoutTab.limitPagesTitle"})})))}getCurrentViewType(){var e;const{collectionContextStore:t}=this.props,o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType();if(!o)throw new Error("View type was not defined.");return o}getCurrentFirstLoadLimit(){const{collectionContextStore:e}=this.props,t=e.normalizedFormatStore.state;return(0,Ae.rx)(t.inline_collection_first_load_limit,Boolean(t.collection_group_by))}}oa.displayName="CollectionSettingsFirstLoadLimit";const na=(0,d.injectIntl)(oa);var ia=o(35011),ra=o(14714),aa=o(49865),la=o(90833),sa=o(33665),ca=o(87052),da=o(75498),ua=o(21269),pa=o(79131),ga=o(5145),ma=o(28992),ya=o(19387);class Sa extends s.Z{constructor(){super(...arguments),this.storeTypes={reducerResultStore:Un.default.createClass(void 0),groupsLimit:Un.default.createClass(la.XD)},this.handleHideEmptyGroupsClick=()=>{const{groupByKey:e,collectionContextStore:t,groupsFormatKey:o}=this.props,n=this.getGroupBy(),i=this.groupsDisplayStateStore.state;if(!i)return;const{currentGroups:r}=i,a=t.collectionViewStore();if(!n||!a)return;const l=!n.hideEmptyGroups;m.createAndCommit({userAction:"CollectionSettingsViewGroup.handleHideEmptyGroupsClick",environment:this.environment,perform:i=>{if(l){const e=r.map((e=>!1===e.hidden?{...e,hidden:void 0}:e));aa.A6({collectionContextStore:t,newGroups:e,groupsFormatKey:o,transaction:i})}g.FH({stores:[a],update:{[e]:{...n,hideEmptyGroups:l}},transaction:i})}}),pe.wd({environment:this.environment,collectionContextStore:t,action:"toggle_hide_empty_groups"})},this.handleHideAllClick=()=>{const{collectionContextStore:e,groupsFormatKey:t}=this.props,o=this.groupsDisplayStateStore.state;if(!o)return;const{currentGroups:n}=o,i=n.map((e=>({...e,hidden:!0})));this.stores.groupsLimit.setState(la.XD),m.createAndCommit({userAction:"CollectionSettingsViewGroup.handleHideAllClick",environment:this.environment,perform:o=>{aa.A6({collectionContextStore:e,newGroups:i,groupsFormatKey:t,transaction:o})}}),pe.wd({environment:this.environment,collectionContextStore:e,action:"click_groups_hide_all"})},this.handleShowAllClick=()=>{const{collectionContextStore:e,groupsFormatKey:t}=this.props,o=this.groupsDisplayStateStore.state;if(!o)return;const{currentGroups:n}=o,i=n.map((e=>({...e,hidden:!1})));this.stores.groupsLimit.setState(la.XD),m.createAndCommit({userAction:"CollectionSettingsViewGroup.handleShowAllClick",environment:this.environment,perform:o=>{aa.A6({collectionContextStore:e,newGroups:i,groupsFormatKey:t,transaction:o})}}),pe.wd({environment:this.environment,collectionContextStore:e,action:"click_groups_show_all"})},this.handleGroupReorder=(e,t)=>{const{collectionContextStore:o,groupsFormatKey:n}=this.props,i=this.groupsDisplayStateStore.state;if(!i)return;const{currentGroups:r}=i,a=r.filter((t=>e.indexOf((0,ra.mD)(t))<0)),l=r.filter((t=>e.indexOf((0,ra.mD)(t))>=0)),s=O().sortBy(l,(t=>{const o=e.indexOf((0,ra.mD)(t));return o>=0?o:1/0})),c=t?[...a,...s]:[...s,...a];m.createAndCommit({userAction:"CollectionSettingsViewGroup.handleGroupReorder",environment:this.environment,perform:e=>{aa.A6({collectionContextStore:o,newGroups:c,groupsFormatKey:n,transaction:e})}}),u.wds(this.environment,{view_type:this.getCurrentViewType(),action:t?"reorder_hidden_groups":"reorder_groups"})},this.handleToggleGroupVisibility=e=>{const{collectionContextStore:t,groupsFormatKey:o}=this.props,n=this.groupsDisplayStateStore.state;if(!n)return;const{currentGroups:i}=n,r=i.map((t=>(0,ra.ZH)(t,e)?{...e,hidden:!(0,ra.eF)(e)}:t));m.createAndCommit({userAction:"CollectionSettingsViewGroup.handleToggleGroupVisibility",environment:this.environment,perform:e=>{aa.A6({collectionContextStore:t,newGroups:r,groupsFormatKey:o,transaction:e})}}),pe.wd({environment:this.environment,collectionContextStore:t,action:"toggle_group_visibility"})},this.handleSortTypeChange=e=>{const{collectionContextStore:t,groupByKey:o}=this.props,n=this.getGroupBy(),i=t.collectionViewStore();if(n&&i){if("formula"===n.type){const t={...n,groupBy:{...n.groupBy,sort:{type:e}}};m.createAndCommit({userAction:"CollectionSettingsViewGroup.handleSortTypeChange",environment:this.environment,perform:e=>{g.FH({stores:[i],update:{[o]:t},transaction:e})}})}else m.createAndCommit({userAction:"CollectionSettingsViewGroup.handleSortTypeChange",environment:this.environment,perform:t=>{g.FH({stores:[i],update:{[o]:{...n,sort:{type:e}}},transaction:t})}});pe.wd({environment:this.environment,collectionContextStore:t,action:"update_group_sort"})}},this.handleTextGroupByTypeChange=e=>{const{collectionContextStore:t,groupByKey:o,groupsFormatKey:n}=this.props,i=this.getGroupBy(),r=t.collectionViewStore();if(!i||!r)return;const a=Ma(i);if(a){if((0,ra.aB)(i))m.createAndCommit({userAction:"CollectionSettingsViewGroup.handleTextGroupByTypeChange",environment:this.environment,perform:t=>{g.FH({stores:[r],update:{[o]:{...i,groupBy:e},[n]:void 0},transaction:t})}});else if("formula"===i.type){const t={...O().omit(a,"property"),groupBy:e},l={...i,groupBy:t};m.createAndCommit({userAction:"CollectionSettingsViewGroup.handleTextGroupByTypeChange",environment:this.environment,perform:e=>{g.FH({stores:[r],update:{[o]:l,[n]:void 0},transaction:e})}})}pe.wd({environment:this.environment,collectionContextStore:t,action:"update_text_group_by"})}},this.handleDateGroupByTypeChange=e=>{const{collectionContextStore:t,groupByKey:o,groupsFormatKey:n}=this.props,i=this.getGroupBy(),r=t.collectionViewStore();if(!i||!r)return;const a=wa(i);if(a){if((0,ra.ib)(i))m.createAndCommit({userAction:"CollectionSettingsViewGroup.handleDateGroupByTypeChange",environment:this.environment,perform:t=>{g.FH({stores:[r],update:{[o]:{...i,groupBy:e},[n]:void 0},transaction:t})}});else if("formula"===i.type){const t={...O().omit(a,"property"),type:"date",groupBy:e},l={...i,groupBy:t};m.createAndCommit({userAction:"CollectionSettingsViewGroup.handleDateGroupByTypeChange",environment:this.environment,perform:e=>{g.FH({stores:[r],update:{[o]:l,[n]:void 0},transaction:e})}})}pe.wd({environment:this.environment,collectionContextStore:t,action:"update_date_group_by"})}},this.handleStatusGroupByTypeChange=e=>{const{collectionContextStore:t,groupByKey:o,groupsFormatKey:n}=this.props,i=this.getGroupBy(),r=t.collectionViewStore();i&&r&&"status"===(null==i?void 0:i.type)&&(m.createAndCommit({userAction:"CollectionSettingsViewGroup.handleStatusGroupByTypeChange",environment:this.environment,perform:t=>{g.FH({stores:[r],update:{[o]:{...i,groupBy:e},[n]:void 0},transaction:t})}}),pe.wd({environment:this.environment,collectionContextStore:t,action:"update_status_group_by"}))},this.handleRemoveClick=()=>{const{collectionContextStore:e,groupByKey:t,groupsFormatKey:o}=this.props,n=e.collectionViewStore();n&&(m.createAndCommit({userAction:"CollectionSettingsViewGroup.handleRemoveClick",environment:this.environment,perform:e=>{g.FH({stores:[n],update:{[t]:void 0,[o]:void 0},transaction:e})}}),pe.wd({environment:this.environment,collectionContextStore:e,action:"click_remove_grouping"}))},this.reducerStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupsFormatKey:t}=this.props,o=e.normalizedFormatStore.state,n=e.normalizedSchemaStore.state,i=e.remoteRequestStore.state,r=this.getGroupBy();if(r)return(0,la.ej)({groupBy:r,schema:n,format:o,filter:null==i?void 0:i.loader.filter,groupsFormatKey:t,limit:this.stores.groupsLimit.state})})),this.schemaGroupsStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.normalizedSchemaStore.state,o=this.getGroupBy();if(o)return(0,ra.Qq)({schema:t,groupBy:o})}),!0),this.groupsDisplayStateStore=this.createComputedStore((()=>{var e;const{groupsFormatKey:t,collectionContextStore:o}=this.props,n=o.normalizedFormatStore.state,i=o.normalizedSchemaStore.state,r=o.collectionViewBlockStore(),a=this.getGroupBy(),l=this.stores.reducerResultStore.state;if(!a||!r||!l)return;const s=this.stores.groupsLimit.state,c=this.schemaGroupsStore.state,d=l.results,u=l?l.total:0,p=(0,la.Cz)({groupBy:a,schema:i,formatGroups:n[t]||[],schemaGroups:c,reducerResults:d,getRecordModel:r.getRecordModel,relativeVariableResult:o.relativeVariableStore.state,viewAppConfigUri:null===(e=o.collectionViewStore())||void 0===e?void 0:e.getFormat().app_config_uri}),g=p.filter((e=>!(0,ra.eF)(e))).slice(0,s),m=p.filter((e=>(0,ra.eF)(e)));return{currentGroups:[...g,...m],visibleGroups:g,hiddenGroups:m,total:u}}),!0)}renderComponent(){const{collectionContextStore:e,groupByKey:t}=this.props,o=this.getGroupBy(),n=e.normalizedSchemaStore.state;return l.createElement(F.ZP,a()({},this.props,{title:this.renderTitle()}),i()(E.Z,{},void 0,this.renderPropertyMenuButton(o),o&&ba({groupBy:o,schema:n})&&this.renderTypeMenuButton(o),o&&this.renderSortMenuButton(o),o&&this.renderAutoHideButton(o),o&&"board_columns_by"===t&&this.renderColorColumnsOption()),o&&this.renderGroupSortListReducer(),i()(E.Z,{topBorder:!0},void 0,o&&this.canRemoveGrouping()&&i()(I.Z,{isGray:!0,icon:_.Z.trash,title:i()(d.FormattedMessage,{defaultMessage:"Remove grouping",id:"database.viewSettings.groupTab.removeButton.title"}),onClick:this.handleRemoveClick,isRed:!0}),i()(ua.Z,{href:(0,sa.UY)("guides.databaseGroup"),title:i()(d.FormattedMessage,{defaultMessage:"Learn about grouping",id:"database.viewSettings.groupTab.learnMoreButton.title"}),analyticsFrom:"view_settings_group"})))}renderTitle(){const{collectionSettingsStore:e}=this.props,t=(0,h.n)(e);if(t&&"group"===t.type)return"collection_group_by"===t.groupByKey&&"board"===this.getCurrentViewType()?i()(d.FormattedMessage,{defaultMessage:"Sub-group",id:"database.viewSettings.groupTab.subGroup.title"}):i()(d.FormattedMessage,{defaultMessage:"Group",id:"database.viewSettings.groupTab.group.title"})}renderPropertyMenuButton(e){const{collectionContextStore:t,collectionSettingsStore:o,groupByKey:n,groupsFormatKey:r}=this.props,a=t.normalizedSchemaStore.state,l=e?a[e.property]:void 0;return i()(I.Z,{title:ha(n,this.getCurrentViewType()),showChevron:!0,right:fa(l),onClick:()=>{pe.wd({environment:this.environment,collectionContextStore:t,action:"click_group_by_property",original_view_type:void 0,property_type:null==l?void 0:l.type}),p.H4({collectionSettingsStore:o,item:{type:"groupByProperty",groupByKey:n,groupsFormatKey:r}})},disabled:!this.canConfigureBlock()})}renderTypeMenuButton(e){const{collectionContextStore:t,collectionSettingsStore:o,groupByKey:n,groupsFormatKey:r}=this.props,a=t.normalizedSchemaStore.state,l=this.canConfigureBlock(),s="formula"===e.type?{...e.groupBy,property:e.property}:e;if((0,ra.ib)(s))return i()(ta.Z,{title:Ca({groupBy:s,schema:a}),popupStyle:{minWidth:190},selectedKey:s.groupBy,options:ra.z8.map((e=>({key:e,title:Ta(e)}))),onChange:this.handleDateGroupByTypeChange,disabled:!l});if((0,ra.aB)(s))return i()(ta.Z,{title:Ca({groupBy:s,schema:a}),popupStyle:{minWidth:190},selectedKey:s.groupBy,options:ra.Kp.map((e=>({key:e,title:Pa(e)}))),onChange:this.handleTextGroupByTypeChange,disabled:!l});if("number"===s.type)return i()(I.Z,{title:Ca({groupBy:s,schema:a}),showChevron:!0,right:ka({groupBy:s,schema:a}),onClick:()=>{p.H4({collectionSettingsStore:o,item:{type:"groupByNumber",groupByKey:n,groupsFormatKey:r}})},disabled:!l});if("status"===s.type){const e="collectionTypedView"===t.contextType?["group"]:ra.vu;return i()(ta.Z,{title:Ca({groupBy:s,schema:a}),popupStyle:{minWidth:190},selectedKey:s.groupBy,options:e.map((e=>({key:e,title:xa(e)}))),onChange:this.handleStatusGroupByTypeChange,disabled:!l})}}renderSortMenuButton(e){const t=(0,ra.YG)(e,!so.default.checkGate("collection_properties_select_auto_sort_options"));if(t.length<=1)return;const o=(0,ra.mu)(e);return i()(ta.Z,{title:i()(d.FormattedMessage,{defaultMessage:"Sort",id:"database.viewSettings.groupTab.sort"}),popupStyle:{minWidth:190},selectedKey:o.type,options:t.map((t=>({key:t,title:va(e,t)}))),onChange:this.handleSortTypeChange,disabled:!this.canConfigureBlock()})}renderAutoHideButton(e){return i()(he.Z,{title:i()(d.FormattedMessage,{defaultMessage:"Hide empty groups",id:"database.viewSettings.groupTab.hideEmptyGroups"}),on:Boolean(e.hideEmptyGroups),focused:!1,onClick:this.handleHideEmptyGroupsClick,disabled:!this.canConfigureBlock(),textWrapperStyle:{opacity:1}})}renderColorColumnsOption(){return i()(he.Z,{title:i()(d.FormattedMessage,{defaultMessage:"Color columns",id:"database.viewSettings.groupTab.colorColumns"}),on:!this.getDisableBoardColorColumns(),focused:!1,onClick:()=>{p.iN({environment:this.environment,collectionContextStore:this.props.collectionContextStore})},disabled:!this.canConfigureBlock(),textWrapperStyle:{opacity:1}})}renderGroupSortListReducer(){const{groupsFormatKey:e}=this.props,t=this.reducerStore.state,o=this.groupsDisplayStateStore.state;return t?i()(da.Z,{id:`group_menu_${e}`,reducer:t,collectionContextStore:this.props.collectionContextStore,resultStore:this.stores.reducerResultStore,render:()=>this.renderGroupSortListSections(o)}):this.renderGroupSortListSections(o)}renderGroupSortListSections(e){const t=this.getGroupBy();if(!t)return;if(!e)return i()(E.Z,{topBorder:!0,disableMobileBorders:!0,noTextOverflow:!0},void 0,i()("div",{style:{marginTop:6,display:"flex",alignItems:"center",flexDirection:"column"}},void 0,i()(Or.Z,{})));const o="manual"===(0,ra.mu)(t).type&&!this.environment.device.isMobile&&this.canConfigureBlock(),n=this.stores.groupsLimit.state,{total:r,hiddenGroups:a,visibleGroups:s}=e,c=Math.min(la.kW,r-a.length-s.length),u=c>0?i()(Ze.Z,{disabled:!1,focused:!1,style:{color:this.theme.mediumTextColor},icon:_.Z.dots({width:14,height:14}),title:i()(d.FormattedMessage,{id:"database.groupMenu.loadMoreButton.text",defaultMessage:"Show {loadMoreAmount, plural, one {{loadMoreAmount} more group} other {{loadMoreAmount} more groups}}",values:{loadMoreAmount:c}}),onClick:()=>{this.props.collectionContextStore.loadingDetails.setState({type:"load_groups_menu"}),this.stores.groupsLimit.setState(n+la.kW)}}):void 0;return l.createElement(l.Fragment,null,e.visibleGroups.length>0&&i()(E.Z,{topBorder:!0,noTextOverflow:!0,isTitleUppercase:!1,title:i()("span",{style:{alignSelf:"center"}},void 0,i()(d.FormattedMessage,{id:"database.groupMenu.visibleGroups",defaultMessage:"Visible groups"})),right:i()(Pt.Z,{isSmall:!0,shouldShrink:!0,isBlue:!0,style:{fontSize:12,height:void 0,paddingTop:2,paddingBottom:2},onClick:this.handleHideAllClick,disabled:!this.canConfigureBlock()},void 0,i()(d.FormattedMessage,{id:"database.groupMenu.hideAllGroups",defaultMessage:"Hide all"}))},void 0,this.renderGroupSortList({displayState:e,groups:e.visibleGroups,canReorder:o,isHidden:!1}),u),e.hiddenGroups.length>0&&i()(E.Z,{topBorder:!1,noTextOverflow:!0,isTitleUppercase:!1,title:i()(d.FormattedMessage,{id:"database.groupMenu.hiddenGroups",defaultMessage:"Hidden groups"}),right:i()(Pt.Z,{isSmall:!0,shouldShrink:!0,isBlue:!0,style:{fontSize:12,height:void 0,paddingTop:2,paddingBottom:2},onClick:this.handleShowAllClick,disabled:!this.canConfigureBlock()},void 0,i()(d.FormattedMessage,{id:"database.groupMenu.showAllGroups",defaultMessage:"Show all"}))},void 0,this.renderGroupSortList({displayState:e,groups:e.hiddenGroups,canReorder:o,isHidden:!0})))}renderGroupSortList(e){const{displayState:t,groups:o,canReorder:n,isHidden:r}=e;return n?i()(pa.ZP,{direction:"vertical",keys:o.map((e=>(0,ra.mD)(e))),renderKey:(e,i)=>{const r=o[i];return this.renderGroupSortListItem({displayState:t,groupFormat:r,canReorder:n})},onDrop:e=>{this.handleGroupReorder(e,r)},disabled:!this.canConfigureBlock()}):o.map((e=>i()(l.Fragment,{},(0,ra.mD)(e),this.renderGroupSortListItem({displayState:t,groupFormat:e,canReorder:n}))))}renderGroupSortListItem(e){const{collectionContextStore:t}=this.props,{displayState:o,groupFormat:n,canReorder:r}=e,a=t.normalizedSchemaStore.state,l=(0,ra.eF)(n),s=this.getGroupBy();if(s)return i()(ma.Z,{disabled:!this.canConfigureBlock(),title:i()("div",{style:{display:"flex",alignItems:"center"}},void 0,r&&i()(ga.ZP,{iconSize:12,style:{marginRight:3}}),i()(ca.Z,{groupBy:s,groupFormat:n,currentGroups:o.currentGroups,schema:a,disabled:!0,isHiddenGroup:!1,style:{padding:0},collectionContextStore:t})),right:i()(Cn.Z,{icon:l?_.Z.eyeHide:_.Z.eye,iconStyle:{width:16,height:16},isDarkIconColor:!l,onClick:()=>{this.handleToggleGroupVisibility(n)},disabled:!this.canConfigureBlock()}),textWrapperStyle:{opacity:1}})}getCurrentViewType(){var e;const{collectionContextStore:t}=this.props,o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType();if(!o)throw new Error("View type was not defined.");return o}getGroupBy(){const{collectionContextStore:e,groupByKey:t}=this.props;return e.normalizedFormatStore.state[t]}canRemoveGrouping(){return this.canConfigureBlock()&&(0,la._1)({viewType:this.getCurrentViewType(),groupByKey:this.props.groupByKey})}canConfigureBlock(){const{collectionContextStore:e}=this.props;return e.permissionScopes.state.canConfigureBlock}getDisableBoardColorColumns(){return(0,la.h6)(this.environment,this.props.collectionContextStore)}}function fa(e){return e?i()(ya.Z,{propertySchema:e,showIcon:!1}):i()(d.FormattedMessage,{defaultMessage:"None",id:"database.viewSettings.groupTab.noGroupingSetMessage"})}function ha(e,t){return i()(d.FormattedMessage,"collection_group_by"===e&&"board"===t?{defaultMessage:"Sub-group by",id:"database.viewSettings.groupTab.subGroupProperty"}:{defaultMessage:"Group by",id:"database.viewSettings.groupTab.groupProperty"})}function va(e,t){return"manual"===t?i()(d.FormattedMessage,{defaultMessage:"Manual",id:"database.viewSettings.groupTab.sortType.manual"}):"ascending"===t?(0,ra.ib)(e)||"formula"===e.type&&"date"===e.groupBy.type?i()(d.FormattedMessage,{defaultMessage:"Oldest first",id:"database.viewSettings.groupTab.sortType.chronological"}):(0,ra.aB)(e)||"relation"===e.type||"select"===e.type||"multi_select"===e.type||"formula"===e.type&&"text"===e.groupBy.type?i()(d.FormattedMessage,{defaultMessage:"Alphabetical",id:"database.viewSettings.groupTab.sortType.alphabetical"}):i()(d.FormattedMessage,{defaultMessage:"Ascending",id:"database.viewSettings.groupTab.sortType.ascending"}):"descending"===t?(0,ra.ib)(e)||"formula"===e.type&&"date"===e.groupBy.type?i()(d.FormattedMessage,{defaultMessage:"Newest first",id:"database.viewSettings.groupTab.sortType.reverseChronological"}):(0,ra.aB)(e)||"relation"===e.type||"select"===e.type||"multi_select"===e.type||"formula"===e.type&&"text"===e.groupBy.type?i()(d.FormattedMessage,{defaultMessage:"Reverse alphabetical",id:"database.viewSettings.groupTab.sortType.reverseAlphabetical"}):i()(d.FormattedMessage,{defaultMessage:"Descending",id:"database.viewSettings.groupTab.sortType.descending"}):void(0,k.t1)(t)}function ba(e){const{groupBy:t,schema:o}=e,n=o[t.property];if(!n||!(0,ra.LG)(n))return;let i;if("formula"===n.type){const e=(0,ia.mm)(n);if("unknown"===e||"array"===e)return;i="block"===e?"relation":e}else i=n.type;return(0,ra.A1)(i)||(0,ra.HB)(i)||"number"===i||"status"===i?i:void 0}function Ca(e){const t=ba(e);if(t)return(0,ra.A1)(t)?i()(d.FormattedMessage,{defaultMessage:"Date by",id:"database.viewSettings.groupByTypeTab.dateBy"}):(0,ra.HB)(t)?i()(d.FormattedMessage,{defaultMessage:"Text by",id:"database.viewSettings.groupByTypeTab.textBy"}):"number"===t?i()(d.FormattedMessage,{defaultMessage:"Number by",id:"database.viewSettings.groupByTypeTab.numberBy"}):"status"===t?i()(d.FormattedMessage,{defaultMessage:"Status by",id:"database.viewSettings.groupByTypeTab.statusBy"}):void 0}function wa(e){return(0,ra.ib)(e)?e:"formula"===e.type&&"date"===e.groupBy.type?e.groupBy:void 0}function Ma(e){return(0,ra.aB)(e)?e:"formula"===e.type&&"text"===e.groupBy.type?e.groupBy:void 0}function _a(e){return"number"===e.type?e:"formula"===e.type&&"number"===e.groupBy.type?{...e.groupBy,property:e.property}:void 0}function ka(e){const{groupBy:t}=e,o=ba(e);if(o)if((0,ra.A1)(o)){const e=wa(t);if(e)return Ta(e.groupBy)}else if((0,ra.HB)(o)){const e=Ma(t);if(e)return Pa(e.groupBy)}else if("number"===o){const e=_a(t);if(e)return i()(d.FormattedMessage,{defaultMessage:"{start} to {end}",id:"database.groupMenu.numberGroupBy.range",values:{start:e.start,end:e.end}})}}function xa(e){return"group"===e?i()(d.FormattedMessage,{defaultMessage:"Group",id:"database.groupMenu.statusGroupBy.group"}):"option"===e?i()(d.FormattedMessage,{defaultMessage:"Option",id:"database.groupMenu.statusGroupBy.option"}):void(0,k.t1)(e)}function Ta(e){return"relative"===e?i()(d.FormattedMessage,{defaultMessage:"Relative",id:"database.groupMenu.dateGroupBy.relative"}):"day"===e?i()(d.FormattedMessage,{defaultMessage:"Day",id:"database.groupMenu.dateGroupBy.day"}):"week"===e?i()(d.FormattedMessage,{defaultMessage:"Week",id:"database.groupMenu.dateGroupBy.week"}):"month"===e?i()(d.FormattedMessage,{defaultMessage:"Month",id:"database.groupMenu.dateGroupBy.month"}):"year"===e?i()(d.FormattedMessage,{defaultMessage:"Year",id:"database.groupMenu.dateGroupBy.year"}):void(0,k.t1)(e)}function Pa(e){return"exact"===e?i()(d.FormattedMessage,{defaultMessage:"Exact",id:"database.groupMenu.textGroupBy.exact"}):"alphabet_prefix"===e?i()(d.FormattedMessage,{defaultMessage:"Alphabetical",id:"database.groupMenu.textGroupBy.alphabetical"}):void(0,k.t1)(e)}Sa.displayName="CollectionSettingsViewGroup";const Aa=(0,d.injectIntl)(Sa);var Va=o(1136);function Fa(e){window.__c={n:"ContentOnlyEditorEducationPill"};const{style:t}=e,o=(0,M.Fg)(),n=(0,C.MO)(),r=i()("div",{style:{marginTop:1}},void 0,_.Z.locked({width:14,marginRight:8,height:void 0})),a=i()(D.Z,{style:{color:o.regularTextColor,lineHeight:x.Z.lineHeight.UISmall.desktop},isSmall:!0},void 0,i()(d.FormattedMessage,{defaultMessage:"You're a content editor",id:"database.viewSettings.mainTab.contentOnlyEditorPill.title"}));return i()(Z,{icon:r,title:a,style:n?{backgroundColor:o.sidebarBackground,boxShadow:o.plainButtonBoxShadow,margin:void 0,borderRadius:void 0,...t}:{background:"rgba(196, 196, 196, 0.13)",margin:"8px 14px",...t},showCloseButton:!1},void 0,i()(D.Z,{style:{marginLeft:22},isSmall:!0,isMultiline:!0},void 0,i()(d.FormattedMessage,{defaultMessage:"Content editors can edit pages, but cannot change view and database settings.",id:"database.viewSettings.mainTab.contentOnlyEditorPill.subtitle"})))}var Ia=o(74420),Ba=o(76798),Za=o(32662);const Ea=(0,d.defineMessages)({viewNamePlaceholderMessage:{defaultMessage:"View name",id:"database.viewSettings.mainTab.viewNamePlaceholder.title"}});class Da extends s.Z{constructor(){super(...arguments),this.handleViewNameSubmit=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();o&&o.isDefined()&&(o.getName()!==e&&m.createAndCommit({userAction:"CollectionSettingsViewMain.handleViewNameSubmit",environment:this.environment,perform:t=>{me.iG({collectionViewStore:o,update:{name:e},transaction:t})}}),pe.wd({environment:this.environment,collectionContextStore:t,action:"rename",original_view_type:o.getType()}))},this.handleViewIconSubmit=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();o&&o.isDefined()&&(m.createAndCommit({userAction:"CollectionSettingsViewMain.handleViewIconSubmit",environment:this.environment,perform:t=>{me.Uy({collectionViewBlockStore:o,icon:e,transaction:t})}}),pe.wd({environment:this.environment,collectionContextStore:t,action:"change_icon",icon:e}))},this.handleDuplicateClick=()=>{const{collectionContextStore:e,collectionSettingsStore:t,intl:o}=this.props,n=e.collectionViewStore();n&&(p.zt({environment:this.environment,collectionContextStore:e,collectionViewStore:n,collectionSettingsStore:t,intl:o}),pe.wd({environment:this.environment,collectionContextStore:e,action:"click_duplicate",original_view_type:n.getType()}))},this.handleCopyLinkClick=()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore();t&&(p.Ol({environment:this.environment,collectionContextStore:e,collectionViewStore:t}),pe.wd({environment:this.environment,collectionContextStore:e,action:"click_copy_link",original_view_type:t.getType()}))},this.handleDeleteClick=()=>{const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=e.collectionViewStore();o&&(p.TT({environment:this.environment,collectionContextStore:e,collectionViewStore:o,collectionSettingsStore:t,from:"view_settings"}),pe.wd({environment:this.environment,collectionContextStore:e,action:"click_delete",original_view_type:o.getType()}))},this.handleToggleLockClick=()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewBlockStore();t&&(ea.bo({environment:this.environment,store:t,lock:!t.isLocked()}),pe.wd({environment:this.environment,collectionContextStore:e,action:"click_toggle_lock"}))},this.shouldRenderDatabaseTypeStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.collectionStore(),o=e.collectionViewBlockStore(),n=e.collectionViewStore();if(!t||!o||!n)return!1;if(t.isSyncedCollection())return!1;return void 0!==o.getCollectionViewSourceCollectionStore()})),this.shouldRenderSourceStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.collectionStore(),o=e.collectionViewBlockStore(),n=e.collectionViewStore();if(!t||!o||!n)return!1;if(t.isSyncedCollection())return!0;return void 0===o.getCollectionViewSourceCollectionStore()}))}renderComponent(){const{device:e}=this.environment,{collectionContextStore:t,selectViewNameInitial:o}=this.props,n=t.collectionViewStore(),r=t.collectionViewBlockStore();if(!n||!r)return;if(!n.isDefined())return;const s=t.permissionScopes.state,c=(0,xt.rm)()&&this.renderType(),u=n.getFormat().collection_view_icon,p=n.getType(),g=n.getAppConfigUri(),m=!(0,k.$K)(g)||!(0,xt.xB)(g),y=i()(E.Z,{title:e.isMobile&&i()(d.FormattedMessage,{defaultMessage:"View name",id:"database.viewSettings.mainTab.viewNameSection.title"})},void 0,i()(jr.Z,{initialValue:n.getName()||"",placeholder:Fe.default.formatMessage(Ea.viewNamePlaceholderMessage),onBlur:this.handleViewNameSubmit,onSubmit:this.handleViewNameSubmit,focusInitial:o,selectAll:o,disabled:!s.canConfigureBlock||!m,iconButton:{icon:e=>i()(Va.F,{color:"gray",viewIcon:u,viewType:p,style:{marginRight:6}}),iconStyle:{fill:Xr.Lr[this.theme.mode].gray},enforceIconColor:"gray",onSubmit:this.handleViewIconSubmit}}));return"page"===n.getType()?l.createElement(F.ZP,a()({},this.props,{title:i()(d.FormattedMessage,{defaultMessage:"View options",id:"database.viewSettings.mainTab.title"})}),y):l.createElement(F.ZP,a()({},this.props,{title:i()(d.FormattedMessage,{defaultMessage:"View options",id:"database.viewSettings.mainTab.title"})}),this.renderContentOnlyEditorEducationPill(),y,e.isMobile?i()(E.Z,{topBorder:!0},void 0,this.renderSource(),this.renderLayout(),this.renderProperties(),this.renderFilter(),this.renderSort(),this.renderGroup(),this.renderSubGroup(),this.renderRelationFeatures(),i()(na,{collectionContextStore:t}),this.renderAutomationAction()):l.createElement(l.Fragment,null,i()(E.Z,{},void 0,c,!c&&this.renderSource(),!c&&this.renderLayout()),i()(E.Z,{topBorder:!0},void 0,c&&this.renderSource(),c&&this.renderLayout(),this.renderProperties(),this.renderFilter(),this.renderSort(),this.renderGroup(),this.renderSubGroup(),this.renderRelationFeatures(),i()(na,{collectionContextStore:t}),this.renderAutomationAction())),i()(E.Z,{topBorder:!0},void 0,this.renderNotificationAction(),this.renderLockAction(),this.renderCopyLinkAction(),this.renderDuplicateAction(),this.renderDeleteAction()),r.getAppContainerBlockStore()&&i()(E.Z,{topBorder:!0},void 0,this.renderEditSettingsAction()))}renderContentOnlyEditorEducationPill(){const{collectionContextStore:e}=this.props,t=e.collectionViewBlockStore();if(t&&"content_only_editor"===t.getRole())return i()(Fa,{})}renderLockAction(){const{collectionContextStore:e}=this.props,t=e.collectionViewBlockStore();if(!t)return;const o=t.getCollectionViewSourceCollectionStore(),n=t.isLocked();if(!(o?o.canEditCollection():t.canEditCollection()))return;const r=null==t?void 0:t.isCollectionViewPageWithContent();return i()(I.Z,{icon:n?_.Z.unlocked:_.Z.locked,title:this.getLockUnlockTitle(o,r,n),onClick:this.handleToggleLockClick})}getLockUnlockTitle(e,t,o){return i()(d.FormattedMessage,t?o?{defaultMessage:"Unlock wiki",id:"action.unlockWikiName.name"}:{defaultMessage:"Lock wiki",id:"action.lockWikiName.name"}:e?o?{defaultMessage:"Unlock database",id:"database.viewSettings.mainTab.unlockDatabase.title"}:{defaultMessage:"Lock database",id:"database.viewSettings.mainTab.lockDatabase.title"}:o?{defaultMessage:"Unlock views",id:"database.viewSettings.mainTab.unlockViews.title"}:{defaultMessage:"Lock views",id:"database.viewSettings.mainTab.lockViews.title"})}renderCopyLinkAction(){return i()(I.Z,{icon:_.Z.link,title:i()(d.FormattedMessage,{defaultMessage:"Copy link to view",id:"database.viewSettings.mainTab.copyLinkButton.title"}),onClick:this.handleCopyLinkClick})}renderDuplicateAction(){const{collectionContextStore:e}=this.props;if(e.permissionScopes.state.canConfigureBlock&&"collectionTypedView"!==e.contextType)return i()(I.Z,{icon:_.Z.duplicate,title:i()(d.FormattedMessage,{defaultMessage:"Duplicate view",id:"database.viewSettings.mainTab.duplicateButton.title"}),onClick:this.handleDuplicateClick})}renderGroup(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=this.getCurrentViewType(),n="board"===o?{groupByKey:"board_columns_by",groupsFormatKey:"board_columns"}:{groupByKey:"collection_group_by",groupsFormatKey:"collection_groups"},r=e.normalizedSchemaStore.state,a=e.normalizedFormatStore.state[n.groupByKey],l=e.permissionScopes.state;return"calendar"!==o&&i()(I.Z,{icon:"board"===o?_.Z.groupByHorizontal:_.Z.groupByVertical,title:i()(d.FormattedMessage,{defaultMessage:"Group",id:"database.viewSettings.mainTab.groupButton.title"}),showChevron:!0,right:fa(a?r[a.property]:void 0),onClick:()=>{var i;pe.wd({environment:this.environment,collectionContextStore:e,action:"click_group",original_view_type:o,property_type:a?null===(i=r[a.property])||void 0===i?void 0:i.type:void 0}),e.loadingDetails.setState({type:"load_groups_menu"}),p.H4({collectionSettingsStore:t,item:a?{type:"group",...n}:{type:"groupByProperty",...n}})},disabled:!a&&!l.canConfigureBlock})}renderSubGroup(){const e=this.getCurrentViewType(),{collectionContextStore:t,collectionSettingsStore:o}=this.props,n=t.normalizedSchemaStore.state,r=t.normalizedFormatStore.state.collection_group_by,a={groupByKey:"collection_group_by",groupsFormatKey:"collection_groups"},l=t.permissionScopes.state;return"board"===e&&i()(I.Z,{icon:_.Z.groupByVertical,title:i()(d.FormattedMessage,{defaultMessage:"Sub-group",id:"database.viewSettings.mainTab.subGroupButton.title"}),showChevron:!0,right:fa(r?n[r.property]:void 0),onClick:()=>{var i;pe.wd({environment:this.environment,collectionContextStore:t,action:"click_subgroup",original_view_type:e,property_type:r?null===(i=n[r.property])||void 0===i?void 0:i.type:void 0}),t.loadingDetails.setState({type:"load_groups_menu"}),p.H4({collectionSettingsStore:o,item:r?{type:"group",...a}:{type:"groupByProperty",...a}})},disabled:!r&&!l.canConfigureBlock})}renderRelationFeatures(){const{collectionContextStore:e}=this.props,t=e.collectionStore();if((null==t||!t.isSyncedCollection())&&"collectionTypedView"!==e.contextType)return i()(l.Fragment,{},void 0,this.renderSubitem(),this.renderArrowsBy())}renderSubitem(){return so.default.checkGate("dependency_date_shifting_by_space")?this.renderSubitemV2():this.renderSubitemV1()}renderSubitemV1(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=e.normalizedSchemaStore.state,n=e.currentSubitemFormatStore.state,r=n?o[n.property]:void 0,a=e.permissionScopes.state;return i()(I.Z,{icon:_.Z.nest,title:i()("div",{style:{display:"inline-flex",alignItems:"center"}},void 0,i()(d.FormattedMessage,{defaultMessage:"Sub-items",id:"database.viewSettings.mainTab.subitems.title"}),i()(Za.Z,{size:2})),showChevron:!0,right:i()("span",{style:{...x.Z.textOverflowStyle}},void 0,(null==r?void 0:r.name)??i()(d.FormattedMessage,{defaultMessage:"None",id:"database.viewSettings.subitemTab.none"})),onClick:()=>{pe.wd({environment:this.environment,collectionContextStore:e,action:"click_subitem"}),p.H4({collectionSettingsStore:t,item:{type:"subitem"}})},disabled:!n&&!a.canConfigureBlock})}renderSubitemV2(){const{collectionSettingsStore:e,collectionContextStore:t}=this.props,o=t.currentSubitemFormatStore.state,n=t.databaseType,r=$e({feature:"subitem",collectionContextStore:t});return i()(I.Z,{icon:_.Z.nest,title:l.createElement(d.FormattedMessage,(0,P.Pm)(n)),showChevron:!0,right:this.getLabelForRelationFeatureItem(r),onClick:()=>{p.H4({collectionSettingsStore:e,item:{type:"subitemV2"}})},disabled:!this.isRelationFeatureEnabled(o)})}getLabelForRelationFeatureItem(e){let t;return t=e?e.supportedInView&&!e.enabledOnView?P.dH.relationFeatureHiddenMessage:P.dH.relationFeatureOnMessage:P.dH.relationFeatureOffMessage,Fe.default.formatMessage(t)}renderArrowsBy(){return so.default.checkGate("dependency_date_shifting_by_space")?this.renderArrowsByV2():lt({feature:"timeline_arrows_by",viewType:this.getCurrentViewType()})?this.renderArrowsByV1():void 0}renderArrowsByV1(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=e.normalizedSchemaStore.state,n=e.currentArrowsByFormatStore.state,r=n?o[n]:void 0,a=e.permissionScopes.state;return i()(I.Z,{icon:_.Z.arrowsDiverging,title:i()("div",{style:{display:"inline-flex",alignItems:"center"}},void 0,i()(d.FormattedMessage,{defaultMessage:"Dependencies",id:"database.viewSettings.mainTab.dependencies.title"}),i()(Za.Z,{size:2})),showChevron:!0,right:i()("span",{style:{...x.Z.textOverflowStyle}},void 0,(null==r?void 0:r.name)??i()(d.FormattedMessage,{defaultMessage:"None",id:"database.viewSettings.arrowsByTab.none"})),onClick:()=>{pe.wd({environment:this.environment,collectionContextStore:e,action:"click_timeline_arrows_by"}),p.H4({collectionSettingsStore:t,item:{type:"arrowsBy"}})},disabled:!n&&!a.canConfigureBlock})}renderArrowsByV2(){const{collectionSettingsStore:e,collectionContextStore:t}=this.props,o=t.currentArrowsByFormatStore.state,n=$e({feature:"timeline_arrows_by",collectionContextStore:t});return i()(I.Z,{title:l.createElement(d.FormattedMessage,P.dH.dependenciesMenuItemLabel),showChevron:!0,icon:_.Z.collectionDependenciesArrowRight,right:this.getLabelForRelationFeatureItem(n),onClick:()=>{p.H4({collectionSettingsStore:e,item:{type:"dependencies"}})},disabled:!this.isRelationFeatureEnabled(o)})}isRelationFeatureEnabled(e){const{collectionContextStore:t}=this.props,o=t.permissionScopes.state,n=(0,k.$K)(e),i=o.canConfigureBlock;return n||i}renderNotificationAction(){if(so.default.checkGate("status_automations"))return;if(!(0,S.F6)())return;if(!function(e){return!!e&&(!(e.isSyncedCollection()&&!so.default.checkGate("support_synced_database_automations"))&&(!!fo({collectionStore:e})||e.getAutomationStores().filter((e=>e.isTriggerType("notification_event"))).length>0))}(this.props.collectionContextStore.collectionStore()))return;const{collectionSettingsStore:e}=this.props,t=this.props.collectionContextStore.aliveSlackAutomationCount.state;return i()(I.Z,{icon:_.Z.bell,title:i()(d.FormattedMessage,{defaultMessage:"Slack notifications",id:"database.viewSettings.mainTab.slackNotifications.title"}),right:t>0?l.createElement(l.Fragment,null,t.toString()):i()(d.FormattedMessage,{id:"database.viewSettings.mainTab.slackNotifications.none",defaultMessage:"None"}),showChevron:!0,onClick:()=>{t>0?p.H4({collectionSettingsStore:e,item:{type:"slackAutomations"}}):p.H4({collectionSettingsStore:e,item:{type:"createSlackAutomation"}})}})}renderAutomationAction(){if(!so.default.checkGate("status_automations"))return;const{collectionContextStore:e,collectionSettingsStore:t}=this.props;if(!function(e){return!!e&&(!(e.isSyncedCollection()&&!so.default.checkGate("support_synced_database_automations"))&&(!!So({collectionStore:e})||e.getAutomationStores().length>0))}(e.collectionStore()))return;const o=this.props.collectionContextStore.aliveAutomationCount.state;return i()(I.Z,{icon:_.Z.bolt,onClick:()=>{o>0?p.H4({collectionSettingsStore:t,item:{source:"collection_view_settings",type:"automationSettings"}}):(p.H4({collectionSettingsStore:t,item:{source:"collection_view_settings",type:"automationSettings"}}),p.H4({collectionSettingsStore:t,item:{type:"automationCreateSettings"}}))},right:o>0?o:i()(d.FormattedMessage,{id:"database.viewSettings.mainTab.automations.none",defaultMessage:"None"}),showChevron:!0,title:i()(d.FormattedMessage,{defaultMessage:"Automations",id:"database.viewSettings.mainTab.automations.title"})})}renderDeleteAction(){const{collectionContextStore:e}=this.props;if(!e.collectionViewBlockStore())return;return e.permissionScopes.state.canConfigureBlock&&"collectionTypedView"!==e.contextType?i()(I.Z,{icon:_.Z.trash,title:i()(d.FormattedMessage,{defaultMessage:"Delete view",id:"database.viewSettings.mainTab.deleteButton.title"}),isRed:!0,onClick:this.handleDeleteClick}):void 0}renderEditSettingsAction(){const{collectionContextStore:e}=this.props,t=e.collectionViewBlockStore();if(!t)return;return e.permissionScopes.state.canConfigureBlock?i()(I.Z,{icon:_.Z.options,title:i()(d.FormattedMessage,{defaultMessage:"Edit {databaseName} settings",id:"CollectionSettingsViewMain.editSettings",values:{databaseName:i()(Ba.Z,{store:t,style:{display:"inline"}})}}),onClick:()=>{p.tS({environment:this.environment,store:t}),p.E3({collectionSettingsStore:e.settingsStore})}}):void 0}renderSource(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=e.collectionStore(),n=e.collectionViewBlockStore();if(!o||!n)return;if(!this.shouldRenderSourceStore.state)return;const r=o.getIcon();return i()(I.Z,{icon:_.Z.folder,title:i()(d.FormattedMessage,{defaultMessage:"Source",id:"database.viewSettings.mainTab.sourceButton.title"}),showChevron:!0,right:l.createElement(l.Fragment,null,r&&i()(Kr.Z,{icon:r,isEmptyPage:!1,size:20,disabled:!0,style:{marginRight:4,opacity:.6}}),i()(Ba.Z,{store:o})),rightStyle:{flexShrink:1},textWrapperStyle:{flexShrink:0},onClick:()=>{pe.wd({environment:this.environment,collectionContextStore:e,action:"click_source"}),p.H4({collectionSettingsStore:t,item:{type:"source"}})}})}renderLayout(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=e.collectionViewStore();if(!o)return;const n=o.getType();return n?i()(I.Z,{icon:_.Z.layoutPadded,isPadded:!0,title:i()(d.FormattedMessage,{defaultMessage:"Layout",id:"database.viewSettings.mainTab.layoutButton.title"}),showChevron:!0,right:Ve.Bh[n],onClick:()=>{pe.wd({environment:this.environment,collectionContextStore:e,action:"click_layout"}),p.H4({collectionSettingsStore:t,item:{type:"layout"}})}}):void 0}renderType(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=e.collectionStore();if(!o)return;if(!this.shouldRenderDatabaseTypeStore.state)return;const n=o.getDatabaseType(),r=n?$r.pX[n]:"untyped";return i()(I.Z,{icon:()=>_.Z.settingsIntegration({width:20}),isPadded:!0,title:i()("div",{style:{display:"inline-flex",alignItems:"center"}},void 0,i()(d.FormattedMessage,{defaultMessage:"Database type",id:"database.viewSettings.mainTab.databaseTypeButton.title"}),i()(Ia.Z,{})),showChevron:!0,right:qr.kd[r],onClick:()=>{pe.wd({environment:this.environment,collectionContextStore:e,action:"click_database_type"}),p.H4({collectionSettingsStore:t,item:{type:"setDatabaseType"}})}})}renderProperties(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=(e.normalizedFormatStore.state[(0,Ae.oz)(this.getCurrentViewType())]||[]).filter((e=>Boolean(e.visible))).length;return i()(I.Z,{icon:_.Z.properties,title:i()(d.FormattedMessage,{defaultMessage:"Properties",id:"database.viewSettings.mainTab.propertiesButton.title"}),showChevron:!0,right:i()(d.FormattedMessage,{defaultMessage:"{propertiesShown} shown",id:"database.viewSettings.mainTab.propertiesButton.propertiesShown.title",values:{propertiesShown:o}}),onClick:()=>{pe.wd({environment:this.environment,collectionContextStore:e,action:"click_properties"}),p.H4({collectionSettingsStore:t,item:{type:"properties",timelineViewTab:"timeline"}})}})}renderFilter(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=e.permissionScopes.state,n=e.currentPropertyFiltersStore.state.length+(e.currentCombinatorFilterStore.state&&o.canConfigureBlock?1:0);return i()(I.Z,{icon:_.Z.filterCircled,title:i()(d.FormattedMessage,{defaultMessage:"Filter",id:"database.viewSettings.mainTab.filterButton.title"}),showChevron:!0,right:i()(d.FormattedMessage,n>0?{defaultMessage:"{numberOfFilters, plural, one {{numberOfFilters} filter} other {{numberOfFilters} filters}}",values:{numberOfFilters:n},id:"database.viewSettings.mainTab.filterButton.filters.title"}:{defaultMessage:"None",id:"database.viewSettings.mainTab.filterButton.noFilters.title"}),onClick:()=>{pe.wd({environment:this.environment,collectionContextStore:e,action:"click_filters"}),0===n?p.H4({collectionSettingsStore:t,item:{type:"createFilter"}}):p.H4({collectionSettingsStore:t,item:{type:"filters"}})}})}renderSort(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=e.currentSortsStore.state.length;return i()(I.Z,{icon:_.Z.sortPadded,isPadded:!0,title:i()(d.FormattedMessage,{defaultMessage:"Sort",id:"database.viewSettings.mainTab.sortButton.title"}),showChevron:!0,right:i()(d.FormattedMessage,o>0?{defaultMessage:"{numberOfSorts, plural, one {{numberOfSorts} sort} other {{numberOfSorts} sorts}}",values:{numberOfSorts:o},id:"database.viewSettings.mainTab.sortButton.oneOrMoreSorts.title"}:{defaultMessage:"None",id:"database.viewSettings.mainTab.sortButton.noSorts.title"}),onClick:()=>{pe.wd({environment:this.environment,collectionContextStore:e,action:"click_sort"}),0===o?p.H4({collectionSettingsStore:t,item:{type:"createSort"}}):p.H4({collectionSettingsStore:t,item:{type:"sort"}})}})}getCurrentViewType(){var e;const{collectionContextStore:t}=this.props,o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType();if(!o)throw new Error("View type was not defined.");return o}}Da.displayName="CollectionSettingsViewMain";const Ka=(0,d.injectIntl)(Da);class Na extends s.Z{constructor(){super(...arguments),this.handleViewNameBlur=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();o&&o.isDefined()&&o.getName()!==e&&m.createAndCommit({userAction:"CollectionSettingsCreateView.handleViewNameBlur",environment:this.environment,perform:t=>{me.iG({collectionViewStore:o,update:{name:e},transaction:t})}})},this.handleViewNameSubmit=e=>{const{collectionSettingsStore:t,collectionContextStore:o}=this.props;this.handleViewNameBlur(e),p.wl({collectionSettingsStore:t,item:{type:"main"}}),pe.wd({environment:this.environment,collectionContextStore:o,action:"rename"})},this.handleViewIconSubmit=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();o&&o.isDefined()&&(m.createAndCommit({userAction:"CollectionSettingsCreateView.handleViewIconSubmit",environment:this.environment,perform:t=>{me.Uy({collectionViewBlockStore:o,icon:e,transaction:t})}}),pe.wd({environment:this.environment,collectionContextStore:t,action:"change_icon",icon:e}))}}renderComponent(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,{device:o}=this.environment,n=e.collectionViewStore();if(!n)return;if(!n.isDefined())return;const r=n.getFormat().collection_view_icon,s=n.getType();return l.createElement(F.ZP,a()({},this.props,{title:i()(d.FormattedMessage,{defaultMessage:"New view",id:"database.viewSettings.createViewTab.title"}),desktopWidth:290}),i()(E.Z,{},void 0,i()(jr.Z,{initialValue:"",placeholder:Fe.default.formatMessage(Ea.viewNamePlaceholderMessage),focusInitial:!o.isMobile||void 0,onBlur:this.handleViewNameBlur,iconButton:{icon:e=>i()(Va.F,{color:"gray",viewIcon:r,viewType:s,style:{marginRight:6}}),iconStyle:{fill:Xr.Lr[this.theme.mode].gray},enforceIconColor:"gray",onSubmit:this.handleViewIconSubmit},onSubmit:this.handleViewNameSubmit})),i()(Jr.Z,{collectionContextStore:e,collectionSettingsStore:t,showDoneButton:!o.isMobile}))}}Na.displayName="CollectionSettingsCreateView";const Ra=(0,d.injectIntl)(Na);var Oa=o(49670),Wa=o(51127),Ga=o(64964),La=o(25464),za=o(74523);function Ua(e){window.__c={n:"CollectionSettingsDBTypePropertyMapping"};const t=(0,C.O7)(),o=t.device.isMobile,{collectionSettingsStore:n,collectionContextStore:r,databaseType:s}=e,c=(0,w.VK)((()=>xt.TR(s)),[s]),u=(0,w.VK)((()=>{var e;return null===(e=r.collectionStore())||void 0===e?void 0:e.getSchema()}),[r]),g=(0,w.VK)((()=>{if(u&&c)return xt.Au(c,u)}),[c,u]),y=(0,w.VK)((()=>{const e={};return Object.keys(c||{}).filter((e=>void 0!==(null==c?void 0:c[e])&&e.startsWith("notion://"))).forEach((t=>{e[t]=$r.bK})),Object.entries(g||{}).forEach((t=>{let[o,n]=t;e[o]=n})),e}),[c,g]),[S,f]=(0,l.useState)(y),[h,v]=(0,l.useState)(!1),b=(0,l.useCallback)(((e,t)=>{f({...S,[e]:t})}),[S]),M=(0,w.VK)((()=>{const e=$r.GL[s],t=xt.vi(e);return t&&xt.yK(t,e)}),[s]),k=(0,l.useCallback)((()=>{const e=r.collectionStore(),o=r.collectionViewBlockStore();e&&o&&m.createAndCommit({userAction:"CollectionSettingsDBTypePropertyMapping.migrateDatabase",environment:t,perform:r=>{Wa.vD({environment:t,collectionViewBlockStore:o,collectionStore:e,databaseType:s,propertyMapping:{...S,...g},typedPropertySchemas:{...c,...M},transaction:r}),p.E3({collectionSettingsStore:n}),Ga.oV({label:i()(d.FormattedMessage,{defaultMessage:"<boldtext>{databaseName}</boldtext> has been changed to {databaseType} type",id:"database.viewSettings.databaseTypePropertyMappingTab.successfulTypingToastMessage",values:{boldtext:e=>i()("span",{style:{fontWeight:x.Z.fontWeight.semibold}},void 0,"¬†",e,"¬†"),databaseType:s,databaseName:e.getName()||"Untitled"}})})}})}),[c,M,S,g,n,r,s,t]),T=(0,l.useCallback)((e=>{const t=e.type;return(u?Object.entries(u):[]).filter((e=>{let[o,n]=e;if(n)return n.type===t})).map((e=>{let[o,n]=e;return{key:o,title:null==n?void 0:n.name,icon:xn.wG[t]({width:12})}}))}),[u]),P=(0,l.useCallback)(((e,t,o)=>{const n=o||(null==c?void 0:c[e]);if(!n)return null;const r=n.name,a=T(n);return i()(ta.Z,{title:r,selectedKey:S[e]||t,popupStyle:{minWidth:190},icon:xn.wG[n.type],options:[...a,{key:t,title:t,icon:_.Z.plus({width:12})}],onChange:t=>b(e,t)})}),[S,c,T,b]),A=(0,l.useMemo)((()=>{const e=Object.entries(M||{}).map((e=>{let[t,o]=e;return P(t,$r.bK,o)}));return h||e.length<=3?e:e.slice(0,3)}),[M,h,P]);return l.createElement(F.ZP,a()({},e,{title:i()(d.FormattedMessage,{defaultMessage:"Database type",id:"database.viewSettings.databaseTypePropertyMappingTab.title"})}),i()(E.Z,{topBorder:!1,shouldShowBottomDivider:o,title:i()(d.FormattedMessage,{defaultMessage:"New database type",id:"database.viewSettings.databaseTypePropertyMappingTab.type"}),style:{paddingBottom:15}},void 0,i()("div",{style:{display:"flex",alignItems:"center",paddingLeft:20}},void 0,i()("div",{},void 0,qr.by[s]({width:13,height:13,marginRight:8})),i()("span",{style:{fontSize:14}},void 0,qr.kd[s]))),i()(E.Z,{topBorder:!1,shouldShowBottomDivider:o,title:i()("div",{style:{display:"flex",alignItems:"center"}},void 0,i()(d.FormattedMessage,{defaultMessage:"Required Properties",id:"database.viewSettings.databaseTypePropertyMappingTab.requiredPropertiesTitle"}),i()(St.Z,{placement:La.u.Right,render:e=>l.createElement(za.Z,a()({},e,{href:(0,sa.UY)("guides.databaseType"),analyticsFrom:"set_database_type",style:{marginLeft:4}})),renderTooltip:()=>i()(d.FormattedMessage,{id:"database.viewSettings.databaseTypePropertyMappingTab.requiredPropertiesTooltip",defaultMessage:"Properties required for {type}",values:{type:s}})}))},void 0,Object.entries(y).map((e=>{let[t,o]=e;return P(t,$r.bK)}))),i()(E.Z,{topBorder:!1,shouldShowBottomDivider:o,title:i()(d.FormattedMessage,{defaultMessage:"Suggested Properties",id:"database.viewSettings.databaseTypePropertyMappingTab.suggestedPropertiesTitle"})},void 0,A),!h&&i()(or.Z,{style:{marginLeft:12},onClick:e=>{e.stopPropagation(),v(!0)}},void 0,i()("div",{style:{}},void 0,i()(d.FormattedMessage,{defaultMessage:"More...",id:"database.viewSettings.databaseTypePropertyMappingTab.showMoreSuggestedProperties"}))),i()(fe.Z,{style:{display:"flex",margin:"14px",height:32},onClick:()=>{k()}},void 0,i()(d.FormattedMessage,{defaultMessage:"Change to {type}",id:"database.viewSettings.databaseTypePropertyMappingTab.confirmChangeType",values:{type:s}})),i()(ua.Z,{href:(0,sa.UY)("guides.databaseType"),title:i()(d.FormattedMessage,{defaultMessage:"Learn about {type} databases",id:"database.viewSettings.databaseTypePropertyMappingTab.learnMoreButton.title",values:{type:qr.kd[s]}}),analyticsFrom:"set_database_type"}))}var Ha=o(68641);class $a extends s.Z{renderComponent(){return l.createElement(F.ZP,a()({},this.props,{title:i()(d.FormattedMessage,{defaultMessage:"Deleted properties",id:"database.viewSettings.propertyTab.deletedTitle"})}),this.renderContent())}renderContent(){const{collectionContextStore:e}=this.props,t=e.normalizedDeletedSchemaStore.state,o=Object.entries(t).map((e=>{let[t,o]=e;if(o)return{propertyId:t,propertySchema:o}})).filter(k.$K);if(0===o.length)return i()(E.Z,{},void 0,i()(ma.Z,{title:i()(d.FormattedMessage,{defaultMessage:"No results",id:"database.viewSettings.deletedPropertiesTab.noResults"})}));const{theme:n}=this;return i()(E.Z,{},void 0,o.map((e=>{let{propertyId:t,propertySchema:o}=e;return i()(ma.Z,{title:i()("div",{style:{display:"flex",alignItems:"center"}},void 0,i()(xn.ZP,{type:o.type,icon:o.icon,size:16,theme:n,style:{fill:n.regularIconColor}}),i()("span",{style:{marginLeft:6,maxWidth:200,...x.Z.textOverflowStyle}},void 0,o.name)),right:l.createElement(l.Fragment,null,i()(Cn.Z,{icon:_.Z.undo,iconStyle:{marginRight:2},onClick:()=>{this.handleRestoreDeletedPropertyClick(t)}}),i()(Cn.Z,{icon:_.Z.trash,onClick:()=>{this.handlePermanentlyDeleteDeletedPropertyClick(t)}}))},t)})))}handleRestoreDeletedPropertyClick(e){const{collectionSettingsStore:t,collectionContextStore:o,timelineViewTab:n}=this.props,r=o.collectionStore(),a=(0,Ha.jI)({timelineViewTab:n,collectionContextStore:o});if(r){const o=T.D8({deletedSchema:r.getDeletedSchema(),property:e});if(o){var l;if("verification"===(null===(l=r.getDeletedSchema()[e])||void 0===l?void 0:l.type)){const e=r.getSchema();if(Object.keys(e).some((t=>{var o;return"verification"===(null===(o=e[t])||void 0===o?void 0:o.type)})))return void ye.showDialog({message:i()(d.FormattedMessage,{id:"database.deletedPropertiesTab.cannotRestoreDuplicateProperty.modal.verification",defaultMessage:"You can only have one verification property."}),showCancel:!1,keepFocus:!0,items:[{label:i()(d.FormattedMessage,{id:"database.deletedPropertiesTab.cannotRestoreDuplicateProperty.modal.dismissButton",defaultMessage:"Dismiss"}),onAccept:()=>{}}]})}m.createAndCommit({userAction:"CollectionSettingsDeletedProperties.handleRestoreDeletedPropertyClick",environment:this.environment,perform:e=>{me.xO({environment:this.environment,collectionStore:r,update:o.updateSchema,transaction:e}),me.$N({collectionStore:r,update:o.updateDeletedSchema,transaction:e})}}),p.z$({collectionSettingsStore:t}),p.H4({collectionSettingsStore:t,item:{type:"property",property:e,formatKey:a}})}}}handlePermanentlyDeleteDeletedPropertyClick(e){ye.showDialog({message:i()(d.FormattedMessage,{id:"database.viewSettings.deletedPropertiesTab.permanentlyDeleteProperty.modal.prompt",defaultMessage:"Are you sure you want to delete this property?"}),showCancel:!0,keepFocus:!0,items:[{label:i()(d.FormattedMessage,{id:"database.viewSettings.propertyTab.deleteProperty.modal.confirmButton",defaultMessage:"Delete"}),color:"red",onAccept:()=>{const t=this.props.collectionContextStore.collectionStore();t&&m.createAndCommit({userAction:"CollectionSettingsDeletedProperties.handlePermanentlyDeleteDeletedPropertyClick",environment:this.environment,perform:o=>{me.$N({collectionStore:t,update:{[e]:null},transaction:o})}})}}]})}}$a.displayName="CollectionSettingsDeletedProperties";const qa=(0,d.injectIntl)($a);var ja=o(83319);function Ya(e){const{actionStores:t,automationStore:o,loadingStatus:n,mode:i}=e;return(0,w.VK)((()=>"create"===i?"edit":"resolved"===n&&o&&t?ho({automationStore:o,actionStores:t})?"edit":vo({automationStore:o})?"readonly_with_delete":"readonly":"readonly"),[i,n,o,t])}var Qa=o(84398),Xa=o(23223),Ja=o(42402);const el=(0,d.defineMessages)({automationIncompatibleViewFilterAndOwner:{defaultMessage:"This automation may not work because the view has a non-supported filter",id:"AutomationHeaderView.incompatibleCollectionViewFilter.owner"},automationPublicAccess:{defaultMessage:"This automation is part of a public page",id:"AutomationHeaderView.automationPublicAccess"},automationUpgrade:{defaultMessage:"<anchor-upsell>Upgrade</anchor-upsell> to edit this automation or create your own",id:"AutomationHeaderView.automationUpgrade"},automationSlackNoPermissions:{defaultMessage:"Ask {user} to edit this automation",id:"AutomationHeaderView.automationSlackNoPermissions"},automationSlackWithPermissions:{defaultMessage:"Ask {user} to edit this automation or <anchor-delete>delete</anchor-delete> it when necessary",id:"AutomationHeaderView.automationSlackWithPermissions"},automationMissingPermissionsNoPermissions:{defaultMessage:"You must have full access to target databases in this automation to edit it",id:"AutomationHeaderView.automationMissingPermissionsNoPermissions"},automationMissingPermissionsWithPermissions:{defaultMessage:"You must have full access to target databases in this automation to edit it or <anchor-delete>delete</anchor-delete> it when necessary",id:"AutomationHeaderView.automationMissingPermissionsWithPermissions"},automationGenericFullAccess:{defaultMessage:"You must have full access to this database to edit automations",id:"AutomationHeaderView.automationGenericFullAccess"}});function tl(e){window.__c={n:"AutomationHeaderView"};const{automationStore:t,automationPermissionScope:o,collectionStore:n,onDelete:r,referencesIncompatibleCollectionViewFilter:s,showSlackSpecificMessages:c}=e,u=(0,C.O7)(),p=(0,ai.E)("status_automations_m2"),g=gn({automationStore:t,collectionStore:n}),m=(0,w.VK)((()=>Boolean((0,dn.IJ)(u,t))),[t,u]),y=(0,w.VK)((()=>(0,Xa.$5)(null==g?void 0:g.context)),[g]),S=(0,w.VK)((()=>function(e){const t=e.getActionStores().filter((0,k.AO)((e=>e.isType("slack_notification")?{true:e}:{false:e}))),o={};for(const n of t){const e=n.getConfig(),t=null==e?void 0:e.external_bot_id;if(!t)continue;const i=co.Qx.createChildStore(n,{id:t,spaceId:n.getSpaceId(),table:ro.cZ}).getCreatedByStore();i&&(o[n.id]=i.getDisplayName(Fe.default.getIntl()))}return o}(t)),[t]),f=(0,l.useCallback)((()=>{ri.y(u,{from:"database_automation_settings_header_message",for:"plus"})}),[u]),h=rl();if(c)return l.createElement(ol,e);if(m)return i()(nl,{icon:i()("div",{style:h.lockedIconWrap},void 0,_.Z.lockedFilled(h.lockedIcon))},void 0,i()("p",{style:h.paragraph},void 0,l.createElement(d.FormattedMessage,el.automationPublicAccess)));if("sufficient"!==y.editPermissionStatus&&"free_workspace"===y.reason&&p)return i()(il,{icon:i()("div",{style:h.boltIconWrap},void 0,_.Z.boltFilled(h.boltIcon))},void 0,i()("p",{style:h.paragraph},void 0,l.createElement(d.FormattedMessage,a()({},el.automationUpgrade,{values:{"anchor-upsell":e=>i()(Ja.Z,{onClick:f,style:h.link},void 0,e)}}))));if("sufficient"!==y.editPermissionStatus&&"missing_permissions"===y.reason&&y.actionId){const e=S[y.actionId];return i()(nl,{icon:i()("div",{style:h.lockedIconWrap},void 0,_.Z.lockedFilled(h.lockedIcon))},void 0,i()("p",{style:h.paragraph},void 0,l.createElement(d.FormattedMessage,a()({},"readonly"===o?el.automationSlackNoPermissions:el.automationSlackWithPermissions,{values:{"anchor-delete":e=>i()(Ja.Z,{onClick:r,style:h.link},void 0,e),user:e}}))))}return"insufficient"===y.editPermissionStatus||"unknown"===y.editPermissionStatus?i()(nl,{icon:i()("div",{style:h.lockedIconWrap},void 0,_.Z.lockedFilled(h.lockedIcon))},void 0,i()("p",{style:h.paragraph},void 0,l.createElement(d.FormattedMessage,el.automationGenericFullAccess))):s?i()(nl,{icon:i()("div",{style:h.lockedIconWrap},void 0,_.Z.warning(h.warningIcon))},void 0,l.createElement(d.FormattedMessage,el.automationIncompatibleViewFilterAndOwner)):null}function ol(e){window.__c={n:"AutomationHeaderViewSlackMessage"};const{automationCreatorName:t,automationPermissionScope:o,automationStatus:n,onDelete:r,onResume:a,referencesIncompatibleCollectionViewFilter:l}=e,s=rl();if("edit"===o){if("disabled"===n||"disabled_permissions"===n)return i()(nl,{icon:i()("div",{style:s.lockedIconWrap},void 0,_.Z.warning(s.warningIcon))},void 0,i()("p",{style:s.paragraph},void 0,i()(d.FormattedMessage,{defaultMessage:"This notification has been paused. <resumeAction>Resume notifications</resumeAction>",id:"AutomationHeaderView.header.slack.disabled.owner",values:{resumeAction:e=>i()(Ja.Z,{disableUnderline:!0,onClick:a,style:s.link},void 0,i()("br",{}),e)}})));if(l)return i()(nl,{icon:i()("div",{style:s.lockedIconWrap},void 0,_.Z.warning(s.warningIcon))},void 0,i()("p",{style:s.paragraph},void 0,i()(d.FormattedMessage,{defaultMessage:"This rule may not work because the view has a non-supported filter.",id:"AutomationHeaderView.incompatibleCollectionViewFilter.slack.owner"})))}else{if("readonly"===o)return"active"===n?i()(nl,{icon:i()("div",{style:s.personBadgeQuestionMarkWrap},void 0,_.Z.personBadgeQuestionMark(s.personBadgeQuestionMark))},void 0,i()("p",{style:s.paragraph},void 0,i()(d.FormattedMessage,{defaultMessage:"Ask {automationCreatorName} to change these settings.",id:"AutomationHeaderView.active.readonly",values:{automationCreatorName:t}}))):i()(nl,{icon:i()("div",{style:s.lockedIconWrap},void 0,_.Z.warning(s.warningIcon))},void 0,i()("p",{style:s.paragraph},void 0,i()(d.FormattedMessage,{defaultMessage:"This notification has been paused. Ask {automationCreatorName} to resume these notifications.",id:"AutomationHeaderView.disabled.slack.readonly",values:{automationCreatorName:t}})));if("readonly_with_delete"===o)return"active"===n?i()(nl,{icon:i()("div",{style:s.personBadgeQuestionMarkWrap},void 0,_.Z.personBadgeQuestionMark(s.personBadgeQuestionMark))},void 0,i()("p",{style:s.paragraph},void 0,i()(d.FormattedMessage,{id:"AutomationHeaderView.active.readonlyWithDelete",defaultMessage:"Ask {automationCreatorName} to change these settings, or <deleteAction>delete</deleteAction> when necessary.",values:{deleteAction:e=>i()(Ja.Z,{disableUnderline:!0,style:s.link,onClick:()=>{r()}},void 0,e),automationCreatorName:t}}))):i()(nl,{icon:i()("div",{style:s.lockedIconWrap},void 0,_.Z.warning(s.warningIcon))},void 0,i()("p",{style:s.paragraph},void 0,i()(d.FormattedMessage,{defaultMessage:"This notification has been paused. Ask {automationCreatorName} to resume these notifications, or <deleteAction>delete</deleteAction> when necessary.",id:"AutomationHeaderView.disabled.slack.readonlyWithDelete",values:{deleteAction:e=>i()(Ja.Z,{disableUnderline:!0,onClick:r,style:s.link},void 0,e),automationCreatorName:t}})));(0,k.t1)(o)}return null}function nl(e){window.__c={n:"AutomationMessage"};const{children:t,icon:o}=e,n=rl();return i()("div",{style:n.wrapWrap},void 0,i()("div",{style:n.wrap},void 0,o&&i()("div",{style:n.iconWrap},void 0,o),i()("div",{style:n.messageWrap},void 0,t)))}function il(e){window.__c={n:"AutomationUpsellMessage"};const{children:t,icon:o}=e,n=rl();return i()("div",{style:n.wrapWrap},void 0,i()("div",{style:n.upsellWrap},void 0,o&&i()("div",{style:n.iconWrap},void 0,o),i()("div",{style:n.messageWrap},void 0,t)))}function rl(){const{isMobile:e}=(0,C.Fy)();return(0,M.yK)((t=>({boltIcon:{fill:t.icon.yellow,height:"100%",width:"100%"},boltIconWrap:{height:20,padding:2,width:20},icon:{},iconWrap:{flexGrow:0,flexShrink:0},lockedIcon:{fill:t.icon.secondary,height:"100%",width:"100%"},lockedIconWrap:{background:t.fill.lightGray,borderRadius:3,height:20,padding:2,width:20},link:{color:t.text.interactive},messageWrap:{flexGrow:1},paragraph:{color:t.text.secondary,fontSize:e?14:12,margin:0},warningIcon:{color:t.accentColors.orange[400],height:"100%",width:"100%"},warningIconWrap:{height:20,padding:2,width:20},wrap:{alignItems:"start",display:"flex",flexDirection:"row",gap:10},wrapWrap:{padding:e?12:"0 12px 12px 12px"},upsellWrap:{alignItems:"center",background:t.accentColors.yellow[50],border:`1px solid ${t.accentColors.yellow[100]}`,borderRadius:6,display:"flex",flexDirection:"row",gap:10,padding:8},personBadgeQuestionMark:{fill:t.mediumIconColor,width:16,height:"auto"},personBadgeQuestionMarkWrap:{height:20,padding:2,width:20}})),[e])}var al=o(75024);function ll(e){window.__c={n:"AutomationEmptyStepButton"};const{icon:t,onClick:o,title:n}=e,r=(0,M.yK)((e=>({button:{alignItems:"center",border:`1px dashed ${e.regularDividerColor}`,borderRadius:6,display:"flex",color:e.accentColors.gray[900],gap:6,justifyContent:"center",padding:16},iconWrap:{fill:e.accentColors.gray[600]},title:{fontSize:14,lineHeight:1.3}})),[]);return i()(B.Z,{onClick:o,style:r.button},void 0,t&&i()("div",{"aria-hidden":"true",style:r.iconWrap},void 0,t),i()("div",{style:r.title},void 0,n))}function sl(e){window.__c={n:"AutomationActionSelectButton"};const{automationStore:t,availableActions:o,initialState:n,updateCurrentAutomationState:r,collectionStore:s}=e,c=(0,zn.d)(),d=o[0];return s?d&&"slack_notification"===d.type?i()(Ce.ZP,{alignmentToOrigin:Ce.vR.Center,placementToOrigin:Ce.pO.Bottom,forceInitialInbound:!0,popupType:c,render:e=>i()(cl,{automationStore:t,buttonPopupParent:e,updateCurrentAutomationState:r,collectionStore:s}),renderOrigin:e=>l.createElement(dl,a()({},e,{action:o[0].type}))}):i()(Ce.ZP,{alignmentToOrigin:Ce.vR.Center,placementToOrigin:Ce.pO.Bottom,popupType:c,render:e=>i()(Ai,{automationStore:t,buttonPopupParent:e,collectionStore:s,initialState:n,updateCurrentAutomationState:r}),renderOrigin:e=>l.createElement(ul,e)}):i()(ul,{onClick:()=>{}})}function cl(e){window.__c={n:"SingleActionMenu"};const{automationStore:t,buttonPopupParent:o,updateCurrentAutomationState:n,collectionStore:r}=e,a=Yo();return i()(Ai,{automationStore:t,initialState:a,updateCurrentAutomationState:n,buttonPopupParent:o,collectionStore:r})}function dl(e){const{action:t,...o}=e;return"slack_notification"===t?l.createElement(ll,a()({},o,{title:i()(d.FormattedMessage,{id:"AutomationActionSelectMenu.actionTitle.slackNotification",defaultMessage:"Send Slack notification to‚Ä¶"}),icon:_.Z.slackLogo({height:24,width:12})})):l.createElement(ul,o)}function ul(e){return l.createElement(ll,a()({},e,{icon:_.Z.plus({height:24,width:12}),title:i()(d.FormattedMessage,{id:"AutomationActionSelectButton.actionSection.addAction",defaultMessage:"Add action"})}))}var pl=o(45669);function gl(e){window.__c={n:"AutomationCollectionSelectMenu"};const{selectedSourcePointer:t,collectionContextStore:o,onSelect:n,disabled:r}=e,{isMobile:s}=(0,C.Fy)(),c=(0,d.useIntl)(),u=(0,C.O7)(),[p,g]=l.useState(""),m=(0,w.VK)((()=>o.collectionStore()),[o]),y=(0,w.VK)((()=>o.collectionViewBlockStore()),[o]),S=(0,w.VK)((()=>y&&m?y.getCollectionViewStores().filter((e=>{var t;const o=null===(t=e.getCollectionStore())||void 0===t?void 0:t.pointer;return(null==o?void 0:o.id)===m.id})):[]),[y,m]),f=(0,w.VK)((()=>{if(!m||!t)return[];let e;"collection_view"===t.table&&(e=co.Xr.createChildStore(m,t));return O().uniqBy([...S,e].filter(k.$K),(e=>{let{id:t}=e;return t})).filter((e=>(0,T.D)(e,p)))}),[m,S,p,t]),h=(0,w.VK)((()=>{if(m&&t&&(0,Ve.r_)({collectionStore:m,environment:u,intl:c,queryForFilter:p}))return function(e){const{collectionStore:t,environment:o,selectedSourcePointer:n,onSelect:r,isMobile:s,intl:c}=e,u=t.getIcon(),p=(0,un.vU)({environment:o,intl:c,store:t}),g="collection"===n.table&&n.id===t.id,m=t.getSpaceShardedPointer();return{key:"collection",items:[{key:t.id,action:()=>{m&&r(m)},render:e=>l.createElement(Ze.Z,a()({},e,{icon:u&&i()(Kr.Z,{isEmptyPage:!1,size:s?18:16,disabled:!0,icon:u}),title:p,caption:i()(d.FormattedMessage,{id:"AutomationCollectionSelectMenu.collection.caption",defaultMessage:"Any page in this database",values:{collectionName:p}}),right:g&&_.Z.check({width:12,height:"auto"})}))}],render:e=>l.createElement(E.Z,a()({},e,{topBorder:!0}))}}({collectionStore:m,environment:u,selectedSourcePointer:t,onSelect:n,isMobile:s,intl:c})}),[m,u,c,s,n,p,t]),v=function(e){const{menuListItems:t}=e;if(0===t.length)return;return{key:"collection-views",items:t,render:e=>l.createElement(E.Z,a()({},e,{topBorder:!0}))}}({menuListItems:(0,w.VK)((()=>m&&y&&S&&t?function(e){const{blockStore:t,filteredCollectionViewStores:o,collectionStore:n,selectedSourcePointer:r,onSelect:s,intl:c}=e,u=n.getSchema();return[...o.map((e=>{const o=e.getSpaceShardedPointer();if(e.isDefined()&&o){const p="collection_view"===r.table&&r.id===o.id,g=_o({collectionViewStore:e,collectionSchema:u}),m=(0,k.$K)(g),y=e.getType(),S=e.getFormat().collection_view_icon,f=e.getName(),h=(o,n)=>l.createElement(Ze.Z,a()({},o,n,{icon:i()(Va.F,{color:"lightGray",viewType:y,viewIcon:S}),title:i()("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",padding:0,gap:4}},void 0,i()(pl.Z,{collectionViewType:y,collectionViewName:f}),m&&p&&_.Z.warning({width:16,height:"auto"})),caption:i()(yl,{blockStore:t,collectionViewStore:e,intl:c,collectionSchema:u,referencesIncompatibleProperties:m}),right:p&&_.Z.check({width:12,height:"auto"}),disabled:m,disabledFeedback:m}));let v;if(m&&g){var n;const e=null===(n=u[g])||void 0===n?void 0:n.type,t=e?Ve.SO[e]:void 0,o=i()(d.FormattedMessage,t?{id:"AutomationCollectionSelectMenu.tooltip.incompatibleFiltersWarning.specific",defaultMessage:"{propertyTypeName} properties are not supported",values:{propertyTypeName:t}}:{id:"AutomationCollectionSelectMenu.tooltip.incompatibleFiltersWarning.default",defaultMessage:"Some properties are not supported"});v=e=>i()(St.Z,{placement:St.Z.Placement.Right,renderTooltip:()=>o,render:t=>h(e,t)})}else v=h;return{key:e.id,action:()=>{s(o)},render:v}}}))].filter(k.$K)}({blockStore:y,collectionStore:m,filteredCollectionViewStores:f,selectedSourcePointer:t,onSelect:n,intl:c}):[]),[y,m,S,f,c,n,t])}),b={key:"search",items:[{key:"search_item",action:()=>{},render:()=>i()(Ee.ZP,{value:p,focus:!0,style:A.searchBar,textWrapperStyle:A.searchText,onChange:e=>g(e.target.value),placeholder:c.formatMessage({defaultMessage:"Search for a view...",id:"collectionViewSelect.viewSearch.label"})})}],render:e=>l.createElement(E.Z,e)};let x;(0,k.$K)(h)||(0,k.$K)(v)||(x={key:"no-results-section",items:[{key:"no-results-item",action:O().noop,render:()=>i()(Be.Z,{caption:i()(d.FormattedMessage,{defaultMessage:"No results",id:"collectionViewSelect.noResults.title"})})}],render:e=>l.createElement(E.Z,a()({},e,{topBorder:!0}))});const P=[b,h,v,x].filter(k.$K),A=function(e){return(0,M.yK)((t=>({button:{marginTop:8},buttonPopup:{width:e?void 0:230},searchBar:{marginTop:8,marginBottom:8},searchText:{marginLeft:8,marginRight:8},buttonRight:{color:t.selectLightGray[500]},menuItemTextWrapper:{...e?{marginLeft:12}:{},minWidth:"auto"}})),[e])}(s),F=(0,w.qz)(void 0,V.Z),B=(0,zn.d)();if(!m)return null;const Z=t&&i()(ml,{pointer:t,collectionStore:m,intl:c});return i()(Ce.ZP,{alignmentToOrigin:Ce.vR.End,placementToOrigin:Ce.pO.Bottom,popupType:B,style:A.buttonPopup,buttonPopupStore:F,render:e=>{let t;return t=s?{menuType:ve.og.Modal,title:i()(d.FormattedMessage,{id:"collectionSettings.editAutomationView.notifyForOption.title",defaultMessage:"For pages in"}),right:i()(Qn.DoneMenuText,{}),onClickRight:()=>{e.close()}}:{menuType:ve.og.Popup,width:230,maxHeight:"50vh"},l.createElement(we.Z,t,i()(De.Z,{type:De.i.Vertical,sections:P,initialFocus:0,onAccept:()=>{e.close()}}))},renderOrigin:e=>l.createElement(I.Z,a()({title:i()(d.FormattedMessage,{id:"collectionSettings.editAutomationView.notifyForOption.title",defaultMessage:"For pages in"}),showChevron:!0,right:Z,rightStyle:{flexShrink:1},rotateChevron:F.state.open,disabled:r,textWrapperStyle:A.menuItemTextWrapper},e))})}function ml(e){window.__c={n:"AutomationSourceCaption"};const{pointer:t,collectionStore:o,intl:n}=e,r=(0,C.O7)(),a=(0,M.yK)((e=>({warningIcon:{width:16,height:"auto",color:e.accentColors.orange[400]},titleContainer:{display:"flex",flexDirection:"row",alignItems:"center",padding:0,gap:4,flex:"1 1 auto",minWidth:0},title:{...x.Z.textOverflowStyle}})),[]),l=(0,w.VK)((()=>{if(t.table!==ao.v)return co.Xr.createChildStore(o,t)}),[o,t]),s=(0,w.VK)((()=>{const e=t.table===lo.n&&l?l:o;return(0,un.vU)({environment:r,intl:n,store:e})}),[o,l,n,t.table,r]),c=(0,w.VK)((()=>{if(t.table===ao.v||!l)return!1;const e=o.getSchema();return(0,k.$K)(_o({collectionViewStore:l,collectionSchema:e}))}),[o,l,t.table]);return i()("div",{style:a.titleContainer},void 0,c&&_.Z.warning(a.warningIcon),i()("span",{style:a.title},void 0,s))}function yl(e){window.__c={n:"CollectionViewCaption"};const{blockStore:t,collectionViewStore:o,intl:n,collectionSchema:r,referencesIncompatibleProperties:a}=e,l=(0,C.O7)(),s=(0,w.VK)((()=>!o.getAlive()),[o]),c=(0,w.VK)((()=>{const e=o.getParentBlockStore();if(e)return t.id!==e.id?(0,un.vU)({environment:l,intl:n,store:e}):void 0}),[t.id,o,n,l]),u=(0,w.VK)((()=>{const e=o.getQuery(r);return(0,Gt.OH)({propertyFilters:o.getPropertyFiltersStore().getValue()??[],combinatorFilter:null==e?void 0:e.filter,schema:r}).reduce(((e,t)=>{if((0,Gt.aN)(t))return e+1;return e+(t.filters??[]).length}),0)}),[r,o]);return i()(d.FormattedMessage,a?{id:"AutomationCollectionSelectMenu.collectionView.unsupportedView",defaultMessage:"Not supported"}:s?{id:"AutomationCollectionSelectMenu.collectionView.deletedView",defaultMessage:"<emphasis>View not found.</emphasis>",values:{emphasis:e=>i()("em",{},void 0,e)}}:c?{id:"AutomationCollectionSelectMenu.collectionView.captionDifferentParent",defaultMessage:"<emphasis>View configured in {externalParentBlockName}</emphasis>",values:{emphasis:e=>i()("em",{},void 0,e),externalParentBlockName:c}}:0===u?{id:"AutomationCollectionSelectMenu.collectionView.captionWithNoFilters",defaultMessage:"Any page in this view"}:{id:"AutomationCollectionSelectMenu.collectionView.captionWithFilters",defaultMessage:"{ruleCount, plural, one {{ruleCount} filter} other {{ruleCount} filters}}",values:{ruleCount:u}})}function Sl(e){window.__c={n:"DeletedPropertyStep"};const{propertyId:t,disabled:o,collectionStore:n,onClick:r}=e,a=(0,M.Fg)(),l="light"===a.mode?50:200,s="light"===a.mode?700:900,c=(0,M.yK)((e=>{const t="light"===e.mode?400:800;return{warning:{color:e.accentColors.orange[t]}}}),[]),u=(0,w.VK)((()=>n.getDeletedSchema()[t]),[n,t]);return i()(Mn,{disabled:o,icon:e=>_.Z.warning({...e,...c.warning}),title:i()(Tn.Z,{format:Tn.l.Medium,value:i()(d.FormattedMessage,{id:"deletedPropertyStep.deletedProperty.title",defaultMessage:"{propertyName} property deleted",values:{propertyName:null==u?void 0:u.name}}),theme:a,isSingle:!0,backgroundColor:a.accentColors.yellow[l],color:a.accentColors.yellow[s]}),onClick:r})}function fl(e){window.__c={n:"AutomationDeletedPropertyMenu"};const{stepType:t,onDelete:o,onViewDeletedProperties:n}=e,r=(0,vn.F)({width:266}),s=(0,C.Fy)().isMobile,c=(0,M.yK)((e=>({icon:{width:s?"12px":"16px",height:"auto",color:e.accentColors.gray[600]},content:{fontSize:"14px",fontWeight:400}})),[s]);return l.createElement(we.Z,r,i()(De.Z,{type:De.i.Vertical,sections:[{key:"actions-section",items:[{key:"view-deleted-properties",action:()=>{n()},render:e=>l.createElement(Ze.Z,a()({},e,{title:i()("span",{style:c.content},void 0,i()(d.FormattedMessage,{id:"automationDeletedPropertyMenu.viewDeletedProperties.title",defaultMessage:"View deleted properties"})),icon:_.Z.undo(c.icon)}))},{key:"delete-action",action:()=>{o()},render:e=>l.createElement(Ze.Z,a()({},e,{title:i()("span",{style:c.content},void 0,i()(d.FormattedMessage,"action"===t?{id:"automationDeletedPropertyMenu.deleteAction.title",defaultMessage:"Delete action"}:{id:"automationDeletedPropertyMenu.deleteTrigger.title",defaultMessage:"Delete trigger"})),icon:_.Z.trash(c.icon)}))}],render:e=>l.createElement(E.Z,e)}],initialFocus:0}))}const hl=(0,d.defineMessages)({searchInputPlaceholder:{id:"automationEventTriggerMenu.searchInputPlaceholder.label",defaultMessage:"Search for trigger‚Ä¶"},pageAddedCopy:{id:"automationEventTriggerMenu.pageAdded.title",defaultMessage:"Page added"},pagePropertiesEditedCopy:{id:"automationEventTriggerMenu.anyPropertyEdited.title",defaultMessage:"Any property"}});function vl(e){window.__c={n:"AutomationEventTriggerMenu"};const{automationStore:t,automationTriggerMenuStore:o,collectionStore:n,updateCurrentState:r,onClose:s}=e,c=(0,M.Fg)(),u=(0,d.useIntl)(),[p,g]=l.useState(""),m=(0,w.VK)((()=>n.getSchema()),[n]),y=(0,w.VK)((()=>t.getTrigger()),[t]),S=(0,w.VK)((()=>("event"===(null==y?void 0:y.type)||"notification_event"===(null==y?void 0:y.type))&&y.event.pagesAdded),[y]),f=(0,w.VK)((()=>(0,Ot._X)({collectionFormat:n.getFormat(),collectionSchema:m})),[n,m]),h=function(e){const{collectionSchema:t,propertyIds:o,searchTerm:n}=e;if(!n)return o.slice(0);const i=new Map,r=o.map((e=>{const o=t[e],n=o?`${o.name} ${Ve.SO[o.type]}`:"";return i.set(e,n),n})),a=Pe().filter(n,r).map((e=>{let{original:t}=e;return t}));return o.filter((e=>a.includes(i.get(e)??"")))}({collectionSchema:m,propertyIds:f,searchTerm:p}),v=(0,M.yK)((e=>({propertyIcon:{width:16,height:16,color:e.mediumIconColor}})),[]),b=(0,vn.F)({maxHeight:"50vh",width:266}),C=i()(Ee.ZP,{focus:!0,style:{marginTop:12,marginBottom:6},value:p,onChange:e=>{g(e.target.value)},placeholder:u.formatMessage(hl.searchInputPlaceholder)}),x=S?void 0:function(e){const{intl:t,searchInput:o,updateCurrentState:n,onClose:i,styles:r}=e,s=t.formatMessage(hl.pageAddedCopy);if(!Pe().test(o,s))return;return{key:"page_added_section",items:[{key:"page_added",action:()=>{n({type:"update_trigger",trigger:{type:"page_added"}}),i()},render:e=>l.createElement(Ze.Z,a()({},e,{icon:_.Z.plus(r.propertyIcon),title:s}))}],render:e=>l.createElement(E.Z,e)}}({intl:u,searchInput:p,updateCurrentState:r,onClose:s,styles:v}),T=(0,w.VK)((()=>function(e){const{automationTriggerValue:t,automationTriggerMenuStore:o,showTopBorder:n,properties:r,collectionSchema:s,theme:c,updateCurrentState:u,onClose:p,intl:g,searchInput:m,styles:y}=e,S=g.formatMessage(hl.pagePropertiesEditedCopy);let f=!1,h=[];"event"!==(null==t?void 0:t.type)&&"notification_event"!==(null==t?void 0:t.type)||(f="any"===t.event.pagePropertiesEdited.type,h="some"===t.event.pagePropertiesEdited.type?t.event.pagePropertiesEdited.some:[]);const v=[f||!Pe().test(m,S)?void 0:{key:"any_property_edited",action:async()=>{await async function(e){const{hasSpecificPropertyChangedFilters:t}=e;if(!t)return!0;return await ye.confirmUserAction({message:i()(d.FormattedMessage,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.message",defaultMessage:"Replace other triggers?"}),description:i()(d.FormattedMessage,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.description",defaultMessage:"Adding the 'Any property edited' trigger will replace all other property triggers."}),acceptLabel:i()(d.FormattedMessage,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.acceptLabel",defaultMessage:"Replace"})})}({hasSpecificPropertyChangedFilters:h.length>0})&&(u({type:"update_trigger",trigger:{type:"any_page_property_edited"}}),p())},render:e=>l.createElement(Ze.Z,a()({},e,{icon:_.Z.pencil(y.propertyIcon),title:S}))},...r.map((e=>{if(!h.find((t=>t.property===e)))return function(e){const{automationTriggerMenuStore:t,propertyId:o,collectionSchema:n,theme:r,updateCurrentState:s,onClose:c}=e,d=n[o];if(!d)return;const u=(0,Ot.bD)(d);return{key:o,action:()=>{u?t.pushSettingsItem({type:"propertyChangedFilter",property:o}):(s({type:"update_trigger",trigger:{type:"property_changed",property:o,filter:{operator:"changes_to_any"}}}),c())},render:e=>l.createElement(Ze.Z,a()({},e,{icon:i()(xn.ZP,{icon:d.icon,type:d.type,size:16,theme:r}),title:d.name,right:u?_.Z.chevronRight({marginLeft:6,width:12,height:"auto"}):void 0}))}}({propertyId:e,collectionSchema:s,theme:c,updateCurrentState:u,automationTriggerMenuStore:o,onClose:p})})).filter(k.$K)].filter(k.$K);if(0===v.length)return;return{key:"page_properties_edited_section",items:v,render:e=>l.createElement(E.Z,a()({},e,{topBorder:n,title:i()(d.FormattedMessage,{id:"automationEventTriggerMenu.pagePropertiesEditedSection.title",defaultMessage:"Property edited"})}))}}({automationTriggerValue:y,automationTriggerMenuStore:o,showTopBorder:Boolean(x),properties:h,collectionSchema:m,theme:c,updateCurrentState:r,onClose:s,searchInput:p,intl:u,styles:v})),[y,o,x,h,m,c,r,s,p,u,v]),P=l.useMemo((()=>{const e=[x,T].filter(k.$K);return 0===e.length?[{key:"none",items:[{key:"none-item",action:()=>{},render:e=>l.createElement(Ze.Z,a()({},e,{disabled:!0,disabledFeedback:!0,title:i()(d.FormattedMessage,{id:"automations.eventTriggerMenu.noResultsItem",defaultMessage:"No results"})}))}],render:e=>l.createElement(E.Z,e)}]:e}),[x,T]);return l.createElement(we.Z,a()({},b,{header:C}),i()(De.Z,{type:De.i.Vertical,sections:P,initialFocus:0}))}var bl=o(19777),Cl=o(12508),wl=o(47082);function Ml(e){window.__c={n:"AutomationSelectPropertyChangedFilterMenu"};const{propertyId:t,updateCurrentState:o,automationTriggerMenuStore:n,propertySchema:r,propertyChangedFilter:s,onClose:c}=e,{isMobile:u,isAndroid:p}=(0,C.Fy)(),g=(0,d.useIntl)(),m=(0,w.VK)((()=>{if("changes_to_any"===s.operator){return(r.options??[]).map((e=>({type:"exact",value:e.value})))}return((0,Gt.dx)(s)||(0,Gt.NU)(s))&&(0,Gt.vR)(s)?Array.isArray(s.value)?s.value:[s.value]:[]}),[r,s]),[y,S]=l.useState(m),f=(0,w.VK)((()=>function(e){const{propertySchema:t,selectedOptions:o}=e;let n=!1,i=!0;const r=t.options??[];for(const a of r){const e=o.some((e=>e.value===a.value));n||=e,i&&=e}return!!i||!!n&&"partial"}({propertySchema:r,selectedOptions:y})),[r,y]),h=l.useMemo((()=>(r.options??[]).map((e=>({type:"exact",value:e.value})))),[r]),v=l.useMemo((()=>"multi_select"===r.type?{operator:"enum_contains",value:y}:"select"===r.type?{operator:"enum_is",value:y}:(0,k.t1)(r)),[r,y]),b=!0===f?[]:y.map((e=>{if(!e.value||!r.options)return;const t=(0,Lt.i7)(r.options,e.value);return t?i()(Pn.a,{format:u?Tn.l.Large:Tn.l.Small,isSingle:!1,value:t.value,color:t.color,showRemoveButton:!0,onClickRemove:()=>{const t=O().without(y,e);S(t)}},t.id):void 0})),[M,_]=l.useState(""),x=(0,bl.I4)({query:M,propertySchema:r,selectedValues:y,updateValue:e=>{_(""),S(e)},isMobile:u,styles:{}}),T=[{key:"search",items:[{key:"input",action:()=>{},render:e=>l.createElement(wl.Z,a()({},e,{focusInitial:!0,onClick:void 0,focusAfterAnimation:!0,format:wl.Z.Format.FilterValue,tokens:b,placeholder:f?g.formatMessage({defaultMessage:"Any option",id:"automations.selectPropertyChangedFilter.inputPlaceholder.anyOption"}):g.formatMessage({defaultMessage:"Select one or more options‚Ä¶",id:"automations.selectPropertyChangedFilter.inputPlaceholder.searchPlaceholder"}),onRemoveLastToken:()=>{const e=y.slice(0,y.length-1);S(e)},onClearButtonClick:()=>{S([]),c()},value:M,onChange:e=>{_(e.target.value)},dontShowBorderBottom:p,showClearButton:!0}))}],render:e=>l.createElement(E.Z,e)},{key:"any",items:[{key:"any-option-item",action:()=>{!0===f?S([]):!1===f||"partial"===f?S(h):(0,k.t1)(f),_("")},render:e=>l.createElement(Ze.Z,a()({},e,{icon:i()(Cl.Z,{checked:f,size:14,onClick:e.onClick}),title:i()(d.FormattedMessage,{id:"automations.selectPropertyChangedFilter.anyOption.title",defaultMessage:"Any option"})}))}],render:e=>l.createElement(E.Z,a()({},e,{topBorder:!0}))},x.length>0?{key:"items",items:x,render:e=>l.createElement(E.Z,a()({},e,{topBorder:!0}))}:void 0].filter(k.$K);return i()(Jn,{type:"default",automationTriggerActionMenuStore:n,onDone:()=>{bo({anyOptionCheckState:f,propertyId:t,updateCurrentState:o,currentFilter:v}),c()},onClose:c,sections:T,headerTitle:i()(d.FormattedMessage,{id:"automations.propertyChangedFilterHeader.select.title",defaultMessage:"{propertyName} set to",values:{propertyName:r.name}})})}function _l(e){window.__c={n:"AutomationStatusPropertyChangedFilterMenu"};const{propertyId:t,updateCurrentState:o,automationTriggerMenuStore:n,propertySchema:r,propertyChangedFilter:s,onClose:c}=e,{isMobile:u}=(0,C.Fy)(),p=(0,w.VK)((()=>{if("changes_to_any"===s.operator){return(r.groups??[]).map((e=>({type:"is_group",value:e.name})))}return(0,Gt.r2)(s)&&(0,Gt.vR)(s)?Array.isArray(s.value)?s.value:[s.value]:[]}),[r,s]),[g,m]=l.useState(p),y=(0,w.VK)((()=>function(e){const{propertySchema:t,selectedStatusOptions:o}=e;let n=!1,i=!0;const r=t.groups??[],a=t.options??[];for(const l of r){const e=kl({group:l,options:a,selectedStatusOptions:o});n||=!1!==e,i&&=!0===e}return!!i||!!n&&"partial"}({propertySchema:r,selectedStatusOptions:g})),[r,g]),S=l.useMemo((()=>(r.groups??[]).map((e=>({type:"is_group",value:e.name})))),[r]),f=(0,bl.Sm)({propertySchema:r,statusFilterValues:g,updateValue:e=>{m(e)},isMobile:u,styles:{}});return i()(Jn,{type:"default",automationTriggerActionMenuStore:n,onDone:()=>{bo({anyOptionCheckState:y,propertyId:t,updateCurrentState:o,currentFilter:{operator:"status_is",value:g}}),c()},onClose:()=>{c()},sections:[{key:"any",items:[{key:"any-option-item",action:()=>{!0===y?m([]):!1===y||"partial"===y?m(S):(0,k.t1)(y)},render:e=>l.createElement(Ze.Z,a()({},e,{icon:i()(Cl.Z,{checked:y,size:14,onClick:e.onClick}),title:i()(d.FormattedMessage,{id:"automationEventTriggerPropertyChangedFilterMenu.anyOption.title",defaultMessage:"Any option"})}))}],render:e=>l.createElement(E.Z,e)},{key:"items",items:f,render:e=>l.createElement(E.Z,a()({},e,{topBorder:!0}))}],headerTitle:i()(d.FormattedMessage,{id:"automations.propertyChangedFilterHeader.status.title",defaultMessage:"{propertyName} set to",values:{propertyName:r.name}})})}function kl(e){const{group:t,options:o,selectedStatusOptions:n}=e,i=n.some((e=>"is_group"===e.type&&e.value===t.name)),r=o.filter((e=>{var o;return null===(o=t.optionIds)||void 0===o?void 0:o.includes(e.id)}));let a=!1,l=!0;for(const s of r){const e=n.some((e=>"is_option"===e.type&&e.value===s.value));a||=e,l&&=e}return!(!i&&!l)||!!a&&"partial"}function xl(e){window.__c={n:"AutomationEventTriggerPropertyChangedFilterMenu"};const{automationStore:t,propertyId:o,automationTriggerMenuStore:n,collectionStore:r,updateCurrentState:a,onClose:l}=e,s=(0,w.VK)((()=>r.getSchema()),[r])[o],c=(0,w.VK)((()=>t.getTrigger()),[t]);let d=[];"event"!==(null==c?void 0:c.type)&&"notification_event"!==(null==c?void 0:c.type)||(d="some"===c.event.pagePropertiesEdited.type?c.event.pagePropertiesEdited.some:[]);const u=d.find((e=>e.property===o))??{property:o,filter:{operator:"changes_to_any"}};if(!s)return null;return(0,Ot.bD)(s)?"multi_select"===s.type||"select"===s.type?i()(Ml,{propertyId:o,updateCurrentState:a,automationTriggerMenuStore:n,propertySchema:s,propertyChangedFilter:u.filter,onClose:l}):"status"===s.type?i()(_l,{propertyId:o,updateCurrentState:a,automationTriggerMenuStore:n,propertySchema:s,propertyChangedFilter:u.filter,onClose:l}):null:null}function Tl(e){window.__c={n:"AutomationTriggerMenuController"};const{automationStore:t,collectionStore:o,initialState:n,updateCurrentAutomationState:r,buttonPopupParent:a}=e,s=(0,w.VK)((()=>{const e=new $n;return e.setState({stack:[n]}),e}),[n]),c=(0,w.VK)((()=>s.getCurrentTab()),[s]),d=(0,l.useCallback)((()=>a.close()),[a]);return c?"eventTriggers"===c.type?i()(vl,{automationStore:t,automationTriggerMenuStore:s,collectionStore:o,updateCurrentState:r,onClose:d}):"propertyChangedFilter"===c.type?i()(xl,{automationStore:t,propertyId:c.property,automationTriggerMenuStore:s,collectionStore:o,updateCurrentState:r,onClose:d}):(0,k.t1)(c):null}function Pl(e){window.__c={n:"AutomationTriggerList"};const{automationStore:t,collectionStore:o,disabled:n,handleNavigateToDeletedProperties:r,updateCurrentState:s}=e,c=(0,d.useIntl)(),u=(0,zn.d)(),p=(0,w.VK)((()=>o.getSchema()),[o]),g=(0,w.VK)((()=>t.getTriggerStore().getKeyStore("event").getValue()),[t]),m=(0,l.useCallback)((e=>{s({type:"remove_trigger",trigger:{type:"property_changed",property:e,filter:{operator:"changes_to_any"}}})}),[s]),y=(0,l.useCallback)((()=>{s({type:"remove_trigger",trigger:{type:"page_added"}})}),[s]),S=(0,l.useCallback)((()=>{s({type:"remove_trigger",trigger:{type:"any_page_property_edited"}})}),[s]),f=(0,M.yK)((e=>({stepList:{border:`1px solid ${e.regularDividerColor}`,borderRadius:6,listStyle:"none",margin:0,overflow:"hidden",padding:0},semiBoldTitle:{fontWeight:x.Z.fontWeight.semibold},stepItemWithBorderTop:{borderTop:`1px solid ${e.regularDividerColor}`}})),[]),h=[];return null!=g&&g.pagesAdded&&h.push(i()(Mn,{disabled:n,onClick:e=>{e.setState({open:!0})},icon:_.Z.plus,title:i()("div",{style:f.semiBoldTitle},void 0,Wo(c)),onDelete:y},"page_added_trigger")),"any"===(null==g?void 0:g.pagePropertiesEdited.type)&&h.push(i()(Mn,{disabled:n,onClick:e=>{e.setState({open:!0})},icon:_.Z.pencil,title:i()("div",{style:f.semiBoldTitle},void 0,Go(c)),onDelete:S},"any_page_property_edited_trigger")),"some"===(null==g?void 0:g.pagePropertiesEdited.type)&&h.push(...g.pagePropertiesEdited.some.map((e=>{const{property:c,filter:d}=e,g=p[c];return g?"status"!==g.type||"changes_to_any"!==d.operator&&!(0,Gt.r2)(d)?"select"!==g.type||"changes_to_any"!==d.operator&&!(0,Gt.dx)(d)?"multi_select"!==g.type||"changes_to_any"!==d.operator&&!(0,Gt.NU)(d)?"changes_to_any"===d.operator?i()(Vn,{disabled:n,onClick:e=>{e.setState({open:!0})},propertySchema:g,onDelete:()=>{m(c)}},`changes_to_any_${c}_trigger`):void 0:i()(Al,{property:c,automationStore:t,collectionStore:o,updateCurrentState:s,renderOrigin:e=>{let{onClick:t}=e;return i()(Dn,{disabled:n,filter:d,propertySchema:g,onEdit:t,onDelete:()=>{m(c)}})}},`changes_to_any_${c}_trigger`):i()(Al,{property:c,automationStore:t,collectionStore:o,updateCurrentState:s,renderOrigin:e=>{let{onClick:t}=e;return i()(Dn,{disabled:n,filter:d,propertySchema:g,onEdit:t,onDelete:()=>{m(c)}})}},`changes_to_any_${c}_trigger`):i()(Al,{automationStore:t,property:c,collectionStore:o,updateCurrentState:s,renderOrigin:e=>{let{onClick:t}=e;return i()(In,{disabled:n,filter:d,propertySchema:g,onEdit:t,onDelete:()=>{m(c)}})}},`changes_to_any_${c}_trigger`):i()(Ce.ZP,{alignmentToOrigin:Ce.vR.Center,placementToOrigin:Ce.pO.Bottom,popupType:u,render:()=>i()(fl,{stepType:"trigger",onDelete:()=>{s({type:"remove_trigger",trigger:{filter:d,property:c,type:"property_changed"}})},onViewDeletedProperties:r}),renderOrigin:e=>l.createElement(Sl,a()({},e,{disabled:n,propertyId:c,collectionStore:o}))},`deleted_property_${c}_trigger`)})).filter(k.$K)),i()("ul",{style:f.stepList},void 0,h.map(((e,t)=>i()("li",{style:0===t?{}:f.stepItemWithBorderTop},t,e))))}function Al(e){window.__c={n:"AdvancedTriggerPopup"};const{automationStore:t,renderOrigin:o,collectionStore:n,property:r,updateCurrentState:a}=e,l=(0,zn.d)();return i()(Ce.ZP,{popupType:l,renderOrigin:o,render:e=>i()(Tl,{automationStore:t,collectionStore:n,initialState:{type:"propertyChangedFilter",property:r},updateCurrentAutomationState:a,buttonPopupParent:e})})}var Vl=o(89733),Fl=o(30950),Il=o(68214);function Bl(e){window.__c={n:"CreatePageActionDatabaseAutomation"};const{actionStore:t,updateCurrentAutomationState:o}=e,n=t.id,i=(0,w.VK)((()=>t.getConfig()),[t]),r=(0,l.useCallback)((e=>{o({action:{config:{...i,collection:e,properties:["title"],values:{}},id:n,type:"create_page"},type:"update_action"})}),[n,i,o]),s=(0,l.useCallback)(((e,t)=>{o({action:{config:{...i,properties:e,values:t},id:n,type:"create_page"},type:"update_action"})}),[n,i,o]),c=(0,l.useCallback)((()=>{o({action:{config:i,id:n,type:"create_page"},type:"remove_action"})}),[i,n,o]);return l.createElement(Zl,a()({},e,{onConfigChange:s,onDelete:c,onTargetCollectionChange:r}))}function Zl(e){window.__c={n:"CreatePageActionV2"};const{actionStore:t,automationStore:o,collectionStore:n,disabled:r,onConfigChange:a,onDelete:s,onTargetCollectionChange:c}=e,{isMobile:d}=(0,C.Fy)(),u=(0,l.useRef)(null),p=(0,j.X)(u),g=(0,Fl.a)(p),[m,y,S]=(0,w.VK)((()=>{const e=t.getConfig();return[null==e?void 0:e.collection,null==e?void 0:e.properties,null==e?void 0:e.values]}),[t]),f=(0,w.VK)((()=>{if(m)return co.NW.createChildStore(n,m)}),[n,m]),h=gn({automationStore:o,collectionStore:n}),v=(0,w.qz)(void 0,bn.Z),b=(0,l.useMemo)((()=>({values:S??{},properties:y??[]})),[S,y]),k=(0,l.useCallback)((e=>{c&&c(e)}),[c]),x=(0,l.useCallback)((e=>{const t=b.properties.concat([e]);a(t,b.values)}),[a,b]),T=(0,l.useCallback)(((e,t)=>{const o=b.properties.indexOf(e);if(-1===o)return;const n=b.properties.slice(0);n[o]=t;const i={...b.values,[t]:void 0};a(n,i)}),[a,b]),P=(0,l.useCallback)((e=>{const t=b.properties.filter((t=>t!==e)),o={...b.values,[e]:void 0};a(t,o)}),[a,b]),A=(0,l.useCallback)(((e,t)=>{const o={...b.values,[e]:t};a(b.properties,o)}),[a,b]),V=(0,l.useCallback)((e=>{Vl.Bd({store:v,event:e,disabled:r})}),[v,r]),F=(0,l.useCallback)((e=>{Vl.Js({store:v,event:e,disabled:r,isMobile:d})}),[v,r,d]),I=(0,l.useCallback)((e=>{Vl.iV({store:v,event:e,disabled:r})}),[v,r]),B=(0,M.yK)((e=>({sectionWrap:{background:e.cardContentBackground,display:"flex",flexDirection:"column",gap:g?12:16,paddingBlock:12,paddingInline:12},headerTitle:{alignItems:"center",display:"flex",flexWrap:"nowrap"}})),[g]);return h?l.createElement("section",{onMouseEnter:V,onMouseLeave:I,onMouseMove:F,ref:u,style:B.sectionWrap},i()(Dl,{disabled:r,icon:_.Z.plus({width:14}),interactionStore:v,onDelete:s},void 0,i()("div",{style:B.headerTitle},void 0,i()(El,{actionStore:t,automationContextStore:h,disabled:r,onChange:k,value:m}))),f&&i()(pi.vV,{actionId:t.id,collectionStore:f,config:b,contextStore:h,disabled:r,onPropertyAdd:x,onPropertyChange:T,onPropertyRemove:P,onPropertyValueChange:A,showSetPropertyActions:!1})):null}function El(e){const{automationContextStore:t,disabled:o,onChange:n,value:r}=e;return i()(d.FormattedMessage,{defaultMessage:"<span>Add <b>page</b> to </span>{collectionPicker}",id:"automations.CreatePageActionV2.header.title",values:{b:e=>i()("b",{style:{fontWeight:x.Z.fontWeight.medium}},void 0,e),collectionPicker:i()(Il.a,{contextStore:t,currentValue:r,disabled:o,onChange:n}),span:e=>i()("span",{style:{flex:"0 0 auto"}},void 0,e)}})}function Dl(e){window.__c={n:"ActionHeader"};const{children:t,disabled:o,icon:n,interactionStore:r,onDelete:a}=e,[s,c]=fn(),d=(0,w.qz)(r,bn.Z),u=(0,w.VK)((()=>d.getState()),[d]),p=!o&&(u.hovered||c),g=(0,M.yK)((()=>({wrap:{alignItems:"center",cursor:o?"default":void 0,opacity:o?.4:void 0,display:"flex",gap:6,minHeight:28},iconWrap:{flex:"0 0 auto"},titleWrap:{flex:"1 1 auto",fontSize:14,lineHeight:1.4,minWidth:0},moreButtonWrap:{flex:"0 0 26px"}})),[o]);return l.createElement("header",{ref:s,style:g.wrap},n&&i()("div",{style:g.iconWrap},void 0,n),i()("div",{style:g.titleWrap},void 0,t),i()("div",{style:g.moreButtonWrap},void 0,p&&i()(_n,{disabled:o,onDelete:a})))}var Kl=o(43690),Nl=o(85740),Rl=o(80117);function Ol(e){window.__c={n:"UpdatePagesActionDatabaseAutomation"};const{actionStore:t,updateCurrentAutomationState:o}=e,n=t.id,i=(0,w.VK)((()=>t.getConfig()),[t]),r=(0,l.useCallback)((e=>{var t;const r="collection"===e.type&&"collection"===(null==i||null===(t=i.target)||void 0===t?void 0:t.type)&&e.collection.id!==(null==i?void 0:i.target.collection.id);o({action:{config:{...i,target:e,properties:r?["title"]:(null==i?void 0:i.properties)??[],values:r?{}:(null==i?void 0:i.values)??{}},id:n,type:"update_pages"},type:"update_action"})}),[i,n,o]),s=(0,l.useCallback)(((e,t)=>{o({action:{config:{...i,properties:e,values:t},id:n,type:"update_pages"},type:"update_action"})}),[n,i,o]),c=(0,l.useCallback)((()=>{o({action:{config:i,id:n,type:"update_pages"},type:"remove_action"})}),[i,n,o]);return l.createElement(Wl,a()({},e,{onConfigChange:s,onDelete:c,onTargetChange:r}))}function Wl(e){window.__c={n:"UpdatePagesActionV2"};const{actionStore:t,automationStore:o,collectionStore:n,disabled:r,onConfigChange:a,onDelete:s,onTargetChange:c}=e,{isMobile:d}=(0,C.Fy)(),u=(0,l.useRef)(null),p=(0,j.X)(u),g=(0,Fl.a)(p),m=(0,Wt.z)("update_pages"),[y,S,f]=(0,w.VK)((()=>{const e=t.getConfig();return[null==e?void 0:e.target,null==e?void 0:e.properties,null==e?void 0:e.values]}),[t]),h=(0,w.VK)((()=>{if("collection"===(null==y?void 0:y.type))return co.NW.createChildStore(n,null==y?void 0:y.collection)}),[n,y]),v=(0,w.VK)((()=>{if((0,k.$K)(h))return h.getSpaceShardedPointer()}),[h]),b=(0,w.VK)((()=>{if("collection"!==(null==y?void 0:y.type))return;const e=y.filter;return(0,k.$K)(e)?(0,Kl.Ih)(e,(null==h?void 0:h.getSchema())??{}):void 0}),[y,h]),_=gn({automationStore:o,collectionStore:n}),x=(0,w.qz)(void 0,bn.Z),T=(0,l.useMemo)((()=>({values:f??{},properties:S??[]})),[f,S]),P=(0,l.useCallback)((e=>{(0,k.$K)(y)&&"collection"===y.type&&y.collection.id!==e.id&&c({collection:e,type:"collection"})}),[y,c]),A=(0,l.useCallback)((e=>{(0,k.$K)(y)&&"collection"===y.type&&(O().isEqual(y.filter,e)||c({...y,filter:e}))}),[y,c]),V=(0,l.useCallback)((e=>{const t=T.properties.concat([e]);a(t,T.values)}),[a,T]),F=(0,l.useCallback)(((e,t)=>{const o=T.properties.indexOf(e);if(-1===o)return;const n=T.properties.slice(0);n[o]=t;const i={...T.values,[t]:void 0};a(n,i)}),[a,T]),I=(0,l.useCallback)((e=>{const t=T.properties.filter((t=>t!==e)),o={...T.values,[e]:void 0};a(t,o)}),[a,T]),B=(0,l.useCallback)(((e,t)=>{const o={...T.values,[e]:t};a(T.properties,o)}),[a,T]),Z=(0,l.useCallback)((e=>{Vl.Bd({store:x,event:e,disabled:r})}),[x,r]),E=(0,l.useCallback)((e=>{Vl.Js({store:x,event:e,disabled:r,isMobile:d})}),[x,r,d]),D=(0,l.useCallback)((e=>{Vl.iV({store:x,event:e,disabled:r})}),[x,r]),K=(0,M.yK)((e=>({sectionWrap:{background:e.cardContentBackground,display:"flex",flexDirection:"column",gap:g?12:16,paddingBlock:12,paddingInline:12},headerTitle:{alignItems:"center",display:"flex",flexWrap:"wrap",minWidth:100,whiteSpace:"pre"}})),[g]);return _?l.createElement("section",{onMouseEnter:Z,onMouseLeave:D,onMouseMove:E,ref:u,style:K.sectionWrap},i()(zl,{disabled:r,icon:m.display.icon({height:21,width:14}),interactionStore:x,onDelete:s},void 0,i()("div",{style:K.headerTitle},void 0,i()(Gl,{actionStore:t,automationContextStore:_,disabled:r,onChange:P,value:v})),(0,k.$K)(h)&&i()("div",{style:K.headerTitle},void 0,i()(Ll,{automationContextStore:_,collectionStore:h,disabled:r,filter:b,onChange:A}))),h&&i()(pi.vV,{actionId:t.id,collectionStore:h,config:T,contextStore:_,disabled:r,onPropertyAdd:V,onPropertyChange:F,onPropertyRemove:I,onPropertyValueChange:B,showSetPropertyActions:!0})):null}function Gl(e){window.__c={n:"ActionTitle"};const{automationContextStore:t,disabled:o,onChange:n,value:r}=e,a=(0,M.yK)((()=>({b:{fontWeight:x.Z.fontWeight.medium},picker:{flex:"1 1 auto",marginInlineStart:-5,minWidth:50},span:{alignItems:"center",display:"inline-flex",flex:"0 0 auto",minHeight:(0,Nl.H)({})}})),[]);return i()(d.FormattedMessage,{defaultMessage:"<span>Update <b>pages</b> in </span>{collectionPicker}",id:"automations.UpdatePagesActionV2.header.title",values:{b:e=>i()("b",{style:a.b},void 0,e),collectionPicker:i()("div",{style:a.picker},void 0,i()(Il.a,{contextStore:t,currentValue:r,disabled:o,onChange:n})),span:e=>i()("span",{style:a.span},void 0,e)}})}function Ll(e){window.__c={n:"CollectionFilterTitle"};const{automationContextStore:t,collectionStore:o,disabled:n,filter:r,onChange:a}=e,l=(0,C.O7)(),s=(0,d.useIntl)(),c=(0,w.VK)((()=>(0,un.vU)({environment:l,intl:s,store:o})),[o,s,l]),u=(0,M.yK)((()=>({picker:{flex:"1 1 auto",marginInlineStart:-5,minWidth:50},span:{alignItems:"center",display:"inline-flex",flex:"0 0 auto",minHeight:(0,Nl.H)({})}})),[]);return i()(d.FormattedMessage,{defaultMessage:"<span>that match </span>{filterPicker}",id:"automations.UpdatePagesActionV2.header.filterTitle",values:{filterPicker:i()("div",{style:u.picker},void 0,i()(Rl.W,{collectionStore:o,contextStore:t,disabled:n,filter:r,noFiltersMessage:(0,k.$K)(c)?i()(d.FormattedMessage,{defaultMessage:"All pages in {collectionName}",id:"automations.UpdatePagesAction.filterRuleCount.noFilters.label",values:{collectionName:c}}):i()(d.FormattedMessage,{defaultMessage:"All pages in database",id:"automations.UpdatePagesAction.filterRuleCount.noFilters.fallbackLabel"}),onChange:a})),span:e=>i()("span",{style:u.span},void 0,e)}})}function zl(e){window.__c={n:"ActionHeader"};const{children:t,disabled:o,icon:n,interactionStore:r,onDelete:a}=e,{isMobile:s}=(0,C.Fy)(),[c,d]=fn(),u=(0,w.qz)(r,bn.Z),p=(0,w.VK)((()=>u.getState()),[u]),g=!o&&(s||p.hovered||d),m=(0,M.yK)((()=>({wrap:{alignItems:"start",cursor:o?"default":void 0,opacity:o?.4:void 0,display:"flex",gap:6,minHeight:28},iconWrap:{alignItems:"center",display:"inline-flex",flex:"0 0 auto",minHeight:(0,Nl.H)({})},titleWrap:{display:"flex",flex:"1 1 auto",flexWrap:"wrap",fontSize:14,lineHeight:1.4,minWidth:0},moreButtonWrap:{flex:"0 0 26px"}})),[o]);return l.createElement("header",{ref:c,style:m.wrap},n&&i()("div",{style:m.iconWrap},void 0,n),i()("div",{style:m.titleWrap},void 0,t),i()("div",{style:m.moreButtonWrap},void 0,g&&i()(_n,{disabled:o,onDelete:a})))}function Ul(e){window.__c={n:"UpdateCheckboxPropertyAction"};const{disabled:t,onClick:o,onDelete:n,onEdit:r,propertySchema:a,value:s}=e,c=(0,M.yK)((()=>({content:{alignItems:"center",display:"flex"},propertyName:{...x.Z.textOverflowStyle,fontWeight:x.Z.fontWeight.semibold}})),[]),u=(0,Ht.A6)(null==s?void 0:s.value)[0],p=a.name,g=!0===u?l.createElement(l.Fragment,null,_.Z.checkboxSquareChecked({display:"inline-block",marginInlineEnd:4,verticalAlign:"middle",width:12}),l.createElement(d.FormattedMessage,ko.actionCheckboxPropertyChecked)):l.createElement(l.Fragment,null,_.Z.checkboxSquare({display:"inline-block",marginInlineEnd:4,verticalAlign:"middle",width:10}),l.createElement(d.FormattedMessage,ko.actionCheckboxPropertyUnchecked)),m={propertyName:i()("span",{style:c.propertyName},void 0,p),propertyValue:i()(An.Z,{format:Tn.l.Medium,isRound:!0,isSingle:!0,shouldShrink:!0,showRemoveButton:!1,value:g})};return i()(Mn,{disabled:t,icon:_.Z.typesCheckbox,onClick:o,onDelete:n,onEdit:r,title:i()("div",{style:c.content},void 0,l.createElement(d.FormattedMessage,xo(m)))})}function Hl(e){window.__c={n:"UpdateDatePropertyAction"};const{automationStore:t,collectionStore:o,disabled:n,onClick:r,onDelete:a,onEdit:s,propertySchema:c,value:u,valueContext:p}=e,g=(0,M.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre"},propertyName:{...x.Z.textOverflowStyle,fontWeight:x.Z.fontWeight.semibold}})),[]),m=gn({automationStore:t,collectionStore:o});if(!m)return null;const y=i()("span",{style:g.propertyName},void 0,c.name),S=void 0===(null==u?void 0:u.value)?To({propertyName:y}):Po({propertyName:y,propertyValue:i()($l,{automationContextStore:m,value:u,valueContext:p})});return i()(Mn,{disabled:n,icon:_.Z.typesDate,onClick:r,onDelete:a,onEdit:s,title:i()("div",{style:g.content},void 0,l.createElement(d.FormattedMessage,S))})}function $l(e){window.__c={n:"DatesToken"};const{automationContextStore:t,value:o,valueContext:n}=e,r=(0,d.useIntl)(),a=(0,w.VK)((()=>Ho(t)),[t]),s=(0,w.VK)((()=>(0,pr._)(n)),[n]),c=(0,Ht.A6)(null==o?void 0:o.value)[0];if("string"==typeof c||"boolean"==typeof c||(0,Qt.IW)(c)||(0,Qt.ST)(c))return null;if((0,Qt.wj)(c)){const e=(0,Qt.vm)(c).id,t=(0,Ut.vx)(a,e);return t?i()(ur.F,{value:t,format:Tn.l.Medium,isSingle:!1,shouldShrink:!0}):null}if((0,Qt.fp)(c)){const e=(0,Qt.Ot)(c);return e?(0,zt.OB)({value:e,date_format:s.dateFormat,time_format:s.timeFormat,userTimeZone:(0,$t.r)(),allowRelativeDates:!0,intl:r,shortenDateAndRange:!0,displayInUserTimezone:!0,formatValuesFn:e=>{let{endDate:t,endTime:o,startDate:n}=e;return(0,k.$K)(o)?l.createElement(l.Fragment,null,i()(ql,{value:n})," ‚Üí ",i()(ql,{value:o})):(0,k.$K)(t)?l.createElement(l.Fragment,null,i()(ql,{value:n})," ‚Üí ",i()(ql,{value:t})):i()(ql,{value:n})}}):null}(0,k.t1)(c)}function ql(e){window.__c={n:"AutomationDateToken"};const{value:t}=e,o=(0,M.Fg)();return i()(An.Z,{backgroundColor:o.accentColors.gray[75],format:Tn.l.Medium,isRound:!0,isSingle:!0,showRemoveButton:!1,style:{marginBlockEnd:4},value:t})}function jl(e){window.__c={n:"UpdatePersonPropertyAction"};const{collectionStore:t,disabled:o,onClick:n,onDelete:r,onEdit:a,propertySchema:s,value:c}=e,u=(0,Lt.DW)({textValue:null==c?void 0:c.value,propertySchema:s}),p=(0,w.VK)((()=>u.map((e=>(0,Nt.Hl)({pointer:e,getRecordValue:t.getRecordValue})))),[t,u]),g=(0,M.yK)((()=>({content:{alignItems:"center",display:"flex",flexWrap:p.length>1?"wrap":"nowrap",whiteSpace:"pre"},propertyName:{...x.Z.textOverflowStyle,fontWeight:x.Z.fontWeight.semibold},propertyValue:{...x.Z.textOverflowStyle,paddingBlockStart:4},propertyValueList:{display:"flex",flexBasis:"100%",flexDirection:"column",listStyle:"none",margin:0,marginBlockStart:10,padding:0,rowGap:4}})),[p]),m=i()("span",{style:g.propertyName},void 0,s.name),y=function(e){const{actors:t,styles:o}=e;return 1===t.length?i()("div",{style:o.propertyValue},void 0,i()(Oi.ZP,{actor:t[0],showRemoveButton:!1,format:Oi.ZP.Format.Medium,isSingle:!1})):i()("ul",{style:o.propertyValueList},void 0,t.map(((e,t)=>i()("li",{},t,i()("div",{style:o.propertyValue},t,i()(Oi.ZP,{actor:e,showRemoveButton:!1,format:Oi.ZP.Format.Medium,isSingle:!1}))))))}({actors:p,styles:g});let S;return S=0===p.length?Ao({propertyName:m}):1===p.length?Vo({propertyName:m,propertyValue:y}):Fo({propertyName:m,propertyValue:y}),i()(Mn,{disabled:o,icon:_.Z.typesPerson,onClick:n,onDelete:r,onEdit:a,title:i()("div",{style:g.content},void 0,l.createElement(d.FormattedMessage,S))})}function Yl(e){window.__c={n:"UpdateSelectPropertyAction"};const{disabled:t,onClick:o,onDelete:n,onEdit:r,propertySchema:a,value:s}=e,c=(0,M.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"nowrap",whiteSpace:"pre"},propertyName:{...x.Z.textOverflowStyle,fontWeight:x.Z.fontWeight.semibold}})),[]),u=null!=s&&s.value?(0,Ht.A6)(null==s?void 0:s.value)[0]:void 0;if(void 0!==u&&"string"!=typeof u)return null;const p=i()("span",{style:c.propertyName},void 0,a.name),g=void 0===u?Eo({propertyName:p}):Do({propertyName:p,propertyValue:Nn({optionValues:[u],propertySchema:a})});return i()(Mn,{disabled:t,icon:_.Z.typesSelect,onClick:o,onDelete:n,onEdit:r,title:i()("div",{style:c.content},void 0,l.createElement(d.FormattedMessage,g))})}function Ql(e){window.__c={n:"UpdateStatusPropertyAction"};const{disabled:t,onClick:o,onDelete:n,onEdit:r,propertySchema:a,value:s}=e,c=(0,Ht.A6)(null==s?void 0:s.value)[0],u=(0,M.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"nowrap",whiteSpace:"pre"},propertyName:{...x.Z.textOverflowStyle,fontWeight:x.Z.fontWeight.semibold}})),[]);if(!s||"string"!=typeof c)return null;const p=i()("span",{style:u.propertyName},void 0,a.name),g=Zn({groupValues:[],optionValues:[c],propertySchema:a});return 0===g.length?null:i()(Mn,{disabled:t,icon:_.Z.typesStatus,onClick:o,onDelete:n,onEdit:r,title:i()("div",{style:u.content},void 0,l.createElement(d.FormattedMessage,No({propertyName:p,propertyValue:g})))})}function Xl(e){window.__c={n:"UpdateBaseTextPropertyAction"};const{automationStore:t,disabled:o,icon:n,onClick:r,onDelete:a,onEdit:s,propertySchema:c,value:u}=e,p=(0,C.O7)(),g=(0,M.Fg)(),m=void 0===(null==u?void 0:u.value),y=(0,w.VK)((()=>null!=u&&u.value?(0,sn.IY)({disabled:!0,disableDateStyleAnnotations:!0,disableHover:!0,disableLinks:!0,disableStyleAnnotations:!0,emojiType:(0,cn.e_)(p),environment:p,formulaValueTypes:[],katex:p.KatexStore.getKatex(),parentStore:t,stopLinkPropagation:!0,textValue:{value:null==u?void 0:u.value,spaceId:(0,jn.CG)(t.pointer.spaceId)},theme:g}):null),[t,p,g,u]),S=(0,M.yK)((()=>({content:{alignItems:"center",display:"flex"},propertyName:{...x.Z.textOverflowStyle,fontWeight:x.Z.fontWeight.semibold}})),[]),f=i()("span",{style:S.propertyName},void 0,c.name),h=i()(An.Z,{format:Tn.l.Medium,isRound:!0,isSingle:!0,shouldShrink:!0,showRemoveButton:!1,value:i()("span",{style:x.Z.textOverflowStyle},void 0,y)}),v=m?Ro({propertyName:f}):Oo({propertyName:f,propertyValue:h});return i()(Mn,{disabled:o,icon:n,onClick:r,onDelete:a,onEdit:s,title:i()("div",{style:S.content},void 0,l.createElement(d.FormattedMessage,v))})}function Jl(e){return l.createElement(Xl,a()({},e,{icon:_.Z.typesTitle}))}function es(e){return l.createElement(Xl,a()({},e,{icon:_.Z.typesText}))}function ts(e){return l.createElement(Xl,a()({},e,{icon:_.Z.typesEmail}))}function os(e){return l.createElement(Xl,a()({},e,{icon:_.Z.typesUrl}))}function ns(e){return l.createElement(Xl,a()({},e,{icon:_.Z.typesNumber}))}function is(e){return l.createElement(Xl,a()({},e,{icon:_.Z.typesPhoneNumber}))}function rs(e){const{automationStore:t,collectionStore:o,disabled:n,formulaValueContext:r,onClick:a,onEdit:l,propertySchema:s,setPropertyValue:c,onDelete:d}=e;return"person"===s.type?i()(jl,{collectionStore:o,disabled:n,onClick:a,onDelete:d,onEdit:l,propertySchema:s,value:c.value}):"status"===s.type?i()(Ql,{disabled:n,onClick:a,onDelete:d,onEdit:l,propertySchema:s,value:c.value}):"select"===s.type?i()(Yl,{disabled:n,onClick:a,onDelete:d,onEdit:l,propertySchema:s,value:c.value}):"multi_select"===s.type?i()(On,{disabled:n,onClick:a,onDelete:d,onEdit:l,propertySchema:s,value:c.value}):"date"===s.type?i()(Hl,{automationStore:t,collectionStore:o,disabled:n,onClick:a,onDelete:d,onEdit:l,propertySchema:s,value:c.value,valueContext:r}):"relation"===s.type?i()(Gn,{collectionStore:o,disabled:n,onClick:a,onDelete:d,onEdit:l,propertySchema:s,value:c.value}):"checkbox"===s.type?i()(Ul,{disabled:n,onClick:a,onDelete:d,onEdit:l,propertySchema:s,value:c.value}):"title"===s.type?i()(Jl,{automationStore:t,disabled:n,onClick:a,onDelete:d,onEdit:l,propertySchema:s,value:c.value}):"text"===s.type?i()(es,{automationStore:t,disabled:n,onClick:a,onDelete:d,onEdit:l,propertySchema:s,value:c.value}):"email"===s.type?i()(ts,{automationStore:t,disabled:n,onClick:a,onDelete:d,onEdit:l,propertySchema:s,value:c.value}):"url"===s.type?i()(os,{automationStore:t,disabled:n,onClick:a,onDelete:d,onEdit:l,propertySchema:s,value:c.value}):"number"===s.type?i()(ns,{automationStore:t,disabled:n,onClick:a,onDelete:d,onEdit:l,propertySchema:s,value:c.value}):"phone_number"===s.type?i()(is,{automationStore:t,disabled:n,onClick:a,onDelete:d,onEdit:l,propertySchema:s,value:c.value}):null}function as(e){window.__c={n:"CollectionSettingsAutomationActionList"};const{automationStore:t,collectionStore:o,updateCurrentAutomationState:n,handleNavigateToDeletedProperties:r,currentUserIsOwner:a,disabled:l}=e,s=(0,w.VK)((()=>t.getActionStores().map((e=>e.isType("update_pages")?i()(ls,{actionStore:e,automationStore:t,collectionStore:o,disabled:l,handleNavigateToDeletedProperties:r,updateCurrentAutomationState:n},e.id):e.isType("slack_notification")?i()(Fi,{actionStore:e,automationStore:t,collectionStore:o,updateCurrentAutomationState:n,currentUserIsOwner:a,disabled:l},e.id):e.isType("create_page")?i()(Bl,{actionStore:e,automationStore:t,collectionStore:o,disabled:l,updateCurrentAutomationState:n},e.id):void 0)).filter(k.$K)),[t,o,a,l,r,n]),c=(0,M.yK)((e=>({stepList:{border:`1px solid ${e.regularDividerColor}`,borderRadius:6,listStyle:"none",margin:0,overflow:"hidden",padding:0},stepItemWithBorderTop:{borderTop:`1px solid ${e.regularDividerColor}`}})),[]);return i()("ul",{style:c.stepList},void 0,s.map(((e,t)=>{const o=0===t?void 0:c.stepItemWithBorderTop;return i()("li",{style:o},t,e)})))}function ls(e){var t;window.__c={n:"InternalUpdatePageAction"};const{actionStore:o,automationStore:n,collectionStore:r,disabled:s,handleNavigateToDeletedProperties:c,updateCurrentAutomationState:d}=e,u=(0,zn.d)(),p=(0,w.VK)((()=>o.getConfig()),[o]),g=(0,w.VK)((()=>r.getSchema()),[r]),m=(0,l.useCallback)((()=>{d({action:{config:p,id:o.id,type:"update_pages"},type:"remove_action"})}),[p,o.id,d]);if("variable"===(null==p||null===(t=p.target)||void 0===t?void 0:t.type)){const e=(0,Ut.MY)(p.target.id);if("global"===e.source&&"button_page"===e.global){var y;const e=(p.properties??[])[0],t=g[e],S=null===(y=p.values)||void 0===y?void 0:y[e];if(t&&S){const c={type:"collection",collectionStore:r,property:e};return i()(Ce.ZP,{alignmentToOrigin:Ce.vR.End,placementToOrigin:Ce.pO.Bottom,popupType:u,render:t=>i()(Ai,{automationStore:n,buttonPopupParent:t,collectionStore:r,initialState:{propertyId:e,actionId:o.id,type:"eventActionProperty"},updateCurrentAutomationState:d}),renderOrigin:e=>l.createElement(rs,a()({},e,{automationStore:n,collectionStore:r,disabled:s,formulaValueContext:c,onDelete:m,onEdit:e.onClick,propertySchema:t,setPropertyValue:S}))})}return t?null:i()(Ce.ZP,{alignmentToOrigin:Ce.vR.Center,placementToOrigin:Ce.pO.Bottom,popupType:u,render:e=>i()(fl,{stepType:"action",onDelete:m,onViewDeletedProperties:c}),renderOrigin:t=>l.createElement(Sl,a()({},t,{disabled:s,propertyId:e,collectionStore:r}))})}return null}return i()(Ol,{actionStore:o,automationStore:n,collectionStore:r,disabled:s,updateCurrentAutomationState:d})}var ss=o(3386);const cs=(0,d.defineMessages)({addTriggerAriaLabel:{id:"collectionSettings.editAutomationView.addTrigger.iconButton",defaultMessage:"Add trigger"},addActionAriaLabel:{id:"collectionSettings.editAutomationView.addAction.iconButton",defaultMessage:"Add action"},deleteButton:{id:"collectionSettings.editAutomationView.deleteButton",defaultMessage:"Delete"},automationEnabledLabel:{defaultMessage:"Active",id:"collectionSettings.editAutomationView.automationEnabledLabel"},automationPausedLabel:{defaultMessage:"Paused",id:"collectionSettings.editAutomationView.automationPausedLabel"},automationEnabledHiddenAriaLabel:{defaultMessage:"Automation is active.",id:"collectionSettings.editAutomationView.automationEnabledHiddenAriaLabel"},automationPausedHiddenAriaLabel:{defaultMessage:"Automation is paused.",id:"collectionSettings.editAutomationView.automationPausedHiddenAriaLabel"},automationDisabledTooltip:{defaultMessage:"Ask {user} to resume this automation.",id:"collectionSettings.editAutomationView.automationDisabledTooltip"}}),ds=()=>{};function us(e){window.__c={n:"CollectionSettingsEditAutomationView"};const{automationPermissionScope:t,automationId:o,automationStore:n,collectionStore:r,collectionSettingsStore:s,collectionContextStore:c,isCreate:u,isDisabled:g,title:m,header:y,updateCurrentState:S,canSave:f,onSave:h,currentUserIsOwner:v,onDelete:b,onDisable:T,onEnable:P,hasPendingChanges:A}=e,V=(0,d.useIntl)(),B=(0,mn.D)(),{isMobile:Z}=(0,C.Fy)(),D=(0,w.VK)((()=>c.aliveAutomationCount.state),[c]),K=r.id,N=(0,w.VK)((()=>r.getSchema()),[r]),R=(0,w.VK)((()=>n.getName()??""),[n]),O=(0,w.VK)((()=>{var e;return(null===(e=n.getOwnerStore())||void 0===e?void 0:e.getDisplayName(V))??""}),[V,n]),W=function(e){const{contextStore:t}=e,[o,n]=(0,l.useState)([]),i=(0,w.VK)((()=>t?(0,Xa.uV)(t.context.automationStore,t.context.type):void 0),[t]);return(0,w.VK)((()=>{i?async function(e){const{automationAvailabilityContext:t}=e,o=t.automation.getTriggerType(),n=eo.Gl[o],i="default_bound"===n.max?eo.xZ:n.max;if(t.automationActions.length>=i)return[];const r=(0,Wt.P)("display"),a=[];for(const l of r)await l.isAvailableForContext(t)&&a.push(l);return a}({automationAvailabilityContext:i}).then((e=>n(function(e){const t=e=>e?1:-1;return e.slice().sort(((e,o)=>t(o.display.hasSideEffects)-t(e.display.hasSideEffects)))}(e))),(()=>n([]))):o.length>0&&n([])}),[o.length,i]),o}({contextStore:gn({automationStore:n,collectionStore:r})}),G=(0,l.useMemo)((()=>({type:"eventTriggers"})),[]),L=(0,l.useMemo)((()=>({type:"eventActions",availableActions:W})),[W]),z="readonly_with_delete"===t||"edit"===t&&!u,U="edit"===t,H=function(e){const t=4,{showDeleteEnableDisableOptions:o}=e,{isMobile:n}=(0,C.Fy)();return(0,M.yK)((e=>({automationSection:{display:"flex",flexDirection:"column",gap:t},automationSectionAdd:{marginLeft:"auto",flexGrow:0,flexShrink:0},automationSectionHeader:{alignItems:"center",display:"flex",flexDirection:"row"},automationSectionHeaderAction:{background:`linear-gradient(to right, ${e.regularDividerColor} 50%, transparent 50%), linear-gradient(to right, ${e.regularDividerColor} 50%, transparent 50%)`,backgroundPosition:"20px 0px, 20px bottom",backgroundRepeat:"no-repeat",backgroundSize:`2px 36px, 2px ${t+2}px`,marginBlockEnd:-t,paddingBlock:`36px ${t}px`,position:"relative"},automationSectionTitle:{color:e.lightTextColor,fontSize:n?14:12,lineHeight:1.3,position:"relative",fontWeight:x.Z.fontWeight.medium},automationCreateMobile:{boxShadow:"none",paddingBlock:"0 12px",paddingInline:12},automationCreateDesktop:{paddingBlock:o?"12px 0":12,paddingInline:12},automationCreateButton:{...n?{minHeight:45}:{},width:"100%"},automationNameInput:{marginBlockEnd:n?void 0:8},automationNameText:{marginInlineStart:12},automationOptionIconDesktop:{marginInlineStart:12},menuScroller:{...n?{}:{marginBlockStart:6}},wrap:{borderTop:`1px solid ${e.regularDividerColor}`,paddingBlockStart:15,paddingBlockEnd:12,paddingInline:12}})),[n,o])}({showDeleteEnableDisableOptions:z}),$=(0,zn.d)(),q=(0,w.VK)((()=>function(e){if(!po(e))return!1;const t=e.getTriggerStore().getKeyStore("event").getValue();return(null==t?void 0:t.pagesAdded)||"none"!==(null==t?void 0:t.pagePropertiesEdited.type)}(n)),[n]),j=(0,w.VK)((()=>function(e){return e.getActionIds().length>0}(n)),[n]),Y=0===W.length,Q=(0,w.VK)((()=>j&&U&&!Y),[U,j,Y]),X=(0,l.useCallback)((async()=>{await gs({automationName:R,hasPendingChanges:A})&&(0===D?p.wl({collectionSettingsStore:s,item:{type:"main"}}):p.z$({collectionSettingsStore:s}))}),[D,R,s,A]),J=(0,l.useCallback)((async()=>{await gs({automationName:R,hasPendingChanges:A})&&p.E3({collectionSettingsStore:s})}),[R,s,A]),ee=(0,l.useCallback)((async()=>{await gs({automationName:R,hasPendingChanges:A})&&(p.wl({collectionSettingsStore:s,item:{type:"main"}}),p.H4({collectionSettingsStore:s,item:{type:"properties",timelineViewTab:"timeline"}}),p.H4({collectionSettingsStore:s,item:{type:"deletedProperties",timelineViewTab:"timeline"}}))}),[R,s,A]),te=(0,w.VK)((()=>e=>{if(S(e),K&&N)if("update_trigger"===e.type||"remove_trigger"===e.type){const t=function(e){const{action:t,automationId:o,collectionStoreId:n,schema:i}=e;let r;if("page_added"===t.trigger.type)r={type:"page"};else if("any_page_property_edited"===t.trigger.type)r={condition:"any",type:"property"};else if("property_changed"===t.trigger.type){const e=i[t.trigger.property];if(!e)return;r={condition:"some",property_types:[e.type],type:"property"}}else(0,k.t1)(t.trigger);return{automation_id:o,automation_trigger:r,collection_id:n}}({action:e,automationId:o,collectionStoreId:K,schema:N});if(!t)return;"remove_trigger"===e.type?(0,Rt.Ey)(B,t):"update_trigger"===e.type&&function(e,t){if(!po(t))return!0;const o=t.getTriggerStore().getKeyStore("event");if("page_added"===e.type&&!0===o.getKeyStore("pagesAdded").getValue())return!1;if("any_page_property_edited"===e.type&&"any"===o.getKeyStore("pagePropertiesEdited").getKeyStore("type").getValue())return!1;if("property_changed"===e.type){const t=o.getKeyStore("pagePropertiesEdited").getValue();if("some"===(null==t?void 0:t.type)&&t.some.some((t=>t.property===e.property)))return!0}return!0}(e.trigger,n)&&(0,Rt.nK)(B,t)}else if("update_action"===e.type||"remove_action"===e.type){const t=function(e){const{action:t,automationId:o,collectionStoreId:n,schema:i}=e;let r;if("slack_notification"===t.action.type)r={type:"slack_notification"};else{if("update_pages"!==t.action.type)return;var a;r={property_types:((null===(a=t.action.config)||void 0===a?void 0:a.properties)??[]).map((e=>{var t;return null===(t=i[e])||void 0===t?void 0:t.type})).filter(k.$K),type:"update_pages"}}return{automation_action:r,automation_action_id:t.action.id,automation_id:o,collection_id:n}}({action:e,automationId:o,collectionStoreId:K,schema:N});if(!t)return;"remove_action"===e.type?(0,Rt.OK)(B,t):"update_action"===e.type&&function(e,t){return!t.getActionIds().includes(e.id)}(e.action,n)&&(0,Rt.A2)(B,t)}}),[o,n,K,B,S,N]),oe=(0,l.useCallback)((e=>{const t=e.target.value;te({type:"update_name",name:t})}),[te]),ne=(0,l.useCallback)((e=>{te({type:"update_source",pointer:e})}),[te]);!function(e){const{automationStore:t,collectionStoreId:o,eventTracker:n,isCreate:i}=e,[r,a]=(0,l.useState)(!1),s=(0,w.VK)((()=>t.getActionIds().length),[t]),c=(0,w.VK)((()=>{if(!po(t))return 0;const e=t.getTriggerStore().getKeyStore("event");let o=0;e.getKeyStore("pagesAdded").getValue()&&o++;const n=e.getKeyStore("pagePropertiesEdited").getValue();return"any"===(null==n?void 0:n.type)?o++:"some"===(null==n?void 0:n.type)&&(o+=n.some.length),o}),[t]);(0,l.useEffect)((()=>{n&&o&&!i&&!r&&((0,Rt.nC)(n,{automation_id:t.id,automation_total_actions:s,automation_total_triggers:c,collection_id:o}),a(!0))}),[n,o,i,r,s,c,t.id])}({collectionStoreId:K,eventTracker:B,isCreate:u,automationStore:n});const ie=(0,w.VK)((()=>{if(po(n)){const e=n.getTriggerStore().getKeyStore("event").getKeyStore("source").getValue();if(e&&"filter"!==e.type)return e.pointer}}),[n]),re=[];return U&&re.push(i()(E.Z,{mobileStyle:H.automationCreateMobile,style:H.automationCreateDesktop,topBorder:!Z},void 0,i()(fe.Z,{onClick:h,disabled:!f,style:H.automationCreateButton},void 0,i()(d.FormattedMessage,u?{id:"collectionSettings.editAutomationView.createButton.label",defaultMessage:"Create"}:{id:"collectionSettings.editAutomationView.saveButton.label",defaultMessage:"Save"})))),z&&re.push(i()(E.Z,{disableMobilePadding:!0,topBorder:Z||0===re.length},void 0,i()(I.Z,{desktopIconStyle:H.automationOptionIconDesktop,icon:_.Z.trash,isRed:!0,onClick:b,title:V.formatMessage(cs.deleteButton)}))),i()(ss.Z,{capture:!0,onEsc:J},void 0,i()(F.ZP,{title:m,collectionSettingsStore:s,collectionContextStore:c,handleBackArrowClick:X,handleClose:J,footer:re,fullHeight:!0,menuScrollerStyle:H.menuScroller},void 0,y,i()(De.Z,{type:De.i.Vertical,initialFocus:void 0,sections:[{key:"automation_top_input",items:[{key:"automation_name",action:()=>{},render:e=>l.createElement(Ee.ZP,a()({style:H.automationNameInput},e,{value:R??"Loading...",onChange:oe,disabled:!U,textWrapperStyle:H.automationNameText}))},{key:"automation_source",action:ds,render:e=>i()(gl,{menuListItemProps:e,selectedSourcePointer:ie,collectionContextStore:c,onSelect:ne,disabled:!U})}],render:e=>l.createElement(E.Z,a()({},e,{disableMobilePadding:Boolean(y)}))}]}),i()("div",{style:H.wrap},void 0,z&&P&&T&&i()(ps,{automationId:n.id,automationOwner:O,disabled:!U,isAutomationDisabled:g,onDisable:T,onEnable:P}),i()("section",{style:H.automationSection},void 0,i()("header",{style:H.automationSectionHeader},void 0,i()("div",{style:H.automationSectionTitle},void 0,i()(d.FormattedMessage,{id:"collectionSettings.editAutomationView.triggerSection.title",defaultMessage:"When any of these occur"})),i()("div",{style:{...H.automationSectionAdd,visibility:q&&U?void 0:"hidden"}},void 0,i()(Ce.ZP,{popupType:$,alignmentToOrigin:Ce.vR.End,placementToOrigin:Ce.pO.Bottom,renderOrigin:e=>l.createElement(Cn.Z,a()({},e,{ariaLabel:V.formatMessage(cs.addTriggerAriaLabel),icon:_.Z.plus})),render:e=>r&&i()(Tl,{automationStore:n,collectionStore:r,initialState:G,updateCurrentAutomationState:te,buttonPopupParent:e})}))),q?i()(Pl,{automationStore:n,collectionStore:r,updateCurrentState:te,handleNavigateToDeletedProperties:ee,disabled:!U}):i()(Ce.ZP,{popupType:$,renderOrigin:e=>l.createElement(ll,a()({},e,{icon:_.Z.plus({height:24,width:12}),title:i()(d.FormattedMessage,{id:"collectionSettings.editAutomationView.triggerSection.placeholder",defaultMessage:"Add trigger"})})),render:e=>r&&i()(Tl,{automationStore:n,collectionStore:r,initialState:G,updateCurrentAutomationState:te,buttonPopupParent:e})})),i()("section",{style:H.automationSection},void 0,i()("header",{style:{...H.automationSectionHeader,...H.automationSectionHeaderAction}},void 0,i()("div",{style:H.automationSectionTitle},void 0,i()(d.FormattedMessage,{id:"collectionSettings.editAutomationView.actionSection.title",defaultMessage:"Do this"})),i()("div",{style:{...H.automationSectionAdd,visibility:Q?void 0:"hidden"}},void 0,i()(Ce.ZP,{alignmentToOrigin:Ce.vR.End,placementToOrigin:Ce.pO.Bottom,popupType:$,render:e=>i()(Ai,{automationStore:n,buttonPopupParent:e,collectionStore:r,initialState:L,updateCurrentAutomationState:te}),renderOrigin:e=>l.createElement(Cn.Z,a()({},e,{ariaLabel:V.formatMessage(cs.addActionAriaLabel),icon:_.Z.plus}))}))),j?i()(as,{automationStore:n,collectionStore:r,handleNavigateToDeletedProperties:ee,updateCurrentAutomationState:te,currentUserIsOwner:v,disabled:!U}):i()(sl,{automationStore:n,availableActions:W,collectionStore:r,initialState:L,updateCurrentAutomationState:te})))))}function ps(e){window.__c={n:"AutomationSectionStatus"};const{automationId:t,automationOwner:o,disabled:n,isAutomationDisabled:r,onDisable:s,onEnable:c}=e,u=`toggle-${t}`,p=(0,l.useCallback)((()=>{r?null==c||c():null==s||s()}),[r,c,s]),g=(0,M.yK)((e=>({labelWrap:{color:n?e.text.tertiary:r?e.text.secondary:e.text.primary,flex:"1 1 auto",fontSize:14},sectionWrap:{alignItems:"start",display:"flex",flexDirection:"row",gap:6,marginBlockEnd:12},toggleWrap:{flex:"0 0 auto",paddingBlockStart:2}})),[n,r]),m=r?cs.automationPausedLabel:cs.automationEnabledLabel,y=r?cs.automationPausedHiddenAriaLabel:cs.automationEnabledHiddenAriaLabel;return i()("section",{style:g.sectionWrap},void 0,i()("div",{style:g.toggleWrap},void 0,i()(St.Z,{disableTooltip:!n||!r,renderTooltip:()=>l.createElement(d.FormattedMessage,a()({},cs.automationDisabledTooltip,{values:{user:o}})),render:e=>l.createElement("div",e,i()(yt.Z,{disabled:n,inputId:u,on:!r,onClick:p}))})),i()("div",{style:g.labelWrap},void 0,i()("label",{htmlFor:u},void 0,i()("span",{"aria-hidden":!0},void 0,l.createElement(d.FormattedMessage,m)),i()("span",{style:al.jy},void 0,l.createElement(d.FormattedMessage,y)))))}async function gs(e){const{automationName:t,hasPendingChanges:o}=e;return!o||await ye.confirmUserAction({message:i()(d.FormattedMessage,{id:"automations.confirmDiscardChanges.message",defaultMessage:"{hasName, select, true {Are you sure you want to discard {automationName}?} other {Are you sure you want to discard this automation?}}",values:{automationName:t,hasName:Boolean(t)}}),acceptLabel:i()(d.FormattedMessage,{id:"automations.confirmDiscardChanges.acceptLabel",defaultMessage:"Discard"})})}const ms=(0,d.defineMessages)({createStatusAutomationViewMenuTitle:{id:"collectionSettings.createStatusAutomationView.menuTitle",defaultMessage:"New automation"},editStatusAutomationViewMenuTitle:{id:"collectionSettings.editStatusAutomationView.menuTitle",defaultMessage:"Edit automation"}});function ys(e){window.__c={n:"CollectionSettingsEditStatusAutomationView"};const{collectionSettingsStore:t,collectionContextStore:o,...n}=e,r=(0,l.useMemo)((()=>n),[]),a=(0,d.useIntl)(),s=(0,C.O7)(),u=(0,w.VK)((()=>o.collectionStore()),[o]),g=(0,w.VK)((()=>null==u?void 0:u.getSpaceId()),[u]),m=(0,w.VK)((()=>yn.default.state.currentUserStore),[]),y=(0,w.VK)((()=>null==m?void 0:m.userId),[m]),S=(0,w.VK)((()=>null==m?void 0:m.getDisplayName(a)),[m,a]),f=(0,Qa.$)("CollectionSettingsEditStatusAutomationView",{cacheFallback:s.defaultRecordCache.inMemoryRecordCache,isTemporaryData:!0}),h=(0,l.useMemo)((()=>"update"===r.type?r.automationId:(0,c.ZP)()),[r]),v=(0,w.VK)((()=>(0,Ot.XO)(a,S)),[S,a]),b=(0,w.VK)((()=>{if(!g||!u||!y)return;const e={id:h,table:Xt.cv,spaceId:g},t=f.getEntry({pointer:e,userId:y});return t?t.value.value:$o({automationId:h,automationName:v,collectionStore:u,userId:y})}),[h,v,u,y,f,g]),M=(0,w.VK)((()=>{if(!g||!u)return;const e={id:h,table:Xt.cv,spaceId:g},t=f.getEntry({pointer:e,userId:y});"create"===r.type&&!(0,k.$K)(t)&&y&&f.setRecord({pointer:e,userId:y},{role:"editor",value:b});const o=new co.Mz(s,e,{inMemoryRecordCache:f});return po(o)?o:void 0}),[b,h,u,y,s,f,r.type,g]),_=(0,w.VK)((()=>((null==M?void 0:M.getActionStores())??[]).filter((e=>e.isDefined()))),[M]),x=Ya({automationStore:M,actionStores:_,loadingStatus:"resolved",mode:r.type}),T=(0,w.VK)((()=>o.aliveAutomationCount.state),[o]),P=(0,w.VK)((()=>{if(!M||!m)return!1;const e=m.pointer,t=M.getCreatedByPointer();return!(!e||!t)&&qt.dr.isEqual(e,t)}),[M,m]),A=(0,w.VK)((()=>(null==M?void 0:M.getStatus())??"disabled"),[M]),V="active"===A,F=mo({automationStore:M,currentUserId:y,inMemoryRecordCache:f}),I=(0,w.VK)((()=>!(!M||!u)&&wo({automationStore:M,collectionStore:u})),[M,u]),B=(0,w.VK)((()=>!(!u||!M)&&yo({automationStore:M,collectionStore:u})),[M,u]),Z=(0,w.VK)((()=>{var e;return null==M||null===(e=M.getOwnerStore())||void 0===e?void 0:e.getDisplayName(a)}),[a,M]),E=Ss({automationStorePointer:null==M?void 0:M.pointer,defaultRecordCache:s.defaultRecordCache.inMemoryRecordCache,inMemoryRecordCache:f,userId:y}),D=(0,l.useCallback)((()=>{u&&M&&E&&("create"===r.type?(Jo({automationStore:M,collectionStore:u,environment:s,intl:a}),Ga.oV({label:i()(d.FormattedMessage,{id:"automations.editAutomationView.createdConfirmation",defaultMessage:"{automationName} created",values:{automationName:M.getName()}})}),p.z$({collectionSettingsStore:t})):"update"===r.type?(en({automationStore:M,collectionStore:u,environment:s}),Ga.oV({label:i()(d.FormattedMessage,{id:"automations.editAutomationView.updatedConfirmation",defaultMessage:"{automationName} updated",values:{automationName:M.getName()}})}),p.z$({collectionSettingsStore:t})):(0,k.t1)(r))}),[M,t,u,s,E,a,r]),K=(0,l.useCallback)((()=>{M&&u&&on({automationStore:M,collectionStore:u,environment:s})}),[u,s,M]),N=(0,l.useCallback)((()=>{M&&u&&nn({automationStore:M,collectionStore:u,environment:s})}),[u,s,M]),R=(0,l.useCallback)((()=>{M&&u&&rn({automationStore:M,collectionStore:u,environment:s})}),[u,s,M]),O=(0,l.useCallback)((async()=>{M&&u&&"create"!==r.type&&await tn({intl:a,environment:s,existingAutomationStore:M,collectionStore:u,triggerType:"event",onDelete:()=>{1===T?p.wl({collectionSettingsStore:t,item:{type:"main"}}):p.z$({collectionSettingsStore:t})}})}),[T,M,t,u,s,a,r.type]);if(!u||!M)return null;const W="create"===n.type,G=E&&B,L=W?a.formatMessage(ms.createStatusAutomationViewMenuTitle):a.formatMessage(ms.editStatusAutomationViewMenuTitle),z=A&&Z&&i()(tl,{automationStore:M,collectionStore:u,showSlackSpecificMessages:!1,automationStatus:A,automationPermissionScope:x,automationCreatorName:Z,referencesIncompatibleCollectionViewFilter:I,onDelete:O,onResume:R});return i()(us,{automationId:M.id,automationStore:M,automationPermissionScope:x,canSave:G,collectionContextStore:o,collectionSettingsStore:t,collectionStore:u,currentUserIsOwner:P,hasPendingChanges:E,header:z,isCreate:W,isDisabled:!V,onDelete:O,onDisable:K,onEnable:N,onSave:D,title:L,triggerOperators:["any"],updateCurrentState:e=>F(e)})}function Ss(e){var t,o,n;const{automationStorePointer:i,defaultRecordCache:r,inMemoryRecordCache:a,userId:l}=e;if(!i||!l)return!1;const s=null===(t=r.getEntry({pointer:i,userId:l}))||void 0===t?void 0:t.value.value,c=null===(o=a.getEntry({pointer:i,userId:l}))||void 0===o?void 0:o.value.value;return!(0,k.$K)(s)||!O().isEqual(s,c)||Boolean(null==c||null===(n=c.action_ids)||void 0===n?void 0:n.some((e=>{var t,o;const n={id:e,spaceId:i.spaceId,table:io.Xj},s=null===(t=r.getEntry({pointer:n,userId:l}))||void 0===t?void 0:t.value.value,c=null===(o=a.getEntry({pointer:n,userId:l}))||void 0===o?void 0:o.value.value;return!(0,k.$K)(s)||!O().isEqual(s,c)})))}function fs(e){window.__c={n:"CollectionSettingsEditSlackAutomationView"};const{collectionSettingsStore:t,collectionContextStore:o,...n}=e,r=l.useMemo((()=>n),[]),a=(0,C.O7)(),s=(0,d.useIntl)(),u=(0,w.VK)((()=>o.collectionStore()),[o]),g=(0,w.VK)((()=>null==u?void 0:u.getSpaceId()),[u]),m=(0,w.VK)((()=>yn.default.state.currentUserStore),[]),y=(0,w.VK)((()=>null==m?void 0:m.userId),[m]),S=(0,w.VK)((()=>null==m?void 0:m.getDisplayName(s)),[m,s]),f=(0,Qa.$)("CollectionSettingsEditSlackAutomationView",{cacheFallback:a.defaultRecordCache.inMemoryRecordCache,isTemporaryData:!0}),h=(0,l.useMemo)((()=>"update"===r.type?r.automationId:(0,c.ZP)()),[r]),v=(0,w.VK)((()=>(0,Ot.gq)(s,S)),[S,s]),b=(0,w.VK)((()=>{if(!g||!u||!y)return;const e={id:h,table:Xt.cv,spaceId:g},t=f.getEntry({pointer:e,userId:y});return t?t.value.value:qo({automationId:h,automationName:v,collectionStore:u,userId:y})}),[h,v,u,y,f,g]),M=(0,w.VK)((()=>{if(!g||!u)return;const e={id:h,table:Xt.cv,spaceId:g},t=f.getEntry({pointer:e,userId:y});"create"===r.type&&!(0,k.$K)(t)&&y&&f.setRecord({pointer:e,userId:y},{role:"editor",value:b});const o=new co.Mz(a,e,{inMemoryRecordCache:f});return po(o)?o:void 0}),[b,h,u,y,a,f,r.type,g]),_=(0,w.VK)((()=>(null==M?void 0:M.getActionStores())??[]),[M]),x=Ya({automationStore:M,actionStores:_,loadingStatus:"resolved",mode:r.type}),T=(0,w.VK)((()=>o.aliveAutomationCount.state),[o]),P=(0,w.VK)((()=>{if(!M||!m)return!1;const e=m.pointer,t=M.getCreatedByPointer();return!(!e||!t)&&qt.dr.isEqual(e,t)}),[M,m]),A=(0,w.VK)((()=>(null==M?void 0:M.getStatus())??"disabled"),[M]),V="active"===A,F=mo({automationStore:M,currentUserId:y,inMemoryRecordCache:f}),I=(0,w.VK)((()=>!(!M||!u)&&wo({automationStore:M,collectionStore:u})),[M,u]),B=(0,w.VK)((()=>!(!u||!M)&&yo({automationStore:M,collectionStore:u})),[M,u]),Z=(0,w.VK)((()=>{var e;return null==M||null===(e=M.getOwnerStore())||void 0===e?void 0:e.getDisplayName(s)}),[s,M]),E=Ss({automationStorePointer:null==M?void 0:M.pointer,defaultRecordCache:a.defaultRecordCache.inMemoryRecordCache,inMemoryRecordCache:f,userId:y}),D=(0,l.useCallback)((()=>{u&&M&&E&&("create"===r.type?(Jo({automationStore:M,collectionStore:u,environment:a,intl:s}),Ga.oV({label:i()(d.FormattedMessage,{id:"automations.editAutomationView.createdConfirmation",defaultMessage:"{automationName} created",values:{automationName:M.getName()}})}),p.z$({collectionSettingsStore:t})):"update"===r.type?(en({automationStore:M,collectionStore:u,environment:a}),Ga.oV({label:i()(d.FormattedMessage,{id:"automations.editAutomationView.updatedConfirmation",defaultMessage:"{automationName} updated",values:{automationName:M.getName()}})}),p.z$({collectionSettingsStore:t})):(0,k.t1)(r))}),[M,t,u,a,E,s,r]),K=(0,l.useCallback)((()=>{M&&u&&rn({automationStore:M,collectionStore:u,environment:a})}),[u,a,M]),N=(0,l.useCallback)((async()=>{M&&u&&"create"!==r.type&&await tn({intl:s,environment:a,existingAutomationStore:M,collectionStore:u,triggerType:"event",onDelete:()=>{1===T?p.wl({collectionSettingsStore:t,item:{type:"main"}}):p.z$({collectionSettingsStore:t})}})}),[T,M,t,u,a,s,r.type]);if(!u||!M)return null;const R="create"===n.type,O=E&&B,W=A&&Z&&i()(tl,{automationStore:M,collectionStore:u,showSlackSpecificMessages:!0,automationStatus:A,automationPermissionScope:x,automationCreatorName:Z,referencesIncompatibleCollectionViewFilter:I,onDelete:N,onResume:K}),G=i()(d.FormattedMessage,R?{id:"collectionSettings.createSlackAutomationView.title",defaultMessage:"New Slack notification"}:{id:"collectionSettings.editSlackAutomationView.title",defaultMessage:"Slack notification"});return i()(us,{automationId:M.id,automationPermissionScope:x,automationStore:M,canSave:O,collectionContextStore:o,collectionSettingsStore:t,collectionStore:u,currentUserIsOwner:P,hasPendingChanges:E,header:W,isCreate:R,isDisabled:!V,onDelete:N,onSave:D,title:G,triggerOperators:["any"],updateCurrentState:e=>F(e)})}var hs=o(41837),vs=(o(30541),o(87205));const bs=12e3;var Cs=o(3791),ws=o(79474),Ms=o(4636),_s=o(55332),ks=o(28020),xs=o(77181),Ts=o(99417),Ps=o(96026),As=o(78291);const Vs=new V.Z;var Fs=o(30905),Is=o(73420),Bs=o(1743),Zs=o(91839);const Es=(0,d.defineMessages)({optionsSectionTitle:{defaultMessage:"Options",id:"database.viewSettings.propertyTab.aiAutofill.optionsSectionTitle"},extractPromptSectionTitle:{defaultMessage:"What key info to extract?",id:"database.viewSettings.propertyTab.aiAutofill.extractPromptSectionTitle"},customPromptSectionTitle:{defaultMessage:"What to generate?",id:"database.viewSettings.propertyTab.aiAutofill.customPromptSectionTitle"},extractPromptInputPlaceholder:{defaultMessage:"e.g. ‚ÄúKey topics in bullets‚Äù or ‚ÄúPeople mentioned on the page‚Äù",id:"database.viewSettings.propertyTab.aiAutofill.extractPromptInputPlaceholder"},customPromptInputPlaceholder:{defaultMessage:"Tell AI what to generate from page content and properties‚Ä¶",id:"database.viewSettings.propertyTab.aiAutofill.customPromptInputPlaceholder"},removeAutofillButton:{defaultMessage:"Turn off AI autofill",id:"database.viewSettings.propertyTab.aiAutofill.removeAutofillButton"},updateOnPageEdits:{defaultMessage:"Auto-update on page edits",id:"database.viewSettings.propertyTab.aiAutofill.updateOnPageEdits"},toggleFillWithAiSectionLabel:{defaultMessage:"Actions",id:"database.viewSettings.propertyTab.aiAutofill.actionsSectionLabel"},confirmOverwriteExistingPropertyValues:{defaultMessage:"Filling ‚Äú{propertyName}‚Äù with AI will overwrite any existing values of the property. Are you sure you want to continue?",id:"database.viewSettings.propertyTab.aiAutofill.confirmOverwriteModal"},autoUpdateExplanationMessage:{defaultMessage:"Keep values updated with the latest edits to pages",id:"database.CollectionSettingsPropertyAiAutofill.autoUpdateExplanationMessage"},onlyWithAiAddOnMessage:{defaultMessage:"Only with Notion AI add-on",id:"database.CollectionSettingsPropertyAiAutofill.onlyWithAiAddOnMessage"},noAiAutofillSelected:{defaultMessage:"Select an option",id:"database.CollectionSettingsPropertyAiAutofill.noAiAutofillSelected"},whatToTranslate:{defaultMessage:"What to translate?",id:"CollectionSettingsPropertyAiAutofill.translateProperty.propertySelector"},translateTo:{defaultMessage:"Translate to",id:"CollectionSettingsPropertyAiAutofill.translateProperty.languageSelector"},selectorSearchPlaceholder:{defaultMessage:"Search",id:"CollectionSettingsPropertyAiAutofill.selectorOption.searchbar.placeholder"},allProperties:{defaultMessage:"All properties",id:"CollectionSettingsPropertyAiAutofill.selectorOption.allProperties.checkbox"}});function Ds(e){window.__c={n:"CollectionSettingsPropertyAiAutofill"};const{property:t,collectionContextStore:o,collectionSettingsStore:n}=e,r=(0,w.VK)((()=>o.normalizedSchemaStore.state[t]),[t,o.normalizedSchemaStore]),s=(0,w.VK)((()=>o.collectionStore()),[o]),c=(0,w.VK)((()=>o.normalizedSchemaStore.getState()),[o]),g=r&&(0,ce.q3)(r),y=(0,C.O7)(),S=Us(),f=(0,w.VK)((()=>{const e=o.collectionStore();return e&&(0,Ts.mX)(y,Ps.Z.getMode(y,e),e)}),[y,o]),h=Un.default.createValue({stage:"not_started"});(0,l.useEffect)((()=>{var e,n;if("page"===o.getViewType())return;if(!1!==(null===(e=o.getPropertyFormat(t))||void 0===e?void 0:e.visible))return;const i=new Hr.Z({name:"CollectionSettingsPropertyAiAutofill"});y.defaultRecordCache.inMemoryRecordCache.addCacheOverride(i);const r=null===(n=o.formatStore())||void 0===n?void 0:n.clone(i),a=o.getPropertyFormatKey();return r&&a&&m.createAndCommit({userAction:"CollectionSettingsPropertyAiAutofill.open",environment:y,perform:e=>{ge.er({formatStore:r,formatKey:a,property:t,update:{visible:!0},transaction:e})}}),()=>{y.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(i)}}),[o,y,t]);const v=(0,l.useRef)({}),b=(0,w.VK)((()=>(0,Ve.k4)()),[]),[x,T]=(0,l.useState)(g),[P,A]=(0,l.useState)(!1),B=(0,l.useCallback)((()=>{const e=o.collectionStore();if(!e||!r)return;const n=(0,ce.q3)(r);n&&"prompt"in n&&(v.current={...v.current,[n.type]:n.prompt}),x&&u._eA(y,{type:"set_ai_inference",ai_inference_type:x.type,collection_id:e.id});const i=[];i.push({pointer:e.pointer,command:"set",path:["schema",t,"ai_inference"],args:x}),me.HW({environment:y,collectionStore:e,performTransaction:t=>{for(const o of i)m.applyOperation({store:(0,co.Kv)(e,o.pointer),operation:o,transaction:t})}})}),[o,r,x,t,y]),Z=(0,w.VK)((()=>{var e;return(null===(e=o.collectionStore())||void 0===e||null===(e=e.getName())||void 0===e?void 0:e.toString())||""}),[o]),D=(0,w.VK)((()=>{const e=o.collectionStore();return e?(0,Ae.De)(e.getFormat(),t):{isRunning:!1,numPagesFilled:void 0,numPagesRequested:void 0}}),[o,t]),K=(0,l.useCallback)((async()=>{const e=o.collectionStore();e&&r&&await Ms.ge({environment:y,collectionStore:e,propertySchema:r,property:t,...x&&{includedCollectionSchemaUpdateOp:{pointer:e.pointer,command:"set",path:["schema",t,"ai_inference"],args:x}}})}),[y,r,t,o,x]),N=(0,l.useCallback)((async()=>{r&&(0,ce.qQ)(r)&&O().isEqual(x,r.ai_inference)?p.E3({collectionSettingsStore:n}):x&&(!function(e){if(!e)return!1;switch(e.type){case"summarize":case"translate":return!1;case"extract":case"custom":return!0;default:throw(0,k.t1)(e)}}(x)||x.prompt&&!(x.prompt.length>bs)?(null==g||!g.auto_update_on_edit)&&null!=x&&x.auto_update_on_edit&&b&&r?await ws.r({sourceAction:"auto_update",propertyName:r.name,collectionName:Z})&&B():B():A(!0))}),[Z,n,g,x,B,b,r]),R=(0,l.useCallback)((()=>{const e=o.collectionStore();if(!e||!g)return;u._eA(y,{type:"remove_ai_inference",ai_inference_type:g.type,collection_id:e.id});const i=[];i.push({pointer:e.pointer,command:"set",path:["schema",t,"ai_inference"],args:void 0}),me.HW({environment:y,collectionStore:e,performTransaction:t=>{for(const o of i)m.applyOperation({store:(0,co.Kv)(e,o.pointer),operation:o,transaction:t})}}),p.z$({collectionSettingsStore:n})}),[y,t,n,o,g]),W=r&&(0,ce.qQ)(r)&&O().isEqual(x,r.ai_inference),G=(0,l.useCallback)((async()=>new Promise((e=>{ye.showDialog({showCancel:!1,keepFocus:!1,message:i()(Is.sg,{alignItems:"center",gap:8},void 0,_.Z.magicWand(S.confirmDiscardChangesDialogIconStyle),i()("div",{style:S.confirmDiscardChangesDialogMessageStyle},void 0,i()(d.FormattedMessage,{defaultMessage:"Do you want to discard changes for AI autofill?",id:"database.viewSettings.propertyTab.aiAutofill.confirmDiscordChangesDialog.message"}))),items:[{label:i()(d.FormattedMessage,{defaultMessage:"Discard",id:"database.viewSettings.propertyTab.aiAutofill.confirmDiscordChangesDialog.acceptLabel"}),color:"red",onAccept:()=>e(!0)},{label:i()(d.FormattedMessage,{defaultMessage:"Continue editing",id:"database.viewSettings.propertyTab.aiAutofill.confirmDiscordChangesDialog.cancelLabel"}),onAccept:()=>e(!1)}]})}))),[S]),L=(0,l.useCallback)((async()=>{(W||await G())&&p.z$({collectionSettingsStore:n})}),[W,n,G]),z=(0,l.useCallback)((async()=>{(W||await G())&&p.E3({collectionSettingsStore:n})}),[W,n,G]),U=(0,w.VK)((()=>{var e;const t=(null===(e=As.default.state.data)||void 0===e?void 0:e.addOns)??[];return(0,Cs.de)(t)}),[]),H=(0,M.Fg)(),$=(0,l.useMemo)((()=>[new V.Z,new V.Z]),[]),q=(0,l.useMemo)((()=>function(e){var t;let{environment:o,aiInference:n,collectionSchema:r,setAiInference:a,property:l,theme:s,optionsButtonPopupStores:c}=e;if(!n)return[];switch(n.type){case"summarize":return[];case"translate":const e=O().compact((0,k.Yd)(r).map((e=>{if(e===l)return;const t=r[e];if(t&&(0,vs.K9)(t)){var o;if("text"===t.type&&"translate"===(null===(o=t.ai_inference)||void 0===o?void 0:o.type))return;return{id:e,option:t.name,icon:i()(xn.ZP,{icon:t.icon,type:t.type,theme:s,size:16})}}}))),o=e.findIndex((e=>"title"===e.id));if(o&&o>0){const t=e[o];e.splice(o,1),e.unshift(t)}for(;c.length<2;)c.push(new V.Z);return[{type:"multi",options:e,selectedIds:(null===(t=n.targetProperties)||void 0===t?void 0:t.length)>0?n.targetProperties:["title"],setSelectedIds:e=>{a({...n,targetProperties:e})},selectorTitle:Es.whatToTranslate,selectAllTitle:Es.allProperties,buttonPopupStore:c[0]},{type:"single",options:vs.nI.map((e=>{let{key:t,name:o}=e;return{id:t,option:Fe.default.formatMessage(o)}})),selectedId:n.toLanguage,onSelect:e=>{a({...n,toLanguage:e})},selectorTitle:Es.translateTo,buttonPopupStore:c[1]}];case"extract":case"custom":return[];default:(0,k.t1)(n)}}({environment:y,aiInference:x,collectionSchema:c,setAiInference:T,property:t,theme:H,optionsButtonPopupStores:$})),[y,x,c,T,t,H,$]);return r&&(0,ce.qQ)(r)&&s?i()(ss.Z,{capture:!0,onEsc:z},void 0,l.createElement(F.ZP,a()({},e,{title:i()(d.FormattedMessage,{defaultMessage:"Fill ‚Äú{propertyName}‚Äù with AI",id:"database.viewSettings.propertyTab.aiAutofill.title",values:{propertyName:r.name}}),handleBackArrowClick:L,handleClose:z}),!f&&i()(E.Z,{style:S.menuItemStyle},void 0,i()(d.FormattedMessage,{defaultMessage:"You don't have permission to set up AI autofill on this database.",id:"database.viewSettings.propertyTab.aiAutofill.noSetupPermission"})),i()(Ks,{propertySchema:r,previousPromptByAiInferenceType:v.current,isAutofillSetupEnabled:f,draftAiInference:x,setDraftAiInference:T,environment:y}),i()(Rs,{collectionContextStore:o,propertySchema:r,environment:y,property:t,setAiInference:T,aiInference:x}),x&&i()(E.Z,{topBorder:!0},void 0,i()(zs,{environment:y,aiInference:x,setAiInference:T,collectionContextStore:o,isAutofillSetupEnabled:f,shouldShowUserPromptIsInvalidError:P,setShouldShowUserPromptIsInvalidError:A}),i()(Os,{environment:y,optionProps:q}),i()(Ls,{environment:y,isAutofillSetupEnabled:f,collectionContextStore:o,tryAutofillStore:h,propertySchema:r,property:t,aiInference:x}),i()(fe.Z,{style:{...S.buttonStyle,margin:"8px 12px 12px 12px",display:W?"none":"flex"},onClick:N,disabled:!f},void 0,i()(d.FormattedMessage,W?{defaultMessage:"Done",id:"database.viewSettings.propertyTab.aiAutofill.saveButtonAllSaved"}:{defaultMessage:"Save changes",id:"database.viewSettings.propertyTab.aiAutofill.saveButtonWithChanges"}))),i()(E.Z,{topBorder:!0,title:y.device.isMobile&&Fe.default.formatMessage(Es.toggleFillWithAiSectionLabel)},void 0,void 0!==g&&l.createElement(l.Fragment,null,i()(St.Z,{disableTooltip:U,renderTooltip:()=>i()(Fs.qQ,{collectionStore:s,propertySchema:r}),render:e=>l.createElement(I.Z,a()({icon:e=>i()(Fs.Xh,{updateAiInferencesTaskStatus:D,iconStyle:e,progressIconStyle:{marginTop:4,marginLeft:4,marginRight:2}}),title:i()(Fs.ZP,{updateAiInferencesTaskStatus:D}),caption:void 0!==D.numPagesFilled&&void 0!==D.numPagesRequested&&i()(Fs.Y7,{updateAiInferencesTaskStatus:D}),focused:!1,onClick:K,disabled:D.isRunning||!f},e))}),i()(I.Z,{icon:_.Z.trash,isRed:!0,focused:!1,title:Fe.default.formatMessage(Es.removeAutofillButton),onClick:R,disabled:!f})),i()(ua.Z,{href:(0,sa.UY)("guides.aiAutofill"),title:i()(d.FormattedMessage,{defaultMessage:"Learn about AI autofill",id:"database.viewSettings.propertyTab.aiAutofill.learnMoreLink"}),analyticsFrom:"collection_ai_autofill_menu"})))):null}function Ks(e){let{propertySchema:t,previousPromptByAiInferenceType:o,isAutofillSetupEnabled:n,draftAiInference:r,setDraftAiInference:a,environment:s}=e;window.__c={n:"AiPromptTypeSelectorSections"};const c=(0,w.VK)((()=>(0,Ve.k4)()),[]),u=(0,l.useCallback)((e=>{var n,i,r,l,s,d,u,p;if(!t||!(0,ce.qQ)(t)||!e)return;let g;switch(e){case"summarize":g={type:e,auto_update_on_edit:c};break;case"translate":g={type:e,auto_update_on_edit:c,targetProperties:(null===(n=t.ai_inference)||void 0===n?void 0:n.type)===e?null===(i=t.ai_inference)||void 0===i?void 0:i.targetProperties:["title"],toLanguage:(null===(r=t.ai_inference)||void 0===r?void 0:r.type)===e?null===(l=t.ai_inference)||void 0===l?void 0:l.toLanguage:"english"};break;case"extract":g={type:e,prompt:(null===(s=t.ai_inference)||void 0===s?void 0:s.type)===e?null===(d=t.ai_inference)||void 0===d?void 0:d.prompt:o[e]??"",auto_update_on_edit:c};break;case"custom":g={type:e,prompt:(null===(u=t.ai_inference)||void 0===u?void 0:u.type)===e?null===(p=t.ai_inference)||void 0===p?void 0:p.prompt:o[e]??"",auto_update_on_edit:c};break;default:(0,k.t1)(e)}a(g)}),[c,o,t,a]),p=(0,M.Fg)();return t&&(0,ce.qQ)(t)?i()(Ce.ZP,{popupType:s.device.isMobile?Ce.Z4.SlideUp:Ce.Z4.Popup,buttonPopupStore:Vs,render:e=>{const o={key:"section",render:e=>l.createElement(E.Z,e),items:O().compact((0,k.Yd)(Ts.OE[t.type]).map((t=>{if("translate"!==t||(0,Ts.hu)())return{key:t,render:e=>{const o=Ts.OE.text[t];return i()(Ze.Z,{focused:!1,onClick:e.onClick,icon:o.svg({height:20,width:24,fill:p.aiPurpleColor}),title:Fe.default.formatMessage(o.name),checkState:(null==r?void 0:r.type)===t})},action:()=>{e.close(),u(t)}}})))};return i()(we.Z,{menuType:ve.og.Popup,minWidth:260,maxWidth:"100vw"},void 0,i()(De.Z,{type:De.i.Vertical,initialFocus:void 0,sections:[o]}))},renderOrigin:e=>{let{onClick:t}=e;return i()("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:14,marginLeft:4,marginRight:4,marginTop:8,paddingLeft:12,paddingRight:12,cursor:"pointer",height:28},onClick:t},void 0,i()(d.FormattedMessage,{defaultMessage:"Fill with",id:"CollectionSettingsPropertyAiAutofill.ClosedSelector.Title"}),i()(Ns,{aiActionType:null==r?void 0:r.type}))}}):null}function Ns(e){let{aiActionType:t}=e;window.__c={n:"AiActionRenderer"};const o=(0,M.Fg)(),n=t?Ts.OE.text[t]:{name:Es.noAiAutofillSelected,svg:()=>null};return i()("div",{style:{display:"flex",alignItems:"center",cursor:"pointer",fontSize:14,paddingLeft:15,paddingBottom:0}},void 0,i()("div",{style:{color:o.lightIconColor}},void 0,n.svg({height:16,width:16,marginRight:2})),i()("div",{style:{color:o.lightTextColor,paddingLeft:4}},void 0,l.createElement(d.FormattedMessage,n.name)),i()("div",{style:{color:o.lightIconColor,paddingLeft:4}},void 0,_.Z.chevronRight({height:12,width:12})))}function Rs(e){let{collectionContextStore:t,propertySchema:o,environment:n,property:r,setAiInference:s,aiInference:u}=e;window.__c={n:"AutoUpdateOnPageEditsToggle"};const p=(0,l.useRef)((0,c.ZP)()),g=(0,w.VK)((()=>{var e;const t=(null===(e=As.default.state.data)||void 0===e?void 0:e.addOns)??[];return(0,Cs.de)(t)}),[]),m=(0,l.useCallback)((()=>{if(!t.collectionStore())return;if(!u)return;if(!(g||null!=u&&u.auto_update_on_edit))return void Ms.qg({environment:n,from:"ai_autofill_on_page_edit"});const e={...u,auto_update_on_edit:!u.auto_update_on_edit};s(e)}),[t,u,g,s,n]);if(!u)return null;return i()(St.Z,{renderTooltip:()=>i()("div",{style:{width:159}},void 0,i()("div",{style:{color:"white",fontWeight:500,wordWrap:"break-word",whiteSpace:"pre-wrap"}},void 0,l.createElement(d.FormattedMessage,Es.autoUpdateExplanationMessage)),!g&&i()("div",{style:{color:"#ACABA9",fontWeight:500}},void 0,l.createElement(d.FormattedMessage,Es.onlyWithAiAddOnMessage))),render:e=>(e=>l.createElement("div",a()({style:{display:"flex",marginTop:0,marginBottom:12,marginLeft:16,marginRight:12,gap:8,alignItems:"center",justifyContent:"space-between",height:28}},e),i()("label",{htmlFor:p.current,style:{display:"inline-block",fontSize:"14px",fontWeight:"400",userSelect:"none",cursor:"pointer"}},void 0,l.createElement(d.FormattedMessage,Es.updateOnPageEdits)),i()(yt.Z,{inputId:p.current,on:!!u.auto_update_on_edit,onClick:m,disabled:!1,noColor:!1})))(e)})}function Os(e){let{environment:t,optionProps:o}=e;return o&&o.length>0?i()(E.Z,{title:Fe.default.formatMessage(Es.optionsSectionTitle),isInput:!0,style:{marginTop:-4}},void 0,o.map(((e,o)=>"multi"===e.type?i()(Ws,{environment:t,options:e.options,selectedIds:e.selectedIds,setSelectedIds:e.setSelectedIds,selectorTitle:e.selectorTitle,selectAllTitle:e.selectAllTitle,buttonPopupStore:e.buttonPopupStore},o):i()(Gs,{environment:t,options:e.options,selectedId:e.selectedId,onSelect:e.onSelect,selectorTitle:e.selectorTitle,buttonPopupStore:e.buttonPopupStore},o)))):null}function Ws(e){let{environment:t,options:o,selectedIds:n,setSelectedIds:r,selectorTitle:s,selectAllTitle:c,buttonPopupStore:d}=e;window.__c={n:"CheckSelectorOption"};const[u,p]=(0,l.useState)(""),g=(0,M.Fg)(),m=o.filter((e=>n.includes(e.id))),y=(0,w.VK)((()=>O().uniq(O().sortBy(o.map((e=>e.id)))).join(",")===O().uniq(O().sortBy(n)).join(",")),[o,n]),S=e=>{n.includes(e)?r(n.filter((t=>t!==e))):r(O().uniq([...n,e]))},f=()=>{n.length<o.length?r(o.map((e=>e.id))):r(["title"])},h=i()(E.Z,{desktopStyle:{paddingTop:12,paddingBottom:4}},void 0,i()(Ee.ZP,{focusInitial:!t.device.isMobile||void 0,focus:!t.device.isMobile||void 0,value:u,onChange:e=>{p(e.target.value)},placeholder:Fe.default.formatMessage(Es.selectorSearchPlaceholder)}));return i()(Ce.ZP,{popupType:t.device.isMobile?Ce.Z4.SlideUp:Ce.Z4.Popup,buttonPopupStore:d,render:e=>{const t={key:"section",render:e=>l.createElement(E.Z,a()({},e,{topBorder:!0})),items:o.filter((e=>{var t;const o=null===(t=e.option)||void 0===t?void 0:t.toLowerCase();return-1!==(null==o?void 0:o.indexOf(u.toLowerCase()))})).map((e=>{let{id:t,option:o,icon:r}=e;return{key:t,render:e=>i()(Ze.Z,{focused:!1,onClick:e.onClick,left:i()(Cl.Z,{checked:n.includes(t),size:14,checkSize:8,onClick:e=>{S(t)}}),icon:r,title:o}),action:()=>{S(t)}}}))},r={key:"all-items",render:e=>l.createElement(E.Z,e),items:[{key:"all-items",render:e=>i()(Ze.Z,{focused:!1,onClick:()=>{f()},left:i()(Cl.Z,{checked:y,size:14,checkSize:8,onClick:()=>{f()}}),title:Fe.default.formatMessage(c)}),action:()=>{f()}}]};return i()(we.Z,{menuType:ve.og.Popup,minWidth:260,maxWidth:"100vw"},void 0,h,i()(De.Z,{type:De.i.Vertical,initialFocus:void 0,sections:[r,t]}))},renderOrigin:e=>l.createElement(I.Z,a()({title:Fe.default.formatMessage(s),showChevron:!0,right:i()("div",{style:{color:g.lightTextColor,paddingLeft:4,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",maxWidth:"90%"}},void 0,O().compact(m.map((e=>{let{id:t,option:o,icon:n}=e;return o}))).join(", ")),rightStyle:{flexShrink:1},rotateChevron:d.state.open,disabled:!1,textWrapperStyle:{minWidth:"auto"}},e))})}function Gs(e){let{environment:t,options:o,selectedId:n,onSelect:r,selectorTitle:s,buttonPopupStore:c}=e;window.__c={n:"SelectorOption"};const[d,u]=(0,l.useState)(""),p=o.find((e=>e.id===n)),g=(0,M.Fg)(),m=i()(E.Z,{desktopStyle:{paddingTop:12,paddingBottom:4}},void 0,i()(Ee.ZP,{focusInitial:!t.device.isMobile||void 0,focus:!t.device.isMobile||void 0,value:d,onChange:e=>{u(e.target.value)},placeholder:Fe.default.formatMessage(Es.selectorSearchPlaceholder)}));return i()(Ce.ZP,{popupType:t.device.isMobile?Ce.Z4.SlideUp:Ce.Z4.Popup,buttonPopupStore:c,render:e=>{const t={key:"section",render:e=>l.createElement(E.Z,e),items:o.filter((e=>{var t;return-1!==(null===(t=e.option)||void 0===t?void 0:t.toLowerCase().indexOf(d.toLowerCase()))})).map((t=>{let{id:o,option:a,icon:l}=t;return{key:o,render:e=>i()(Ze.Z,{focused:!1,onClick:e.onClick,icon:l,title:a,checkState:o===n}),action:()=>{e.close(),r(o)}}}))};return i()(we.Z,{menuType:ve.og.Popup,minWidth:260,maxWidth:"100vw"},void 0,m,i()(De.Z,{type:De.i.Vertical,initialFocus:void 0,sections:[t]}))},renderOrigin:e=>l.createElement(I.Z,a()({title:Fe.default.formatMessage(s),showChevron:!0,right:p&&l.createElement(l.Fragment,null,p.icon,i()("div",{style:{color:g.lightTextColor,paddingLeft:4,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",maxWidth:"90%"}},void 0,p.option)),rightStyle:{flexShrink:1},rotateChevron:c.state.open,disabled:!1,textWrapperStyle:{minWidth:"auto"}},e))})}function Ls(e){let{environment:t,isAutofillSetupEnabled:o,collectionContextStore:n,tryAutofillStore:r,propertySchema:s,property:p,aiInference:g}=e;window.__c={n:"TryOnThisViewActionSection"};const[m,y]=(0,l.useState)((0,c.ZP)()),S=(0,l.useRef)((0,c.ZP)()),f=(0,w.VK)((()=>r.state.stage),[r]),h=(0,w.VK)((()=>{const e=n.contextType;if("collectionPage"===e)return{type:"page",candidateBlockStores:O().compact([(0,ks.np)()])};if("collectionTypedView"===e||"collectionView"===e){var t,o;const e=n.collectionViewBlockStore(),i=n.collectionStore();if(!e||!i)return{type:"collection",candidateBlockStores:[]};const r=n.normalizedFormatStore.state,a="board"===n.getViewType()?{groupByKey:"board_columns_by",groupsFormatKey:"board_columns"}:{groupByKey:"collection_group_by",groupsFormatKey:"collection_groups"},l=n.normalizedSchemaStore.state,s=r[a.groupByKey],c=(0,k.$K)(s)?(0,ra.Qq)({schema:l,groupBy:s}):[],d=Object.values((null===(t=n.localResultStore.state)||void 0===t?void 0:t.reducerResults)??{}).find((e=>"groups"===e.type)),u=(0,la.Cz)({getRecordModel:e.getRecordModel,schema:l,groupBy:s,formatGroups:r[a.groupsFormatKey]??[],schemaGroups:c,reducerResults:(null==d?void 0:d.results)??[],relativeVariableResult:n.relativeVariableStore.state,viewAppConfigUri:null===(o=n.collectionViewStore())||void 0===o?void 0:o.getFormat().app_config_uri});let p,g;if(0===u.length){const e=n.localResultStore.state;if(e){const t=Object.values(e.reducerResults).find((e=>"results"===e.type));p=((null==t?void 0:t.blockIds)??[]).map((e=>co.G.createChildStore(i,{table:"block",id:e})))}else p=[]}else{p=[];for(const e of u){const t=n.groupsStore.getGroupState(e),o=null==t?void 0:t.resultsStore.state;p.push(...o??[])}}if(p=O().uniqBy(p,(e=>e.id)),n.currentSubitemFormatStore.state){g=[];const e=n.subitemTreeStore.state;for(const t of p){if(g.length>=5)break;const o=e.children.find((e=>e.value.store.id===t.id));if(o){const e=[];(0,xs.yU)({results:e,tree:o}),g.push(...e)}}}else g=p;return{type:"collection",candidateBlockStores:g.slice(0,5)}}throw new Error(`Unexpected context type: ${e}`)}),[n]),v=(0,l.useCallback)((()=>{var e;u.qG2(t,{ai_inference_type:g.type,type:"undo_from_collection_settings",inference_id:m,collection_id:null===(e=n.collectionStore())||void 0===e?void 0:e.id,session_id:S.current}),"not_started"!==f&&(_s.Yw(t,!1),r.setState({stage:"not_started"}))}),[t,g,m,n,f,r]),b=(0,k.Of)(h.candidateBlockStores),C=Us({isTryAutofillEnabled:o&&b});if(t.device.isMobile)return null;if(!(0,ce.q3)(s))return null;let M;return M=b?"collection"===h.type?i()(d.FormattedMessage,{defaultMessage:"Updates the first {maxPages} pages. You can undo changes anytime.",id:"database.viewSettings.propertyTab.aiAutofill.tryOnCollectionDescription",values:{maxPages:5}}):i()(d.FormattedMessage,{defaultMessage:'Updates "{propertyName}" on this page. You can undo changes anytime.',id:"database.viewSettings.propertyTab.aiAutofill.tryOnPageDescription",values:{propertyName:s.name}}):i()(d.FormattedMessage,{defaultMessage:"Add more pages or remove filters to try AI on this view.",id:"database.viewSettings.propertyTab.tryAutofillDisabledDescription"}),i()(l.Fragment,{},void 0,i()("div",{style:{margin:"8px 12px"}},void 0,i()(Is.X2,{gap:8},void 0,i()(Pt.Z,{disabled:!o||!b,style:{...C.buttonStyle,...C.undoButtonStyle,..."not_started"===f&&{display:"none"}},onClick:v},void 0,i()(d.FormattedMessage,{defaultMessage:"Undo",id:"database.viewSettings.propertyTab.aiAutofill.undoButton"})),i()(St.Z,{renderTooltip:()=>i()("div",{},void 0,M),render:e=>l.createElement(Pt.Z,a()({},e,{disabled:!o||!b,style:{...C.buttonStyle,...C.tryButtonStyle},hoveredStyle:C.tryButtonHoveredStyle,pressedStyle:C.tryButtonPressedStyle,onClick:async()=>{if((0,k.Of)(h.candidateBlockStores)){const e=(0,c.ZP)();y(e),r.setState({stage:"in_progress"}),await Ms.CA({environment:t,stores:h.candidateBlockStores,property:p,propertySchema:s,aiInferenceOverride:g,userEventForAnalytics:"generate_from_try_on_view_button",sessionIdForAnalytics:S.current,collectionContextStore:n,from:"ai_autofill_settings"}),r.setState({stage:"complete"})}}}),"in_progress"===f?i()(Zs.Z,{}):l.createElement(l.Fragment,null,_.Z.magicWand({width:16,..."not_started"!==f&&{display:"none"}}),"not_started"!==f?i()(d.FormattedMessage,{defaultMessage:"Try again",id:"database.viewSettings.propertyTab.aiAutofill.tryAgain"}):"collection"===h.type?i()(d.FormattedMessage,{defaultMessage:"Try on this view",id:"database.viewSettings.propertyTab.aiAutofill.tryOnCollection"}):i()(d.FormattedMessage,{defaultMessage:"Try on this page",id:"database.viewSettings.propertyTab.aiAutofill.tryOnPage"})))}))))}function zs(e){let{environment:t,aiInference:o,setAiInference:n,collectionContextStore:r,isAutofillSetupEnabled:a,shouldShowUserPromptIsInvalidError:s,setShouldShowUserPromptIsInvalidError:c}=e;window.__c={n:"AiAutofillPromptInputMenuItem"};const u=function(e){if(e)switch(e.type){case"summarize":case"translate":return;case"extract":return{aiInferenceType:e.type,sectionTitle:Es.extractPromptSectionTitle,inputPlaceholder:Es.extractPromptInputPlaceholder,value:e.prompt};case"custom":return{aiInferenceType:e.type,sectionTitle:Es.customPromptSectionTitle,inputPlaceholder:Es.customPromptInputPlaceholder,value:e.prompt};default:(0,k.t1)(e)}}(o),p=(0,w.VK)((()=>(0,Ve.k4)()),[]),g=(0,l.useCallback)((e=>{r.collectionStore()&&u&&(e.target.value&&e.target.value.length<=bs?c(!1):e.target.value.length>bs&&c(!0),n({type:u.aiInferenceType,prompt:e.target.value,auto_update_on_edit:(null==o?void 0:o.auto_update_on_edit)??p}))}),[null==o?void 0:o.auto_update_on_edit,r,p,u,n,c]);return u?i()(E.Z,{title:Fe.default.formatMessage(u.sectionTitle),isInput:!0,style:{marginTop:-4}},void 0,i()(Bs.Z,{capture:!0,allowEsc:!0},void 0,i()(Ee.ZP,{inputOuterStyle:{margin:t.device.isMobile?"8px 0":0,border:s?"1px solid red":void 0},type:"text",value:u.value,onChange:g,placeholder:Fe.default.formatMessage(u.inputPlaceholder),textarea:!0,disabled:!a,autosize:!0,autosizeMinHeight:100,autosizeMaxHeight:600},u.aiInferenceType)),s&&i()("div",{style:{display:"flex",alignItems:"center",paddingLeft:12,fontSize:12}},void 0,_.Z.warning({width:12,height:12,fill:"#D34F43"}),i()("div",{style:{color:"#D34F43",paddingLeft:4}},void 0,u.value.length>bs?i()(d.FormattedMessage,{defaultMessage:"Instruction is too long",id:"CollectionSettings.propertyTab.aiAutofill.promptInput.exceedsMaxLength"}):i()(d.FormattedMessage,{defaultMessage:"Required",id:"CollectionSettings.propertyTab.aiAutofill.promptInput.required"})))):null}function Us(e){const t=(0,M.Fg)();return(0,M.yK)((()=>({buttonStyle:{flexGrow:1,display:"flex",alignItems:"center",justifyContent:"center",gap:8},menuItemStyle:{fontSize:13,borderRadius:6,background:t.accentColors.purple[50],color:t.accentColors.purple[500],margin:"8px 12px",padding:"8px 12px"},undoButtonStyle:{border:`1px solid ${t.accentColors.gray[100]}`,flex:1},tryButtonStyle:{fontWeight:500,flex:1,background:null!=e&&e.isTryAutofillEnabled?"light"===t.mode?t.accentColors.purple[50]:t.accentColors.purple[200]:t.accentColors.gray[50],color:null!=e&&e.isTryAutofillEnabled?t.aiPurpleColor:t.accentColors.gray[400]},fillAllPagesWandIconStyle:{fill:t.aiPurpleColor},tryButtonHoveredStyle:{background:t.accentColors.purple[100]},tryButtonPressedStyle:{background:t.accentColors.purple[200]},confirmDiscardChangesDialogIconStyle:{width:32,height:32,fill:t.aiPurpleColor,paddingTop:8},confirmDiscardChangesDialogMessageStyle:{textAlign:"center",fontWeight:500}})),[t,null==e?void 0:e.isTryAutofillEnabled])}var Hs=o(90468),$s=o(29369),qs=o(16173),js=o(29637);const Ys=(0,d.defineMessages)({upgradeButton:{id:"appTemplateUpgradeActions.upgradeConfirmationDialog.upgrade.label",defaultMessage:"Upgrade"},cancelUpgradeButton:{id:"appTemplateUpgradeActions.upgradeConfirmationDialog.cancelUpgrade.label",defaultMessage:"Don't upgrade"}});async function Qs(e){const{environment:t,collectionViewBlockStore:o,collectionSettingsStore:n}=e,r=null==o?void 0:o.getFormat().app_config_uri,a=null==o?void 0:o.getParentStore();if(!o||r!==$r.TZ&&r!==$r.pz)return!1;const s=r===$r.TZ?o:await Wa.JN({environment:t,collectionViewBlockStore:o,databaseUri:$r.iS}),c=r===$r.pz?o:await Wa.JN({environment:t,collectionViewBlockStore:o,databaseUri:$r.p$});return!(!(s&&c&&a)||a.table!==Hs.bx&&a.table!==jt.iU&&a.table!==$s.e0)&&(ye.showDialog({message:l.createElement(l.Fragment,null,i()("div",{},void 0,"Upgrade Existing Sprints to Latest?"),i()("div",{style:{fontSize:12,padding:8}},void 0,"This will update your Sprints Database, and change some existing views and properties.")),items:[{label:Fe.default.formatMessage(Ys.upgradeButton),color:"red",onAccept:async()=>{await async function(e){var t;const{environment:o,appParentStore:n,collectionViewBlockStore:i}=e,r=null===(t=i.getFormat())||void 0===t?void 0:t.app_uri_map,a=i.getCollectionStore();if(!r||!a)return;const l=await Xs(i,n),s=(0,ce.oC)({format:a.getFormat(),space_id:a.getSpaceId(),schema:a.getSchema()});m.createAndCommit({userAction:"appTemplateActions.upgradeSprintsDatabaseFromV1ToV2",environment:o,perform:e=>{me.Rm({environment:o,collectionStore:a,update:Js[$r.p$](s,a.getFormat()),transaction:e}),l.forEach((t=>{const o=t.id,n=t.getFormat(),i=t.getQuery(s);r["notion://sprints/sprints_timeline_view"]===o?me.iG({collectionViewStore:t,update:Js["notion://sprints/sprints_timeline_view"](n,i),transaction:e}):r["notion://sprints/sprints_view"]===o&&me.iG({collectionViewStore:t,update:Js["notion://sprints/sprints_view"](n,i),transaction:e})}))}})}({environment:t,appParentStore:a,collectionViewBlockStore:c}),await async function(e){var t;const{environment:o,appParentStore:n,collectionViewBlockStore:i}=e,r=null===(t=i.getFormat())||void 0===t?void 0:t.app_uri_map;if(!r)return;const a=await Xs(i,n);m.createAndCommit({userAction:"appTemplateActions.upgradeTasksDatabaseSprintsFeatureFromV1ToV2",environment:o,perform:e=>{a.forEach((t=>{const o=t.id,n=t.getFormat();if(r[$r.g3]===o){const o=Js[$r.g3](n);me.iG({collectionViewStore:t,update:o,transaction:e})}else r[$r.y$]===o&&me.iG({collectionViewStore:t,update:Js[$r.y$](n),transaction:e})}))}})}({environment:t,appParentStore:a,collectionViewBlockStore:s}),n.setState({open:!1,stack:[]})}},{label:Fe.default.formatMessage(Ys.cancelUpgradeButton),onAccept:()=>{}}],showCancel:!1,keepFocus:!0}),!0)}async function Xs(e,t){return await Promise.all(e.getCollectionViewPointers().map((async e=>{const o=co.Xr.createChildStore(t,e);return await o.load(),o})))}const Js={[$r.g3]:e=>({name:Fe.default.formatMessage(js.sY.tasksCurrentSprintV2ViewName),format:{...e,property_filters:[...(e.property_filters??[]).filter((e=>e.filter.property!==$r.Es.SprintStatusRollup)),js.Aq]}}),[$r.y$]:e=>({format:{...e,property_filters:[...(e.property_filters??[]).filter((e=>e.filter.property!==$r.Es.TaskToSprintRelation))],table_properties:[...(e.table_properties??[]).filter((e=>e.property!==$r.Es.SprintStatusRollup)),{property:$r.Es.SprintStatusRollup,visible:!1}]}}),[$r.p$]:(e,t)=>({schema:{...e,[$r.b0.UniqueId]:qs.eK(Fe.default.getIntl())[$r.b0.UniqueId],[$r.b0.TotalTasksRollup]:js.X$,[$r.b0.CompletedTasksRollup]:js.sU,[$r.b0.StatusV2]:qs.eK(Fe.default.getIntl())[$r.b0.StatusV2]},format:{...t,app_uri_map:{...(null==t?void 0:t.app_uri_map)||{},[$r.b0.UniqueId]:$r.b0.UniqueId,[$r.b0.TotalTasksRollup]:$r.b0.TotalTasksRollup,[$r.b0.CompletedTasksRollup]:$r.b0.CompletedTasksRollup,[$r.b0.StatusV2]:$r.b0.StatusV2}}}),"notion://sprints/sprints_timeline_view":(e,t)=>({format:{...e,table_properties:[...(e.table_properties??[]).filter((e=>e.property!==$r.b0.Status)),{width:147,visible:!1,property:$r.b0.Status},{width:147,visible:!0,property:$r.b0.StatusV2}],timeline_table_properties:[...(e.timeline_table_properties??[]).filter((e=>e.property!==$r.b0.Status)),{width:132,visible:!1,property:$r.b0.Status},{width:132,visible:!0,property:$r.b0.StatusV2}],collection_group_by:{sort:{type:"ascending"},type:"status",groupBy:"group",property:$r.b0.StatusV2}},query2:{...t??{},sort:[...(null==t?void 0:t.sort)??[],{property:$r.b0.StatusV2,direction:"ascending"}]}}),"notion://sprints/sprints_view":(e,t)=>({format:{...e,table_properties:[...(e.table_properties??[]).filter((e=>e.property!==$r.b0.Status)),{width:137,visible:!1,property:$r.b0.Status},{width:137,visible:!0,property:$r.b0.StatusV2},{width:75,visible:!0,property:$r.b0.TotalTasksRollup}],collection_group_by:{sort:{type:"ascending"},type:"status",groupBy:"group",property:$r.b0.StatusV2}},query2:{...t??{},sort:[...(null==t?void 0:t.sort)??[],{property:$r.b0.StatusV2,direction:"ascending"}]}})};var ec=o(90559),tc=o(10070),oc=o(87085);function nc(e){var t,o;const{render:n,showDisabledTooltip:r,property:a,overrideCaption:l}=e;let s=a.description;if(l)s=l;else if(r){var c;s=null===(c=a.canOnlyAdminAuth)||void 0===c?void 0:c.disabledPropertyTooltipMessage}return i()(ht,{render:n,showImage:!r,caption:s,tooltipImage:null===(t=a.tooltipImage)||void 0===t?void 0:t.img,tooltipImageScale:null===(o=a.tooltipImage)||void 0===o?void 0:o.scale})}var ic=o(54119),rc=o(15560),ac=o(14871),lc=o(95477);var sc=o(69834),cc=o(32363);var dc=o(33954),uc=o(85644),pc=o(12205);const gc=(0,d.defineMessages)({duplicateGithubPropertyTooltip:{defaultMessage:"A database can only have one GitHub Pull Requests property",id:"database.viewSettings.propertyTab.duplicateGithubProperty.tooltip"},wikiGithubPropertyTooltip:{defaultMessage:"A wiki cannot have a GitHub Pull Requests property",id:"database.viewSettings.propertyTab.wikiGithubProperty.tooltip"},syncedDatabaseGithubPropertyTooltip:{defaultMessage:"A synced database cannot have a GitHub Pull Requests property",id:"database.viewSettings.propertyTab.syncedDatabaseGithubProperty.tooltip"},newPill:{defaultMessage:"New",id:"database.viewSettings.newHighlightedFeature"}});function mc(e){let{collectionContextStore:t,propertyTypes:o,onAccept:n,propertySchema:r}=e;const s=(0,M.Fg)(),c=(0,w.VK)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.getSchema()}),[t]),d=(0,w.VK)((()=>t.collectionViewBlockStore()),[t]),u=l.useCallback((()=>{if(!(0,uc.iL)()||null==d||!d.isCollectionViewPageWithContent()||r&&"verification"!==r.type)return!1;for(const e in c){const t=c[e];if("verification"===(null==t?void 0:t.type))return!1;if((0,Lt.Kp)(t))return!1}return!0}),[r,c,d]),p=l.useCallback((()=>{for(const t in c){var e;const o=c[t];if("text"===(null==o?void 0:o.type)&&"summarize"===(null===(e=o.ai_inference)||void 0===e?void 0:e.type))return!1}return!0}),[c]);return{standardAndDerivedPropertyTypes:(0,w.VK)((()=>o.filter((e=>"button"===e?(0,Xa.PN)():"auto_increment_id"===e?so.default.checkGate("unique_id"):"verification"===e?u():"ai_summary"===e?p():"ai_translate"!==e||(0,Ts.hu)()))),[o,u,p]),renderStandardOrDerivedProperty:l.useCallback(((e,o)=>({key:e,render:n=>{const c=(null==r?void 0:r.type)===e,d=function(e,t,o){if("auto_increment_id"===t){var n;const t=e.collectionStore(),i=null==t?void 0:t.isPageTreeCollection(),r=Boolean(null==t?void 0:t.isSyncedCollection());if(i)return Fe.default.formatMessage(dc.zU.wiki_forbidden_auto_increment_id_property);if(r)return Fe.default.formatMessage(dc.zU.synced_database_forbidden_auto_increment_id_property);if(null!=o&&o.type)return Fe.default.formatMessage(dc.zU.convert_to_auto_increment_id_property);const a=t&&t.getFormat(),l=t&&(null===(n=t.getSpaceStore())||void 0===n?void 0:n.id),s=t&&t.getSchema(),c=t&&t.getDeletedSchema();if(!(a&&l&&s&&c))return;if(t&&(0,ec.cj)({format:a,space_id:l,schema:s,deleted_schema:c}))return Fe.default.formatMessage(dc.zU.duplicate_auto_increment_id_property)}}(t,e,r),u=void 0!==d,p=l.createElement(Ze.Z,a()({},n,{checkState:c,title:i()("div",{style:{display:"inline-flex",alignItems:"center"}},void 0,o??Ve.SO[e],!1),icon:i()(xn.ZP,{type:e,icon:void 0,size:16,theme:s,style:{fill:(0,ce.XU)(e)?s.aiPurpleColor:s.regularIconColor}}),disabled:u,disabledFeedback:u}));return d?i()(St.Z,{placement:St.Z.Placement.Left,render:e=>l.createElement("div",e,p),renderTooltip:()=>d,style:{whiteSpace:"break-spaces"}}):p},action:()=>{n(e,o)}})),[r,t,s,n])}}const yc=new Set([hi.Nw]);function Sc(e,t){const o=(0,C.O7)(),n=(0,d.useIntl)(),r=(0,w.VK)((()=>Zt.Z.bots.state),[]),s=(0,w.VK)((()=>e.collectionStore()),[e]),c=(0,w.VK)((()=>null==s?void 0:s.getSchema()),[s]),u=(0,w.VK)((()=>null==s?void 0:s.isPageTreeCollection()),[s]),p=(0,w.VK)((()=>{if(void 0===t)return function(e){if(!e)return[];const t=so.default.checkGate("google_drive_connected_relation"),o=so.default.checkGate("figma_connected_relation"),n=so.default.checkGate("zendesk_connected_relation"),i=so.default.checkGate("connected_relation"),r=e.getFormat().app_config_uri===$r.iS,a=Zt.Z.state;if(!a.loaded)return[];const l=a.integrations,s={};if(!r){const e=l.find((e=>e.id===hi.U9)),t=(0,js.GT)();var c;e&&(s[t.name]={name:t.name,pattern:sc.x,integration:e,tooltipImage:{img:gt.Z.images.tooltips.properties.githubSyncPullStatusPng,scale:.5},description:t.description,canOnlyAdminAuth:{disabledPropertyTooltipMessage:null===(c=t.canOnlyAdminAuth)||void 0===c?void 0:c.disabledPropertyTooltipMessage}})}const d=[];if(t&&d.push(hi.f3),o&&d.push(hi.mQ),n&&d.push(hi.Nw),d.forEach((e=>{const t=l.find((t=>t.id===e));if(null!=t&&t.info.original_url_patterns)for(const n of t.info.original_url_patterns){var o;null!==(o=n.additional_types)&&void 0!==o&&o.connectedRelation&&(s[n.name]||(s[n.name]={name:(0,cc.ni)({pattern:n,integration:t}),pattern:n,integration:t}))}})),!i)return Object.values(s);for(const p of l)if(p.info.original_url_patterns&&![hi.U9,hi.f3,hi.mQ].includes(p.id))for(const e of p.info.original_url_patterns){var u;null!==(u=e.additional_types)&&void 0!==u&&u.connectedRelation&&(s[e.name]||(s[e.name]={name:(0,cc.ni)({pattern:e,integration:p}),pattern:e,integration:p}))}return Object.values(s)}(s)}),[s,t]),g=(0,w.VK)((()=>Boolean(null==s?void 0:s.isSyncedCollection())),[s]),m=(0,pc.J)();return{connectedRelationProperties:p,renderConnectedRelationProperty:l.useCallback((t=>{const s=t.integration.id,d=Boolean(r.find((e=>e.integration_id===s))),p=Boolean(t.canOnlyAdminAuth),y=Boolean(c&&(0,k.qP)(c).find((e=>{let[t,o]=e;return o&&(0,Lt.Kp)(o)}))),S=t.integration.id===hi.U9&&y||u||g;let f;S&&(y?f=n.formatMessage(gc.duplicateGithubPropertyTooltip):u?f=n.formatMessage(gc.wikiGithubPropertyTooltip):g&&(f=n.formatMessage(gc.syncedDatabaseGithubPropertyTooltip)));const h=(0,Lt.gi)(d,m,p,o.device.isMobile)||S;return{key:t.name,render:e=>i()(nc,{showDisabledTooltip:h,property:t,overrideCaption:f,render:o=>l.createElement(Ze.Z,a()({},e,o,{checkState:!1,title:i()("div",{style:{display:"inline-flex",alignItems:"center"}},void 0,t.name,yc.has(t.integration.id)?i()(Ia.Z,{}):null),icon:i()("img",{src:t.integration.info.icon,alt:t.name,style:{width:16,height:16}}),disabled:h,disabledFeedback:h}))}),action:async()=>{await oc.Jw({environment:o,connectedRelationProperty:t,collectionContextStore:e,intl:n})}}}),[r,c,u,g,m,o,n,e])}}const fc=(0,d.defineMessages)({searchPlaceholder:{defaultMessage:"Search or add new property",id:"database.viewSettings.propertyTypeSelect.searchPlaceholder"},suggestedSectionTitle:{defaultMessage:"Suggested",id:"database.viewSettings.propertyTypeSection.suggested"},connectedRelationSectionTitle:{defaultMessage:"Connections",id:"database.viewSettings.propertyTypeSection.connected"},typesSectionTitle:{defaultMessage:"Type",id:"database.viewSettings.propertyTab.propertyType"},newProperty:{defaultMessage:"New property",id:"database.viewSettings.newProperty"},newPropertyWithDatabaseName:{defaultMessage:"New property on {databaseName}",id:"database.viewSettings.newPropertyOnDatabase"},selectToAddNewProperty:{defaultMessage:"Select to add",id:"database.viewSettings.selectToAdd"}});function hc(e){window.__c={n:"CollectionSettingsPropertyType"};const t=(0,C.Fy)(),[o,n]=l.useState(""),{collectionContextStore:r,propertyTypes:s,onAccept:c,propertySchema:d}=e,u=(0,C.O7)(),p=(0,w.VK)((()=>{var e;return null==r||null===(e=r.collectionStore())||void 0===e||null===(e=e.getName())||void 0===e?void 0:e.toString()}),[r]),{connectedRelationProperties:g,renderConnectedRelationProperty:m}=Sc(e.collectionContextStore,e.propertySchema),{standardAndDerivedPropertyTypes:y,renderStandardOrDerivedProperty:S}=mc({collectionContextStore:r,propertyTypes:s,onAccept:c,propertySchema:d}),{suggestedProperties:f,renderSuggestedProperty:h}=function(e){let{collectionContextStore:t,propertySchema:o}=e;const n=(0,C.O7)(),r=(0,M.Fg)(),s=(0,w.VK)((()=>t.collectionStore()),[t]),c=(0,w.VK)((()=>{if(s)return s.getParentBlockStore()}),[s]),d=(0,w.VK)((()=>Zt.Z.bots.state),[]),u=(0,w.VK)((()=>{var e;if(!s)return;const t=null===(e=s.getFormat())||void 0===e?void 0:e.app_config_uri;return t?(0,xt.vi)(t):void 0}),[s]),p=(0,w.VK)((()=>{if(s&&c&&u&&void 0===o)return s.isDefined()?(0,xt.K5)(n,u,{format:s.getFormat(),space_id:s.getSpaceId(),schema:s.getSchema()}):void 0}),[s,c,u,o,n]),g=(0,pc.J)();return{suggestedProperties:p,renderSuggestedProperty:l.useCallback((e=>{const o=e.integrationId,c=Boolean(d.find((e=>e.integration_id===o))),p=Boolean(e.canOnlyAdminAuth),m=(0,Lt.gi)(c,g,p,n.device.isMobile),y=(e,t,o,n)=>{const c=tc.aQ.deriveTypeUris((null==s?void 0:s.getSchema())??{},null==s?void 0:s.getPropertyMapping()),d=o.dependencies.find((e=>{var t;return"property"===e.type&&e.collectionUri===(null==s||null===(t=s.getFormat())||void 0===t?void 0:t.app_config_uri)&&(0,$r.jP)(e.uri)&&!c.has(e.uri)})),u=o.dependencies.find((e=>"property"===e.type&&(0,ce.q3)(e.propertySchema)));if(d)return l.createElement(Ze.Z,a()({},e,{disabled:m,disabledFeedback:m,title:i()("div",{style:{display:"inline-flex",alignItems:"center"}},void 0,t,u?i()(ic.Z,{}):null,o.isNew?"notion://projects/tasks_with_sprints_feature"===o.uri&&(0,xt.wY)()?i()(rc.Z,{}):i()(Ia.Z,{}):null),icon:i()(xn.ZP,{type:d.propertySchema.type,theme:r,icon:n,size:16,style:{fill:r.regularIconColor}})}))};return{key:e.name,render:o=>i()(nc,{showDisabledTooltip:m,property:e,render:r=>{if((0,xt.oX)(e))return y({...o,...r,onMouseEnter:e=>{var t,n;null===(t=r.onMouseEnter)||void 0===t||t.call(r,e),null===(n=o.onMouseEnter)||void 0===n||n.call(o,e)}},e.name,e,e.icon);{const s=O().compact(e.variants.map((e=>{const t=null==u?void 0:u.allFeatures.find((t=>t.uri===e));if(t&&(0,xt.oX)(t))return t})));return i()(ac.Z,{items:s,getKey:e=>e.name,onSelect:async e=>{await oc.G0({environment:n,feature:e,collectionContextStore:t})},selectedItem:void 0,renderOrigin:t=>y({...o,...r,...t,onMouseEnter:e=>{var t,n;null===(t=r.onMouseEnter)||void 0===t||t.call(r,e),null===(n=o.onMouseEnter)||void 0===n||n.call(o,e)}},e.name,s[0],e.icon),renderItem:e=>l.createElement(Ze.Z,a()({},e,{title:e.value.name,shouldWrapCaption:!0,shouldWrapTitle:!0}))})}}}),action:async()=>{await oc.G0({environment:n,feature:e,collectionContextStore:t})}}}),[d,g,n,s,r,null==u?void 0:u.allFeatures,t])}}({collectionContextStore:e.collectionContextStore,propertySchema:e.propertySchema}),{derivedPropertyTypesInSuggestedSection:v}=(0,l.useMemo)((()=>{const e=new Set;for(const t of y)(0,ce.XU)(t)&&"suggested"===(0,Ve.to)(t)&&e.add(t);return{derivedPropertyTypesInSuggestedSection:e}}),[y]);l.useEffect((()=>{!async function(){const e=await Wa.DY(u,r);_(e)}()}),[r,u]);const[b,_]=(0,l.useState)(!1),x=l.useCallback((async()=>{await Qs({environment:u,collectionViewBlockStore:r.collectionViewBlockStore(),collectionSettingsStore:e.collectionSettingsStore})}),[r,u,e.collectionSettingsStore]),T=(0,l.useMemo)((()=>new Map(y.map((e=>[Ve.SO[e],e])))),[y]);let P=[];if(""!==o){const e=(null==f?void 0:f.reduce(((e,t)=>(e[t.name]=h(t),e)),{}))||{};for(const o of v)e[Ve.SO[o]]=S(o);const t=(null==g?void 0:g.reduce(((e,t)=>(m&&(e[t.name]=m(t)),e)),{}))||{},n=Pe().filter(o,Object.keys(e)).flatMap((t=>e[t.original])),i=Pe().filter(o,Array.from(T.keys())).flatMap((e=>{const t=T.get(e.original);return!t||v.has(t)?[]:S(t)})),r=Pe().filter(o,Object.keys(t)).flatMap((e=>t[e.original]));n.length&&P.push({key:"suggested",render:e=>l.createElement(E.Z,a()({},e,{title:Fe.default.formatMessage(fc.suggestedSectionTitle)})),items:n}),i.length&&P.push({key:"search",render:e=>l.createElement(E.Z,a()({title:Fe.default.formatMessage(fc.typesSectionTitle)},e)),items:i}),r.length&&P.push({key:"connected",render:e=>l.createElement(E.Z,a()({},e,{title:Fe.default.formatMessage(fc.connectedRelationSectionTitle)})),items:r}),0===n.length&&0===i.length&&P.push({key:"custom",render:e=>l.createElement(E.Z,a()({},e,{title:Fe.default.formatMessage(fc.selectToAddNewProperty)})),items:[S("text",o)]})}else{const e=(null==f?void 0:f.map((e=>h(e))))??[];for(const n of v)e.push(S(n));const t=y.map((e=>v.has(e)?void 0:S(e))).filter(k.$K),o=(null==g?void 0:g.map((e=>m&&m(e))).filter(k.$K))??[];P=O().compact([e.length&&{key:"suggested",render:e=>l.createElement(E.Z,a()({},e,{title:Fe.default.formatMessage(fc.suggestedSectionTitle)})),items:e},t.length&&{key:"properties",render:e=>l.createElement(E.Z,a()({},e,{title:Fe.default.formatMessage(fc.typesSectionTitle)})),items:t},o.length&&{key:"connected",render:e=>l.createElement(E.Z,a()({},e,{title:Fe.default.formatMessage(fc.connectedRelationSectionTitle)})),items:o}])}const A=i()(E.Z,{desktopStyle:{paddingTop:12,paddingBottom:4}},void 0,i()(Ee.ZP,{focusInitial:!t.isMobile||void 0,focus:!t.isMobile||void 0,value:o,onChange:e=>{n(e.target.value)},placeholder:Fe.default.formatMessage(fc.searchPlaceholder)}));return l.createElement(F.ZP,a()({},e,{title:t.isDesktop&&p?Fe.default.formatMessage(fc.newPropertyWithDatabaseName,{databaseName:p}):Fe.default.formatMessage(fc.newProperty)}),A,b&&i()(B.Z,{style:{border:"1px solid #b3d4fc",borderRadius:5,margin:"3px 11px",padding:7,fontSize:14,color:"rgba(35, 131, 226, 1)",boxShadow:"2px 2px 3px 0px #b3d4fc",cursor:"pointer",marginTop:10},onClick:x},void 0,"üèÉ New Sprints üí®",i()("div",{style:{fontSize:11}},void 0,"Upgrade V1 to V2!!!")),i()(De.Z,{disableInitialScroll:!0,type:De.i.Vertical,initialFocus:0,sections:P}))}var vc=o(34296);class bc extends s.Z{constructor(){super(...arguments),this.searchSessionId="",this.handleSourcePickerAccept=e=>{const{collectionContextStore:t,collectionSettingsStore:o,property:n,formatKey:i}=this.props;if(!t.collectionStore())return;pe.wd({environment:this.environment,collectionContextStore:t,action:"select_relation_source"});const{stack:r}=o.state,a=r[r.length-2];a&&"setupRelation"===a.type&&p.z$({collectionSettingsStore:o}),p.FK({collectionSettingsStore:o,item:{type:"setupRelation",property:n,formatKey:i,targetCollectionPointer:e.pointer}})}}renderComponent(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=e.collectionViewBlockStore();if(!o)return;const n=Un.default.createValue("");return l.createElement(F.ZP,a()({},this.props,{title:i()(d.FormattedMessage,{defaultMessage:"Related to",id:"database.viewSettings.selectNewRelationSourceTab.title"}),handleClose:()=>{pe.tW({environment:this.environment,eventName:"abandoned_search",queryLength:n.state.length,sessionId:this.searchSessionId,source:vc.S.Relation}),p.E3({collectionSettingsStore:t})}}),i()(Yn.Z,{collectionContextStore:e,onAccept:this.handleSourcePickerAccept,parentStore:o,context:vc.S.Relation,searchSessionId:this.searchSessionId,inputStore:n}))}willMount(){this.searchSessionId=(0,c.ZP)()}}bc.displayName="CollectionSettingsSelectRelationSource";const Cc=(0,d.injectIntl)(bc);function wc(e){window.__c={n:"CollectionSettingsSetDBType"};const t=(0,C.O7)().device.isMobile,{collectionContextStore:o,collectionSettingsStore:n}=e,r=(0,w.VK)((()=>o.collectionStore()),[o]),s=(0,w.VK)((()=>{const e=null==r?void 0:r.getDatabaseType();return e?$r.pX[e]:"untyped"}),[r]),[c,u]=(0,l.useState)(s),g=(0,w.VK)((()=>o.permissionScopes.state),[o]),m=(0,M.yK)((e=>({databaseTypeButton:{display:"flex",flexDirection:"column",alignItems:"center",width:"calc(33% - 12px)",flexGrow:0,flexShrink:0,fontSize:11,borderRadius:3,margin:6,padding:6,boxShadow:`0 0 0 1px ${e.regularDividerColor}`,color:e.mediumTextColor,fill:e.mediumTextColor},selectedType:{boxShadow:`0 0 0 2px ${e.blueColor}`,color:e.blueColor,fill:e.blueColor,fontWeight:500},databaseTypeIcon:{width:void 0,height:20,marginBottom:4,marginTop:4},continueButton:{display:"flex",margin:"14px",height:32},typeBenefits:{fontSize:12,color:e.mediumTextColor},databaseTypesContainer:{background:t?e.contentBackground:void 0,width:"100%",paddingTop:t?12:void 0,paddingBottom:t?12:void 0,paddingLeft:t?void 0:8,paddingRight:t?void 0:8}})),[t]),y=()=>{const e=qr.JX[c];return 0===e.length?null:l.createElement(l.Fragment,null,i()(E.Z,{topBorder:!1,shouldShowBottomDivider:t,title:i()(d.FormattedMessage,{defaultMessage:"What you get...",id:"database.viewSettings.databaseTypeSelectionTab.benefitsTitle"})},void 0,i()("div",{style:{marginLeft:14,marginTop:15}},void 0,e.map(((e,t)=>i()("div",{style:{display:"flex",paddingBottom:15}},t,i()("div",{style:{paddingRight:8}},void 0,e.icon({width:14})),i()("span",{style:m.typeBenefits},void 0,e.message)))))),"untyped"!==s&&i()(E.Z,{topBorder:!0},void 0,i()(I.Z,{isGray:!0,icon:_.Z.trash,title:i()(d.FormattedMessage,{defaultMessage:"Remove {type} database",id:"database.viewSettings.databaseTypeSelectionTab.removeTypeDatabase",values:{type:qr.kd[s]}}),onClick:()=>{}})))},S=e=>{const t=c===e,o=t||!g.canConfigureBlock;return i()(B.Z,{style:{...m.databaseTypeButton,...t&&m.selectedType},disabled:o,onClick:()=>{(e=>{u(e)})(e)}},void 0,qr.by[e](m.databaseTypeIcon),i()("div",{},void 0,qr.kd[e]))},f=["untyped","tasks","projects"];return l.createElement(F.ZP,a()({},e,{title:i()(d.FormattedMessage,{defaultMessage:"Database type",id:"database.viewSettings.databaseTypeSelectionTab.title"})}),"untyped"!==s&&i()(E.Z,{topBorder:!1,shouldShowBottomDivider:t,title:i()(d.FormattedMessage,{defaultMessage:"Current database type",id:"database.viewSettings.databaseTypeSelectionTab.currentTypeTitle"}),style:{paddingBottom:15}},void 0,i()("div",{style:{display:"flex",alignItems:"center",paddingLeft:20}},void 0,i()("div",{},void 0,qr.by[s]({width:13,height:13,marginRight:8})),i()("span",{style:{fontSize:14}},void 0,qr.kd[s]))),"untyped"!==s?y():l.createElement(l.Fragment,null,i()(E.Z,{topBorder:!1,shouldShowBottomDivider:t},void 0,i()("div",{style:m.databaseTypesContainer},void 0,i()("div",{style:{display:"flex",flexFlow:"wrap",justifyContent:"center"}},void 0,f.map(S)))),y(),"untyped"!==c&&i()(fe.Z,{style:m.continueButton,onClick:()=>{p.H4({collectionSettingsStore:n,item:{type:"databaseTypePropertyMapping",databaseType:c}})}},void 0,i()(d.FormattedMessage,{defaultMessage:"Continue",id:"database.viewSettings.databaseTypeSelectionTab.continue"})),i()(E.Z,{topBorder:!1},void 0,i()(ua.Z,{href:(0,sa.UY)("guides.databaseType"),title:i()(d.FormattedMessage,{defaultMessage:"Learn about {type} databases",id:"database.viewSettings.databaseTypeSelectionTab.learnMoreButton.title",values:{type:"untyped"!==c?qr.kd[c]:"typed"}}),analyticsFrom:"set_database_type"}))))}var Mc=o(71554),_c=o(79892);function kc(e){window.__c={n:"CollectionSettingsSetupRelation"};const{collectionContextStore:t,collectionSettingsStore:o,property:n,formatKey:r,targetCollectionPointer:s,from:c}=e,u=(0,w.VK)((()=>t.collectionStore()),[t]),y=(0,w.VK)((()=>{const e=t.collectionViewBlockStore();return function(e){const{targetCollectionPointer:t,collectionStore:o,collectionViewBlockStore:n}=e;if(!t)return;if(o&&o.pointer===t)return o;return n?co.NW.createChildStore(n,t):void 0}({targetCollectionPointer:s,collectionStore:u,collectionViewBlockStore:e})}),[t,u,s]),S=(0,w.VK)((()=>n?A.KV(t,n):void 0),[t,n]),f=Boolean(u&&y&&u.id===y.id),h=Boolean("relation"===(null==S?void 0:S.type)&&S.connectedRelation),v=Boolean("subitem"===c),b=Boolean("timeline_arrows_by"===c),M=(0,w.VK)((()=>t.contextType),[t]),_=(0,C.O7)(),k=(0,d.useIntl)(),x=(0,w.VK)((()=>{const e=null==u?void 0:u.getSchema();return void 0===(null==S?void 0:S.name)&&y&&e?A.m8(k,{targetCollectionStore:y,isSelfRelation:f,sourceSchema:e,createUnique:!0,from:c}):(null==S?void 0:S.name)||""}),[u,null==S?void 0:S.name,y,k,f,c]),[T,P]=(0,l.useState)(x),[V,I]=(0,l.useState)("no_limit"),[B,Z]=(0,l.useState)(v||b?{hasInverseRelation:!0,inverseName:void 0,autoRelate:{enabled:!1}}:{hasInverseRelation:!1,inverseName:void 0,autoRelate:{enabled:!1}}),D=T===x,K=(0,l.useCallback)((()=>{p.H4({collectionSettingsStore:o,item:{type:"selectRelationSource",property:n,formatKey:r}})}),[o,n,r]),N=(0,l.useCallback)((()=>{if(!B)return;const{hasInverseRelation:e,inverseName:i,autoRelate:a}=B,l=t.collectionStore(),s=t.collectionViewStore();if(!l||!y)return;const{performResult:d}=m.createAndCommit({userAction:"CollectionSettingsSetupRelation.handleAddRelation",environment:_,perform:o=>{const d=n??ge.G3({environment:_,collectionStore:l,collectionViewArgs:s&&r?{collectionViewStore:s,format:s.getFormat(),formatKey:r}:void 0,propertyType:"relation",transaction:o});if(Ge.n7({environment:_,collectionContextStore:t,collectionStore:l,property:d,propertyName:T,targetCollectionStore:y,hasInverseRelation:e,inverseName:i,autoRelate:a,propertyLimit:V,intl:k,transaction:o,from:c}),s){var u;const e=(null===(u=s.getFormat().table_properties)||void 0===u?void 0:u.find((e=>e.property===d)))??{property:d,visible:!0};g.FH({stores:[s],update:{table_properties:[...s.getFormat().table_properties??[],e]},transaction:o})}return"subitem"===c&&s?(ze.dR({collectionViewStore:s,propertyId:d,transaction:o}),ze.jA({collectionContextStore:t,relationPropertyId:d,transaction:o})):"timeline_arrows_by"===c&&s&&(Le.tF({collectionViewStore:s,newProperty:d,transaction:o}),Le._p({collectionContextStore:t,relationPropertyId:d,transaction:o})),d}});"subitem"===c||"timeline_arrows_by"===c?(p.z$({collectionSettingsStore:o}),p.H4({collectionSettingsStore:o,item:{type:"main"}})):p.qU({collectionSettingsStore:o,property:d,formatKey:r}),pe._H({environment:_,collectionContextStore:t,from:"collectionPage"===M?"page_properties":"view_settings",property_type:"relation"})}),[B,t,y,_,o,n,r,M,T,V,k,c]);return l.createElement(F.ZP,a()({},e,{title:i()(d.FormattedMessage,{defaultMessage:"New relation",id:"database.viewSettings.setupRelationTab.title"})}),i()(E.Z,{},void 0,i()(Ee.ZP,{value:T||"",placeholder:"Property name",onChange:e=>P(e.target.value),onBlur:()=>{},onSubmit:()=>{},focusInitial:!0,selectAll:!1})),i()(_c.Z,{isSelfRelation:f,collectionStore:y,showAs:"chevron",onClick:K,disabled:v}),!c&&i()(Mc.U,{selectedKey:V,propertyType:"relation",onChange:e=>I(e)}),y&&!h&&i()(Tt.Z,{collectionContextStore:t,targetCollectionStore:y,property:n,propertyName:T,buttonContents:i()(d.FormattedMessage,{defaultMessage:"Add relation",id:"database.viewSettings.setupRelationTab.addButton.title"}),temporaryInverseState:B,setTemporaryInverseState:Z,isInitialPropertyName:D,onSubmit:N,from:c}),i()(E.Z,{},void 0,i()(ua.Z,{href:(0,sa.UY)("guides.relations"),title:i()(d.FormattedMessage,{defaultMessage:"Learn about relations",id:"database.viewSettings.propertyTab.relations.learnMoreButton.title"}),analyticsFrom:"view_settings_property_relation"})))}var xc=o(27006),Tc=o(63143),Pc=o(76464),Ac=o(21115),Vc=o(29551),Fc=o(46978);class Ic extends s.Z{constructor(){super(...arguments),this.storeTypes={restrictedStore:Un.default.createClass(!1)},this.handleContinue=()=>{const e=this.stores.restrictedStore.state,{collectionContextStore:t}=this.props,o=t.collectionViewBlockStore(),n=t.settingsStore;o&&(e&&this.restrictAccessToSyncedContent({environment:this.environment,store:o}),u.KIh(this.environment,{type:e?"restrict":"share"}),p.E3({collectionSettingsStore:n}))}}renderComponent(){const{collectionSettingsStore:e,collectionContextStore:t,integrationName:o,integrationIcon:n}=this.props,{restrictedStore:r}=this.stores,s=t.collectionViewBlockStore();if(!s)return;const c=this.createComputedStore((()=>{const e=As.default.state.data?Ac.CM(As.default.state.data):[],t=(0,Tc.m8)(O().compact(e.map((e=>[e.userId,e.role])))),o=(0,dn.YO)(s).map((e=>e.permissionItem));let n=!1,i=!1;for(const s of o)xc.$D(s)?n=!0:xc.ix(s)&&!xc.Wi(s.role)&&(i=!0);const r=O().uniq(O().compact([...o.map((e=>"user_permission"===e.type?e.user_id:void 0)),...i?Object.keys(t):[]])),a=r.filter((e=>"none"!==t[e])).length,l=r.filter((e=>{const n=t[e],i=Boolean(o.filter(xc.jg).find((t=>t.user_id===e)));return Boolean(n&&i&&!xc.YX(n))})).length;return{numberOfGuests:l,numberOfUsers:a+l,isPublic:n}})),{numberOfGuests:u,numberOfUsers:g,isPublic:m}=c.state;if(!m&&1===g)return void p.E3({collectionSettingsStore:e});const y=i()("div",{style:this.getPromptTitleStyle()},void 0,i()(d.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.header",defaultMessage:"Share synced content with"})),S=l.createElement(l.Fragment,null,0!==u?l.createElement(l.Fragment,null,i()(d.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.option.share.caption.usersWithGuests",defaultMessage:"{numberOfUsers} people (including you {numberOfGuests, plural, one {and {numberOfGuests} guest} other {and {numberOfGuests} guests}})",values:{numberOfUsers:g,numberOfGuests:u}})," "):l.createElement(l.Fragment,null,i()(d.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.option.share.caption.usersWithoutGuests",defaultMessage:"{numberOfUsers} people (including you)",values:{numberOfUsers:g}})," "),m&&l.createElement(l.Fragment,null,i()(d.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.option.share.caption.sharedWithPublic",defaultMessage:"and those with the link"})," "),i()(d.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.option.share.caption.accessToIntegration",defaultMessage:"will get access to content synced from {integrationName}",values:{integrationName:o}})),f=i()(Vc.gq,{style:{marginTop:10}},void 0,i()(fe.Z,{style:{flex:"0 0 100%"},isLarge:!0,onClick:this.handleContinue},void 0,i()(d.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.continueButton",defaultMessage:"Continue"}))),h=i()(Vc.gq,{style:{paddingBottom:24},alignItems:"center",justifyContent:"center"},void 0,i()("img",{style:{width:40},src:n})),v=i()(De.Z,{type:De.i.Vertical,initialFocus:void 0,sections:[{key:"grant_permissions",items:[{key:"allow",action:()=>null,render:e=>l.createElement(Ze.Z,a()({},e,{textWrapperStyle:{textAlign:"left"},title:i()(d.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.option.share.title",defaultMessage:"Anyone on this page"}),shouldWrapCaption:!0,caption:S,icon:i()(Fc.Z,{isSelected:!r.state}),onClick:()=>{r.setState(!1)}}))},{key:"restrict",action:()=>null,render:e=>l.createElement(Ze.Z,a()({},e,{textWrapperStyle:{textAlign:"left"},title:i()(d.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.option.restrict.title",defaultMessage:"Only you"}),shouldWrapCaption:!0,caption:i()(d.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.option.restrict.caption",defaultMessage:"You'll need to share with others using the share menu"}),icon:i()(Fc.Z,{isSelected:r.state}),onClick:()=>{r.setState(!0)}}))}],render:e=>l.createElement(E.Z,e)}]});return l.createElement(F.ZP,this.props,i()(Vc.gq,{style:this.getInnerContainerStyle(),flexDirection:"column"},void 0,h,i()("div",{},void 0,y,v),f))}restrictAccessToSyncedContent(e){const{environment:t,store:o}=e,n=t.currentUser.id;n&&m.createAndCommit({userAction:"CollectionSettingsSyncedContentShare.restrictAccessToSyncedContent",environment:t,perform:e=>{Pc.Pk({environment:t,store:o,shouldInherit:!1,transaction:e,permissionItem:{type:"user_permission",user_id:n,role:"editor"}})}})}getInnerContainerStyle(){return{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"0px 16px 16px 16px"}}getPromptTitleStyle(){return{color:this.theme.regularTextColor,fontWeight:x.Z.fontWeight.semibold,fontSize:14}}}Ic.displayName="CollectionSettingsSyncedContentShare";const Bc=(0,d.injectIntl)(Ic);var Zc=o(90985),Ec=o(97004);const Dc=(0,d.defineMessages)({inputPlaceholder:{defaultMessage:"Filter by‚Ä¶",id:"database.viewSettings.createFilterTab.inputPlaceholder"}});class Kc extends s.Z{constructor(){super(...arguments),this.handlePropertyAccept=e=>{if(!e)return;const{collectionContextStore:t}=this.props,o=t.collectionViewStore(),n=this.suggestedFilters.state.find((t=>t.property===e));if(!n||!o)return;const i={id:(0,c.ZP)(),filter:n};Zc.iU({environment:this.environment,collectionContextStore:t,temporaryState:{...t.temporaryState.state,propertyFilters:{value:[...this.getPropertyFilters(),i]}}}),this.acceptAndOpenPropertyFilter(i)},this.handleCombinatorFilterClick=()=>{const{collectionContextStore:e}=this.props;if(!e.collectionViewStore())return;this.getCombinatorFilter()||Zc.iU({environment:this.environment,collectionContextStore:e,temporaryState:{...e.temporaryState.state,combinatorFilter:{value:Gt.TI}}}),this.acceptAndOpenCombinatorFilter()},this.suggestedFilters=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.normalizedSchemaStore.state,o=e.collectionViewStore();if(!o)return[];return(0,Ec.qd)({schema:t,filters:this.getPropertyFilters(),getRecordValue:o.getRecordValue})}),!0)}renderComponent(){var e;const{collectionContextStore:t}=this.props,o=this.suggestedFilters.state,n=this.getCombinatorFilter(),r=t.permissionScopes.state;return l.createElement(F.ZP,a()({},this.props,{title:i()(d.FormattedMessage,{defaultMessage:"Add filter",id:"database.viewSettings.createFilterTab.title"}),footer:r.canConfigureBlock&&i()(E.Z,{topBorder:!0},void 0,i()(I.Z,{icon:n?_.Z.filter:_.Z.plus,isGray:!0,title:i()(d.FormattedMessage,n?{defaultMessage:"Advanced filter",id:"database.viewSettings.createFilterTab.advancedFilter.title"}:{defaultMessage:"Add advanced filter",id:"database.viewSettings.createFilterTab.addAdvancedFilter.title"}),right:n&&i()(d.FormattedMessage,{defaultMessage:"{ruleCount, plural, one {{ruleCount} rule} other {{ruleCount} rules}}",id:"database.viewSettings.createFilterTab.advancedFilterRulesCount.title",values:{ruleCount:(null===(e=n.filters)||void 0===e?void 0:e.length)||1}}),onClick:this.handleCombinatorFilterClick}))}),i()(be.Z,{schema:t.normalizedSchemaStore.state,format:t.normalizedFormatStore.state,getProperties:()=>o.map((e=>e.property)),onAccept:this.handlePropertyAccept,inputPlaceholder:Fe.default.formatMessage(Dc.inputPlaceholder)}))}acceptAndOpenPropertyFilter(e){const{collectionContextStore:t,context:o}=this.props;if(pe.wd({environment:this.environment,collectionContextStore:t,action:"create_property_filter"}),o===Ha.HV.FilterBar||o===Ha.HV.TopbarFilterPopup){this.closeMenuAndOpenFilterBar();const o=t.getFilterBarItemSettingsStore(e);p.wl({collectionSettingsStore:o,item:{type:"filter"}})}else if(o===Ha.HV.ViewSettings){this.navigateToMainThenFilters();const o=t.getFilterOptionsItemSettingsStore(e);p.wl({collectionSettingsStore:o,item:{type:"filter"}})}}acceptAndOpenCombinatorFilter(){const{collectionContextStore:e,context:t}=this.props;pe.wd({environment:this.environment,collectionContextStore:e,action:"create_combinator_filter"}),t===Ha.HV.FilterBar||t===Ha.HV.TopbarFilterPopup?(this.closeMenuAndOpenFilterBar(),p.wl({collectionSettingsStore:e.filterBarCombinatorFilterSettingsState,item:{type:"filter"}})):t===Ha.HV.ViewSettings&&(this.navigateToMainThenFilters(),p.wl({collectionSettingsStore:e.filterOptionsCombinatorFilterSettingsState,item:{type:"filter"}}))}closeMenuAndOpenFilterBar(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props;e.filtersBarOpen.setState(!0),p.z$({collectionSettingsStore:t})}navigateToMainThenFilters(){const{collectionSettingsStore:e}=this.props;p.wl({collectionSettingsStore:e,item:{type:"main"}}),p.H4({collectionSettingsStore:e,item:{type:"filters"}})}getPropertyFilters(){const{collectionContextStore:e}=this.props;return e.currentPropertyFiltersStore.state}getCombinatorFilter(){const{collectionContextStore:e}=this.props;return e.currentCombinatorFilterStore.state}}Kc.displayName="CollectionSettingsViewCreateFilter";const Nc=(0,d.injectIntl)(Kc),Rc=(0,d.defineMessages)({inputPlaceholder:{defaultMessage:"Sort by‚Ä¶",id:"database.viewSettings.createSortTab.inputPlaceholder"}});class Oc extends s.Z{constructor(){super(...arguments),this.handlePropertyAccept=e=>{var t;if(!e)return;const{collectionContextStore:o,context:n,collectionSettingsStore:i}=this.props,r=o.collectionViewStore(),a=o.normalizedSchemaStore.state;if(!r||!a)return;const l=null===(t=a[e])||void 0===t?void 0:t.type;pe.wd({environment:this.environment,collectionContextStore:o,action:"create_sort_accept",original_view_type:r.getType(),property_type:l});const s={property:e,direction:"ascending"},c=[...this.getSorts(),s];if(Zc.iU({environment:this.environment,collectionContextStore:o,temporaryState:{...o.temporaryState.state,sorts:{value:c}}}),n===Ha.HV.TopbarSortPopup||n===Ha.HV.FilterBar){o.filtersBarOpen.setState(!0),p.z$({collectionSettingsStore:i});const{filterBarSortSettingsStore:e}=o;p.wl({collectionSettingsStore:e,item:{type:"sort"}})}else n===Ha.HV.ViewSettings&&(p.wl({collectionSettingsStore:i,item:{type:"main"}}),p.H4({collectionSettingsStore:i,item:{type:"sort"}}))}}renderComponent(){const{collectionContextStore:e}=this.props,t=e.normalizedSchemaStore.state,o=this.getSorts();return l.createElement(F.ZP,a()({},this.props,{title:i()(d.FormattedMessage,{defaultMessage:"New sort",id:"database.viewSettings.createSortTab.title"})}),i()(be.Z,{schema:e.normalizedSchemaStore.state,format:e.normalizedFormatStore.state,getProperties:()=>Object.keys(t).filter((e=>!o.find((t=>t.property===e)))),onAccept:this.handlePropertyAccept,inputPlaceholder:Fe.default.formatMessage(Rc.inputPlaceholder)}))}getSorts(){const{collectionContextStore:e}=this.props;return e.currentSortsStore.state}}Oc.displayName="CollectionSettingsViewCreateSort";const Wc=(0,d.injectIntl)(Oc);var Gc=o(29987),Lc=o(77985),zc=o(8982);class Uc extends s.Z{constructor(){super(...arguments),this.handleFilterChange=(e,t)=>{var o;const{collectionContextStore:n}=this.props,i=null===(o=n.remoteResult.state)||void 0===o?void 0:o.sizeHint,r=Gc.default.mark("collections.update_filter_lag");Gc.default.measureAfterNextFlush(r,{environment:this.environment,getData:()=>Zr.Y5({from:"combinator_filter",collectionContextStore:n,sizeHintAtStart:i})}),Zc.iU({environment:this.environment,collectionContextStore:n,temporaryState:{...n.temporaryState.state,combinatorFilter:{value:t}}}),pe.wd({environment:this.environment,collectionContextStore:n,action:"update_combinator_filter"})},this.handleRemoveClick=()=>{const{collectionContextStore:e,context:t,collectionSettingsStore:o}=this.props;Zc.iU({environment:this.environment,collectionContextStore:e,temporaryState:{...e.temporaryState.state,combinatorFilter:{value:void 0}}}),t===Ha.HV.FilterBar&&p.E3({collectionSettingsStore:o}),pe.wd({environment:this.environment,collectionContextStore:e,action:"delete_combinator_filter"})}}renderComponent(){const{collectionContextStore:e}=this.props,t=e.collectionViewStore(),o=e.normalizedSchemaStore.state,n=this.getFilter();if(!t||!n)return;const r=t.getType();return r?l.createElement(F.ZP,a()({},this.props,{title:i()(d.FormattedMessage,{defaultMessage:"Advanced filter",id:"database.viewSettings.filterTab.title"}),unconstrainedWidth:!0}),i()(zc.D,{},void 0,i()(Lc.Pq,{index:0,level:0,combinatorFilter:n,schema:o,onChange:this.handleFilterChange,collectionViewType:r,collectionViewId:t.id,parentStore:t})),i()(E.Z,{topBorder:!0},void 0,i()(I.Z,{title:i()(d.FormattedMessage,{defaultMessage:"Delete filter",id:"database.viewSettings.filterTab.deleteFilterButton.title"}),onClick:this.handleRemoveClick}))):void 0}getFilter(){const{collectionContextStore:e}=this.props;return e.currentCombinatorFilterStore.state}}Uc.displayName="CollectionSettingsViewFilter";const Hc=(0,d.injectIntl)(Uc);var $c=o(28398),qc=o(37709),jc=o(58814),Yc=o(97774);class Qc extends s.Z{constructor(){super(...arguments),this.renderPropertyFilter=e=>{const{collectionContextStore:t}=this.props;return i()("div",{style:{display:"flex",alignItems:"center",padding:"4px 10px"}},void 0,this.canReorder()&&i()(ga.ZP,{iconSize:12,style:{marginLeft:6,marginRight:6}}),i()(Yc.Z,{id:e.id,context:qc.P.SettingsFilters,collectionContextStore:t,collectionSettingsStore:t.getFilterOptionsItemSettingsStore(e)},e.id))},this.handleFiltersDrop=e=>{const{collectionContextStore:t}=this.props;if(!t.collectionViewBlockStore())return;const o=t.currentPropertyFiltersStore.state,n=R.compact(e.map((e=>o.find((t=>t.id===e)))));Zc.iU({environment:this.environment,collectionContextStore:t,temporaryState:{...t.temporaryState.state,propertyFilters:{value:n}}}),pe.wd({environment:this.environment,collectionContextStore:t,action:"reorder_filters"})},this.handleNewFilterClick=()=>{const{collectionSettingsStore:e,collectionContextStore:t}=this.props;pe.wd({environment:this.environment,collectionContextStore:t,action:"click_new_filter"}),p.H4({collectionSettingsStore:e,item:{type:"createFilter"}}),t.filtersBarOpen.setState(!0)},this.localStateHasChangesStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return(0,Ec.yU)(e)}))}renderComponent(){const{collectionContextStore:e}=this.props,{device:t}=this.environment,o=e.currentPropertyFiltersStore.state,n=o.map((e=>e.id)),r=e.permissionScopes.state,s=r.canConfigureBlock?e.currentCombinatorFilterStore.state:void 0;return l.createElement(F.ZP,a()({},this.props,{title:i()(d.FormattedMessage,{defaultMessage:"Filters",id:"database.viewSettings.filtersTab.title"}),footer:this.localStateHasChangesStore.state&&i()(E.Z,{topBorder:!0},void 0,this.renderSaveControl()),unconstrainedWidth:!0}),i()(E.Z,{desktopStyle:{paddingBottom:24}},void 0,(n.length>0||s)&&i()("div",{style:t.isMobile?{paddingTop:8,background:this.theme.contentBackground}:void 0},void 0,s&&this.renderCombinatorFilter(),this.canReorder()?i()(pa.ZP,{direction:"vertical",keys:n,renderKey:e=>{const t=n.indexOf(e);return this.renderPropertyFilter(o[t])},onDrop:this.handleFiltersDrop,disabled:!r.canConfigureBlock}):n.map((e=>{const t=n.indexOf(e);return this.renderPropertyFilter(o[t])}))),i()(Ze.Z,{focused:!1,icon:_.Z.plus({width:14,marginLeft:4,marginRight:4,fill:this.theme.mediumIconColor}),style:{color:this.theme.mediumTextColor},title:i()(d.FormattedMessage,{defaultMessage:"Add filter",id:"database.viewSettings.filtersTab.newFilter.title"}),onClick:this.handleNewFilterClick})))}renderCombinatorFilter(){const{collectionContextStore:e}=this.props;return i()("div",{style:{display:"flex",alignItems:"center",padding:"4px 10px"}},void 0,this.canReorder()&&i()(ga.ZP,{iconSize:12,style:{marginLeft:6,marginRight:6,opacity:.4,cursor:void 0}}),i()(jc.Z,{context:qc.P.SettingsFilters,collectionContextStore:e,collectionSettingsStore:e.filterOptionsCombinatorFilterSettingsState}))}renderSaveControl(){const{collectionContextStore:e}=this.props;return i()($c.ZP,{context:$c.R1.SettingsFilters,collectionContextStore:e})}canReorder(){return!this.environment.device.isMobile}}Qc.displayName="CollectionSettingsViewFilters";const Xc=(0,d.injectIntl)(Qc);var Jc=o(74194);class ed extends s.Z{constructor(){super(...arguments),this.storeTypes={inputValue:Un.default.createClass("")},this.handleChangeDebounced=O().debounce((e=>{void 0!==e&&this.props.onChange(e)}),300)}willMount(e){this.stores.inputValue.setState(e.value.toString())}renderComponent(){const e=this.stores.inputValue.state;return i()(Jc.Z,{type:"number",value:e,inputClassName:"input-hide-arrows",style:{background:this.theme.contentBackground},onChange:e=>{const t=e.target.value,o=parseFloat(t);isNaN(o)?this.handleChangeDebounced(void 0):this.handleChangeDebounced(o),this.stores.inputValue.setState(t)}})}}ed.displayName="CollectionViewGroupMenuNumberInput";const td=ed;class od extends s.Z{renderComponent(){const{numberGroupBy:e,collectionContextStore:t,schema:o}=this.props,n=o[e.property];if(t.collectionStore()&&n)return l.createElement(l.Fragment,null,i()(E.Z,{topBorder:!1,disableMobileBorders:!0,title:i()(d.FormattedMessage,{id:"database.groupMenu.numberGroupRange",defaultMessage:"Group range"}),isTitleUppercase:!1},void 0,i()("div",{style:{display:"flex",paddingLeft:14,paddingRight:14}},void 0,this.renderNumberGroupByKeyInput(e,"start"),i()("span",{style:{color:this.theme.mediumTextColor,margin:"0 8px"}},void 0,"‚Äì"),this.renderNumberGroupByKeyInput(e,"end"))),i()(E.Z,{topBorder:!1,disableMobileBorders:!0,title:i()(d.FormattedMessage,{id:"database.groupMenu.numberGroupSize",defaultMessage:"Group every"}),isTitleUppercase:!1},void 0,i()("div",{style:{paddingLeft:14,paddingRight:14}},void 0,this.renderNumberGroupByKeyInput(e,"size"),i()("span",{style:{color:this.theme.mediumTextColor,fontSize:12}},void 0,i()(ca.Z,{groupBy:e,groupFormat:{property:e.property,value:{type:"number",value:{type:"range",start:e.start,end:e.start+e.size}}},schema:o,currentGroups:[],disabled:!0,isHiddenGroup:!1,style:this.getInlineNumberGroupValueStyle(),collectionContextStore:t}),", ",i()(ca.Z,{groupBy:e,groupFormat:{property:e.property,value:{type:"number",value:{type:"range",start:e.start+e.size,end:e.start+2*e.size}}},schema:o,currentGroups:[],disabled:!0,isHiddenGroup:!1,style:this.getInlineNumberGroupValueStyle(),collectionContextStore:t}),", ..."))))}renderNumberGroupByKeyInput(e,t){return i()(td,{value:e[t],onChange:o=>{"size"===t&&o<=0&&(o=1),"start"===t&&o>e.end&&(o=e.end),"end"===t&&o<e.start&&(o=e.start),this.props.onChange({newNumberGroupBy:{...e,[t]:o}})}})}getInlineNumberGroupValueStyle(){return{display:"inline",paddingRight:0,paddingLeft:0}}}od.displayName="CollectionViewNumberGroupMenu";const nd=(0,d.injectIntl)(od);class id extends s.Z{renderComponent(){return l.createElement(F.ZP,a()({},this.props,{title:this.renderTitle()}),this.renderContent())}renderTitle(){const{collectionSettingsStore:e}=this.props,t=(0,h.n)(e);if(!t||"groupByNumber"!==t.type)return;const{collectionContextStore:o}=this.props,n=o.normalizedSchemaStore.state,i=o.normalizedFormatStore.state[t.groupByKey];return i?Ca({groupBy:i,schema:n}):void 0}renderContent(){const{groupByKey:e,groupsFormatKey:t,collectionContextStore:o}=this.props,n=o.collectionViewStore(),r=o.normalizedSchemaStore.state,a=this.getGroupBy();if(!a||!n)return;const l=_a(a);return l?i()(nd,{numberGroupBy:l,disabled:!1,schema:r,onChange:i=>{if("number"===a.type)m.createAndCommit({userAction:"CollectionSettingsViewGroupByNumber.renderContent",environment:this.environment,perform:o=>{g.FH({stores:[n],update:{[e]:i.newNumberGroupBy,[t]:void 0},transaction:o})}});else if("formula"===a.type){const o=R.omit(i.newNumberGroupBy,"property"),r={...a,groupBy:o};m.createAndCommit({userAction:"CollectionSettingsViewGroupByNumber.renderContent",environment:this.environment,perform:o=>{g.FH({stores:[n],update:{[e]:r,[t]:void 0},transaction:o})}})}pe.wd({environment:this.environment,collectionContextStore:o,action:"group_by_number_update",original_view_type:void 0,property_type:a.type})},collectionContextStore:o}):void 0}getGroupBy(){const{collectionContextStore:e,groupByKey:t}=this.props;return e.normalizedFormatStore.state[t]}}id.displayName="CollectionSettingsViewGroupByNumber";const rd=(0,d.injectIntl)(id);class ad extends s.Z{constructor(){super(...arguments),this.handlePropertyAccept=e=>{const{collectionContextStore:t,collectionSettingsStore:o,groupByKey:n,groupsFormatKey:i}=this.props,r=t.collectionViewStore(),a=t.normalizedSchemaStore.state;if(r){if(e){const o=a[e];if(!o||!(0,ra.LG)(o))return;const l=(0,ra.fw)(e,o,"collectionTypedView"===t.contextType);m.createAndCommit({userAction:"CollectionSettingsViewGroupByProperty.handlePropertyAccept",environment:this.environment,perform:e=>{g.FH({stores:[r],update:{[n]:l,[i]:void 0},transaction:e})}}),pe.wd({environment:this.environment,collectionContextStore:t,action:"group_by_property_accept",original_view_type:void 0,property_type:o.type})}else m.createAndCommit({userAction:"CollectionSettingsViewGroupByProperty.handlePropertyAccept",environment:this.environment,perform:e=>{g.FH({stores:[r],update:{[n]:void 0,[i]:void 0},transaction:e})}}),pe.wd({environment:this.environment,collectionContextStore:t,action:"group_by_property_accept"});p.wl({collectionSettingsStore:o,item:{type:"main"}}),p.H4({collectionSettingsStore:o,item:{type:"group",groupByKey:n,groupsFormatKey:i}})}},this.sortBySchemaName=(e,t)=>{var o,n;const i=null==e||null===(o=e[1])||void 0===o?void 0:o.name,r=null==t||null===(n=t[1])||void 0===n?void 0:n.name;return i&&r?i.localeCompare(r,void 0,{sensitivity:"base"}):i?1:r?-1:0}}renderComponent(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=(0,h.n)(t),n=e.collectionViewBlockStore(),r=e.collectionViewStore();if(!n||!r||!o||"groupByProperty"!==o.type)return;const s=this.getGroupBy();return l.createElement(F.ZP,a()({},this.props,{title:ha(o.groupByKey,this.getCurrentViewType())}),i()(be.Z,{schema:e.normalizedSchemaStore.state,format:e.normalizedFormatStore.state,currentProperty:null==s?void 0:s.property,showNoneOption:this.canRemoveGrouping(),getProperties:()=>this.getGroupableProperties(),onAccept:this.handlePropertyAccept}))}getGroupBy(){const{collectionContextStore:e,groupByKey:t}=this.props;return e.normalizedFormatStore.state[t]}getGroupableProperties(){const{collectionContextStore:e}=this.props,t=e.normalizedSchemaStore.state;return Object.entries(t).sort(this.sortBySchemaName).map((e=>e[0])).filter((e=>{const o=t[e];return o&&(0,ra.LG)(o)}))}getCurrentViewType(){var e;const{collectionContextStore:t}=this.props,o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType();if(!o)throw new Error("View type was not defined.");return o}canRemoveGrouping(){return(0,la._1)({viewType:this.getCurrentViewType(),groupByKey:this.props.groupByKey})}}ad.displayName="CollectionSettingsViewGroupByProperty";const ld=(0,d.injectIntl)(ad);class sd extends s.Z{renderComponent(){return l.createElement(F.ZP,a()({},this.props,{title:i()(d.FormattedMessage,{defaultMessage:"Layout",id:"database.viewSettings.layoutTab.title"}),desktopWidth:290}),l.createElement(Jr.Z,this.props))}}sd.displayName="CollectionSettingsViewLayout";const cd=(0,d.injectIntl)(sd);var dd=o(75544),ud=o(41418);class pd extends s.Z{constructor(){super(...arguments),this.handleSortChange=e=>{this.setSorts(e)},this.handleDeleteAllSortsClick=()=>{const{collectionSettingsStore:e,context:t}=this.props;t===Ha.HV.FilterBar&&p.E3({collectionSettingsStore:e})},this.localStateHasChangesStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return(0,Ec.Mj)(e)}))}renderComponent(){const{collectionContextStore:e,context:t}=this.props,o=e.permissionScopes.state,n=t===Ha.HV.ViewSettings&&this.localStateHasChangesStore.state,r=e.collectionViewStore();if(r)return l.createElement(F.ZP,a()({},this.props,{title:i()(d.FormattedMessage,{defaultMessage:"Sort",id:"database.viewSettings.sortTab.title"}),footer:n&&l.createElement(l.Fragment,null,i()("div",{style:{paddingTop:24}}),i()(E.Z,{topBorder:!0},void 0,this.renderSaveControl())),unconstrainedWidth:!0}),i()(ud.Z,{collectionViewStore:e.collectionViewStore(),schema:e.normalizedSchemaStore.state,format:e.normalizedFormatStore.state,sorts:this.getSorts(),disabled:!o.canConfigureBlock,parentStore:r,onChange:this.handleSortChange,showDeleteAll:!0,onDeleteAll:this.handleDeleteAllSortsClick}))}renderSaveControl(){const{collectionContextStore:e}=this.props;return i()($c.ZP,{context:$c.R1.SettingsSort,collectionContextStore:e})}getSorts(){const{collectionContextStore:e}=this.props;return e.currentSortsStore.state}setSorts(e){const{collectionContextStore:t}=this.props;t.collectionViewStore()&&Zc.iU({environment:this.environment,collectionContextStore:t,temporaryState:{...t.temporaryState.state,sorts:{value:e}}})}}pd.displayName="CollectionSettingsViewSort";const gd=(0,d.injectIntl)(pd);var md=o(55384),yd=o(47425);var Sd=o(15157),fd=o(32056),hd=o(16402),vd=o(24039);class bd extends s.Z{constructor(e){super(e),this.storeTypes={nextSync:Un.default.createClass(void 0),uri:Un.default.createClass(void 0),botId:Un.default.createClass(void 0)},this.reducer={type:"aggregation",filter:void 0,aggregation:{aggregator:"count",property:"title"}},this.setNextSync=this.setNextSync.bind(this)}didMount(){const e=this.stores.uri.state,t=this.stores.botId.state;if(e&&t){const o=`${t}:${e}`,n=Sd.Z.get({userId:this.environment.currentUser.id,key:o});this.setNextSync(n)}}renderComponent(){var e;const{collectionContextStore:t}=this.props,o=t.collectionStore(),n=null==o?void 0:o.getFormatStore(),r=null==n?void 0:n.getKeyStore("uri").getValue(),s=null==n?void 0:n.getKeyStore("bot_id").getValue(),c=null==o||null===(e=o.pointer)||void 0===e?void 0:e.spaceId,u=yn.default.state.currentSpaceStore,p=null==n?void 0:n.getKeyStore("original_url").getValue(),g=(0,cc.wY)(p,c),m=t.collectionViewBlockStore(),y=so.default.checkGate("free_tier_sync_database")||u&&!(0,yd.QM)(u.getSubscriptionTier());return this.stores.uri.setState(r),this.stores.botId.setState(s),l.createElement(l.Fragment,null,i()(E.Z,{title:i()(d.FormattedMessage,{defaultMessage:"Source database",id:"database.viewSettings.syncedSourceTab.sourceDatabase"}),children:i()(St.Z,{placement:St.Z.Placement.Left,alignment:St.Z.Alignment.Center,renderTooltip:()=>m&&i()(vd.Z,{store:m,compactFormat:!0}),render:e=>l.createElement(ma.Z,a()({},e,{title:g,icon:i()(Kr.Z,{disabled:!0,icon:null==o?void 0:o.getIcon(),isEmptyPage:!1,size:20,style:this.styles().menuItemIcon}),style:this.styles().menuItemTitle}))}),style:{paddingBottom:0}}),i()(E.Z,{},void 0,this.renderLimitMenuItem()),i()(E.Z,{topBorder:!0},void 0,y&&r&&s&&this.renderSyncButton({uri:r,botId:s}),i()(I.Z,{isGray:!0,title:i()(d.FormattedMessage,{defaultMessage:"Copy debugging information",id:"database.viewSettings.syncedSourceTab.copyDebugging"}),icon:_.Z.copy,onClick:()=>{const e={uri:r,botId:s,spaceId:c};Fr.RD({environment:this.environment,stringValue:JSON.stringify(e,null,2),copiedMessage:Fr.tq.copiedLinkToClipboard})}}),i()(dr.Z,{href:`${lc.default.domainBaseUrl}?target=connected_apps`},void 0,i()(I.Z,{icon:_.Z.settingsConnectedApps,title:i()(d.FormattedMessage,{defaultMessage:"Manage my connections",id:"database.viewSettings.syncedSourceTab.manageConnections"}),isGray:!0})),i()(ua.Z,{href:(0,sa.UY)("guides.syncedDatabases"),title:i()(d.FormattedMessage,{defaultMessage:"Learn about synced databases",id:"database.viewSettings.syncedSourceTab.learnMoreButton.title."}),analyticsFrom:"view_settings_source"})))}renderCountRowValue(e){const{collectionContextStore:t}=this.props;return i()(da.Z,{id:"table:uncategorized:title:count",collectionContextStore:t,reducer:this.reducer,render:t=>{const o=t.state;if(!o||"aggregation"!==o.type)return;if("number"!==o.aggregationResult.type)return;const n={...o.aggregationResult,value:o.aggregationResult.value&&Math.min(e,o.aggregationResult.value)};return(0,fd.uf)(n.value,"number_with_commas",this.props.intl)}})}renderLimitMenuItem(){const{collectionContextStore:e}=this.props,t=e.collectionStore(),o=null==t?void 0:t.getFormatStore(),n="row_limit_exceeded"===(null==o?void 0:o.getKeyStore("sync_state").getKeyStore("syncing").getValue()),r=yn.default.state.currentSpaceStore,a=this.createComputedStore((()=>{var e;return function(e){if(!e)return 2e4;const t=md.kk.fromSpace(e),o=t.getSetting("database_sync_row_limit");return void 0!==o?o:(0,yd.QM)(t.getSubscriptionTier())?100:2e4}(null===(e=yn.default.state.currentSpaceStore)||void 0===e?void 0:e.getModel())}));return i()(ma.Z,{title:i()("span",{style:{display:"inline-flex",alignItems:"center"}},void 0,n&&r&&(0,yd.QM)(r.getSubscriptionTier())&&i()(St.Z,{placement:St.Z.Placement.Left,alignment:St.Z.Alignment.Center,renderTooltip:()=>i()(d.FormattedMessage,{id:"database.viewSettings.syncedSourceTab.limitFree.toolTip",defaultMessage:"Free Plans are limited to 1 synced database with up to 100 rows."}),render:e=>l.createElement("div",e,_.Z.warning({fill:(0,kr.fi)("orange",this.theme).fill,marginRight:14,width:12,alignSelf:"center"}))}),i()(d.FormattedMessage,{defaultMessage:"Limit",id:"database.viewSettings.syncedSourceTab.limit"})),right:i()(d.FormattedMessage,{defaultMessage:"{value}/{limit} rows",id:"database.viewSettings.syncedSourceTab.limitRows",values:{value:this.renderCountRowValue(a.state),limit:(0,fd.uf)(a.state,"number_with_commas",this.props.intl)}}),style:this.styles().menuItem})}renderSyncButton(e){const{uri:t,botId:o}=e,n=this.stores.nextSync.state,r=!n||n<Date.now();return this.isSyncing()?i()(ma.Z,{title:i()(d.FormattedMessage,{defaultMessage:"Syncing",id:"database.viewSettings.syncedSourceTab.isSyncing"}),icon:_.Z.sync(this.styles().menuItemIcon,"sync-spinner"),style:this.styles().menuItem}):r?i()(I.Z,{isGray:!0,title:i()(d.FormattedMessage,{defaultMessage:"{message}",id:"database.viewSettings.syncedSourceTab.syncNow",values:{message:this.syncButtonMessage().defaultMessage,description:this.syncButtonMessage().description}}),icon:_.Z.sync,onClick:async()=>{var e,i;const r=null===(e=this.props.collectionContextStore.collectionStore())||void 0===e?void 0:e.id,a=!0===(null===(i=this.props.collectionContextStore.collectionStore())||void 0===i?void 0:i.getFormat().stale);r&&await p.R0({environment:this.environment,uri:t,botId:o,collectionId:r,nextSync:n,setNextSync:this.setNextSync,isStale:a})}}):i()(ma.Z,{title:i()(d.FormattedMessage,{defaultMessage:"Sync available in {timeToNextSync}",id:"database.viewSettings.syncedSourceTab.syncNow.disabled",values:{timeToNextSync:(0,hd.hH)(Date.now(),n)}}),icon:_.Z.unsync(this.styles().menuItemIcon),style:this.styles().menuItem})}setNextSync(e){this.stores.nextSync.setState(e)}isSyncing(){var e;const t=this.props.collectionContextStore,o=t.numberChildrenUnfurled.state,n=t.numberChildrenReceived.state,i=o/n,r=!0===(null===(e=t.collectionStore())||void 0===e||null===(e=e.getFormat().sync_state)||void 0===e?void 0:e.syncing),a=this.environment.device.isMobile;return o&&n&&i<1&&!a||r&&a}styles(){const e=this.environment.device.isMobile;return{menuItemTitle:{paddingLeft:e?4:8},menuItem:{color:this.theme.mediumTextColor,paddingLeft:e?4:8},menuItemIcon:{height:16,width:16,marginRight:2}}}syncButtonMessage(){const e=yn.default.state.currentSpaceStore,t=e&&(0,yd.QM)(e.getSubscriptionTier());return{defaultMessage:t?"Clear and sync database":"Sync database",description:t?"Clears and refreshes the database ":"Refreshes the synced database."}}}bd.displayName="CollectionSettingsViewSyncedSource";const Cd=(0,d.injectIntl)(bd);class wd extends s.Z{constructor(){super(...arguments),this.searchSessionId="",this.handleSourcePickerAccept=e=>{const{collectionContextStore:t,collectionSettingsStore:o}=this.props;m.createAndCommit({userAction:"CollectionSettingsViewSource.handleSourcePickerAccept",environment:this.environment,perform:o=>{me.yc({environment:this.environment,collectionContextStore:t,collectionStore:e,transaction:o})}}),p.z$({collectionSettingsStore:o})}}renderComponent(){var e;const{collectionContextStore:t,collectionSettingsStore:o}=this.props,n=Boolean(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewSourceCollectionStore()),r=t.collectionViewBlockStore();if(!r)return;const s=Un.default.createValue("");return l.createElement(F.ZP,a()({},this.props,{title:i()(d.FormattedMessage,{defaultMessage:"Source",id:"database.viewSettings.sourceTab.title"}),handleClose:()=>{pe.tW({environment:this.environment,eventName:"abandoned_search",sessionId:this.searchSessionId,source:vc.S.Source,queryLength:s.state.length}),p.E3({collectionSettingsStore:o})}}),n?i()(Cd,{collectionContextStore:t}):i()(Yn.Z,{collectionContextStore:t,parentStore:r,onAccept:this.handleSourcePickerAccept,context:vc.S.Source,searchSessionId:this.searchSessionId,inputStore:s}))}willMount(){this.searchSessionId=(0,c.ZP)()}}wd.displayName="CollectionSettingsViewSource";const Md=(0,d.injectIntl)(wd);var _d=o(72897);class kd extends s.Z{constructor(){super(...arguments),this.lastTab=void 0,this.renderMainTab=e=>{var t;if("main"!==e.type)return;const{collectionContextStore:o}=this.props;return l.createElement(Ka,a()({key:null===(t=o.collectionViewStore())||void 0===t?void 0:t.id,selectViewNameInitial:e.selectViewNameInitial},this.props))},this.renderPageViewTab=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();if(o)return l.createElement(F.ZP,a()({},this.props,{title:"Select page to display",children:i()("div",{style:{margin:12}},void 0,i()(Jc.Z,{showClearButton:!0,placeholder:"Enter page ID",focusInitial:!0,onChange:e=>{v.Z.setState({pageId:e.target.value})},onSubmit:e=>{const t=v.Z.state.pageId;t&&m.createAndCommit({userAction:"collectionSettings.pageView.selectPage",environment:this.environment,perform:e=>{g.FH({stores:[o],update:{page_pointer:{id:(0,c.Mt)(t),spaceId:e.spaceId,table:"block"}},transaction:e})}})}}))}))},this.renderSetDBTypeTab=()=>l.createElement(wc,this.props),this.renderDBTypePropertyMappingTab=e=>{if("databaseTypePropertyMapping"===e.type)return l.createElement(Ua,a()({},this.props,{databaseType:e.databaseType}))},this.renderCreateTypedDBTab=()=>l.createElement(Yr,this.props),this.renderSourceTab=()=>l.createElement(Md,this.props),this.renderCreateViewSourceTab=()=>l.createElement(Oa.Z,this.props),this.renderCreateExternalViewSourceTab=e=>{if("createSyncedViewSource"===e.type)return l.createElement(Gr,a()({},this.props,e))},this.renderSelectAccountForExternalViewSourceTab=e=>{if("selectAccountForExternalSource"===e.type)return l.createElement(Et,a()({},this.props,e))},this.renderSyncedShareTab=e=>{if("shareSyncedView"===e.type)return l.createElement(Bc,a()({},this.props,e))},this.renderPropertyTypeTab=e=>{if("propertyType"===e.type)return l.createElement(hc,a()({},this.props,e))},this.renderPropertyAiAutofillTab=e=>{if("propertyAiAutofill"===e.type)return l.createElement(Ds,a()({},this.props,e))},this.renderCreateViewTab=()=>l.createElement(Ra,this.props),this.renderDuplicateExistingViewTab=()=>l.createElement(ja.Z,this.props),this.renderPropertiesTab=e=>{if("properties"===e.type)return l.createElement(dd.Z,a()({},this.props,{timelineViewTab:e.timelineViewTab}))},this.renderPropertyTab=e=>{if("property"===e.type)return l.createElement(hs.ZP,a()({key:e.property},this.props,e))},this.renderDeletedPropertiesTab=e=>{if("deletedProperties"===e.type)return l.createElement(qa,a()({},e,this.props))},this.renderSelectRelationSourceTab=e=>{if("selectRelationSource"===e.type)return l.createElement(Cc,a()({},this.props,e))},this.renderSetupRelationTab=e=>{if("setupRelation"===e.type)return l.createElement(kc,a()({},this.props,e))},this.renderLayoutTab=()=>l.createElement(cd,this.props),this.renderGroupTab=e=>{if("group"===e.type)return l.createElement(Aa,a()({},this.props,e))},this.renderGroupByPropertyTab=e=>{if("groupByProperty"===e.type)return l.createElement(ld,a()({},this.props,e))},this.renderGroupByNumberTab=e=>{if("groupByNumber"===e.type)return l.createElement(rd,a()({},this.props,e))},this.renderSubitemTab=e=>{if("subitem"===e.type)return l.createElement(Ft,a()({},this.props,e,{formatSetting:"subitem"}))},this.renderSubitemV2Tab=e=>{if("subitemV2"===e.type)return l.createElement(st,a()({},this.props,{feature:"subitem"}))},this.renderArrowsByTab=e=>{if("arrowsBy"===e.type)return l.createElement(Ft,a()({},this.props,e,{formatSetting:"timeline_arrows_by"}))},this.renderDependencies=e=>{if("dependencies"===e.type)return l.createElement(st,a()({},this.props,{feature:"timeline_arrows_by"}))},this.renderRelationFeaturesAdvancedSettings=e=>{if("relationFeaturesAdvancedSettings"===e.type)return l.createElement(Mt,a()({},this.props,{feature:e.feature}))},this.renderGithubConfigTab=e=>{if("githubConfig"===e.type)return l.createElement(b.Z,a()({},this.props,{property:e.property}))},this.renderFiltersTab=()=>l.createElement(Xc,this.props),this.renderFilterTab=e=>{if("filter"===e.type)return l.createElement(Hc,this.props)},this.renderCreateFilterTab=()=>l.createElement(Nc,this.props),this.renderCreateSortTab=()=>l.createElement(Wc,this.props),this.renderSortTab=()=>l.createElement(gd,this.props),this.renderAutomationSettingsTab=e=>{if("automationSettings"===e.type)return l.createElement(mr,a()({},this.props,{tabSettings:e}))},this.renderAutomationCreateSettingsTab=e=>{if("automationCreateSettings"!==e.type)return;const{collectionContextStore:t,collectionSettingsStore:o}=this.props;return i()(ys,{collectionContextStore:t,collectionSettingsStore:o,type:"create"})},this.renderAutomationEditSettingsTab=e=>{if("automationEditSettings"!==e.type)return;const{collectionContextStore:t,collectionSettingsStore:o}=this.props,{automationId:n}=e;return i()(ys,{automationId:n,collectionContextStore:t,collectionSettingsStore:o,type:"update"})},this.renderSlackAutomationsTab=e=>{if(!(0,S.F6)())return;if("slackAutomations"!==e.type)return;const{collectionContextStore:t,collectionSettingsStore:o}=this.props;return i()(ar,{collectionContextStore:t,collectionSettingsStore:o})},this.renderCreateSlackAutomationTab=()=>{if(!(0,S.F6)())return;const{collectionContextStore:e,collectionSettingsStore:t}=this.props;return i()(fs,{type:"create",collectionContextStore:e,collectionSettingsStore:t})},this.renderEditSlackAutomationTab=e=>{if(!(0,S.F6)())return;if("editSlackAutomation"!==e.type)return;const{collectionContextStore:t,collectionSettingsStore:o}=this.props,{automationId:n,automationActionId:r}=e;return i()(fs,{type:"update",automationId:n,automationActionId:r,collectionContextStore:t,collectionSettingsStore:o})},this.tabRenderers={main:this.renderMainTab,source:this.renderSourceTab,createViewSource:this.renderCreateViewSourceTab,createSyncedViewSource:this.renderCreateExternalViewSourceTab,selectAccountForExternalSource:this.renderSelectAccountForExternalViewSourceTab,shareSyncedView:this.renderSyncedShareTab,propertyType:this.renderPropertyTypeTab,propertyAiAutofill:this.renderPropertyAiAutofillTab,createView:this.renderCreateViewTab,duplicateExistingView:this.renderDuplicateExistingViewTab,properties:this.renderPropertiesTab,property:this.renderPropertyTab,deletedProperties:this.renderDeletedPropertiesTab,selectRelationSource:this.renderSelectRelationSourceTab,setupRelation:this.renderSetupRelationTab,layout:this.renderLayoutTab,group:this.renderGroupTab,groupByProperty:this.renderGroupByPropertyTab,subitem:this.renderSubitemTab,arrowsBy:this.renderArrowsByTab,githubConfig:this.renderGithubConfigTab,filters:this.renderFiltersTab,groupByNumber:this.renderGroupByNumberTab,filter:this.renderFilterTab,createFilter:this.renderCreateFilterTab,createSort:this.renderCreateSortTab,sort:this.renderSortTab,page:this.renderPageViewTab,createTypedDB:this.renderCreateTypedDBTab,setDatabaseType:this.renderSetDBTypeTab,databaseTypePropertyMapping:this.renderDBTypePropertyMappingTab,automationSettings:this.renderAutomationSettingsTab,automationCreateSettings:this.renderAutomationCreateSettingsTab,automationEditSettings:this.renderAutomationEditSettingsTab,slackAutomations:this.renderSlackAutomationsTab,createSlackAutomation:this.renderCreateSlackAutomationTab,editSlackAutomation:this.renderEditSlackAutomationTab,dependencies:this.renderDependencies,relationFeaturesAdvancedSettings:this.renderRelationFeaturesAdvancedSettings,subitemV2:this.renderSubitemV2Tab},this.handleClose=e=>{(0,y.ZP)({event:e,context:y.Af.CollectionSettingsClick,callback:()=>{const{collectionSettingsStore:e}=this.props;p.E3({collectionSettingsStore:e})}})}}didMountOrUpdate(){const{collectionSettingsStore:e}=this.props,t=(0,h.n)(e),o=this.getCurrentViewType();t&&this.lastTab!==t&&u.r5L(this.environment,{view_type:o,menu:t.type}),this.lastTab=t}renderComponent(){var e,t;const{collectionSettingsStore:o}=this.props,n=(0,h.n)(o);if(n)return i()(_d.Z,{capture:!0,preventType:f.Z.Y},void 0,i()(ss.Z,{capture:!0,onEsc:this.handleClose},void 0,null===(e=(t=this.tabRenderers)[n.type])||void 0===e?void 0:e.call(t,n)))}getCurrentViewType(){const{collectionContextStore:e}=this.props;return e.getViewType()}}kd.displayName="CollectionSettings";const xd=(0,d.injectIntl)(kd)},46978:(e,t,o)=>{o.d(t,{Z:()=>s});var n=o(23174),i=o.n(n),r=o(67294),a=o(24405);function l(e,t){let{isSelected:o}=e;window.__c={n:"RadioButtonIcon"};const{radioButtonStyle:n,dotStyle:l}=(0,a.yK)((e=>({radioButtonStyle:{display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:16,height:16,borderRadius:16,marginRight:8,background:o?e.blueColor:e.whiteButtonBackground,border:o?"none":`1px solid ${e.radioButtonBorder}`,transition:"background 100ms ease-out"},dotStyle:{width:6,height:6,borderRadius:6,background:e.regularInvertedTextColor,transition:"opacity 100ms ease-out",opacity:o?1:0}})),[o]);return r.createElement("div",{ref:t,style:n},i()("div",{style:l}))}const s=r.forwardRef(l)}}]);