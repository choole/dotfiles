"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[8324],{74725:(e,t,o)=>{o.d(t,{O:()=>n});var i=o(67294);function n(e){let{closeHandler:t,ref:o,active:n,excludedSelectors:s,ignoreKeydown:r}=e;const a=(0,i.useRef)(void 0);(0,i.useEffect)((()=>{if(n){const e=e=>{0===e.button&&e.target instanceof Node?a.current=e.target:a.current=void 0},i=e=>{const i=o.current,n=e.target,r=a.current;if(a.current=void 0,i&&n){for(const e of s||[]){const t=document.querySelectorAll(e);for(let e=0;e<t.length;++e){if(t[e].contains(n))return}}r&&(i===r||i.contains(r))||i===n||i.contains(n)||t()}},n=e=>{r||"Esc"!==e.key&&"Escape"!==e.key||t()};return window.addEventListener("mousedown",e),window.addEventListener("click",i),window.addEventListener("keydown",n),()=>{window.removeEventListener("mousedown",e),window.removeEventListener("click",i),window.removeEventListener("keydown",n)}}}),[t,o,n,s,r])}},67706:(e,t,o)=>{o.d(t,{Z:()=>m});var i=o(23174),n=o.n(i),s=o(10434),r=o.n(s),a=o(67294),l=o(24405),c=o(82990),d=o(44532),u=o(58032);function m(e){let{text:t,tooltipText:o,icon:i}=e;window.__c={n:"InlineTextWithIconTooltip"};const s=(0,l.yK)((e=>({icon:{height:"1em",width:"1em",marginRight:"0.25em",fill:e.mediumIconColor,marginBottom:"0.1em"},tooltip:{background:e.contentBackground,boxShadow:e.lightBoxShadow},container:{display:"flex",alignItems:"center",fontWeight:c.Z.fontWeight.regular,color:e.mediumTextColor,fontSize:c.Z.fontSize.UISmall.desktop,textAlign:"center"},text:{display:"inline"}})),[]);return n()(u.Z,{style:s.tooltip,render:e=>a.createElement("div",r()({style:s.text},e),t),renderTooltip:()=>n()("div",{style:s.container},void 0,i(s.icon),n()("div",{},void 0,o)),alignment:d.ZP.Alignment.Start,placement:d.ZP.Placement.Bottom})}},93963:(e,t,o)=>{o.d(t,{z:()=>a});var i=o(23174),n=o.n(i),s=(o(67294),o(24405)),r=o(5366);function a(e){let{color:t,size:o,style:i}=e;window.__c={n:"StatusDot"};const a=(0,r.useIntl)(),l=(0,s.yK)((e=>({dot:{height:o||8,width:o||8,background:t||e.blueColor,flexShrink:0,borderRadius:"100%",pointerEvents:"none",...i}})),[o,t,i]);return n()("div",{role:"img","aria-label":a.formatMessage({id:"statusDot.ariaLabel",defaultMessage:"New"}),style:l.dot})}},45338:(e,t,o)=>{o.r(t),o.d(t,{default:()=>De});var i=o(23174),n=o.n(i),s=o(67294),r=o(1302),a=o(480),l=o(6740),c=o(97511),d=o(33125),u=o(81954),m=o(24405),p=o(53397),g=o(27006),f=o(21202),h=o(82990),v=o(5366),S=o(54564),b=o(47307),y=o(96514),w=o(9953),x=o(4083),C=o(61045),k=o(98104),M=o(12359),R=o(11368),I=o(78089),D=o(65598),Z=o(16402),L=o(89574),E=o(61766),T=o(87404),B=o(96049),F=o(68216),A=o(74136),_=o(64369),P=o(42402),N=o(67706),V=o(65085),K=o(65187),O=o(10434),U=o.n(O),z=(o(57658),o(96486)),W=o.n(z),H=o(15145),j=o(41432),$=o(19889),X=o(97880),q=o(43132),G=o(95477),J=o(43250),Q=o(87279),Y=o(33665),ee=o(79315),te=o(52275),oe=o(31945),ie=o(73063),ne=o(78140),se=o(32163),re=o(72495),ae=o(58032),le=o(83182),ce=o(82899);function de(e){window.__c={n:"CommentActionGroup"};const{discussionLocation:t}=e,o=(0,v.useIntl)(),i=(0,a.O7)(),r=i.device,l=(0,s.useRef)(null),d=(0,c.l)(),m=(0,u.VK)((()=>Boolean(e.discussionStore.getResolved())),[e.discussionStore]),f=(0,u.VK)((()=>e.store.isDefined()),[e.store]),h=(0,u.VK)((()=>{var e;return null===(e=ee.default.state.currentUserStore)||void 0===e?void 0:e.id}),[]),b=(0,u.VK)((()=>{const t=e.store.getCreatedById();return e.store.getCreatedByTable()===$.KJ&&h===t}),[h,e.store]),w=(0,u.VK)((()=>{var e;const t=null===(e=ee.default.state.currentSpaceStore)||void 0===e?void 0:e.getRole();return t&&g.zz(t)}),[]),x=(0,u.VK)((()=>e.blockStore.getRole()),[e.blockStore]),C=(0,u.VK)((()=>{var e;return null==d||null===(e=d.publicEditModeStore.state)||void 0===e?void 0:e.permission}),[null==d?void 0:d.publicEditModeStore]),k="comment_only"===x||"comment"===C;if(!f||!h)return null;const R=()=>{M.createAndCommit({userAction:"Comment.handleReopen",environment:i,perform:t=>{y.bh({environment:i,discussionStore:e.discussionStore,transaction:t,discussionLocation:e.discussionLocation})}})},I=t=>{M.createAndCommit({userAction:"Comment.handleResolve",environment:i,perform:t=>{y.DX({environment:i,discussionStore:e.discussionStore,transaction:t,discussionLocation:e.discussionLocation})}}),S.Xv(),null==t||t.stopPropagation()},D=()=>{var t,o;const n=e.store.getParentStore();if(!n||null==n||!n.isDefined())return null;let s=n.getParentStore();if(null===(t=s)||void 0===t||!t.isDefined())return null;var r;s.getType()===j.Ti.tableRow&&(s=null===(r=s)||void 0===r?void 0:r.getParentBlockStore());if(null===(o=s)||void 0===o||!o.isDefined())return null;const a=s.getModel().getRenderUrl({baseUrl:G.default.domainBaseUrl,getRecordModel:e.store.getRecordModel,discussionId:n.id,pageVisitSource:H.tY.CopyLink});q.RD({environment:i,stringValue:a,copiedMessage:q.tq.copiedLinkToClipboard})};if(!i.currentUser.isLoggedIn())return null;const Z=x&&g.rz(x);if(Z)return null;const L=e.isFirstComment&&"comment_unfurl"!==t&&!r.isMobile&&!k&&!Z,E=[];!r.isMobile||k||Z||(m?E.push("reopen"):E.push("resolve")),b&&E.push("edit"),e.isFirstComment&&E.push("copyLink"),(b||w)&&E.push("delete");const T=E.length>0;return T||L||e.canShowReactions?s.createElement(oe.ZP,{ref:l,popupType:r.isMobile?oe.Z4.SlideUp:oe.Z4.Popup,buttonPopupStore:e.buttonPopupStore,placementToOrigin:oe.pO.Right,stopClickPropagation:!0,renderOrigin:s=>n()(ue,{buttonConfig:{resolve:{visible:L,resolved:m,onResolve:I,onReopen:R},react:{visible:e.canShowReactions,onReact:()=>{var n;(0,ce.openEmojiMenuForReaction)(i,o,e.store,(null===(n=l.current)||void 0===n?void 0:n.getAnchor())??null,t,e.handleReaction)}},moreActions:{visible:T}},visible:e.visible,buttonPopupEvents:s,discussionLocation:e.discussionLocation,store:e.store}),render:t=>{let o;o=r.isMobile?{menuType:Q.og.ActionSheet}:{menuType:Q.og.Popup};const i=E.map((t=>"reopen"===t?{key:"reopen",render:e=>s.createElement(te.Z,U()({},e,{icon:p.Z.arrowLeft({height:16,width:16}),title:n()(v.FormattedMessage,{id:"comment.reopenDiscussion.button",defaultMessage:"Re-open discussion"})})),action:R}:"resolve"===t?{key:"resolve",render:e=>s.createElement(te.Z,U()({},e,{icon:p.Z.thinCheck({height:16,width:16}),title:n()(v.FormattedMessage,{id:"comment.resolveDiscussion.button",defaultMessage:"Resolve comments"})})),action:()=>I()}:"edit"===t?{key:"edit",render:e=>s.createElement(te.Z,U()({},e,{icon:p.Z.pencil({height:16,width:16}),title:n()(v.FormattedMessage,{id:"comment.editComment.button",defaultMessage:"Edit comment"})})),action:e.handleEditComment}:"delete"===t?{key:"delete",render:e=>s.createElement(te.Z,U()({},e,{icon:p.Z.trash({height:16,width:16}),title:n()(v.FormattedMessage,{id:"comment.deleteComment.button",defaultMessage:"Delete comment"})})),action:e.handleDeleteComment}:"copyLink"===t?{key:"copyLink",render:e=>s.createElement(te.Z,U()({},e,{icon:p.Z.link({height:16,width:16}),title:n()(v.FormattedMessage,{id:"comment.copyLinkToDiscussion.button",defaultMessage:"Copy link to discussion"})})),action:D}:void(0,X.t1)(t)));return n()("div",{className:J.G6g},void 0,s.createElement(ne.Z,o,n()(se.Z,{type:se.i.Vertical,initialFocus:void 0,onAccept:t.close,sections:W().compact([i.length&&{key:0,render:e=>s.createElement(re.Z,e),items:i}])}),!r.isMobile&&n()(re.Z,{topBorder:!0,disableDesktopPadding:!1},void 0,n()(le.Z,{title:n()(v.FormattedMessage,{defaultMessage:"Learn about comments",id:"comments.learn"}),href:(0,Y.UY)("guides.comments"),analyticsFrom:"comments"}))))}}):null}function ue(e){window.__c={n:"ActionGroupOrigin"};const{buttonPopupEvents:t,discussionLocation:o}=e,{resolved:i,onResolve:r,onReopen:l}=e.buttonConfig.resolve,c=(0,a.O7)().device,d=(0,m.yK)((t=>({addIcon:{width:15,fill:t.mediumIconColor},container:{display:"flex",boxShadow:t.lightBoxShadow,position:"absolute",flexShrink:0,padding:"2px",backgroundColor:t.buttonGroupBackground,...c.isMobile?{borderRadius:3,marginTop:4,right:16}:{marginRight:"margin_comments"===o?0:8,marginTop:"updates_sidebar"===e.discussionLocation?6:0,right:"margin_comments"===o?12:16,top:"margin_comments"===o?6:0,opacity:e.visible?1:0,gap:1,borderRadius:4,transition:"opacity 100ms ease-out",zIndex:1}}})),[c.isMobile,o,e.discussionLocation,e.visible]);return n()("div",{style:d.container},void 0,e.buttonConfig.react.visible&&n()(ae.Z,{renderTooltip:()=>n()(v.FormattedMessage,{defaultMessage:"Add reaction",id:"comment.actions.addReaction.label"}),render:t=>s.createElement(ie.Z,U()({hasBackground:!1,showShadow:!1,icon:()=>p.Z.reactionAdd(d.addIcon),onClick:e.buttonConfig.react.onReact,style:{height:22,width:22,flex:"0 0 auto"}},t))}),e.buttonConfig.resolve.visible&&n()(ae.Z,{renderTooltip:()=>n()(v.FormattedMessage,i?{defaultMessage:"Re-open",id:"comment.actions.reopenButton.label"}:{defaultMessage:"Resolve",id:"comment.actions.resolveButton.label"}),render:e=>s.createElement(ie.Z,U()({hasBackground:!1,showShadow:!1,icon:i?p.Z.reopen:p.Z.resolve,onClick:i?l:r,style:{height:22,width:22,flex:"0 0 auto"}},e))}),e.buttonConfig.moreActions.visible&&n()(ae.Z,{renderTooltip:()=>n()(v.FormattedMessage,{defaultMessage:"More actions",id:"comment.actions.moreActions.label"}),render:e=>s.createElement(ie.Z,U()({},t,e,{hasBackground:!1,showShadow:!1,icon:p.Z.dots,style:{height:22,width:22,flex:"0 0 auto"}}))}))}var me=o(72893),pe=o(95538),ge=o(70203),fe=o(93286),he=o(72747),ve=o(53471),Se=o(68785),be=o(41714),ye=o(69721),we=o(92628),xe=o(30398);function Ce(e){if("image"!==e.getType())return!1;const t=ge.Q(e.getPropertyValue("source"));return void 0!==t&&!(0,pe.y_)(t,".jfif")&&!(0,pe.y_)(t,".webp")}function ke(e){window.__c={n:"CommentContent"};const t=e.discussionFormat===I.O2.Sidebar?he.vW.SidebarComment:he.vW.PageComment,{filmStripFiles:o,embedBlockStores:i}=(0,u.VK)((()=>{if(e.collapsed)return{filmStripFiles:ve.nQ(e.contentStores),embedBlockStores:[]};if(e.discussionFormat===I.O2.Page&&e.contentStores.filter((e=>Ce(e))).length>1){const[t,o]=W().partition(e.contentStores,(e=>Ce(e)));return{filmStripFiles:ve.nQ(t),embedBlockStores:o}}return{filmStripFiles:[],embedBlockStores:e.contentStores}}),[e.contentStores,e.collapsed,e.discussionFormat]),r=i.length>0&&i.map((o=>n()(we.Z,{store:o,analyticsName:"comment_media",blockMenuActions:fe.qq,canTriggerContextMenu:!0,style:{marginTop:8}},o.id,be.Z.hasRendererForStore(o)?n()(be.Z,{disabled:!1,disableDrag:!0,store:o,disableResizers:!0,preserveScale:!0,inlineContentStyle:{height:"auto",width:"auto",maxHeight:240,maxWidth:"100%",cursor:"zoom-in"},blockLocation:t,iconSvg:()=>n()(Se.Z,{style:{marginRight:10}}),onRemoveBlockFromComment:e.onRemoveContent},void 0,n()(v.FormattedMessage,{defaultMessage:"Uploading file...",id:"comment.embeddedFile.uploadInProgressMessage"})):n()(ye.Z,{disabled:!1,store:o})))),a=o.length>0&&n()(xe.Z,{files:o,disableRemove:!0});return s.createElement(s.Fragment,null,a,r)}function Me(){window.__c={n:"CommentNewBar"};const e=(0,m.yK)((e=>({newBarLine:{height:"0px",borderBottom:`1px solid ${e.darkDividerColor}`,width:"100%",marginLeft:0},newBarWrapper:{color:e.mediumTextColor,textTransform:"uppercase",fontSize:10.5,letterSpacing:.5,fontWeight:h.Z.fontWeight.semibold,display:"flex",alignItems:"center",marginRight:16,marginLeft:16,marginTop:10,marginBottom:10},newBarText:{padding:"0 10px"}})),[]);return n()("div",{style:e.newBarWrapper},void 0,n()("div",{style:e.newBarLine}),n()("div",{style:e.newBarText},void 0,n()(v.FormattedMessage,{id:"comment.newIndicator.label",defaultMessage:"New comments"})),n()("div",{style:e.newBarLine}))}var Re=o(19195);function Ie(e){switch(e){case"margin_comments":return 0;case"updates_sidebar":return 35;case"comment_unfurl":return 29;default:return 32}}const De=function(e){window.__c={n:"Comment"};const{store:t,discussionContext:o,maxLines:i,discussionLocation:O}=e,U=(0,a.O7)(),z=(0,v.useIntl)(),[W,H]=(0,s.useState)(!1),[j,$]=(0,s.useState)(!1),[X,q]=(0,s.useState)(!1),G=Ie(O),J=(0,u.VK)((()=>e.store.isDefined()?new T.Z(U,e.store.getSpaceId()):void 0),[U,e.store]),Q=(0,u.VK)((()=>D.le(e.store).filter((e=>(0,F.Vh)(e,{table:f.iU,id:e.id},"alive").getValue()))),[e.store]),Y=(0,u.VK)((()=>e.discussionStore.getResolved()),[e.discussionStore]),ee=(0,u.VK)((()=>null==J?void 0:J.state.files),[J]),te=(0,u.VK)((()=>null==J?void 0:J.state.textStore),[J]),oe=(0,s.useCallback)((e=>{const t=e.target;t instanceof HTMLElement&&(0,l.E)(t)&&$(!0)}),[]),ie=(0,s.useCallback)((()=>{$(!1)}),[]),ne=(0,s.useCallback)((()=>{B.Z.state||q(!0)}),[]),se=(0,s.useCallback)((()=>{q(!1)}),[]),re=(0,c.l)(),ae=(0,u.qz)(void 0,E.Z),le=(0,u.VK)((()=>ae.state.open),[ae]),ue=(0,u.VK)((()=>{const t=e.discussionStore.getComments();return Boolean(t&&t[0]===e.store.id)}),[e.discussionStore,e.store.id]),pe=(0,u.VK)((()=>{var t;const o=e.blockStore.getRole(),i=ue&&"comment_unfurl"!==O,n=o&&g.rz(o),{device:s}=U,r="comment_only"===o||re&&"comment"===(null===(t=re.publicEditModeStore.state)||void 0===t?void 0:t.permission),a=i&&!s.isMobile&&!r&&!n;return X||j||e.hoveringDiscussion&&i||le||s.isMobile||e.showResolveButtonByDefaultIfPossible&&a}),[e.blockStore,e.hoveringDiscussion,e.showResolveButtonByDefaultIfPossible,ue,O,U,re,X,j,le]),ge=(0,s.useContext)(R.Ue),fe=(0,u.VK)((()=>{const e=t.getCreatedByPointer();return e?{createdByPointer:e,lastEditedTime:t.getLastEditedTime(),createdTime:t.getCreatedTime(),text:t.getText(),reactions:t.getUserVisibleReactions()}:null}),[t]),he=(0,u.VK)((()=>{if(!fe)return null;const e=F.t1.createChildStore(t,fe.createdByPointer);return{displayName:e.getDisplayName(z),store:e}}),[fe,z,t]),ve=(0,s.useCallback)((()=>{M.createAndCommit({userAction:"Comment.deleteComment",environment:U,perform:t=>{y.YF({environment:U,commentStore:e.store,transaction:t,discussionLocation:O})},skipUpdatingEditedMetadata:!0})}),[U,e.store,O]),Se=(0,s.useCallback)((async()=>{await b.confirmUserAction({message:n()(v.FormattedMessage,{defaultMessage:"Would you like to delete this comment?",id:"comment.confirmDialog.deleteComment.prompt"}),acceptLabel:n()(v.FormattedMessage,{defaultMessage:"Delete",id:"comment.confirmDialog.deleteComment.deleteButton.label"})})&&(ve(),S.Xv(),x.Cd(U))}),[ve,U]),be=(0,s.useCallback)((async t=>{const o=D.zP(e.store).getValue(),i=D.le(e.store).filter((e=>e.id!==t.id)),n=o&&o.length>0,s=0===i.length;!n&&s?(await Se(),H(!1)):M.createAndCommit({userAction:"Comment.handleRemoveFileFromActions",environment:U,perform:o=>{y.Zo({commentStore:e.store,fileBlocks:[t],transaction:o})}})}),[U,Se,e.store]),ye=(0,s.useCallback)((()=>{Ze.current&&C.bx({element:Ze.current,scrollers:{verticalScroller:null==ge?void 0:ge.verticalScroller},vertical:{reveal:"closest"},horizontal:void 0,animate:!0})}),[ge]),we=(0,s.useCallback)((async()=>{if(!J)return;const t=D.zP(e.store).getValue()||[],o=J.state.textStore;M.createAndCommit({userAction:"Comment.handleEditComment",environment:U,perform:e=>{w.sO({store:o,value:t,transaction:e})}}),H(!0),await r.default.afterNextFlush(),await r.default.afterNextFlush(),k.NX({store:o})}),[J,U,e.store]),xe=(0,s.useCallback)((async()=>{if(!J)return!1;if(!(0,I.hu)(J,e.store))return H(!1),!0;if(await b.confirmUserAction({message:n()(v.FormattedMessage,{defaultMessage:"Do you want to discard this edit?",id:"comment.confirmDialog.discardEdit.prompt"}),acceptLabel:n()(v.FormattedMessage,{defaultMessage:"Discard",id:"comment.confirmDialog.discardEdit.discardButton.label"})}))return H(!1),!0;return!1}),[J,e.store]),Ce=(0,s.useCallback)((async()=>{const t=null==te?void 0:te.getValue();t&&t.length>0||ee&&ee.length>0?M.createAndCommit({userAction:"Comment.handleSubmitEdit",environment:U,perform:o=>{y.DF({environment:U,store:e.store,text:t||[],transaction:o,discussionLocation:O,files:ee||[]})}}):await Se(),H(!1)}),[ee,te,O,U,Se,e.store]),De=(0,s.useRef)(null),Ze=(0,s.useRef)(null);(0,d.c)(L.Z,(()=>({edit:we,handleCancelEdit:xe,getNode:()=>De.current,isEditing:()=>W,discussionLocation:O,commentId:e.store.id})),[we,xe,W,O,e.store.id]);const Le=I.Je[O],Ee=null==fe?void 0:fe.text,Te=void 0!==Ee&&Ee.length>0,Be=Te&&(0,I.p9)(Ee),Fe=function(e){let{discussionLocation:t,isAllEmojis:o,avatarSize:i}=e;const n=Ie(t);return(0,m.yK)((e=>({container:{flexGrow:"comment_unfurl"===t?1:void 0},comment:{display:"flex",alignItems:"flex-start",position:"relative",fontSize:14},avatar:{marginRight:10,marginTop:"comment_unfurl"===t?16:2,userSelect:"none",WebkitUserSelect:"none"},userRow:{alignItems:"center",position:"relative",display:"flex",flexDirection:"row",padding:"margin_comments"===t?"8px 14px 0px 13px":"comment_unfurl"===t?"6px 16px 0px 10px":"6px 16px 0px 18px",marginTop:"comment_unfurl"===t?-11:void 0,userSelect:"none",WebkitUserSelect:"none"},placeholder:{height:8,width:81,borderRadius:3,background:e.lightDividerColor},unfurlLessWrapper:{color:e.regularTextColor,fontWeight:h.Z.fontWeight.medium,paddingLeft:n,marginLeft:7},unfurlMoreWrapper:{color:"comment_unfurl"===t?e.regularTextColor:e.mediumTextColor,fontWeight:"comment_unfurl"===t?h.Z.fontWeight.medium:void 0},attachIcon:{width:18,height:18,fill:e.mediumIconColor},text:{cursor:"comment_unfurl"!==t?"text":void 0,paddingLeft:n,marginLeft:"comment_unfurl"===t?8:void 0,...o?{fontSize:32}:{}},textWrapper:{padding:"margin_comments"===t?"4px 14px":"0px 16px 3px 16px",marginTop:"comment_unfurl"===t?"-14px":void 0},reactionContainer:{marginLeft:"margin_comments"===t?14:50,marginRight:14,marginTop:4,marginBottom:4},attachmentContainer:{padding:"0px 16px 6px 54px",marginTop:-12,display:"flex",alignItems:"center"},timestamp:{margin:"0 6px",flexBasis:"comment_unfurl"!==t?140:void 0,whiteSpace:"normal",flexGrow:"updates_sidebar"===t||"comment_unfurl"===t?void 0:1,display:"inline"},commentAttachment:{margin:"0px 14px 0px "+("margin_comments"===t?"14px":"50px")},commentAuthorPlaceholder:{marginRight:8,marginTop:"comment_unfurl"===t?14:2,height:i,width:i,borderRadius:20,flexShrink:0}})),[t,n,o,i])}({discussionLocation:O,isAllEmojis:Be,avatarSize:Le});if(!J)return null;if(!fe||!he)return null;const Ae="comment_unfurl"!==O;let _e,Pe;fe.lastEditedTime&&fe.lastEditedTime>fe.createdTime+100?(_e=n()(v.FormattedMessage,{defaultMessage:"{lastEditedTime} (edited)",id:"comment.editedAtTime.label",values:{lastEditedTime:(0,Z.IS)(fe.lastEditedTime)}}),Pe=(0,Z.uy)(fe.lastEditedTime)):(_e=(0,Z.IS)(fe.createdTime),Pe=(0,Z.uy)(fe.createdTime));const Ne=n()("div",{style:Fe.commentAttachment},void 0,n()(ke,{contentStores:Q,onRemoveContent:be,discussionFormat:(0,I.ad)(O),collapsed:e.collapsed}));return s.createElement("div",{ref:De,onClick:e=>W&&e.stopPropagation(),style:Fe.container},e.showNewBar&&n()(Me,{}),n()("div",{style:Fe.comment,onFocus:oe,onBlur:ie,onMouseMove:ne,onMouseLeave:se},void 0,n()("div",{style:{flexGrow:1,minWidth:0}},void 0,n()("div",{style:Fe.userRow},void 0,n()(me.S,{authorStore:null==he?void 0:he.store,avatarSize:Le,avatarStyle:Fe.avatar,placeholderStyle:Fe.commentAuthorPlaceholder}),n()("div",{style:{overflow:"hidden"}},void 0,n()("span",{style:{fontWeight:h.Z.fontWeight.semibold,whiteSpace:"normal"}},void 0,he.displayName||n()("span",{style:Fe.placeholder})),n()(_.Z,{isSmall:!0,isSecondaryColor:!0,isMultiline:!0,style:Fe.timestamp},void 0,n()(N.Z,{text:_e,tooltipText:Pe,icon:p.Z.calendar})),"comment_unfurl"===O&&Y&&n()("div",{style:{display:"inline-flex"}},void 0,n()(A.Z,{},void 0,n()(v.FormattedMessage,{id:"comment.unfurl.resolvedStatus",defaultMessage:"Resolved"}))))),n()("div",{style:{paddingLeft:G+15,paddingRight:16}},void 0,o),W?n()("div",{style:(0,I.ad)(O)===I.O2.Margin?{marginTop:8}:void 0},void 0,n()(Re.default,{containerStyle:{padding:"margin_comments"===O?"0px 14px 4px 14px":"0px 10px 0px 45px"},showAvatar:!1,parentStore:e.store,blockStore:e.blockStore,onCancel:xe,onSubmit:Ce,discussionInputStore:J,isEditingExistingComment:!0,isMobileSlideUpMenu:!0,shouldSaveUnsentComments:!1,commentStore:e.store,discussionFormat:(0,I.ad)(O),canDrop:!0})):s.createElement(s.Fragment,null,Te&&!W&&n()("div",{style:Fe.textWrapper},void 0,n()(V.Z,{onMore:"comment_unfurl"===O?void 0:()=>{},lessElement:"comment_unfurl"===O?n()("span",{className:"notion-link",style:Fe.unfurlLessWrapper},void 0,n()(v.FormattedMessage,{id:"comments.showLessLabel",defaultMessage:"show less"})):void 0,moreElement:n()(P.Z,{disableUnderline:!0,style:Fe.unfurlMoreWrapper},void 0,"…"," ",n()("span",{},void 0,n()(v.FormattedMessage,{id:"text.truncated.showMoreLabel",defaultMessage:"more"}))),maxLines:e.collapsed?i:void 0},void 0,n()(K.Z,{style:Fe.text,store:D.zP(e.store),disabled:!0,disableDateMentions:!0,disableEquationInteraction:!0}))),"comment_unfurl"!==O?Ne:!Te&&n()("div",{style:Fe.attachmentContainer},void 0,n()("div",{style:{marginRight:5}},void 0,p.Z.attachFile(Fe.attachIcon)),n()(v.FormattedMessage,{defaultMessage:"{numberOfAttachments, plural, one {{numberOfAttachments} attachment} other {{numberOfAttachments} attachments}}",values:{numberOfAttachments:Q.length},id:"comment.unfurl.attachments.title"}))),s.createElement("div",{ref:Ze},Ae&&fe.reactions.length>0&&n()("div",{style:Fe.reactionContainer},void 0,n()(ce.default,{parentStore:e.store,discussionLocation:O})))),"comment_unfurl"!==O&&!W&&n()(de,{store:e.store,discussionStore:e.discussionStore,blockStore:e.blockStore,discussionLocation:O,visible:pe,isFirstComment:ue,buttonPopupStore:ae,canShowReactions:Ae,handleEditComment:we,handleDeleteComment:Se,handleReaction:ye})))}},72893:(e,t,o)=>{o.d(t,{S:()=>g});var i=o(23174),n=o.n(i),s=(o(67294),o(81954)),r=o(24405),a=o(54368),l=o(77420),c=o(19889),d=o(97880),u=o(83420),m=o(70301),p=o(45653);function g(e){let{authorStore:t,avatarSize:o,avatarStyle:i,placeholderStyle:g}=e;window.__c={n:"CommentAuthorAvatar"};const f=(0,r.Fg)(),h=(0,s.VK)((()=>(0,u.TL)(t)),[t]);return h.asActor?h.table===c.KJ?n()(p.Z,{hasTooltip:!0,userValue:h.asActor,style:i,size:o,avatarShouldShowShadow:!0}):h.table===l.cZ?n()(m.Z,{botValue:h,size:o,style:i}):h.table===a.y?n()("div",{style:{...g,background:f.lightDividerColor}}):void(0,d.t1)(h):n()("div",{style:{...g,background:f.lightDividerColor}})}},97543:(e,t,o)=>{o.r(t),o.d(t,{default:()=>te});var i=o(23174),n=o.n(i),s=o(96486),r=o.n(s),a=o(67294),l=o(1302),c=o(480),d=o(33125),u=o(81954),m=o(24405),p=o(70203),g=o(97880),f=o(5366),h=o(47307),v=o(96514),S=o(17503),b=o(61045),y=o(98104),w=o(12359),x=o(78089),C=o(65598),k=o(89574),M=o(46351),R=o(95802),I=o(34859),D=o(87404),Z=o(96049),L=o(45589),E=o(83575),T=o(18647),B=o(92628),F=o(93963),A=o(45338),_=o(13991),P=o(41432),N=o(99036),V=o(8848),K=o(83212),O=o(55384),U=o(82990),z=o(33929),W=o(2456);const H=new Set([P.Ti.toggle,P.Ti.bulletedList,P.Ti.numberedList,P.Ti.quote,P.Ti.toDo,P.Ti.code,P.Ti.callout,P.Ti.header,P.Ti.subHeader,P.Ti.subSubHeader,P.Ti.tableRow]);function j(e){window.__c={n:"DiscussionContext"};const t=(0,m.Fg)(),o=(0,u.VK)((()=>{var t;return e.store.isDefined()?null===(t=e.store.getParentStore())||void 0===t?void 0:t.getValue():null}),[e.store]),i=(0,u.VK)((()=>e.blockStore.getSpaceId()),[e.blockStore]),s=(0,u.VK)((()=>{if(!e.store.isDefined())return;const t=e.store.getContext();if(!t)return;return p.VP(t,(t=>!p.xw(t)||p.h1(t)===e.store.id))}),[e.store]);function r(o){if(!s)return null;const r={display:"flex",alignItems:"flex-start",fontSize:14,marginTop:8,marginBottom:8,color:t.mediumTextColor,width:"100%"},a=N.Kc(z.default.getIntl()).title;return a?n()("div",{style:r},void 0,n()("div",{style:{display:"flex",width:"100%"}},void 0,n()($,{}),(o=>{let{textValue:s,propertySchema:r,discussionParentValue:a}=o;const l=n()("div",{style:{maxHeight:72,overflow:"hidden",lineHeight:"24px"}},void 0,n()(W.KX,{value:{value:s,spaceId:i},propertySchema:r,labeled:!1,rootStore:e.blockStore,disableStyleAnnotations:!0,disableDateStyleAnnotations:!0}));if(!a)return l;const c=a.type;return c===P.Ti.code?n()(K.Z,{title:(0,W.SP)(a),theme:t,style:{marginTop:0,marginBottom:0}},void 0,n()("span",{style:{fontFamily:U.Z.getCompositeFontFamily(_.SP).mono,fontSize:12,tabSize:2}},void 0,l)):(0,W.pH)(c)?n()(K.Z,{title:(0,W.pH)(c),theme:t,style:{marginTop:0,marginBottom:0}},void 0,l):l})({textValue:s,discussionParentValue:o,propertySchema:a}))):null}if("updates_sidebar"===e.discussionLocation){if(!o)return null;if("text"!==o.type)return n()("div",{onClick:e.onClick,style:{display:"flex",cursor:O.kk.fromBlock(o).isType(P.Zi)?"text":void 0}},void 0,s&&H.has(o.type)?r(o):n()("div",{style:{display:"flex",marginTop:8,marginBottom:8,width:"100%"}},void 0,n()($,{}),n()(W.ZP,{blockValue:o,rootStore:e.blockStore,blockPreviewLocation:"comments_sidebar"})))}return n()("div",{onClick:e.onClick,style:{cursor:"text"}},void 0,r())}function $(){return n()("div",{style:{width:3,borderRadius:3,marginLeft:2,marginRight:8,background:V.DB,flexShrink:0,paddingBottom:2}})}var X=o(53397),q=o(27006),G=o(58032),J=o(19195);const Q=a.forwardRef(((e,t)=>{window.__c={n:"DiscussionPopupInput"};const o=(0,c.O7)(),{format:i,role:s,showMoreCommentsButton:r,onMoreCommentsClick:l,inputVisible:d}=e,p=s&&q.rz(s),g=o.currentUser.isLoggedIn(),{device:h,WindowSizeStore:v}=o,S=(0,m.Fg)(),b=(0,u.VK)((()=>({paddingLeft:h.isMobile&&v.getSafePaddingLeftCSS(18)||i===x.O2.Margin&&9||13,paddingRight:h.isMobile&&v.getSafePaddingLeftCSS(14)||i===x.O2.Margin&&12||16})),[v,h.isMobile,i]),y=(0,m.yK)((t=>({container:{paddingTop:e.collapsed?1:4,paddingLeft:b.paddingLeft,paddingRight:b.paddingRight,paddingBottom:(h.isMobile&&i!==x.O2.Page?8:i===x.O2.Sidebar&&14)||0,position:"relative"},moreCommentsWrapper:{position:"absolute",display:"flex",justifyContent:"center",alignItems:"flex-start",zIndex:1,left:0,right:0,marginTop:-32,height:30,background:`linear-gradient(to bottom, ${t.contentBackgroundTransparent} 0px, ${t.selectedMarginDiscussionBackground} 30px`},tooltip:{...(0,G.J)(t,!1),cursor:"pointer",display:"flex",justifyContent:"center",alignItems:"center"}})),[b,h.isMobile,i,e.collapsed]);return a.createElement(a.Fragment,null,g&&!p&&n()("div",{style:y.container},void 0,r&&n()("div",{style:y.moreCommentsWrapper},void 0,n()("div",{style:y.tooltip,onClick:l},void 0,n()("div",{style:{marginRight:5}},void 0,X.Z.arrowDownSmall({fill:S.regularInvertedTextColor,height:12,width:12})),n()(f.FormattedMessage,{defaultMessage:"More",id:"discussion.moreMessageTooltip"}))),d&&a.createElement(J.default,{showAvatar:"margin_comments"!==e.discussionLocation,containerStyle:h.isMobile?void 0:{paddingLeft:5,paddingRight:2},parentStore:e.store,onCancel:e.onCancel,onSubmit:e.onSubmit,discussionInputStore:e.discussionInputStore,isMobileSlideUpMenu:!1,shouldSaveUnsentComments:!0,onEditPreviousComment:e.onEditPreviousComment,inReplyToDiscussionId:e.store.id,discussionFormat:e.format,showCtaButtons:e.showCtaButtons,ref:t,onFileUploaded:e.onFileUploaded})))}));var Y=o(62385);function ee(e){window.__c={n:"DiscussionShowAllButton"};const t=(0,m.yK)((t=>({newBarLine:{height:"0px",borderBottom:`1px solid ${t.darkDividerColor}`,marginLeft:0,flex:1},moreCommentsWrapper:{color:t.lightTextColor,fontSize:14,paddingLeft:e.insetButton?38:2,flexGrow:1,display:"flex",alignItems:"center"},button:{padding:"14px 12px",margin:"1px 0",borderRadius:0,fontSize:14,color:t.mediumTextColor,width:"100%",justifyContent:"space-between"},buttonHovered:{background:t.focusDiscussionInputBackground}})),[e.insetButton]);return e.count<=0?null:n()(Y.Z,{style:t.button,onClick:e.onClick,hoveredStyle:t.buttonHovered},"show",n()("div",{style:t.moreCommentsWrapper},void 0,n()(f.FormattedMessage,{defaultMessage:"{moreCommentsNumber, plural, one {{moreCommentsNumber} more comment} other {{moreCommentsNumber} more comments}}",id:"discussion.showMoreCommentsSidebarButton.label",values:{moreCommentsNumber:e.count}})))}function te(e){window.__c={n:"Discussion"};const t=(0,a.useRef)(null),o=(0,c.O7)(),i=(0,u.VK)((()=>C.D4(e.store)),[e.store]),s=(0,u.VK)((()=>i.filter((e=>e.isDefined()))),[i]),_=(0,a.useRef)(e.discussionInputStore||new D.Z(o,e.store.pointer.spaceId)).current,P=(0,u.VK)((()=>(0,x.n9)(_)),[_]),N=(0,u.VK)((()=>e.store.isDefined()),[e.store]),V=(0,u.VK)((()=>e.store.getResolved()),[e.store]),[K,O]=(0,a.useState)(!1),[U,z]=(0,a.useState)(!1),[W,H]=(0,a.useState)(!0),$=(0,u.qz)(void 0,L.Z),X=(0,u.VK)((()=>$.state.clientRect),[$]),q=e.format===x.O2.Sidebar,G=e.format===x.O2.Margin,J=(0,a.useRef)(null);(0,d.c)(M.Z,(()=>({isSidebarFormat:()=>q,isMarginFormat:()=>G,getStore:()=>e.store,getInputStore:()=>_,getNode:()=>J.current})),[q,G,e.store,_]);const Y=(0,u.VK)((()=>{if(!q)return;return(0,x.NI)(e.store).find((t=>S.t({discussionStore:e.store,commentStore:t})))}),[q,e.store]),te=(0,a.useRef)(Y),ie=(0,u.VK)((()=>{const{showAllRepliesAfterTimestamp:t}=e,o=(()=>{var o;if(U||s.length<=5||"block_menu"===e.discussionLocation||"page_discussion"===e.discussionLocation)return s;const i=[t,null===(o=te.current)||void 0===o?void 0:o.getCreatedTime(),null==Y?void 0:Y.getCreatedTime()].filter(g.$K),n=i.length>0?Math.min(...i):void 0;if(n){const e=s.filter((e=>(e.getCreatedTime()||0)>n)),t=s.filter((e=>(e.getCreatedTime()||0)<=n));return t.length<=5?s:[...r().takeRight(t,2),...e]}return r().takeRight(s,2)})(),i=new Set(o.map((e=>e.id))),n=s.filter((e=>!i.has(e.id))),a=n.length;return{commentStores:s,commentsToShow:o,commentsToCollapse:n,remainingCommentCount:a,shouldRenderFirstComment:a>0}}),[s,Y,e,U],{useDeepEqual:!0}),ne=(0,a.useCallback)((()=>{if(!e.store.isDefined())return;const t=e.store.getContext();if(!t)return;return p.VP(t,(t=>!p.xw(t)||p.h1(t)===e.store.id))}),[e.store]),se=(0,u.VK)((()=>{if(!q)return;return(0,x.NI)(e.store).find((t=>S.t({discussionStore:e.store,commentStore:t})))}),[q,e.store]),re=a.createRef(),ae=(0,a.useRef)(e.blockStore.clone()).current,le=(0,m.yK)((t=>({discussionWrapper:{...e.format===x.O2.Page&&{margin:"14px -14px 14px"},...e.format===x.O2.Menu&&{paddingTop:10,paddingBottom:12,marginLeft:-2,boxShadow:e.isFirst?"none":`0 -1px 0 ${t.regularDividerColor}`,marginTop:e.isFirst?0:1},...e.format===x.O2.Margin&&{paddingBottom:e.collapsed?7:14,borderRadius:3}}})),[e.collapsed,e.format,e.isFirst]);(0,a.useEffect)((()=>{o.KatexStore.loadIfNeeded(ne)}),[o.KatexStore,ne]);const ce=t=>{const{device:i}=o;if(!i.isMobile)return;if(!e.store.isDefined())return;t.stopPropagation(),t.preventDefault(),E.Z.setState({open:!1});const n=r().compact(R.C.findSelectablesFromIds([e.store.getParentId()])),s=null==n?void 0:n[0];s&&b.NQ({component:s,vertical:{reveal:"bottom"},horizontal:{reveal:"closest"},animate:!0})},de=()=>{const o=(0,x.QT)(i.length);if(!e.collapsed)return a.createElement(T.Z,{style:{display:"flex",flexDirection:"column",maxHeight:500,overflowY:"scroll"},ref:t,type:I.Z.Y,store:$},i.map((t=>n()(A.default,{store:t,discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:K,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,maxLines:o},t.id))));const s=i[0]&&n()(A.default,{store:i[0],discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:K,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,maxLines:o,collapsed:e.collapsed},i[0].id),r=i.length>1&&i[i.length-1]&&n()(A.default,{store:i[i.length-1],discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:K,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,maxLines:o,collapsed:e.collapsed},i[i.length-1].id),l=i.length-2;return a.createElement(a.Fragment,null,s,n()(ee,{insetButton:!G,count:l,onClick:ve}),r)};const ue=(0,u.VK)((()=>e.blockStore.getRole()),[e.blockStore]),me=t.current,pe=(0,u.VK)((()=>(null==me?void 0:me.atScrollEnd())??!0),[me]),ge=W&&!e.collapsed&&G&&X&&t.current&&!pe,fe=()=>{l.default.afterNextFlush((()=>{t.current&&t.current.scrollToBottom({animate:!0})}))},he=r().debounce((()=>{setTimeout((()=>H(!0)),50)}),50),ve=e=>{G||(e.stopPropagation(),z(!0))},Se=()=>{_.reset()};return n()(B.Z,{store:ae,analyticsName:"discussion",canNativeDropOnto:!0,onNativeDrop:async e=>{let{files:t}=e;re.current&&await re.current.uploadFiles(t)},keepTextSelectionOnDrop:!0,shouldShowDropZone:!0},void 0,a.createElement("div",{ref:J,style:le.discussionWrapper,onMouseMove:()=>{Z.Z.state||O(!0)},onMouseLeave:()=>{O(!1)}},function(){if(G)return de();const{commentStores:t,shouldRenderFirstComment:o,commentsToShow:i,commentsToCollapse:s}=ie,r=i.map(((t,i)=>{var s;return n()(A.default,{store:t,discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:K,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,discussionContext:!o&&e.format!==x.O2.Margin&&0===i&&n()(j,{format:e.format,discussionLocation:e.discussionLocation,store:e.store,blockStore:e.blockStore,onClick:ce}),showNewBar:t.id===(null===(s=te.current)||void 0===s?void 0:s.id)&&0!==i},t.id)})),a=o&&n()(A.default,{store:t[0],discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:K,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,discussionContext:e.format!==x.O2.Margin&&N&&n()(j,{format:e.format,discussionLocation:e.discussionLocation,store:e.store,blockStore:e.blockStore,onClick:ce})},t[0].id);return n()("div",{style:{position:"relative"}},void 0,a,q&&se&&n()(F.z,{style:oe}),n()(ee,{insetButton:!G,count:s.length-1,onClick:ve}),r)}(),V?n()("div",{style:{height:8}}):a.createElement(Q,{ref:re,showMoreCommentsButton:!!ge,onMoreCommentsClick:fe,inputVisible:!e.collapsed||!P,store:e.store,format:e.format,discussionInputStore:_,discussionLocation:e.discussionLocation,onCancel:async()=>{if((0,x.hu)(_)){await h.confirmUserAction({message:n()(f.FormattedMessage,{defaultMessage:"Do you want to discard this reply?",id:"discussion.confirmDialog.discardReply.prompt"}),acceptLabel:n()(f.FormattedMessage,{defaultMessage:"Discard",id:"discussion.confirmDialog.discardReplyButton.label"})})?(Se(),e.onDismiss&&e.onDismiss()):(await l.default.afterNextFlush(),y.NX({store:_.state.textStore}))}else Se(),e.onDismiss&&e.onDismiss()},onSubmit:async()=>{H(!1);const{device:t}=o,{store:i,discussionLocation:n}=e;w.createAndCommit({userAction:"Discussion.handleSubmitReply",environment:o,perform:e=>{v.Xi({environment:o,discussionStore:i,textValue:_.state.textStore.getValue()||[],transaction:e,discussionLocation:n,files:_.state.files})}}),Se(),y.ZH(o),fe(),he(),t.isMobile||(await l.default.afterNextFlush(),y.N_({store:_.state.textStore}))},onEditPreviousComment:()=>{const t=o.currentUser.id;if(!t)return;const i=C.D4(e.store).filter((e=>e.getCreatedById()===t)),n=r().last(i);if(!n)return;const s=k.Z.find((t=>t.commentId===n.id&&t.discussionLocation===e.discussionLocation));s&&(y.ZH(o),s.edit())},showCtaButtons:!!G||void 0,onFileUploaded:()=>{const e=R.C.findSelectableFromStore(ae);e&&b.NQ({component:e,vertical:{reveal:"bottom"},horizontal:{reveal:"closest"},animate:!0})},role:ue})))}const oe={marginRight:4,position:"absolute",right:16,top:14}},19195:(e,t,o)=>{o.r(t),o.d(t,{default:()=>ie});var i=o(23174),n=o.n(i),s=o(96486),r=o.n(s),a=o(67294),l=o(1302),c=o(480),d=o(6740),u=o(81954),m=o(24405),p=o(15157),g=o(5366),f=o(50906),h=o(47307),v=o(53471),S=o(65598);var b=o(47798),y=o(993),w=o(98104),x=o(12359),C=o(28020),k=o(43250),M=o(78089),R=o(33929),I=o(68056),D=o(77546),Z=o(80935),L=o(24666);const E=(0,g.defineMessages)({defaultPlaceholder:{defaultMessage:"Add a comment…",id:"discussionInput.defaultPlaceholder.addComment"},pasteFileIntoCommentNotAllowed:{id:"clipboardActions.pasteFileIntoCommentError.message",defaultMessage:"Sorry, you cannot paste files into a comment."},replyInputPlaceholder:{defaultMessage:"Reply...",id:"updateSidebar.placeholder.addComment"}}),T={height:{stiffness:80,damping:12,precision:.001}};var B=o(23063),F=o(37601),A=o(3386),_=o(45653),P=o(92628),N=o(65187),V=o(10434),K=o.n(V),O=o(53397),U=o(61519),z=o(73063),W=o(1892),H=o(58032);const j=function(e){window.__c={n:"CommentActionButton"};const t=(0,c.O7)(),{icon:o,onClick:i,tooltip:s}=e;return n()(W.Z,{capture:!0,render:e=>n()(H.Z,{renderTooltip:()=>s,render:n=>a.createElement(z.Z,K()({ariaLabel:s,icon:o,iconStyle:{width:t.device.isMobile?20:16,height:t.device.isMobile?20:16},style:{marginLeft:t.device.isMobile?16:10},onClick:i},n,e))})})};const $=function(e){window.__c={n:"CommentInputActionBar"};const t=(0,g.useIntl)(),o=(0,c.O7)(),{device:i}=o,s=(0,m.yK)((e=>({icon:{background:e.mediumIconColor,borderRadius:"50%",marginLeft:o.device.isMobile?16:12,pointerEvents:"auto",height:20,width:20},iconHovered:{background:e.lightIconColor}})),[o.device.isMobile]),{canSend:r,visible:l,onSend:d,onCancel:u,isEditing:p,animated:f,onMention:h,onAttach:v,inline:S}=e,b={opacity:l?1:0};return n()(B.Z,{springConfig:T,isVisible:!0,animationStyle:b,render:()=>n()("div",{style:{display:"flex",...S?{flexDirection:"column-reverse",alignItems:"end",marginRight:8}:{flexDirection:"row",position:"absolute",bottom:7,right:12,alignItems:"center"},pointerEvents:l?void 0:"none",...f&&b}},void 0,n()("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"}},void 0,n()(j,{icon:O.Z.attachFile,onClick:v,tooltip:t.formatMessage({id:"discussionInput.uploadFile.button.tooltip",defaultMessage:"Attach file"})}),!i.isMobileBrowser&&n()(j,{icon:O.Z.mention,onClick:h,tooltip:t.formatMessage({id:"discussionInput.insertMention.button.tooltip",defaultMessage:"Mention a person, page, or date"})}),p&&a.createElement(a.Fragment,null,n()("div",{style:{height:14,marginLeft:o.device.isMobile?10:8}},void 0,n()(U.Z,{vertical:!0,size:1})),n()(W.Z,{capture:!0,render:e=>a.createElement(z.Z,K()({icon:O.Z.closeSmall,isDarkIconColor:!0,onClick:u,iconStyle:{fill:"white",height:o.device.isMobile?18:16,width:o.device.isMobile?18:16},hoveredStyle:s.iconHovered,style:s.icon},e))})),n()(W.Z,p?{capture:!0,render:e=>a.createElement(z.Z,K()({icon:O.Z.circleCheckFilled,onClick:d,isBlue:r,disabled:!r,iconStyle:{height:o.device.isMobile?23:21,width:o.device.isMobile?23:21},style:{marginLeft:o.device.isMobile?16:12,pointerEvents:"auto",height:20,width:20}},e))}:{capture:!0,render:e=>a.createElement(z.Z,K()({icon:O.Z.sendArrow,onClick:d,isBlue:r,disabled:!r,iconStyle:{height:o.device.isMobile?26:24,width:o.device.isMobile?26:24},style:{marginLeft:o.device.isMobile?16:12,pointerEvents:"auto",height:20,width:20}},e))})))})};var X=o(30398);const q=a.forwardRef(((e,t)=>{var o;window.__c={n:"DiscussionInput"};const i=(0,c.O7)(),{device:s,currentUser:D}=i,[Z,P,V]=(0,u.AF)(e.discussionInputStore),{textStore:K,files:O}=Z,U=(0,u.VK)((()=>K.getValue()),[K]),[z,W]=(0,a.useState)(!1),[H,j]=(0,a.useState)(!1),q=(0,a.useRef)(null),{commentStore:te}=e,ie=e.discussionFormat!==M.O2.Page;(0,a.useImperativeHandle)(t,(()=>({uploadFiles:me})));const ne=(0,u.VK)((()=>(0,C.B7)(i)),[i]),se=(0,a.useRef)(null===(o=e.blockStore)||void 0===o?void 0:o.clone()),re=(0,u.VK)((()=>{const e=L.default.state;return"editing"===e.mode&&(0,I.qS)(e.multiSelection)&&e.multiSelection.start.store===K}),[K]),ae=(0,u.VK)((()=>({isEmpty:(0,M.n9)(V),hasChanged:(0,M.hu)(V,te)})),[V,te]),le=(0,u.VK)((()=>re||!ae.isEmpty),[ae.isEmpty,re]),ce=(0,a.useCallback)((async()=>{const e=L.default.state;"editing"===e.mode&&(0,I.qS)(e.multiSelection)&&e.multiSelection.start.store===K||(w.NX({store:K}),await l.default.afterNextFlush())}),[K]),de=e=>{const t=V.state;V.setState({...t,files:t.files.filter((t=>t.id!==e.id))})},ue=async e=>{await me(e.files),f.Zq6(i,{type:"paste"})},me=(0,a.useCallback)((async t=>{var o;if(await ce(),O.length+t.length>10)return void h.showErrorMessage(n()(g.FormattedMessage,{id:"discussionInput.uploadFile.tooManyFilesErrorMessage",defaultMessage:"You cannot upload more than {maxFiles} files per comment.",values:{maxFiles:10}}));const i=t.map(v.Xo);P({...Z,files:[...O,...i]}),null===(o=e.onFileUploaded)||void 0===o||o.call(e)}),[ce,O,P,Z,e]),pe=e.discussionFormat===M.O2.Margin,ge=e.discussionFormat===M.O2.Sidebar;(0,a.useEffect)((()=>{e.commentStore&&function(e,t){const o=S.le(t),i=v.nQ(o);e.setState({...e.state,files:i})}(V,e.commentStore)}),[V,e.commentStore]);const fe=(0,a.useRef)(!1),he=(0,a.useCallback)((t=>{t?p.Z.set({userId:D.id,key:oe(e.parentStore.id,e.inReplyToDiscussionId),value:t??null}):p.Z.remove({userId:D.id,key:oe(e.parentStore.id,e.inReplyToDiscussionId)})}),[D.id,e.inReplyToDiscussionId,e.parentStore.id]);(0,a.useEffect)((()=>{e.shouldSaveUnsentComments&&fe.current&&he(U),fe.current=!0}),[e.shouldSaveUnsentComments,he,U]);const ve=(0,a.useRef)(K);(0,a.useEffect)((()=>{if(e.shouldSaveUnsentComments){const t=p.Z.get({userId:D.id,key:oe(e.parentStore.id,e.inReplyToDiscussionId)});t&&x.createAndCommit({userAction:"DiscussionInput.willMount",environment:i,perform:e=>{y.sO({environment:i,store:ve.current,value:t,transaction:e})}})}}),[i,D.id,e.inReplyToDiscussionId,e.parentStore.id,e.shouldSaveUnsentComments]);const Se=(0,a.useRef)(O);(0,a.useEffect)((()=>{Se.current=O}),[O]),(0,a.useEffect)((()=>()=>{Se.current&&Se.current.forEach((e=>{"local"===e.type&&e.dataURL&&URL.revokeObjectURL(e.dataURL)}))}),[]);const be=!(!e.isEditingExistingComment&&(e.discussionFormat===M.O2.Page||e.discussionFormat===M.O2.Menu)),ye=()=>{var e;return null===(e=q.current)||void 0===e?void 0:e.focus()},we=O&&O.length>0,xe=!(e.discussionFormat===M.O2.Menu&&e.inReplyToDiscussionId)&&(ge||pe&&!e.isNewComment),Ce=void 0!==e.showCtaButtons?e.showCtaButtons:e.isEditingExistingComment||le||z,ke={paddingBottom:be&&Ce?34:4},Me=!e.isMobileSlideUpMenu,Re=(pe||ge)&&!e.isNewComment,Ie=(0,m.yK)((t=>({inputWrapper:{display:"flex",flexDirection:"column",alignItems:"bottom",minHeight:pe?void 0:32,width:"100%",fontSize:14,paddingTop:pe?1:4,paddingBottom:pe?1:4,borderRadius:4,boxShadow:!e.isNewComment&&pe?`0px 0px 0px 1px ${t.darkDividerColor}`:void 0,transition:"background 300ms ease",background:H&&!Ce&&t.focusDiscussionInputBackground||Ce&&!e.isEditingExistingComment&&(e.isNewComment&&pe?t.selectedMarginDiscussionBackground:t.discussionInputActivatedBackground)||"inherit",cursor:Ce?"text":"pointer",alignSelf:"center",position:"relative"}})),[H,pe,e.isEditingExistingComment,e.isNewComment,Ce]),De=ge?23:20,Ze={fontSize:14,marginTop:ge?2:3,marginBottom:2,paddingLeft:6,paddingRight:10,maxHeight:s.isMobileNative?"50vh":"70vh",overflowY:"auto",overflowX:"hidden",WebkitOverflowScrolling:"touch",userSelect:"auto",WebkitUserSelect:"auto"},Le=()=>{if(!re)return;0===(K.getValue()||[]).length&&e.onEditPreviousComment?e.onEditPreviousComment():ie&&ee(q.current,"start")},Ee=()=>{re&&ie&&ee(q.current,"start")},Te=()=>{re&&ie&&ee(q.current,"end")},Be=()=>{he(void 0),e.onSubmit()},Fe=()=>{if(!s.isMobile)return void Be();const e="editing"===L.default.state.mode&&L.default.state.multiSelection;e&&x.createAndCommit({userAction:"DiscussionInput.handleEnter",environment:i,perform:t=>{y.hJ({environment:i,string:"\n",multiSelection:e,disableMentions:!0,disableDateMentions:!0,disableDateReminderMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:t})}})},Ae=n()($,{visible:Ce,onAttach:async()=>{const{device:e}=i;e.isIOS&&e.isMobileNative&&!e.isTablet&&(w.ZH(i),await l.default.afterNextFlush());const t=await v.y({multiple:!0});await me(t),f.Zq6(i,{type:"file_picker"})},onMention:async()=>{await ce(),b.lZ(i,{page:!0,createPage:!1,user:!0,bot:!0,date:!0,reminder:!1,templateVariable:!1,group:!0})},canSend:!ae.isEmpty,onSend:Be,onCancel:e.onCancel,isEditing:e.isEditingExistingComment||!1,animated:pe,inline:!be});return n()(A.Z,{capture:re,onCommandEnter:r().identity},void 0,n()(Y,{enabled:!!se.current&&!!e.canDrop,store:se.current,onNativeDrop:async e=>{let{files:t}=e;await me(t),f.Zq6(i,{type:"drop"})}},void 0,n()("div",{className:e.isEditingExistingComment?k.hzx:k.wFE,style:{...G,...e.containerStyle||{}},onFocus:e=>{const t=e.target;t instanceof HTMLElement&&(0,d.E)(t)&&W(!0)},onBlur:()=>W(!1),onMouseOver:()=>j(!0),onMouseOut:()=>j(!1)},void 0,n()("div",{style:J},void 0,e.showAvatar&&n()(_.Z,{userStore:ne,size:De,avatarShouldShowShadow:!0,style:Q}),n()(B.Z,{springConfig:T,isVisible:!0,animationStyle:ke,render:()=>n()("div",{className:xe?k.Wh_:"",onClick:ye,style:{...Ie.inputWrapper,...pe&&ke},tabIndex:-1},void 0,n()("div",{style:{flexGrow:1,display:"flex"}},void 0,a.createElement(N.Z,{style:Ze,store:K,parentStore:e.parentStore,disabled:!1,onEnter:Fe,onPasteFiles:ue,onEsc:e.onCancel,onUp:Le,onLeft:Ee,onRight:Te,onDown:Te,placeholder:R.default.formatMessage(Re?E.replyInputPlaceholder:E.defaultPlaceholder),ref:q,isDiscussionInput:!0,disableSlashCommands:!0,disableInsertText:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableEmbedMenu:!0,disableDateReminderMentions:!0,disableMobileActionBar:!0,disableStyleAnnotations:s.isMobileBrowser,pasteBehavior:"inline"}),!be&&Ae),we&&n()("div",{style:{paddingBottom:be?8:0,paddingLeft:8,paddingRight:8}},void 0,n()(X.Z,{files:O,onRemoveFile:de})),be&&Ae)}),Me&&n()(F.Z,{show:re,onDismiss:()=>w.ZH(i)})))))})),G={display:"flex",flexDirection:"column",width:"100%",cursor:"pointer"},J={display:"flex",alignItems:"center",flexGrow:1},Q={flexShrink:0,flexGrow:0,marginRight:6,alignSelf:"flex-start",marginTop:6};function Y(e){const{enabled:t,children:o,store:i,onNativeDrop:s}=e;return t&&i?n()(P.Z,{store:i,analyticsName:"discussion_input",canNativeDropOnto:!0,onNativeDrop:s,keepTextSelectionOnDrop:!0,shouldShowDropZone:!0},void 0,o):a.createElement(a.Fragment,null,o)}function ee(e,t){if(!e)return;const o=e.getNode();if(!(o&&o instanceof HTMLElement)||document.activeElement!==o)return;const i=o.parentNode;if(!i)return;const n=te(i);if(!n)return;const s=n.scrollTop,r=Z.toStaticRange(Z.get());if(!r)return;const a=()=>{n.scrollTop=s,"start"===t?w.N_({store:e.props.store}):w.NX({store:e.props.store})};window.requestAnimationFrame((()=>{const e=Math.abs(n.scrollTop-s),i=Z.toStaticRange(Z.get()),l=document.activeElement!==o;if(!i)return;const c=!Z.areRangesEqual(r,i),d=o.contains(i.startContainer)&&o.contains(i.endContainer);let u=!1;var m;0!==e&&(m=n,Math.abs(m.scrollHeight-m.clientHeight-m.scrollTop)<1)&&!l&&!c?u=!0:d||(u=!0),u&&(o.focus(),a(),window.requestAnimationFrame((()=>{a(),"end"===t&&window.requestAnimationFrame(a)})))}))}function te(e){const t=(0,D.VW)(e);return t&&t.style.maxHeight&&t.parentNode?te(t.parentNode):t}function oe(e,t){return t?`UnsentDiscussion-${e}-${t}`:`UnsentDiscussion-${e}`}const ie=q},30398:(e,t,o)=>{o.d(t,{Z:()=>A});var i=o(23174),n=o.n(i),s=o(67294),r=o(81954),a=o(24405),l=o(53397),c=o(73744),d=o(34859),u=o(45589),m=o(73063),p=o(18647),g=o(480),f=o(95538),h=o(95477),v=o(1533),S=o(64921),b=o(54604),y=o(71669),w=o(81865);function x(e){window.__c={n:"FullScreenImage"};const{url:t,imageNaturalHeight:o,imageNaturalWidth:i}=e,r=(0,s.useMemo)((()=>({display:"block",width:`min(${i}px, 100%)`,height:`min(${o}px, 100%)`,pointerEvents:"auto",objectFit:"cover"})),[i,o]);return n()("div",{style:C},void 0,n()(y.Z,{src:t,style:r,placeholderLoadedStyle:{display:"flex",justifyContent:"center",alignItems:"center"}}))}const C={alignSelf:"center",margin:"0 auto",position:"relative",height:"100%",width:"100%",overflow:"hidden"};const k=function(e){window.__c={n:"DiscussionInputImageRenderer"};const t=(0,s.useRef)(null),{file:o}=e,i=(0,g.O7)(),r=(0,a.yK)((e=>({imageThumbnail:{borderRadius:3,border:`1px solid ${e.lightDividerColor}`,objectFit:"cover",height:48,width:48,cursor:"zoom-in"}})),[]),l=(0,s.useCallback)((()=>{var e;const i=null===(e=t.current)||void 0===e?void 0:e.getImageDimensions();if(!i)return;const{naturalHeight:s,naturalWidth:r}=i;return"local"===o.type?n()(x,{url:o.dataURL,imageNaturalHeight:s,imageNaturalWidth:r}):n()(w.Z,{url:o.source,render:(e,t)=>n()(x,{url:t,error:e,imageNaturalHeight:s,imageNaturalWidth:r}),isAuthenticated:!0,permissionRecord:o.store.pointer})}),[o]),c=(0,s.useCallback)((e=>{var o;e.stopPropagation();const n=null===(o=t.current)||void 0===o?void 0:o.getImageDimensions();n&&b.ui({environment:i,renderFullScreenNode:l,fullScreenNodeRect:n.clientRect,contentAspectRatio:n.naturalHeight/n.naturalWidth})}),[l,i]);return"local"===o.type?s.createElement(y.Z,{src:o.dataURL,style:r.imageThumbnail,placeholderStyle:r.imageThumbnail,onClick:c,ref:t}):n()(w.Z,{url:o.source,isAuthenticated:!0,permissionRecord:o.store.pointer,render:(e,o)=>s.createElement(y.Z,{src:o,style:r.imageThumbnail,placeholderStyle:r.imageThumbnail,onClick:c,ref:t})})};var M=o(82990);function R(e){window.__c={n:"DiscussionInputFileRenderer"};const{file:t,type:o}=e,i=(0,a.Fg)(),r=(0,s.useMemo)((()=>({doc:{title:"DOC",color:i.msDocDiscussionInputPreview},docx:{title:"DOCX",color:i.msDocDiscussionInputPreview},xls:{title:"XLS",color:i.msExcelDiscussionInputPreview},xlsx:{title:"XLSX",color:i.msExcelDiscussionInputPreview},pdf:{title:"PDF",color:i.pdfDiscussionInputPreview},video:{icon:l.Z.videoAttachment}})),[i]),c=(0,a.yK)((e=>{const t=r[o];return{wrapper:{height:48,width:220,display:"flex",background:"transparent",borderRadius:5,overflow:"hidden",border:`1px solid ${e.regularDividerColor}`},fileTypeArea:{background:null!=t&&t.color?t.color:e.sidebarSecondaryBackground,height:48,width:48,display:"flex",justifyContent:"center",alignItems:"center",flexShrink:0},icon:{height:26,width:26,fill:e.regularIconColor},fileType:{fontSize:11,lineHeight:"16.8px",fontWeight:M.Z.fontWeight.semibold,color:e.regularInvertedTextColor},fileDescription:{padding:"6px 12px 6px 12px",display:"flex",flexDirection:"column",justifyContent:"center",overflow:"hidden"},fileTitle:{color:e.regularTextColor,textOverflow:"ellipsis",fontSize:14,lineHeight:"19.6px",whiteSpace:"nowrap",overflow:"hidden",width:"100%",paddingBottom:20},fileSize:{color:e.lightTextColor,fontSize:12,lineHeight:"16.8px",width:"100%"}}}),[o,r]),d=r[o];return n()("div",{style:c.wrapper},void 0,n()("div",{style:c.fileTypeArea},void 0,null!=d&&d.title?n()("div",{style:c.fileType},void 0,d.title):null!=d&&d.icon?d.icon(c.icon):l.Z.fileAttachment(c.icon)),n()("div",{style:c.fileDescription},void 0,n()("div",{style:c.fileTitle},void 0,t.name),n()("div",{style:c.fileSize},void 0,t.size)))}const I={image:k,pdf:R,doc:R,xls:R,embed:R},D={"application/vnd.openxmlformats-officedocument.wordprocessingml.document":"docx","application/msword":"doc","application/vnd.ms-excel":"xls","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx",image:"image"};function Z(e){return"local"===e.type?function(e){const[t]=e.split("/");return D[e]||D[t]}(e.file.type)||(0,f.Dz)({url:e.file.name,baseUrl:h.default.domainBaseUrl,publicDomainName:h.default.publicDomainName}):(0,f.y_)(e.source,".doc")?"doc":(0,f.y_)(e.source,".docx")?"docx":(0,f.y_)(e.source,".xls")?"xls":(0,f.y_)(e.source,".xlsx")?"xlsx":(0,f.Dz)({url:e.source,baseUrl:h.default.domainBaseUrl,publicDomainName:h.default.publicDomainName})}function L(e){let{file:t,onRemoveFile:o,disableRemove:i}=e;window.__c={n:"DiscussionInputFilePreview"};const[{hovered:a},,c]=(0,r.AF)(void 0,v.Z),d=(0,s.useCallback)((()=>null==o?void 0:o(t)),[t,o]),u=(0,g.O7)(),p=!i&&(a||u.device.isMobile);(0,s.useEffect)((()=>()=>{"local"===t.type&&t.dataURL&&URL.revokeObjectURL(t.dataURL)}),[t]);const f=Z(t),h=I[f]||R;return n()(S.Z,{store:c,style:B,hoveredStyle:E,pressedStyle:T},void 0,n()(h,{file:t,type:f}),p&&n()(m.Z,{icon:l.Z.closeSmall,style:F,hasBackground:!0,isDarkIconColor:!0,hovered:!1,showShadow:!0,onClick:d}))}const E={background:"none"},T={background:"none"},B={display:"flex",alignItems:"center",justifyContent:"center",position:"relative",paddingRight:"10px",cursor:"pointer"},F={position:"absolute",top:"-5px",right:"6px",height:18,width:18,borderRadius:18,padding:4};function A(e){window.__c={n:"DiscussionInputFilmStrip"};const t=(0,s.useRef)(null),o=(0,a.yK)((e=>({leftArrowStyle:{left:10,top:26,background:e.mediumIconColor,...N},rightArrowStyle:{right:10,top:26,background:e.mediumIconColor,...N},iconStyle:{height:6,fill:e.contentBackground},hoveredStyle:{background:e.regularIconColor}})),[]),[{scrollLeft:i,scrollWidth:g,clientWidth:f},,h]=(0,r.AF)(void 0,u.Z),v=(0,s.useCallback)((e=>{var o;e.stopPropagation(),null===(o=t.current)||void 0===o||o.scrollByOffset(0,-.8*f,{animate:!0})}),[f]),S=(0,s.useCallback)((e=>{var o;e.stopPropagation(),null===(o=t.current)||void 0===o||o.scrollByOffset(0,.8*f,{animate:!0})}),[f]),b=(0,s.useCallback)((()=>{var e;null===(e=t.current)||void 0===e||e.getClientRect()}),[]);(0,s.useEffect)((()=>(c.lj(window,"resize",b),()=>{c.ZV(window,"resize",b)})),[b]);const y=(0,s.useMemo)((()=>Math.floor(i)>0),[i]),w=(0,s.useMemo)((()=>Math.ceil(i+f)<g),[i,g,f]);return(0,s.useEffect)((()=>{b()}),[e.files,b]),0===e.files.length?null:n()("div",{style:P},void 0,s.createElement(p.Z,{style:_,ref:t,type:d.Z.X,onScroll:b,zIndex:0,store:h},e.files.filter((e=>"local"===e.type||Boolean(e.source))).map((t=>n()(L,{file:t,onRemoveFile:e.onRemoveFile,disableRemove:e.disableRemove},t.id)))),y&&n()(m.Z,{icon:l.Z.collectionTimelineArrowLeft,hovered:!1,showShadow:!0,onClick:v,style:o.leftArrowStyle,iconStyle:o.iconStyle,hoveredStyle:o.hoveredStyle}),w&&n()(m.Z,{icon:l.Z.collectionTimelineArrowRight,hovered:!1,showShadow:!0,onClick:S,style:o.rightArrowStyle,iconStyle:o.iconStyle,hoveredStyle:o.hoveredStyle}))}const _={overflow:"scroll",display:"flex",alignItems:"flex-start",flexDirection:"row",paddingTop:10},P={display:"flex",paddingRight:0,position:"relative"},N={position:"absolute",borderRadius:3,width:16,height:16,opacity:1,flexShrink:0,boxShadow:"none"}},16378:(e,t,o)=>{o.r(t),o.d(t,{default:()=>R});var i=o(23174),n=o.n(i),s=o(67294),r=o(480),a=o(81954),l=o(24405),c=o(7476),d=o(78089),u=o(10663),m=o(13884),p=o(36488),g=o(56940),f=o(44532),h=o(37064),v=o(73935),S=o(83355),b=o(14568),y=o(49085);class w extends y.default{getInitialState(){return{}}}const x=w;class C extends S.Z{constructor(){super(...arguments),this.storeTypes={store:x},this.rootNode=void 0,this.observer=void 0,this.handleMutation=()=>{this.rootNode&&this.stores.store.setState({node:this.rootNode})}}get registries(){return[b.Z]}didMount(){this.props.capture&&this.startListeners()}willUpdate(e){e.capture&&!this.props.capture?this.startListeners():!e.capture&&this.props.capture&&this.stopListeners()}willUnmount(){this.stopListeners()}startListeners(){const e=v.findDOMNode(this);e&&(this.rootNode=e,this.observer=new MutationObserver(this.handleMutation),this.observer.observe(this.rootNode,{attributes:!0,subtree:!0}))}stopListeners(){this.observer&&(this.observer.disconnect(),this.rootNode=void 0,this.observer=void 0)}renderComponent(){return s.Children.only(this.props.children)}}C.displayName="SlideUpInputArea";const k=C;var M=o(19195);const R=function(){window.__c={n:"NewDiscussionMenu"};const e=(0,r.O7)(),{device:t,WindowSizeStore:o}=e,i=(0,a.VK)((()=>m.Z.state.rect),[]),s=(0,a.VK)((()=>{if(m.Z.state.open){const{blockStore:t,discussionInputStore:o}=m.Z.state;return{blockStore:t,discussionInputStore:o,canMarginCommentsRender:(0,u.az)(e,t)}}return null}),[e]),v=(0,a.VK)((()=>({paddingLeft:t.isMobileNative?o.getSafePaddingLeftCSS(10):10,paddingRight:t.isMobileNative?o.getSafePaddingRightCSS(10):10})),[o,t.isMobileNative]),S=(0,l.yK)((()=>({inputWrapper:{width:t.isMobileNative?"100%":470,maxWidth:t.isMobileBrowser?"90vw":"100%",paddingTop:8,paddingBottom:t.isAndroid?12:8,paddingLeft:v.paddingLeft,paddingRight:v.paddingRight}})),[t,v]),b=()=>{c.ZL(e)},y=()=>{s&&c.uK(s.discussionInputStore,e)};return null!=s&&s.canMarginCommentsRender?null:n()(f.ZP,{popupType:t.isMobileNative?f.ZP.PopupType.SlideUp:f.ZP.PopupType.Popup,keepFocus:!0,open:null!==s,originRect:i,placementToOrigin:f.ZP.Placement.Bottom,alignmentToOrigin:f.ZP.Alignment.Center,originGap:4,onDismiss:y,render:()=>{if(s){const{blockStore:e,discussionInputStore:t}=s;return n()(g.Z,{capture:!0,ignoreBlockSelection:!0,restoreSelection:!0,focusOffscreenInput:!1,render:()=>n()(k,{capture:!0},void 0,n()(p.Z,{capture:!0,allowOpenLinkMenu:!0,render:()=>n()(h.Z,{store:e,droppable:!0,render:()=>n()("div",{style:S.inputWrapper},void 0,n()(M.default,{showAvatar:!0,parentStore:e,onCancel:y,onSubmit:b,discussionInputStore:t,isMobileSlideUpMenu:!0,shouldSaveUnsentComments:!1,discussionFormat:d.O2.Page,blockStore:e,canDrop:!0}))},e.id)}))})}}})}},82899:(e,t,o)=>{o.r(t),o.d(t,{default:()=>$,openEmojiMenuForReaction:()=>j});var i=o(10434),n=o.n(i),s=o(23174),r=o.n(s),a=o(67294),l=o(73935),c=o(480),d=o(81954),u=o(24405),m=o(8848),p=o(53397),g=o(97880),f=o(82990),h=o(5366),v=o(27153),S=o(4615),b=o(98459),y=o(80396),w=o(19889),x=o(94419),C=o(68216),k=o(50906),M=o(9953),R=o(12359);function I(e){const{discussionLocation:t,environment:o,transaction:i,commentStore:n,icon:s}=e,r=function(e){let{commentStore:t,icon:o}=e;const i=(0,C.Vh)(t,t.pointer,"reactions").getValue();if(void 0===i)return;return i.map((e=>{const o=C.t1.createChildStore(t,{table:y.yo,id:e,spaceId:(0,b.CG)(t.pointer.spaceId)});if(o.isDefined())return o})).filter(g.$K).find((e=>e.getIcon()===o))}({commentStore:n,icon:s});if(void 0===o.currentUser.id)return;const a={table:w.KJ,id:o.currentUser.id};null!=r&&r.isDefined()?function(e){var t;let{store:o,actorPointer:i,transaction:n,environment:s,discussionLocation:r}=e;const a={store:o,actorPointer:i,transaction:n,environment:s,discussionLocation:r};(null===(t=o.getActors())||void 0===t?void 0:t.some((e=>e.id===i.id)))?function(e){const{store:t,actorPointer:o,discussionLocation:i,transaction:n,environment:s}=e;if(!t.isDefined())return;k.Eml({environment:s,reaction_value:t.getIcon(),comment_id:t.getParentId(),reaction_count:t.getActors().length??0,from:i});const r=t.getModel();R.applyOperation({transaction:n,store:t,operation:r.ops.removeActor(o)})}(a):function(e){const{store:t,actorPointer:o,discussionLocation:i,transaction:n,environment:s}=e;if(!t.isDefined())return;k.pPS({environment:s,reaction_value:t.getIcon(),comment_id:t.getParentId(),reaction_count:t.getActors().length??0,from:i});const r=t.getModel();R.applyOperation({transaction:n,store:t,operation:r.ops.appendActor(o)})}(a)}({environment:o,store:r,actorPointer:a,transaction:i,discussionLocation:t}):function(e){let{environment:t,transaction:o,commentStore:i,icon:n,currentActorPointer:s,discussionLocation:r}=e;const a=(0,S.ZP)();k.pPS({environment:t,reaction_value:n,comment_id:i.id,reaction_count:0,from:r});const l=M.Ue({environment:t,table:y.yo,args:{id:a,spaceId:(0,b.CG)(i.pointer.spaceId),commentId:i.id,icon:n,actorPointer:s},inMemoryRecordCache:i.inMemoryRecordCache,transaction:o}),c=(0,C.Vh)(i,i.pointer,"reactions");x.R3({parent:c,append:l,transaction:o})}({environment:o,transaction:i,commentStore:n,icon:s,currentActorPointer:a,discussionLocation:t})}var D=o(64921),Z=o(92059),L=o(73063),E=o(58032),T=o(38797),B=o(87279);var F=o(31945),A=o(78140),_=o(28992),P=o(66957),N=o(72893);function V(e){let{reactionStores:t,initialIndex:o}=e;window.__c={n:"ReactionSheetContent"};const[i,n]=a.useState(o),s=(0,h.useIntl)(),l=(0,d.VK)((()=>t.map((e=>e.getIcon()))),[t]),c=(0,d.VK)((()=>t[i].getActorStores().map((e=>({id:e.id,store:e,name:e.getDisplayName(s)}))).filter(g.$K)),[t,i,s]);return r()(A.Z,{menuType:B.og.ActionSheet},void 0,r()(P.Z,{tabStyle:{flex:1,justifyContent:"center",display:"flex",minWidth:60},tabs:l,selectedIndex:i,onChange:e=>n(e)}),c.map((e=>r()(_.Z,{title:e.name,dontShrinkIcon:!0,icon:r()(N.S,{authorStore:e.store,avatarSize:20,avatarStyle:{width:20,height:20},placeholderStyle:{width:20,height:20}})},e.id))))}function K(e){window.__c={n:"ReactionSheet"};const t=(0,c.Fy)(),o=(0,d.VK)((()=>e.commentStore.getUserVisibleReactions()),[e.commentStore]),i=(0,a.useRef)(null),n=function(e){const t=(0,c.O7)(),{onLongPress:o,hapticsEnabled:i=!0,timeout:n=300}=e,s=(0,a.useCallback)((()=>{var e,n,s;i&&(null!==(e=t.mobileNative)&&void 0!==e&&e.buzz?t.mobileNative.buzz():null===(n=(s=window.navigator).vibrate)||void 0===n||n.call(s,20)),o()}),[t.mobileNative,i,o]),r=(0,a.useRef)(),l=(0,a.useCallback)((()=>clearTimeout(r.current)),[]);return(0,a.useEffect)((()=>l),[l]),{onTouchStart:(0,a.useCallback)((()=>{clearTimeout(r.current),r.current=setTimeout(s,n)}),[n,s]),onTouchEnd:l,onTouchCancel:l}}({onLongPress:()=>{var e;return null===(e=i.current)||void 0===e?void 0:e.setOpen(!0)}});if(!t.isMobile)return a.createElement(a.Fragment,null,e.children);const s=o.findIndex((t=>!e.reactionStore||t===e.reactionStore))??0;return a.createElement(F.ZP,{ref:i,key:e.commentStore.id,renderOrigin:()=>a.createElement("div",n,e.children),popupType:t.isTablet?F.Z4.Popup:F.Z4.SlideUp,render:()=>r()(V,{initialIndex:s,reactionStores:o})})}function O(){const{isMobile:e}=(0,c.Fy)();return(0,u.yK)((t=>({reaction:{display:"flex",margin:"1px",padding:"1px 6px 1px 6px",justifyContent:"center",gap:"4px",border:`1px solid ${t.regularDividerColor}`,borderRadius:"100px",fontSize:14,lineHeight:"20px",fontVariantNumeric:"tabular-nums",background:t.whiteButtonBackground},count:{color:t.mediumTextColor,fontSize:e?f.Z.fontSize.UISmall.mobile:f.Z.fontSize.UISmall.desktop,lineHeight:"20px"},countReacted:{color:t.blueColor},reacted:{background:m.ZP.blueWithAlpha(.08),border:`1px solid ${t.filterPillBorder}`,fontWeight:500},reactedHover:{background:m.ZP.blueWithAlpha(.18)},emojiStyle:{color:"black",display:"inline-block"}})),[e])}function U(e){let{store:t,disabled:o,onClick:i}=e;window.__c={n:"Reaction"};const s=(0,d.VK)((()=>t.getActors()),[t]),l=(0,d.VK)((()=>t.getIcon()),[t]),u=O(),{currentUser:m}=(0,c.O7)();if(!s||!l)return null;if(0===s.length)return null;const p=s.some((e=>e.id===m.id)),g={...u.reaction,...p&&u.reacted},f={...u.count,...p&&u.countReacted};return r()(E.Z,{placement:E.Z.Placement.Bottom,delayThreshold:300,renderTooltip:()=>r()(z,{store:t,icon:l}),render:e=>a.createElement(D.Z,n()({disabled:o,style:g,hoveredStyle:p?u.reactedHover:void 0,onClick:i},e),r()("span",{style:u.emojiStyle},void 0,r()(Z.Z,{size:14,char:l})),r()("span",{style:f},void 0,s.length))})}function z(e){let{store:t,icon:o}=e;window.__c={n:"ReactionTooltip"};const i=(0,u.yK)((e=>({text:{color:e.mediumInvertedTextColor}})),[]),n=(0,h.useIntl)(),s=(0,d.VK)((()=>t.getActorStores()),[t]),a=(0,d.VK)((()=>s.map((e=>e.getDisplayName(n))).filter(g.$K)),[s,n]);return r()(h.FormattedMessage,{defaultMessage:"{numberOfNames, plural, one {{nameOrNames} <medium>reacted with</medium> {icon}} other {{nameOrNames} <medium>reacted with</medium> {icon}}}",id:"ReactionBar.hoverTooltip.text",values:{numberOfNames:a.length,nameOrNames:a.join(", "),medium:e=>r()("span",{style:i.text},void 0,e),icon:r()(Z.Z,{size:14,char:o})}})}function W(e){let{commentStore:t,discussionLocation:o,onEmojiSelection:i}=e;window.__c={n:"NewReaction"};const n=(0,c.O7)(),s=(0,a.useRef)(null),l=(0,c.Fy)(),d=(0,u.yK)((e=>({container:{padding:2,display:"flex",boxShadow:e.lightBoxShadow,backgroundColor:e.buttonGroupBackground,borderRadius:l.isMobile?3:4},addIcon:{width:15,fill:e.mediumIconColor},iconButton:{height:22,width:22,flex:"0 0 auto"}})),[l.isMobile]),m=(0,h.useIntl)();return r()("div",{style:d.container},void 0,a.createElement(L.Z,{hasBackground:!0,ariaLabel:m.formatMessage({defaultMessage:"Add reaction",id:"ReactionBar.newReaction.ariaLabel"}),showShadow:!1,icon:()=>p.Z.reactionAdd(d.addIcon),style:d.iconButton,ref:s,onClick:()=>j(n,m,t,null==s?void 0:s.current,o,i)}))}function H(e){let{commentStore:t,discussionLocation:o,onEmojiSelection:i}=e;window.__c={n:"NewInlineReaction"};const n=(0,u.Fg)(),s=(0,c.O7)(),r=(0,a.useRef)(null),l=O(),d=(0,h.useIntl)(),m=p.Z.reactionAdd({width:15,height:20,marginTop:.5,marginLeft:.5,fill:n.mediumIconColor});return a.createElement(D.Z,{style:{...l.reaction,minWidth:"2em"},ref:r,onClick:()=>j(s,d,t,null==r?void 0:r.current,o,i)},m)}function j(e,t,o,i,n,s){const a=l.findDOMNode(i);if(!a)return;if(!(a instanceof Element))return;const c=a.getBoundingClientRect();v.$(e,{originGap:4,originRect:c,popupWidth:T.ZP.desktopPopupWidth,popupHeight:T.ZP.desktopPopupHeight,isSmallWidth:!1,title:t.formatMessage({defaultMessage:"Reaction",id:"ReactionBar.emojiModalMenu.title"}),currentTab:"emoji",tabs:[{type:"emoji",title:r()(h.FormattedMessage,{defaultMessage:"Emojis",id:"recordIcon.emojiTab.title"}),hideRandomButton:!0,onChange:(t,i)=>{s&&s(),R.createAndCommit({environment:e,userAction:"Comment.toggleReactionFromMenu",perform:s=>{I({environment:e,transaction:s,commentStore:o,icon:t,discussionLocation:n}),i&&i.keepVisible||v.Z()}})}}]})}const $=function(e){let{parentStore:t,discussionLocation:o,onClick:i}=e;window.__c={n:"ReactionBar"};const n=(0,d.VK)((()=>t.canComment()),[t]),s=(0,d.VK)((()=>t.getUserVisibleReactions()),[t]),a=(0,c.O7)();return r()("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px",marginTop:"4px",marginBottom:"4px"}},void 0,s.map((e=>r()(K,{reactionStore:e,commentStore:t},e.id,r()(U,{disabled:!n,store:e,onClick:()=>{e.isDefined()&&(i&&i(),R.createAndCommit({environment:a,userAction:"Comment.toggleReaction",perform:i=>{I({environment:a,transaction:i,commentStore:t,icon:e.getIcon(),discussionLocation:o})}}))}})))),n&&s.length>0&&r()(K,{commentStore:t},void 0,r()(H,{commentStore:t,discussionLocation:o,onEmojiSelection:i})),n&&0===s.length&&r()(W,{commentStore:t,discussionLocation:o,onEmojiSelection:i}))}},51477:(e,t,o)=>{o.r(t),o.d(t,{default:()=>le});var i=o(23174),n=o.n(i),s=o(67294),r=o(480),a=o(81954),l=o(24405),c=o(78316),d=o(10663),u=o(82136),m=o(23063),p=o(96486),g=o(14577),f=o(44805),h=o(80503),v=o(51454),S=o(96514),b=o(39500),y=o(49427),w=o(24229),x=o(35973),C=o(13884),k=o(50628),M=o(7011),R=o(10434),I=o.n(R),D=o(97880),Z=o(41432),L=o(53397),E=o(21202),T=o(19889),B=o(82990),F=o(5366),A=o(43250),_=o(65598),P=o(16402),N=o(68216),V=o(76798),K=o(64369),O=o(67706),U=o(72893);function z(e){let{discussionData:{groupedDiscussionsData:t,id:o},onClick:i}=e;window.__c={n:"GroupedMarginDiscussionItem"};const[r,c]=(0,s.useState)(!1),u=(0,s.useCallback)((()=>{c(!0)}),[]),m=(0,s.useCallback)((()=>{c(!1)}),[]),p=(0,s.useCallback)((async e=>{const o=t[0].discussionStore;await i(e,o)}),[i,t]),g=(0,a.VK)((()=>t.flatMap((e=>(0,_.D4)(e.discussionStore)))),[t]),f=(0,a.VK)((()=>{const e=t[0].parentBlockStore;return[...new Set(g.map((e=>e.getCreatedById())).filter(D.$K))].map((t=>N.U6.createChildStore(e,{table:T.KJ,id:t}))).slice(0,3)}),[t,g]),h=(0,a.VK)((()=>{const e=t[0].closestVisibleParentId,o=t[0].parentBlockStore;if(!e)return;const i=N.G.createChildStore(o,{table:E.iU,id:e}),n=i.getParentStore();return n&&n.table===E.iU&&n.getType()===Z.Ti.tab?i:void 0}),[t]),v=(0,a.VK)((()=>{const e=g.map((e=>e.getLastEditedTime()));return Math.max(...e)}),[g]),S=(0,l.yK)((e=>({discussion:{border:`1px solid ${e.regularDividerColor}`,borderRadius:3,background:r?e.hoveredMarginDiscussionBackground:e.contentBackground,width:d.Z,display:"flex",padding:"10px 12px",cursor:"pointer"},userAvatarsContainer:{display:"flex",marginRight:6,justifyContent:"center",alignItems:"center",flexDirection:"row-reverse"},hiddenUsers:{fontSize:14,color:e.mediumTextColor,marginRight:6},commentCount:{fontSize:14,fontWeight:B.Z.fontWeight.semibold,whiteSpace:"normal",marginLeft:6},textPlaceholder:{background:e.lightDividerColor,height:14,width:81,borderRadius:3,marginLeft:4},lastEditedTime:{margin:"1px 0px 0px 6px",whiteSpace:"normal",display:"flex",justifyContent:"center",alignItems:"center",lineHeight:"21px"},commentAuthorAvatarStyle:{width:20,height:20,borderRadius:20,marginRight:-3,position:"relative",userSelect:"none",WebkitUserSelect:"none"},commentAuthorPlaceholderStyle:{width:20,height:20,borderRadius:20,marginRight:-3,position:"relative"},secondaryLabel:{fontSize:B.Z.fontSize.UISmall.desktop,marginLeft:4,color:e.lightTextColor,marginTop:1,whiteSpace:"normal",display:"flex",justifyContent:"center",alignItems:"center",lineHeight:"21px"},expandIcon:{width:B.Z.fontSize.UISmall.desktop,height:B.Z.fontSize.UISmall.desktop,fill:e.lightTextColor,marginTop:1}})),[r]);return n()("div",{style:S.discussion,onMouseEnter:u,onMouseLeave:m,onClick:p,className:A.S9A},void 0,s.createElement(s.Fragment,null,n()("div",{style:S.userAvatarsContainer},void 0,f.map((e=>n()(U.S,{authorStore:e,avatarSize:20,avatarStyle:S.commentAuthorAvatarStyle,placeholderStyle:S.commentAuthorPlaceholderStyle},e.id)))),g.length>0?n()("div",{style:S.commentCount},void 0,n()(F.FormattedMessage,{defaultMessage:"{numComments, plural, one {{numComments} comment} other {{numComments} comments}}",id:"marginComments.collapsed.numComments.count",values:{numComments:g.length}})):n()("div",{style:S.textPlaceholder}),r?s.createElement(s.Fragment,null,n()("div",{style:{marginLeft:10,display:"flex",justifyContent:"center",alignItems:"center"}},void 0,L.Z.expand(S.expandIcon)),n()("div",{style:S.secondaryLabel},void 0,n()(F.FormattedMessage,{defaultMessage:"Expand",id:"marginComments.collapsed.expand.label"}))):v&&n()(K.Z,{isSmall:!0,isSecondaryColor:!0,isMultiline:!0,style:S.lastEditedTime},void 0,n()(O.Z,{text:(0,P.IS)(v),tooltipText:(0,P.uy)(v),icon:L.Z.calendar})),h&&n()("div",{style:S.secondaryLabel},void 0,n()(V.Z,{store:h,maxLength:10}))))}var W=o(74725),H=o(7476),j=o(78089),$=o(19195);function X(e){let{discussionData:{parentBlockStore:t,discussionInputStore:o},isVisible:i}=e;window.__c={n:"NewMarginDiscussionItem"};const a=(0,s.useRef)(null),c=(0,r.O7)(),u=(0,s.useCallback)((()=>{H.ZL(c)}),[c]),m=(0,s.useCallback)((()=>{H.uK(o,c)}),[c,o]),p=(0,s.useMemo)((()=>[`.${A.mJW}`]),[]);(0,W.O)({active:i,closeHandler:m,ref:a,excludedSelectors:p,ignoreKeydown:!0});const g=(0,l.yK)((e=>({discussion:{borderRadius:3,boxShadow:e.marginDiscussionSelectedShadow,width:d.Z,background:e.selectedMarginDiscussionBackground},discussionInputContainer:{borderRadius:3,padding:"6px 4px 4px 8px"}})),[]);return s.createElement("div",{style:g.discussion,ref:a,className:A.S9A},n()($.default,{parentStore:t,discussionInputStore:o,shouldSaveUnsentComments:!1,isMobileSlideUpMenu:!1,discussionFormat:j.O2.Margin,onSubmit:u,onCancel:m,isNewComment:!0,blockStore:t,canDrop:!0,showAvatar:!1,containerStyle:g.discussionInputContainer,showCtaButtons:!0}))}var q=o(80357),G=o(50906),J=o(54564),Q=o(89574),Y=o(87404),ee=o(97543);function te(e){let{discussionData:{discussionStore:t,parentBlockStore:o},timeMounted:i,onClick:a,isVisible:c,isDiscussionSelected:u,isDiscussionHovered:m}=e;window.__c={n:"SingleMarginDiscussionItem"};const p=(0,s.useRef)(null),g=(0,r.O7)(),[f,h]=(0,s.useState)((()=>new Y.Z(g,t.pointer.spaceId))),v=t.id,S=(0,s.useMemo)((()=>[`.${(0,q.dk)({discussionId:v})}`,`.${A.mJW}`,`.${A.S9A}`]),[v]),b=(0,s.useCallback)((async()=>{const e=Q.Z.find((e=>e.isEditing()));if(e){if(!(await e.handleCancelEdit()))return}J.LZ()}),[]);(0,W.O)({active:c&&u,closeHandler:b,ref:p,excludedSelectors:S,ignoreKeydown:!0});const y=(0,l.yK)((e=>({discussion:{border:u?void 0:`1px solid ${e.regularDividerColor}`,borderRadius:3,padding:u?"1px":void 0,background:u?e.selectedMarginDiscussionBackground:m?e.hoveredMarginDiscussionBackground:e.contentBackground,boxShadow:u?e.marginDiscussionSelectedShadow:void 0,width:d.Z,willChange:"transform",transition:"transform 150ms",transform:u?"translateX(-20px)":m?"translateX(-5px)":void 0,cursor:u?void 0:"pointer"}})),[m,u]),w=(0,s.useCallback)((async e=>{u||(G.UwD(g,{from:"margin_comments"}),await a(e,t))}),[a,t,u,g]);return s.createElement("div",{style:y.discussion,onClick:w,ref:p,className:A.S9A},n()(ee.default,{store:t,blockStore:o,format:j.O2.Margin,isFirst:!1,isOnly:!1,showResolveButtonByDefaultIfPossible:!1,discussionLocation:"margin_comments",showAllRepliesAfterTimestamp:i,discussionInputStore:f,collapsed:!u}))}const oe=s.memo(te);function ie(e){window.__c={n:"MarginDiscussionItem"};const{discussionData:t,isLastItem:o,isDiscussionSelected:i,discussionItemElementMap:n}=e,r=(0,l.yK)((e=>({discussionContainer:{transition:"background 300ms ease\n\t\t\t\t"+(t.hide?"":", top 200ms ease-in-out"),top:t.offsetTop,position:"absolute",paddingBottom:o?d.Vs:d.wo,zIndex:i?1:void 0,opacity:t.hide?0:1,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",pointerEvents:"auto"}})),[t.hide,t.offsetTop,i,o]);let a;const c=t.type;"existing"===c?a=s.createElement(oe,I()({},e,{discussionData:t})):"new"===c?a=s.createElement(X,I()({},e,{discussionData:t})):"grouped"===c?a=s.createElement(z,I()({},e,{discussionData:t})):(0,D.t1)(c);const u=(0,s.useCallback)((()=>{x.Z.setState({source:"margin_comments",discussionIds:[t.id]})}),[t.id]),m=(0,s.useCallback)((()=>{x.Z.setState({discussionIds:[]})}),[]),p=(0,s.useCallback)((e=>{n.set(t.id,e)}),[t.id,n]);return s.createElement("div",{style:r.discussionContainer,onMouseEnter:u,onMouseLeave:m,ref:p},a)}const ne=s.memo(ie),se=`.${f.zd}, .${f.FB}`;function re(e){let{pageBlockStore:t,timeMounted:o,isVisible:i,animating:c,pageViewBlockAccessor:u,width:m}=e;window.__c={n:"MarginCommentsContent"};const f=(0,r.O7)(),R=(0,s.useRef)(null),I=(0,s.useRef)(new Map),D=(0,s.useRef)(new Map),Z=(0,a.VK)((()=>x.Z.getFirstSelectedDiscussionId()),[]),L=(0,s.useCallback)((async(e,o)=>{(0,b.X9)()||e.target instanceof Element&&e.target.closest(se)||await S.Ri({discussionStore:o,currentBlockStore:t,environment:f,analyticsFrom:"margin_comments",currentEl:R.current})}),[t,f]),[E,T]=(0,s.useState)({data:[],hasNewDiscussion:!1,selectedDiscussion:void 0}),[B,F]=(0,s.useState)(!1),{WindowSizeStore:A}=f,_=h.R6(f.device.isElectronMac);(0,s.useEffect)((()=>{if(!i)return;const e=new g.Z((()=>({selectableRectMap:k.Z.state.selectableRectMap,pageContentStores:t.getContentStores(),sidebarIsAnimating:M.ZP.state.isAnimating,windowHeight:A.state.height})),{debugName:"effectDataStore"}),o=new g.Z((()=>d.EM.state),{debugName:"discussionStoresStore"}),n=new g.Z((()=>{const e=C.Z.state;if(e.open&&e.rect&&y.Z.isBlockInFrame(e.blockStore))return{blockStore:e.blockStore,discussionInputStore:e.discussionInputStore}}),{debugName:"newMarginDiscussionArgsStore"}),s=new g.Z((()=>w.Z.getFramePageFirstSelectedDiscussionId()),{debugName:"selectedDiscussionIdStore"});let r=!1;const a=(0,p.debounce)((()=>{const{selectableRectMap:i,pageContentStores:a,sidebarIsAnimating:l,windowHeight:m}=e.state,p=o.state,g=n.state,f=s.state;if(c||l)return;const h=u();if(!(h&&R.current&&i&&i.size))return;(0,d.H0)({discussionStores:p,pageContentStores:a,marginDiscussionItemRefs:I.current,selectedDiscussionId:f,newMarginDiscussionArgs:g,marginContainerElement:R.current,pageViewBlockElement:h,onComputeComplete:(e,t)=>{r||(D.current=t,B||F(!0),T(e))},computedOnce:B,topbarHeight:_,windowHeight:m,isFullWidth:t.isFullWidth(),prevSelectedDiscussionId:E.selectedDiscussion,previousDiscussionElements:D.current})}),5);return e.addListener(a),o.addListener(a),s.addListener(a),n.addListener(a),()=>{r=!0,e.removeListener(a),o.removeListener(a),s.removeListener(a),n.removeListener(a)}}),[i,c,u,B,t,E.selectedDiscussion,A,_]);const P=(0,l.yK)((e=>({gradientOverlay:{position:"absolute",pointerEvents:"none",width:"100%",height:"100%",top:"-5px",background:`linear-gradient(to bottom, ${e.contentBackground} 0px, ${e.contentBackgroundTransparent} 15px)`},marginCommentsContainer:{display:"flex",flexDirection:"column",paddingTop:5,paddingBottom:5,paddingLeft:d.fS,paddingRight:d.fS,width:m-2*d.fS,flexShrink:0,height:"100%",position:"relative",pointerEvents:"none",zIndex:v.p8}})),[m]);return s.createElement("div",{style:P.marginCommentsContainer,ref:R},E.data.map(((e,t)=>n()(ne,{discussionData:e,timeMounted:o,onClick:L,isVisible:i,discussionItemElementMap:I.current,isDiscussionSelected:e.selected||"new"===e.type,isDiscussionHovered:e.id===Z,isLastItem:t===E.data.length-1},`margin-discussion-${e.id}`))),n()("div",{style:P.gradientOverlay}))}const ae=s.memo(re);function le(e){let{pageBlockStore:t,isVisible:o,pageViewBlockAccessor:i,context:p}=e;window.__c={n:"MarginCommentsSection"};const[g,f]=(0,s.useState)(!1),h=(0,r.O7)(),v=(0,s.useMemo)((()=>(new Date).getTime()),[]),S=(0,a.VK)((()=>t.isFullWidth()||p===u.S.CollectionPageView),[p,t]),b=(0,a.VK)((()=>{if(!S)return{position:"absolute",right:(0,d.oS)(h,(0,c.en)(t),(0,c.Ks)(t))}}),[S,h,t]),y=(0,s.useCallback)((()=>{f(!0)}),[]),w=(0,s.useCallback)((()=>{f(!1)}),[]),x=(0,l.yK)((()=>({marginCommentsSection:{display:o||g?"flex":"none",flexShrink:0,pointerEvents:"none",width:o?d.QB:0,...b}})),[o,g,b]);return n()(m.Z,{isVisible:!0,animationStyle:{opacity:o?1:0},onAnimationStart:y,onAnimationEnd:w,render:()=>n()("div",{style:x.marginCommentsSection},void 0,n()(ae,{pageBlockStore:t,timeMounted:v,isVisible:o,animating:g,pageViewBlockAccessor:i,width:d.QB}))})}},56940:(e,t,o)=>{o.d(t,{Z:()=>m});var i=o(83355),n=o(1302),s=o(24677),r=o(98104),a=o(80935),l=o(63334),c=o(27724),d=o(24666);class u extends i.Z{constructor(){super(...arguments),this.storeTypes={store:l.Z},this.restoreSelection=()=>{const{savedHref:e,savedSelectionStoreState:t,savedTextSelectionStoreState:o}=this.stores.store.state;window.location.href===e&&(this.props.ignoreBlockSelection&&t&&c.default.setState({...c.default.state,...t}),o&&"editing"===o.mode&&d.default.setState({...d.default.state,...o})),this.clearSelection()}}willMount(){this.props.focusOffscreenInput&&(this.input=document.createElement("input"),this.input.style.position="fixed",this.input.style.top="-9999px",this.input.style.left="-9999px",document.body.appendChild(this.input)),this.props.capture&&(this.saveSelection(),this.props.focusOffscreenInput&&n.default.afterNextFlush((()=>{this.input.focus()})))}willUpdate(e){this.props.capture?e.capture||(e.restoreSelection?this.restoreSelection():this.clearSelection()):e.capture&&(this.saveSelection(),this.props.focusOffscreenInput&&n.default.afterNextFlush((()=>{this.input.focus()})))}willUnmount(){this.props.capture&&(this.props.restoreSelection?this.restoreSelection():this.clearSelection()),this.props.focusOffscreenInput&&document.body.removeChild(this.input)}renderComponent(){return this.props.render(this.restoreSelection)}saveSelection(){this.stores.store.setState({...this.stores.store.state,savedHref:window.location.href,savedSelectionStoreState:c.default.cloneState(),savedTextSelectionStoreState:d.default.cloneState(),savedTextSelectionRect:a.getSelectionRect()}),this.props.ignoreBlockSelection?s.ZH(this.environment):r.ZH(this.environment)}clearSelection(){this.stores.store.setState({...this.stores.store.state,savedHref:void 0,savedSelectionStoreState:void 0,savedTextSelectionStoreState:void 0,savedTextSelectionRect:void 0});const e=this.input;n.default.afterNextFlush((()=>{e&&document.activeElement===e&&e.blur()}))}}u.displayName="IgnoreSelectionArea";const m=u},74136:(e,t,o)=>{o.d(t,{Z:()=>u});var i=o(10434),n=o.n(i),s=o(23174),r=o.n(s),a=o(67294),l=o(480),c=o(24405),d=o(64921);function u(e){window.__c={n:"Pill"};const t=(0,l.Fy)(),o=(0,c.yK)((e=>({sharedStyle:{display:"flex",alignItems:"center",borderRadius:3},innerStyle:{padding:"2px 6px",borderRadius:3,color:e.mediumTextColor,background:e.defaultBadgeBackground,fontSize:t.isMobile?11:9,lineHeight:t.isAndroid?1.5:1,textTransform:"uppercase",letterSpacing:"0.04em",whiteSpace:"nowrap"}})),[t.isAndroid,t.isMobile]);return t.isMobile?r()(d.Z,{style:{...o.sharedStyle,...e.mobileStyle},disabled:void 0===e.onClick},void 0,r()("div",{style:{...o.innerStyle,...e.innerStyle}},void 0,e.children)):a.createElement(d.Z,n()({style:{...o.sharedStyle,...e.desktopStyle},disabled:void 0===e.onClick},e),r()("div",{style:{...o.innerStyle,...e.innerStyle}},void 0,e.children))}},14568:(e,t,o)=>{o.d(t,{Z:()=>s});var i=o(35431);class n extends i.Z{}const s=new n},63334:(e,t,o)=>{o.d(t,{Z:()=>s});var i=o(49085);class n extends i.default{getInitialState(){return{}}}const s=n}}]);