"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[9849],{77985:(e,t,o)=>{o.d(t,{Pq:()=>le,oe:()=>ie,bU:()=>ne});var r=o(10434),n=o.n(r),i=o(23174),l=o.n(i),a=(o(57658),o(96486)),s=o.n(a),d=o(67294),c=o(83355),p=o(76205),u=o(53397),h=o(97880),m=o(5366),g=o(50906),v=o(97004),f=o(17335),y=o(87279),S=o(61766),M=o(13401),b=o(80951),C=o(43690),w=o(480),x=o(33929),k=o(98742),F=o(52275),Z=o(14871),T=o(58032),I=o(64369),R=o(62045);function V(e){window.__c={n:"CollectionFilterMenuDateFilterMode"};const{filter:t}=e,{isMobile:o}=(0,w.Fy)(),r=x.default.getIntl(),i={width:190,menuTitle:r.formatMessage({defaultMessage:"Date Options",id:"database.filterMenu.mobileDateFilterModeMenu.title"}),items:p.T,selectedItem:(0,p.TX)(t),getKey:e=>e,onSelect:o=>{const r={...t,use_end:(0,p.UG)(o)};e.onChange(r)},renderItem:e=>l()(T.Z,{renderTooltip:()=>(0,f._T)(e.value),render:t=>d.createElement(F.Z,n()({title:(0,f.IF)(e.value)},(0,k.Z)(e,t))),placement:T.Z.Placement.Right,textWrap:!0,style:{width:"260px"}}),renderOrigin:e=>d.createElement(R.Z,n()({},e,{placeholder:r.formatMessage({defaultMessage:"Date Options",id:"database.filterMenu.dateFilterModeMenu.label"}),title:l()(I.Z,{isMobile:o},void 0,(0,f.IF)((0,p.TX)(t))),disableMargins:!0,desktopStyle:{width:"100px"}}))};return d.createElement(Z.Z,n()({key:"date-filter-mode"},i,{mobileActionSheet:!0}))}var P=o(34299);class E extends c.Z{renderComponent(){const{filterValueType:e,filter:t,intl:o}=this.props,r=(0,p.xm)(e),i={width:190,menuTitle:o.formatMessage({defaultMessage:"Comparator",id:"database.filterMenu.mobileComparatorValueMenu.title"}),items:r,selectedItem:t.operator,getKey:e=>e,onSelect:o=>{const r=(0,f.li)(e,t,o,"combinator");this.props.onChange(r),g.wds(this.environment,{view_type:this.props.collectionViewType,action:"set_filter_comparator"})},renderItem:e=>d.createElement(F.Z,n()({title:(0,f.WC)(e.value)},e)),renderOrigin:e=>d.createElement(R.Z,n()({},e,{placeholder:o.formatMessage({defaultMessage:"Comparator",id:"database.filterMenu.comparatorMenuDropdownButton.label"}),title:l()(I.Z,{isMobile:this.environment.device.isMobile},void 0,(0,f.WC)(t.operator)),disableMargins:!0}))};return d.createElement(Z.Z,n()({key:"comparator"},i,{mobileActionSheet:!0}))}}E.displayName="CollectionFilterMenuFilterOperator";const A=(0,m.injectIntl)(E);var _=o(28463),B=o(26909);const O=(0,m.defineMessages)({setFilter:{defaultMessage:"Set filter",id:"database.filterMenu.rollupPropertyValue.mobileMenu.title"}});class D extends c.Z{renderComponent(){const{filter:e}=this.props;if((0,p.a_)(e))return this.renderArrayFilter(e);const t=(0,p.fI)({schema:this.props.schema,property:this.props.property,getRecordValue:this.props.parentStore.getRecordValue});if(!(0,p.ZB)(t,e)){const e=(0,f.rn)(t);return l()(d.Fragment,{},void 0,l()(A,{filterValueType:t,filter:e,collectionViewType:this.props.collectionViewType,onChange:this.props.onChange}),l()(_.Z,{filterValueType:t,filter:e,schema:this.props.schema,property:this.props.property,parentStore:this.props.parentStore,collectionViewType:this.props.collectionViewType,collectionViewId:this.props.collectionViewId,onChange:this.props.onChange}))}const o=d.createElement(m.FormattedMessage,n()({},f.xe[t],{values:{property:l()(m.FormattedMessage,{id:"collectionFilterMenuFilter.property.name",defaultMessage:"Property"}),operator:l()(A,{filterValueType:t,filter:e,collectionViewType:this.props.collectionViewType,onChange:this.props.onChange}),operatorValue:l()(_.Z,{filterValueType:t,filter:e,schema:this.props.schema,property:this.props.property,parentStore:this.props.parentStore,collectionViewType:this.props.collectionViewType,collectionViewId:this.props.collectionViewId,onChange:this.props.onChange})}}));return this.environment.device.isMobile?o:l()("div",{style:{alignItems:"center",display:"grid",gridAutoFlow:"column",gridAutoColumns:"1fr",gridColumnEnd:this.props.isArrayFilter?void 0:"span 2",gridColumnGap:`${B.l0}px`,gridTemplateRows:`${B.fg}px`,gridTemplateColumns:"[value-start] max-content auto [value-end operator-start] auto"}},void 0,o)}renderArrayFilter(e){const{intl:t}=this.props,o={menuTitle:t.formatMessage(O.setFilter),items:p.Rf,getKey:e=>e,selectedItem:e.operator,onSelect:t=>{const o={...e,operator:t};this.props.onChange(o),g.wds(this.environment,{view_type:this.props.collectionViewType,action:"set_rollup_set_filter"})},renderItem:e=>d.createElement(F.Z,n()({title:(0,f.SW)(e.value,t)},e)),renderOrigin:o=>d.createElement(R.Z,n()({},o,{placeholder:t.formatMessage(O.setFilter),title:(0,f.SW)(e.operator,t),disableMargins:!0,desktopStyle:{minWidth:70}}))},r=(0,P.gT)({property:this.props.property,schema:this.props.schema,getRecordValue:this.props.parentStore.getRecordValue});if(!r)return l()("div",{style:{gridColumnEnd:"span 2"}});const i=l()(d.Fragment,{},void 0,d.createElement(Z.Z,n()({key:"set_filter"},o,{mobileActionSheet:!0})),l()(L,{collectionViewId:this.props.collectionViewId,filter:e.subfilter,schema:r.targetCollectionSchema,property:r.targetProperty,parentStore:this.props.parentStore,collectionViewType:this.props.collectionViewType,onChange:t=>{const o={...e,subfilter:t};this.props.onChange(o)},isArrayFilter:!0}));return this.environment.device.isMobile?i:l()("div",{style:{display:"grid",gridAutoFlow:"column",gridAutoColumns:"1fr",gridColumnEnd:"span 2",gridColumnGap:`${B.l0}px`,gridTemplateColumns:"max-content",gridTemplateRows:`${B.fg}px`}},void 0,i)}}D.displayName="LocalizableCollectionFilterMenuFilter";const L=(0,m.injectIntl)(D),W=L;var G=o(31945),N=o(77498),U=o(50542);class H extends c.Z{constructor(){super(...arguments),this.handleChangeProperty=e=>{var t,o;const{schema:r}=this.props,{property:n,filter:i}=this.props.propertyFilter,l=r[n],a=r[e],s={property:e,filter:i},d=a&&(0,p.J5)(a,i),c=a&&"relation"===a.type&&n!==e,u=l&&("created_by"===l.type||"last_edited_by"===l.type)&&a&&"person"===a.type,h=(0,p.Gb)(i)&&!(0,p.mv)(i)&&(0,p.R8)(i).some((e=>"exact"===e.type&&e.value&&"bot"===e.value.table));(!d||c||u&&h||!(0,C.dN)(s,r))&&(s.filter=(0,f.zZ)({schema:r,property:e,getRecordValue:this.props.parentStore.getRecordValue})),null===(t=(o=this.props).onChange)||void 0===t||t.call(o,this.props.index,s),g.wds(this.environment,{view_type:this.props.collectionViewType,action:"set_filter_property"})}}renderComponent(){const{device:e}=this.environment,{schema:t,propertyFilter:o}=this.props,r=(0,b.Qm)({schema:t,property:o.property});if(!r)return;if(!(0,p.J5)(r,o.filter))return;const i=(0,p.gE)(o.filter)&&(0,p.vR)(o.filter)&&"date"===r.type?{width:"120px",marginRight:"4px"}:{},a=l()(d.Fragment,{},void 0,l()(G.ZP,{popupType:e.isMobile?G.Z4.SlideUp:G.Z4.Popup,renderOrigin:e=>d.createElement(U.Z,n()({},e,{propertySchema:r,disableMargins:!0,textWrapperStyle:{width:"100%",...i}})),render:e=>l()(N.Z,{isRelationProperty:!1,schema:this.props.schema,onAccept:this.handleChangeProperty,onClose:e.close})}),(0,p.gE)(o.filter)&&(0,p.vR)(o.filter)&&"date"===r.type&&l()(V,{filter:o.filter,onChange:e=>{var t,r;const n={...o,filter:e};null===(t=(r=this.props).onChange)||void 0===t||t.call(r,this.props.index,n)}}));return l()(d.Fragment,{},void 0,this.props.filterOperator,e.isMobile?a:l()("div",{style:{display:"flex"}},void 0,a),l()(m.FormattedMessage,{id:"collectionFilterMenuRow.propertyConjunction.label",defaultMessage:" "}),l()(W,{filter:o.filter,schema:t,property:o.property,parentStore:this.props.parentStore,collectionViewId:this.props.collectionViewId,collectionViewType:this.props.collectionViewType,onChange:e=>{var t,r;const n={...o,filter:e};null===(t=(r=this.props).onChange)||void 0===t||t.call(r,this.props.index,n)},isArrayFilter:!1}))}}H.displayName="CollectionFilterMenuRow";const K=H;function z(){return l()(m.FormattedMessage,{defaultMessage:"Add filter rule",id:"database.filterMenu.addFilterRuleButtonTitle"})}const q=(0,m.defineMessages)({operatorPlaceholder:{defaultMessage:"Operator",id:"database.filterMenu.operatorPlaceholder"}});class Q extends c.Z{renderComponent(){const{intl:e,filterOperator:t,onChange:o,disableMargins:r}=this.props,i={width:"auto",menuTitle:e.formatMessage({defaultMessage:"Operator",id:"database.filterMenu.filterOperatorMenu.title"}),items:p.Uz,getKey:e=>e,selectedItem:t,onSelect:o,renderItem:t=>d.createElement(F.Z,n()({title:(0,f.KV)(t.value,e),caption:(0,f.Qz)(t.value,e)},t)),renderOrigin:o=>d.createElement(R.Z,n()({},o,{title:t&&(0,f.KV)(t,e),placeholder:e.formatMessage(q.operatorPlaceholder),disableMargins:r}))};return d.createElement(Z.Z,n()({key:"operator"},i,{mobileActionSheet:!0}))}}Q.displayName="CollectionFilterOperatorSelect";const $=(0,m.injectIntl)(Q);var Y=o(31339),j=o(8982),J=o(73063),X=o(78140),ee=o(32163),te=o(40721),oe=o(44532),re=o(72495);const ne=170,ie=400;class le extends c.Z{constructor(){super(...arguments),this.buttonPopupStores=[],this.renderChildFilter=(e,t)=>{const o=this.environment.device.isMobile;return(0,p.vA)(e)?o?this.renderMobileCombinatorFilter(e,t):this.renderDesktopCombinatorFilter(e,t):(0,p.aN)(e)?o?this.renderMobilePropertyFilter(e,t):this.renderDesktopPropertyFilter(e,t):void 0},this.renderAddFilterMenuItem=e=>{const t=this.renderMenuIcon(u.Z.plus);return d.createElement(F.Z,n()({focused:!1},e,{icon:t,title:l()(z,{})}))},this.renderAddFilterGroupMenuItem=e=>{const t=this.renderMenuIcon(u.Z.addFilterGroup);return d.createElement(F.Z,n()({focused:!1},e,{icon:t,title:l()(m.FormattedMessage,{defaultMessage:"Add filter group",id:"database.filterMenu.addFilterGroup2ButtonTitle"}),caption:l()(m.FormattedMessage,{defaultMessage:"A group to nest more filters",id:"database.filterMenu.addFilterGroupButtonCaption"})}))},this.renderCombinatorActions=()=>{const{device:e}=this.environment;if(e.isMobile)return l()(re.Z,{topBorder:this.shouldRenderEmptyState()},void 0,this.renderAddFilterMenuItem({onClick:this.handleAddFilterClick}),this.allowNewCombinatorFilters()&&this.renderAddFilterGroupMenuItem({onClick:this.handleAddFilterGroupClick}));const t={height:32},o={padding:`${B.cn}px 0`};return this.allowNewCombinatorFilters()?l()(re.Z,{topBorder:this.shouldRenderEmptyState(),desktopStyle:o},void 0,l()(G.ZP,{alignmentToOrigin:oe.ZP.Alignment.Start,popupType:oe.ZP.PopupType.Popup,renderOrigin:e=>l()(j.i,{action:()=>e.onClick(),render:o=>{const{focused:r,...i}=o;return d.createElement(M.Z,n()({},e,i,{focused:r,isBlue:!1,style:t,title:l()("div",{},void 0,l()(z,{}),u.Z.chevronDown({width:10,marginLeft:6,display:"inline"}))}))}}),render:e=>l()(ee.Z,{type:ee.i.Vertical,initialFocus:0,sections:[{key:"actions",render:e=>d.createElement(re.Z,e),items:[{key:"add_filter",render:this.renderAddFilterMenuItem,action:t=>{e.close(),this.handleAddFilterClick()}},{key:"add_filter_group",render:this.renderAddFilterGroupMenuItem,action:t=>{e.close(),this.handleAddFilterGroupClick()}}]}]})})):l()(re.Z,{topBorder:this.shouldRenderEmptyState(),desktopStyle:o},void 0,l()(j.i,{action:this.handleAddFilterClick,render:e=>{const{focused:o,...r}=e;return d.createElement(M.Z,n()({},r,{focused:e.focused,isBlue:!1,style:t,onClick:this.handleAddFilterClick,title:l()(z,{})}))}}))},this.handleChildFilterChange=(e,t)=>{this.mutateFilters((o=>o.splice(e,1,t)))},this.handleAddFilterClick=()=>{const e=this.getDefaultNewPropertyFilter(this.props.schema);this.mutateFilters((t=>t.push(e))),g.wds(this.environment,{view_type:this.props.collectionViewType,action:"add_filter"})},this.handleAddFilterGroupClick=()=>{const e=this.getDefaultNewPropertyFilter(this.props.schema),t={operator:this.getOppositeOperator(),filters:[e]},o=this.mutateFilters((e=>e.push(t)));this.openIndex(o-1),g.wds(this.environment,{view_type:this.props.collectionViewType,action:"add_filter_group"})},this.handleChangeFilterOperator=e=>{const t={...this.props.combinatorFilter,operator:e};this.props.onChange(this.props.index,t),g.wds(this.environment,{view_type:this.props.collectionViewType,action:"set_filter_operator"})}}willUnmount(){this.buttonPopupStores=[]}renderComponent(){const{combinatorFilter:e}=this.props,{device:t}=this.environment,o=(e.filters??[]).flatMap((e=>(0,p.Mm)(e)?[]:[e]));return l()(d.Fragment,{},void 0,this.shouldRenderEmptyState()?void 0:l()("div",{style:t.isMobile?void 0:this.getGridStyles()},void 0,o.map(this.renderChildFilter)),this.renderCombinatorActions())}renderDesktopPropertyFilter(e,t){return l()(d.Fragment,{},t,l()(K,{index:t,propertyFilter:e,schema:this.props.schema,filterOperator:this.renderCombinatorOperator(t),parentStore:this.props.parentStore,onChange:this.handleChildFilterChange,collectionViewType:this.props.collectionViewType,collectionViewId:this.props.collectionViewId},t),this.renderRowActions(e,t))}renderMobilePropertyFilter(e,t){return l()(d.Fragment,{},t,this.renderCombinatorOperator(t),l()(re.Z,{title:l()(m.FormattedMessage,{defaultMessage:"Filter {index}",id:"database.filterMenu.filterIndex",values:{index:t+1}})},void 0,l()(K,{index:t,propertyFilter:e,schema:this.props.schema,filterOperator:null,parentStore:this.props.parentStore,onChange:this.handleChildFilterChange,collectionViewType:this.props.collectionViewType,collectionViewId:this.props.collectionViewId},t),this.renderRowActions(e,t)))}renderDesktopCombinatorFilter(e,t){const o={gridColumn:"property-start / value-end",...this.getSubgridWrapperStyles()};return l()(d.Fragment,{},t,this.renderCombinatorOperator(t),l()("div",{style:o},void 0,l()(le,{index:t,level:this.props.level+1,combinatorFilter:e,onChange:this.handleChildFilterChange,parentStore:this.props.parentStore,schema:this.props.schema,collectionViewType:this.props.collectionViewType,collectionViewId:this.props.collectionViewId})),this.renderRowActions(e,t))}renderMobileCombinatorFilter(e,t){const o=(e.filters||[]).length,r=l()(m.FormattedMessage,{defaultMessage:"Filter Group {index}",id:"database.filterMenu.filterGroupIndex",values:{index:t+1}});return l()(d.Fragment,{},t,this.renderCombinatorOperator(t),l()(re.Z,{title:r},void 0,l()(G.ZP,{buttonPopupStore:this.getButtonPopupStore(t),popupType:G.Z4.SlideUp,renderOrigin:t=>d.createElement(F.Z,n()({focused:!1},t,{showExtensionArrow:!0,right:o.toString(),title:(0,f.qh)({filter:e,schema:this.props.schema})})),render:o=>l()(X.Z,{menuType:y.og.Modal,title:r,left:l()(te.BackMenuText,{}),onClickLeft:o.close},void 0,l()(le,{index:t,level:this.props.level+1,combinatorFilter:e,onChange:this.handleChildFilterChange,parentStore:this.props.parentStore,schema:this.props.schema,collectionViewType:this.props.collectionViewType,collectionViewId:this.props.collectionViewId}))}),this.renderRowActions(e,t)))}renderCombinatorOperator(e){const t=this.props.combinatorFilter.operator,{device:o}=this.environment,r={justifySelf:"end"},n={...r,lineHeight:"32px",paddingRight:4};if(0===e){if(o.isMobile)return;return l()(I.Z,{style:n},void 0,l()(m.FormattedMessage,{defaultMessage:"Where",id:"database.filterMenu.where"}))}if(1===e){const e=l()($,{disableMargins:!0,filterOperator:t,onChange:this.handleChangeFilterOperator});return this.environment.device.isMobile?l()(re.Z,{},void 0,e):l()("div",{style:r},void 0,e)}if(!o.isMobile)return l()(I.Z,{style:n},void 0,l()(se,{operator:t}))}renderRowActions(e,t){return this.environment.device.isMobile?this.renderRowActionMenuItems(e,t,void 0):l()(G.ZP,{popupType:oe.ZP.PopupType.Popup,renderOrigin:e=>l()(j.i,{action:()=>e.onClick(),render:e=>d.createElement(J.Z,n()({},e,{hovered:e.focused,style:{width:"100%",height:32},icon:u.Z.dots}))}),render:o=>this.renderRowActionMenuItems(e,t,o)})}renderMenuIcon(e,t){return l()(Y.Z,{icon:e,styles:t})}renderRowActionMenuItems(e,t,o){const r=(0,p.vA)(e),i=l()(m.FormattedMessage,r?{defaultMessage:"Remove",id:"database.filterMenu.removeFilterGroupMenuTitle"}:{defaultMessage:"Remove",id:"database.filterMenu.removeFilterMenuTitle"}),a=l()(m.FormattedMessage,r?{defaultMessage:"Duplicate",id:"database.filterMenu.duplicateFilterGroupMenuTitle"}:{defaultMessage:"Duplicate",id:"database.filterMenu.duplicateFilterMenuTitle"}),s=[{key:"delete",action:()=>{o&&o.close(),this.handleDeleteFilter(t)},render:e=>d.createElement(F.Z,n()({},e,{icon:this.renderMenuIcon(u.Z.trash),title:i}))},{key:"duplicate",action:()=>{o&&o.close(),this.handleDuplicateFilter(t)},render:e=>d.createElement(F.Z,n()({},e,{icon:this.renderMenuIcon(u.Z.duplicate),title:a}))}];if((0,p.aN)(e)&&this.allowNewCombinatorFilters()&&s.push({key:"turn_into_group",action:()=>{o&&o.close(),this.handleTurnIntoGroup(t,e)},render:e=>d.createElement(F.Z,n()({},e,{icon:this.renderMenuIcon(u.Z.loop),title:l()(m.FormattedMessage,{defaultMessage:"Turn into group",id:"database.filterMenu.turnIntoGroupMenuTitle"})}))}),(0,p.vA)(e)&&e.filters&&1===e.filters.length){const r=(0,p.vA)(e.filters[0])?l()(m.FormattedMessage,{defaultMessage:"Unwrap group",id:"database.filterMenu.unwrapGroupMenuTitle"}):l()(m.FormattedMessage,{defaultMessage:"Turn into filter",id:"database.filterMenu.turnIntoFilterMenuTitle"});s.push({key:"turn_into_filter",action:()=>{o&&o.close(),this.handleTurnIntoFilter(t,e)},render:e=>d.createElement(F.Z,n()({},e,{icon:this.renderMenuIcon(u.Z.loop),title:r}))})}const c=ae(e);return(0,p.vA)(e)&&this.props.level+c+1<3&&s.push({key:"wrap_in_group",action:()=>{o&&o.close(),this.handleTurnIntoGroup(t,e)},render:e=>d.createElement(F.Z,n()({},e,{icon:this.renderMenuIcon(u.Z.loop),title:l()(m.FormattedMessage,{defaultMessage:"Wrap in group",id:"database.filterMenu.wrapInGroupMenuTitle"}),caption:l()(m.FormattedMessage,{defaultMessage:"Create a filter group around this",id:"database.filterMenu.wrapInGroupMenuCaption"})}))}),l()(ee.Z,{initialFocus:this.environment.device.isMobile?void 0:0,type:ee.i.Vertical,sections:[{key:"actions",render:this.environment.device.isMobile?e=>d.createElement("div",e):e=>d.createElement(re.Z,e),items:s}]})}handleDuplicateFilter(e){this.mutateFilters((t=>{const o=t[e];if(o){const r={...o};t.splice(e,0,r)}})),g.wds(this.environment,{view_type:this.props.collectionViewType,action:"duplicate_filter"})}handleTurnIntoGroup(e,t){const o={operator:this.getOppositeOperator(),filters:[t]};this.handleChildFilterChange(e,o),this.openIndex(e),g.wds(this.environment,{view_type:this.props.collectionViewType,action:"turn_into_filter_group"})}handleTurnIntoFilter(e,t){const o=s().first(t.filters||[]);o&&!(0,p.Mm)(o)&&this.handleChildFilterChange(e,o),g.wds(this.environment,{view_type:this.props.collectionViewType,action:"turn_into_filter"})}handleDeleteFilter(e){this.mutateFilters((t=>t.splice(e,1))),this.getButtonPopupStore(e).reset(),this.buttonPopupStores.splice(e,1)}openIndex(e){this.getButtonPopupStore(e).setState({open:!0})}getButtonPopupStore(e){for(;this.buttonPopupStores.length<e+1;){const e=new S.Z;this.buttonPopupStores.push(e)}return this.buttonPopupStores[e]}getOppositeOperator(){return"or"===this.props.combinatorFilter.operator?"and":"or"}allowNewCombinatorFilters(){return this.props.level<2}getDefaultNewPropertyFilter(e){const t=(this.props.combinatorFilter.filters||[]).filter(p.aN),o=t[t.length-1];return o?s().cloneDeep(o):(0,v.Me)(e)}mutateFilters(e){const t=[...this.props.combinatorFilter.filters||[]],o=e(t),r={...this.props.combinatorFilter,filters:t};return this.props.onChange(this.props.index,r),o}shouldRenderEmptyState(){return(0,p.$1)(this.props.combinatorFilter)&&0===this.props.level}getEmptyTextWrapStyle(){return{color:this.theme.lightTextColor,lineHeight:1.5,whiteSpace:"nowrap"}}getSubgridWrapperStyles(){return{background:this.theme.filterGroupBackground,borderRadius:3,boxShadow:`0 0 0 1px ${this.theme.filterGroupBorder}`,margin:1,alignSelf:"stretch"}}getGridStyles(){return le.style}}function ae(e){if((0,p.vA)(e)){const t=(e.filters||[]).filter(p.vA);return 1+(s().max(t.map(ae))||0)}return 0}function se(e){const{operator:t,lowercase:o}=e;return"or"===t?l()(m.FormattedMessage,o?{id:"collectionFilterCombinatorGrid.filterOperator.or.lowercase",defaultMessage:"or"}:{id:"collectionFilterCombinatorGrid.filterOperator.or",defaultMessage:"Or"}):"and"===t?l()(m.FormattedMessage,o?{id:"collectionFilterCombinatorGrid.filterOperator.and.lowercase",defaultMessage:"and"}:{id:"collectionFilterCombinatorGrid.filterOperator.and",defaultMessage:"And"}):(0,h.t1)(t)}le.displayName="CollectionFilterCombinatorGrid",le.style={display:"grid",gridTemplateColumns:`\n             [boolean-start] 60px\n             [boolean-end property-start] minmax(min-content, 120px)\n             [property-end operator-start] 110px\n             [operator-end value-start] auto\n             [value-end menu-start] ${B.fg}px\n             [menu-end]\n        `,gridAutoRows:`minmax(${B.fg}px, auto)`,gridColumnGap:B.l0,gridRowGap:B.cn,padding:`${B.cn}px ${B.l0}px 0 ${B.l0}px`,justifyItems:"stretch",alignItems:"start"}},28463:(e,t,o)=>{o.d(t,{Z:()=>Y,$:()=>$});var r=o(10434),n=o.n(r),i=o(23174),l=o.n(i),a=o(67294),s=o(83355),d=o(66897),c=o(76205),p=o(99036),u=o(80951),h=o(84619),m=o(40506),g=o(76725),v=o(32056),f=o(23014),y=o(97880),S=o(82990),M=o(5366),b=o(50906),C=o(17335),w=o(29376),x=o(68216),k=o(77985),F=o(19777),Z=o(68834),T=o(49085),I=o(8982),R=o(36488),V=o(74194),P=o(68894);const E=(0,M.defineMessages)({value:{defaultMessage:"Value",id:"database.filterAndSort.propertyValueInput.placeholder"}});class A extends s.Z{constructor(){super(...arguments),this.storeTypes={isEditing:T.default.createClass(!1)},this.input=null,this.handleClick=()=>{this.stores.isEditing.setState(!0)},this.handleInputBlur=()=>{this.stores.isEditing.setState(!1)},this.handleInputCancel=()=>{this.input&&(this.input.handleBlur(),this.handleInputBlur())},this.handleInputChange=e=>{const t=e.target.value;this.props.onChange(t)}}renderComponent(){return l()("div",{style:{display:"flex",...this.getDivStyle()},onClick:this.handleClick},void 0,this.renderInput())}renderInput(){const{device:e}=this.environment,t=this.stores.isEditing.state,o=this.props.value||"",{intl:r}=this.props;return e.isMobile?l()(P.ZP,{value:o,onChange:this.handleInputChange,placeholder:r.formatMessage(E.value),onBlur:this.handleInputBlur,rightMobileEditLabel:l()(M.FormattedMessage,{defaultMessage:"Edit",id:"database.filterAndSort.mobileEditButton.label"})}):l()(I.i,{action:()=>this.stores.isEditing.setState(!0),render:e=>a.createElement("div",{ref:e.ref,onMouseEnter:e.onMouseEnter,style:{background:e.focused&&!t?this.theme.buttonHoveredBackground:"transparent",...this.getDivStyle()}},l()(R.Z,{capture:t,render:e=>a.createElement("div",n()({},e,{style:this.getDivStyle()}),a.createElement(V.Z,{focus:t,ref:e=>this.input=e,value:o,onChange:this.handleInputChange,placeholder:r.formatMessage(E.value),onBlur:this.handleInputBlur,onCancel:this.handleInputCancel,style:this.getInputStyle()}))}))})}getDivStyle(){return A.disableMarginStyles}getInputStyle(){return{...A.inputStyle,...A.disableMarginStyles,minWidth:k.bU}}}A.displayName="CollectionOperatorValueInput",A.inputStyle={marginRight:8,paddingLeft:6,paddingRight:0,width:80,height:30},A.disableMarginStyles={margin:0,width:"100%",height:"100%",transition:"background 120ms ease-in"};const _=(0,M.injectIntl)(A);var B=o(26909),O=o(52275),D=o(31945),L=o(12508),W=o(14871),G=o(92864),N=o(89845),U=o(62045),H=o(69265),K=o(14390),z=o(22084);const q=(0,M.defineMessages)({dateTitle:{defaultMessage:"Date",id:"database.filterMenu.mobileDateSelectMenu.title"},emptyPlaceholder:{defaultMessage:"Empty",id:"database.filterMenu.dateSelectMenu.emptyPlaceholder"}});class Q extends s.Z{constructor(){super(...arguments),this.getRelatedCollectionAppConfigUri=this.createComputedStore((()=>{const{schema:e,property:t,parentStore:o}=this.props,r=e[t];if(r&&(0,p.p_)(r))return(0,w.ke)(r,o)})),this.renderPersonInner=e=>{var t;const{device:o}=this.environment;if(!e.value)return;if("relative"===e.type&&"me"===e.value)return l()("span",{style:{marginTop:1,marginRight:10,marginBottom:6}},void 0,l()(M.FormattedMessage,{defaultMessage:"Me",id:"database.filterAndSort.firstPersonPropertyValue.title"},"relative"));const r=(0,d.Hl)({pointer:e.value,getRecordValue:this.props.parentStore.getRecordValue});return l()(G.ZP,{actor:r,isSingle:!1,shouldShrink:!1,format:o.isMobile?G.vw.Format.Large:G.vw.Format.Medium,showRemoveButton:!1},null===(t=r.asActor)||void 0===t?void 0:t.id)}}renderComponent(){const{filter:e,property:t,collectionViewId:o,schema:r,parentStore:n}=this.props,i=this.props.filterValueType,a=l()("span",{});if("date"===i)return(0,c.gE)(e)?(0,c.mv)(e)?a:(0,c.TQ)(e)?this.renderDateRangeFilterOperatorValue(e):this.renderDateFilterOperatorValue(e):a;if("text"===i){if(!(0,c.Ly)(e))return a;const t=e;if((0,c.mv)(t))return a;if("string_has_no_alphabet_prefix"===t.operator)return;const o=t.value;return l()(_,{value:o.value,onChange:e=>{const o={type:"exact",value:e},r={...t,value:o};this.props.onChange(r)}})}if("number"===i){if(!(0,c.h6)(e))return a;const t=e;if((0,c.mv)(t))return a;const o=t.value;return l()(_,{value:void 0===o.value?"":o.value.toString(),onChange:e=>{const o={type:"exact",value:(0,v.p3)(e)},r={...t,value:o};this.props.onChange(r)}})}if("checkbox"===i){if(!(0,c.XA)(e)||!o)return a;const i=e,s=i.value;return l()(D.ZP,{popupType:this.environment.device.isMobile?D.Z4.SlideUp:D.Z4.Popup,renderOrigin:e=>this.renderCheckboxOrigin(s,e),render:e=>l()(F.ZP,{collectionViewId:o,propertyFilter:{property:t,filter:i},schema:r,onChange:e=>{this.props.onChange(e)},onClose:e.close,parentStore:n,context:F.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}if("select"===i||"multi_select"===i||"status"===i){if(!((0,c.dx)(e)||(0,c.NU)(e)||(0,c.r2)(e))||!o)return a;const i=e;if((0,c.mv)(i))return a;const s=this.props.schema[this.props.property];if(!s)return a;const d=(0,c.dx)(i)?(0,c.mg)(i):(0,c.NU)(i)?(0,c.qC)(i):(0,c.Js)(s,(0,c.wB)(i));return l()(D.ZP,{popupType:this.environment.device.isMobile?D.Z4.SlideUp:D.Z4.Popup,renderOrigin:e=>this.renderSelectOrigin(d,e),render:e=>l()(F.ZP,{collectionViewId:o,propertyFilter:{property:t,filter:i},schema:r,onChange:e=>{this.props.onChange(e)},onClose:e.close,parentStore:n,context:F.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}if("location"===i){if(!(0,c.Mp)(e))return a;const i=e,s=(0,c.u0)(i);return l()(D.ZP,{popupType:this.environment.device.isMobile?D.Z4.SlideUp:D.Z4.Popup,renderOrigin:e=>this.renderLocationOrigin(s,e),render:e=>l()(F.ZP,{collectionViewId:o,propertyFilter:{property:t,filter:i},schema:r,onChange:e=>{this.props.onChange(e)},onClose:e.close,parentStore:n,context:F.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}if("relation"===i){if(!(0,c.e)(e)||!o)return a;const i=e;if((0,c.mv)(i))return a;const s=(0,c.YO)(i);return l()(D.ZP,{popupType:this.environment.device.isMobile?D.Z4.SlideUp:D.Z4.Popup,renderOrigin:e=>this.renderRelationOrigin(s,e),render:e=>l()(F.ZP,{collectionViewId:o,propertyFilter:{property:t,filter:i},schema:r,onChange:e=>{this.props.onChange(e)},onClose:e.close,parentStore:n,context:F.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}if("person"===i){if(!(0,c.Gb)(e)||!o)return a;const i=e;if((0,c.mv)(i))return a;const s=(0,c.R8)(i);return l()(D.ZP,{popupType:this.environment.device.isMobile?D.Z4.SlideUp:D.Z4.Popup,renderOrigin:e=>this.renderPersonOrigin(s,e),render:e=>l()(F.ZP,{collectionViewId:o,propertyFilter:{property:t,filter:i},schema:r,onChange:e=>{this.props.onChange(e)},onClose:e.close,parentStore:n,context:F.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}if("file"===i){if(!(0,c.W6)(e))return a;const t=e;if((0,c.mv)(t))return a;(0,y.t1)(t)}if("verification"===i)return(0,c.Jw)(e)?l()(D.ZP,{popupType:this.environment.device.isMobile?D.Z4.SlideUp:D.Z4.Popup,renderOrigin:t=>this.renderVerificationOrigin((0,c.fl)(e),t),render:i=>l()(F.ZP,{collectionViewId:o,propertyFilter:{property:t,filter:e},schema:r,onChange:e=>{this.props.onChange(e)},onClose:i.close,parentStore:n,context:F.Qv.AdvancedFilter,allowRelativePersonFilter:!1})}):a;(0,y.t1)(i)}renderCheckboxOrigin(e,t){const o=null==e?void 0:e.value;return a.createElement(U.Z,n()({},t,{disableMargins:!0,placeholder:l()(M.FormattedMessage,{defaultMessage:"Select a value",id:"database.filterOperatorValue.checkboxPlaceholder.title"}),title:"boolean"==typeof o&&l()(L.Z,{checked:o,size:16,disabled:!0})}))}renderSelectOrigin(e,t){const{device:o}=this.environment,r=this.props.schema[this.props.property],i=r&&((0,p.cu)(r)||"status"===r.type)&&r.options||[];return a.createElement(U.Z,n()({},t,{disableMargins:!0,desktopStyle:this.getValueDesktopStyle(),innerStyle:this.getValueInnerStyle(e.length>0),placeholder:l()(M.FormattedMessage,{defaultMessage:"Select an option",id:"collections.operatorValueSelect.placeholder"}),title:e.length>0&&a.createElement(a.Fragment,null,e.map((e=>{if(void 0===e.value)return null;const t=(0,u.i7)(i,e.value);return t?l()(z.a,{format:o.isMobile?h.l.Large:h.l.Medium,isSingle:!1,value:t.value,color:t.color,showRemoveButton:!1},e.value):null})))}))}renderRelationOrigin(e,t){const{device:o}=this.environment;return a.createElement(U.Z,n()({},t,{disableMargins:!0,desktopStyle:this.getValueDesktopStyle(),innerStyle:this.getValueInnerStyle(e.length>0),placeholder:l()(M.FormattedMessage,{defaultMessage:"Select a page",id:"databaseRelationOperators.selectPlaceholder"}),title:e.length>0&&e.map((e=>{if(!e.value)return;const t=e.type,r={isSingle:!1,shouldShrink:!1,format:o.isMobile?h.l.Large:h.l.Medium};if("exact"===t)return a.createElement(H.Z,n()({key:e.value,blockId:e.value,parentStore:this.props.parentStore},r));if("relative"===t){const t=this.getRelatedCollectionAppConfigUri.state;if(!t)return;return a.createElement(h.Z,n()({value:f.qB[t][e.value.variable].formattedMessage,backgroundColor:"transparent",theme:this.theme},r))}(0,y.t1)(t)}))}))}renderLocationOrigin(e,t){const{parentStore:o}=this.props;return a.createElement(U.Z,n()({},t,{disableMargins:!0,desktopStyle:this.getValueDesktopStyle(),innerStyle:this.getValueInnerStyle(e.length>0),placeholder:l()(M.FormattedMessage,{defaultMessage:"Select a location",id:"databaseLocationOperators.selectPlaceholder"}),title:e.length>0&&e.map((e=>e.value&&l()("div",{style:{margin:"0 10px 6px 0"}},void 0,l()(Z.Z,{collectionStore:x.NW.createChildStore(o,{table:"collection",id:e.value})},e.value))))}))}renderPersonOrigin(e,t){return a.createElement(U.Z,n()({},t,{placeholder:$(void 0),disableMargins:!0,desktopStyle:this.getValueDesktopStyle(),innerStyle:this.getValueInnerStyle(e.length>0),title:e.length>0&&e.map(this.renderPersonInner)}))}renderDateFilterOperatorValue(e){const{intl:t,collectionViewId:o,property:r,schema:i,parentStore:s}=this.props;if(!o)return;const d={menuTitle:t.formatMessage(q.dateTitle),items:c.tO,getKey:e=>"relative"===e.type?e.value:e.type,selectedItem:e.value,onSelect:t=>{const o={...e,value:t};this.props.onChange(o),b.wds(this.environment,{view_type:this.props.collectionViewType,action:"set_filter_value_type"})},renderItem:e=>a.createElement(O.Z,n()({title:(0,C.x)(e.value)},e)),renderOrigin:o=>a.createElement(U.Z,n()({},o,{disableMargins:!0,placeholder:t.formatMessage(q.emptyPlaceholder),title:(0,C.x)(e.value)}))},p=e.value;if("exact"===p.type){const t=l()(a.Fragment,{},void 0,l()(M.FormattedMessage,{id:"collectionFilterMenuFilterOperatorValue.date.exact.order",defaultMessage:"{exact}{dateValue}",values:{exact:a.createElement(W.Z,n()({key:"date-filter-value-type"},d,{mobileActionSheet:!0})),dateValue:l()(D.ZP,{popupType:this.environment.device.isMobile?D.Z4.SlideUp:D.Z4.Popup,renderOrigin:e=>this.renderExactDateOrigin(p,e,!1),render:t=>l()(F.ZP,{collectionViewId:o,propertyFilter:{property:r,filter:e},schema:i,onChange:e=>{this.props.onChange(e)},onClose:t.close,parentStore:s,context:F.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}})),c=this.environment.device.isDesktop?{display:"grid",justifyContent:"stretch",gridTemplateColumns:"1fr 1fr",gridColumnGap:B.l0,width:"100%"}:void 0;return l()("div",{style:c},void 0,t)}return a.createElement(W.Z,n()({key:"date-filter-value-type"},d,{mobileActionSheet:!0}))}renderExactDateOrigin(e,t,o){const r=this.props.schema[this.props.property],i=r&&"date"===r.type?r.date_format:void 0;let s;if("exact"===e.type&&e.value)if((0,m.J_)(e.value))s=e.value;else if((0,m.gR)(e.value)){const t=(0,m.Gc)(e.value);t&&(s=t.value)}return a.createElement(U.Z,n()({},t,{placeholder:l()(M.FormattedMessage,o?{defaultMessage:"Select a range",id:"database.filterAndSort.dateRangePropertyValue.placeholder"}:{defaultMessage:"Select a date",id:"database.filterAndSort.datePropertyValue.placeholder"}),desktopStyle:{minWidth:165},title:s&&l()("span",{style:{...S.Z.textOverflowStyle}},void 0,l()(N.Z,{value:s,dateFormat:i||m.sF})),disableMargins:!0}))}renderDateRangeFilterOperatorValue(e){const{intl:t,parentStore:o,schema:r,collectionViewId:i,property:s}=this.props;if(!i)return;const d={menuTitle:t.formatMessage(q.dateTitle),items:(0,c.bS)(),getKey:e=>(0,c.eX)(e),selectedItem:e.value,onSelect:t=>{const o={...e,value:t};this.props.onChange(o),b.wds(this.environment,{view_type:this.props.collectionViewType,action:"set_filter_value_type"})},renderItem:e=>a.createElement(O.Z,n()({title:(0,C.ip)(e.value)},e)),renderOrigin:o=>a.createElement(U.Z,n()({},o,{disableMargins:!0,placeholder:t.formatMessage(q.emptyPlaceholder),title:(0,C.ip)(e.value)}))},p=e.value;if("exact"===p.type){const t=l()(a.Fragment,{},void 0,l()(M.FormattedMessage,{id:"collectionFilterMenuFilterOperatorValue.dateRange.exact.order",defaultMessage:"{dateValue}",values:{exact:a.createElement(W.Z,n()({key:"date-filter-value-type"},d,{mobileActionSheet:!0})),dateValue:l()(D.ZP,{popupType:this.environment.device.isMobile?D.Z4.SlideUp:D.Z4.Popup,renderOrigin:e=>this.renderExactDateOrigin(p,e,!0),render:t=>l()(F.ZP,{collectionViewId:i,propertyFilter:{property:s,filter:e},schema:r,onChange:e=>{this.props.onChange(e)},onClose:t.close,parentStore:o,context:F.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}})),c=this.environment.device.isDesktop?{display:"grid",justifyContent:"stretch",gridTemplateColumns:"1fr 1fr",gridColumnGap:B.l0,width:"100%"}:void 0;return l()("div",{style:c},void 0,t)}return"relative"!==p.type||"custom"!==p.value&&"surrounding"!==p.value?a.createElement(W.Z,n()({key:"date-filter-value-type"},d,{mobileActionSheet:!0})):l()(K.b,{renderAsQueryDropdown:this.environment.device.isMobile,filter:p,onUpdate:t=>{const o={...e,value:t};this.props.onChange(o),b.wds(this.environment,{view_type:this.props.collectionViewType,action:"set_filter_value_type"})}})}renderVerificationOrigin(e,t){const o=e.filter((e=>{let{value:t}=e;return Boolean(t)})).map(C.cq);return a.createElement(U.Z,n()({},t,{disableMargins:!0,placeholder:l()(M.FormattedMessage,{defaultMessage:"Select an option",id:"CollectionFilterMenuFilterOperatorValue.verificationFilterSelect.placeholder"}),title:o.length&&l()("span",{},void 0,(0,g.Z)(o,(e=>l()("span",{style:{whiteSpace:"pre"}},e,l()(M.FormattedMessage,{defaultMessage:", ",id:"CollectionFilterMenuFilterOperatorValue.verificationFilterSelect.commaSeparator"})))))}))}getValueDesktopStyle(){return{maxWidth:k.oe}}getValueInnerStyle(e){return{paddingTop:e?6:void 0,overflow:"hidden"}}}function $(e){return l()(M.FormattedMessage,e?{defaultMessage:"Select one person",id:"database.personPropertyValue.selectPerson.searchPlaceholderWithLimit"}:{defaultMessage:"Select one or more people",id:"database.personPropertyValue.selectPerson.searchPlaceholder"})}Q.displayName="CollectionFilterMenuFilterOperatorValue";const Y=(0,M.injectIntl)(Q)},19777:(e,t,o)=>{o.d(t,{Qv:()=>Ve,ZP:()=>Oe,I4:()=>Le,Sm:()=>De});var r=o(10434),n=o.n(r),i=o(23174),l=o.n(i),a=(o(30541),o(57658),o(96486)),s=o.n(a),d=o(67294),c=o(83355),p=o(480),u=o(81954),h=o(49085),m=o(66897),g=o(76205),v=o(99036),f=o(80951),y=o(84619),S=o(23482),M=o(40506),b=o(53877),C=o(58573),w=o(42875),x=o(53397),k=o(32056),F=o(23014),Z=o(21202),T=o(77420),I=o(13493),R=o(29369),V=o(19889),P=o(70203),E=o(97880),A=o(82990),_=o(4308),B=o(5366),O=o(31299),D=o(28020),L=o(97004),W=o(17335),G=o(26991),N=o(33929),U=o(87279),H=o(98742),K=o(98165),z=o(29376),q=o(59054),Q=o(54814);var $=o(79315),Y=o(61766),j=o(29798),J=o(68216),X=o(68834),ee=o(28398),te=o(97180),oe=o(64921),re=o(52275),ne=o(31945),ie=o(12508),le=o(73063),ae=o(68894),se=o(3386),de=o(68785),ce=o(78140),pe=o(32163),ue=o(43765),he=o(40721),me=o(44532),ge=o(11470),ve=o(77137),fe=o(72495),ye=o(14871),Se=o(58032),Me=o(92864),be=o(64369),Ce=o(66653),we=o(41209),xe=o(93289),ke=o(83264),Fe=o(78948),Ze=o(69265),Te=o(22084),Ie=o(85567),Re=o(47082);let Ve=function(e){return e[e.AdvancedFilter=0]="AdvancedFilter",e[e.PropertyFilter=1]="PropertyFilter",e}({});const Pe=(0,B.defineMessages)({startingMessage:{defaultMessage:"Select or type a date...",id:"search.dateMenu.dateMessage"}}),Ee="50vh";class Ae extends c.Z{constructor(){super(...arguments),this.storeTypes={query:h.default.createClass(""),menuListStore:j.Z,dateFilterPopupStore:Y.Z,dateRangeFilterPopupStore:Y.Z},this.renderTextMenu=e=>{const{intl:t}=this.props,{device:o}=this.environment,r=l()(fe.Z,{isInput:!0,disableDesktopPadding:!0},void 0,l()(ae.ZP,{focus:!0,focusInitial:!0,focusAfterAnimation:!0,value:(0,g.vR)(e)&&e.value.value?e.value.value:"",onChange:e=>{const t=e.target.value;this.updateValue({type:"exact",value:t})},onClearButtonClick:()=>{this.updateValue({type:"exact",value:void 0})},placeholder:t.formatMessage({defaultMessage:"Type a value…",id:"database.filterValue.textType.searchPlaceholder"}),showClearButton:!0,textWrapperStyle:{marginLeft:8,marginRight:8}})),n=l()(fe.Z,{disableMobileBorders:!0,disableMobilePadding:!0},void 0,!o.isMobile&&this.renderDesktopTopActions(),(0,g.vR)(e)&&r);let i;return i=o.isMobile?{menuType:U.og.Modal,title:this.renderMobileMenuTitle(),left:this.renderMobileMoreActions(),right:l()(he.DoneMenuText,{}),onClickRight:this.props.onClose,header:n}:{menuType:U.og.Popup,maxHeight:Ee,width:220,header:n},d.createElement(ce.Z,i)},this.renderNumberMenu=e=>{const{intl:t}=this.props,{device:o}=this.environment,r=l()(fe.Z,{isInput:!0,disableDesktopPadding:!0},void 0,l()(ae.ZP,{focus:!0,focusInitial:!0,focusAfterAnimation:!0,value:(0,g.vR)(e)&&"number"==typeof e.value.value?e.value.value.toString():"",inputLeft:this.renderNumberOperator(e),onChange:e=>{const t=(0,k.p3)(e.target.value);this.updateValue({type:"exact",value:t})},onClearButtonClick:()=>{this.updateValue({type:"exact",value:void 0})},placeholder:t.formatMessage({defaultMessage:"Type a value…",id:"database.filterValue.numberType.searchPlaceholder"}),showClearButton:!0,textWrapperStyle:{marginLeft:8,marginRight:8}})),n=l()(fe.Z,{disableMobileBorders:!0,disableMobilePadding:!0},void 0,!o.isMobile&&this.renderDesktopTopActions(),(0,g.vR)(e)&&r);let i;return i=o.isMobile?{menuType:U.og.Modal,title:this.renderMobileMenuTitle(),left:this.renderMobileMoreActions(),right:l()(he.DoneMenuText,{}),onClickRight:this.props.onClose,header:n}:{menuType:U.og.Popup,maxHeight:Ee,width:220,header:n},d.createElement(ce.Z,i)},this.renderUserMenuItem=(e,t)=>{const{device:o}=this.environment,r=Boolean(t.find((t=>{var o;return"exact"===t.type&&(null===(o=t.value)||void 0===o?void 0:o.id)===e.id})));return{key:e.id,render:t=>d.createElement(re.Z,n()({},t,{title:l()(Me.vw,{isSingle:!0,shouldShrink:!0,format:o.isMobile?Me.vw.Format.Large:Me.vw.Format.Medium,userValue:e,showRemoveButton:!1}),isTokenTitle:!0,checkState:r})),action:()=>{const o=r?t.filter((t=>{var o;return!("exact"===t.type&&(null===(o=t.value)||void 0===o?void 0:o.id)===e.id)})):[...t,{type:"exact",value:{table:V.KJ,id:e.id}}];this.updateValue(o)}}},this.renderBotMenuItem=(e,t)=>{const{device:o}=this.environment,r=Boolean(t.find((t=>{var o;return"exact"===t.type&&(null===(o=t.value)||void 0===o?void 0:o.id)===e.id})));return{key:e.id,render:t=>d.createElement(re.Z,n()({},t,{title:l()(Me.Jn,{isSingle:!0,shouldShrink:!0,format:o.isMobile?Me.Jn.Format.Large:Me.Jn.Format.Medium,botValue:e,showRemoveButton:!1}),isTokenTitle:!0,checkState:r})),action:()=>{const o=r?t.filter((t=>{var o;return!("exact"===t.type&&(null===(o=t.value)||void 0===o?void 0:o.id)===e.id)})):[...t,{type:"exact",value:{table:T.cZ,id:e.id}}];this.updateValue(o)}}},this.getRelatedCollectionPartial=this.createComputedStore((()=>{const e=this.getFilterAppliedPropertySchema();return e&&(0,v.p_)(e)?{appConfigUri:(0,z.ke)(e,this.props.parentStore),schema:(0,z.uJ)(e,this.props.parentStore)}:{}})),this.renderMoreActionsPopup=e=>{const{allowAddingToCombinatorFilter:t}=this.props,{device:o}=this.environment;let r;r=o.isMobile?{menuType:U.og.ActionSheet}:{menuType:U.og.Popup,maxHeight:Ee};const i=s().compact([{key:"delete",render:e=>d.createElement(re.Z,n()({},e,{title:l()(B.FormattedMessage,{id:"database.filterValue.deleteFilter.title",defaultMessage:"Delete filter"}),icon:x.Z.trash({width:14})})),action:()=>{var t,o;e.close(),null===(t=(o=this.props).onDelete)||void 0===t||t.call(o)}},t&&{key:"merge",render:e=>l()(Se.Z,{placement:Se.Z.Placement.Right,style:{maxWidth:240,whiteSpace:void 0},renderTooltip:()=>l()("div",{},void 0,l()(ee.ep,{})),render:t=>d.createElement(re.Z,n()({},(0,H.Z)(e,t),{title:l()(B.FormattedMessage,{id:"database.filterValue.mergeIntoAdvancedFilter.title",defaultMessage:"Add to advanced filter"}),icon:x.Z.filter({width:14})}))}),action:()=>{var t,o;e.close(),null===(t=(o=this.props).onAddToCombinatorFilter)||void 0===t||t.call(o)}}]);return d.createElement(ce.Z,r,l()(pe.Z,{type:pe.i.Vertical,sections:[{key:"actions",render:e=>d.createElement(fe.Z,n()({disableMobilePadding:!0},e)),items:i}],initialFocus:void 0}))},this.handleClose=e=>{var t,o;null===(t=(o=this.props).onClose)||void 0===t||t.call(o)},this.getPersonAutocompleteResults=async e=>{let{users:t,bots:o}=await O.CO({environment:this.environment,query:e,membersOnly:!1});return t=t.slice(0,20),o=o.slice(0,20),await Promise.all([...t.map((async e=>{let{id:t}=e;const o=(0,J.Kv)(this.props.parentStore,{table:V.KJ,id:t});await o.load()})),...o.map((async e=>{const t=(0,J.Kv)(this.props.parentStore,{table:T.cZ,id:e.id,spaceId:e.space_id});await t.load()}))]),{users:t,bots:o}},this.getRelationAutocompleteResults=async e=>{const{query:t,spaceId:o,collectionId:r}=e;if(!o||!r)return[];const{results:n}=await O.df({environment:this.environment,query:t,collectionId:r,limit:20,spaceId:o,excludeTemplates:!0,source:"relation_menu",includePublicPagesWithoutExplicitAccess:!1,boostRecentlyViewedPages:!1});return 0===n.length?[]:(await Promise.all(n.map((async e=>{const t=(0,J.Kv)(this.props.parentStore,{table:Z.iU,id:e});await t.load()}))),n)}}renderComponent(){return l()(se.Z,{capture:!0,onEsc:this.handleClose},void 0,this.renderMenu())}renderMenu(){const{propertyFilter:e,schema:t,parentStore:o}=this.props,{property:r,filter:n}=e,i=(0,g.fI)({schema:t,property:r,getRecordValue:o.getRecordValue}),a=(0,g.a_)(n)?n.subfilter:n;if("text"===i)return(0,g.Ly)(a)&&this.renderTextMenu(a);if("relation"===i)return(0,g.e)(a)&&this.renderRelationRequest(a);if("checkbox"===i)return(0,g.XA)(a)&&this.renderCheckboxMenu(a);if("select"===i||"multi_select"===i)return((0,g.dx)(a)||(0,g.NU)(a))&&this.renderSelectMenu(a);if("status"===i)return(0,g.r2)(a)&&this.renderStatusMenu(a);if("person"===i)return(0,g.Gb)(a)&&this.renderPersonRequest(a);if("number"===i)return(0,g.h6)(a)&&this.renderNumberMenu(a);if("date"===i)return(0,g.gE)(a)&&this.renderDateMenu(a);if("file"===i);else{if("location"===i)return(0,g.Mp)(a)?l()(Be,{filter:a,parentStore:o,updateValue:e=>this.updateValue(e),onClose:this.props.onClose,desktopTopActions:this.renderDesktopTopActions(),mobileMenuTitle:this.renderMobileMenuTitle(),mobileMoreActions:this.renderMobileMoreActions()}):null;if("verification"===i)return(0,g.Jw)(a)&&this.renderVerificationMenu(a);(0,E.t1)(i)}}renderSelectMenu(e){const{intl:t}=this.props,{device:o}=this.environment,r=this.stores.query.state,n=this.getFilterAppliedPropertySchema();if(!n||!(0,v.cu)(n))return;const i=n.options||[],a=(0,g.vR)(e)?(0,g.dx)(e)?(0,g.mg)(e):(0,g.qC)(e):[],c=Le({query:r,propertySchema:n,selectedValues:a,updateValue:e=>{this.updateValue(e)},isMobile:o.isMobile,styles:{checkboxIcon:{fill:this.theme.regularIconColor,pointerEvents:"none"}}}),p=a.map((e=>{if(void 0===e.value)return;const t=(0,f.i7)(i,e.value);return t?l()(Te.a,{format:o.isMobile?y.l.Large:y.l.Small,isSingle:!1,value:t.value,color:t.color,showRemoveButton:!0,onClickRemove:()=>{const t=s().without(a,e);this.updateValue(t)}},t.id):void 0})),u=l()(Re.Z,{focus:!o.isMobile||void 0,focusAfterAnimation:!0,format:Re.Z.Format.FilterValue,tokens:p,placeholder:t.formatMessage({defaultMessage:"Select one or more options…",id:"database.filterValue.selectType.searchPlaceholder"}),onRemoveLastToken:()=>{const e=a.slice(0,a.length-1);this.updateValue(e)},onClearButtonClick:()=>{var e,t;this.updateValue([]),null===(e=(t=this.props).onClose)||void 0===e||e.call(t)},value:this.stores.query.state,onChange:e=>{this.updateInputValue(e.target.value)},dontShowBorderBottom:o.isAndroid,showClearButton:!0}),h=l()(fe.Z,{desktopStyle:{paddingBottom:0}},void 0,!o.isMobile&&this.renderDesktopTopActions(),(0,g.vR)(e)&&u);let m;return m=o.isMobile?{menuType:U.og.Modal,title:this.renderMobileMenuTitle(),left:this.renderMobileMoreActions(),right:l()(he.DoneMenuText,{}),onClickRight:this.props.onClose,header:h}:{menuType:U.og.Popup,maxHeight:Ee,width:260,header:h,disableHeaderBorder:!0,tokenInputHeader:!0},d.createElement(ce.Z,m,(0,g.vR)(e)&&d.createElement(d.Fragment,null,0===c.length&&l()(fe.Z,{},void 0,l()(ue.Z,{title:l()(B.FormattedMessage,{defaultMessage:"No results",id:"database.filterValue.selectType.noResults.message"})})),c.length>0&&l()(pe.Z,{type:pe.i.Vertical,initialFocus:0,sections:[{key:"select",render:e=>d.createElement(fe.Z,e),items:c}],store:this.stores.menuListStore,onAccept:()=>{this.updateInputValue("")}})))}renderStatusMenu(e){const{device:t}=this.environment,o=this.getFilterAppliedPropertySchema();if(!o||"status"!==o.type)return;const r=l()(fe.Z,{desktopStyle:{paddingBottom:0}},void 0,!t.isMobile&&this.renderDesktopTopActions());let i;i=t.isMobile?{menuType:U.og.Modal,title:this.renderMobileMenuTitle(),left:this.renderMobileMoreActions(),right:l()(he.DoneMenuText,{}),onClickRight:this.props.onClose,header:r}:{menuType:U.og.Popup,maxHeight:Ee,width:260,header:r,disableHeaderBorder:!0,tokenInputHeader:!0};const a=De({propertySchema:o,statusFilterValues:(0,g.vR)(e)?(0,g.wB)(e):[],updateValue:e=>{this.updateValue(e)},isMobile:t.isMobile,styles:{checkboxIcon:{fill:this.theme.regularIconColor}}}),s=l()(pe.Z,{type:pe.i.Vertical,initialFocus:0,sections:[{key:"groups",items:a,render:e=>d.createElement(fe.Z,n()({},e,{title:"",style:{paddingTop:0}}))}]}),c=l()(fe.Z,{topBorder:!0},void 0,l()(re.Z,{title:l()(B.FormattedMessage,{defaultMessage:"Clear selection",id:"database.filterValue.selectType.clearSelection.message"}),focused:!1,onClick:()=>{this.updateValue([])}}));return d.createElement(ce.Z,i,(0,g.vR)(e)&&d.createElement(d.Fragment,null,s,c))}renderPersonRequest(e){const t=this.stores.query.state;return l()(ve.Z,{request:t,performRequest:this.getPersonAutocompleteResults,render:(t,o)=>this.renderPersonMenu(e,t,o)})}renderPersonMenu(e,t,o){const{intl:r}=this.props,{device:i}=this.environment,a=this.stores.query.state,c=this.getFilterAppliedPropertySchema();if(!c)return;const p=(0,g.vR)(e)?(0,g.R8)(e):[],u=s().compact(p.map((e=>{if("exact"===e.type&&e.value){const t=(0,m.Hl)({pointer:e.value,getRecordValue:this.props.parentStore.getRecordValue});return l()(Me.ZP,{actor:t,format:i.isMobile?Me.ZP.Format.Large:Me.ZP.Format.Small,showRemoveButton:!0,onClickRemove:()=>{const t=s().without(p,e);this.updateValue(t)},shouldShrink:!0,isSingle:!1},e.value.id)}if("relative"===e.type&&"me"===e.value&&this.props.allowRelativePersonFilter)return l()(Ie.Z,{format:i.isMobile?y.l.Large:y.l.Small,value:this.renderMeMessage(),onClickRemove:()=>{const t=s().without(p,e);this.updateValue(t)},showRemoveButton:!0,isSingle:!1,shouldShrink:!0,backgroundColor:"transparent",showFullValueTooltip:!0})}))),h=l()(Re.Z,{focus:!i.isMobile||void 0,focusAfterAnimation:!0,format:Re.Z.Format.FilterValue,tokens:u,placeholder:r.formatMessage({defaultMessage:"Search for one or more people…",id:"database.filterValue.personType.searchPlaceholder"}),onRemoveLastToken:()=>{const e=p.slice(0,p.length-1);this.updateValue(e)},onClearButtonClick:()=>{var e,t;this.updateValue([]),null===(e=(t=this.props).onClose)||void 0===e||e.call(t)},value:this.stores.query.state,onChange:e=>{this.updateInputValue(e.target.value)},dontShowBorderBottom:i.isAndroid,showClearButton:!0,style:{maxHeight:"20vh",overflowY:"auto"}}),v=l()(fe.Z,{desktopStyle:{paddingBottom:0}},void 0,!i.isMobile&&this.renderDesktopTopActions(),(0,g.vR)(e)&&h);let f;f=i.isMobile?{menuType:U.og.Modal,title:this.renderMobileMenuTitle(),left:this.renderMobileMoreActions(),right:l()(he.DoneMenuText,{}),onClickRight:this.props.onClose,header:v}:{menuType:U.og.Popup,maxHeight:Ee,width:260,header:v,disableHeaderBorder:!0};const S=s().compact((o&&o.users||[]).map((e=>this.renderUserMenuItem(e,p)))),M=["created_by","last_edited_by"].includes(c.type)?s().compact((o&&o.bots||[]).map((e=>this.renderBotMenuItem(e,p)))):[];if(this.props.allowRelativePersonFilter&&o&&(!a||"me".includes(a))){const e=Boolean(p.find((e=>"relative"===e.type&&"me"===e.value)));S.unshift({key:"me",render:t=>d.createElement(re.Z,n()({},t,{title:this.renderMeMessage(),checkState:e,style:i.isMobile?void 0:{fontSize:14}})),action:()=>{const t=e?p.filter((e=>{let{value:t}=e;return"me"!==t})):[...p,{type:"relative",value:"me"}];this.updateValue(t)}})}const b=[];return S.length>0&&b.push({key:"user property",render:e=>d.createElement(fe.Z,n()({desktopStyle:{paddingTop:0}},e)),items:S}),M.length>0&&b.push({key:"bot property",render:e=>d.createElement(fe.Z,n()({},e,{title:"Pick a bot"})),items:M}),d.createElement(ce.Z,f,(0,g.vR)(e)&&d.createElement(d.Fragment,null,t&&l()(fe.Z,{},void 0,l()(ue.Z,{title:l()(B.FormattedMessage,{defaultMessage:"Something went wrong.",id:"database.filterValue.personType.searchPersonPropertyMenuItem.errorMessage"})})),0===b.length&&o&&!t&&l()(fe.Z,{},void 0,l()(ue.Z,{title:l()(B.FormattedMessage,{defaultMessage:"No results",id:"database.filterValue.personType.noResults.message"})})),!o&&!t&&l()(fe.Z,{},void 0,l()(Fe.Z,{})),b.length>0&&l()(pe.Z,{type:pe.i.Vertical,initialFocus:0,sections:b,store:this.stores.menuListStore,onAccept:()=>{this.updateInputValue("")}})))}renderCheckboxMenu(e){var t;const{device:o}=this.environment,{context:r}=this.props;let i;i=o.isMobile?{menuType:U.og.Modal,title:this.renderMobileMenuTitle(),left:this.renderMobileMoreActions(),right:l()(he.DoneMenuText,{}),onClickRight:this.props.onClose}:{menuType:U.og.Popup,maxHeight:Ee,width:220,footer:this.renderClearSection(e)};const a=null===(t=e.value)||void 0===t?void 0:t.value;return d.createElement(ce.Z,i,r===Ve.PropertyFilter&&l()(fe.Z,{},void 0,!o.isMobile&&this.renderDesktopTopActions()),l()(pe.Z,{type:pe.i.Vertical,initialFocus:0,sections:[{key:"select",render:e=>d.createElement(fe.Z,n()({style:r===Ve.PropertyFilter?{paddingTop:0}:void 0},e)),items:[{key:"unchecked",render:e=>d.createElement(re.Z,n()({},e,{title:l()(B.FormattedMessage,{defaultMessage:"Unchecked",id:"database.filterValue.checkboxType.unchecked.title"}),isTokenTitle:!0,checkState:!1===a})),action:()=>{this.updateValue({type:"exact",value:!1})}},{key:"checked",render:e=>d.createElement(re.Z,n()({},e,{title:l()(B.FormattedMessage,{defaultMessage:"Checked",id:"database.filterValue.checkboxType.checked.title"}),isTokenTitle:!0,checkState:!0===a})),action:()=>{this.updateValue({type:"exact",value:!0})}}]}],store:this.stores.menuListStore,onAccept:this.props.onClose}),o.isMobile&&this.renderClearSection(e))}renderRelationRequest(e){const t=this.stores.query.state,{currentSpaceStore:o}=$.default.state,r=this.getFilterAppliedPropertySchema();if(!r||!(0,v.p_)(r)||!o)return;const n=o.id,i=(0,v.F0)(r);return i?l()(ve.Z,{request:{query:t,spaceId:n,collectionId:i},performRequest:this.getRelationAutocompleteResults,render:(t,o)=>this.renderRelationMenu(e,t,o)}):void 0}renderRelationMenu(e,t,o){const{intl:r}=this.props,{device:i}=this.environment,a=this.stores.query.state,c=this.getFilterAppliedPropertySchema();if(!c||!(0,v.p_)(c))return;const p=(0,v.F0)(c);if(!p)return;const u=(0,g.vR)(e)?(0,g.YO)(e):[],h=s().compact(u.map((e=>{if(!e.value)return;const t={format:i.isMobile?y.l.Large:y.l.Small,shouldWrap:!1,showRemoveButton:!0,isSingle:!1,shouldShrink:!0,onClickRemove:()=>{const t=s().without(u,e);this.updateValue(t)}},o=e.type;if("exact"===o)return d.createElement(Ze.Z,n()({key:e.value,blockId:e.value,parentStore:this.props.parentStore},t));if("relative"===o){var r;const{appConfigUri:o}=this.getRelatedCollectionPartial.state;if(!o)return;return d.createElement(Ie.Z,n()({value:null===(r=F.qB[o])||void 0===r||null===(r=r[e.value.variable])||void 0===r?void 0:r.formattedMessage,backgroundColor:"transparent",showFullValueTooltip:!0},t))}(0,E.t1)(o)}))),m=l()(Re.Z,{focus:!i.isMobile||void 0,focusAfterAnimation:!0,format:Re.Z.Format.FilterValue,tokens:h,placeholder:r.formatMessage({defaultMessage:"Search for one or more pages…",id:"database.filterValue.relationType.searchPlaceholder"}),onRemoveLastToken:()=>{const e=u.slice(0,u.length-1);this.updateValue(e)},onClearButtonClick:()=>{var e,t;this.updateValue([]),null===(e=(t=this.props).onClose)||void 0===e||e.call(t)},value:this.stores.query.state,onChange:e=>{this.updateInputValue(e.target.value)},dontShowBorderBottom:i.isAndroid,style:{maxHeight:"20vh",overflowY:"auto"},showClearButton:!0}),f=l()(fe.Z,{desktopStyle:{paddingBottom:0}},void 0,!i.isMobile&&this.renderDesktopTopActions(),(0,g.vR)(e)&&m);let S;S=i.isMobile?{menuType:U.og.Modal,title:this.renderMobileMenuTitle(),left:this.renderMobileMoreActions(),right:l()(he.DoneMenuText,{}),onClickRight:this.props.onClose,header:f}:{menuType:U.og.Popup,maxHeight:Ee,width:260,header:f,disableHeaderBorder:!0};const M=this.getTemplatePageStore();o&&!a&&M&&p&&M.getParentCollectionId()===p&&(o=s().uniq([M.id,...o]));let b=[];if(o){const e=this.getExactRelationMenuItems(o,u);b=((0,g.a_)(this.props.propertyFilter.filter)?[]:this.getRelativeRelationMenuItems(a,u)).concat(e)}return d.createElement(ce.Z,S,(0,g.vR)(e)&&d.createElement(d.Fragment,null,t&&l()(fe.Z,{},void 0,l()(ue.Z,{title:l()(B.FormattedMessage,{defaultMessage:"Something went wrong.",id:"database.filterValue.relationType.searchRelationPropertyMenuItem.errorMessage"})})),0===b.length&&o&&!t&&l()(fe.Z,{},void 0,l()(ue.Z,{title:l()(B.FormattedMessage,{defaultMessage:"No results",id:"database.filterValue.relationType.noResults.message"})})),!o&&!t&&l()(fe.Z,{},void 0,l()(Fe.Z,{})),b.length>0&&l()(pe.Z,{type:pe.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>d.createElement(fe.Z,e),items:b}],store:this.stores.menuListStore,onAccept:()=>{this.updateInputValue("")}})))}renderDateMenu(e){const{context:t}=this.props,{device:o}=this.environment;let r;return r=o.isMobile?{menuType:U.og.Modal,title:this.renderMobileMenuTitle(),left:this.renderMobileMoreActions(),right:l()(he.DoneMenuText,{}),onClickRight:this.props.onClose}:{menuType:U.og.Popup,maxHeight:Ee},d.createElement(ce.Z,r,t===Ve.PropertyFilter&&!o.isMobile&&l()(fe.Z,{desktopStyle:{paddingBottom:0}},void 0,this.renderDesktopTopActions()),(0,g.vR)(e)?(0,g.TQ)(e)?this.renderDateRangePicker(e):this.renderDatePicker(e):void 0)}renderDateRangePicker(e){const t=this.getFilterAppliedPropertySchema();if(!t)return;let o;if((0,g.TQ)(e)&&"exact"===e.value.type&&e.value.value){const t=e.value.value;o={starting:t.start_date?{type:"date",start_date:t.start_date}:void 0,ending:t.end_date?{type:"date",start_date:t.end_date}:void 0}}else o=(0,g.TQ)(e)&&"relative"===e.value.type?e.value:{starting:void 0,ending:void 0};const r={disableMenuWrap:!0,title:t.name,value:o,onUpdate:e=>{var t,r;if(e.error)return;const n={...o,...e.value},i=null===(t=n.starting)||void 0===t?void 0:t.start_date,l=null===(r=n.ending)||void 0===r?void 0:r.start_date,a={operator:"date_is_within",value:{type:"exact",value:i||l?{type:"daterange",start_date:i,end_date:l}:void 0}};this.updateFilter(a)},allowRelativeRangeFilter:this.props.allowRelativeDateFilter,relativeRangePopupStore:this.stores.dateRangeFilterPopupStore,onUpdateRelativeFilter:t=>{const o={...e,value:t};this.updateFilter(o)}};return d.createElement(d.Fragment,null,l()(fe.Z,{},void 0,d.createElement(ke.Z,r)))}renderDateInput(e,t){return d.createElement(Ce.Z,n()({},t,{placeholder:N.default.formatMessage(Pe.startingMessage),focused:"exact"===e.value.type,value:e.value,onUpdate:t=>{var o;if(t.error)return;const r=null===(o=t.value)||void 0===o?void 0:o.start_date,n={...e,value:{type:"exact",value:r?{type:"date",start_date:r}:void 0}};this.updateFilter(n)},inputRight:this.props.allowRelativeDateFilter&&l()(le.Z,{icon:x.Z.chevronDown,iconStyle:{width:12},style:{...!this.environment.device.isMobile&&{height:20,width:20},color:this.theme.mediumIconColor},onClick:()=>{this.stores.dateFilterPopupStore.setState({open:!0})}}),hideClearButton:"relative"===e.value.type||void 0,isRightLastElementOfInput:!0}))}renderDatePicker(e){if(!(0,g.vR)(e))return;const t="exact"===e.value.type?e.value.value:(0,b.Id)(e.value);return!t||(0,M.J_)(t)?d.createElement(d.Fragment,null,l()(fe.Z,{},void 0,l()(we.Z,{type:"date",filterValue:e.value,onUpdate:t=>{const o={...e,value:t};this.updateFilter(o)},renderOrigin:t=>this.renderDateInput(e,t),disabled:"exact"===e.value.type&&this.props.allowRelativeDateFilter,buttonPopupStore:this.stores.dateFilterPopupStore})),l()(fe.Z,{style:{padding:"0px 14px 14px 14px"}},void 0,l()(xe.Z,{firstDayOfWeek:D.AK.state,value:t?b.OQ.notionDateToLuxon(t).toMillis():Date.now(),onChange:e=>{const t=(0,b.hT)(e,(0,w.r)());this.updateValue({type:"exact",value:t})}}),"relative"===e.value.type&&l()(be.Z,{isSmall:!0,style:{marginLeft:4,marginTop:4}},void 0,l()(B.FormattedMessage,{id:"collectionFilterMenu.dateFilter.relativeDateFilter.description",defaultMessage:"Filter will update with the current date"})))):void 0}renderVerificationMenu(e){const{device:t}=this.environment,{context:o}=this.props,r=(0,g.vR)(e)?(0,g.fl)(e):[],i=r.map((e=>{let{value:t}=e;return t})),a=_.zz.map((e=>{const t=i.includes(e);return{key:e,render:o=>d.createElement(re.Z,n()({icon:l()(ie.Z,{checked:t,size:14,style:{fill:this.theme.regularIconColor,pointerEvents:"none"}}),title:(0,W.cq)({type:"exact",value:e})},o)),action:()=>{if(t)this.updateValue(r.filter((t=>{let{value:o}=t;return o!==e})));else{const t={type:"exact",value:e};this.updateValue([...r,t])}}}}));let s;return s=t.isMobile?{menuType:U.og.Modal,title:this.renderMobileMenuTitle(),left:this.renderMobileMoreActions(),right:l()(he.DoneMenuText,{}),onClickRight:this.props.onClose}:{menuType:U.og.Popup,maxHeight:Ee,width:220,footer:this.renderClearSection(e)},d.createElement(ce.Z,s,o===Ve.PropertyFilter&&l()(fe.Z,{},void 0,!t.isMobile&&this.renderDesktopTopActions()),l()(pe.Z,{type:pe.i.Vertical,initialFocus:0,sections:[{key:"select",render:e=>d.createElement(fe.Z,e),items:a}],store:this.stores.menuListStore}))}renderNumberOperator(e){return l()("span",{style:{color:this.theme.lightTextColor}},void 0,(0,W.WC)(e.operator).toLocaleLowerCase())}renderMeMessage(){return l()(B.FormattedMessage,{defaultMessage:"Me",id:"database.filterValue.personType.firstPersonPropertyValue.title"})}renderClearSection(e){if(!(0,g.yI)(e.value))return l()(fe.Z,{topBorder:!0},void 0,l()(re.Z,{focused:!1,title:l()(B.FormattedMessage,{defaultMessage:"Clear",id:"database.filterValue.clear.message"}),onClick:()=>{var e,t;this.updateValue({type:"exact",value:void 0}),null===(e=(t=this.props).onClose)||void 0===e||e.call(t)}}))}renderDesktopTopActions(){const e=this.props,{propertyFilter:t,schema:o,context:r}=e;if(r!==Ve.PropertyFilter)return;const{property:n}=t,i=o[n];return i?l()("div",{style:{display:"flex",color:this.theme.lightTextColor,fontSize:12,marginBottom:6}},void 0,l()("span",{style:{flexShrink:1,marginLeft:8,...A.Z.textOverflowStyle}},void 0,this.renderPropertyName(i)),(0,g.a_)(t.filter)&&this.renderRollupOperatorSelect(),this.renderOperatorSelect(),l()("div",{style:{flexGrow:1}}),this.renderMoreActions()):void 0}renderPropertyName(e){return"date"===e.type?this.renderDateFilterModeSelect(e):e.name}renderDateFilterModeSelect(e){const{propertyFilter:t}=this.props,{device:o}=this.environment,r=t.filter;if(!(0,g.vR)(r)||!(0,g.gE)(r))return e.name;const i={width:190,items:g.T,selectedItem:(0,g.TX)(r),getKey:e=>e,onSelect:e=>{const t={...r,use_end:(0,g.UG)(e)};this.updateFilter(t)},renderItem:e=>l()(Se.Z,{renderTooltip:()=>(0,W._T)(e.value),render:t=>d.createElement(re.Z,n()({title:(0,W.IF)(e.value)},(0,H.Z)(e,t))),placement:Se.Z.Placement.Right,textWrap:!0,style:{width:"260px"}}),renderOrigin:e=>d.createElement(oe.Z,n()({},e,{style:{marginRight:4,marginLeft:2,paddingLeft:2,paddingRight:2,borderRadius:3,flexShrink:0}}),l()("div",{style:{display:"flex",alignItems:"center",...!o.isMobile&&{color:this.theme.mediumTextColor,fill:this.theme.lightIconColor,fontWeight:500,fontSize:12}}},void 0,l()("span",{style:{marginRight:4}},void 0,(0,W.IF)((0,g.TX)(r))),l()(_e,{})))};return d.createElement(ye.Z,n()({},i,{mobileActionSheet:!0}))}renderMobileMenuTitle(){const{propertyFilter:e,schema:t,context:o}=this.props,{property:r}=e,n=t[r];if(n)return o===Ve.PropertyFilter?l()("div",{style:{display:"flex"}},void 0,l()("span",{style:{fontWeight:A.Z.fontWeight.medium,flexShrink:1,marginLeft:8,maxWidth:150,...A.Z.textOverflowStyle}},void 0,this.renderPropertyName(n)),(0,g.a_)(e.filter)&&this.renderRollupOperatorSelect(),this.renderOperatorSelect()):n.name}renderMobileMoreActions(){const{context:e}=this.props;if(e===Ve.PropertyFilter)return this.renderMoreActions()}renderRollupOperatorSelect(){const{propertyFilter:e,intl:t,onChange:o}=this.props,{filter:r}=e,{device:i}=this.environment;if(!(0,g.a_)(r))return;const a={width:190,items:g.Rf,getKey:e=>e,selectedItem:r.operator,onSelect:e=>{null==o||o({...r,operator:e})},renderItem:e=>d.createElement(re.Z,n()({title:(0,W.SW)(e.value,t)},e)),renderOrigin:e=>d.createElement(oe.Z,n()({},e,{style:{marginRight:4,marginLeft:2,paddingLeft:2,paddingRight:2,borderRadius:3,flexShrink:0}}),l()("div",{style:{display:"flex",alignItems:"center",...!i.isMobile&&{color:this.theme.lightTextColor,fontSize:12}}},void 0,l()("span",{style:{marginRight:4}},void 0,(0,W.SW)(r.operator,t).toLocaleLowerCase()),l()(_e,{})))};return d.createElement(ye.Z,n()({},a,{mobileActionSheet:!0}))}renderOperatorSelect(){const{propertyFilter:e,schema:t,parentStore:o}=this.props,{property:r}=e,{device:i}=this.environment,a=(0,g.a_)(e.filter)?e.filter.subfilter:e.filter;if((0,g.a_)(a))return;const s=(0,g.fI)({schema:t,property:r,getRecordValue:o.getRecordValue});let c=(0,g.xm)(s);"status"===s&&(c=c.filter((e=>!(0,g._N)(e))));const p={width:190,items:c,selectedItem:a.operator,getKey:e=>e,onSelect:e=>{const t=(0,W.li)(s,a,e,"propertyFilter");this.updateFilter(t)},renderItem:e=>d.createElement(re.Z,n()({title:(0,W.WC)(e.value)},e)),renderOrigin:e=>d.createElement(oe.Z,n()({},e,{style:{marginRight:4,marginLeft:2,paddingLeft:2,paddingRight:2,borderRadius:3,flexShrink:0}}),l()("div",{style:{display:"flex",alignItems:"center",...!i.isMobile&&{color:this.theme.mediumTextColor,fill:this.theme.lightIconColor,fontWeight:500,fontSize:12}}},void 0,l()("span",{style:{marginRight:4}},void 0,(0,W.WC)(a.operator).toLocaleLowerCase()),l()(_e,{})))};return d.createElement(ye.Z,n()({},p,{mobileActionSheet:!0}))}renderMoreActions(){const{device:e}=this.environment;return l()(ne.ZP,{popupType:this.environment.device.isMobile?me.kQ.SlideUp:me.kQ.Popup,render:this.renderMoreActionsPopup,renderOrigin:t=>d.createElement(le.Z,n()({icon:x.Z.dots,style:{...!e.isMobile&&{height:20,width:20,marginRight:8,marginTop:-2}}},t)),style:{width:240},originGap:2,placementToOrigin:ne.pO.Right,alignmentToOrigin:ne.vR.Start})}renderRemoveMenuItem(e){return l()(re.Z,{focused:!1,title:l()(B.FormattedMessage,{defaultMessage:"Remove filter",id:"database.filterValue.removeFilter.message"}),onClick:()=>{e()}})}getTemplatePageStore(){const{collectionViewId:e}=this.props;if(!e)return;const t=J.Xr.createChildStore(this.props.parentStore,{table:I.n,id:e}).getParentBlockStore();if(!t)return;const o=(0,K.Dg)(t,1);return o&&o.isTemplate()?o:void 0}getExactRelationMenuItems(e,t){return e.map((e=>{const o={type:"exact",value:e},r=this.getCheckedState(t,o),i=J.G.createChildStore(this.props.parentStore,{table:Z.iU,id:e});return{key:e,action:this.getMenuListItemAction(r,t,o),render:e=>d.createElement(ge.Z,n()({store:i,checkState:r,hidePath:!0},e))}}))}getRelativeRelationMenuItems(e,t){const{appConfigUri:o,schema:r}=this.getRelatedCollectionPartial.state;if(!o||!(0,G.Sh)(r,o))return[];const i=F.qB[o],l=Object.keys(i);return s().compact(l.map((o=>{if(!e||o.includes(e)){const e={type:"relative",value:{type:"builtin",variable:o}},r=this.getCheckedState(t,e);return{key:o,render:e=>d.createElement(re.Z,n()({},e,{title:i[o].formattedMessage,checkState:r})),action:this.getMenuListItemAction(r,t,e)}}})))}updateValue(e){const{onChange:t,propertyFilter:o}=this.props,{filter:r}=o;(0,g.a_)(r)?null==t||t({...r,subfilter:{...r.subfilter,value:this.normalizeValue(e)}}):null==t||t({...r,value:this.normalizeValue(e)})}updateFilter(e){const{onChange:t,propertyFilter:o}=this.props,{filter:r}=o;(0,g.a_)(r)?null==t||t({...r,subfilter:e}):null==t||t(e)}getFilterAppliedPropertySchema(){const{schema:e,propertyFilter:t,parentStore:o}=this.props,{property:r}=t,n=e[r];if(!(n&&"rollup"===n.type&&n.relation_property&&n.target_property))return n;{const t=e[n.relation_property];if(t&&(0,v.p_)(t)){const e=(0,v.j0)(t);if(e){const t=o.getRecordModel(e);if(!t)return;const r=t.getNormalizedSchema();if(r){const e=r[n.target_property];if(e&&"rollup"!==e.type)return e}}}}}normalizeValue(e){return s().isArray(e)?0===e.length?{type:"exact",value:void 0}:1===e.length?e[0]:e:e}updateInputValue(e){this.stores.query.setState(e),this.stores.menuListStore.setState({focus:{section:0,indexLocal:0,indexGlobal:0}})}getCheckedState(e,t){return Boolean(e.find((e=>s().isEqual(e,t))))}getMenuListItemAction(e,t,o){return()=>{const r=e?t.filter((e=>!s().isEqual(e,o))):[...t,o];this.updateValue(r)}}}function _e(){window.__c={n:"OperatorChevron"};const{device:e}=(0,p.O7)();return x.Z.chevronDown({width:10,height:10,...e.isMobile&&{marginTop:2}})}function Be(e){window.__c={n:"LocationFilterValueMenu"};const{filter:t,parentStore:o,updateValue:r,onClose:i,desktopTopActions:a,mobileMenuTitle:c,mobileMoreActions:h}=e,m=(0,p.O7)(),v=(0,d.useMemo)((()=>(0,g.vR)(t)?(0,g.u0)(t):[]),[t]),f=(0,p.Fy)(),M=(0,u.VK)((()=>s().compact(v.map((e=>{if(!e.value)return;const t=J.NW.createChildStore(o,{table:"collection",id:e.value});return l()(Ie.Z,{format:f.isMobile?y.l.Large:y.l.Small,value:l()(X.Z,{collectionStore:t}),onClickRemove:()=>{const t=s().without(v,e);r(t)},showRemoveButton:!0,isSingle:!1,shouldShrink:!0,backgroundColor:"transparent",showFullValueTooltip:!0},e.value)})))),[v,f.isMobile,o,r]),[b,w]=(0,d.useState)(""),x=(0,B.useIntl)(),k=(0,u.VK)((()=>{var e;return null===(e=$.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),{status:F,typedCollections:Z}=function(e){const{spaceId:t,environment:o,parentStore:r,databaseType:n}=e,[{value:i,status:l}]=(0,q.r5)((async()=>Q.rG({environment:o,spaceId:t,databaseType:n,parentStore:r})),[t,n,o,r]);return{status:l,typedCollections:i}}({spaceId:k,environment:m,databaseType:S.iS,parentStore:o}),T=(0,u.qz)(void 0,j.Z),I=(0,d.useCallback)(((e,t)=>{const o=Boolean(t.find((t=>"exact"===t.type&&t.value===e.id)));return{key:e.id,render:t=>d.createElement(re.Z,n()({},t,{title:l()(X.Z,{collectionStore:e}),isTokenTitle:!0,checkState:o})),action:()=>{const o=s().xorBy(t,[{type:"exact",value:e.id}],(e=>e.value));r(o)}}}),[r]),V=(0,u.VK)((()=>{const e=[],t=(0,C.ZP)(b,Z||[],(e=>P.Q(e.getName()??[]))),r={},i=[];for(const o of t){const e=K.VP(o);e?r[e.id]=[...r[e.id]??[],o]:i.push(o)}for(const[l,a]of Object.entries(r)){const t=J.zX.createChildStore(o,{table:R.e0,id:l});e.push({key:l,items:a.map((e=>I(e,v))),render:e=>d.createElement(fe.Z,n()({topBorder:!0},e,{title:d.createElement(d.Fragment,null,t.getName()??"")}))})}return e.push({key:"private",items:i.map((e=>I(e,v))),render:e=>d.createElement(fe.Z,n()({topBorder:!0},e,{title:l()(B.FormattedMessage,{id:"collectionFilterValueMenu.privateLocationSection",defaultMessage:"Private"})}))}),e}),[v,o,b,I,Z]),E=l()(Re.Z,{focus:!f.isMobile||void 0,focusAfterAnimation:!0,format:Re.Z.Format.FilterValue,tokens:M,placeholder:x.formatMessage({defaultMessage:"Search for one or more locations",id:"database.filterValue.locationType.searchPlaceholder"}),onRemoveLastToken:()=>{const e=v.slice(0,v.length-1);r(e)},onClearButtonClick:()=>{r([]),null==i||i()},value:b,onChange:e=>{w(e.target.value)},dontShowBorderBottom:f.isAndroid,showClearButton:!0,style:{maxHeight:"20vh",overflowY:"auto"}}),A=l()(fe.Z,{desktopStyle:{paddingBottom:0}},void 0,!f.isMobile&&a,E);let _;return _=f.isMobile?{menuType:U.og.Modal,title:c,left:h,right:l()(he.DoneMenuText,{}),onClickRight:i,header:A}:{menuType:U.og.Popup,maxHeight:Ee,width:260,header:A,disableHeaderBorder:!0},d.createElement(ce.Z,_,(0,g.vR)(t)&&d.createElement(d.Fragment,null,("pending"===F||"idle"===F)&&l()(fe.Z,{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"8px 0px"}},void 0,l()(de.Z,{})),"rejected"===F&&l()(fe.Z,{},void 0,l()(ue.Z,{title:l()(B.FormattedMessage,{defaultMessage:"Something went wrong.",id:"database.filterValue.personType.searchPersonPropertyMenuItem.errorMessage"})})),"resolved"===F&&d.createElement(d.Fragment,null,0===(null==Z?void 0:Z.length)&&l()(fe.Z,{},void 0,l()(ue.Z,{title:l()(B.FormattedMessage,{defaultMessage:"No results",id:"database.filterValue.selectType.noResults.message"})})),Z&&Z.length>0&&l()(pe.Z,{type:pe.i.Vertical,initialFocus:0,sections:V,store:T,onAccept:()=>{w("")}}))))}Ae.displayName="CollectionFilterValueMenu";const Oe=(0,B.injectIntl)(Ae);function De(e){const{propertySchema:t,statusFilterValues:o,updateValue:r,isMobile:i,styles:a}=e,s=t.groups??[],c=t.options??[],p=[];for(const u of s){const e=()=>{const e=(0,L.CN)(s,c,o,{type:"is_group",value:u.name});e&&r(e)},t=o.some((e=>"is_group"===e.type&&e.value===u.name)),h=c.filter((e=>{var t;return null===(t=u.optionIds)||void 0===t?void 0:t.includes(e.id)}));let m=!1,g=!0;const v=[];for(const p of h){const e=()=>{const e=(0,L.CN)(s,c,o,{type:"is_option",value:p.value});e&&r(e)},h=o.some((e=>"is_option"===e.type&&e.value===p.value));m||=h,g&&=h,v.push({key:`option-${p.id}`,action:e,render:o=>d.createElement(re.Z,n()({},o,{icon:l()(ie.Z,{checked:t||h,size:14,onClick:e,style:a.checkboxIcon}),title:l()(Te.F,{format:i?y.l.Large:y.l.Medium,isSingle:!0,value:p.value,color:p.color,showRemoveButton:!1,groupColor:u.color}),style:{paddingLeft:12}}))})}p.push({key:`group-${u.id}`,action:e,render:o=>d.createElement(re.Z,n()({},o,{icon:l()(ie.Z,{checked:!(!t&&!g)||!!m&&"partial",size:14,onClick:e,style:a.checkboxIcon}),title:l()(te.r_,{group:u})}))},...v)}return p}function Le(e){const{query:t,propertySchema:o,selectedValues:r,updateValue:i,isMobile:a,styles:s}=e,c=o.options||[];return(t?(0,C.ZP)(t,c,(e=>e.value)):c).map((e=>{const t=Boolean(r.find((t=>t.value===e.value)));return{key:e.value,render:o=>d.createElement(re.Z,n()({icon:l()(ie.Z,{onClick:o.onClick,checked:t,size:14,style:s.checkboxIcon}),title:l()(Te.a,{format:a?y.l.Large:y.l.Medium,isSingle:!0,value:e.value,color:e.color,showRemoveButton:!1}),isTokenTitle:!0},o)),action:()=>{const o=t?r.filter((t=>{let{value:o}=t;return o!==e.value})):[...r,{type:"exact",value:e.value}];i(o)}}}))}},68834:(e,t,o)=>{o.d(t,{Z:()=>s});var r=o(23174),n=o.n(r),i=(o(67294),o(81954)),l=o(31278),a=o(76798);const s=function(e){window.__c={n:"CollectionLocationToken"};const{collectionStore:t}=e,o=(0,i.VK)((()=>t.getIcon()),[t]);return n()("div",{style:{display:"flex",columnGap:4,alignItems:"center"}},void 0,n()(l.Z,{disabled:!0,icon:o,isEmptyPage:!1,size:20}),n()(a.Z,{store:t,style:{maxWidth:180}}))}},42917:(e,t,o)=>{o.d(t,{Z:()=>c});var r=o(67294),n=o(480),i=o(24405),l=o(8848),a=o(53397),s=o(25130),d=o(52275);const c=function(e){window.__c={n:"CollectionSettingsMenuItem"};const{icon:t,iconStyle:o,title:c,caption:p,right:u,rightStyle:h,isRed:m,isGray:g,isOrange:v,isPadded:f,onClick:y,onMouseDown:S,onMouseEnter:M,onMouseLeave:b,disabled:C,showChevron:w,chevronStyle:x,rotateChevron:k,showDragHandle:F,focused:Z,textWrapperStyle:T,shouldWrapCaption:I,desktopIconStyle:R}=e,V=(0,n.O7)(),{isMobile:P}=V.device,E=(0,i.yK)((e=>({style:{color:g?e.mediumTextColor:v?"dark"===e.mode?e.accentColors.orange[500]:e.accentColors.orange[400]:e.regularTextColor,fill:g?e.mediumIconColor:v?"dark"===e.mode?e.accentColors.orange[500]:e.accentColors.orange[400]:e.regularIconColor,opacity:C?.4:void 0},redHoveredStyle:{color:l.ZP.red,fill:l.ZP.red},leftIconStyle:{width:24,height:f?24:P?18:16,marginRight:-2,...t===a.Z.dots&&{height:3},...o},rightStyle:{display:"flex",alignItems:"center",color:C?e.regularTextColor:e.lightTextColor,fill:C?e.regularIconColor:e.lightIconColor,flexShrink:0,...h},rightIconStyle:{width:12,fill:e.lightIconColor,marginLeft:6,transition:"transform 200ms ease-in-out",...x},rightIconRotatedStyle:{transform:"rotate(90deg)"}})),[g,v,C,o,f,P,t,x,h]),[A,_]=(0,s.o$)(),B=(0,s.nq)(_);return r.createElement(d.Z,{ref:A,icon:null==t?void 0:t(E.leftIconStyle),focused:Z||!1,disabled:C,title:c,caption:p,shouldWrapCaption:I,desktopTitleStyle:{flexGrow:1,flexShrink:1},showDragHandle:F,buttonStyle:E.style,rightStyle:E.rightStyle,hoveredStyle:m?E.redHoveredStyle:void 0,ignoreLocalHoverState:!!C||void 0,right:r.createElement(r.Fragment,null,u,!C&&w&&a.Z.chevronRight({...E.rightIconStyle,...k&&E.rightIconRotatedStyle})),onClick:y,onMouseDown:S,onMouseEnter:M,onMouseLeave:b,textWrapperStyle:T,desktopIconStyle:R,disallowTabbing:!B})}},13709:(e,t,o)=>{o.d(t,{Z:()=>w});var r=o(23174),n=o.n(r),i=o(10434),l=o.n(i),a=o(96486),s=o.n(a),d=o(67294),c=o(480),p=o(81954),u=o(65917),h=o(2911),m=o(87279),g=o(61766),v=o(42917),f=o(52275),y=o(31945),S=o(78140),M=o(32163),b=o(44532),C=o(72495);const w=function(e){let{icon:t,title:o,selectedKey:r,options:i,onChange:a,onClick:w,popupStyle:x,menuItemOptionsStyle:k,disabled:F,collectionContextStore:Z,openButtonPopup:T}=e;window.__c={n:"CollectionSettingsPickListMenuItem"};const I=(0,c.Fy)(),R=i.find((e=>s().isEqual(e.key,r))),V=(0,p.qz)(void 0,g.Z),P=(0,p.Kw)(V);return(0,d.useEffect)((()=>{Z&&T&&(V.setState({...V.state,open:T}),Z.settingsStore.setState({...Z.settingsStore.state,openButtonPopup:void 0})),R||u.log({level:"error",from:"CollectionSettingsPickListMenuItem",type:"InvalidSelectedItem",error:(0,h.Ui)("Selected key is invalid.")})})),n()(y.ZP,{popupType:I.isMobile?b.kQ.SlideUp:b.kQ.Popup,alignmentToOrigin:y.vR.End,placementToOrigin:y.pO.Bottom,style:x,originGap:0,buttonPopupStore:V,disabled:F,onClick:w,renderOrigin:e=>d.createElement(v.Z,l()({title:o,showChevron:!0,right:null==R?void 0:R.title,rotateChevron:P.open,disabled:F,icon:t},e)),render:e=>{let t;t=I.isMobile?{menuType:m.og.ActionSheet}:{menuType:m.og.Popup,width:250};const o=s().compact(i.map(((t,o)=>({key:o,render:e=>d.createElement(f.Z,l()({},e,{disabled:!1,title:t.title,icon:t.icon,caption:t.caption,body:t.body,style:k,checkState:s().isEqual(t.key,r)})),action:()=>{a(t.key),e.close()}}))));return d.createElement(S.Z,t,n()(M.Z,{type:M.i.Vertical,sections:[{key:0,render:e=>d.createElement(C.Z,l()({enableActionSheetTitle:!0},e)),items:o}],initialFocus:0}))}})}},28398:(e,t,o)=>{o.d(t,{R1:()=>D,ep:()=>W,ZP:()=>G});var r=o(23174),n=o.n(r),i=o(10434),l=o.n(i),a=o(96486),s=o(67294),d=o(83355),c=o(49085),p=o(76205),u=o(53397),h=o(97880),m=o(82990),g=o(5366),v=o(77162),f=o(90985),y=o(5149),S=o(12359),M=o(93959),b=o(97004),C=o(87279),w=o(98742),x=o(61766),k=o(42917),F=o(23063),Z=o(52275),T=o(31945),I=o(73063),R=o(78140),V=o(28992),P=o(32163),E=o(89728),A=o(44532),_=o(72495),B=o(58032),O=o(95691);let D=function(e){return e[e.FilterBar=0]="FilterBar",e[e.SettingsFilters=1]="SettingsFilters",e[e.SettingsSort=2]="SettingsSort",e}({});class L extends d.Z{constructor(){super(...arguments),this.storeTypes={showMore:c.default.createClass(!1),moreActionsButtonPopupStore:x.Z},this.renderSaveActionsPopup=e=>{const{device:t}=this.environment;let o;o=t.isMobile?{menuType:C.og.ActionSheet}:{menuType:C.og.Popup,width:250};const r=a.compact([t.isPhone&&{key:"reset",render:e=>s.createElement(Z.Z,l()({},e,{disabled:!1,title:this.renderResetMessage()})),action:()=>{this.handleReset(e)}},{key:"newView",render:e=>s.createElement(Z.Z,l()({},e,{disabled:!1,title:this.renderSaveAsNewViewMessage()})),action:()=>{this.handleSaveAsNewViewClick(e)}},this.shouldShowMergeIntoAdvancedFilter()&&{key:"merge",render:e=>n()(B.Z,{placement:B.Z.Placement.Left,style:{maxWidth:240,whiteSpace:void 0},renderTooltip:()=>n()("div",{},void 0,n()(W,{})),render:t=>s.createElement(Z.Z,l()({},(0,w.Z)(e,t),{disabled:!1,title:this.renderMergeIntoAdvancedFilterMessage()}))}),action:()=>{this.handleMergeIntoCombinatorFilter(e)}}]);return s.createElement(R.Z,o,n()(P.Z,{type:P.i.Vertical,sections:[{key:0,render:e=>s.createElement(_.Z,l()({enableActionSheetTitle:!0},e)),items:r}],initialFocus:0}))},this.handleSaveInCurrentViewClick=()=>{const{collectionContextStore:e,context:t}=this.props,o=e.collectionViewStore();o&&(v.wd({environment:this.environment,collectionContextStore:e,action:"click_save_control_save_in_current_view"}),S.createAndCommit({userAction:"CollectionSettingsSaveControl.handleSaveInCurrentViewClick",environment:this.environment,perform:r=>{f.Ys({environment:this.environment,type:t===D.FilterBar?f.mO.All:t===D.SettingsFilters?f.mO.Filters:f.mO.Sorts,collectionContextStore:e,targetCollectionView:o,transaction:r})}}),f.RD({environment:this.environment,seen:!0}))},this.handleSaveAsNewViewClick=e=>{const{collectionContextStore:t,intl:o}=this.props;v.wd({environment:this.environment,collectionContextStore:t,action:"click_save_control_save_as_new_view"}),S.createAndCommit({userAction:"CollectionSettingsSaveControl.handleSaveAsNewViewClick",environment:this.environment,perform:e=>{f.k7({environment:this.environment,collectionContextStore:t,transaction:e,intl:o})}}),null==e||e.close()},this.handleMergeIntoCombinatorFilter=e=>{const{collectionContextStore:t,context:o}=this.props,r=(0,b.Pi)(t),n=t.currentPropertyFiltersStore.state.filter((e=>(0,M.EE)(e.id)));f.iU({environment:this.environment,collectionContextStore:t,temporaryState:{...t.temporaryState.state,propertyFilters:{value:n},combinatorFilter:{value:r}}});const i=o===D.FilterBar?t.filterBarCombinatorFilterSettingsState:t.filterOptionsCombinatorFilterSettingsState;y.wl({collectionSettingsStore:i,item:{type:"filter"}}),v.wd({environment:this.environment,collectionContextStore:t,action:"merge_filter_into_combinator"}),null==e||e.close()},this.handleReset=e=>{const{collectionContextStore:t,context:o}=this.props;v.wd({environment:this.environment,collectionContextStore:t,action:"click_save_control_reset"});const r=t.temporaryState.state,n=o===D.SettingsFilters?{...r,propertyFilters:void 0,combinatorFilter:void 0}:o===D.SettingsSort?{...r,sorts:void 0}:void 0;f._x({environment:this.environment,collectionContextStore:t,temporaryState:n}),f.RD({environment:this.environment,seen:!0}),null==e||e.close()},this.handleMoreOptionsClick=()=>{const{collectionContextStore:e}=this.props;v.wd({environment:this.environment,collectionContextStore:e,action:"click_save_control_more_options_button"}),this.stores.showMore.setState(!0)},this.handleSaveActionsPopupClick=()=>{const{collectionContextStore:e}=this.props;v.wd({environment:this.environment,collectionContextStore:e,action:"click_save_control_more_options_popup"}),f.RD({environment:this.environment,seen:!0})},this.changeCount=this.createComputedStore((()=>{const{collectionContextStore:e,context:t}=this.props,o=e.localStateDiffStore.state;return t===D.SettingsFilters?(o.filters.moved.length>0?1:0)+o.filters.added.length+o.filters.removed.length+o.filters.updated.length:0}))}renderComponent(){const{context:e,collectionContextStore:t,showHoverActionsStore:o}=this.props,{showMore:r}=this.stores,{device:i}=this.environment,a=t.permissionScopes.state;if(e===D.FilterBar)return i.isPhone?a.canConfigureBlock?s.createElement(s.Fragment,null,n()(E.Z,{isOrange:!0,hovered:!0,style:{flexGrow:1,justifyContent:"center",height:32,marginRight:8,fontWeight:m.Z.fontWeight.semibold},onClick:this.handleSaveInCurrentViewClick},void 0,this.renderSaveMessage()),n()(T.ZP,{popupType:this.environment.device.isMobile?A.kQ.SlideUp:A.kQ.Popup,render:this.renderSaveActionsPopup,originGap:4,onClick:this.handleSaveActionsPopupClick,buttonPopupStore:this.stores.moreActionsButtonPopupStore,renderOrigin:e=>s.createElement(I.Z,l()({style:{width:32,height:32},iconStyle:{width:16},hovered:!0,icon:u.Z.dots},e))})):s.createElement(s.Fragment,null,n()(E.Z,{style:{flexGrow:1,justifyContent:"center",height:32,marginRight:8,fontWeight:m.Z.fontWeight.semibold},hovered:!0,isGray:!0,onClick:()=>this.handleReset()},void 0,this.renderResetMessage())):n()(F.Z,{isVisible:t.isFullScreen.state||!o||o.state,animationStyle:{opacity:1},enterAnimationStyle:{opacity:0},exitAnimationStyle:{opacity:0},render:()=>n()("div",{style:{display:"flex",alignItems:"center"}},void 0,n()(E.Z,{isGray:!0,onClick:()=>this.handleReset(),style:{lineHeight:1.1,fontSize:i.isMobile?16:14}},void 0,this.renderResetMessage()),a.canConfigureBlock&&n()(T.ZP,{popupType:this.environment.device.isMobile?A.kQ.SlideUp:A.kQ.Popup,render:this.renderSaveActionsPopup,originGap:4,onClick:this.handleSaveActionsPopupClick,buttonPopupStore:this.stores.moreActionsButtonPopupStore,renderOrigin:e=>n()(O.Z,{title:this.renderSaveMessage(),color:"orange",onClick:this.handleSaveInCurrentViewClick,dropdownEvents:e,style:{marginLeft:6,marginRight:i.isMobile?8:void 0,fontSize:i.isMobile?16:14,...i.isMobile?{height:30}:null}})}))});if(e===D.SettingsFilters||e===D.SettingsSort){const t=e===D.SettingsFilters;return s.createElement(s.Fragment,null,r.state&&a.canConfigureBlock&&(i.isMobile?n()(V.Z,{style:{fontSize:12,color:this.theme.mediumTextColor},title:this.renderSaveExplanationMessage()}):n()("div",{style:{fontSize:12,color:this.theme.mediumTextColor,paddingLeft:14,paddingRight:14,paddingTop:8,paddingBottom:8,maxWidth:220}},void 0,this.renderSaveExplanationMessage())),a.canConfigureBlock&&n()(k.Z,{icon:u.Z.save,isOrange:!0,title:this.renderSaveMessage(),onClick:this.handleSaveInCurrentViewClick}),n()(k.Z,{icon:u.Z.undo,isGray:!0,title:n()(g.FormattedMessage,t?{defaultMessage:"Reset filters",id:"database.viewSettings.filterAndSortSaveControl.resetFilters"}:{defaultMessage:"Reset sorts",id:"database.viewSettings.filterAndSortSaveControl.resetSorts"}),onClick:()=>this.handleReset()}),a.canConfigureBlock&&!r.state&&n()(k.Z,{icon:u.Z.dots,isGray:!0,title:n()(g.FormattedMessage,{defaultMessage:"More options",id:"database.viewSettings.filterAndSortSaveControl.more"}),onClick:this.handleMoreOptionsClick}),a.canConfigureBlock&&r.state&&s.createElement(s.Fragment,null,n()(k.Z,{icon:u.Z.copyPadded,isPadded:!0,isGray:!0,title:this.renderSaveAsNewViewMessage(),onClick:()=>{this.handleSaveAsNewViewClick()}}),this.shouldShowMergeIntoAdvancedFilter()&&n()(B.Z,{placement:B.Z.Placement.Left,style:{maxWidth:240,whiteSpace:void 0},renderTooltip:()=>n()("div",{},void 0,n()(W,{})),render:e=>s.createElement(k.Z,l()({icon:u.Z.filter,isGray:!0,title:this.renderMergeIntoAdvancedFilterMessage(),onClick:()=>{this.handleMergeIntoCombinatorFilter()}},e))})))}(0,h.t1)(e)}renderSaveExplanationMessage(){const{context:e}=this.props,t=e===D.SettingsFilters;return n()(g.FormattedMessage,t?{defaultMessage:"{count, plural, one {{count} filter changed from what other people see} other {{count} filters changed from what other people see}}",id:"database.viewSettings.filterAndSortSaveControl.filter.caption",values:{count:this.changeCount.state}}:{defaultMessage:"Sort has been changed from what other people see",id:"database.viewSettings.filterAndSortSaveControl.sort.caption"})}renderSaveAsNewViewMessage(){return n()(g.FormattedMessage,{defaultMessage:"Save as new view",id:"database.filterBar.changesControl.saveAsNewView.title"})}renderMergeIntoAdvancedFilterMessage(){return n()(g.FormattedMessage,{defaultMessage:"Merge into advanced filter",id:"database.filterBar.changesControl.mergeIntoAdvancedFilter.title"})}renderResetMessage(){return n()(g.FormattedMessage,{defaultMessage:"Reset",id:"database.filterBar.changesControl.reset.title"})}renderSaveMessage(){return n()(g.FormattedMessage,{defaultMessage:"Save for everyone",id:"database.filterBar.changesControl.saveForEveryone.title"})}shouldShowMergeIntoAdvancedFilter(){const{collectionContextStore:e,context:t}=this.props,o=e.currentPropertyFiltersStore.state;return(t===D.FilterBar||t===D.SettingsFilters)&&Boolean(o.find((e=>(0,p.aN)(e.filter))))}}function W(){return n()(g.FormattedMessage,{id:"database.filterValue.mergeIntoAdvancedFilter.tooltip",defaultMessage:"Use an advanced filter to group filter rules and use AND/OR conditions."})}L.displayName="CollectionSettingsSaveControl";const G=(0,g.injectIntl)(L)},97180:(e,t,o)=>{o.d(t,{ZA:()=>h,r_:()=>g});var r=o(23174),n=o.n(r),i=o(67294),l=o(24405),a=o(42613),s=o(53397),d=o(5366),c=o(16173),p=o(32662),u=o(58032);const h={[a.G1]:i.createElement(d.FormattedMessage,a.ct.statusGroupNameTodo),[a.Ho]:i.createElement(d.FormattedMessage,a.ct.statusGroupNameInProgress),[a.RW]:i.createElement(d.FormattedMessage,a.ct.statusGroupNameComplete),[a.Ap]:i.createElement(d.FormattedMessage,c.sY.current),[a.JV]:i.createElement(d.FormattedMessage,c.sY.future)},m={[a.G1]:s.Z.statusTodoGroup,[a.Ho]:s.Z.statusInProgressGroup,[a.RW]:s.Z.statusCompleteGroup};function g(e){window.__c={n:"CollectionStatusGroupName"};const{group:t,disableGroup:o,style:r,showIcon:a,showColor:d}=e,c=(0,l.Fg)(),g=m[t.name]??s.Z.statusTodoGroup,v=t.color??"gray";return n()("div",{style:{...r,display:"inline-flex",alignItems:"center"}},void 0,a&&g({display:"inline-block",width:16,height:16,fill:d?c.accentColors[v][400]:c.mediumIconColor}),n()("span",{style:{paddingLeft:a?6:void 0,color:d?c.accentColors[v][500]:void 0}},void 0,h[t.name]??t.name),o?i.createElement(i.Fragment,null,n()(p.Z,{size:4}),n()(u.Z,{placement:u.Z.Placement.Bottom,render:e=>i.createElement("div",e,s.Z.lockedFilled({width:12})),renderTooltip:e=>i.createElement("div",e,o.tooltipCaption),disableTooltip:void 0===o.tooltipCaption})):null)}},26909:(e,t,o)=>{o.d(t,{cn:()=>m,l0:()=>g,fg:()=>v,ZP:()=>y});var r=o(10434),n=o.n(r),i=o(23174),l=o.n(i),a=o(67294),s=o(83355),d=o(87279),c=o(36488),p=o(78140),u=o(28992),h=o(40721);const m=8,g=8,v=32;class f extends s.Z{renderComponent(){const{device:e}=this.environment;return l()(c.Z,{capture:!0,allowEsc:!0,allowUndo:!0,render:t=>{let o;return o=e.isMobile?{menuType:d.og.Modal,title:this.props.title,right:l()(h.DoneMenuText,{}),onClickRight:this.props.onCancel,...t}:{menuType:d.og.Popup,...this.props.desktopMinWidth&&{minWidth:this.props.desktopMinWidth},...this.props.desktopMaxWidth&&{maxWidth:this.props.desktopMaxWidth},...this.props.desktopWidth&&{width:this.props.desktopWidth},...t},a.createElement(p.Z,n()({},o,{header:this.renderHeading()}),this.props.children)}})}renderHeading(){if(!this.environment.device.isMobile)return l()(u.Z,{style:f.headingStyle,title:this.props.title,right:this.props.helpButton})}}f.displayName="CollectionViewMenu",f.headingStyle={height:v+m-2,paddingTop:m-2};const y=f},93289:(e,t,o)=>{o.d(t,{Z:()=>s});var r=o(23174),n=o.n(r),i=o(67294),l=o(13991),a=o(77907);const s=function(e){let{firstDayOfWeek:t,value:o,selectValue:r=!0,onChange:s,disabledDays:d}=e;window.__c={n:"DatePicker"};const c=(0,i.useMemo)((()=>new Date(o)),[o]),[p,u]=(0,i.useState)(c),h=(0,i.useRef)(o);(0,i.useLayoutEffect)((()=>{h.current!==o&&(u(new Date(o)),h.current=o)}),[o]);const m=(0,i.useCallback)(((e,t,o)=>{s(e.getTime())}),[s]);return n()(a.LazyDayPicker,{locale:l.SP,className:"notion-calendar-picker",numberOfMonths:1,weekStartsOn:t,modifiers:r?{value:c}:{},showOutsideDays:!0,fixedWeeks:!0,onDayClick:m,onMonthSelected:u,disabled:d,month:p})}},78948:(e,t,o)=>{o.d(t,{Z:()=>d});var r=o(23174),n=o.n(r),i=(o(67294),o(83355)),l=o(68785),a=o(28992);class s extends i.Z{renderComponent(){return n()(a.Z,{title:n()(l.Z,{})})}}s.displayName="LoadingMenuItem";const d=s},77498:(e,t,o)=>{o.d(t,{Z:()=>F});var r=o(23174),n=o.n(r),i=o(10434),l=o.n(i),a=(o(30541),o(43261)),s=o.n(a),d=o(96486),c=o.n(d),p=o(67294),u=o(83355),h=o(99036),m=o(80951),g=o(5366),v=o(87279),f=o(33846),y=o(68894),S=o(78140),M=o(32163),b=o(43765),C=o(40721),w=o(72495),x=o(69872);class k extends u.Z{constructor(){super(...arguments),this.storeTypes={inputStore:f.Z}}renderComponent(){const{onAccept:e,schema:t,onClose:o,allowProperty:r,intl:i,isRelationProperty:a}=this.props,{inputStore:d}=this.stores;let u=Object.keys(t);const f=u.some(m.wl);u=c().sortBy(u,(e=>{const o=(0,m.Qm)({schema:t,property:e});return o?o.name:""}));const k=f?`${m.UU}${h.iw}`:h.iw;u=c().without(u,k),u.unshift(k);const F=d.state.inputValue;if(r&&(u=u.filter((e=>{const o=(0,m.Qm)({schema:t,property:e});return o&&r(o)}))),F){let e=u.map((e=>{const o=(0,m.Qm)({schema:t,property:e});return o&&o.name}));e=s().filter(F,e).map((e=>{let{original:t}=e;return t})),u=u.filter((o=>{const r=(0,m.Qm)({schema:t,property:o});return r&&r.name&&e.includes(r.name)}))}const Z=c().compact(u.map((o=>{const r=(0,m.Qm)({schema:t,property:o});if(!r)return;return{key:o,render:e=>p.createElement(x.Z,l()({},e,{propertySchema:r,format:x.Z.DisplayFormat.Name})),action:()=>e(o)}}))),T=[{key:0,render:e=>p.createElement(w.Z,e),items:Z}],{device:I}=this.environment,R=n()(w.Z,{isInput:!0},void 0,n()(y.ZP,{focus:!I.isMobile||void 0,focusAfterAnimation:!0,value:F,onChange:e=>this.stores.inputStore.setState({focus:!0,inputValue:e.target.value}),placeholder:a?i.formatMessage({defaultMessage:"Search for a relation property…",id:"propertySelectMenu.searchForProperty.relation.placeholder"}):i.formatMessage({defaultMessage:"Search for a property…",id:"propertySelectMenu.searchForProperty.default.placeholder"})}));let V;return V=I.isMobile?{menuType:v.og.Modal,title:a?i.formatMessage({defaultMessage:"Relation property",id:"propertySelectMenu.mobileMenu.relationProperty.header"}):i.formatMessage({defaultMessage:"Property",id:"propertySelectMenu.mobileMenu.property.header"}),right:n()(C.CancelMenuText,{}),onClickRight:o,header:R}:{menuType:v.og.Popup,width:300,header:R},p.createElement(S.Z,V,0===Z.length?n()(w.Z,{},void 0,n()(b.Z,{title:n()(g.FormattedMessage,{defaultMessage:"No results",id:"propertySelectMenu.search.noResults.title"})})):n()(M.Z,{type:M.i.Vertical,sections:T,onAccept:o,initialFocus:F.length>0?0:void 0}))}}k.displayName="PropertySelectMenu";const F=(0,g.injectIntl)(k)},50542:(e,t,o)=>{o.d(t,{Z:()=>u});var r=o(23174),n=o.n(r),i=(o(67294),o(83355)),l=o(5366),a=o(52275),s=o(19387),d=o(69872),c=o(62045);class p extends i.Z{renderComponent(){const{device:e}=this.environment;if(e.isMobile)return this.props.propertySchema?n()(d.Z,{propertySchema:this.props.propertySchema,onClick:this.props.onClick,focused:!1,format:d.Z.DisplayFormat.Name,showExtensionArrow:!this.props.disabled}):n()(a.Z,{focused:!1,title:n()(l.FormattedMessage,{defaultMessage:"Property",id:"database.mobileFilterAndSortMenu.property.buttonMenuItem.label"})});{const e=this.props.propertySchema&&n()(s.Z,{propertySchema:this.props.propertySchema,showIcon:!0,style:{lineHeight:1.4}}),t=n()(l.FormattedMessage,{defaultMessage:"Property",id:"database.filterAndSortMenu.propertyButton.label"});return n()(c.Z,{title:e,placeholder:t,onClick:this.props.onClick,disabled:this.props.disabled,disableMargins:this.props.disableMargins,desktopStyle:this.props.textWrapperStyle})}}}p.displayName="QueryMenuPropertyItem";const u=p},95691:(e,t,o)=>{o.d(t,{Z:()=>h});var r=o(10434),n=o.n(r),i=o(23174),l=o.n(i),a=o(67294),s=o(24405),d=o(8848),c=o(53397),p=o(82990),u=o(64921);const h=function(e){window.__c={n:"SegmentedDropdownButton"};const{style:t,color:o,title:r,onClick:i,icon:h,dropdownEvents:m,className:g}=e,v=(0,s.yK)((e=>({wrap:{position:"relative",display:"inline-flex",flexShrink:0,borderRadius:3,overflow:"hidden",height:28},mainButton:{display:"flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",borderTopLeftRadius:3,borderBottomLeftRadius:3,lineHeight:1.1,paddingLeft:8,paddingRight:8,fontWeight:p.Z.fontWeight.medium,..."blue"===o&&{background:d.ZP.blue,color:d.ZP.white},..."orange"===o&&{background:"dark"===e.mode?e.accentColors.orange[100]:e.accentColors.orange[50],color:"dark"===e.mode?e.accentColors.orange[600]:e.accentColors.orange[400]}},dropdownButton:{display:"flex",alignItems:"center",justifyContent:"center",width:24,alignSelf:"stretch",borderTopRightRadius:3,borderBottomRightRadius:3,..."blue"===o&&{background:d.ZP.blue,color:d.ZP.white,boxShadow:`inset 1px 0 0 ${e.darkDividerColor}`},..."orange"===o&&{background:"dark"===e.mode?e.accentColors.orange[100]:e.accentColors.orange[50],color:e.accentColors.orange[400],boxShadow:"dark"===e.mode?`${e.accentColors.orange[300]} 1px 0 0 inset`:`${e.accentColors.orange[200]} 1px 0 0 inset`}},dropdownButtonIcon:{width:10,marginTop:2,..."blue"===o&&{fill:d.ZP.white},..."orange"===o&&{fill:"dark"===e.mode?e.accentColors.orange[500]:e.accentColors.orange[400]}},buttonHoveredStyle:{..."blue"===o&&{background:e.blueButtonHoveredBackground},..."orange"===o&&{background:"dark"===e.mode?e.accentColors.orange[200]:e.accentColors.orange[100]}},buttonPressedStyle:{..."blue"===o&&{background:e.blueButtonPressedBackground},..."orange"===o&&{background:"dark"===e.mode?e.accentColors.orange[300]:e.accentColors.orange[200]}},icon:{width:12,marginRight:6,..."blue"===o&&{fill:d.ZP.white},..."orange"===o&&{fill:e.accentColors.orange[400]}},border:{position:"absolute",pointerEvents:"none",borderRadius:3,top:0,left:0,right:0,bottom:0,..."blue"===o&&{boxShadow:"rgba(15, 15, 15, 0.1) 0px 0px 0px 1px inset, rgba(15, 15, 15, 0.1) 0px 1px 2px"},..."orange"===o&&{boxShadow:"dark"===e.mode?`${e.accentColors.orange[300]} 0px 0px 0px 1px inset`:`${e.accentColors.orange[200]} 0px 0px 0px 1px inset`}}})),[o]);return l()("div",{style:{...v.wrap,...t},className:g},void 0,l()(u.Z,{style:v.mainButton,onClick:i,disabledFeedback:!0,hoveredStyle:v.buttonHoveredStyle,pressedStyle:v.buttonPressedStyle},void 0,h&&h(v.icon),r),a.createElement(u.Z,n()({disabledFeedback:!0,style:v.dropdownButton,hoveredStyle:v.buttonHoveredStyle,pressedStyle:v.buttonPressedStyle},m),c.Z.chevronDown(v.dropdownButtonIcon)),l()("div",{style:v.border}))}},22084:(e,t,o)=>{o.d(t,{a:()=>h,F:()=>m});var r=o(10434),n=o.n(r),i=o(23174),l=o.n(i),a=o(67294),s=o(24405),d=o(8848),c=o(82990),p=o(62896),u=o(85567);function h(e){window.__c={n:"SelectToken"};const{value:t,color:o,format:r,showEllipsis:i,onClickRemove:h,showRemoveButton:m,isSingle:g,shouldShrink:v,...f}=e,y=(0,s.Fg)(),S=(0,s.yK)((()=>({token:{...i&&c.Z.textOverflowStyle}})),[i]),{textColor:M,backgroundColor:b}=(0,d.KR)(y,o);return t?a.createElement(u.Z,n()({format:r,value:l()(p.Z,{},void 0,t),onClickRemove:h,showRemoveButton:m,isSingle:g,color:M,backgroundColor:b,shouldShrink:v,showFullValueTooltip:!0,style:S.token},f)):null}function m(e){window.__c={n:"StatusSelectToken"};const{value:t,color:o,format:r,showEllipsis:i,onClickRemove:h,showRemoveButton:m,isSingle:g,shouldShrink:v,groupColor:f,...y}=e,S=(0,s.Fg)(),M=(0,s.yK)((()=>({token:{...i&&c.Z.textOverflowStyle}})),[i]);if(!t)return null;const{textColor:b,backgroundColor:C}=(0,d.KR)(S,o??f??"gray"),w=o&&"default"!==o?o:f??"gray";return a.createElement(u.Z,n()({format:r,value:l()(p.Z,{},void 0,t),onClickRemove:h,showRemoveButton:m,isSingle:g,color:b,backgroundColor:C,shouldShrink:v,showFullValueTooltip:!0,style:M.token,isRound:!0,showColoredDot:w},y))}},91839:(e,t,o)=>{o.d(t,{Z:()=>l});var r=o(23174),n=o.n(r),i=(o(67294),o(5366));const l=function(e){let{style:t}=e;window.__c={n:"LoadingDots"};const o=(0,i.useIntl)();return n()("div",{"aria-valuetext":o.formatMessage({id:"loadingDots.label",defaultMessage:"Loading..."}),role:"progressbar",className:"loading-dots"},void 0,n()("div",{className:"loading-dot",style:{...t}}),n()("div",{className:"loading-dot",style:{...t}}),n()("div",{className:"loading-dot",style:{...t}}))}},28405:(e,t,o)=>{o.d(t,{Z:()=>Ve});var r=o(10434),n=o.n(r),i=o(23174),l=o.n(i),a=(o(57658),o(96486)),s=o.n(a),d=o(67294),c=o(480),p=o(81954),u=o(24405),h=o(39068),m=o(84116),g=o(5998),v=o(32620),f=o(78106),y=o(66673),S=o(53397),M=o(68626),b=o(70203),C=o(97880),w=o(82990),x=o(5366),k=o(62134),F=o(98104),Z=o(12359),T=o(37181),I=o(14976),R=o(52821),V=o(17731),P=o(17809),E=o(33929),A=o(68056),_=o(33665),B=o(79315),O=o(24666),D=o(42922),L=o(73063),W=o(3386),G=o(16354),N=o(89728),U=o(58032),H=o(84619),K=o(87279),z=o(29798),q=o(73657),Q=o(52275),$=o(78140),Y=o(32163),j=o(72495),J=o(21396);function X(e){window.__c={n:"FormulaAutocompleteMenu"};const{store:t,selection:o,cursorEditorInfo:r,cursorEditorInfoRef:i,context:s,onChange:h,getRecordModel:g,setInfoHelper:v}=e,y=(0,c.Fy)(),S=(0,p.qz)(void 0,z.Z),M=(0,d.useMemo)((()=>((null==r?void 0:r.completions)??[]).map(((e,r)=>({key:`${e.kind}-${r}`,render:t=>d.createElement(ee,n()({},t,{completion:e,context:s,getRecordModel:g,menuListStore:S,index:r,cursorEditorInfoRef:i,setInfoHelper:v})),action:()=>{var e;const n=i.current,l=null==n||null===(e=n.completions)||void 0===e?void 0:e[r];var a;void 0!==l&&n&&(v({...l,calledFromUnifiedFunctionProperty:"member dot receiver"===(null===(a=n.completionsInfo)||void 0===a?void 0:a.type)}),function(e){var t;const{completion:o,store:r,selection:n,onChange:i,cursorEditorInfo:l}=e,a=(null==n?void 0:n.startIndex)||0,s=(null==n?void 0:n.endIndex)||0,d=a!==s,c=(null===(t=l.completionsInfo)||void 0===t?void 0:t.prefix)||"",p=d?a:s-c.length,u=r.getValue();if(o.kind===m.WY.Token){if(o.token.type===m.Oy.Checkbox)return;if(o.token.type===m.Oy.BlockProperty){const e=(0,b.vY)(u,p,s),t=o.token.collection?(0,f.SR)(o.token.property):o.token.property,r=(0,b.YC)((0,b.kb)({collection:o.token.collection,property:t,name:o.name}));return void i({newValue:(0,b.P$)(e,[r],p),newSelection:{startIndex:p+1,endIndex:p+1}})}if(o.token.type===m.Oy.ContextValue){const e=(0,b.vY)(u,p,s),t=(0,f.Kv)(o.token.valueId),r=(0,b.YC)((0,b._Q)({id:t}));i({newValue:(0,b.P$)(e,[r],p),newSelection:{startIndex:p+1,endIndex:p+1}})}else{if(o.token.type===m.Oy.Date||o.token.type===m.Oy.Block||o.token.type===m.Oy.Person)return;(0,C.t1)(o.token)}}else if(o.kind===m.WY.LibraryFunction){var h,g,v,y;const e=(0,b.vY)(u,p,s),t=(0,b.V3)(`${o.libraryFunction.name}()`,[]),r=(0,b.P$)(e,[t],p);let n=p+o.libraryFunction.name.length+1;void 0!==(null===(h=o.libraryFunction)||void 0===h||null===(h=h.parameters)||void 0===h?void 0:h.varargs)||null!==(g=o.libraryFunction)&&void 0!==g&&null!==(g=g.parameters)&&void 0!==g&&null!==(g=g.expected)&&void 0!==g&&g.length&&(1!==(null===(v=o.libraryFunction)||void 0===v||null===(v=v.parameters)||void 0===v||null===(v=v.expected)||void 0===v?void 0:v.length)||"member dot receiver"!==(null===(y=l.completionsInfo)||void 0===y?void 0:y.type))||(n+=1);i({newValue:r,newSelection:{startIndex:n,endIndex:n}})}else if(o.kind===m.WY.Binding){const e=(0,b.vY)(u,p,s),t=(0,b.V3)(o.text,[]),r=(0,b.P$)(e,[t],p),n=p+o.text.length;i({newValue:r,newSelection:{startIndex:n,endIndex:n}})}else(0,C.t1)(o)}({completion:l,store:t,selection:o,onChange:h,cursorEditorInfo:n}))}})))),[s,null==r?void 0:r.completions,i,g,S,h,o,v,t]),w=(0,d.useCallback)((e=>{var t;const o=null===(t=i.current)||void 0===t||null===(t=t.completions)||void 0===t?void 0:t[e.indexLocal];var r;o&&v({...o,calledFromUnifiedFunctionProperty:"member dot receiver"===(null===(r=i.current.completionsInfo)||void 0===r?void 0:r.type)})}),[i,v]);(0,d.useEffect)((()=>{const e=e=>{var t,o;if(void 0!==e.state.focus.indexLocal&&null!==(t=i.current)&&void 0!==t&&t.completions&&(null===(o=i.current)||void 0===o?void 0:o.completions.length)>0){var r;const t=null===(r=i.current)||void 0===r||null===(r=r.completions)||void 0===r?void 0:r[e.state.focus.indexLocal];void 0!==t&&v((e=>{var o;return void 0===e||void 0===(null===(o=i.current)||void 0===o?void 0:o.callParameter)?t:e}))}};return S.addListener(e),()=>S.removeListener(e)}),[i,S,v]),(0,d.useEffect)((()=>{var e,t,o,n;const i="function"===(null==r||null===(e=r.callParameter)||void 0===e||null===(e=e.expression)||void 0===e||null===(e=e.type)||void 0===e?void 0:e.type)?null===(t=r.callParameter.expression)||void 0===t?void 0:t.type:void 0;void 0!==i&&void 0!==(null==r||null===(o=r.callParameter)||void 0===o?void 0:o.parameterIndex)&&(null==r||null===(n=r.callParameter)||void 0===n?void 0:n.parameterIndex)>-1&&v({kind:m.WY.LibraryFunction,libraryFunction:i.libraryFunction,calledFromUnifiedFunctionProperty:i.calledFromUnifiedFunctionProperty})}),[null==r?void 0:r.callParameter,v]),(0,d.useEffect)((()=>{M.length>0&&S.update((e=>({focus:{...e,section:0,indexLocal:0,indexGlobal:0}})))}),[M.length,S,v]);const k=(0,u.yK)((e=>({menu:{borderLeft:`1px solid ${e.outlineButtonBorder}`}})),[]);let F;return F=y.isPhone?{menuType:K.og.ActionSheet,disableBottomPadding:!0}:{menuType:K.og.Popup,width:y.isPhone?180:240,minWidth:y.isPhone?180:240},d.createElement($.Z,n()({},F,{scrollerStyle:k.menu}),l()(Y.Z,{type:Y.i.Vertical,initialFocus:0,priority:1,store:S,onKeyboardArrow:w,sections:a.compact([{key:"values",render:e=>d.createElement(j.Z,n()({},e,{title:l()(x.FormattedMessage,{defaultMessage:"Insert a value",id:"formulaAutocompleteMenu.insertAValue.message"})})),items:M},0===M.length&&{key:"no-results",render:e=>d.createElement(j.Z,n()({disableDesktopPadding:!0},e),l()(ne,{})),items:[]}])}))}const ee=d.forwardRef(((e,t)=>{window.__c={n:"CompletionMenuItem"};const{completion:o,context:r,getRecordModel:i,menuListStore:a,index:s,cursorEditorInfoRef:c,setInfoHelper:g,onMouseEnter:v,...y}=e,S=(0,u.yK)((e=>({icon:{width:14,fill:e.mediumIconColor},lightParens:{color:e.lightTextColor}})),[]),M=(0,d.useCallback)((e=>{var t;const o=null===(t=c.current)||void 0===t||null===(t=t.completions)||void 0===t?void 0:t[s];g(o),null==v||v(e)}),[c,s,v,g]),b=(0,p.VK)((()=>a.state.focus.indexLocal===s),[a,s]),w=(0,p.VK)((()=>{var e;if(o.kind!==m.WY.Token||o.token.type!==m.Oy.BlockProperty||!i)return;if(m.WG.includes(o.token.property))return o.token.property;if(!o.token.collection)return;const t=(0,f.SR)(o.token.property),r=i(o.token.collection);return null==r||null===(e=r.getNormalizedSchema())||void 0===e||null===(e=e[t])||void 0===e?void 0:e.type}),[o,i]);if(o.kind===m.WY.Token){if(o.token.type===m.Oy.Checkbox)return null;if(o.token.type===m.Oy.BlockProperty)return d.createElement(Q.Z,n()({},y,{icon:w?h.wG[w](S.icon):l()(oe,{type:"unknown"}),title:o.name??o.token.property,right:l()(te,{visible:b}),onMouseEnter:M,ref:t}));if(o.token.type===m.Oy.ContextValue){const e=(0,f.vx)(r.valueTypes,(0,f.Kv)(o.token.valueId));return e?d.createElement(Q.Z,n()({},y,{icon:l()(oe,{type:e.type.type}),title:l()("div",{style:{display:"flex"}},void 0,l()(J.F,{value:e,format:H.l.Medium,isSingle:!0,shouldShrink:!0})),right:l()(te,{visible:b}),onMouseEnter:M,ref:t})):null}if(o.token.type===m.Oy.Date)return null;if(o.token.type===m.Oy.Block)return null;if(o.token.type===m.Oy.Person)return null;(0,C.t1)(o.token)}else{if(o.kind===m.WY.LibraryFunction){const e=o.libraryFunction.returnType;return d.createElement(Q.Z,n()({},y,{icon:l()(oe,{type:"function"==typeof e?e([]).type:e.type}),title:d.createElement(d.Fragment,null,o.libraryFunction.name,l()("span",{style:S.lightParens},void 0,"()")),right:l()(te,{visible:b}),onMouseEnter:M,ref:t}))}if(o.kind===m.WY.Binding)return d.createElement(Q.Z,n()({},y,{title:o.text,icon:l()(oe,{type:o.type.type}),right:l()(te,{visible:b}),onMouseEnter:M,ref:t}));(0,C.t1)(o)}})),te=d.memo((e=>{let{visible:t}=e;window.__c={n:"FormulaAutocompleteEnterIcon"};const o=(0,u.yK)((e=>({icon:{width:14,fill:e.mediumIconColor,transition:"opacity 0.2s ease-in",visibility:t?"visible":"hidden",opacity:t?1:0}})),[t]);return S.Z.enter(o.icon)})),oe=d.memo((e=>{var t;let{type:o}=e;window.__c={n:"FormulaValueTypeIcon"};const r=(0,u.yK)((e=>({icon:{width:14,fill:e.mediumIconColor,transition:"transform .3s ease"}})),[]);return null===(t=re(o))||void 0===t?void 0:t(r.icon)}));function re(e){return"text"===e?h.wG.text:"number"===e?h.wG.number:"checkbox"===e?h.wG.checkbox:"date"===e?h.wG.date:"block"===e?h.wG.relation:"person"===e?h.wG.person:"select"===e?h.wG.select:"array"===e?h.wG.multi_select:"function"===e||void 0===e||"unknown"===e?h.wG.formula:void(0,C.t1)(e)}function ne(){return l()(q.Z,{caption:l()(x.FormattedMessage,{defaultMessage:"No results",id:"FormulaAutocompleteMenu.noResults.message"})})}var ie=o(97762),le=o(83355),ae=o(1302),se=o(13991),de=o(14577),ce=o(15095),pe=o(42875),ue=o(62193),he=o(44805),me=o(43132),ge=o(993),ve=o(98724),fe=o(56971),ye=o(95477),Se=o(62619),Me=o(55227),be=o(70219),Ce=o(89086),we=o(77907),xe=o(82484),ke=o(30874),Fe=o(29595),Ze=o(1743),Te=o(93262);class Ie extends le.Z{constructor(){super(...arguments),this.editor=null,this.mergeEditorRefs=(0,ue.sH)(),this.renderContentContainer=(e,t)=>{let{leafRef:o,wrapperRef:r,...i}=e;return d.createElement("div",n()({ref:r},i,{style:{flexGrow:1}}),d.createElement(Fe.Z,{ref:this.mergeEditorRefs(this.editorRef,o),style:this.getContentEditableStyle(),getDisabled:this.isDisabled,getHtml:()=>this.getHtml(this.textValueStore.state,this.props.errorRanges),getSelection:this.getContainerSelection,onMutation:this.handleMutation,spellCheck:!1,autoCorrect:"off",autoCapitalize:"off",onSelect:t,onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,suppressNewlineEvents:!1,placeholder:" "}))},this.renderSyntaxTokens=(e,t)=>{const o=Me.kF(t,e),{device:r}=this.environment,n=t.map(b.hD).map(((e,t)=>he.fn({annotations:e,theme:this.theme,getRecordModel:this.props.store.getRecordModel,spaceId:this.props.parentSpaceId})));return o.map(((e,o)=>{const i=t[e.textTokenIndex],a=n[e.textTokenIndex];return b.km(i)?(0,he.$i)({args:{textValue:{value:t,spaceId:this.props.parentSpaceId},getRecordModel:this.props.store.getRecordModel,getRecordRole:this.props.store.getRecordRole,disableHover:!1,disableStyleAnnotations:!1,disableDateStyleAnnotations:!1,disableLinks:!1,userTimeZone:(0,pe.r)(),disabled:!1,isAndroid:r.isAndroid,isSafariOrIOS:r.isSafari||r.isIOS,isWindows:r.isWindows,showEmojiInline:r.isWindows,emojiType:"raw",highlightDiscussionId:void 0,theme:this.theme,intl:E.default.getIntl(),renderedPageBlockId:void 0,parentBlockId:void 0,katex:void 0,isClient:!0,baseUrl:ye.default.domainBaseUrl,publicDomainName:ye.default.publicDomainName,currentUserId:this.environment.currentUser.id,overwriteBaseUrlFromSpaceId:(0,be.b)(this.environment),externalIntegrations:ke.Z.integrations.state,formulaValueTypes:this.props.valueTypes,emojiData:xe.Z.state},style:a.style,classNames:a.classNames,index:o,token:i,tokenValue:b.Wi(i),tokenAnnotations:b.hD(i)}):d.createElement(d.Fragment,null,l()("span",{className:[e.classNames||"",...a.classNames].join(" "),style:a.style,"data-token-index":e.textTokenIndex},o,e.value))}))},this.handleClick=e=>{I.SD({environment:this.environment,event:e,textValue:this.textValueStore.state,editorNode:this.getEditorNode(),store:this.props.store,canEdit:!this.isDisabled()})},this.handleMutation=e=>{let{newValue:t}=e;Z.createAndCommit({userAction:"FormulaInputText.handleMutation",environment:this.environment,perform:e=>{ge.aS({environment:this.environment,store:this.props.store,newValue:t,disableMentions:!0,disableDateMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,disableDateReminderMentions:!0,disableFilters:!0,transaction:e}),e.postEnqueueActions.push((()=>{Z.createAndCommit({userAction:"FormulaInputText.normalizeTextValue",environment:this.environment,perform:e=>{ge.vE({store:this.props.store,transaction:e})}})}))}})},this.handleDelete=e=>{if(this.isDisabled())return;const t=O.default.state;"editing"===t.mode&&t.multiSelection.start.store===this.props.store&&Z.createAndCommit({userAction:"FormulaInputText.handleDelete",environment:this.environment,perform:o=>{fe.as({environment:this.environment,multiSelection:t.multiSelection,deleteForwards:!0,transaction:o,event:e})}})},this.handleBackspace=e=>{if(this.isDisabled())return;const t=O.default.state;if("editing"===t.mode&&t.multiSelection.start.store===this.props.store){if(fe.YV({device:this.environment.device,event:e,multiSelection:t.multiSelection}))return;Z.createAndCommit({userAction:"FormulaInputText.handleBackspace",environment:this.environment,perform:o=>{fe.as({environment:this.environment,multiSelection:t.multiSelection,deleteForwards:!1,transaction:o,event:e})}})}},this.handleShiftEnter=e=>{var t;if(this.isDisabled())return;if(null===(t=e.preventDefault)||void 0===t||t.call(e),this.editor&&this.editor.isComposing)return;const o=O.default.state,r="editing"===o.mode&&(0,A.QY)(o.multiSelection);r&&Z.createAndCommit({userAction:"FormulaInputText.handleShiftEnter",environment:this.environment,perform:e=>{ge.hJ({environment:this.environment,store:this.props.store,string:"\n",selection:r.selection,disableMentions:!0,disableDateMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:e})}})},this.handleTab=e=>{if(this.isDisabled())return;e.preventDefault();const t=O.default.state,o="editing"===t.mode&&(0,A.QY)(t.multiSelection);o&&Z.createAndCommit({userAction:"FormulaInputText.handleTab",environment:this.environment,perform:e=>{ge.wA({environment:this.environment,store:this.props.store,selection:o.selection,transaction:e,shouldStripTokens:!1})}})},this.handleUntab=e=>{if(this.isDisabled())return;e.preventDefault();const t=O.default.state,o="editing"===t.mode&&(0,A.QY)(t.multiSelection);o&&Z.createAndCommit({userAction:"FormulaInputText.handleUntab",environment:this.environment,perform:e=>{ge.O5({environment:this.environment,store:this.props.store,selection:o.selection,transaction:e,shouldStripTokens:!1})}})},this.handleAnnotation=(e,t)=>{this.isDisabled()||(t.preventDefault(),ve.aS({environment:this.environment,annotation:e}),this.flushRenderQueue())},this.handleCopy=e=>{me.JG({environment:this.environment,event:e})},this.handleCut=e=>{this.isDisabled()?e.preventDefault():me.by({environment:this.environment,event:e})},this.handlePaste=e=>{this.isDisabled()?e.preventDefault():Z.createAndCommit({userAction:"FormulaInputText.handlePaste",environment:this.environment,perform:t=>{me.v({environment:this.environment,event:e,disableEmbedMenu:!0,transaction:t,onPasteFiles:me.AL})}})},this.handleMoveUp=e=>{Z.createAndCommit({userAction:"FormulaInputText.handleMoveUp",environment:this.environment,perform:e=>{ge.fs({environment:this.environment,transaction:e,direction:"up"})}})},this.handleMoveDown=e=>{Z.createAndCommit({userAction:"FormulaInputText.handleMoveDown",environment:this.environment,perform:e=>{ge.fs({environment:this.environment,transaction:e,direction:"down"})}})},this.handleMouseOver=e=>{I.vO({environment:this.environment,event:e,textValue:this.textValueStore.state,editorNode:this.getEditorNode(),store:this.props.store,canEdit:!this.isDisabled()})},this.handleMouseOut=e=>{I.kV({environment:this.environment,event:e,textValue:this.textValueStore.state,editorNode:this.getEditorNode(),store:this.props.store,canEdit:!this.isDisabled()})},this.isDisabled=()=>this.props.disabled,this.createSyntaxToken=e=>Se.Gs(e)?[e.data]:Se.kK(e)?[e.textContent||"",e.className]:void 0,this.getHtml=(e,t)=>{const{Prism:o}=this.props,r=b.Q(e),n="rust",i=o.languages.rust,a=document.createElement("div"),c=o.highlight(r,i,n);a.innerHTML=Me.g7(c);const p=s().compact(Array.from(a.childNodes).map(this.createSyntaxToken));for(const l of t)e=b.aS({textValue:e,selection:l,annotation:[b.GK.FormulaError]});const u=this.renderSyntaxTokens(s().compact(p),e||[]),h=l()(d.Fragment,{},void 0,u,l()("span",{},void 0,"\n"));return ie.renderToStaticMarkup(h)},this.clearBrowserSelection=()=>{var e;null===(e=this.getEditorNode())||void 0===e||e.blur()},this.textValueStore=new de.Z((()=>this.props.store.getValue()||[]),{debugName:"FormulaInputText.textValueStore"}),this.isEditing=this.createComputedStore((()=>{var e;const t=O.default.state;return"editing"===t.mode&&(null===(e=(0,A.QY)(t.multiSelection))||void 0===e?void 0:e.store)===this.props.store})),this.getContainerSelection=()=>{if(this.isEditing.state)return(0,Ce.HE)(this.props.store)},this.getEndSelection=()=>{const e=ce.p4(b.Q(this.textValueStore.state));return{startIndex:e.length,endIndex:e.length}},this.editorRef=e=>{this.editor=e}}willMount(e){e.focus&&F.NX({store:e.store})}renderComponent(){const{store:e,disabled:t,handleSaveOnEsc:o}=this.props;return l()(Ze.Z,{capture:!0,allowUpDownFn:e=>e.shiftKey||"metaKey"in e&&e.metaKey||"ctrlKey"in e&&e.ctrlKey,allowEnter:!0,allowTabUntab:!0,allowUndo:!0,allowEsc:void 0!==o,allowCopyPaste:!0},void 0,l()(Te.Z,{store:e,disabled:t,disableAnnotation:!0,clearBrowserSelection:this.clearBrowserSelection,getEndSelection:this.getEndSelection,onClick:this.handleClick,onDelete:this.handleDelete,onBackspace:this.handleBackspace,onShiftEnter:this.handleShiftEnter,onCommandEnter:s().identity,onCommandShiftEnter:s().identity,onTab:this.handleTab,onUntab:this.handleUntab,onToggleBold:e=>this.handleAnnotation(["b"],e),onToggleItalics:e=>this.handleAnnotation(["i"],e),onToggleUnderline:e=>this.handleAnnotation(["_"],e),onToggleStrike:e=>this.handleAnnotation(["s"],e),onToggleCode:s().identity,onCopy:this.handleCopy,onCut:this.handleCut,onPaste:this.handlePaste,onMoveUp:this.handleMoveUp,onMoveDown:this.handleMoveDown,onEsc:o,render:this.renderContentContainer,disableMentions:!0,disableSlashCommands:!0,canSelectAllBlocks:!0,canInsertText:!0,canSelectionDrag:!0,disableMobileActionBar:!0,topBottomPadding:40,pasteBehavior:"inline"}))}getEditorNode(){var e;return(null===(e=this.editor)||void 0===e?void 0:e.getNode())||void 0}flushRenderQueue(){ae.default.flush()}getContentEditableStyle(){return{flexGrow:1,flexShrink:1,textAlign:"left",fontFamily:w.Z.getCompositeFontFamily(se.SP).githubMono,fontSize:14,tabSize:2,whiteSpace:"pre",borderRadius:3,minHeight:"1em",padding:"6px 12px",height:"100%",wordBreak:"break-all",textWrap:"wrap"}}}Ie.displayName="FormulaInputText";const Re=(0,we.withDependency)(we.deps.prismjs,((e,t)=>d.createElement(Ie,n()({},t,{Prism:e}))));function Ve(e){window.__c={n:"FormulaInput"};const{evaluationErrors:t,initialCode:o,parentSpaceId:r,outputFooter:n,disabled:i,typecheckContext:a,formulas:h,handleBack:m,onCodeChange:v,onTypeChange:S,parentCollection:w}=e,k=(0,c.Fy)(),Z=(0,x.useIntl)(),{store:T,setValue:I}=(0,P.useMockTextStore)({initialValue:o,onChange:v,source:"formula",parentCollection:w}),R=(0,d.useCallback)((e=>{if(I(e.newValue),e.newSelection){const t={start:{store:T,index:e.newSelection.startIndex},end:{store:T,index:e.newSelection.endIndex}};F.NA({multiSelection:t})}}),[I,T]),V=(0,p.VK)((()=>{var e;const t=O.default.state;if("editing"===t.mode&&(null===(e=(0,A.QY)(t.multiSelection))||void 0===e?void 0:e.store)===T)return{startIndex:t.multiSelection.start.index,endIndex:t.multiSelection.end.index}}),[T]),E=(0,p.VK)((()=>!s().isEqual(T.getValue(),o)),[o,T]),{handleClose:_}=e,D=(0,d.useCallback)((()=>{_(T.getValue())}),[_,T]),L=(0,p.VK)((()=>T.getValue()),[T]),[G,N]=(0,p.VK)((()=>L?h.processFormulaInput(L):[void 0,void 0]),[L,h]),U=(0,p.VK)((()=>{if(G)return h.parseFormulaInput(G,N)}),[G,h,N]),H=(0,p.VK)((()=>{if(U)return h.convertFormulaCSTToAST(U[0])}),[h,U]),[K,z]=(0,d.useState)(void 0);(0,d.useEffect)((()=>{!async function(){if(H&&a&&M.x.isSuccess(H)){const e=await h.addTypesToFormulaASTAsync(H.value,a,N);z(e),null==S||S(e.node.type)}else z(void 0)}()}),[H,a,N,U,h,S]);const q=(0,d.useMemo)((()=>{const e=K?[...(0,f.Kl)(K.node,!1),...K.errors]:[];return{parseErrors:(null==U?void 0:U[1])??[],typeErrors:e,evaluationErrors:t}}),[K,t,U]),Q=(0,y.Kt)(q,400,Object.is),$=q.parseErrors.length+q.typeErrors.length+q.evaluationErrors.length>0,Y=(0,p.VK)((()=>function(e){const{errors:t,intl:o,textLength:r,formulas:n}=e,{parseErrors:i,typeErrors:l,evaluationErrors:a}=t,s=[];if(l&&l.length>0){const e=l.map((e=>{const t=(0,g.FR)((0,g.ic)(e));return{msg:o.formatMessage(...t),range:{startIndex:e.node.startOffset,endIndex:e.node.endOffset+1}}}));s.push(...e)}else if(a&&a.length>0){const e=a.map((e=>{const t=(0,g.FR)((0,g.OY)(e));return{msg:o.formatMessage(...t),range:n.isUniqueFormulaEvaluatorError(e)?{startIndex:e.node.startOffset,endIndex:e.node.endOffset+1}:void 0}}));s.push(...e)}if(i){const e=i.map((e=>{const t=(0,g.FR)((0,g.sG)(e));return{msg:o.formatMessage(...t),range:"eof"===e.offset?{startIndex:r-1,endIndex:r}:{startIndex:e.offset,endIndex:e.offset+1}}}));s.push(...e)}return s}({errors:Q,textLength:(0,b.Q)(L).length,formulas:h,intl:Z})),[L,Q,h,Z]),j=(0,d.useMemo)((()=>Y.map((e=>e.range)).filter(C.$K)),[Y]),[J,ee]=(0,d.useState)(void 0),te=(0,d.useRef)(void 0),[oe,re]=(0,d.useState)(void 0),ne=(0,d.useRef)(1);(0,d.useEffect)((()=>{ne.current++;const e=ne.current;!async function(){if(h){const t=await h.getFormulaEditorInfoAtPosition({formula:L??[],inputPosition:V&&V.startIndex===V.endIndex?V.startIndex:0,context:a,hideDeprecatedCompletions:!0});M.x.isSuccess(t)&&ne.current===e&&(te.current=t.value,ee(t.value))}}()}),[V,h,a,L]);const ie=(0,p.VK)((()=>{var e;return!(null!==(e=B.default.state.currentUserSettingsStore)&&void 0!==e&&null!==(e=e.getSettings())&&void 0!==e&&e.dismissed_formulas2_footer)}),[]),le=(0,d.useCallback)((()=>{I(o)}),[o,I]);const ae=(0,u.yK)((e=>({container:{display:"flex",height:"100%",paddingBottom:ie?30:void 0},leftColumn:{width:k.isMobile?"50vw":void 0,flexGrow:1,height:"100%",display:"flex",flexDirection:"column",minWidth:0},inputText:{display:"flex",flexGrow:1,flexShrink:1,overflow:"auto"}})),[k.isMobile,ie]);return l()(W.Z,{capture:!0,onCommandS:D},void 0,l()("div",{style:ae.container},void 0,l()("div",{style:ae.leftColumn},void 0,l()(Pe,{handleBack:m,handleClose:D,handleRevert:le,showRevert:E}),l()("div",{style:ae.inputText},void 0,l()(Re,{value:L,focus:!0,store:T,disabled:i,parentSpaceId:r,valueTypes:a.valueTypes,errorRanges:j,handleSaveOnEsc:D},"input")),l()(_e,{infoHelper:oe,cursorEditorInfo:J,parentStore:T,getRecordModel:e.getRecordModel}),Y.length>0&&$?l()(Ee,{errorMessagesWithRange:Y,cursorEditorInfo:J}):n),l()(X,{store:T,context:a,selection:V,cursorEditorInfo:J,cursorEditorInfoRef:te,onChange:R,getRecordModel:e.getRecordModel,setInfoHelper:re}),ie&&l()(Le,{})))}const Pe=d.memo((e=>{let{handleBack:t,handleClose:o,handleRevert:r,showRevert:i}=e;window.__c={n:"FormulaInputHeader"};const a=(0,c.O7)(),s=(0,u.yK)((e=>({headerRow:{display:"flex",color:e.mediumTextColor,flexDirection:"row",padding:"8px 2px 0 12px",position:"sticky",top:0,left:0,flexWrap:"wrap"},headerLeft:{flexGrow:1,fontSize:14,display:"inline-flex",alignItems:"center"},headerTitle:{display:"flex",alignItems:"center"},helpButton:{marginLeft:2,height:20,width:20},revertButton:{marginLeft:2,marginRight:4,height:24,width:24},buttonDone:{alignSelf:"right",marginRight:4,height:24,padding:"0 8px"},commandText:{color:e.mediumInvertedTextColor}})),[]);return l()("span",{style:s.headerRow},void 0,l()("span",{style:s.headerLeft},void 0,t&&l()(N.Z,{isGray:!0,isSmall:!0,icon:S.Z.arrowLeft,onClick:t},void 0,E.default.formatMessage(We.back)),!t&&l()("span",{style:s.headerTitle},void 0,E.default.formatMessage(We.formulaHeader),l()(U.Z,{placement:U.Z.Placement.Top,render:e=>d.createElement(L.Z,n()({},e,{ariaLabel:E.default.formatMessage(We.learnTooltip),icon:S.Z.help,href:(0,_.UY)("guides.formulas"),external:!0,style:s.helpButton})),renderTooltip:()=>E.default.formatMessage(We.learnTooltip)}))),i&&l()(U.Z,{placement:U.Z.Placement.Top,render:e=>d.createElement(L.Z,n()({},e,{ariaLabel:E.default.formatMessage(We.revertTooltip),icon:S.Z.undo,external:!0,style:s.revertButton,onClick:r})),renderTooltip:()=>E.default.formatMessage(We.revert)}),l()(U.Z,{renderTooltip:()=>l()("div",{},void 0,l()("span",{},void 0,l()(x.FormattedMessage,{defaultMessage:"Accept",id:"database.formula.acceptFormulaInput.tooltip"}))," ",l()("span",{style:s.commandText},void 0,k.fg(a).command,"+S")),render:e=>d.createElement(D.Z,n()({onClick:o,style:s.buttonDone},e),E.default.formatMessage(We.done))}))})),Ee=d.memo((e=>{let{errorMessagesWithRange:t,cursorEditorInfo:o}=e;window.__c={n:"FormulaErrorsHelper"};const r=(0,u.yK)((e=>({errors:{display:"flex",flexDirection:"column",gap:6,zIndex:1,fontSize:w.Z.fontSize.UISmall.desktop,padding:"10px 12px",height:"auto",width:"100%",backgroundColor:"light"===e.mode?e.accentColors.red[30]:e.accentColors.red[200],borderTop:`1px solid ${e.outlineButtonBorder}`,position:"sticky",bottom:0,left:0,maxHeight:300},icon:{width:12,height:12,fill:"light"===e.mode?e.accentColors.red[400]:e.accentColors.red[700],display:"inline",marginRight:4},errorHeader:{display:"flex",alignItems:"center",fontSize:12,color:"light"===e.mode?e.accentColors.red[500]:e.accentColors.red[800]}})),[]);return 0===t.length?null:l()("div",{style:r.errors},void 0,l()("div",{style:r.errorHeader},void 0,S.Z.warning(r.icon),E.default.getIntl().formatMessage(We.errorCount,{count:t.length})),t.slice(0,3).map(((e,t)=>l()(Ae,{errorMessageWithRange:e,cursorEditorInfo:o},t))))}));function Ae(e){let{errorMessageWithRange:t,cursorEditorInfo:o}=e;window.__c={n:"FormulaErrorsHelperError"};const{msg:r,range:n}=t,i=void 0!==n&&void 0!==o&&n.startIndex<=o.inputPosition&&o.inputPosition<=n.endIndex,a=(0,u.yK)((e=>({errorMessageWithRange:{fontSize:10,textWrap:"wrap",overflow:"hidden",textOverflow:"ellipsis",color:e.darkTextColor,display:"flex",flexShrink:0},errorMessage:{flexGrow:1,minWidth:0,display:"-webkit-box",textWrap:"wrap",wordBreak:"break-word",overflow:"hidden",lineClamp:3,WebkitLineClamp:3,WebkitBoxOrient:"vertical",color:i?"light"===e.mode?e.accentColors.red[500]:e.accentColors.red[800]:void 0},errorRange:{flexShrink:0,minWidth:0,marginLeft:4}})),[i]);return l()("div",{style:a.errorMessageWithRange},void 0,l()("span",{style:a.errorMessage},void 0,r),void 0!==n&&l()("span",{style:a.errorRange},void 0,`[${n.startIndex}, ${n.endIndex}]`))}const _e=d.memo((e=>{let{infoHelper:t,getRecordModel:o,parentStore:r,cursorEditorInfo:n}=e;const i=t;if(void 0===(null==i?void 0:i.kind))return null;switch(i.kind){case m.WY.Token:return l()(De,{completion:i,getRecordModel:o});case m.WY.LibraryFunction:{const e=!(null==t||!t.calledFromUnifiedFunctionProperty),o=function(e,t){if(t&&void 0!==e.syntax[1])return e.syntax[1];return e.syntax[0]}(i.libraryFunction,e),n=function(e,t){if(t&&void 0!==e.examples[1])return e.examples[1];return e.examples[0]}(i.libraryFunction,e),a=i.libraryFunction.returnType;return l()(Oe,{icon:re("function"==typeof a?a([]).type:a.type),name:o,description:E.default.formatMessage(i.libraryFunction.description),code:n.length>0?n.map(((e,t)=>l()(Be,{example:e,parentStore:r},t))):void 0})}case m.WY.Binding:var a;return i.text===v.GV?l()(Oe,{icon:re(i.type.type),name:i.text,description:E.default.formatMessage(Ge.currentValueDescription)}):l()(Oe,{icon:re(i.type.type),name:i.text,description:E.default.formatMessage("array"===(null==i||null===(a=i.type)||void 0===a?void 0:a.type)?Ge.listVariableType:Ge.variableType)});default:return(0,C.t1)(i)}}));function Be(e){let{example:t,parentStore:o}=e;window.__c={n:"CodeExample"};const r=(0,V.kw)(),n=(0,c.O7)(),i=(0,p.VK)((()=>{var e;return null===(e=B.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),a=(0,u.Fg)(),s=(0,p.VK)((()=>Array.isArray(t.input)?(0,I.IY)({environment:n,textValue:t.input&&{value:t.input,spaceId:i},parentStore:o,disableHover:!1,disableStyleAnnotations:!1,disableLinks:!0,disableDateStyleAnnotations:!1,disabled:!0,theme:a,emojiType:r,katex:void 0,formulaValueTypes:[]}):t.input),[r,n,t.input,o,i,a]),h=(0,p.VK)((()=>Array.isArray(t.output)?(0,I.IY)({environment:n,textValue:t.output&&{value:t.output,spaceId:i},parentStore:o,disableHover:!1,disableStyleAnnotations:!1,disableLinks:!0,disableDateStyleAnnotations:!1,disabled:!0,theme:a,emojiType:r,katex:void 0,formulaValueTypes:[]}):t.output),[r,n,t.output,o,i,a]);return l()(d.Fragment,{},void 0,s," ","＝"," ",h,"\r\n")}function Oe(e){let{name:t,icon:o,description:r,code:n}=e;window.__c={n:"FormulaHelperBody"};const i=(0,u.yK)((e=>({helper:{display:"flex",flexDirection:"column",zIndex:1,fontSize:w.Z.fontSize.UISmall.desktop,padding:"12px 14px",height:"auto",width:"100%",borderTop:`1px solid ${e.outlineButtonBorder}`,position:"sticky",bottom:0,left:0,gap:"6px",overflow:"auto",maxHeight:150},name:{fontWeight:600,display:"flex",alignItems:"center"},description:{color:e.mediumTextColor},code:{fontFamily:"monospace",whiteSpaceCollapse:"preserve",fontSize:11,borderRadius:5,backgroundColor:e.codeBlockBackground,margin:"0 -4px",padding:"6px",pointerEvents:"none"},iconStyle:{height:14,width:14,fill:e.mediumIconColor,display:"inline",marginRight:6}})),[]);return l()("div",{style:i.helper},void 0,l()("span",{style:i.name},void 0,void 0!==o&&o(i.iconStyle),t),void 0!==r&&l()("span",{style:i.description},void 0,r),void 0!==n&&l()("code",{style:i.code},void 0,n))}function De(e){let{completion:t,getRecordModel:o}=e;window.__c={n:"FormulaTokenCompletionHelper"};const r=(0,x.useIntl)(),{name:n,description:i,icon:a}=(0,p.VK)((()=>{if(!o)return{};if(t.token.type===m.Oy.BlockProperty){var e,n;if(m.WG.includes(t.token.property)&&!t.token.collection){var i;const e=null===(i=m.dy[t.token.property])||void 0===i?void 0:i.type,o=e?R.SO[e]:void 0,n=e?h.wG[e]:void 0;return{name:t.name??t.token.property,icon:n,description:e?r.formatMessage(Ge.propertyType,{type:o}):void 0}}if(!t.token.collection)return{};const l=(0,f.SR)(t.token.property),a=o(t.token.collection),s=null==a||null===(e=a.getNormalizedSchema())||void 0===e?void 0:e[l];if(!s)return{};const d=s.name,c=s.type?h.wG[s.type]:void 0,p=s.type?R.SO[s.type]:void 0;return{name:d,icon:c,description:"person"===s.type||"relation"===s.type||"multi_select"===s.type||"file"===s.type||"formula"===s.type&&"v2"===s.version&&"array"===(null===(n=s.formula2)||void 0===n||null===(n=n.result_type)||void 0===n?void 0:n.type)||"rollup"===s.type&&("show_unique"===s.aggregation||void 0===s.aggregation)?r.formatMessage(Ge.listPropertyType,{type:p}):r.formatMessage(Ge.propertyType,{type:p})}}return{}}),[t,o,r]);return void 0===n?null:l()(Oe,{name:n,icon:a,description:i})}const Le=d.memo((()=>{window.__c={n:"FormulaUpdateFooter"};const e=(0,c.O7)(),t=(0,d.useCallback)((()=>{const t=B.default.state.currentUserSettingsStore;t&&Z.createAndCommit({userAction:"TutorialActions.dismissTutorial",environment:e,perform:e=>{T.d2({userSettingsStore:t,transaction:e,data:{dismissed_formulas2_footer:!0}})},userId:t.id,canUndo:!1})}),[e]),o=(0,u.yK)((e=>({updateBanner:{zIndex:1,position:"absolute",alignSelf:"flex-end",justifySelf:"flex-end",bottom:0,display:"flex",flex:"none",alignItems:"center",fontSize:w.Z.fontSize.UISmall.desktop,paddingLeft:8,paddingRight:8,minHeight:30,height:"auto",width:"100%",color:e.mediumTextColor,borderTop:`1px solid ${e.outlineButtonBorder}`},messageText:{flexGrow:1},icon:{width:14,height:14,marginRight:2,color:e.blueColor},dismissButton:{marginLeft:2,borderRadius:"100%"},iconCloseStyle:{width:12,height:12}})),[]);return l()("div",{style:o.updateBanner},void 0,S.Z.mobileNewFeatures(o.icon),l()(G.Z,{href:(0,_.UY)("guides.formulas"),external:!0,style:o.messageText},void 0,E.default.formatMessage(We.learnMoreFooter)),l()(L.Z,{ariaLabel:E.default.formatMessage(We.learnMoreFooter),style:o.dismissButton,onClick:t,icon:S.Z.close}))}));const We=(0,x.defineMessages)({learnMoreFooter:{id:"formula2Input.learnMore.button.label",defaultMessage:"We've recently updated our formula language! Learn more."},back:{defaultMessage:"Back",id:"formulas.SimpleFormulaValuePicker.back"},formulaHeader:{id:"formula2Input.NotionFormula",defaultMessage:"Notion Formula"},done:{id:"formula2Input.done",defaultMessage:"Done"},learnTooltip:{id:"formula2Input.learnAboutFormulas",defaultMessage:"Learn about formulas!"},revert:{id:"formula2Input.revert",defaultMessage:"Revert"},revertTooltip:{id:"formula2Input.revertTooltip",defaultMessage:"Revert to previous formula"},errorCount:{id:"formula2Input.errorCount",defaultMessage:"{count, plural, one {{count} error} other {{count} errors}}"}}),Ge=(0,x.defineMessages)({currentValueDescription:{id:"formula2Input.helperText.currentValueDescription",defaultMessage:"Returns the current value in the list."},propertyType:{id:"formula2Input.propertyHelper.description",defaultMessage:"{type} property."},listPropertyType:{id:"formula2Input.propertyHelper.descriptionWithList",defaultMessage:"{type} property, list."},variableType:{id:"formula2Input.variableHelper.description",defaultMessage:"User-defined variable."},listVariableType:{id:"formula2Input.variableHelper.descriptionWithList",defaultMessage:"User-defined variable, list."},emailForUser:{id:"formula2Input.helperText.emailForUser",defaultMessage:"Returns the email address of a provided user."},nameForUser:{id:"formula2Input.helperText.nameForUser",defaultMessage:"Returns the display name of a provided user."}})},21396:(e,t,o)=>{o.d(t,{e:()=>p,F:()=>u});var r=o(10434),n=o.n(r),i=(o(21703),o(67294)),l=o(24405),a=o(84116),s=o(53397),d=o(97880),c=o(93044);function p(e){if(e.kind===a.yp.ContextValue)return e.name;if(e.kind===a.yp.Binding||e.kind===a.yp.ThisRow)throw new Error("Not implemented yet.");(0,d.t1)(e)}function u(e){window.__c={n:"FormulaValueToken"};const{value:t}=e,o=(0,l.Fg)(),r=p(t);let a,d;if("date"===t.type.type?a=s.Z.typesDate:"person"===t.type.type?a=s.Z.typesPerson:("block"===t.type.type||"array"===t.type.type&&"block"===t.type.of.type)&&(a=s.Z.collectionSearch),a){const e=a;d=()=>e({width:12,height:12,marginRight:4})}return i.createElement(c.ZP,n()({},e,{title:r,renderAvatar:d,shouldShrink:!0,style:{background:o.outlineBlueButtonPressedBackground,color:o.blueColor,padding:"0 4px"}}))}},5971:(e,t,o)=>{o.d(t,{E:()=>i});var r=o(81954),n=o(10161);function i(e){return(0,r.VK)((()=>n.default.checkGate(e)),[e])}}}]);