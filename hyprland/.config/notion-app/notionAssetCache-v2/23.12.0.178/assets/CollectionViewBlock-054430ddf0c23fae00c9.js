"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[3190],{26797:(e,t,o)=>{o.d(t,{JN:()=>b,f$:()=>w,td:()=>x,fX:()=>k,cQ:()=>P,Fv:()=>T,xD:()=>R,QG:()=>I});o(57658);var r=o(96486),i=o.n(r),n=o(17126),s=o(80951),l=o(40506),a=o(53877),c=o(42875),d=o(6287),h=o(97880),p=o(95802),u=o(15723),m=o(17746),g=o(68216),S=o(49865),v=o(25498),y=o(42239),f=o(19785),C=o(9953);function b(e){const{environment:t,droppedStores:o,collectionStore:r,duplicate:i,calendarBy:h,transaction:p,results:u,collectionContextStore:m}=e,g=n.ou.fromMillis(e.startOfDay);let v=!0;for(const n of o){if(n.getParentTable()===d.v){v=!1;break}f.zw({childStore:n,parentStore:r,transaction:p})||(v=!1)}const C=y.LQ({environment:t,droppedStores:o,duplicate:i,transaction:p,resolveTemplateVariables:!1});for(const n of C){const e=n.getPropertyStore(h),o=s.Gl(e.getValue())||a.Lg((0,c.r)()),i=a.c$(o,(0,c.r)()),d=g.toFormat(a.Iq);let y;if("date"===i.type||"datetime"===i.type)y={...i,start_date:d};else{const e=a.NK(i,(0,c.r)());if(!e.end)return;const t={...i,start_date:d},o=a.NK(t,(0,c.r)()).start.diff(e.start,"days"),r=e.end.plus(o).toFormat(a.Iq);y={...i,start_date:d,end_date:r}}const f=a.c$(y,l.yw(o)||(0,c.r)());S.mp({environment:t,store:n,collectionStore:r,collectionContextStore:m,coerce:!0,groupsPointer:[],results:u,transaction:p,alreadyMovedToCollection:v}),R({environment:t,type:"dateValue",propertyId:h,store:n,transaction:p,dateValue:f})}}function w(e){const{calendarStore:t,direction:o,target:r}=e;t.setState({...t.state,isDragging:!0,target:r,direction:o})}function x(e){const{calendarStore:t,x:o,y:r,calendarBy:d}=e,h=t.state;if(h.isDragging){const e=s.Gl(h.target.getPropertyStore(d).getValue());if(!e)return;const g=a.c$(e,(0,c.r)()),S=h.temporaryValue||e,v=a.c$(S,(0,c.r)()),y=[];h.dayStoreMap.forEach(((e,t)=>{y.push({store:e,timestamp:t})}));const f=y.find((e=>{let{store:t}=e;const i=p.C.getRectFromStore(t);return Boolean(i&&u.uh(i,o,r))}));let C;if(f){const e=n.ou.fromMillis(f.timestamp),t=e.endOf("day"),o=e.toFormat(a.Iq);if(g){const r=a.NK(g,(0,c.r)());if(h.direction===m.t.Left)if(n.Xp.fromDateTimes(e,t).contains(r.start))C=g;else{let e;e="datetimerange"===g.type||"daterange"===g.type?{...g,start_date:o,end_date:g.end_date}:"datetime"===g.type?{type:"datetimerange",start_date:o,start_time:g.start_time,end_date:g.start_date,end_time:g.start_time,time_zone:g.time_zone,reminder:g.reminder}:{type:"daterange",start_date:o,end_date:g.start_date,reminder:g.reminder};const t=a.NK(e,(0,c.r)());C=!r.end&&t.start>r.start||r.end&&t.start>r.end?v:e}else if(r.end?n.Xp.fromDateTimes(e,t).contains(r.end):n.Xp.fromDateTimes(e,t).contains(r.start))C=g;else{let e;e="date"===g.type?{...g,type:"daterange",end_date:o}:"datetime"===g.type?{...g,type:"datetimerange",end_date:o,end_time:"00:00"}:{...g,end_date:o};const t=a.NK(e,(0,c.r)());C=t.end&&t.end<t.start?v:e}}}if(C&&!i().isEqual(v,C)){const e=a.c$(C,l.yw(S)||(0,c.r)());t.setState({...h,temporaryValue:e})}}}function k(e){const{environment:t,calendarStore:o,calendarBy:r,transaction:i}=e,n=o.state;n.isDragging&&n.temporaryValue&&(R({type:"dateValue",environment:t,dateValue:n.temporaryValue,propertyId:r,store:n.target,transaction:i}),o.setState({...o.state,isDragging:!1}))}function P(e){const{calendarStore:t}=e,o=t.state;o.isDragging&&t.setState({...o,isDragging:!1})}function T(e){const{environment:t,store:o,collectionStore:r,collectionContextStore:i,startDayOfWeek:l,results:d,transaction:h}=e,p=i.dateRangeStart.state,u=(0,c.r)(),m=i.normalizedQueryStore.state;if(!m||!m.calendar_by)return;const g=m.calendar_by,v=a.gQ(p,l,u),y=v.startOf("month"),f=v.endOf("month"),b=n.ou.now().startOf("day");let w;return w=n.Xp.fromDateTimes(y,f).contains(b)?a.hT(b.valueOf(),u):a.hT(a.em(p,l,u).valueOf(),u),C.sW({store:o.getPropertiesStore(),data:{[g]:s.d7(w)},transaction:h}),S.mp({environment:t,store:o,collectionStore:r,collectionContextStore:i,coerce:!0,results:d,groupsPointer:[],transaction:h}),o}function R(e){const{environment:t,store:o,propertyId:r,transaction:i}=e;let n;"timestamp"===e.type?n=a.hT(e.timestampMs.valueOf(),(0,c.r)()):"dateValue"===e.type?n=e.dateValue:(0,h.t1)(e);const l=o.getPropertyValue(r),d=s.d7(n);C.sW({store:o.getPropertiesStore(),data:{[r]:d},transaction:i}),v.H({environment:t,store:o,dateProperty:{id:r,oldValue:l,newValue:d}})}function I(e){const{environment:t,collectionStore:o,calendarBy:r,store:i,insertStores:n,results:s,collectionContextStore:l,transaction:a}=e,c=i.getPropertyStore(r).getValue();for(const d of n)S.mp({environment:t,store:d,collectionStore:o,collectionContextStore:l,coerce:!0,groupsPointer:[],results:s,transaction:a}),C.sO({store:d.getPropertyStore(r),value:c,transaction:a});return n.map((e=>g.G.createChildStore(o,e.pointer)))}},34481:(e,t,o)=>{o.r(t),o.d(t,{default:()=>bc});var r=o(10434),i=o.n(r),n=o(23174),s=o.n(n),l=(o(21703),o(96486)),a=o.n(l),c=o(67294),d=o(73935),h=o(83355),p=o(1302),u=o(6740),m=o(49085),g=o(15145),S=o(23482),v=o(42509),y=o(53397),f=o(15157),C=o(44615),b=o(21202),w=o(13493),x=o(82990),k=o(51454),P=o(5366),T=o(50906),R=o(54642),I=o(51127),M=o(26797),B=o(77162),V=o(49865),F=o(5149),D=o(98834),E=o(64434),A=o(32603),_=o(80528),Z=o(52989),L=o(5978),O=o(61045),G=o(87531),H=o(24677),z=o(98104),N=o(12359),W=o(66890),K=o(66213),U=o(28020),$=o(93959),q=o(43250),Q=o(97004),Y=o(70764),j=o(75079),X=o(68641),J=o(65742),ee=o(78316),te=o(73744),oe=o(84210),re=o(12534),ie=o(33929),ne=o(10663),se=o(39500),le=o(77546),ae=o(45094),ce=o(77907),de=o(2688),he=o(29987),pe=o(34859),ue=o(79315),me=o(61766),ge=o(4926),Se=o(63725),ve=o(58421),ye=o(7095),fe=o(88632),Ce=o(10161),be=o(30874),we=o(96049),xe=o(28209),ke=o(77144),Pe=o(31792),Te=o(19671),Re=o(82136),Ie=o(85844),Me=o(13023),Be=o(88923),Ve=o(68216),Fe=o(29026),De=o(77794),Ee=o(2834),Ae=o(14714),_e=o(97058),Ze=o(71644),Le=o(96802),Oe=o(90833);function Ge(e){const{collectionContextStore:t,groupsPointer:o}=e,r=t.shouldShowSpinner.state,i="load_general"===t.loadingDetails.state.type||"load_more_blocks"===t.loadingDetails.state.type&&a().isEqual(t.loadingDetails.state.group,o);return r&&i&&Ne()}function He(e){const{collectionContextStore:t,isForSubgroups:o}=e,r=o?"load_more_subgroups":"load_more_groups";return t.isLoading.state&&t.loadingDetails.state.type===r&&Ne()}function ze(e){const{collectionContextStore:t,groupsPointer:o}=e;return t.shouldShowSpinner.state&&"load_more_blocks"===t.loadingDetails.state.type&&a().isEqual(t.loadingDetails.state.group,o)&&Ne()}function Ne(){return"on"===Ce.default.getEligibleGroup({experimentId:"collections_loading_state",defaultGroup:"control"})}var We=o(17504),Ke=function(e){return e[e.Top=0]="Top",e[e.Bottom=1]="Bottom",e}(Ke||{});const Ue=Ke;var $e=o(21325),qe=o(17311),Qe=(o(57658),o(2032)),Ye=o(14248),je=o(42875),Xe=o(47853),Je=o(16187),et=o(87279),tt=o(98742),ot=o(75498),rt=o(52275),it=o(31945),nt=o(78140),st=o(32163),lt=o(40721),at=o(89728),ct=o(44532),dt=o(72495),ht=o(58032),pt=o(95030);class ut extends h.Z{constructor(){super(...arguments),this.renderMenu=e=>{const{device:t}=this.environment;let o;return o=t.isMobile?{menuType:et.og.Modal,title:s()(P.FormattedMessage,{defaultMessage:"Aggregation",id:"database.mobileBoardAggregationMenu.title"}),right:s()(lt.DoneMenuText,{}),onClickRight:e.close}:{menuType:et.og.Popup,width:200},c.createElement(nt.Z,o,s()(st.Z,{type:st.i.Vertical,initialFocus:0,sections:[{key:"aggregation section",render:e=>c.createElement(dt.Z,e),items:this.getAggregationActions()}],onAccept:e.close}))},this.handleChangeAggregation=e=>{const{onChange:t,collectionContextStore:o}=this.props;t(e),B.wd({environment:this.environment,collectionContextStore:o,action:"board_change_aggregation"})},this.renderAggregationMenuItem=(e,t,o)=>{const r=Je.Sn[e];return s()(ht.Z,{placement:ct.GI.Placement.Right,delayThreshold:0,render:e=>c.createElement(rt.Z,i()({title:t},(0,tt.Z)(e,o))),renderTooltip:()=>s()("div",{style:{width:140,whiteSpace:"normal"}},void 0,r&&s()("img",{src:(0,Xe.D)(r),style:{borderRadius:3,width:140,marginTop:4}}),Je.BG[e])},o.key)},this.reducerStore=this.createComputedStore((()=>{const{aggregation:e,schema:t,groupFormat:o}=this.props;if(e){return{type:"aggregation",filter:(0,Ye.zk)({schema:t,group:o,timeZone:(0,je.r)()}),aggregation:e}}}))}renderComponent(){const{device:e}=this.environment;return s()(ht.Z,{renderTooltip:()=>this.renderTooltipText(),render:t=>s()(it.ZP,{popupType:e.isMobile?it.Z4.SlideUp:it.Z4.Popup,renderOrigin:e=>c.createElement(at.Z,i()({disabled:this.props.disabled,style:{fontWeight:x.Z.fontWeight.regular,color:this.props.color||this.theme.lightTextColor,paddingTop:4,paddingBottom:4,height:void 0,lineHeight:void 0}},(0,tt.Z)(t,e)),this.renderValue()),disabled:this.props.disabled,render:this.renderMenu})})}renderTooltipText(){const{aggregation:e,schema:t}=this.props;if(e){const o=Je.VN[(0,Qe.OV)(e)];if((0,Qe.pK)(e)){const r=t[e.property];if(r){return`${o} in ${r.name}`}}return o}return s()(P.FormattedMessage,{defaultMessage:"Aggregate",id:"database.boardAggregation.tooltip"})}renderValue(){const{schema:e,aggregation:t,collectionContextStore:o,groupFormat:r}=this.props,i=this.reducerStore.state;if(t&&i)return s()(ot.Z,{id:`board:${(0,Ae.mD)(r)}`,collectionContextStore:o,reducer:i,groupsPointer:[r],render:o=>{const r=o.state;if(!r||"aggregation"!==r.type)return;let i;if((0,Qe.pK)(t)){const o=e[t.property];!o||"formula"!==o.type&&"number"!==o.type||(i=o.number_format)}return(0,Je.Ol)({numberFormat:i,dateFormat:void 0,aggregationType:t.aggregator,userTimeZone:(0,je.r)(),value:r.aggregationResult,roundDecimal:5})}})}getAggregationActions(){const e=[];for(const n of Qe.o5)e.push(this.createCountAggregationAction(n));const t=this.getDefaultProperties();if(t.length>0)for(const n of Qe.Sy)"show_unique"!==n&&e.push(this.getAggregationGroupAction(n,t));const o=this.getNumericProperties();if(o.length>0)for(const n of Qe.k$)e.push(this.getAggregationGroupAction(n,o));const r=this.getDateProperties();if(r.length>0)for(const n of Qe.f8)e.push(this.getAggregationGroupAction(n,r));const i=this.getCheckboxProperties();if(i.length>0)for(const n of Qe.gC)e.push(this.getAggregationGroupAction(n,i));return e}getAggregationGroupAction(e,t){const{device:o}=this.environment,r=Je.VN[e],n=a().compact(t.map((t=>this.createPropertyAggregationAction(t,e))));return{key:e+r,render:(e,t)=>c.createElement(pt.Z,i()({},e,{onFocus:t.onFocus,renderOrigin:(e,t)=>c.createElement(rt.Z,i()({},e,{ref:t,title:r})),renderExtension:(e,i)=>{let l;return l=o.isMobile?{menuType:et.og.Modal,title:r,right:s()(lt.DoneMenuText,{}),onClickRight:i.close,...e}:{menuType:et.og.Popup,width:200,...e},c.createElement(nt.Z,l,s()(st.Z,{type:st.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>c.createElement(dt.Z,e),items:n}],onAccept:t.onAccept}))}})),action:()=>null}}getDefaultProperties(){const{schema:e}=this.props;return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Qe.iV)(o)&&!("rollup"===o.type&&"status"===o.target_property_type)}))}getNumericProperties(){const{schema:e}=this.props;return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Qe.O4)(o)}))}getDateProperties(){const{schema:e}=this.props;return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Qe.dN)(o)}))}getCheckboxProperties(){const{schema:e}=this.props;return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Qe.Mv)(o)}))}createCountAggregationAction(e){const t=Je.VN[e];return{key:e,render:o=>this.renderAggregationMenuItem(e,t,o),action:()=>{this.handleChangeAggregation({aggregator:e})}}}createPropertyAggregationAction(e,t){const o=this.props.schema[e];if(!o)return;const r=o.name;return{key:`${e} ${t}`,render:e=>this.renderAggregationMenuItem(t,r,e),action:()=>{this.handleChangeAggregation({aggregator:t,property:e})}}}}ut.displayName="BoardAggregation";const mt=ut;var gt=o(70203);function St(e){const{transaction:t,environment:o,resultsStore:r,collectionContextStore:i,isFullScreen:n,groupsPointer:s,insertAtIndex:l,from:a,transient:c}=e;i.searchQuery.state&&E.Ug({searchQuery:"",collectionContextStore:i,isFullScreen:n});const{coercionSucceeded:d,newStore:h}=V.IW({environment:o,collectionContextStore:i,groupsPointer:s,results:r.state,insertAtIndex:l||r.state.length,coerce:!0,initializeDefaultTemplate:!0,transaction:t,from:a});if(o.device.isMobile)L.navigateToBlock({environment:o,store:h,pageVisitSource:g.tY.Create});else if(d){const e=h.getBlockTitleStore();H.eP({environment:o,store:h}),z.NX({store:e}),E.Z5({store:h,transient:c})}else L.peekBlock({environment:o,store:h,peekMode:(0,ee.kr)(i.collectionViewStore()),resultsStore:r,collectionContextStore:i,pageVisitSource:g.tY.Create});T.W2j(o,{from:a,type:"page",new_page_id:h.id,...(0,j.Pn)(i)})}var vt=o(52821);class yt extends h.Z{constructor(){super(...arguments),this.handleClick=()=>{var e;const{collectionContextStore:t,isFullScreen:o,groupsPointer:r}=this.props,i=null===(e=t.groupsStore.getGroupState(r))||void 0===e?void 0:e.resultsStore;i&&"collectionTypedView"!==t.contextType&&$e.M_(this.environment)&&t.collectionStore()&&N.createAndCommit({userAction:"BoardGroupAddItemButton.handleClick",environment:this.environment,perform:e=>{St({transaction:e,environment:this.environment,resultsStore:i,collectionContextStore:t,isFullScreen:o,groupsPointer:r,from:"board_group_add_item_bottom",transient:!1})}})}}renderComponent(){const e=this.theme.lightTextColor;return s()(at.Z,{icon:t=>y.Z.plus({...t,fill:this.props.color||e}),isLightGray:!0,isLarge:!0,style:{width:"100%",color:this.props.color||e},onClick:this.handleClick,onMouseDown:re.$0},void 0,s()(P.FormattedMessage,{defaultMessage:"New",id:"database.boardView.addItemButtonTitle"}))}}yt.displayName="BoardGroupAddItemButton";const ft=yt;o(67635);var Ct=o(99036),bt=o(6695),wt=o(93286),xt=o(6404),kt=o(51365),Pt=o(9953),Tt=o(49616),Rt=o(68056),It=o(65598),Mt=o(19511),Bt=o(22294),Vt=o(27724),Ft=o(24666),Dt=o(87636),Et=o(27531),At=o(41432),_t=o(80951),Zt=o(95538),Lt=o(35328),Ot=o(6890),Gt=o(71669),Ht=o(81865);function zt(e){return"number"==typeof e}class Nt extends h.Z{constructor(){super(...arguments),this.renderContentBlock=e=>{const{store:t}=this.props,o=Ve.G.createChildStore(t,{table:b.iU,id:e}),r=(0,Ot.h)(o);if(r)return s()(Et.D,{value:this.restrictedContentStore},void 0,s()(r,{store:o,disabled:!0,disableCommentMenu:!0,disableHoverMenu:!0,hideContent:(0,Lt.BX)(o),style:{fontSize:12,opacity:.8,pointerEvents:"none"},isQuickFind:!0,numberedListCounterStore:this.createComputedStore((()=>({depth:0,numberedListBlockIdsWithFormat:this.createNumberedListCounterStore(e)})))},e))},this.coverStore=this.createComputedStore((()=>{const{store:e}=this.props,t=(0,ee.NU)(e);return t.image?t.image:t.blockIds})),this.restrictedContentStore=this.createComputedStore((()=>{const{store:e}=this.props,t=(0,ee.wK)(e);return t.image?void 0:t.blockIds})),this.numberedLists=this.createComputedStore((()=>{const{store:e}=this.props,t=this.coverStore.state,o=[];if(a().isArray(t)){let r=0;for(;r<t.length;){let i=t[r],n=Ve.G.createChildStore(e,{table:b.iU,id:i});if(n.getType()===At.Ti.numberedList){const s=[{blockId:i,idx:1}],l=[{id:i,format:void 0,depth:s.length-1,index:s[0].idx}];for(r+=1;r<t.length&&(i=t[r],n=Ve.G.createChildStore(e,{table:b.iU,id:i}),n.getType()===At.Ti.numberedList);){{const e=n.getParentId();if(n.getParentId()===s[s.length-1].blockId)s.push({blockId:i,idx:1});else{let t=s[s.length-1].idx;for(;s.length>0&&s[s.length-1].blockId!==e;)t=s[s.length-1].idx,s.pop();s.push({blockId:i,idx:t+1})}l.push({id:i,format:void 0,depth:s.length-1,index:s[s.length-1].idx})}r+=1}o.push(l)}else r+=1}}return o}))}didUpdate(e){this.props.coverFormat.type!==e.coverFormat.type&&this.props.onLoadProxiedImage()}renderComponent(){const{coverFormat:e}=this.props;return"page_cover"===e.type?this.renderPageCover():"page_content"===e.type?this.renderPageContent():"property"===e.type?this.renderProperty(e.property):void 0}renderPageCover(){var e;const{store:t}=this.props,o=null===(e=t.getCover())||void 0===e?void 0:e.cover;return o?s()("div",{style:this.getImageCoverWrapStyle()},void 0,s()(Ht.Z,{url:o,isAuthenticated:!0,permissionRecord:this.props.store.pointer,width:this.getCoverWidth(),onFinishedLoadingProxyUrl:e=>this.props.onLoadProxiedImage(e),render:(e,t)=>{if(t)return s()(Gt.Z,{style:{...this.getImageStyle(),...this.getCoverStyle(),...this.getCoverAspectStyle(),objectPosition:`center ${100*(1-this.imagePosition)}%`},src:t})}}),this.renderImageBorder()):this.props.isGallery?this.renderEmptyGalleryCover():void 0}renderPageContent(){const e=this.coverStore.state,t=this.restrictedContentStore.state;if(e){if(!a().isArray(e))return s()("div",{style:this.getImageCoverWrapStyle()},void 0,s()(Ht.Z,{url:e.url,onFinishedLoadingProxyUrl:e=>this.props.onLoadProxiedImage(e),isAuthenticated:!0,permissionRecord:e.pointer,width:this.getCoverWidth(),render:(e,t)=>{if(t)return s()(Gt.Z,{style:{...this.getImageStyle(),...this.getPageContentImageStyle(),...this.getCoverAspectStyle(),objectPosition:`center ${100*(1-this.imagePosition)}%`},src:t})}}),this.renderImageBorder());if(e.length>0)return s()("div",{style:this.getContentWrapStyle()},void 0,t?e.filter((e=>t.indexOf(e)>=0)).map(this.renderContentBlock):e.map(this.renderContentBlock));if(this.props.isGallery)return this.renderEmptyGalleryCover()}else if(this.props.isGallery)return this.renderEmptyGalleryCover()}renderProperty(e){const{store:t}=this.props,o=(0,_t.g)(t.getPropertyValue(e)).find((e=>(0,Zt.SR)({url:e.url})));return o?s()("div",{style:this.getImageCoverWrapStyle()},void 0,s()(Ht.Z,{onFinishedLoadingProxyUrl:e=>this.props.onLoadProxiedImage(e),url:o.url,isAuthenticated:!0,permissionRecord:this.props.store.pointer,width:this.getCoverWidth(),render:(e,t)=>{if(t)return s()(Gt.Z,{style:{...this.getImageStyle(),...this.getCoverStyle(),...this.getCoverAspectStyle(),objectPosition:`center ${100*(1-this.imagePosition)}%`},src:t})}}),this.renderImageBorder()):this.props.isGallery?this.renderEmptyGalleryCover():void 0}renderEmptyGalleryCover(){return s()("div",{style:{height:this.getCoverHeight()}})}renderImageBorder(){return s()("div",{style:{position:"absolute",left:0,right:0,bottom:0,borderBottom:`1px solid ${this.theme.regularDividerColor}`}})}get imagePosition(){const{coverPosition:e,store:t}=this.props;if(zt(e))return e;if(t.getFormatStore().isDefined()){const{page_cover_position:e,card_cover_position:o}=t.getFormat();if(zt(o))return o;if(zt(e))return e}return.5}createNumberedListCounterStore(e){const t=this.numberedLists.state;for(const o of t)if(o.find((t=>t.id===e)))return o;return[]}getImageStyle(){return this.props.style||{}}getCoverHeight(){const{coverHeight:e,coverSizeFormat:t}=this.props;if(e)return e;switch(t){case"large":return qe.Z.card.desktop.large.height;case"small":return qe.Z.card.desktop.small.height;case"medium":default:return qe.Z.card.desktop.medium.height}}getCoverWidth(){const{coverWidth:e,coverSizeFormat:t}=this.props;if(e)return e;switch(t){case"large":return qe.Z.card.desktop.large.width;case"small":return qe.Z.card.desktop.small.width;case"medium":default:return qe.Z.card.desktop.medium.width}}getImageCoverWrapStyle(){return{height:this.getCoverHeight(),position:"relative",pointerEvents:"none",overflow:"hidden"}}getContentWrapStyle(){const{ThemeStore:e}=this.environment,t="dark"===e.state.mode;return{height:this.getCoverHeight(),pointerEvents:"none",overflow:"hidden",background:this.theme.collectionGalleryPreviewCardCover,boxShadow:t?"transparent":`inset 0 -1px 0 0 ${this.theme.regularDividerColor}`,padding:"8px 8px 0"}}getCoverStyle(){return{width:"100%",height:this.getCoverHeight(),objectPosition:"center",borderRadius:0,borderTopLeftRadius:1,borderTopRightRadius:1}}getCoverAspectStyle(){const{coverAspectFormat:e}=this.props;return{objectFit:void 0===e?"cover":e}}getPageContentImageStyle(){return{...this.getCoverStyle(),objectPosition:"center center"}}}Nt.displayName="CollectionItemCover";const Wt=Nt;var Kt=o(16790),Ut=o(78030),$t=o(64203),qt=o(64921),Qt=o(3386),Yt=o(84076),jt=o(31278),Xt=o(41714),Jt=o(65187),eo=o(25155);const to=(0,P.defineMessages)({untitledBlock:{defaultMessage:"Untitled",id:"collectionViewCardItem.untitledBlock"},typeAName:{defaultMessage:"Type a name…",id:"collectionViewCardItem.itemName.placeholder"}});class oo extends Ee.Z{constructor(){super(...arguments),this.lastProxiedUrl=void 0,this.storeTypes={mouseStore:Pe.Z,editModeStore:m.default},this.renderControl=e=>{let{isVisible:t,isRepositioning:o,handleCancelClick:r,handleRepositionClick:n,handleSavePositionClick:l}=e;const{store:a,coverFormat:d,coverAspectFormat:h,collectionContextStore:p}=this.props,{device:u}=this.environment,{isMobile:m}=u,g=this.lastProxiedUrl&&d&&"contain"!==h,S=p.permissionScopes.state,v=a.canEdit()&&("collectionTypedView"===p.contextType||S.canEditContent);if(t&&!this.shouldShowActionButton.state)return;const f=Be.default.state.open&&Be.default.state.target.id===a.id,C=ee.kr(null==p?void 0:p.collectionViewStore()),b=(0,Tt.X9)(C,!1);return s()(Dt.Z,{isVisible:t,position:"top"},void 0,g&&!o&&!m&&s()(qt.Z,{style:Xt.Z.actionButtonStyle,onClick:e=>n(e,this.lastProxiedUrl)},void 0,s()(P.FormattedMessage,{defaultMessage:"Reposition",id:"collectionViewCardItem.action.reposition"})),g&&o&&!m&&s()(qt.Z,{style:Xt.Z.actionButtonStyle,onClick:l},void 0,s()(P.FormattedMessage,{defaultMessage:"Save position",id:"collectionViewCardItem.action.savePosition"})),g&&o&&!m&&s()(qt.Z,{style:Xt.Z.actionButtonStyle,onClick:r},void 0,s()(P.FormattedMessage,{defaultMessage:"Cancel",id:"collectionViewCardItem.action.cancel"})),this.shouldShowEditButton.state&&v&&!this.normalizedCardSelectionStore.state&&!S.isSyncedCollection&&s()(ht.Z,{renderTooltip:()=>s()(P.FormattedMessage,{defaultMessage:"Edit",id:"collectionCardItem.edit.tooltip"}),render:e=>c.createElement(qt.Z,i()({style:Xt.Z.actionButtonStyle,onClick:()=>{this.handleEditButtonClick("click")}},e),y.Z.pencil({width:16,height:16}))}),this.normalizedCardSelectionStore.state&&!f&&s()(ht.Z,{renderTooltip:()=>b.tooltip,render:e=>c.createElement(qt.Z,i()({style:Xt.Z.actionButtonStyle,onClick:()=>{this.peekUrl.state&&(L.navigate({environment:this.environment,url:this.peekUrl.state}),this.disallowEmptyDelete())}},e),b.icon({width:14,height:14}))}),!o&&s()(ht.Z,{renderTooltip:()=>s()(P.FormattedMessage,{defaultMessage:"Rename, delete, move to and more…",id:"collectionViewCardItem.repositionAction.tooltip"}),render:e=>c.createElement(qt.Z,i()({style:Xt.Z.actionButtonStyle,onClick:this.handleActionButtonClick},e),y.Z.dots({width:14,height:14}))}))},this.renderProperty=e=>{const{store:t,disabled:o,blockPropertyValueOverlayStore:r,collectionContextStore:i}=this.props,n=t.getAssociatedCollectionStore();if(!n)return;const l=this.normalizedCardSelectionStore.state,a="gallery"===this.getViewType()?Ut.C.GalleryView:Ut.C.Board;return s()(Kt.Z,{store:t,property:e,disabled:o||!t.canEdit(),locked:i.permissionScopes.state.isLocked,format:a,tableWrap:!1,blockPropertyValueOverlayStore:r,collectionStore:n,showIfEmpty:l,onEnter:this.handleBlockPropertyEsc,onEsc:this.handleBlockPropertyEsc,onBgClick:this.handleBlockPropertyEsc,onTab:this.handleBlockPropertyTab,onUntab:this.handleBlockPropertyUntab,collectionViewStore:this.props.collectionContextStore.collectionViewStore()},e)},this.renderDiscussionIndicator=()=>{const{store:e}=this.props,t=It.Xp(e,{recursivelyLoadAllDiscussions:!1});if(t>0)return s()("div",{style:this.getDiscussionIndicatorWrapStyle()},void 0,y.Z.speechBubble({width:14,height:14,marginRight:4,fill:this.theme.mediumIconColor}),t)},this.handleFlushTemporaryPosition=e=>{let{imagePosition:t,reset:o}=e;N.createAndCommit({userAction:"CollectionViewCardItem.handleFlushTemporaryPosition",environment:this.environment,perform:e=>{Le.bf({store:this.props.store,coverPosition:t,transaction:e}),o()}})},this.handleBlockEnter=()=>{const{store:e,onTextEnter:t}=this.props;t&&t(e)},this.handleBlockSpace=()=>{this.handleEditButtonClick("space")},this.handleEditButtonClick=e=>{const{store:t,collectionContextStore:o}=this.props,{editModeStore:r}=this.stores,i=(0,vt.JI)(t);H.eP({environment:this.environment,store:t}),p.default.afterNextFlush((()=>{z.NX({store:i})})),E.Z5({store:t}),e&&T.sdb(this.environment,"board_item_edit_mode_enter",{...(0,j.Pn)(o),block_id:t.id,from:e,view_type:this.getViewType()}),r.setState("existing")},this.handleClick=e=>{this.normalizedCardSelectionStore.state?e.preventDefault():(this.props.handleOpenPeekPage(),this.disallowEmptyDelete())},this.handleActionButtonClick=e=>{const{collectionContextStore:t}=this.props;H.Ys({environment:this.environment,store:this.props.store}),xt.Qn({environment:this.environment,stores:Vt.default.state.stores,left:e.clientX,top:e.clientY,showInput:!0,actions:wt.Qi,analyticsFrom:"block_more_menu",optionalAnalyticsProperties:{collectionContextStore:t}})},this.handleTextEnter=()=>{const{store:e,onTextEnter:t,onTextEsc:o,collectionContextStore:r}=this.props,{editModeStore:i}=this.stores;E.MO(),z.ZH(this.environment);e.canEdit()&&r.permissionScopes.state.canEditContent&&("new_empty"===i.state?o(e):"new"===i.state?t(e):H.Ys({environment:this.environment,store:e}),this.disallowEmptyDelete())},this.handleTextEsc=()=>{const{store:e,onTextEsc:t,collectionContextStore:o}=this.props,{editModeStore:r}=this.stores;E.MO();e.canEdit()&&o.permissionScopes.state.canEditContent&&("new_empty"===r.state?t(e):H.Ys({environment:this.environment,store:e}),this.disallowEmptyDelete())},this.handleTextTab=()=>{const{store:e,blockPropertyValueOverlayStore:t}=this.props,o=this.getShowProperties();o.length>0&&kt.bA({environment:this.environment,blockPropertyValueOverlayStore:t,store:e,property:o[0],format:Ut.C.Page,collectionContextStore:this.props.collectionContextStore}),this.disallowEmptyDelete()},this.handleTrackTitlePropertyEdit=()=>{const e=this.getViewType();if(!e)return;const{store:t,collectionContextStore:o}=this.props;B.rv({environment:this.environment,collectionContextStore:o,block_id:t.id,property:"title",property_type:"text",from:e}),this.disallowEmptyDelete()},this.handleTextUntab=()=>{const e=this.getShowProperties(),t=a().findLast(e,((e,t)=>this.canOpenProperty(e)));t&&kt.bA({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:this.props.store,property:t,format:Ut.C.Page,collectionContextStore:this.props.collectionContextStore}),this.disallowEmptyDelete()},this.handleBlockPropertyEsc=()=>{kt.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore}),H.Ys({environment:this.environment,store:this.props.store}),this.disallowEmptyDelete()},this.handleBlockPropertyTab=()=>{const{store:e,blockPropertyValueOverlayStore:t}=this.props,o=t.state,r=this.getShowProperties(),i=o.isOpen?r.findIndex((e=>e===o.property)):-1,n=r.find(((e,t)=>t>i&&this.canOpenProperty(e)))||r.find(((e,t)=>!this.normalizedCardSelectionStore.state&&this.canOpenProperty(e)));n?p.default.afterNextFlush((()=>{kt.bA({environment:this.environment,blockPropertyValueOverlayStore:t,store:e,property:n,format:Ut.C.Page,collectionContextStore:this.props.collectionContextStore})})):this.normalizedCardSelectionStore.state&&p.default.afterNextFlush((()=>{this.handleEditButtonClick()})),kt.xv({environment:this.environment,blockPropertyValueOverlayStore:t}),this.disallowEmptyDelete()},this.handleBlockPropertyUntab=()=>{const{store:e,blockPropertyValueOverlayStore:t}=this.props,o=t.state;if(!o.isOpen)return;const r=this.getShowProperties(),i=r.findIndex((e=>e===o.property)),n=a().findLast(r,((e,t)=>t<i&&this.canOpenProperty(e)))||a().findLast(r,((e,t)=>!this.normalizedCardSelectionStore.state&&this.canOpenProperty(e)));n?p.default.afterNextFlush((()=>{kt.bA({environment:this.environment,blockPropertyValueOverlayStore:t,store:e,property:n,format:Ut.C.Page,collectionContextStore:this.props.collectionContextStore})})):this.normalizedCardSelectionStore.state&&p.default.afterNextFlush((()=>{this.handleEditButtonClick()})),kt.xv({environment:this.environment,blockPropertyValueOverlayStore:t}),this.disallowEmptyDelete()},this.handleMouseMove=()=>{if(!we.Z.state){const{mouseStore:e}=this.stores;e.setState({...e.state,mouseEntered:!0})}},this.handleMouseLeave=()=>{const{mouseStore:e}=this.stores;e.setState({...e.state,mouseEntered:!1})},this.handleMouseMoveThrottled=(0,l.throttle)(this.handleMouseMove,100),this.handleMouseLeaveDebounced=(0,l.debounce)(this.handleMouseLeave,100),this.handleRecordIconChange=async e=>{const{store:t}=this.props,o=t.getIconStore();if(o){const{serverCommitResult:t}=N.createAndCommit({userAction:"PageViewBlock.handleRecordIconChange",environment:this.environment,perform:t=>{Pt.sO({store:o,value:e,transaction:t})}});await t}this.disallowEmptyDelete()},this.tryDeleteEmptyOnBlur=()=>{const{store:e,onTextEsc:t,collectionContextStore:o}=this.props,{editModeStore:r}=this.stores;"new_empty"!==r.state||this.normalizedCardSelectionStore.state||o.defaultPageTemplateStore.state||(t(e),this.normalizedCardSelectionStore.removeListener(this.tryDeleteEmptyOnBlur))},this.getViewType=()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore();return null==t?void 0:t.getType()},this.normalizedCardSelectionStore=this.createComputedStore((()=>{const e=Mt.Z.state;return e.isActive&&e.store===this.props.store})),this.shouldShowEditButton=this.createComputedStore((()=>{const e=this.isEditingTitle.state,t=this.getVisibleProperties(),o=this.getShowProperties();return!e&&(this.props.shouldShowTitle||t.length>0&&t.length!==o.length)})),this.isEditingTitle=this.createComputedStore((()=>{var e;const t=Ft.default.state;return"editing"===t.mode&&(null===(e=(0,Rt.QY)(t.multiSelection))||void 0===e?void 0:e.store)===(0,vt.JI)(this.props.store)})),this.peekUrl=this.createComputedStore((()=>{const{store:e,collectionContextStore:t}=this.props,{mainEditorCurrentBlockStore:o}=ue.default.state;return ee.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})})),this.pageUrl=this.createComputedStore((()=>{const{store:e}=this.props;return(0,oe.ZP)({store:e,fullyQualified:!1,pageVisitSource:g.tY.LinkInPage})})),this.shouldShowActionButton=this.createComputedStore((()=>{const{device:e}=this.environment,{isKeyboardMode:t}=Bt.Z.state;return!e.isMobile&&this.canEdit()&&!t})),this.mouseIsEntered=this.createComputedStore((()=>this.stores.mouseStore.state.mouseEntered&&!we.Z.state)),this.disallowEmptyDelete=()=>{const{editModeStore:e}=this.stores;"new_empty"===e.state&&(e.setState("new"),Mt.Z.state.isActive&&Mt.Z.setState({...Mt.Z.state,transient:!1}))}}activate(){const e=this.peekUrl.state;e&&(this.props.handleOpenPeekPage(),L.navigate({environment:this.environment,url:e}))}willMount(){var e;const{editModeStore:t}=this.stores,o=Ft.default.state,r="editing"===o.mode&&(null===(e=(0,Rt.QY)(o.multiSelection))||void 0===e?void 0:e.store)===(0,vt.JI)(this.props.store),i=Mt.Z.state,n=i.isActive&&i.transient;r&&n?t.setState("new_empty"):r?t.setState("new"):t.setState("existing")}didMount(){const{editModeStore:e}=this.stores;super.didMount(),this.normalizedCardSelectionStore.state&&"new_empty"===e.state&&this.normalizedCardSelectionStore.addListener(this.tryDeleteEmptyOnBlur)}willUnmount(){super.willUnmount(),this.normalizedCardSelectionStore.removeListener(this.tryDeleteEmptyOnBlur)}renderComponent(){const{device:e}=this.environment,{store:t,coverFormat:o,coverAspectFormat:r,coverWidth:i,coverHeight:n,coverSizeFormat:l,shouldShowTitle:a,colorStyle:d,onShiftEnter:h}=this.props,p=this.pageUrl.state,u=this.peekUrl.state,m=this.mouseIsEntered.state,g=this.normalizedCardSelectionStore.state,S=this.getViewType(),v=(0,c.createRef)(),y=c.createElement(Yt.Z,{ref:v,style:{...this.getStyle(),position:m?"relative":"static",..."gallery"===S&&{height:"100%"}},innerStyle:{userSelect:g?void 0:"none",WebkitUserSelect:g?void 0:"none",height:"100%",..."board"===S&&{minHeight:40},..."gallery"===S&&{display:"flex",flexDirection:"column"}},hoveredStyle:{background:g?"transparent":(null==d?void 0:d.cardHoveredBackgroundColor)||this.theme.cardHoveredBackground},pressedStyle:{background:g?"transparent":(null==d?void 0:d.cardPressedBackgroundColor)||this.theme.cardPressedBackground},href:p,metaHref:e.isMobile?p:u,onMouseEnter:this.handleMouseMoveThrottled,onMouseMove:this.handleMouseMoveThrottled,onMouseLeave:this.handleMouseLeaveDebounced,onClick:this.handleClick},s()(eo.Z,{mouseStore:this.stores.mouseStore,onFlushTemporaryPosition:this.handleFlushTemporaryPosition,source:S,small:"small"===l,store:this.props.store,renderControl:this.renderControl},void 0,(e=>{let{imagePosition:a}=e;return o&&s()(Wt,{store:t,coverWidth:i,coverHeight:n,coverFormat:o,coverAspectFormat:r,coverSizeFormat:l,coverPosition:a,isGallery:"gallery"===S,onLoadProxiedImage:e=>{this.lastProxiedUrl=e}})})),a&&this.renderTitle(),this.renderProperties(),this.renderDiscussionIndicator()),f=Vt.default.state.stores.includes(t);return s()(Qt.Z,{capture:g,onEsc:()=>{E.MO(),this.disallowEmptyDelete()},onEnter:this.handleBlockEnter,onSpace:this.handleBlockSpace,onTab:this.handleBlockPropertyTab,onUntab:this.handleEditButtonClick},void 0,s()(Qt.Z,{capture:f,onShiftEnter:()=>{N.createAndCommit({userAction:"CollectionViewCardItem.handleFlushTemporaryPosition",environment:this.environment,perform:e=>{h({blocks:Vt.default.state.stores,transaction:e})}})}},void 0,y,this.showTutorialTooltip()&&s()($t.bZ,{origin:v})))}renderTitle(){const{device:e}=this.environment,{store:t,collectionContextStore:o}=this.props,r=(0,vt.JI)(t),i=t.hasIcon()||!t.isEmptyPage(),n=t.hasError(),l=t.canEdit()&&o.permissionScopes.state.canEditContent,a=this.normalizedCardSelectionStore.state,c=this.getViewType(),d=s()(jt.Z,l?{disabled:!1,bucket:"secure",style:{...this.getRecordIconStyle(),...e.isMobile?oo.mobileTitleIconStyle:oo.desktopTitleIconStyle,..."board"===c&&{marginTop:1,marginLeft:0,marginRight:2,borderRadius:5,padding:2,width:24,height:24}},progressContainerStyle:this.getRecordIconProgressStyle(),icon:t.getIcon(),store:t,onChange:this.handleRecordIconChange,size:e.isMobile?24:20,isEmptyPage:t.isEmptyPage()}:{disabled:!0,bucket:"secure",style:{...this.getRecordIconStyle(),...e.isMobile?oo.mobileTitleIconStyle:oo.desktopTitleIconStyle},progressContainerStyle:this.getRecordIconProgressStyle(),icon:t.getIcon(),store:t,size:e.isMobile?24:l?20:18,isEmptyPage:t.isEmptyPage()}),h=s()(Jt.Z,{store:r,disabled:!a,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableEmbedMenu:!0,onEnter:this.handleTextEnter,onEsc:this.handleTextEsc,onTab:this.handleTextTab,onUntab:this.handleTextUntab,onChange:this.handleTrackTitlePropertyEdit,placeholder:a?ie.default.formatMessage(to.typeAName):ie.default.formatMessage(to.untitledBlock),style:{...e.isMobile?oo.mobileTitleTextStyle:oo.desktopTitleTextStyle,..."board"===c&&{flexGrow:1,padding:2},pointerEvents:a?void 0:"none",cursor:a?"text":void 0,..."gallery"===c&&{whiteSpace:"pre-wrap"}},disableSelectAllBlocks:!0,pasteBehavior:"inline"});return s()("div",{style:this.getTitleWrapStyle()},void 0,(i||a)&&!n&&d,n&&y.Z.warning({fill:this.theme.accentColors.orange[500],width:e.isMobile?20:16,marginLeft:e.isMobile?2:4,marginRight:e.isMobile?4:6,paddingBottom:6,paddingTop:6,display:"inline-block",verticalAlign:"bottom"}),h)}renderProperties(){const e=this.getShowProperties();if(0!==e.length)return s()("div",{style:this.getPropertiesWrapStyle()},void 0,e.map(this.renderProperty))}canOpenProperty(e){const{schema:t}=this.props,o=t[e];return Boolean(o&&!Ct.uk.includes(o.type))}getVisibleProperties(){const{format:e}=this.props;return(("board"===this.getViewType()?e.board_properties:e.gallery_properties)||[]).filter((e=>e.visible))}getShowProperties(){const{store:e,schema:t}=this.props,o=this.getVisibleProperties();if(!e.isDefined())return[];return o.filter((o=>{const r=this.normalizedCardSelectionStore.state&&"title"!==o.property;return bt.XU({block:e.getModel(),property:o.property,schema:t,getRecordModel:this.props.store.getRecordModel,userId:this.environment.currentUser.id,userTimeZone:(0,je.r)(),intl:ie.default.getIntl()})||r})).map((e=>e.property))}hasNoProperties(){return 0===this.getShowProperties().length}showTutorialTooltip(){var e,t,o;const{store:r,collectionContextStore:i}=this.props;return!(r.getSpaceId()!==(null===(e=ue.default.state.currentSpaceStore)||void 0===e?void 0:e.id))&&((null===(t=i.collectionViewStore())||void 0===t?void 0:t.getFormat().app_config_uri)===S.g3&&r.getFormat().app_config_uri===S.z3&&"sprint_board"===(null===(o=ue.default.state.mainEditorCurrentBlockStore)||void 0===o?void 0:o.getFormat().special_page_for_pm_launch)&&(0,$.wY)())}getStyle(){const{colorStyle:e}=this.props,t=this.getViewType();return{boxShadow:e?this.theme.selectTypeBoardBoxShadow:this.theme.lightBoxShadow,borderRadius:"board"===t?4:3,background:"board"===t?(null==e?void 0:e.cardBackgroundColor)||this.theme.boardItemDefaultBackground:this.theme.collectionGalleryPreviewCardBackground,overflow:"hidden",transition:"background 100ms ease-out",..."board"===t&&{marginBottom:Zo}}}getRecordIconStyle(){return{..."board"===this.getViewType()&&{marginTop:1,marginLeft:0,marginRight:2,borderRadius:5,padding:2,width:24,height:24}}}getRecordIconProgressStyle(){return{top:14,bottom:"unset",right:"unset",fontSize:12}}getTitleWrapStyle(){const e=this.getViewType();return{..."gallery"===e&&{width:"100%"},display:"flex",paddingTop:8,paddingLeft:"board"===e?6:10,paddingRight:10,paddingBottom:"gallery"===e&&this.hasNoProperties()?10:6,position:"relative"}}getDiscussionIndicatorWrapStyle(){const e=this.getViewType();return{display:"flex",alignItems:"center",color:this.theme.lightTextColor,fill:this.theme.lightTextColor,fontWeight:x.Z.fontWeight.semibold,fontSize:12,paddingLeft:10,paddingRight:10,paddingBottom:8,..."gallery"===e&&{paddingTop:this.hasNoProperties()&&!this.props.shouldShowTitle?8:0}}}getPropertiesWrapStyle(){const{shouldShowTitle:e}=this.props;return{paddingTop:e?0:8,paddingBottom:10,..."board"===this.getViewType()&&{lineHeight:1.5,paddingBottom:4,display:"flex",flexDirection:"column"}}}}oo.displayName="CollectionViewCardItem",oo.desktopTitleIconStyle={float:"left",marginTop:2,marginRight:4,marginLeft:-2},oo.mobileTitleIconStyle={float:"left",marginTop:0,marginRight:4,marginLeft:-2},oo.desktopTitleTextStyle={fontSize:14,lineHeight:1.5,minHeight:21,fontWeight:x.Z.fontWeight.medium,width:"auto"},oo.mobileTitleTextStyle={fontSize:16,lineHeight:1.5,minHeight:24,fontWeight:x.Z.fontWeight.medium,width:"auto"};const ro=oo;class io extends Ee.Z{renderComponent(){return s()(ro,{store:this.props.store,disabled:this.props.disabled,isFirstItem:this.props.isFirstItem,isLastItem:this.props.isLastItem,hideContent:this.props.hideContent,blockResizerStore:this.props.blockResizerStore,isQuickFind:this.props.isQuickFind,style:this.props.style,disableCommentMenu:this.props.disableCommentMenu,disableHoverMenu:this.props.disableHoverMenu,disableDrag:this.props.disableDrag,numberedListCounterStore:this.props.numberedListCounterStore,bulletedListFormatStore:this.props.bulletedListFormatStore,format:this.props.format,schema:this.props.schema,coverFormat:this.props.coverFormat,coverAspectFormat:this.props.coverAspectFormat,coverSizeFormat:this.props.coverSizeFormat,coverHeight:void 0,coverWidth:void 0,shouldShowTitle:this.props.shouldShowTitle,colorStyle:this.props.colorStyle,onTextEnter:this.props.onTextEnter,onTextEsc:this.props.onTextEsc,onShiftEnter:this.props.onShiftEnter,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,isLast:this.props.isLast,handleOpenPeekPage:this.props.handleOpenPeekPage,collectionContextStore:this.props.collectionContextStore})}}io.displayName="BoardItem";const no=io;var so=o(68785),lo=o(73063);class ao extends h.Z{renderComponent(){const{limit:e}=this.props;return s()(P.FormattedMessage,{defaultMessage:"{limit} pages",values:{limit:e.limit},id:"database.FirstLoadLimitSelectOption.limitPagesTitle"})}}ao.displayName="FirstLoadLimitSelectOption";const co=(0,P.injectIntl)(ao);class ho extends h.Z{renderComponent(){const{device:e}=this.environment,{currentLimit:t,onAccept:o,onClose:r,showTitle:n}=this.props,l=[{key:0,render:e=>c.createElement(dt.Z,i()({enableActionSheetTitle:!0,title:n&&s()(P.FormattedMessage,{defaultMessage:"Show on first load",id:"database.firstLoadLimitSelectMenu.firstLoadLimitSetting"})},e)),items:a().compact(bt.jk.map(((e,r)=>({key:r,render:o=>c.createElement(rt.Z,i()({},o,{disabled:!1,title:s()(co,{limit:e}),checkState:a().isEqual(t,e)})),action:()=>o(e)}))))}];let d;return d=e.isMobile?{menuType:et.og.ActionSheet}:{menuType:et.og.Popup,width:200},c.createElement(nt.Z,d,s()(st.Z,{type:st.i.Vertical,sections:l,onAccept:r,initialFocus:void 0}))}}ho.displayName="FirstLoadLimitSelectMenu";const po=(0,P.injectIntl)(ho);class uo extends h.Z{constructor(){super(...arguments),this.renderPopup=e=>s()(po,{currentLimit:this.getCurrentFirstLoadLimit(),onAccept:this.handleFirstLoadLimitAccept,onClose:e.close,showTitle:!0}),this.handleFirstLoadLimitAccept=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();if(!o)return;const r=o.getType();r&&(N.createAndCommit({userAction:"FirstLoadLimitActionButton.handleFirstLoadLimitAccept",environment:this.environment,perform:t=>{Le.FH({stores:[o],update:{inline_collection_first_load_limit:e},transaction:t})}}),t.groupsStore.resetAllLimits(),T.wds(this.environment,{view_type:r,action:"set_first_load_limit"}))}}renderComponent(){const{device:e}=this.environment;return s()(it.ZP,{popupType:e.isMobile?ct.kQ.SlideUp:ct.kQ.Popup,renderOrigin:e=>c.createElement(lo.Z,i()({icon:y.Z.dots,style:{marginLeft:4,marginRight:4}},e)),alignmentToOrigin:it.vR.End,placementToOrigin:it.pO.Bottom,originGap:8,render:this.renderPopup})}getCurrentFirstLoadLimit(){const{format:e}=this.props;return(0,bt.rx)(e.inline_collection_first_load_limit,Boolean(e.collection_group_by))}}uo.displayName="FirstLoadLimitActionButton";const mo=uo;class go extends h.Z{constructor(){super(...arguments),this.handleLoadMoreClick=e=>{const{collectionContextStore:t,groupsPointer:o,incrementLimitsInRelatedGroups:r}=this.props,i=t.groupsStore.getGroupState(o);if(!i)return;const n=i.reducerResultStore.state;(0,re.Wi)(e),H.ZH(this.environment),n&&V.ID({collectionContextStore:t,environment:this.environment,incrementLimitArgs:{isFullScreen:this.props.isFullScreen,currentResultCount:n.blockIds.length,groupsPointer:i.groupsPointer,incrementLimitsInRelatedGroups:r}}),T.uDZ(this.environment)}}renderComponent(){const{style:e,store:t,format:o,collectionContextStore:r,groupsPointer:i}=this.props;if(!r.groupsStore.getGroupState(i))return;const n=ze({collectionContextStore:r,groupsPointer:i});return s()(qt.Z,{onClick:this.handleLoadMoreClick,onMouseDown:re.$0,disabled:n,hoveredStyle:n?{background:this.theme.whiteButtonBackground}:{},style:{display:"flex",alignItems:"center",height:30,borderRadius:3,whiteSpace:"break-spaces",fontSize:14,...e}},void 0,y.Z.arrowDown(this.getLoadMoreButtonIconStyle()),s()("div",{style:{color:this.theme.lightTextColor}},void 0,s()(P.FormattedMessage,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})),n?s()("div",{style:{marginTop:1,marginLeft:8,marginRight:8}},void 0,s()(so.Z,{style:{width:12,height:12}})):t.canEdit()&&s()(mo,{collectionContextStore:r,format:o}))}getLoadMoreButtonIconStyle(){return{width:14,height:14,marginLeft:4,marginRight:6,fill:this.theme.lightIconColor}}}go.displayName="CollectionGroupLoadMoreButton";const So=go;var vo=o(480),yo=o(81954),fo=o(24405),Co=o(76205),bo=o(59054),wo=o(95371),xo=o(77181),ko=o(40150),Po=o(20144),To=o(48543),Ro=o(92628);class Io extends h.Z{constructor(){super(...arguments),this.handleInsertBelow=e=>{const{insertStores:t,transaction:o}=e,{store:r,collectionContextStore:i,groupsPointer:n}=this.props,s=this.associatedCollectionStore.state;if(!s)return[];const l=this.resultsStore.state;return l?V.$T({environment:this.environment,collectionStore:s,collectionContextStore:i,groupsPointer:n,results:l.state,insertStores:t,store:r,before:!1,transaction:o}):[]},this.handleInsertAbove=e=>{const{insertStores:t,transaction:o}=e,{store:r,collectionContextStore:i,groupsPointer:n}=this.props,s=this.associatedCollectionStore.state;if(!s)return[];const l=this.resultsStore.state;return l?V.$T({environment:this.environment,collectionStore:s,collectionContextStore:i,groupsPointer:n,results:l.state,insertStores:t,store:r,before:!0,transaction:o}):[]},this.handleRemove=e=>{const{store:t,collectionContextStore:o,groupsPointer:r}=this.props,{transaction:i}=e;r.length>0&&V.BN({store:t,transaction:i,groupsPointer:r,collectionContextStore:o,environment:this.environment}),V.Od({store:t,transaction:i})},this.handleDrop=e=>{const{droppedDirection:t,droppedStores:o,duplicate:r}=e,{store:i,collectionContextStore:n,groupsPointer:s,subitemPath:l}=this.props,a=this.associatedCollectionStore.state;if(!a)return[];const c=this.resultsStore.state;if(!c)return[];const d=he.default.mark("collections.drop_item_lag");he.default.measureAfterNextFlush(d,{environment:this.environment,getData:()=>j.yr({collectionContextStore:n,is_native_drop:!1,is_empty:!1})}),N.createAndCommit({userAction:"CollectionGroupResultsItem.handleDrop",environment:this.environment,perform:e=>{V.by({environment:this.environment,collectionStore:a,targetStore:i,droppedDirection:t,collectionContextStore:n,groupsPointer:s,droppedStores:o,results:c.state,duplicate:r,transaction:e,subitemPath:l})}})},this.handleNativeDrop=e=>{const{files:t,droppedDirection:o}=e,{store:r,collectionContextStore:i,groupsPointer:n}=this.props,s=this.associatedCollectionStore.state;if(!s)return[];const l=this.resultsStore.state;if(!l)return[];const a=he.default.mark("collections.drop_item_lag");he.default.measureAfterNextFlush(a,{environment:this.environment,getData:()=>j.yr({collectionContextStore:i,is_native_drop:!0,is_empty:!1})}),N.createAndCommit({userAction:"CollectionGroupResultsItem.handleNativeDrop",environment:this.environment,perform:e=>{V.tQ({environment:this.environment,collectionStore:s,targetStore:r,droppedDirection:o,collectionContextStore:i,groupsPointer:n,files:t,results:l.state,transaction:e})}})},this.handleInsertRow=e=>t=>{let{transaction:o}=t;const{store:r,collectionContextStore:i,groupsPointer:n,subitemPath:s,blockPropertyValueOverlayStore:l,onSelectableInsertRow:a}=this.props,c=this.associatedCollectionStore.state;if(!c)return[];const d=this.resultsStore.state;if(!d)return[];const h=V.yk({environment:this.environment,collectionContextStore:i,groupsPointer:n,results:d.state,store:r,before:"above"===e,collectionStore:c,transaction:o,subitemPath:s,subitemInsertDirection:"below"});h&&a&&a(r,h),h&&l&&p.default.afterNextFlush((()=>{p.default.afterNextFlush((()=>{kt.bA({isNewBlock:!0,environment:this.environment,blockPropertyValueOverlayStore:l,store:h,property:"title",format:Ut.C.Table,collectionContextStore:i})}))}))},this.handleOpenPeekPage=()=>{const{collectionContextStore:e,handleOpenPeekPage:t}=this.props,o=e.collectionViewStore();he.default.mark("collections.open_item_page_lag"),t&&t(),_.Xd({collectionContextStore:e,resultsStore:this.resultsStore.state});const r=null==o?void 0:o.getType();if(r){const e=null==o?void 0:o.getFormat().collection_peek_mode,t=e||To.Ls[r];T.hym(this.environment,{is_peek:!0,from:r,peek_mode:t})}},this.canEditStore=this.createComputedStore((()=>this.props.store.canEdit())),this.associatedCollectionStore=this.createComputedStore((()=>this.props.store.getAssociatedCollectionStore())),this.resultsStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupsPointer:t}=this.props,o=e.groupsStore.getGroupState(t);return null==o?void 0:o.resultsStore})),this.shouldShowHighlightHalo=this.createComputedStore((()=>ee.Sc(this.props.store))),this.normalizedCollectionViewSelectionStore=this.createComputedStore((()=>{const e=Mt.Z.state;return e.isActive&&e.store===this.props.store}))}didMount(){this.props.collectionContextStore.onItemMount()}renderComponent(){const{store:e,resultProps:t,resultComponent:o,collectionContextStore:r,canDrag:i,canDrop:n,getItemSelectableStyle:l,belowDropZoneMargin:a,analyticsName:d,disabled:h,direction:p,onSelectableEnter:u,disableScrollToRevealHorizontal:m,touchDragOnly:g,isLast:S,groupsPointer:v,toggleButton:y,subitemPath:f,disableSelectable:C,itemSelectableHaloStyle:b}=this.props,w=!h&&this.canEditStore.state,x=this.props.shouldShowHoverMenu&&w,k=p!==Do.Vertical&&n,P=p!==Do.Vertical&&n,T=p===Do.Vertical&&n,R=c.createElement(o,{handleOpenPeekPage:this.handleOpenPeekPage,collectionContextStore:r,...t,store:e,key:e.id,isLast:S,toggleButton:y,subitemPath:f});return C?R:s()(Ro.Z,{style:l?l(S):void 0,store:e,canSelect:w,shouldShowHalo:!this.normalizedCollectionViewSelectionStore.state,shouldForceRenderSelectionHalo:this.shouldShowHighlightHalo.state,haloStyle:{...ee.pB(this.shouldShowHighlightHalo.state,this.theme),...b},canDrag:i,canDropBelow:T,canDropLeft:k,canDropRight:P,canNativeDropBelow:T,canNativeDropLeft:k,canNativeDropRight:P,canDropOnto:n,canTriggerContextMenu:w,showBlockMenuInput:!0,shouldShowHoverMenu:x,shouldShowCommentMenu:!1,onSelectableDrop:this.handleDrop,onNativeDrop:this.handleNativeDrop,onInsertBelow:this.handleInsertBelow,onInsertAbove:this.handleInsertAbove,onRemove:this.handleRemove,canInsertAbove:n,canInsertBelow:n,onInsertRowBelow:this.handleInsertRow("below"),onInsertRowAbove:this.handleInsertRow("above"),belowDropZoneMargin:a,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:d,shouldShowDropZone:n,dropzoneGap:this.props.dropzoneGap,onEnter:u,className:q.K4T,disableScrollToRevealHorizontal:m,touchDragOnly:g,groupsPointer:v},void 0,R)}}Io.displayName="CollectionGroupResultsItem";const Mo=Io;var Bo=o(5210);function Vo(e){window.__c={n:"CollectionGroupResultsNestedItem"};const{store:t,collectionContextStore:o,subitemPath:r,titleColumnIndex:n,nestedCreateSubitemButton:l,getItemSelectableStyle:a}=e,{currentSubitemFormatStore:d,subitemExpandedStore:h,subitemTreeStore:p}=o,u=(0,yo.VK)((()=>t.getAssociatedCollectionStore()),[t]),m=(0,yo.VK)((()=>r&&r.length>0?r:(0,wo.DY)(p.state.children,(e=>e.value.store===t))),[r,p,t],{useDeepEqual:!0}),g=m?(0,xo.Af)(m.map((e=>e.value.store))):"",S=(0,yo.VK)((()=>h.state.get(g)),[h,g]),v=Boolean(null==S?void 0:S.isExpanded),y=(0,vo.O7)(),f=(0,yo.VK)((()=>{const e=d.state;if(!e||!u)return;const t=u.getSchema()[e.property];return void 0!==t&&(0,Ct.p_)(t)?t:void 0}),[d,u]),C=(0,yo.VK)((()=>{var e;return f&&"relation"===f.type&&(0,Ct.F0)(f)===(null===(e=o.collectionStore())||void 0===e?void 0:e.id)&&f.property}),[o,f]),b=(0,yo.VK)((()=>{var e;return null===(e=o.collectionViewStore())||void 0===e?void 0:e.getType()}),[o]),w=(0,yo.VK)((()=>{const e=!C||b&&(0,xo.Av)(b)?void 0:{property:C,filter:{operator:"is_empty"}};return!(!d.state||!u)&&(0,xo.kC)({store:t,collectionStore:u,subitemFormat:d.state,subitemPathKey:g,collectionContextStore:o,propertyFilters:[...e&&C?[{id:C,filter:e}]:[],...o.currentPropertyFiltersStore.state],combinatorFilter:o.currentCombinatorFilterStore.state,currentUserId:y.currentUser.id}).length>0}),[o,b,d,y.currentUser.id,C,u,g,t]),x=(0,yo.VK)((()=>{var e;if(!d.state||!u)return!1;const t=null===(e=o.collectionViewStore())||void 0===e?void 0:e.getType();return w||v||y.device.isMobile||"timeline"===t}),[d,y.device.isMobile,u,w,v,o]),k=(0,yo.VK)((()=>Po.Z.getState().hoveredStore===t),[t]),P=(0,yo.VK)((()=>{const e=(0,Q.m1)({collectionContextStore:o,environment:y});if(e)return(0,Co.q)(e)}),[o,y]),R=(0,c.useCallback)((()=>{const e=h.state;if(v)e.delete(g),T.iwE(y,{...(0,j.Pn)(o),depth:(null==m?void 0:m.length)||0}),h.emit();else{e.set(g,{isExpanded:!0,limit:20}),T.uCY(y,{...(0,j.Pn)(o),depth:(null==m?void 0:m.length)||0});const r=d.state;P&&e&&f&&r?(0,xo.fd)({blockStore:t,subitemExpandedStore:h,subitemFormat:r,propertySchema:f,compiledFilter:P,pathKey:g,forceStoresToLoad:!1,visitedIds:new Set}).then((()=>{h.emit()})):h.emit()}}),[P,h,v,g,o,d,y,m,t,f]),I=(0,yo.VK)((()=>{const o=p.state;return o&&m?(0,xo.Ns)(o).value.store===t:e.isLast}),[p,e.isLast,t,m]),M=(0,yo.VK)((()=>{var e;const o=t.getModel(),r=t.getRecordModel;if(!P||!o)return!0;const i=null===(e=t.getParentCollectionStore())||void 0===e?void 0:e.getPropertyMapping();return P({block:o,getRecordModel:r,propertyMapping:i})}),[P,t]),B=(0,yo.VK)((()=>a&&!M?()=>({...a?a(I):{},...M?{}:{opacity:.5}}):a),[a,M,I]);(0,bo.r5)((async()=>{const e=t.getModel();await t.load();const o=t.getRecordModel,r=d.state;if(!x||!e||!P||!f||!o||!r||M)return;(0,xo.xb)({store:t,subitemFormat:r,propertySchema:f}).length>0||(await(0,xo.fd)({blockStore:t,subitemExpandedStore:h,subitemFormat:r,propertySchema:f,compiledFilter:P,pathKey:g,forceStoresToLoad:!0,visitedIds:new Set}),h.emit())}),[x,P,d,M,g,t,h,f]);const V=(0,fo.Fg)(),F=c.createElement(Mo,i()({},e,{isLast:I,getItemSelectableStyle:B,subitemPath:m,toggleButton:(x||k)&&s()(Bo.Z,{isSidebar:!1,open:v,fill:!0,onClick:R,color:w||v?V.regularIconColor:V.mediumIconColor,disabled:m&&m.length>=xo.F0})}));if(!v||!m||0===m.length||m.length>=xo.F0)return F;const D=m[m.length-1].children;return c.createElement(c.Fragment,null,F,D.map((t=>{const o=t.value.store;return c.createElement(Vo,i()({},e,{key:o.id,store:o,subitemPath:[...m,t]}))})),u&&l&&l({store:t,parentStore:u,subitemPath:m,indentLevel:m.length,titleColumnIndex:n}),S&&D.length>0&&D.length===S.limit&&s()(Fo,{collectionContextStore:e.collectionContextStore,pathKey:g,titleColumnIndex:n,limit:S.limit,indentLevel:m.length}))}function Fo(e){window.__c={n:"NestedTableLoadMoreButton"};const{collectionContextStore:t,pathKey:o,titleColumnIndex:r,limit:i,indentLevel:n}=e,l=(0,c.useCallback)((()=>{const{subitemExpandedStore:e}=t;e.state.set(o,{isExpanded:!0,limit:i+20}),e.emit()}),[t,i,o]),a=(0,vo.O7)(),d=(0,yo.VK)((()=>(0,ee.fk)({environment:a,collectionContextStore:t})),[t,a]),h=(0,yo.VK)((()=>{var e;return(0,$.$4)()&&"title"===(null===(e=t.collectionViewStore())||void 0===e?void 0:e.getFormat().table_subitem_toggle_column)}),[t]),p=(0,fo.yK)((e=>({button:{display:"flex",alignItems:"center",height:32,width:"100%",paddingLeft:8+(0,ko.f2)({columnIndex:0,titleColumnIndex:r,shouldShowBulkActionsToolbar:d,indentLevel:n+1,isSubitemToggleOnTitleColumn:h}),fontSize:14,lineHeight:x.Z.lineHeight.UIRegular.desktop,borderTop:`1px solid ${e.tableDividerColor}`,borderBottom:`1px solid ${e.tableDividerColor}`,background:e.cardContentBackground},icon:{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.lightIconColor},label:{color:e.lightTextColor}})),[n,d,r,h]);return s()(qt.Z,{onClick:l,onMouseDown:re.$0,style:p.button},void 0,y.Z.arrowDown(p.icon),s()("span",{style:p.label},void 0,s()(P.FormattedMessage,{defaultMessage:"Load more",id:"database.loadMoreButtonTitle"})))}let Do=function(e){return e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal",e}({});class Eo extends h.Z{constructor(){super(...arguments),this.instanceCollectionViewBlockStore=void 0,this.renderResult=(e,t,o)=>{const r=t===o.length-1,{collectionContextStore:i,resultProps:n,resultComponent:l,groupsPointer:a,shouldShowHoverMenu:c,canDrag:d,disabled:h,format:p,getItemSelectableStyle:u,handleOpenPeekPage:m,belowDropZoneMargin:g,analyticsName:S,direction:v,onSelectableEnter:y,canDrop:f,disableScrollToRevealHorizontal:C,touchDragOnly:b,blockPropertyValueOverlayStore:w,onSelectableInsertRow:x,disableSelectable:k,titleColumnIndex:P,nestedCreateSubitemButton:T,itemSelectableHaloStyle:R}=this.props;if(e.getAssociatedCollectionStore())return s()(Vo,{getItemSelectableStyle:u,itemSelectableHaloStyle:R,store:e,canDrag:d,resultProps:n,resultComponent:l,collectionContextStore:i,groupsPointer:a,shouldShowHoverMenu:c,canDrop:f&&!h,format:p,handleOpenPeekPage:m,belowDropZoneMargin:g,analyticsName:S,disabled:h,direction:v,dropzoneGap:this.props.dropzoneGap,onSelectableEnter:y,disableScrollToRevealHorizontal:C,touchDragOnly:b,isLast:r,subitemPath:Eo.subResultSubitemPath,titleColumnIndex:P,blockPropertyValueOverlayStore:w,onSelectableInsertRow:x,disableSelectable:k,nestedCreateSubitemButton:T},e.id)},this.handleEmptyDroppableDrop=e=>{const{droppedDirection:t,droppedStores:o,duplicate:r}=e,{collectionContextStore:i,groupsPointer:n}=this.props,s=this.emptyDroppableIntoStore.state;if(!s)return;const l=i.collectionViewBlockStore();if(!l)return;const a=he.default.mark("collections.drop_item_lag");he.default.measureAfterNextFlush(a,{environment:this.environment,getData:()=>j.yr({collectionContextStore:i,is_native_drop:!1,is_empty:!0})}),N.createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableDrop",environment:this.environment,perform:e=>{V.by({environment:this.environment,collectionStore:s,targetStore:l,droppedDirection:t,collectionContextStore:i,groupsPointer:n,droppedStores:o,results:this.resultStores.state,duplicate:r,transaction:e})}})},this.handleEmptyDroppableNativeDrop=e=>{const{files:t,droppedDirection:o}=e,{collectionContextStore:r,groupsPointer:i}=this.props,n=this.emptyDroppableIntoStore.state;if(!n)return;const s=r.collectionViewBlockStore();if(!s)return;const l=he.default.mark("collections.drop_item_lag");he.default.measureAfterNextFlush(l,{environment:this.environment,getData:()=>j.yr({collectionContextStore:r,is_native_drop:!0,is_empty:!0})}),N.createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableNativeDrop",environment:this.environment,perform:e=>{V.tQ({environment:this.environment,collectionStore:n,targetStore:s,droppedDirection:o,collectionContextStore:r,groupsPointer:i,files:t,results:this.resultStores.state,transaction:e})}})},this.resultsReducerStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupsPointer:t,loadContentCover:o}=this.props,r=e.groupsStore.getGroupState(t);if(!r)return;const i=r.currentLimit.state,n=e.normalizedSchemaStore.state,s=a().compact(t.map((e=>(0,Ye.Ko)({schema:n,group:e,timeZone:(0,je.r)()}))));return{type:"results",filter:s.length>0?{operator:"and",filters:s}:void 0,limit:i,loadContentCover:o}})),this.resultStores=this.createComputedStore((()=>{const{collectionContextStore:e,groupsPointer:t}=this.props,o=e.groupsStore.getGroupState(t);return(null==o?void 0:o.resultsStore.state)??[]})),this.emptyDroppableIntoStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupsPointer:t}=this.props;var o;return"collectionTypedView"===e.contextType?null===(o=e.groupsStore.getGroupState(t))||void 0===o||null===(o=o.resultsStore.state)||void 0===o?void 0:o[0].getAssociatedCollectionStore():e.collectionStore()}))}getNode(){return super.getNode()}willMount(e){super.willMount(e);const t=e.collectionContextStore.collectionViewBlockStore();t&&(this.instanceCollectionViewBlockStore=new Ve.G(this.environment,t.pointer))}didMountOrUpdate(){this.props.collectionContextStore.renderEmitter.emit()}renderComponent(){const{emptyDroppableStyle:e,direction:t}=this.props,o=this.props.emptyDroppableSize||"none",r=t===Do.Vertical;return c.createElement(c.Fragment,null,s()("div",{style:{...r?{height:o}:{width:o},...e}},void 0,this.renderEmptyDroppable()),this.resultStores.state.map(this.renderResult),this.renderReducerRequest())}renderReducerRequest(){const{collectionContextStore:e,groupsPointer:t,disableRequest:o}=this.props;if(o)return;const r=this.resultsReducerStore.state;if(!r)return;const i=e.groupsStore.getGroupState(t);return i?s()(ot.Z,{id:t.length>0?`results:${(0,Ae.KW)(t)}`:"collection_group_results",reducer:r,groupsPointer:t,collectionContextStore:e,resultStore:i.reducerResultStore}):void 0}renderEmptyDroppable(){const{disabled:e,analyticsName:t,direction:o,onSelectableEnter:r,canDrop:i,groupsPointer:n}=this.props;if(this.instanceCollectionViewBlockStore){const l=o!==Do.Vertical&&(!e&&0===this.resultStores.state.length),a=o===Do.Vertical&&!e;return s()(Ro.Z,{store:this.instanceCollectionViewBlockStore,canSelect:!1,canEditText:!1,shouldShowHalo:!0,canDrag:!1,canDropLeft:i&&l,canNativeDropLeft:i&&l,canDropBelow:i&&a,canNativeDropBelow:i&&a,canTriggerContextMenu:!1,showBlockMenuInput:!1,shouldShowHoverMenu:!1,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:this.handleEmptyDroppableDrop,onNativeDrop:this.handleEmptyDroppableNativeDrop,analyticsName:t,shouldShowDropZone:i,onEnter:r,groupsPointer:n,style:o===Do.Vertical?void 0:{width:"100%",height:"100%"}})}}}Eo.displayName="CollectionGroupResults",Eo.subResultSubitemPath=[];const Ao=Eo;var _o=o(43145);const Zo=5;function Lo(e){return e?8:12}class Oo extends h.Z{constructor(){super(...arguments),this.isReady=this.createComputedStore((()=>{const{groupsPointer:e,collectionContextStore:t}=this.props,o=t.groupsStore.getGroupState(e);return Boolean(null==o?void 0:o.reducerResultStore.state)})),this.handleGroupMouseDown=e=>{const{device:t}=this.environment;t.isMobile||(0,re.ZP)({event:e,context:re.Af.EditorMouseDown,callback:()=>{e.preventDefault(),Z.AI({environment:this.environment,target:e.target,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})},this.handleGroupClick=e=>{(0,re.ZP)({event:e,context:re.Af.EditorClick,callback:()=>{}})},this.handleItemEnter=e=>{const{blocks:t,transaction:o}=e,{groupsPointer:r,collectionContextStore:i,isFullScreen:n}=this.props;if(0===t.length)return;const s=t[0];if(!$e.M_(this.environment)||!i.collectionStore()||!i.shouldAllowNewItemCreation())return;const l=this.getResultsStore();if(!l)return;const a=l.state.findIndex((e=>e===s))+1;St({transaction:o,environment:this.environment,resultsStore:l,collectionContextStore:i,isFullScreen:n,groupsPointer:r,insertAtIndex:a,from:"board_group_enter_add_item",transient:!0})},this.handleItemTextEnter=e=>{const{groupsPointer:t,collectionContextStore:o,isFullScreen:r}=this.props;if(!$e.M_(this.environment)||!o.collectionStore())return this.handleItemTextEsc(e);const i=this.getResultsStore();if(!i)return;const n=i.state.findIndex((t=>t===e))+1;N.createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:this.environment,perform:e=>{St({transaction:e,environment:this.environment,resultsStore:i,collectionContextStore:o,isFullScreen:r,groupsPointer:t,insertAtIndex:n,from:"board_group_enter_add_item",transient:!0})}})},this.handleItemTextEsc=e=>{const{collectionContextStore:t}=this.props,o=t.collectionStore(),r=e.getTitleStore();if(!r)return;if(gt.Q(r.getValue()))H.Ys({environment:this.environment,store:e});else if(o){const{store:t,collectionContextStore:o}=this.props,r=this.getResultsStore();if(!r)return;const i=r.state.findIndex((t=>t===e))-1,n=o.collectionViewStore(),s=o.collectionViewBlockStore();if(n&&s&&T.sGw(this.environment,{...(0,j.Pn)(o),block_id:t.id}),N.createAndCommit({userAction:"BoardGroupResults.handleItemTextEsc",environment:this.environment,perform:t=>{V.Od({store:e,transaction:t})}}),i>=0){const e=r.state[i];H.Ys({environment:this.environment,store:e})}}},this.handleScrollOffsetChange=e=>{const{collectionContextStore:t,isFullScreen:o,groupsPointer:r}=this.props,i=t.isLoading.state,n=t.groupsStore.getGroupState(r),s=null==n?void 0:n.reducerResultStore.state;e<Se.Z.incrementScrollOffset&&!i&&s&&s.hasMore&&V.ID({collectionContextStore:t,environment:this.environment,incrementLimitArgs:{isFullScreen:o,currentResultCount:s.blockIds.length,groupsPointer:r,incrementLimitsInRelatedGroups:!1}})},this.handleMouseMove=()=>{const e=a().last(this.props.groupsPointer);e&&this.props.hoveredGroupStore.state!==e&&this.props.hoveredGroupStore.setState(e)},this.colorStore=this.createComputedStore((()=>{const{groupsPointer:e,schema:t,format:o,collectionContextStore:r}=this.props,i=a().last(e);return(0,Oe.II)({environment:this.environment,groupFormat:i,schema:t,format:o,collectionContextStore:r,theme:this.theme})}),!0)}renderComponent(){var e;const{store:t,groupsPointer:o,collectionContextStore:r,disabled:i,format:n,schema:l,blockPropertyValueOverlayStore:a,isFullScreen:d}=this.props,h=r.groupsStore.getGroupState(o);if(!h)return;const p=this.isReady.state,u=this.getCoverFormat(),m=(0,ee.az)(r,d),g=h.reducerResultStore.state,S=r.permissionScopes.state,v=!i&&p&&r.shouldAllowNewItemCreation(),y=!i&&!S.isSyncedCollection,f=(0,ee.VM)({reducerResult:g,collectionContextStore:r,isFullScreen:d}),C=Boolean(n.collection_group_by);return s()("div",{style:this.getStyle(),onMouseDown:this.handleGroupMouseDown,onClick:this.handleGroupClick,className:q.GfL,onMouseMove:this.handleMouseMove},void 0,s()(Ao,{collectionContextStore:r,groupsPointer:o,format:n,canDrag:y,onSelectableEnter:this.handleItemEnter,resultProps:{format:n,schema:l,onTextEnter:this.handleItemTextEnter,onShiftEnter:this.handleItemEnter,coverFormat:u,coverAspectFormat:this.getCoverAspectFormat(),coverSizeFormat:this.getCoverSizeFormat(),shouldShowTitle:vt.K8(this.props.format,"board"),colorStyle:this.colorStore.state,onTextEsc:this.handleItemTextEsc,disabled:i,blockPropertyValueOverlayStore:a,collectionContextStore:r},canDrop:!0,resultComponent:no,disabled:i,direction:Do.Vertical,shouldShowHoverMenu:!1,belowDropZoneMargin:2,emptyDroppableSize:C?Zo:3,analyticsName:"board",loadContentCover:u&&"page_content"===u.type}),f&&s()(So,{groupsPointer:o,store:t,collectionContextStore:r,format:n,isFullScreen:d,incrementLimitsInRelatedGroups:!0}),v&&c.createElement(c.Fragment,null,f&&s()("div",{style:{width:"100%",borderTop:`1px solid ${this.theme.tableDividerColor}`,marginTop:4,marginBottom:4}}),s()(ft,{groupsPointer:o,collectionContextStore:r,isFullScreen:d,color:null===(e=this.colorStore.state)||void 0===e?void 0:e.textColor})),!m&&s()(_o.Z,{onChange:this.handleScrollOffsetChange}))}getCoverFormat(){const{format:e}=this.props;return e?e.board_cover:void 0}getCoverAspectFormat(){const{format:e}=this.props;return e?e.board_cover_aspect:void 0}getCoverSizeFormat(){const{format:e}=this.props;return e?e.board_cover_size:void 0}getGalleryCardWidth(){const{format:e}=this.props;switch((e||{}).board_cover_size){case"large":return qe.Z.card.desktop.large.width;case"small":return qe.Z.card.desktop.small.width;case"medium":default:return qe.Z.card.desktop.medium.width}}getStyle(){const{format:e}=this.props,t=this.isReady.state,o=this.colorStore.state,r=Boolean(e.collection_group_by);return{flex:"none",paddingLeft:Zo,paddingRight:Zo,paddingBottom:Zo,marginRight:10,boxSizing:"content-box",width:this.getGalleryCardWidth(),height:r?void 0:"max-content",...o&&t&&{backgroundColor:this.props.isInPeekRenderer?o.peekBackgroundColor:o.backgroundColor,...r?{borderRadius:5}:{borderBottomLeftRadius:5,borderBottomRightRadius:5}}}}getResultsStore(){const{groupsPointer:e,collectionContextStore:t}=this.props,o=t.groupsStore.getGroupState(e);return null==o?void 0:o.resultsStore}}Oo.displayName="BoardGroupResults";const Go=(0,P.injectIntl)(Oo);var Ho=o(8848),zo=o(47307),No=o(33846),Wo=o(93405),Ko=o(9050);class Uo extends h.Z{constructor(){super(...arguments),this.storeTypes={inputStore:No.Z},this.handleSelectPropertyColorPickerChange=e=>{const{groupFormat:t,schema:o,collectionContextStore:r}=this.props,i=o[t.property];if(!i)return;if(!Ct.cu(i))return;const n=r.collectionStore();if(!n)return;const s=t.value;if(s.type!==i.type)return;const l=(i.options||[]).map((t=>t.value===s.value?{...t,color:e}:t)),a={...i,options:l},c={...o,[t.property]:a};N.createAndCommit({userAction:"CollectionGroupActionMenu.handleSelectPropertyColorPickerChange",environment:this.environment,perform:e=>{E.Rm({environment:this.environment,collectionStore:n,update:{schema:c},transaction:e})}}),T.wds(this.environment,{view_type:this.getCurrentViewType(),action:"group_change_color"})},this.handleHide=()=>{const{groupFormat:e,collectionContextStore:t,groupsFormatKey:o,currentGroups:r}=this.props,i={...e,hidden:!0},n=(0,Oe.ar)(r,i);N.createAndCommit({userAction:"CollectionGroupActionMenu.handleHide",environment:this.environment,perform:e=>{V.A6({collectionContextStore:t,newGroups:n,groupsFormatKey:o,transaction:e})}}),T.wds(this.environment,{view_type:this.getCurrentViewType(),action:"hide_group"})},this.handleShow=()=>{const{groupFormat:e,collectionContextStore:t,groupsFormatKey:o,currentGroups:r,groupsLimitStore:i}=this.props,n={...e,hidden:!1},s=(0,Oe.nr)(r,n,i.state);N.createAndCommit({userAction:"CollectionGroupActionMenu.handleShow",environment:this.environment,perform:e=>{V.A6({collectionContextStore:t,newGroups:s,groupsFormatKey:o,transaction:e})}}),T.wds(this.environment,{view_type:this.getCurrentViewType(),action:"show_group"})},this.handleDelete=()=>{zo.showDialog({message:s()(P.FormattedMessage,{defaultMessage:"Are you sure? All pages inside this group will be deleted.",id:"database.collectionGroupActionMenu.deleteDialogMessage"}),showCancel:!0,keepFocus:!1,items:[{label:"Delete",color:"red",onAccept:this.handleDeleteAccept}]})},this.handleDeleteAccept=async()=>{const{collectionContextStore:e,currentGroups:t,groupFormat:o,groupsFormatKey:r,intl:i}=this.props,n=e.collectionStore();if(!n)return;const s=o.value;if("relation"===s.type&&(0,Ae.RA)(s.value)){const e=Ve.G.createChildStore(n,{id:s.value.id,table:b.iU});await e.load();const t=e.getParentCollectionStore();await(null==t?void 0:t.load())}N.createAndCommit({userAction:"CollectionGroupActionMenu.handleDelete",environment:this.environment,perform:s=>{V.iE({environment:this.environment,collectionStore:n,property:o.property,groupFormat:o,currentGroups:t,groupsFormatKey:r,collectionContextStore:e,transaction:s,intl:i})}}),T.wds(this.environment,{view_type:this.getCurrentViewType(),action:"delete_group"})}}renderComponent(){const{device:e}=this.environment,{parent:t}=this.props,o=a().compact([this.getGroupActionsSection(),this.getSelectColorSection()]);let r;return r=e.isMobile?{menuType:et.og.Modal,title:s()(P.FormattedMessage,{defaultMessage:"Action",id:"database.collectionGroupActionMenu.title"}),right:s()(lt.DoneMenuText,{}),onClickRight:t.close}:{menuType:et.og.Popup},c.createElement(nt.Z,r,s()(st.Z,{type:st.i.Vertical,initialFocus:0,sections:o,onAccept:e=>{"string"==typeof e.key&&e.key.includes(Uo.colorActionKeyPrefix)||t.close()}}))}getGroupActionsSection(){const{groupFormat:e,collectionContextStore:t}=this.props,o=[],r=e.value,n=t.permissionScopes.state;(0,Ae.eF)(e)?o.push({key:"show",render:e=>c.createElement(Wo.Z,i()({},e,{title:s()(P.FormattedMessage,{defaultMessage:"Show",id:"database.collectionGroupActionMenu.showButtonTitle"}),svg:y.Z.collectionShow})),action:this.handleShow}):o.push({key:"hide",render:e=>c.createElement(Wo.Z,i()({},e,{title:s()(P.FormattedMessage,{defaultMessage:"Hide",id:"database.collectionGroupActionMenu.hideButtonTitle"}),svg:y.Z.collectionHide})),action:this.handleHide}),void 0!==r.value&&n.canEditContent&&!n.isSyncedCollection&&"collectionTypedView"!==t.contextType&&o.push({key:"delete",render:e=>c.createElement(Wo.Z,i()({},e,{title:s()(P.FormattedMessage,{defaultMessage:"Delete pages",id:"database.collectionGroupActionMenu.deleteButtonTitle"}),svg:y.Z.trash})),action:this.handleDelete});return{key:"collection group",render:e=>c.createElement(dt.Z,e),items:o}}getSelectColorSection(){const{schema:e,groupFormat:t}=this.props,o=t.value;if(void 0===o.value)return;const r=e[t.property];if(!r)return;if("select"!==r.type&&"multi_select"!==r.type)return;if(o.type!==r.type)return;const n=(r.options||[]).find((e=>e.value===o.value));if(!n)return;return{key:"collection color section",render:e=>c.createElement(dt.Z,i()({},e,{title:s()(P.FormattedMessage,{defaultMessage:"Colors",id:"database.collectionGroupActionMenu.colorSectionTitle"}),topBorder:!0})),items:Ho.AP.map((e=>({key:`${Uo.colorActionKeyPrefix}_${e}`,render:t=>c.createElement(Ko.Z,i()({},t,{color:e,checkState:n.color===e})),action:()=>{this.handleSelectPropertyColorPickerChange(e)}})))}}getCurrentViewType(){const{collectionContextStore:e}=this.props,t=e.getViewType();if(!t)throw new Error("View type was not defined.");return t}}Uo.displayName="CollectionGroupActionMenu",Uo.colorActionKeyPrefix="color";const $o=(0,P.injectIntl)(Uo);var qo=o(87052);class Qo extends h.Z{constructor(){super(...arguments),this.renderActionMenu=e=>{const{groupFormat:t,currentGroups:o,format:r,schema:i,collectionContextStore:n}=this.props;return s()($o,{parent:e,groupFormat:t,currentGroups:o,format:r,schema:i,collectionContextStore:n,groupsFormatKey:"board_columns",groupsLimitStore:n.boardColumnsLimit})},this.handleCollectionGroupValueChange=e=>{const{collectionContextStore:t,...o}=this.props,r=t.collectionStore();r&&(V.w$({...e,environment:this.environment,groupsFormatKey:"board_columns",collectionStore:r,collectionContextStore:t,...o}),B.wd({environment:this.environment,collectionContextStore:t,action:"rename_group"}))},this.handleAddItemClick=()=>{const{device:e}=this.environment;if(!$e.M_(this.environment))return;const{format:t,groupFormat:o,onAddItem:r,collectionContextStore:i,isFullScreen:n}=this.props;if("collectionTypedView"===i.contextType)return;const s=Boolean(t.collection_group_by);i.searchQuery.state&&E.Ug({searchQuery:"",collectionContextStore:i,isFullScreen:n});const l=i.collectionStore(),a=i.groupsStore.getGroupState(o);if(!l||!a)return;const c=a.resultsStore;N.createAndCommit({userAction:"BoardGroupHeader.handleAddItemClick",environment:this.environment,perform:t=>{const{coercionSucceeded:n,newStore:l}=V.IW({environment:this.environment,collectionContextStore:i,groupsPointer:[o],results:c.state,insertAtIndex:0,coerce:!0,initializeDefaultTemplate:!0,transaction:t,from:"board_group_header"});if(e.isMobile){const e=(0,oe.ZP)({store:l,pageVisitSource:g.tY.Create});this.navigate(e)}else if(n&&!s){const e=l.getBlockTitleStore();H.eP({environment:this.environment,store:l}),z.NX({store:e}),E.Z5({store:l})}else L.peekBlock({environment:this.environment,store:l,peekMode:(0,ee.kr)(i.collectionViewStore()),resultsStore:c,collectionContextStore:i,pageVisitSource:g.tY.Create});r&&r(l),T.W2j(this.environment,{from:"board_group_add_item_top",type:"page",new_page_id:l.id,...(0,j.Pn)(i)})}})},this.handleAggregationChange=e=>{const{collectionContextStore:t,query:o}=this.props,r=t.collectionViewStore(),i={...o,aggregations:e?[e]:[]};r&&N.createAndCommit({userAction:"BoardGroupHeader.handleAggregationChange",environment:this.environment,perform:e=>{E.iG({collectionViewStore:r,update:{query2:i},transaction:e})}})},this.handleMouseMove=()=>{this.props.hoveredGroupStore.state!==this.props.groupFormat&&this.props.hoveredGroupStore.setState(this.props.groupFormat)},this.colorStore=this.createComputedStore((()=>{const{groupFormat:e,schema:t,format:o,collectionContextStore:r}=this.props;return(0,Oe.II)({environment:this.environment,groupFormat:e,schema:t,format:o,collectionContextStore:r,theme:this.theme})}),!0),this.isHoveredStore=this.createComputedStore((()=>(0,Ae.ZH)(this.props.hoveredGroupStore.state,this.props.groupFormat)))}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):L.navigate({environment:this.environment,url:e})}renderComponent(){const{disabled:e,collectionContextStore:t}=this.props,o=t.permissionScopes.state,r=t.shouldAllowNewItemCreation();return s()("div",{style:this.getStyle(),onMouseMove:this.handleMouseMove},void 0,this.renderValue(),this.renderAggregation(),s()("div",{style:{flexGrow:1}}),!e&&o.canConfigureBlock&&this.renderActionButton(),r&&this.renderAddButton())}renderAggregation(){const{disabled:e,query:t,schema:o,collectionContextStore:r,groupFormat:i}=this.props,n=t.aggregations?t.aggregations[0]:void 0,l=r.permissionScopes.state;return s()(mt,{groupFormat:i,disabled:e||!l.canConfigureBlock,aggregation:n,schema:o,collectionContextStore:r,color:this.getTextColor(),onChange:this.handleAggregationChange})}renderValue(){const{groupFormat:e,schema:t,disabled:o,currentGroups:r,format:i,groupBy:n,collectionContextStore:l}=this.props,a=Yo(i),c=l.permissionScopes.state;if(l.groupsStore.getGroupState(e))return s()(qo.Z,{groupBy:n,groupFormat:e,currentGroups:r,schema:t,disabled:o||!c.canConfigureBlock,isHiddenGroup:!1,onChange:this.handleCollectionGroupValueChange,style:{maxWidth:a-70},collectionContextStore:l})}renderActionButton(){const{device:e}=this.environment;return s()(it.ZP,{popupType:e.isMobile?it.Z4.SlideUp:it.Z4.Popup,renderOrigin:e=>c.createElement(lo.Z,i()({icon:y.Z.dots,iconStyle:{fill:this.getTextColor()},style:this.getIconButtonStyle()},e)),render:this.renderActionMenu})}renderAddButton(){var e;const{collectionContextStore:t,intl:o}=this.props,r=null===(e=t.collectionStore())||void 0===e?void 0:e.getFormat().app_config_uri,n=(0,S.hf)(r);return s()(ht.Z,{renderTooltip:()=>s()(P.FormattedMessage,{defaultMessage:"Create new {newItemName}",values:{newItemName:o.formatMessage(n)},id:"database.boardView.actions.addNewItem.tooltip"}),render:e=>c.createElement(lo.Z,i()({icon:y.Z.plus,onClick:this.handleAddItemClick,style:this.getIconButtonStyle(),iconStyle:{fill:this.getTextColor()}},e))})}getStyle(){const{hidden:e,format:t}=this.props,{device:o}=this.environment,r=Yo(t),i=this.colorStore.state,n=Boolean(t.collection_group_by);return{display:"flex",alignItems:"center",fontSize:14,width:r,paddingLeft:Zo,paddingRight:Zo,marginRight:10,marginBottom:e?4:0,boxSizing:"content-box",flexShrink:0,cursor:"pointer",...this.props.isPopup&&{padding:o.isMobile?"6px 16px":"8px 12px 4px",width:"none",minWidth:r},...i&&!e&&{backgroundColor:this.props.isInPeekRenderer?i.peekBackgroundColor:i.backgroundColor,...n?{borderRadius:5}:{borderTopLeftRadius:5,borderTopRightRadius:5}}}}getTextColor(){const e=this.colorStore.state;return!this.props.hidden&&e?e.textColor:this.theme.lightTextColor}getIconButtonStyle(){const{hidden:e}=this.props;if(!e)return{transition:"opacity 100ms ease-in-out",opacity:this.isHoveredStore.state?1:0}}}function Yo(e){switch((e||{}).board_cover_size){case"large":return qe.Z.card.desktop.large.width;case"small":return qe.Z.card.desktop.small.width;case"medium":default:return qe.Z.card.desktop.medium.width}}Qo.displayName="BoardGroupHeader",Qo.contextTypes={...K.wK,...h.w};const jo=Qo;class Xo extends m.default{getInitialState(){return{searchQuery:"",limit:Xo.defaultLimit}}}Xo.defaultLimit=20,Xo.loadMoreScrollOffset=200,Xo.loadMoreIncrement=20;const Jo=Xo;var er=o(72087),tr=o(21199),or=o(68894),rr=o(43765),ir=o(37064);const nr=(0,P.defineMessages)({searchPlaceholder:{defaultMessage:"Search for a page…",id:"boardHiddenGroup.searchPlaceholder"}});class sr extends h.Z{constructor(){super(...arguments),this.createdStores=new Set,this.storeTypes={buttonPopupStore:me.Z,boardHiddenGroupStore:Jo,requestStore:er.Z},this.renderPopup=()=>{const{device:e}=this.environment,{groupFormat:t,schema:o,currentGroups:r,collectionContextStore:n,groupBy:l}=this.props;let a;a=e.isMobile?{menuType:et.og.Modal,title:s()(qo.Z,{groupBy:l,groupFormat:t,currentGroups:r,schema:o,disabled:!0,isHiddenGroup:!0,collectionContextStore:n}),left:s()(it.ZP,{popupType:ct.kQ.SlideUp,renderOrigin:e=>c.createElement("div",e,y.Z.dots({width:18,height:18,color:this.theme.lightTextColor})),render:this.renderActionButtonPopup}),right:s()(lt.DoneMenuText,{}),onClickRight:this.handlePopupClose,header:this.renderHeader()}:{menuType:et.og.Popup,header:this.renderHeader()};const d=this.reducerStore.state;if(d)return s()(ir.Z,{store:this.selectableBlockStore,isDefaultContainer:!0,droppable:!0,render:e=>{let{selectableEvents:o}=e;return c.createElement(nt.Z,i()({},a,o),s()(ot.Z,{id:`board_hidden_group:${(0,Ae.mD)(t)}`,reducer:d,groupsPointer:[t],collectionContextStore:n,resultStore:this.reducerResultStore(),render:this.renderResults}),s()(_o.Z,{onChange:this.handleScrollOffsetChange}))}})},this.renderResults=()=>{var e,t;const{device:o}=this.environment,{groupFormat:r,disabled:i,format:n,collectionContextStore:l,schema:a,blockPropertyValueOverlayStore:c}=this.props,d=null===(e=this.reducerResultStore())||void 0===e?void 0:e.state,h=null===(t=this.resultsStore())||void 0===t?void 0:t.state;return d&&h?0===h.length?s()(dt.Z,{},void 0,s()(rr.Z,{title:s()(P.FormattedMessage,{defaultMessage:"No results",id:"database.boardView.searchResults.noResults.label"})})):s()("div",{style:{padding:o.isMobile?"8px 16px":"6px 14px 8px"}},void 0,s()(Ao,{collectionContextStore:l,groupsPointer:[r],format:n,canDrag:!i,onSelectableEnter:this.handleBoardItemEnter,disableRequest:!0,resultProps:{format:n,schema:a,disabled:i,coverFormat:this.getCoverFormat(),coverAspectFormat:this.getCoverAspectFormat(),coverSizeFormat:this.getCoverSizeFormat(),shouldShowTitle:vt.K8(this.props.format,"board"),colorStyle:void 0,blockPropertyValueOverlayStore:c,onTextEnter:this.handleBoardItemTextEnter,onTextEsc:this.handleBoardItemTextEsc,onShiftEnter:this.handleBoardItemEnter,collectionContextStore:l},resultComponent:no,handleOpenPeekPage:Be.default.isSidePeekOpen()?void 0:this.handlePopupClose,canDrop:!0,disabled:i,shouldShowHoverMenu:!1,direction:Do.Vertical,belowDropZoneMargin:2,emptyDroppableSize:4,analyticsName:"board"})):s()(dt.Z,{},void 0,s()(rr.Z,{title:s()(so.Z,{})}))},this.renderActionButtonPopup=e=>{const{groupFormat:t,currentGroups:o,format:r,schema:i,collectionContextStore:n}=this.props;if(n.collectionStore())return s()($o,{parent:e,groupFormat:t,currentGroups:o,format:r,schema:i,collectionContextStore:n,groupsFormatKey:"board_columns",groupsLimitStore:n.boardColumnsLimit})},this.handlePopupClose=()=>{this.stores.buttonPopupStore.setState({open:!1})},this.handleSearchInputChange=e=>{this.stores.boardHiddenGroupStore.setState({searchQuery:e.target.value,limit:Jo.defaultLimit}),this.clearSelectionIfBlockIsSelected()},this.handleSearchClearButtonClick=()=>{this.stores.boardHiddenGroupStore.reset(),this.clearSelectionIfBlockIsSelected()},this.handleButtonPopupClick=()=>{this.stores.boardHiddenGroupStore.reset(),this.clearSelectionIfBlockIsSelected()},this.handleDrop=e=>{const{droppedStores:t,duplicate:o}=e,{collectionContextStore:r,groupFormat:i}=this.props,n=d.findDOMNode(this);n&&n instanceof Element&&N.createAndCommit({userAction:"BoardHiddenGroup.handleDrop",environment:this.environment,perform:e=>V.BO({environment:this.environment,collectionContextStore:r,groupsPointer:[i],droppedStores:t,duplicate:o,transaction:e})})},this.handleBoardAggregationChange=e=>{const{collectionContextStore:t,query:o}=this.props,r=t.collectionViewStore(),i={...o,aggregations:e?[e]:[]};r&&N.createAndCommit({userAction:"BoardHiddenGroup.handleBoardAggregationChange",environment:this.environment,perform:e=>{E.iG({collectionViewStore:r,update:{query2:i},transaction:e})}})},this.handleBoardGroupHeaderAddItem=e=>{this.createdStores.add(e)},this.handleScrollOffsetChange=e=>{var t;const{collectionContextStore:o}=this.props,{boardHiddenGroupStore:r}=this.stores,i=r.state,n=null===(t=this.reducerResultStore())||void 0===t||null===(t=t.state)||void 0===t?void 0:t.blockIds,s=o.isLoading.state;e<Jo.loadMoreScrollOffset&&!s&&n&&i.limit<=n.length&&r.setState({...i,limit:i.limit+Jo.loadMoreIncrement})},this.handleBoardItemEnter=e=>{const{blocks:t,transaction:o}=e,{groupFormat:r,collectionContextStore:i,isFullScreen:n}=this.props,s=i.groupsStore.getGroupState(r);if(!s)return;const l=s.resultsStore;if(t.length>0&&l.state.length>0){const e=t[0];if(!$e.M_(this.environment)||!i.collectionStore()||!i.shouldAllowNewItemCreation())return;const s=l.state.findIndex((t=>t===e))+1;St({transaction:o,environment:this.environment,resultsStore:l,collectionContextStore:i,isFullScreen:n,groupsPointer:[r],insertAtIndex:s,from:"board_group_enter_add_item",transient:!0})}},this.handleBoardItemTextEnter=e=>{const{collectionContextStore:t,isFullScreen:o,groupFormat:r}=this.props,i=this.resultsStore();if(!i)return;if(!$e.M_(this.environment)||!t.collectionStore())return this.handleBoardItemTextEsc(e);const n=i.state.findIndex((t=>t===e))+1;N.createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:this.environment,perform:e=>{St({transaction:e,environment:this.environment,resultsStore:i,collectionContextStore:t,isFullScreen:o,groupsPointer:[r],insertAtIndex:n,from:"board_group_enter_add_item",transient:!0})}})},this.handleBoardItemTextEsc=e=>{const{collectionContextStore:t}=this.props,o=t.collectionStore(),r=e.getTitleStore();if(gt.Q(r.getValue()))return void H.Ys({environment:this.environment,store:e});if(!o)return;const i=this.resultsStore();if(!i)return;const n=i.state.findIndex((t=>t===e))-1,s=t.collectionViewStore(),l=t.collectionViewBlockStore();if(s&&l&&T.sGw(this.environment,{...(0,j.Pn)(t),block_id:e.id}),N.createAndCommit({userAction:"BoardHiddenGroup.handleBoardItemTextEsc",environment:this.environment,perform:t=>{V.Od({store:e,transaction:t})}}),n>=0){const e=i.state[n];H.Ys({environment:this.environment,store:e})}},this.reducerStore=this.createComputedStore((()=>{const{groupFormat:e,schema:t,format:o}=this.props,{boardHiddenGroupStore:r}=this.stores,{searchQuery:i,limit:n}=r.state,s=(0,Ye.zk)({schema:t,group:e,timeZone:(0,je.r)()});if(!s)return;return{type:"results",filter:s,limit:n,searchQuery:i,loadContentCover:Boolean(o&&o.board_cover&&"page_content"===o.board_cover.type)}}))}willMount(e){super.willMount(e);const t=e.collectionContextStore.collectionViewBlockStore();t&&(this.selectableBlockStore=new Ve.G(this.environment,{table:b.iU,id:t.id}))}renderComponent(){const{device:e}=this.environment,{groupBy:t,groupFormat:o,disabled:r,query:n,schema:l,currentGroups:a,collectionContextStore:d}=this.props,h=n.aggregations?n.aggregations[0]:void 0;return s()(Ro.Z,{store:this.selectableBlockStore,canDropOnto:!r,onSelectableDrop:this.handleDrop,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0},void 0,s()(it.ZP,{popupType:e.isMobile?ct.kQ.SlideUp:ct.kQ.Popup,renderOrigin:e=>c.createElement(qt.Z,i()({key:(0,Ae.mD)(o),style:sr.buttonStyle},e),s()(qo.Z,{groupBy:t,groupFormat:o,currentGroups:a,schema:l,disabled:!0,isHiddenGroup:!0,collectionContextStore:d}),s()(mt,{groupFormat:o,aggregation:h,schema:l,collectionContextStore:d,disabled:!0,onChange:this.handleBoardAggregationChange})),render:this.renderPopup,buttonPopupStore:this.stores.buttonPopupStore,onClick:this.handleButtonPopupClick}))}renderHeader(){const{device:e}=this.environment,{groupFormat:t,disabled:o,format:r,schema:n,query:l,currentGroups:a,collectionContextStore:d,isFullScreen:h,hoveredGroupStore:p,groupBy:u,isInPeekRenderer:m,intl:g}=this.props,{searchQuery:S}=this.stores.boardHiddenGroupStore.state;return s()(c.Fragment,{},void 0,!e.isMobile&&s()(jo,{groupBy:u,currentGroups:a,groupFormat:t,query:l,schema:n,format:r,collectionContextStore:d,disabled:o||Boolean(S),hidden:!0,isPopup:!0,onAddItem:this.handleBoardGroupHeaderAddItem,isFullScreen:h,hoveredGroupStore:p,isInPeekRenderer:m,intl:g},(0,Ae.mD)(t)),s()("div",{style:{margin:e.isMobile?0:"6px 0"}},void 0,s()(tr.Z,{capture:!0,render:t=>c.createElement(or.ZP,i()({value:S,placeholder:ie.default.formatMessage(nr.searchPlaceholder),autoFocus:!e.isMobile,showClearButton:!0,onChange:this.handleSearchInputChange,onClearButtonClick:this.handleSearchClearButtonClick},t))})))}clearSelectionIfBlockIsSelected(){Vt.default.state.stores.length>0&&H.ZH(this.environment)}getCoverFormat(){const{format:e}=this.props;return e?e.board_cover:void 0}getCoverAspectFormat(){const{format:e}=this.props;return e?e.board_cover_aspect:void 0}getCoverSizeFormat(){const{format:e}=this.props;return e?e.board_cover_size:void 0}reducerResultStore(){const{collectionContextStore:e,groupFormat:t}=this.props,o=e.groupsStore.getGroupState(t);return null==o?void 0:o.reducerResultStore}resultsStore(){const{collectionContextStore:e,groupFormat:t}=this.props,o=e.groupsStore.getGroupState(t);return null==o?void 0:o.resultsStore}}sr.displayName="BoardHiddenGroup",sr.buttonStyle={display:"flex",alignItems:"center",justifyContent:"flex-start",height:32,padding:4,borderRadius:3};const lr=sr;var ar=o(4615),cr=o(97880),dr=o(68500);class hr extends h.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:me.Z},this.renderPopup=()=>{const{schema:e,currentGroups:t,groupBy:o}=this.props;return s()(dr.Z,{groupFormat:void 0,groupBy:o,currentGroups:t,schema:e,onChange:this.handleEditMenuChange,onClose:this.handleEditMenuClose,parentStore:this.props.parentStore})},this.handleEditMenuChange=e=>{const{collectionContextStore:t,groupBy:o,schema:r,currentGroups:i,onAccept:n,groupsLimitStore:s}=this.props,{newGroupValue:l}=e,a=r[o.property],c=s.state;if(a&&(0,Ae.LG)(a))if(B.wd({environment:this.environment,collectionContextStore:t,action:"board_add_group"}),this.stores.buttonPopupStore.reset(),Ct.cu(a)){if(a.type!==l.type)return;if(void 0===l.value)return;const e=a.options||[],t={id:(0,ar.ZP)(),value:l.value,color:(0,Ct.TL)(e)},s=[...e,t],d={...a,options:s},h={...r,[o.property]:d},p={property:o.property,value:l,hidden:!1};n({newGroups:(0,Oe.nr)(i,p,c),newSchema:h})}else if("person"===a.type||"relation"===a.type||(0,Ae.HB)(a.type)){const t={property:o.property,value:l,hidden:!1};n({newGroups:(0,Oe.nr)(i,t,c),newPage:e.newPage})}else(0,Ae.A1)(a.type)||"status"===a.type||"number"===a.type||"created_by"===a.type||"last_edited_by"===a.type||"formula"===a.type||"checkbox"===a.type||"location"===a.type||(0,cr.t1)(a.type)},this.handleEditMenuClose=()=>{this.stores.buttonPopupStore.reset()},this.boardColorStore=this.createComputedStore((()=>{const{schema:e,collectionContextStore:t}=this.props;return(0,Oe.II)({environment:this.environment,groupFormat:void 0,schema:e,format:t.normalizedFormatStore.state,collectionContextStore:t,theme:this.theme})}),!0)}renderComponent(){const{groupBy:e,schema:t,type:o}=this.props,{buttonPopupStore:r}=this.stores,n=t[e.property];if(n&&(0,Ae.LG)(n))return s()(it.ZP,{render:this.renderPopup,buttonPopupStore:r,popupType:this.environment.device.isMobile?it.Z4.SlideUp:it.Z4.Popup,renderOrigin:e=>{return"default"===o?c.createElement(at.Z,i()({isLightGray:!0,icon:y.Z.plus,style:{display:"flex",height:28,marginTop:12,marginBottom:4,width:"max-content",position:this.props.stickyLeft?"sticky":void 0,left:this.props.stickyLeft&&this.props.paddingLeft?this.props.paddingLeft:0,...this.props.style}},e),s()(P.FormattedMessage,{defaultMessage:"Add a group",id:"database.boardView.addGroupButtonTitle"})):c.createElement(lo.Z,i()({icon:e=>y.Z.plus({...e,fill:this.theme.mediumTextColor}),style:{width:35,background:null===(t=this.boardColorStore.state)||void 0===t?void 0:t.backgroundColor,paddingLeft:10,paddingRight:10,paddingTop:Zo,paddingBottom:Zo,marginRight:5,borderRadius:5,height:33,...this.props.style}},e));var t}})}}hr.displayName="CollectionAddGroupButton";const pr=hr;class ur extends h.Z{constructor(){super(...arguments),this.renderMenu=e=>{const{device:t}=this.environment;let o;return o=t.isMobile?{menuType:et.og.Modal,title:s()(P.FormattedMessage,{defaultMessage:"Aggregation",id:"database.collectionGroupAggregation.title"}),right:s()(lt.DoneMenuText,{}),onClickRight:e.close}:{menuType:et.og.Popup,width:200},c.createElement(nt.Z,o,s()(st.Z,{type:st.i.Vertical,initialFocus:0,sections:[{key:"aggregation section",render:e=>c.createElement(dt.Z,e),items:this.getAggregationActions()}],onAccept:e.close}))},this.handleChangeAggregation=e=>{const{collectionContextStore:t,format:o,groupAggregationKey:r}=this.props,i=t.collectionViewStore();i&&N.createAndCommit({userAction:"CollectionGroupAggregation.handleChangeAggregation",environment:this.environment,perform:t=>{E.iG({collectionViewStore:i,update:{format:{...o,[r]:e}},transaction:t})}}),T.wds(this.environment,{view_type:this.getCurrentViewType(),action:"change_aggregation"})},this.renderAggregationMenuItem=(e,t,o)=>{const r=Je.Sn[e];return s()(ht.Z,{placement:ct.GI.Placement.Right,delayThreshold:0,render:e=>c.createElement(rt.Z,i()({title:t},(0,tt.Z)(e,o))),renderTooltip:()=>s()("div",{style:{width:140,whiteSpace:"normal"}},void 0,r&&s()("img",{src:(0,Xe.D)(r),style:{borderRadius:3,width:140,marginTop:4}}),Je.BG[e])},o.key)},this.aggregationStore=this.createComputedStore((()=>{const{format:e,groupAggregationKey:t}=this.props;return e[t]||{aggregator:"count"}}),!0),this.reducerStore=this.createComputedStore((()=>{const{schema:e,groupFormat:t}=this.props,o=this.aggregationStore.state;return{type:"aggregation",filter:(0,Ye.zk)({schema:e,group:t,timeZone:(0,je.r)()}),aggregation:o}}))}renderComponent(){const{device:e}=this.environment;return s()(ht.Z,{renderTooltip:()=>this.renderTooltipText(),render:t=>s()(it.ZP,{popupType:e.isMobile?it.Z4.SlideUp:it.Z4.Popup,renderOrigin:e=>c.createElement(at.Z,i()({disabled:this.props.disabled,style:{fontWeight:x.Z.fontWeight.medium,color:this.theme.lightTextColor,height:24}},(0,tt.Z)((0,tt.Z)(t,e),{onClick:re.Wi})),this.renderValue()),disabled:this.props.disabled,render:this.renderMenu})})}renderTooltipText(){const{schema:e}=this.props,t=this.aggregationStore.state,o=Je.VN[(0,Qe.OV)(t)];if((0,Qe.pK)(t)){const r=e[t.property];if(r){return`${o} in ${r.name}`}}return o}renderValue(){const{schema:e,collectionContextStore:t,groupFormat:o}=this.props,r=this.aggregationStore.state,i=this.reducerStore.state;if(i)return s()(ot.Z,{id:`group_aggregation:${(0,Ae.mD)(o)}`,collectionContextStore:t,reducer:i,groupsPointer:[o],render:t=>{const o=t.state;if(!o||"aggregation"!==o.type)return;let i;if((0,Qe.pK)(r)){const t=e[r.property];!t||"formula"!==t.type&&"number"!==t.type||(i=t.number_format)}return(0,Je.Ol)({numberFormat:i,dateFormat:void 0,aggregationType:r.aggregator,userTimeZone:(0,je.r)(),value:o.aggregationResult,roundDecimal:5})}})}getAggregationActions(){const e=[];for(const n of Qe.o5)e.push(this.createCountAggregationAction(n));const t=this.getDefaultProperties();if(t.length>0)for(const n of Qe.Sy)"show_unique"!==n&&e.push(this.getAggregationGroupAction(n,t));const o=this.getNumericProperties();if(o.length>0)for(const n of Qe.k$)e.push(this.getAggregationGroupAction(n,o));const r=this.getDateProperties();if(r.length>0)for(const n of Qe.f8)e.push(this.getAggregationGroupAction(n,r));const i=this.getCheckboxProperties();if(i.length>0)for(const n of Qe.gC)e.push(this.getAggregationGroupAction(n,i));return e}getAggregationGroupAction(e,t){const{device:o}=this.environment,r=Je.VN[e],n=a().compact(t.map((t=>this.createPropertyAggregationAction(t,e))));return{key:e+r,render:(e,t)=>c.createElement(pt.Z,i()({},e,{onFocus:t.onFocus,renderOrigin:(e,t)=>c.createElement(rt.Z,i()({},e,{ref:t,title:r})),renderExtension:(e,i)=>{let l;return l=o.isMobile?{menuType:et.og.Modal,title:r,right:o.isPhone?s()(lt.DoneMenuText,{}):void 0,onClickRight:i.close,...e}:{menuType:et.og.Popup,width:200,...e},c.createElement(nt.Z,l,s()(st.Z,{type:st.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>c.createElement(dt.Z,e),items:n}],onAccept:t.onAccept}))}})),action:()=>null}}getDefaultProperties(){const{schema:e}=this.props;return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Qe.iV)(o)&&!("rollup"===o.type&&"status"===o.target_property_type)}))}getNumericProperties(){const{schema:e}=this.props;return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Qe.O4)(o)}))}getDateProperties(){const{schema:e}=this.props;return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Qe.dN)(o)}))}getCheckboxProperties(){const{schema:e}=this.props;return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,Qe.Mv)(o)}))}createCountAggregationAction(e){const t=Je.VN[e];return{key:e,render:o=>this.renderAggregationMenuItem(e,t,o),action:()=>{this.handleChangeAggregation({aggregator:e})}}}createPropertyAggregationAction(e,t){const o=this.props.schema[e];if(!o)return;const r=o.name;return{key:`${e} ${t}`,render:e=>this.renderAggregationMenuItem(t,r,e),action:()=>{this.handleChangeAggregation({aggregator:t,property:e})}}}getCurrentViewType(){const{collectionContextStore:e}=this.props,t=e.collectionViewStore(),o=null==t?void 0:t.getType();if(!o)throw new Error("View type was not defined.");return o}}ur.displayName="CollectionGroupAggregation";var mr=o(45697),gr=o.n(mr),Sr=o(55010);function vr(e){const{element:t,container:o}=e,r=function(e){for(;;){const t=br(e);if(!t)return e;e=t}}(o),{store:i}=r.stores,{containerMap:n}=i.state,s=n.get(o);s?s.add(t):n.set(o,new Set([t])),i.emit()}function yr(e,t,o,r){return e<-r||e>t?0:e>=t-o-1?t-o+r-1:e+r}function fr(e,t,o,r){return e-r<0||e>t?0:e<o?o-t:e-t}function Cr(e){const t=[];for(;;){const o=br(e);if(!o)break;e=o,t.push(e)}return t}function br(e){if(e.context.computedStickyContainer&&!e.props.ignoreAncestorContainer)return e.context.computedStickyContainer}function wr(e,t){for(const o in t)e.style[o]=t[o]||""}o(95477);class xr extends h.Z{constructor(){super(...arguments),this.element=void 0}didMount(){const{computedStickyContainer:e}=this.context;e&&vr({element:this,container:e});const t=d.findDOMNode(this);if(t){this.element=t;const e=this.props.getComputedStyle?this.props.getComputedStyle(!1):void 0;e&&wr(t,e)}}willUnmount(){const{computedStickyContainer:e}=this.context;e&&function(e){const{element:t,container:o}=e,{store:r}=o.stores,{containerMap:i}=r.state,n=i.get(o);n&&n.delete(t),r.emit()}({element:this,container:e}),this.element=void 0}renderComponent(){if(this.props.children)return c.Children.only(this.props.children)}}xr.displayName="ComputedStickyElement",xr.contextTypes={computedStickyContainer:gr().any,...h.w};const kr=xr;class Pr extends h.Z{constructor(){super(...arguments),this.storeTypes={hovered:m.default.createClass(!1)},this.renderActionMenu=e=>{const{groupFormat:t,currentGroups:o,format:r,schema:i,collectionContextStore:n,groupsFormatKey:l}=this.props;return s()($o,{parent:e,groupFormat:t,currentGroups:o,format:r,schema:i,collectionContextStore:n,groupsLimitStore:n.groupsLimit,groupsFormatKey:l})},this.handleAddItemClick=()=>{const{groupFormat:e,collectionContextStore:t,isFullScreen:o,onGroupHeaderAddItem:r}=this.props,i=t.groupsStore.getGroupState(e);i&&$e.M_(this.environment)&&(t.searchQuery.state&&E.Ug({searchQuery:"",collectionContextStore:t,isFullScreen:o}),N.createAndCommit({userAction:"CollectionGroupHeader.handleAddItemClick",environment:this.environment,perform:o=>{const{coercionSucceeded:n,newStore:s}=V.IW({environment:this.environment,collectionContextStore:t,groupsPointer:[e],results:i.resultsStore?i.resultsStore.state:[],insertAtIndex:0,coerce:!0,initializeDefaultTemplate:!0,transaction:o,from:"group_header"});r(s,n,this.props),T.W2j(this.environment,{from:"group_add_item_top",type:"page",new_page_id:s.id,...(0,j.Pn)(t)})}}))},this.handleCollectionGroupValueChange=e=>{const t=this.props.collectionContextStore.collectionStore();t&&(V.w$({...e,environment:this.environment,collectionStore:t,...this.props}),T.wds(this.environment,{view_type:this.getCurrentViewType(),action:"rename_group"}))},this.handleToggleButtonClick=()=>{const{groupFormat:e,collectionContextStore:t}=this.props,o=t.groupsStore.getGroupState(e);if(!o)return;H.ZH(this.environment);const r=!o.toggleStateStore.state;if(V.uo({environment:this.environment,groupFormat:e,toggleStateStore:o.toggleStateStore,newValue:r,collectionContextStore:t}),!r){const e=d.findDOMNode(this),o=null==e?void 0:e.parentElement;o&&p.default.afterNextFlush((()=>{(0,le.Oc)({el:o,windowHeight:this.environment.WindowSizeStore.state.height,minEdgeDist:50}),t.renderEmitter.emit()}))}},this.handleMouseMove=()=>{this.stores.hovered.setState(!0)},this.handleMouseLeave=()=>{this.stores.hovered.setState(!1)},this.handleDrop=e=>{const{droppedStores:t,duplicate:o}=e,{collectionContextStore:r,groupFormat:i}=this.props,n=d.findDOMNode(this);n&&n instanceof Element&&N.createAndCommit({userAction:"CollectionGroupHeader.handleDrop",environment:this.environment,perform:e=>V.BO({environment:this.environment,collectionContextStore:r,groupsPointer:[i],droppedStores:t,duplicate:o,transaction:e})})}}willMount(e){super.willMount(e);const t=e.collectionContextStore.collectionViewBlockStore();t&&(this.selectableBlockStore=new Ve.G(this.environment,{table:b.iU,id:t.id}))}renderComponent(){const{disabled:e,getComputedStickyStyle:t,isFullScreen:o,isRootChild:r,preventToggleBackground:i,groupFormat:n,collectionContextStore:l}=this.props,a=(0,Oe.qW)({device:this.environment.device,isFullScreen:o,isRootChild:r}),c=l.groupsStore.getGroupState(n);if(!c)return;const d=c.toggleStateStore.state,h=l.permissionScopes.state,p=l.shouldAllowNewItemCreation(),u=s()("div",{style:{display:"flex",alignItems:"center",position:this.props.stickyLeft?"sticky":void 0,left:this.props.paddingLeft+this.getToggleButtonWidth()+2}},void 0,this.renderValue(),this.renderAggregation(),!e&&h.canConfigureBlock&&this.renderActionButton(),p&&this.renderAddButton());return s()(kr,{position:Ue.Top,getComputedStyle:t},void 0,s()("div",{style:this.getStyle(),onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave},void 0,s()("div",{style:this.getStickyWrapStyle(d)},void 0,a?s()("div",{style:{display:"flex",flexDirection:"row-reverse",paddingRight:2,...this.props.stickyLeft&&{position:"sticky",left:this.props.paddingLeft}}},void 0,s()("div",{style:{display:"flex",alignItems:"center",background:i?this.theme.cardContentBackground:void 0,height:this.getHeight()}},void 0,this.renderToggleButton(c.toggleStateStore))):this.renderToggleButton(c.toggleStateStore),d?u:s()(Ro.Z,{store:this.selectableBlockStore,canDropOnto:!e,onSelectableDrop:this.handleDrop,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0,groupsPointer:[n],style:{display:"flex",alignItems:"center",height:"100%"}},void 0,u)),this.props.children))}renderToggleButton(e){const t=e.state;return s()(Bo.Z,{isSidebar:!1,open:t,fill:!0,onClick:this.handleToggleButtonClick,onMouseDown:re.$0,style:{flexShrink:0,...this.props.stickyLeft&&{position:"sticky",left:this.props.paddingLeft}}})}renderValue(){const{groupFormat:e,schema:t,disabled:o,currentGroups:r,groupBy:i,collectionContextStore:n}=this.props,l=n.permissionScopes.state;return s()(qo.Z,{groupBy:i,groupFormat:e,currentGroups:r,schema:t,disabled:o||!l.canConfigureCollection||l.isSyncedCollection,isHiddenGroup:!1,onChange:this.handleCollectionGroupValueChange,style:{maxWidth:400,lineHeight:"24px"},uncategorizedIconStyle:{marginLeft:2},collectionContextStore:n})}renderAggregation(){const{disabled:e,format:t,schema:o,collectionContextStore:r,groupFormat:i,groupAggregationKey:n}=this.props,l=r.permissionScopes.state;return s()(ur,{groupFormat:i,disabled:e||!l.canConfigureBlock,groupAggregationKey:n,format:t,schema:o,collectionContextStore:r})}renderActionButton(){const{device:e}=this.environment;return s()(it.ZP,{popupType:e.isMobile?it.Z4.SlideUp:it.Z4.Popup,renderOrigin:e=>c.createElement(lo.Z,i()({icon:y.Z.dots},e)),onClick:re.Wi,render:this.renderActionMenu})}renderAddButton(){return s()(ht.Z,{renderTooltip:()=>s()(P.FormattedMessage,{defaultMessage:"Create new",id:"database.collectionGroupHeader.actions.addNewPage.tooltip"}),render:e=>c.createElement(lo.Z,i()({icon:y.Z.plus,onClick:this.handleAddItemClick},e))})}getCurrentViewType(){const{collectionContextStore:e}=this.props,t=e.getViewType();if(!t)throw new Error("View type was not defined.");return t}getStyle(){var e;const t=(null===(e=this.props.collectionContextStore.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||void 0,o=this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground;return{position:"relative",zIndex:k.sL,width:"100%",background:void 0===t?o:t,fontSize:14,...this.props.style}}getStickyWrapStyle(e){const{isFullScreen:t,isRootChild:o,paddingLeft:r}=this.props,{paddingTop:i,toggleClosedMarginBottom:n}=this.props;return{display:"flex",alignItems:"center",height:this.getHeight(),paddingTop:i,...this.props.stickyLeft&&{position:"sticky",left:t||o?r:0},...!e&&{marginBottom:n}}}getHeight(){return this.props.height||33}getToggleButtonWidth(){return(0,Bo.q)({isSidebar:!1,isMobile:this.environment.device.isMobile})}}Pr.displayName="CollectionGroupHeader";const Tr=Pr;var Rr=o(54087),Ir=o.n(Rr);class Mr extends m.default{getInitialState(){return{containerMap:new Map}}}const Br=Mr;class Vr extends h.Z{constructor(){super(...arguments),this.element=void 0,this.scrollableAncestor=void 0,this.resizingAncestor=void 0,this.callbackQueued=!1,this.resizeObserver=new ResizeObserver((()=>{this.handleScroll()})),this.storeTypes={store:Br},this.handleScroll=()=>{this.callbackQueued||(this.callbackQueued=!0,Ir()((()=>{this.callbackQueued=!1,this.mutateDOM((()=>{!function(e){const{environment:t,container:o}=e,{device:r}=t,{store:i}=o.stores,{containerMap:n}=i.state,s=Array.from(n.keys()).sort(((e,t)=>{if(e.element&&t.element)return(0,Sr.Z)(e.element,t.element);throw new Error("Element not found")})),l=new Map;for(const a of s){const{element:e,scrollableAncestor:t}=a,o=n.get(a);if(!e||!t||!o)continue;const i=Cr(a).reduce(((e,t)=>e+(l.get(t)||0)),0),s=t.getBoundingClientRect(),c=e.getBoundingClientRect(),d=s.height,h=Math.floor(s.top-c.top),p=Math.floor(s.top+d-c.top),u=Math.floor(c.height)+(a.props.isFullScreen&&!r.isSafari?ge.Z.state:0),m=Array.from(o.values()).sort(((e,t)=>{if(e.element&&t.element)return(0,Sr.Z)(e.element,t.element);throw new Error("Element not found")}));let g=i,S=0;for(const r of m){if(!r.element)continue;const e=r.element.getBoundingClientRect(),t=g+e.height;r.props.position===Ue.Top&&(S+=e.height);const o=yr(h,u,t,i),n=fr(p,u,t,S);if(r.props.position===Ue.Top){const e=0!==o,t=r.props.getComputedStyle?r.props.getComputedStyle(e):void 0;e?(r.element.style.transform=`translate3d(0, ${o}px, 0)`,r.element.style.bottom=""):(r.element.style.transform="",r.element.style.bottom=""),t&&wr(r.element,t)}else{const e=0!==n,t=r.props.getComputedStyle?r.props.getComputedStyle(e):void 0;if(e?(r.element.style.transform=`translate3d(0, ${n}px, 0)`,r.element.style.top=""):(r.element.style.transform="",r.element.style.top=""),t)for(const o in t)r.element.style[o]=t[o]||""}g=t}l.set(a,g)}}({environment:this.environment,container:this})}))})))},this.handleResizeThrottled=a().throttle(this.handleScroll,100)}didMount(){!function(e){const{container:t,parentContainer:o}=e,r=o?o.stores.store:t.stores.store;r.state.containerMap.has(t)||r.state.containerMap.set(t,new Set),r.emit()}({container:this,parentContainer:br(this)}),(0,le.Gf)(this.environment)&&this.attachEvents()}willUnmount(){!function(e){const{container:t,parentContainer:o}=e,r=o?o.stores.store:t.stores.store;r.state.containerMap.delete(t),r.emit()}({container:this,parentContainer:br(this)}),(0,le.Gf)(this.environment)&&this.removeEvents(),this.element=void 0,this.scrollableAncestor=void 0}getChildContext(){return{...this.context,computedStickyContainer:this}}renderComponent(){if(this.props.children)return c.Children.only(this.props.children)}attachEvents(){const e=br(this),t=d.findDOMNode(this);if(t){this.element=t;const o=(0,le.VW)(t);o&&(this.scrollableAncestor=o,e||((0,te.lj)(o,"scroll",this.handleScroll),(0,te.lj)(window,"resize",this.handleResizeThrottled),this.resizeObserver.observe(this.element)));const r=(0,le.Ez)(this.element);r&&(this.resizingAncestor=r,this.resizeObserver.observe(this.resizingAncestor))}this.props.renderEmitter&&this.props.renderEmitter.addListener(this.handleScroll)}removeEvents(){this.scrollableAncestor&&((0,te.ZV)(this.scrollableAncestor,"scroll",this.handleScroll),(0,te.ZV)(window,"resize",this.handleResizeThrottled),this.element&&this.resizeObserver.unobserve(this.element)),this.resizingAncestor&&this.resizeObserver.unobserve(this.resizingAncestor),this.props.renderEmitter&&this.props.renderEmitter.removeListener(this.handleScroll)}}Vr.displayName="ComputedStickyContainer",Vr.contextTypes={computedStickyContainer:gr().any,...h.w},Vr.childContextTypes={computedStickyContainer:gr().any,...h.w};const Fr=Vr;class Dr extends h.Z{willMount(e){super.willMount(e);const{groupFormat:t,collectionContextStore:o}=this.props;V.V$({environment:this.environment,collectionContextStore:o,groupFormat:t})}renderComponent(){const{renderGroup:e,groupFormat:t,groupsDisplayState:o,disabled:r,groupsFormatKey:i,groupAggregationKey:n,format:l,schema:a,collectionContextStore:d,onGroupHeaderAddItem:h,renderHeader:p,getGroupStyle:u,stickyLeft:m,ignoreAncestorStickyContainer:g,paddingLeft:S,isFullScreen:v,index:y,isRootChild:f,isInPeekRenderer:C,groupBy:b,isLast:w}=this.props,x=d.groupsStore.getGroupState(t);if(!x)return;const{toggleStateStore:k}=x,P=k.state,T={groupFormat:t,currentGroups:o.currentGroups,disabled:r,groupsFormatKey:i,groupAggregationKey:n,format:l,schema:a,collectionContextStore:d,isFullScreen:v,isInPeekRenderer:C,onGroupHeaderAddItem:h,stickyLeft:m,index:y,paddingLeft:S,isRootChild:f,groupBy:b};return s()(Fr,{ignoreAncestorContainer:g,renderEmitter:d.renderEmitter,isFullScreen:v},void 0,s()("div",{style:{width:"100%",position:"relative",...u?u({groupFormat:t,...o,index:y,isLast:w,toggleStateStore:k}):void 0}},void 0,p?p(T):c.createElement(Tr,T),P&&e(t)))}}Dr.displayName="CollectionGroup";const Er=Dr;class Ar extends h.Z{constructor(){super(...arguments),this.handleClickLoadMoreGroups=()=>{const{collectionContextStore:e,groupsLimitStore:t}=this.props;t.setState(t.state+Oe.kW),e.loadingDetails.setState({type:"load_more_groups"}),B.tf(this.environment)},this.handleClickLoadMoreSubgroups=()=>{const{collectionContextStore:e,groupsLimitStore:t}=this.props;t.setState(t.state+Oe.kW),e.loadingDetails.setState({type:"load_more_subgroups"}),B.tf(this.environment)},this.boardColorStore=this.createComputedStore((()=>{const{schema:e,collectionContextStore:t}=this.props;return(0,Oe.II)({environment:this.environment,groupFormat:void 0,schema:e,format:t.normalizedFormatStore.state,collectionContextStore:t,theme:this.theme})}),!0)}renderComponent(){const{collectionContextStore:e,visibleGroups:t,total:o,hiddenGroups:r,type:i}=this.props,n=Math.min(Oe.kW,o-r.length-t.length),l=He({collectionContextStore:e,isForSubgroups:"board"===i});return"default"===i?s()(at.Z,{onClick:this.handleClickLoadMoreGroups,onMouseDown:re.$0,disabled:l,hoveredStyle:l?{background:this.theme.whiteButtonBackground}:{},style:{display:"flex",alignItems:"center",fontSize:14,borderRadius:3,height:30,marginTop:4,marginBottom:4,paddingLeft:2,paddingTop:2,paddingBottom:2,paddingRight:8,...this.props.style}},void 0,y.Z.dots({width:14,fill:this.theme.mediumTextColor,marginLeft:4,marginTop:1,marginRight:8}),s()(P.FormattedMessage,{id:"database.groups.loadMoreButtonDefault.text",defaultMessage:"Show {loadMoreAmount, plural, one {{loadMoreAmount} more group} other {{loadMoreAmount} more groups}}",values:{loadMoreAmount:n}}),l&&s()("div",{style:{marginTop:1,marginLeft:8}},void 0,s()(so.Z,{style:{width:12,height:12}}))):s()(at.Z,{onClick:this.handleClickLoadMoreSubgroups,onMouseDown:re.$0,disabled:l,hoveredStyle:l?{background:this.theme.whiteButtonBackground}:{},style:{background:null===(a=this.boardColorStore.state)||void 0===a?void 0:a.backgroundColor,color:this.theme.mediumTextColor,fontWeight:x.Z.fontWeight.medium,paddingLeft:8,paddingRight:8,height:33,marginRight:10,borderRadius:5,width:90,...this.props.style}},void 0,s()("span",{style:{flexGrow:1}},void 0,s()(P.FormattedMessage,{id:"database.groups.loadMoreButton.text",defaultMessage:"{loadMoreAmount} more",values:{loadMoreAmount:n}})),l?s()("div",{style:{marginLeft:4}},void 0,s()(so.Z,{style:{width:12,height:12}})):y.Z.dots({width:14,fill:this.theme.mediumTextColor,marginLeft:4,marginTop:1}));var a}}Ar.displayName="CollectionGroupsLoadMoreButton";const _r=Ar;class Zr extends h.Z{constructor(){super(...arguments),this.handleClick=()=>{const{hiddenGroupsVisible:e}=this.props;e.setState(!e.state)}}renderComponent(){const{hiddenGroups:e,hiddenGroupsVisible:t}=this.props,o=t.state;return s()(at.Z,{onClick:this.handleClick,onMouseDown:re.$0,style:{height:30,marginBottom:4,...this.props.style},icon:e=>y.Z.chevronDown({...e,...o&&{transform:"rotate(180deg)"}}),isLightGray:!0},void 0,s()(P.FormattedMessage,{id:"collectionHiddenGroupsButton.hiddenGroupsButton.text",defaultMessage:"{numberOfHiddenGroups, plural, one {{numberOfHiddenGroups} hidden group} other {{numberOfHiddenGroups} hidden groups}}",values:{numberOfHiddenGroups:e.length}}))}}Zr.displayName="CollectionHiddenGroupsButton";const Lr=Zr;var Or=o(34232);class Gr extends m.default{getInitialState(){return{}}}const Hr=Gr;class zr extends Ee.Z{renderComponent(){return s()(ro,{store:this.props.store,disabled:this.props.disabled,isFirstItem:this.props.isFirstItem,isLastItem:this.props.isLastItem,hideContent:this.props.hideContent,blockResizerStore:this.props.blockResizerStore,isQuickFind:this.props.isQuickFind,style:this.props.style,disableCommentMenu:this.props.disableCommentMenu,disableHoverMenu:this.props.disableHoverMenu,disableDrag:this.props.disableDrag,numberedListCounterStore:this.props.numberedListCounterStore,bulletedListFormatStore:this.props.bulletedListFormatStore,format:this.props.format,schema:this.props.schema,coverFormat:this.props.coverFormat,coverAspectFormat:this.props.coverAspectFormat,coverSizeFormat:this.props.coverSizeFormat,coverHeight:this.props.coverHeight,coverWidth:this.props.coverWidth,shouldShowTitle:this.props.shouldShowTitle,colorStyle:void 0,onTextEnter:this.props.onTextEnter,onTextEsc:this.props.onTextEsc,onShiftEnter:this.props.onShiftEnter,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,isLast:this.props.isLast,handleOpenPeekPage:this.props.handleOpenPeekPage,collectionContextStore:this.props.collectionContextStore})}}zr.displayName="CollectionGalleryViewItem";const Nr=zr;var Wr=o(36596);function Kr(e){window.__c={n:"GalleryItemShimmer"};const t=e.minHeight||$r,o=(0,fo.yK)((e=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:4,background:`${e.lightDividerColor}`,minHeight:t}})),[t]);return s()(Wr.Z,{style:o.card})}function Ur(e){window.__c={n:"GalleryShimmer"};if(!(0,Or.Z)(!0,0,100))return null;const{hasGroups:t,hasPartialResults:o}=e,r=!t&&!o?qe.Z.card.desktop.medium.height:void 0;return s()(Kr,{minHeight:r})}const $r=40;class qr extends h.Z{constructor(){super(...arguments),this.storeTypes={collectionGalleryViewStore:Hr},this.selectableContainer=null,this.renderGroupHeader=e=>c.createElement(Tr,i()({},e,{height:48,getComputedStickyStyle:this.getGroupHeaderComputedStickyStyle})),this.renderGroup=e=>{const{store:t,format:o,disabled:r,collectionContextStore:i,schema:n,blockPropertyValueOverlayStore:l,isFullScreen:a}=this.props,{collectionGalleryViewStore:d}=this.stores,h=this.isSingleColumnStore.state,p=this.isReady.state,u=this.getCoverFormat(),m=e?[e]:[],g=i.groupsStore.getGroupState(m);if(!g)return;const S=g.reducerResultStore.state,v=void 0!==e,y=void 0!==S&&(null==S?void 0:S.blockIds.length)>0,f=Ge({collectionContextStore:i,groupsPointer:m}),C=ee.VM({collectionContextStore:i,reducerResult:S,isFullScreen:a}),b=i.permissionScopes.state,w=b.isSyncedCollection,x=t.canEdit()&&("collectionTypedView"===i.contextType||b.canEditContent),k=p&&!r&&x&&!w,P=!r&&x&&!w;return s()("div",{style:{paddingBottom:e?16:void 0}},void 0,s()("div",{style:this.getGroupWrapStyle()},void 0,s()(Ao,{collectionContextStore:i,groupsPointer:m,format:o,canDrag:P,onSelectableEnter:this.handleItemEnter,resultProps:{format:o,schema:n,onTextEnter:this.handleItemTextEsc,onTextEsc:this.handleItemTextEsc,onShiftEnter:this.handleItemEnter,disabled:r,coverFormat:u,coverAspectFormat:this.getCoverAspectFormat(),coverSizeFormat:this.getCoverSizeFormat(),coverHeight:d.state.coverHeight,coverWidth:d.state.coverWidth,shouldShowTitle:vt.K8(this.props.format,"gallery"),blockPropertyValueOverlayStore:l,collectionContextStore:i},resultComponent:Nr,canDrop:!0,disabled:r,shouldShowHoverMenu:!1,direction:h?Do.Vertical:Do.Horizontal,belowDropZoneMargin:6,emptyDroppableSize:4,dropzoneGap:10,analyticsName:"gallery",emptyDroppableStyle:this.getEmptyDroppableStyle(),loadContentCover:u&&"page_content"===u.type}),f&&s()(Ur,{hasGroups:v,hasPartialResults:y}),k&&this.renderAddItemButton(m)),C&&c.createElement(c.Fragment,null,s()("div",{style:{width:"100%",borderTop:e?void 0:`1px solid ${this.theme.tableDividerColor}`,marginTop:4,marginBottom:4}}),s()(So,{groupsPointer:m,store:t,collectionContextStore:i,format:o,isFullScreen:a,incrementLimitsInRelatedGroups:!1})))},this.handleResize=()=>{const{collectionGalleryViewStore:e}=this.stores,t=this.getGalleryCardCoverHeight(),o=this.getGalleryCardActualWidth();e.state.coverHeight!==t&&this.setCardCoverHeight(t),e.state.coverWidth!==o&&this.setCardCoverWidth(o)},this.handleResizeDebounced=(0,l.debounce)(this.handleResize,1e3),this.handleResizeThrottled=(0,l.throttle)(this.handleResize,100),this.handleScrollOffsetChange=e=>{var t;const{collectionContextStore:o,isFullScreen:r}=this.props,i=o.isLoading.state,n=null===(t=this.getDefaultResultStore())||void 0===t?void 0:t.state;e<Se.Z.incrementScrollOffset&&n&&!i&&null!=n&&n.hasMore&&V.ID({collectionContextStore:o,environment:this.environment,incrementLimitArgs:{isFullScreen:r,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})},this.handleItemEnter=e=>{const t=e.blocks;if(t.length>0){const e=t[0],o=e.getBlockTitleStore();H.eP({environment:this.environment,store:e}),z.NX({store:o}),E.Z5({store:e})}},this.handleItemTextEsc=e=>{const{collectionContextStore:t}=this.props,o=t.collectionStore(),r=e.getTitleStore();if(!r)return;gt.Q(r.getValue())?H.Ys({environment:this.environment,store:e}):o&&N.createAndCommit({userAction:"CollectionGalleryView.handleItemTextEsc",environment:this.environment,perform:t=>{V.Od({store:e,transaction:t})}})},this.handleAddItemClick=e=>{if(!$e.M_(this.environment))return;const{collectionContextStore:t}=this.props,o=t.groupsStore.getGroupState(e);o&&N.createAndCommit({userAction:"CollectionGalleryView.handleAddItemClick",environment:this.environment,perform:r=>{const{mainEditorCurrentBlockStore:i}=ue.default.state,{newStore:n}=V.IW({environment:this.environment,collectionContextStore:t,groupsPointer:e,results:o.resultsStore.state,insertAtIndex:o.resultsStore.state.length,coerce:!0,initializeDefaultTemplate:!0,transaction:r,from:"gallery"}),s=ee.mb({store:n,mainEditorCurrentBlockStore:i,collectionContextStore:t})??(0,oe.ZP)({store:n,pageVisitSource:g.tY.Create});this.navigate(s),_.Xd({collectionContextStore:t,resultsStore:o.resultsStore}),T.W2j(this.environment,{from:"list_view_add_item_bottom",type:"page",new_page_id:n.id,...(0,j.Pn)(t)})}})},this.handleGroupHeaderAddItem=e=>{if(this.environment.device.isMobile)L.navigateToBlock({environment:this.environment,store:e,pageVisitSource:g.tY.Create});else{const{collectionContextStore:t}=this.props;L.peekBlock({environment:this.environment,store:e,peekMode:ee.kr(t.collectionViewStore()),resultsStore:void 0,collectionContextStore:t,pageVisitSource:g.tY.Create})}},this.isSingleColumnStore=this.createComputedStore((()=>this.environment.WindowSizeStore.state.width<=480)),this.isReady=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return e.groupsStore.anyGroupHasResults()})),this.getGroupStyle=e=>0===e.index?{}:{borderTop:`1px solid ${this.theme.tableDividerColor}`},this.getGroupHeaderComputedStickyStyle=e=>({boxShadow:e?`0 -1px 0 ${this.theme.contentBackground}`:void 0})}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):L.navigate({environment:this.environment,url:e})}didUpdate(e){(e.format||{}).gallery_cover_size!==(this.props.format||{}).gallery_cover_size&&(this.setCardCoverHeight(),this.setCardCoverWidth())}didMount(){this.setCardCoverWidth(),this.setCardCoverHeight(),(0,te.lj)(window,"resize",this.handleResizeThrottled),this.environment.device.isMobile&&(0,te.lj)(window,"orientationchange",this.handleResizeDebounced)}willUnmount(){(0,te.ZV)(window,"resize",this.handleResizeThrottled),this.environment.device.isMobile&&(0,te.ZV)(window,"orientationchange",this.handleResizeDebounced)}renderComponent(){const{store:e,format:t,paddingBottom:o,paddingLeft:r,paddingRight:n,isFullScreen:l,collectionContextStore:a}=this.props,d=ee.az(a,l),h=t.collection_group_by;return(0,We.Z)((t=>s()("div",{style:{paddingBottom:o,paddingLeft:r,paddingRight:n,minWidth:this.props.minWidth},className:q.sbt},void 0,c.createElement(Ro.Z,i()({store:e,shouldShowHalo:!l,canSelect:!l,analyticsName:"gallery"},t,{ref:e=>this.selectableContainer=e}),h?this.renderGroups(h):this.renderGroup(void 0)),!d&&s()(_o.Z,{onChange:this.handleScrollOffsetChange}))))}renderGroups(e){const{store:t,format:o,collectionContextStore:r,schema:i,disabled:n,isFullScreen:l,paddingLeft:a,isRootChild:c,isInPeekRenderer:d}=this.props;return s()(si,{store:t,id:"gallery_groups",groupBy:e,groupsFormatKey:Ae.Uh,groupAggregationKey:Ae.dQ,format:o,schema:i,collectionContextStore:r,disabled:n,isFullScreen:l,renderGroup:this.renderGroup,onGroupHeaderAddItem:this.handleGroupHeaderAddItem,renderHeader:this.renderGroupHeader,getGroupStyle:this.getGroupStyle,paddingLeft:a,isRootChild:c,isInPeekRenderer:d})}renderAddItemButton(e){return s()(qt.Z,{onClick:()=>this.handleAddItemClick(e),onMouseDown:re.$0,style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,borderRadius:3,boxShadow:"dark"===this.theme.mode?`${this.theme.darkDividerColor} 0px 0px 0px 1px inset`:`${this.theme.regularDividerColor} 0px 0px 0px 1px inset`,minHeight:$r}},void 0,s()("div",{style:{display:"flex",alignItems:"center",marginLeft:-6}},void 0,y.Z.plus(this.getNewItemButtonIconStyle()),s()("div",{style:{color:this.theme.lightIconColor}},void 0,s()(P.FormattedMessage,{defaultMessage:"New",id:"database.galleryView.addItemButtonTitle"}))))}setCardCoverHeight(e){const{collectionGalleryViewStore:t}=this.stores;t.setState({...t.state,coverHeight:e||this.getGalleryCardCoverHeight()})}setCardCoverWidth(e){const{collectionGalleryViewStore:t}=this.stores;t.setState({...t.state,coverWidth:e||this.getGalleryCardWidth()})}getCoverFormat(){const{format:e}=this.props;return e?e.gallery_cover:void 0}getCoverAspectFormat(){const{format:e}=this.props;return e?e.gallery_cover_aspect:void 0}getCoverSizeFormat(){const{format:e}=this.props;return e?e.gallery_cover_size:void 0}getGalleryCardWidth(){const{format:e}=this.props;switch((e||{}).gallery_cover_size){case"large":return qe.Z.card.desktop.large.width;case"small":return qe.Z.card.desktop.small.width;case"medium":default:return qe.Z.card.desktop.medium.width}}getGalleryCardActualWidth(){if(this.selectableContainer){const e=this.selectableContainer.getNode();if(e){const t=e.querySelector(`.${q.K4T}`);if(t)return t.offsetWidth}}return this.getGalleryCardWidth()}getGalleryCardCoverHeight(){return this.getGalleryCardActualWidth()*(9/16)}getDefaultResultStore(){var e;const{collectionContextStore:t}=this.props;return null===(e=t.groupsStore.getGroupState([]))||void 0===e?void 0:e.reducerResultStore}getGroupWrapStyle(){const e=this.props.format.collection_group_by;return{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${this.isSingleColumnStore.state?"100%":`${this.getGalleryCardWidth()}px`}, 1fr))`,gridRowGap:16,gridColumnGap:16,paddingTop:e?1:16,paddingBottom:4}}getEmptyDroppableStyle(){return this.isSingleColumnStore.state?{position:"absolute",top:6,left:0,right:0,height:4}:{position:"absolute",top:16,bottom:4,width:4,height:"none"}}getNewItemButtonIconStyle(){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:this.theme.lightIconColor}}}qr.displayName="CollectionGalleryView",qr.contextTypes={...K.wK,...h.w};const Qr=qr;function Yr(){window.__c={n:"GalleryGroupShimmer"};const e=(0,vo.O7)(),t=(0,yo.VK)((()=>e.WindowSizeStore.state.width<=480),[e]),o=qe.Z.card.desktop.medium.width,r=(0,fo.yK)((e=>({container:{display:"flex",flexDirection:"column",alignItems:"flexStart",alignSelf:"stretch",paddingBottom:12,height:o},groupContainer:{display:"flex",height:46,alignItems:"center",alignSelf:"stretch"},itemsContainer:{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${t?"100%":`${o}px`}, 1fr))`,gap:16,paddingTop:1,paddingBottom:4,width:"100%",height:"100%"},iconContainer:{display:"flex",width:22,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,marginLeft:8,borderRadius:12,backgroundColor:e.lightDividerColor}})),[o,t]);return s()("div",{style:r.container},void 0,s()("div",{style:r.groupContainer},void 0,s()("div",{style:r.iconContainer},void 0,y.Z.collectionGroupAccordion(r.icon)),s()(Wr.Z,{style:r.groupShimmer})),s()("div",{style:r.itemsContainer},void 0,s()(Kr,{})))}function jr(e){const{isFullScreen:t}=e,o=t?2:1,r=a().times(o,(e=>s()(Yr,{},e)));return s()("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"}},void 0,r)}function Xr(){window.__c={n:"ListItemShimmer"};const e=(0,fo.yK)((e=>({rowContainer:{display:"flex",height:30,alignItems:"center",gap:1,alignSelf:"stretch"},circleShimmer:{width:16,height:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:360,height:10,flexShrink:0,borderRadius:12,marginLeft:2,backgroundColor:e.lightDividerColor},column:{display:"flex",height:34,padding:"7px 0px",alignItems:"center",gap:6,flex:"1 0 0"}})),[]);return s()("div",{style:e.rowContainer},void 0,s()("div",{style:e.column},void 0,s()(Wr.Z,{style:e.circleShimmer}),s()(Wr.Z,{style:e.rowShimmer})))}function Jr(){window.__c={n:"ListGroupShimmer"};const e=(0,fo.yK)((e=>({container:{display:"flex",padding:"8px 0px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},groupContainer:{display:"flex",height:36,paddingRight:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},rowContainer:{display:"flex",height:30,alignItems:"center",gap:1,alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:e.lightDividerColor},circleShimmer:{width:16,height:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:360,height:10,flexShrink:0,borderRadius:12,marginLeft:2,backgroundColor:e.lightDividerColor}})),[]),t=a().times(3).map((e=>s()(Xr,{},e)));return s()("div",{style:e.container},void 0,s()("div",{style:e.groupContainer},void 0,s()("div",{style:e.iconContainer},void 0,y.Z.collectionGroupAccordion(e.icon)),s()(Wr.Z,{style:e.groupShimmer})),s()("div",{style:e.rowsContainer},void 0,t))}function ei(e){const{isFullScreen:t}=e,o=t?2:1,r=a().times(o,(e=>s()(Jr,{},e)));return s()("div",{style:{display:"flex",padding:"8px 4px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"}},void 0,r)}function ti(e){window.__c={n:"TableGroupShimmer"};const{isMinimal:t}=e,o=(0,fo.yK)((e=>({container:{padding:"8px 0px",width:"100%"},groupContainer:{display:"flex",height:36,paddingRight:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",paddingLeft:16,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},rowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch",borderBottom:`1px solid ${e.regularDividerColor}`},lastRowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:e.lightDividerColor},circleShimmer:{width:16,height:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:100,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmerShort:{width:60,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmerLong:{width:200,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},firstColumn:{display:"flex",width:360,height:34,padding:"7px 8px",alignItems:"center",gap:6},firstColumnMinimal:{display:"flex",width:"100%",height:34,padding:"7px 8px",alignItems:"center",gap:6},column:{display:"flex",width:200,height:34,padding:"6px 8px",alignItems:"center",gap:6}})),[]);return s()("div",{style:o.container},void 0,s()("div",{style:o.groupContainer},void 0,s()("div",{style:o.iconContainer},void 0,y.Z.collectionGroupAccordion(o.icon)),s()(Wr.Z,{style:o.groupShimmer})),s()("div",{style:o.rowsContainer},void 0,s()("div",{style:o.rowContainer},void 0,s()("div",{style:t?o.firstColumnMinimal:o.firstColumn},void 0,s()(Wr.Z,{style:o.circleShimmer}),s()(Wr.Z,{style:o.rowShimmerShort})),t?null:c.createElement(c.Fragment,null,s()("div",{style:o.column},void 0,s()(Wr.Z,{style:o.rowShimmerShort})),s()("div",{style:o.column},void 0,s()(Wr.Z,{style:o.rowShimmerShort})),s()("div",{style:o.column},void 0,s()(Wr.Z,{style:o.rowShimmerShort})))),s()("div",{style:o.rowContainer},void 0,s()("div",{style:t?o.firstColumnMinimal:o.firstColumn},void 0,s()(Wr.Z,{style:o.circleShimmer}),s()(Wr.Z,{style:o.rowShimmerLong})),t?null:c.createElement(c.Fragment,null,s()("div",{style:o.column},void 0,s()(Wr.Z,{style:o.rowShimmer})),s()("div",{style:o.column},void 0,s()(Wr.Z,{style:o.rowShimmer})),s()("div",{style:o.column},void 0,s()(Wr.Z,{style:o.rowShimmer})))),s()("div",{style:o.lastRowContainer},void 0,s()("div",{style:t?o.firstColumnMinimal:o.firstColumn},void 0,s()(Wr.Z,{style:o.circleShimmer}),s()(Wr.Z,{style:o.rowShimmerLong})),t?null:c.createElement(c.Fragment,null,s()("div",{style:o.column},void 0,s()(Wr.Z,{style:o.rowShimmer})),s()("div",{style:o.column},void 0,s()(Wr.Z,{style:o.rowShimmer})),s()("div",{style:o.column},void 0,s()(Wr.Z,{style:o.rowShimmer}))))))}function oi(e){const{isMinimal:t}=e;return s()("div",{style:{display:"flex",paddingTop:8,paddingLeft:4,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",width:"100%"}},void 0,s()(ti,{isMinimal:t}))}function ri(){window.__c={n:"TimelineTableGroupsShimmer"};const e=(0,fo.yK)((e=>({rowsContainer:{paddingTop:8},rowContainer:{display:"flex",height:28,alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0"},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor},rowShimmerShort:{width:"50%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor}})),[]);return s()("div",{style:e.rowsContainer},void 0,s()("div",{style:e.rowContainer},void 0,s()(Wr.Z,{style:e.rowShimmerShort})),s()("div",{style:e.rowContainer},void 0,s()(Wr.Z,{style:e.rowShimmer})))}function ii(e){window.__c={n:"GroupsShimmer"};const{viewType:t,isFullScreen:o}=e;if(!(0,Or.Z)(!0,0,100))return null;switch(t){case"table":return s()(oi,{isMinimal:!1});case"list":return s()(ei,{isFullScreen:o});case"gallery":return s()(jr,{isFullScreen:o});case"timeline":return s()(ri,{});default:return null}}class ni extends h.Z{constructor(){super(...arguments),this.storeTypes={reducerResultStore:m.default.createClass(void 0),hiddenGroupsVisible:m.default.createClass(!1)},this.renderResult=e=>{var t;const{disabled:o,collectionContextStore:r,groupBy:i,isFullScreen:n,shouldSurpressShimmer:l}=this.props,a=r.groupsLimit.state,d=e.hiddenGroups.slice(0,Oe.ew),h=r.permissionScopes.state,p=!l&&function(e){const{collectionContextStore:t,displayState:o}=e;return t.shouldShowSpinner.state&&0===o.visibleGroups.length&&Ne()}({collectionContextStore:r,displayState:e}),u=null===(t=r.collectionViewStore())||void 0===t?void 0:t.getType(),m=a<e.total-e.hiddenGroups.length||He({collectionContextStore:r,isForSubgroups:!1}),g=!o&&!h.isLocked&&h.canConfigureBlock&&!p&&(0,Ae.Wz)(i,h.canConfigureCollection)&&"collectionTypedView"!==r.contextType&&!(0,_t.wl)(i.property);return s()("div",{style:{position:"relative"}},void 0,this.renderGroups(e.visibleGroups),p&&s()(ii,{viewType:u,isFullScreen:n}),m&&this.renderGroupsLoadMoreButton(e),d.length>0&&c.createElement(c.Fragment,null,this.renderHiddenGroupsButton(d),this.stores.hiddenGroupsVisible.state&&this.renderGroups(d)),g&&this.renderAddGroupButton())},this.renderGroup=(e,t,o)=>{const{renderGroup:r,disabled:i,groupsFormatKey:n,groupAggregationKey:l,format:a,schema:c,collectionContextStore:d,isFullScreen:h,onGroupHeaderAddItem:p,renderHeader:u,getGroupStyle:m,stickyLeft:g,stickyTopHeaderOffset:S,ignoreAncestorStickyContainer:v,paddingLeft:y,isRootChild:f,groupBy:C,isInPeekRenderer:b}=this.props,w=t===o.length-1;if(d.groupsStore.getGroupState(e))return s()(Er,{groupBy:C,groupFormat:e,groupsDisplayState:this.groupsDisplayStateStore.state,disabled:i,groupsFormatKey:n,groupAggregationKey:l,format:a,schema:c,collectionContextStore:d,isFullScreen:h,isRootChild:f,renderGroup:r,onGroupHeaderAddItem:p,renderHeader:u,getGroupStyle:m,stickyLeft:g,stickyTopHeaderOffset:S,ignoreAncestorStickyContainer:v,paddingLeft:y,index:t,isLast:w,isInPeekRenderer:b},(0,Ae.mD)(e))},this.handleGroupsChange=()=>{const{format:e,groupsFormatKey:t,collectionContextStore:o}=this.props,r=this.groupsDisplayStateStore.state.currentGroups;V.$D({environment:this.environment,format:e,groupsFormatKey:t,collectionContextStore:o,currentGroups:r})},this.handleGroupsChangeDebounced=a().debounce(this.handleGroupsChange,5e3),this.handleCollectionAddGroupButtonAccept=e=>{const{collectionContextStore:t,groupsFormatKey:o,groupBy:r,schema:i}=this.props,n=t.collectionStore();n&&V.tH({update:e,collectionContextStore:t,groupsFormatKey:o,collectionStore:n,environment:this.environment,groupBy:r,schema:i})},this.reducerStore=this.createComputedStore((()=>{const{groupBy:e,disableReducerRequest:t,schema:o,format:r,groupsFormatKey:i,collectionContextStore:n}=this.props,s=n.remoteRequestStore.state;if(!t)return(0,Oe.ej)({groupBy:e,schema:o,format:r,filter:null==s?void 0:s.loader.filter,groupsFormatKey:i,limit:n.groupsLimit.state})})),this.schemaGroupsStore=this.createComputedStore((()=>{const{schema:e,groupBy:t}=this.props;return(0,Ae.Qq)({schema:e,groupBy:t})}),!0),this.groupsDisplayStateStore=this.createComputedStore((()=>{var e;const{groupBy:t,groupsFormatKey:o,format:r,schema:i,collectionContextStore:n}=this.props,s=n.groupsLimit.state,l=n.collectionViewBlockStore();if(!l)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const a=this.schemaGroupsStore.state,c=this.stores.reducerResultStore.state,d=c?c.results:void 0,h=c?c.total:0,p=(0,Oe.Cz)({groupBy:t,schema:i,formatGroups:r[o]||[],schemaGroups:a,reducerResults:d,getRecordModel:l.getRecordModel,relativeVariableResult:n.relativeVariableStore.state,viewAppConfigUri:null===(e=n.collectionViewStore())||void 0===e?void 0:e.getFormat().app_config_uri}),u=p.filter((e=>!(0,Ae.eF)(e))).slice(0,s),m=p.filter((e=>(0,Ae.eF)(e)));return{currentGroups:[...u,...m],visibleGroups:u,hiddenGroups:m,total:h}}),!0)}willMount(e){const{disableReducerRequest:t}=this.props;t||this.groupsDisplayStateStore.addListener(this.handleGroupsChangeDebounced)}willUnmount(){this.groupsDisplayStateStore.removeListener(this.handleGroupsChangeDebounced),this.handleGroupsChangeDebounced.cancel()}renderComponent(){const e=this.reducerStore.state,t=this.groupsDisplayStateStore.state;return e?s()(ot.Z,{id:this.props.id,reducer:e,collectionContextStore:this.props.collectionContextStore,resultStore:this.stores.reducerResultStore,render:()=>this.renderResult(t)}):this.renderResult(t)}renderGroups(e){return e.map(this.renderGroup)}renderGroupsLoadMoreButton(e){const{renderGroupsLoadMoreButton:t,collectionContextStore:o,schema:r}=this.props,{groupsLimit:i}=o;return t?t({visibleGroups:e.visibleGroups,hiddenGroups:e.hiddenGroups,total:e.total,groupsLimitStore:i,type:"default",schema:r,collectionContextStore:o}):s()("div",{style:{display:"flex"}},void 0,s()(_r,{visibleGroups:e.visibleGroups,hiddenGroups:e.hiddenGroups,total:e.total,groupsLimitStore:i,type:"default",schema:r,collectionContextStore:o}))}renderHiddenGroupsButton(e){const{renderHiddenGroupsButton:t}=this.props;return t?t({hiddenGroupsVisible:this.stores.hiddenGroupsVisible,hiddenGroups:e}):s()("div",{style:{display:"flex"}},void 0,s()(Lr,{hiddenGroupsVisible:this.stores.hiddenGroupsVisible,hiddenGroups:e}))}renderAddGroupButton(){const{schema:e,groupBy:t,renderAddGroupButton:o,collectionContextStore:r,paddingLeft:i}=this.props,n=this.groupsDisplayStateStore.state.currentGroups;return o?o({groupBy:t,schema:e,currentGroups:n,onAccept:this.handleCollectionAddGroupButtonAccept,groupsLimitStore:r.groupsLimit,parentStore:this.props.store,type:"default",collectionContextStore:r}):s()(pr,{groupBy:t,schema:e,currentGroups:n,onAccept:this.handleCollectionAddGroupButtonAccept,groupsLimitStore:r.groupsLimit,parentStore:this.props.store,type:"default",collectionContextStore:r,paddingLeft:i,stickyLeft:!0})}}ni.displayName="CollectionGroups";const si=ni;var li=o(79131);class ai extends Ee.Z{constructor(e,t){super(e,t),this.storeTypes={groupsResultStore:m.default.createClass(void 0),hoveredGroupStore:m.default.createClass(void 0)},this.hiddenGroupsContainerRef=void 0,this.hiddenGroupsHeaderRef=void 0,this.hiddenGroupsHeaderLastOffset=void 0,this.renderGroupHeader=(e,t)=>{const{schema:o,collectionContextStore:r,format:i,query:n,disabled:l,isFullScreen:a,intl:c}=this.props;if(this.getGroupStateForGroupFormat(e)&&i.board_columns_by)return s()(jo,{currentGroups:t,groupFormat:e,query:n,schema:o,format:i,groupBy:i.board_columns_by,collectionContextStore:r,hoveredGroupStore:this.stores.hoveredGroupStore,disabled:l,hidden:!1,isPopup:!1,isInPeekRenderer:this.props.isInPeekRenderer,isFullScreen:a,intl:c},(0,Ae.mD)(e))},this.subGroupMinWidth=()=>{const{format:e}=this.props;return this.columnsDisplayStateStore.state.visibleGroups.length*(Yo(e)+2*Zo+10)},this.renderBoardHiddenGroupsButton=e=>s()("div",{style:{display:"flex",minWidth:this.subGroupMinWidth()}},void 0,c.createElement(Lr,e)),this.renderSubGroupHeader=e=>c.createElement(Tr,i()({},e,{height:36,getComputedStickyStyle:this.getGroupHeaderComputedStickyStyle,style:{...e.style,minWidth:this.subGroupMinWidth()}})),this.renderHiddenGroup=e=>{const{collectionContextStore:t,query:o,schema:r,format:i,disabled:n,blockPropertyValueOverlayStore:l,isFullScreen:a,isInPeekRenderer:c,intl:d}=this.props,h=this.columnsDisplayStateStore.state.currentGroups;if(!this.getGroupStateForGroupFormat(e)||!i.board_columns_by)return;const p=t.permissionScopes.state;return s()(lr,{query:o,schema:r,format:i,groupFormat:e,groupBy:i.board_columns_by,currentGroups:h,collectionContextStore:t,disabled:n||!this.canEdit()||!p.canEditContent,blockPropertyValueOverlayStore:l,isFullScreen:a,hoveredGroupStore:this.stores.hoveredGroupStore,isInPeekRenderer:c,intl:d},(0,Ae.mD)(e))},this.handleGroupReorder=(e,t)=>{const{collectionContextStore:o}=this.props,r=this.columnsDisplayStateStore.state.currentGroups,i=r.filter((t=>e.indexOf((0,Ae.mD)(t))<0)),n=r.filter((t=>e.indexOf((0,Ae.mD)(t))>=0)),s=a().sortBy(n,(t=>{const o=e.indexOf((0,Ae.mD)(t));return o>=0?o:1/0})),l=t?[...i,...s]:[...s,...i];N.createAndCommit({userAction:"Board.handleGroupReorder",environment:this.environment,perform:e=>{V.A6({collectionContextStore:o,newGroups:l,groupsFormatKey:"board_columns",transaction:e})}}),B.wd({environment:this.environment,collectionContextStore:o,action:t?"board_reorder_hidden_groups":"board_reorder_groups"})},this.handleCollectionAddGroupButtonAccept=e=>{const{collectionContextStore:t,schema:o,format:r}=this.props,i=t.collectionStore();if(!i)return;const n=r.board_columns_by;n&&V.tH({update:e,collectionContextStore:t,groupsFormatKey:"board_columns",collectionStore:i,schema:o,groupBy:n,environment:this.environment})},this.handleEditorMouseDown=e=>{const{device:t}=this.environment;t.isMobile||(0,re.ZP)({event:e,context:re.Af.EditorMouseDown,callback:()=>{e.preventDefault(),Z.AI({environment:this.environment,target:e.target,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})},this.handleGroupsChange=()=>{const{format:e,collectionContextStore:t}=this.props,o=this.columnsDisplayStateStore.state.currentGroups;V.$D({environment:this.environment,format:e,groupsFormatKey:"board_columns",collectionContextStore:t,currentGroups:o})},this.handleGroupsChangeDebounced=a().debounce(this.handleGroupsChange,5e3),this.handleGroupHeaderAddItem=e=>{const{collectionContextStore:t}=this.props,{device:o}=this.environment;o.isMobile?L.navigateToBlock({environment:this.environment,store:e,pageVisitSource:g.tY.Create}):L.peekBlock({environment:this.environment,store:e,peekMode:ee.kr(t.collectionViewStore()),resultsStore:void 0,collectionContextStore:t,pageVisitSource:g.tY.Create})},this.handleMouseLeave=()=>{this.stores.hoveredGroupStore.setState(void 0)},this.schemaGroupsStore=this.createComputedStore((()=>{const{format:e,schema:t}=this.props,o=e.board_columns_by;if(o)return(0,Ae.Qq)({schema:t,groupBy:o})}),!0),this.groupsReducerStore=this.createComputedStore((()=>{const{format:e,schema:t,collectionContextStore:o}=this.props,r=o.remoteRequestStore.state,i=e.board_columns_by;if(i)return(0,Oe.ej)({groupBy:i,schema:t,format:e,filter:null==r?void 0:r.loader.filter,groupsFormatKey:"board_columns",limit:o.boardColumnsLimit.state})})),this.columnsDisplayStateStore=this.createComputedStore((()=>{const{format:e,schema:t,collectionContextStore:o}=this.props,r=e.board_columns_by;if(!r)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const i=o.collectionViewBlockStore();if(!i)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const n=o.collectionViewStore(),s=o.boardColumnsLimit.state,l=this.schemaGroupsStore.state,a=this.stores.groupsResultStore.state,c=a?a.results:void 0,d=a?a.total:0,h=(0,Oe.Cz)({groupBy:r,schema:t,formatGroups:e.board_columns||[],schemaGroups:l,reducerResults:c,getRecordModel:i.getRecordModel,relativeVariableResult:o.relativeVariableStore.state,viewAppConfigUri:null==n?void 0:n.getFormat().app_config_uri}),p=h.filter((e=>!(0,Ae.eF)(e))).slice(0,s),u=h.filter((e=>(0,Ae.eF)(e)));return{currentGroups:[...p,...u],visibleGroups:p,hiddenGroups:u,total:d}}),!0),this.disableBoardColorColumnsStore=this.createComputedStore((()=>{const{schema:e,format:t,collectionContextStore:o}=this.props;return!Boolean((0,Oe.II)({environment:this.environment,groupFormat:void 0,schema:e,format:t,collectionContextStore:o,theme:this.theme}))}),!0),this.getGroupHeaderComputedStickyStyle=e=>({background:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground,boxShadow:e?`0 1px 0 ${this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground}`:void 0}),this.getGroupStyle=e=>({marginTop:4,...e.isLast&&{paddingBottom:12}}),this.hiddenGroupsContainerRef=c.createRef(),this.hiddenGroupsHeaderRef=c.createRef(),this.hiddenGroupsHeaderLastOffset=0}willMount(){this.columnsDisplayStateStore.addListener(this.handleGroupsChangeDebounced)}willUnmount(){this.columnsDisplayStateStore.removeListener(this.handleGroupsChangeDebounced),this.handleGroupsChangeDebounced.cancel()}willMountOrUpdate(e){const{format:t,store:o,collectionContextStore:r}=e,i=r.collectionStore();if(!i)return;const n=r.permissionScopes.state;!t.board_columns_by&&o.isDefined()&&i.isDefined()&&n.canConfigureCollection&&n.canConfigureBlock&&this.updateOrCreateColumnsByProperty(e),p.default.afterNextFlush((()=>this.updateHiddenGroupsHeaderOffset()))}renderPersisted(){const{format:e}=this.props;return e.board_columns_by?this.renderBoard():s()("div",{style:this.getBoardStyle(),className:q.EGJ},void 0,s()(P.FormattedMessage,{defaultMessage:"Unable to render this view because the database is missing a select property.",id:"database.boardView.missingSelectProperty"}))}renderBoard(){const{store:e,format:t,isFullScreen:o,collectionContextStore:r}=this.props,n=this.columnsDisplayStateStore.state,{visibleGroups:l,hiddenGroups:a}=n,d=t.collection_group_by;return this.renderBoardColumnsReducerRequest((()=>(0,We.Z)((t=>s()(Fr,{isFullScreen:o,renderEmitter:r.renderEmitter},void 0,c.createElement("div",i()({style:this.getBoardStyle(),className:q.EGJ},t),s()(Ro.Z,{style:this.getColumnsWrapStyle(),store:e,shouldShowHalo:!o,canSelect:!o,onMouseDown:this.handleEditorMouseDown,analyticsName:"board",onMouseLeave:this.handleMouseLeave},void 0,this.renderHeader(n),l.length>0&&s()("div",{},void 0,s()("div",{style:{height:34+Lo(this.disableBoardColorColumnsStore.state)}}),d?this.renderBoardColumnsForGroups(d,l):this.renderBoardColumnsForGroup(void 0,l)),this.shouldRenderGroupsLoadMoreButton({displayState:n,isForSubgroups:!1})&&s()("div",{style:{width:90,marginLeft:5,marginRight:5}}),this.shouldRenderAddGroupButton()&&s()("div",{style:{width:35,marginLeft:5,marginRight:5}}),a.length>0&&this.renderHiddenGroups(a))))))))}renderBoardColumnsReducerRequest(e){const{collectionContextStore:t}=this.props,o=this.groupsReducerStore.state;return o?s()(ot.Z,{id:"board_columns",reducer:o,collectionContextStore:t,resultStore:this.stores.groupsResultStore,render:e}):e()}renderHeader(e){const{format:t,isFullScreen:o,isRootChild:r,collectionContextStore:i}=this.props,{hiddenGroups:n,visibleGroups:l,currentGroups:a}=e,d=l.map((e=>(0,Ae.mD)(e))),h=t.board_columns_by;if(!h)return;const p=(0,Ae.mu)(h),u=i.permissionScopes.state,m="manual"===p.type&&u.canConfigureBlock,g=(0,Oe.qW)({device:this.environment.device,isFullScreen:o,isRootChild:r});return s()(kr,{position:Ue.Top},void 0,s()("div",{style:this.getHeaderStyle()},void 0,g&&s()("div",{style:this.getHeaderSpacerStyle()}),m?s()(li.ZP,{direction:"horizontal",keys:d,renderKey:(e,t)=>this.renderGroupHeader(l[t],a),onDrop:e=>this.handleGroupReorder(e,!1)}):d.map(((e,t)=>this.renderGroupHeader(l[t],a))),this.shouldRenderGroupsLoadMoreButton({displayState:e,isForSubgroups:!0})&&this.renderGroupsLoadMoreButton(e),this.shouldRenderAddGroupButton()&&this.renderAddGroupButton(),n.length>0&&c.createElement("div",{style:this.getHiddenGroupsCaptionStyle(),ref:this.hiddenGroupsHeaderRef},s()(P.FormattedMessage,{defaultMessage:"Hidden groups",id:"collection.boardView.hiddenGroups.label"}))))}renderHiddenGroups(e){const{device:t}=this.environment,{collectionContextStore:o}=this.props,r=this.canEdit()&&!t.isMobile&&!o.permissionScopes.state.isLocked,i=e.slice(0,Oe.ew),n=i.map((e=>(0,Ae.mD)(e)));return c.createElement("div",{style:this.getHiddenGroupsWrapStyle(),ref:this.hiddenGroupsContainerRef},i.length>0&&(r?s()(li.ZP,{direction:"vertical",keys:n,renderKey:(e,t)=>this.renderHiddenGroup(i[t]),onDrop:e=>this.handleGroupReorder(e,!0)}):s()("div",{},void 0,i.map(this.renderHiddenGroup))))}renderGroupsLoadMoreButton(e){const{collectionContextStore:t,schema:o}=this.props,r=t.boardColumnsLimit;return s()(_r,{visibleGroups:e.visibleGroups,hiddenGroups:e.hiddenGroups,total:e.total,groupsLimitStore:r,type:"board",schema:o,collectionContextStore:t})}renderAddGroupButton(){const{format:e,schema:t,collectionContextStore:o}=this.props;if(!e.board_columns_by)return;if("collectionTypedView"===o.contextType)return;const r=this.columnsDisplayStateStore.state.currentGroups;return s()(pr,{groupBy:e.board_columns_by,schema:t,currentGroups:r,onAccept:this.handleCollectionAddGroupButtonAccept,groupsLimitStore:o.boardColumnsLimit,parentStore:this.props.store,type:"board",collectionContextStore:o})}renderBoardColumnsForGroups(e,t){const{store:o,format:r,collectionContextStore:i,schema:n,disabled:l,isFullScreen:a,paddingLeft:c,isRootChild:d,isInPeekRenderer:h}=this.props;return s()(si,{store:o,id:_e.M9,groupBy:e,groupsFormatKey:Ae.Uh,groupAggregationKey:Ae.dQ,format:r,schema:n,collectionContextStore:i,disabled:l,isFullScreen:a,isRootChild:d,paddingLeft:c,renderGroup:e=>this.renderBoardColumnsForGroup(e,t),renderHeader:this.renderSubGroupHeader,renderHiddenGroupsButton:this.renderBoardHiddenGroupsButton,onGroupHeaderAddItem:this.handleGroupHeaderAddItem,stickyLeft:!this.environment.device.isMobile,getGroupStyle:this.getGroupStyle,isInPeekRenderer:h})}renderBoardColumnsForGroup(e,t){return s()("div",{style:li.l8},void 0,t.map(((o,r)=>{const i=r===t.length-1;return this.renderGroupResults(e?[e,o]:[o],i)})))}renderGroupResults(e,t){const{store:o,collectionContextStore:r,isFullScreen:i,query:n,schema:l,format:a,disabled:c,blockPropertyValueOverlayStore:d}=this.props,h=0!==this.columnsDisplayStateStore.state.hiddenGroups.length;if(!r.groupsStore.getGroupState(e))return;const p=r.permissionScopes.state,u=this.canEdit()&&("collectionTypedView"===r.contextType||p.canEditContent);return s()(Go,{store:o,hoveredGroupStore:this.stores.hoveredGroupStore,query:n,schema:l,format:a,groupsPointer:e,collectionContextStore:r,isFullScreen:i,isInPeekRenderer:this.props.isInPeekRenderer,disabled:c||!u,isLast:t&&!h,blockPropertyValueOverlayStore:d},(0,Ae.KW)(e))}updateOrCreateColumnsByProperty(e){const{collectionContextStore:t,schema:o}=e,r=t.collectionStore();if(!r)return;const i=t.collectionViewStore();i&&N.createAndCommit({userAction:"Board.updateOrCreateColumnsByProperty",environment:this.environment,perform:e=>{let n,s=ee.Se(o);if(!s){s=(0,Ze.ZP)();n={[s]:{name:this.props.intl.formatMessage({id:"collection.boardView.selectProperty.defaultName",defaultMessage:"Status"}),type:"select",options:[]}}}const l=(n||o)[s];l&&(0,Ae.LG)(l)&&(Le.FH({stores:[i],update:{board_columns_by:(0,Ae.fw)(s,l,"collectionTypedView"===t.contextType)},transaction:e}),n&&E.xO({environment:this.environment,collectionStore:r,update:n,transaction:e}))}})}getGroupStateForGroupFormat(e){const{collectionContextStore:t}=this.props;return t.groupsStore.getGroupState([e])}shouldRenderGroupsLoadMoreButton(e){const{collectionContextStore:t}=this.props,{displayState:o,isForSubgroups:r}=e,{hiddenGroups:i,total:n}=o,s=t.boardColumnsLimit.state,l=He({collectionContextStore:t,isForSubgroups:r});return s<n-i.length||l}shouldRenderAddGroupButton(){const{format:e,collectionContextStore:t}=this.props,o=e.board_columns_by,r=t.permissionScopes.state;return r.canConfigureBlock&&o&&(0,Ae.Wz)(o,r.canConfigureCollection)&&!r.isSyncedCollection}getBoardStyle(){return{marginLeft:this.props.paddingLeft,marginRight:this.props.paddingRight,float:"left",minWidth:"100%"}}getHeaderStyle(){var e;const{collectionContextStore:t,isInPeekRenderer:o}=this.props,r=(null===(e=t.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(o?this.theme.cardContentBackground:this.theme.contentBackground),i=Lo(this.disableBoardColorColumnsStore.state);return{position:"absolute",background:r,height:34+i,paddingTop:i,zIndex:k.LN,display:"flex",boxShadow:`-3px 0 0 ${r}`,minWidth:"100%"}}getColumnsWrapStyle(){return{display:"flex",position:"relative",flexGrow:1,paddingBottom:this.props.paddingBottom}}getHiddenGroupsWrapStyle(){return{width:220,flexShrink:0,marginTop:34+Lo(this.disableBoardColorColumnsStore.state),marginLeft:12}}getHiddenGroupsCaptionStyle(){return{position:"relative",width:220,flexShrink:0,display:"flex",alignItems:"center",fontSize:14,color:this.theme.lightTextColor,background:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground,marginLeft:20}}getHeaderSpacerStyle(){return{height:"calc(100% + 17px)",background:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground,width:20,marginLeft:-20,marginTop:-17}}updateHiddenGroupsHeaderOffset(){var e;if("function"==typeof this.hiddenGroupsHeaderRef||null===(e=this.hiddenGroupsHeaderRef)||void 0===e||!e.current)return;const t=(this.getHiddenGroupsHeaderOffset()||0)+this.hiddenGroupsHeaderLastOffset;this.hiddenGroupsHeaderLastOffset=t,this.hiddenGroupsHeaderRef.current.style.left=`${t}px`}getHiddenGroupsHeaderOffset(){var e,t;if("function"==typeof this.hiddenGroupsHeaderRef||"function"==typeof this.hiddenGroupsContainerRef||null===(e=this.hiddenGroupsHeaderRef)||void 0===e||!e.current||null===(t=this.hiddenGroupsContainerRef)||void 0===t||!t.current)return;const o=this.hiddenGroupsHeaderRef.current.getBoundingClientRect().left;return this.hiddenGroupsContainerRef.current.getBoundingClientRect().left-o+8}}ai.displayName="Board";const ci=(0,P.injectIntl)(ai);var di=o(13991),hi=o(40506),pi=o(7057),ui=o(53877),mi=o(40863),gi=o(95802),Si=o(15723),vi=o(17746),yi=o(50628),fi=o(17126),Ci=o(53876),bi=o(6685),wi=o(76798);class xi extends Ee.Z{activate(){const e=this.getPeekURL();e&&(this.props.handleOpenPeekPage(),L.navigate({environment:this.environment,url:e}))}didMount(){this.props.collectionContextStore.onItemMount()}renderComponent(){return c.createElement(Pi,this.props)}getPeekURL(){const{store:e,collectionContextStore:t}=this.props,{mainEditorCurrentBlockStore:o}=ue.default.state;return ee.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})}}xi.displayName="CalendarItem";const ki=xi;function Pi(e){window.__c={n:"CalendarItemFn"};const{store:t,row:o,schema:r,format:i,disabled:n,calendarBy:l,collectionContextStore:c,includeTime:d,resultsStore:h,handleOpenPeekPage:p,blockPropertyValueOverlayStore:u,calendarStore:m}=e,g=(0,vo.O7)(),S=r[l],v=(0,yo.VK)((()=>!n&&"date"===(null==S?void 0:S.type)&&!c.permissionScopes.state.isSyncedCollection),[c.permissionScopes,n,null==S?void 0:S.type]),{start:y,end:f,startOfWeek:C,endOfWeek:b,startColumn:w,columnCount:x}=(0,mi.du)({startUnixTimestampMS:e.start,endUnixTimestampMS:e.end,startOfWeekUnixTimestampMS:e.startOfWeek,endOfWeekUnixTimestampMS:e.endOfWeek}),k=(0,yo.VK)((()=>{const e=i.calendar_properties?i.calendar_properties.filter((e=>e.visible)).map((e=>e.property)):[],o=e.filter((e=>bt.XU({block:t.getModel(),property:e,schema:r,getRecordModel:t.getRecordModel,userId:g.currentUser.id,userTimeZone:(0,je.r)(),intl:ie.default.getIntl()})));return o.concat(a().difference(e,o))}),[g.currentUser.id,i.calendar_properties,r,t]);if(!S||!Ct.Lt(S))return null;const P=k.length+1,T=y<C,R=void 0!==f&&f>b;return s()(Ti,{store:t,row:o,numRows:P,columnCount:x,startIsBeforeStartOfWeek:T,endIsAfterEndOfWeek:R,startColumn:w,disabled:n,isEditableDate:v,calendarBy:l,resultsStore:h,handleOpenPeekPage:p},void 0,s()(Ri,{store:t,start:y,startOfWeek:C,end:f,endOfWeek:b,includeTime:d,columnCount:x,propertySchema:S}),s()(Mi,{store:t,sortedProperties:k,startIsBeforeStartOfWeek:T,disabled:n,blockPropertyValueOverlayStore:u}),v&&s()(Bi,{store:t,start:y,startOfWeek:C,end:f,endOfWeek:b,calendarBy:l,calendarStore:m}))}function Ti(e){window.__c={n:"CalendarItemWrapper"};const{store:t,children:o,columnCount:r,row:i,numRows:n,startColumn:l,disabled:a,isEditableDate:d,calendarBy:h,resultsStore:p,handleOpenPeekPage:u,startIsBeforeStartOfWeek:m,endIsAfterEndOfWeek:S}=e,v=(0,vo.O7)(),y=(0,W.Y$)(),f=(0,yo.VK)((()=>ee.Sc(t)),[t]),C=n*Ci.ch+2*Fi+2*Di,b=Vi+C*i,w=(0,yo.VK)((()=>Po.Z.state.hoveredStore===e.store),[e.store]),x=(0,fo.yK)((e=>({selectable:{position:"absolute",paddingTop:3,paddingBottom:3,paddingLeft:m?0:6,paddingRight:S?0:6,width:S?`calc(100% / 7 * ${r} - 1px)`:`calc(100% / 7 * ${r})`,left:`calc(100% / 7 * ${l})`,height:C,top:b},haloStyle:{...ee.pB(f,e),borderRadius:5,marginTop:2,marginBottom:2,marginLeft:m?0:5,marginRight:S?0:5},linkBoxStyle:{height:"100%",background:e.calendarItemBackground,borderTopLeftRadius:3,borderTopRightRadius:3,borderBottomLeftRadius:3,borderBottomRightRadius:3,boxShadow:e.lightBoxShadow,...m&&{borderTopRightRadius:0,borderBottomRightRadius:0},...S&&{borderTopLeftRadius:0,borderBottomLeftRadius:0}},linkBoxHoveredStyle:{opacity:1,background:e.calendarItemHoveredBackground},linkBoxInnerStyle:{display:"flex",position:"relative",paddingTop:2,paddingBottom:2,height:"100%",alignItems:"flex-start",flexDirection:"column"}})),[r,S,C,f,l,m,b]),k=(0,c.useCallback)((e=>{const o=y.collectionStore();return o?M.QG({environment:v,collectionStore:o,collectionContextStore:y,store:t,insertStores:e.insertStores,calendarBy:h,transaction:e.transaction,results:p.state}):[]}),[h,y,v,p,t]),P=(0,c.useCallback)((e=>{const{transaction:o}=e;y.collectionStore()&&V.Od({store:t,transaction:o})}),[y,t]),[T,R]=(0,yo.VK)((()=>{const{mainEditorCurrentBlockStore:e}=ue.default.state,o=ee.mb({store:t,mainEditorCurrentBlockStore:e,collectionContextStore:y,fullyQualified:!1});return[(0,oe.ZP)({store:t,fullyQualified:!1,pageVisitSource:g.tY.LinkInPage}),o]}),[y,t]);return s()(Ro.Z,{store:t,style:x.selectable,canSelect:!a,shouldShowHalo:!0,shouldForceRenderSelectionHalo:f,haloStyle:x.haloStyle,canTriggerContextMenu:!a,showBlockMenuInput:!0,canDrag:d,onInsertAbove:k,onInsertBelow:k,onRemove:P,canInsertAbove:d,canInsertBelow:d,analyticsName:"calendar",shouldShowDropZone:!0,className:q.K4T},t.id,s()(Yt.Z,{style:x.linkBoxStyle,hoveredStyle:x.linkBoxHoveredStyle,pressedStyle:x.linkBoxHoveredStyle,innerStyle:x.linkBoxInnerStyle,onClick:u,href:T,metaHref:R,hovered:w},void 0,o))}function Ri(e){window.__c={n:"CalendarItemTitleRow"};const{store:t,start:o,startOfWeek:r,end:i,endOfWeek:n,includeTime:l,columnCount:a,propertySchema:c}=e,d=o<r,h=i&&i>n,p="time_format"in c?c.time_format:hi.c_,[u,m,g]=(0,yo.VK)((()=>[t.getIcon(),t.isEmptyPage(),t.hasError()]),[t]),S=(0,fo.yK)((e=>({titleContainer:{paddingLeft:6,paddingRight:6,overflow:"hidden",...d&&{paddingLeft:12},...h&&{paddingRight:11},width:l?100/a+"%":"100%"},titleInner:{display:"flex",alignItems:"center",height:24},titleTextStyle:{flexGrow:1,fontSize:14,fontWeight:x.Z.fontWeight.semibold},recordIconStyle:{flexShrink:0,marginRight:4,marginTop:2},iconWarningStyle:{marginLeft:1,marginRight:5,width:10,fill:e.accentColors.orange[500]},timeStyle:{color:e.mediumTextColor,flexShrink:0,fontSize:10,marginLeft:4,height:14},endTimeStyle:{marginLeft:"auto",paddingLeft:4,marginRight:4,color:e.mediumTextColor,fontSize:10,whiteSpace:"nowrap",marginTop:-1},endTimeAbsoluteStyle:{position:"absolute",right:4,top:6}})),[a,h,l,d]),v=l&&i&&fi.Xp.fromDateTimes(r,n).contains(i)&&o.day!==i.day;return s()("div",{style:S.titleContainer},void 0,s()("div",{style:S.titleInner},void 0,void 0!==u&&!g&&s()(jt.Z,{disabled:!0,icon:u,isEmptyPage:m,size:14,style:S.recordIconStyle}),g&&y.Z.warning(S.iconWarningStyle),s()(wi.Z,{style:S.titleTextStyle,store:t,enableHover:!0}),s()(Ii,{store:t}),l&&fi.Xp.fromDateTimes(r,n).contains(o)&&s()("div",{style:S.timeStyle},void 0,(0,pi.xE)({dateTime:o,humanReadable:!1,timeFormat:p})),v&&s()("div",{style:{...S.endTimeStyle,...a>1?S.endTimeAbsoluteStyle:void 0}},void 0,s()(P.FormattedMessage,{defaultMessage:"ends {endTime}",id:"calendarItem.endsTime.message",values:{endTime:(0,pi.xE)({dateTime:i,humanReadable:!1,timeFormat:p})}}))))}function Ii(e){window.__c={n:"DiscussionIndicator"};const{store:t}=e,o=(0,fo.Fg)(),r=(0,yo.VK)((()=>It.Xp(t,{recursivelyLoadAllDiscussions:!1})),[t]);return 0===r?null:s()("div",{style:{display:"flex",alignItems:"center",color:o.mediumTextColor,fontSize:12,marginLeft:4,flexShrink:0}},void 0,y.Z.speechBubble({width:12,height:12,marginRight:4,fill:o.mediumIconColor}),r)}function Mi(e){window.__c={n:"CalendarItemPropertiesRows"};const{store:t,sortedProperties:o,startIsBeforeStartOfWeek:r,disabled:i,blockPropertyValueOverlayStore:n}=e,l=(0,W.Y$)(),a=(0,yo.VK)((()=>l.permissionScopes.state.isLocked),[l.permissionScopes]),[c,d]=(0,yo.VK)((()=>[l.collectionStore(),l.collectionViewStore()]),[l]);return c?s()("div",{style:{paddingLeft:6,paddingRight:6,overflow:"hidden",width:"100%",...r&&{paddingLeft:12}}},void 0,o.map((e=>s()(Kt.Z,{store:t,property:e,disabled:i,locked:a,format:Ut.C.Calendar,tableWrap:!1,blockPropertyValueOverlayStore:n,collectionStore:c,collectionViewStore:d},e)))):null}function Bi(e){window.__c={n:"CalendarItemDraggables"};const{store:t,calendarStore:o,start:r,startOfWeek:n,end:l,endOfWeek:a,calendarBy:d}=e,h=(0,vo.O7)(),p=(0,fo.yK)((()=>({leftDragHandle:{position:"absolute",top:0,left:-4,height:"100%",width:12,cursor:"col-resize"},rightDragHandle:{position:"absolute",top:0,right:-4,height:"100%",width:12,cursor:"col-resize"}})),[]),u=(0,c.useCallback)((e=>{M.td({calendarStore:o,x:e.currentX,y:e.currentY,calendarBy:d})}),[o,d]),m=(0,c.useCallback)((()=>{N.createAndCommit({userAction:"CalendarItem.handleDraggableDragEnd",environment:h,perform:e=>{M.fX({environment:h,transaction:e,calendarStore:o,calendarBy:d})}})}),[d,o,h]),g=(0,c.useCallback)((()=>{M.cQ({calendarStore:o})}),[o]),S=r>n&&s()(bi.Z,{render:e=>c.createElement("div",i()({style:p.leftDragHandle},e)),onDraggableDragStart:()=>{M.f$({calendarStore:o,target:t,direction:vi.t.Left})},onDraggableDragMove:u,onDraggableDragEnd:m,onDraggableDragCancel:g}),v=(!l||l&&l<a)&&s()(bi.Z,{render:e=>c.createElement("div",i()({style:p.rightDragHandle},e)),onDraggableDragStart:e=>{M.f$({calendarStore:o,target:t,direction:vi.t.Right})},onDraggableDragMove:u,onDraggableDragEnd:m,onDraggableDragCancel:g});return c.createElement(c.Fragment,null,S,v)}const Vi=30,Fi=2,Di=3;class Ei extends Ee.Z{constructor(){super(...arguments),this.headerEl=void 0,this.root=void 0,this.verticalScrollableAncestor=void 0,this.storeTypes={calendarStore:vi.Z,resultStore:m.default.createClass(void 0)},this.handleHeaderMount=e=>{this.headerEl=e},this.handleScrollOffsetChange=e=>{const{collectionContextStore:t}=this.props,o=t.isLoading.state,r=this.shouldInfinitelyLoad();if(e<Se.Z.incrementScrollOffset&&!o&&r){const{collectionContextStore:e}=this.props,t=e.dateRangeStart.state,o=e.dateRangeEnd.state,r=(0,ui.V7)((0,ui._)({date:o,monthsToAdd:2}),U.AK.state);E.t5({dateRangeStart:t,dateRangeEnd:r,collectionContextStore:e})}},this.handleScroll=()=>{if(!this.headerEl)return;if(!this.shouldInfinitelyLoad())return;const{calendarStore:e}=this.stores,t=e.state,o=this.headerEl.getBoundingClientRect();let r=[];t.dayStoreMap.forEach(((e,t)=>{r.push({store:e,timestamp:t})})),r=a().sortBy(r,(e=>{let{timestamp:t}=e;return t}));const i=r.find((e=>{let{store:t}=e;const r=gi.C.getRectFromStore(t);return Boolean(r&&r.top<=o.top+o.height&&r.top+r.height>=o.top+o.height)}));if(i){const o=(0,ui.kl)((0,ui.Xz)({date:(0,ui.V7)(i.timestamp,U.AK.state),daysToAdd:1}));o!==t.startingMonth&&e.setState({...e.state,startingMonth:o})}},this.handleScrollThrottled=a().throttle(this.handleScroll,100),this.handleMouseMove=e=>{const{calendarStore:t}=this.stores,o=t.state;if(!o.isDragging&&!we.Z.state){const r=this.findHoveredDay(e.clientX,e.clientY);o.hoveredDay!==r&&t.setState({...o,hoveredDay:r})}},this.handleMouseMoveThrottled=a().throttle(this.handleMouseMove,50),this.handleTodayClick=()=>{const e=this.getCalendarViewRange(this.props.collectionContextStore),t="month"===e?(0,ui.IS)((0,ui.kl)(Date.now()),U.AK.state):(0,ui.IS)(Date.now(),U.AK.state);this.setNewCalendarStart(t,e)},this.handleEditorMouseDown=e=>{const{device:t}=this.environment;t.isPhone||(0,re.ZP)({event:e,context:re.Af.EditorMouseDown,callback:()=>{e.preventDefault(),Z.AI({environment:this.environment,target:e.target,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[this.props.store],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!1})}})},this.handleOpenPeekPage=()=>{const{collectionContextStore:e}=this.props;he.default.mark("collections.open_item_page_lag");const t=e.collectionViewStore();_.Xd({collectionContextStore:e,resultsStore:this.sortedResultsStore});const o=null==t?void 0:t.getFormat().collection_peek_mode,r=o||To.Ls.calendar;T.hym(this.environment,{is_peek:!0,from:"calendar",peek_mode:r})},this.startOfWeekSettingStore=this.createComputedStore((()=>{const{currentUserSettingsStore:e}=ue.default.state;if(!e)return;const t=e.getSettings();return null!=t&&t.start_day_of_week?t.start_day_of_week:0}),!0),this.reducerStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return(0,mi.Ft)({collectionContextStore:e})}),!0),this.resultsStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore();if(!t)return[];const o=this.stores.resultStore.state;return o?o.blockIds.map((e=>Ve.G.createChildStore(t,{id:e,table:b.iU}))):[]}),!0),this.weeksStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=ie.default.getIntl();return(0,mi.y$)({collectionContextStore:e,results:this.resultsStore.state,getRecordValue:this.getRecordValue,intl:t})}),!0),this.sortedResultsStore=this.createComputedStore((()=>{var e;const{collectionContextStore:t}=this.props,o=t.collectionViewStore();return o&&(null===(e=this.weeksStore.state)||void 0===e?void 0:e.flatMap((e=>e.items.map((e=>Ve.G.createChildStore(o,{table:b.iU,id:e.id}))))))||[]}),!0),this.getRecordValue=this.props.store.getRecordValue}static getPropertyRowHeight(){return Ci.ch}willMount(e){super.willMount(e);const{collectionContextStore:t}=e;this.handleMount(t),U.AK.addListener((()=>{this.handleMount(this.props.collectionContextStore)}))}willMountOrUpdate(e){super.willMountOrUpdate(e),we.Z.state&&(this.stores.calendarStore.state.isDragging||this.stores.calendarStore.setState({...this.stores.calendarStore.state,hoveredDay:void 0}));const{query:t,collectionContextStore:o}=e,r=o.permissionScopes.state;!t.calendar_by&&r.canConfigureCollection&&r.canConfigureBlock&&this.updateOrCreateCalendarProperty(e)}didMountOrUpdate(){this.handleScrollThrottled(),this.root||(this.root=d.findDOMNode(this),this.root&&(this.verticalScrollableAncestor=(0,le.VW)(this.root),this.verticalScrollableAncestor&&te.lj(this.verticalScrollableAncestor,"scroll",this.handleScrollThrottled),te.lj(this.root,"mousemove",this.handleMouseMoveThrottled)))}willUnmount(){super.willUnmount(),this.verticalScrollableAncestor&&te.ZV(this.verticalScrollableAncestor,"scroll",this.handleScrollThrottled),this.root&&te.ZV(this.root,"mousemove",this.handleMouseMoveThrottled)}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):L.navigate({environment:this.environment,url:e})}renderPersisted(){var e,t;const{device:o}=this.environment,{store:r,paddingBottom:n,paddingLeft:l,paddingRight:a,query:d,schema:h,collectionContextStore:p,isFullScreen:u}=this.props,{calendar_by:m}=d;if(!m)return this.renderMissingDateProperty();const g=h[m];if(!g||!Ct.Lt(g))return this.renderMissingDateProperty();const S=this.reducerStore.state;if(!S)return;const v=(void 0===(null===(e=this.stores.resultStore.getState())||void 0===e?void 0:e.blockIds)||0===(null===(t=this.stores.resultStore.getState())||void 0===t?void 0:t.blockIds.length))&&Ge({collectionContextStore:p,groupsPointer:[]}),y=this.getCalendarViewRange(p),f=this.weeksStore.state;return(0,We.Z)((e=>s()(ot.Z,{id:"calendar_results",resultStore:this.stores.resultStore,collectionContextStore:p,reducer:S,render:()=>s()(Fr,{isFullScreen:u},void 0,s()(_o.Z,{onChange:this.handleScrollOffsetChange},void 0,s()("div",{style:{paddingBottom:n,paddingLeft:l,paddingRight:a,minWidth:this.props.minWidth},className:q.c7X},void 0,c.createElement(Ro.Z,i()({style:Ei.style,store:r,shouldShowHalo:!u,canSelect:!u,onMouseDown:this.handleEditorMouseDown,analyticsName:"calendar"},e),this.renderHeader(this.getCurrentlyViewedMonth(),y),s()("div",{style:o.isPhone?Ei.mobileHeaderSpacerStyle:Ei.headerSpacerStyle}),s()("div",{style:o.isPhone?Ei.mobileRowsWrapStyle:this.getRowsWrapStyle()},void 0,f&&f.map((e=>o.isPhone?this.renderMobileWeek(e.start,e.items,m,y):this.renderWeek(e.start,e.end,e.items,m,g,y,v))))))))})))}renderMissingDateProperty(){const{paddingBottom:e,paddingLeft:t,paddingRight:o}=this.props;return s()("div",{style:{paddingBottom:e,paddingLeft:t,paddingRight:o},className:q.c7X},void 0,s()(P.FormattedMessage,{defaultMessage:"Unable to render this view because the database is missing a date property.",id:"database.calendarView.missingDateProperty"}))}renderHeader(e,t){const{device:o}=this.environment,{collectionContextStore:r}=this.props,i=ie.default.getIntl();return s()(kr,{position:Ue.Top},void 0,c.createElement("div",{style:o.isPhone?this.getHeaderMobileStyle():this.getHeaderStyle(),ref:this.handleHeaderMount},s()("div",{style:{display:"flex",height:42,alignItems:"center",marginBottom:2}},void 0,s()("div",{style:{fontWeight:x.Z.fontWeight.semibold,marginLeft:8,marginRight:8,lineHeight:1,fontSize:o.isPhone?16:14}},void 0,this.getHeaderText(t,e,di.SP)),s()("div",{style:{flexGrow:1}}),s()(lo.Z,{ariaLabel:i.formatMessage({id:"database.calendarView.previousMonthButton.label",defaultMessage:"Previous Month"}),mobileFeedback:o.isMobile,icon:y.Z.chevronLeft,onClick:()=>this.handleCalendarClick("left",r)}),s()(at.Z,{isSmall:!0,onClick:this.handleTodayClick},void 0,s()(P.FormattedMessage,{defaultMessage:"Today",id:"database.calendarView.todayButton.label"})),s()(lo.Z,{ariaLabel:i.formatMessage({id:"database.calendarView.nextMonthButton.label",defaultMessage:"Next Month"}),mobileFeedback:o.isMobile,icon:y.Z.chevronRight,onClick:()=>this.handleCalendarClick("right",r)})),s()("div",{style:{display:"flex",marginTop:o.isPhone?8:0,boxShadow:`0 1px 0 ${this.theme.tableDividerColor}`},className:q.GNl},void 0,(0,pi.kv)(U.AK.state,di.SP).map((e=>{let[t,o]=e;return s()("div",{style:this.getWeekDayNameStyle()},t,o)})))))}renderWeek(e,t,o,r,i,n,l){const{collectionContextStore:a,format:c,schema:d,blockPropertyValueOverlayStore:h}=this.props,p=a.collectionViewStore();if(!p)return;const u=this.canEditCalendar(),{calendarStore:m}=this.stores,g=m.state,S=[...Array(7).keys()].map((t=>this.renderDay(t,(0,ui.Xz)({date:e,daysToAdd:t}),r,i,n,l))),v=[];let y=0;for(const P of o){const o=Ve.G.createChildStore(p,{table:b.iU,id:P.id});g.isDragging&&g.target===o&&g.temporaryValue||v.push(s()(ki,{collectionContextStore:a,store:o,startOfWeek:e,endOfWeek:t,start:P.start,end:P.end,row:P.row,includeTime:P.includeTime,format:c,schema:d,calendarBy:r,disabled:!u,calendarStore:m,blockPropertyValueOverlayStore:h,resultsStore:this.resultsStore,handleOpenPeekPage:this.handleOpenPeekPage},o.id)),P.row>y&&(y=P.row)}const f=g.isDragging&&g.temporaryValue&&(0,ui.Y_)(g.temporaryValue,(0,je.r)());if(g.isDragging&&g.temporaryValue&&f&&(0,hi.b8)(e,t,f.start,f.end)){const{target:i,temporaryValue:n}=g,l=o.find((e=>e.id===i.id));v.push(s()(ki,{collectionContextStore:a,store:i,startOfWeek:e,endOfWeek:t,start:f.start,end:f.end,row:l?l.row:0,includeTime:"datetime"===n.type||"datetimerange"===n.type,format:c,schema:d,calendarBy:r,disabled:!u,calendarStore:m,blockPropertyValueOverlayStore:h,resultsStore:this.resultsStore,handleOpenPeekPage:this.handleOpenPeekPage},i.id))}const C=(c.calendar_properties?c.calendar_properties.filter((e=>e.visible)).map((e=>e.property)):[]).length+1,w="week"===n?372:124,x=Ei.getPropertyRowHeight()*C+2*Fi+2*Di,k=Math.max((y+1)*x+Vi+4,w);return s()("div",{style:{...Ei.weekWrapStyle,height:k}},e.toString(),S,v)}renderDay(e,t,o,r,n,l){const{store:a,collectionContextStore:d}=this.props,{calendarStore:h}=this.stores,{dayStoreMap:p}=h.state,u=ie.default.getIntl(),m=h.state,g="date"===r.type,S=d.shouldAllowNewItemCreation();let v=p.get(t);v||(v=new Ve.G(this.environment,a.pointer,{userId:a.userId,inMemoryRecordCache:a.inMemoryRecordCache}),p.set(t,v));const f=!m.isDragging&&m.hoveredDay===t,C=(0,ui.Bn)({firstDate:t,secondDate:this.getCurrentlyViewedMonth()}),b=(0,ui.Y3)(t),w=(0,ui.LY)(t),x=!C&&!b&&"week"!==n,k=u.formatMessage({defaultMessage:"Add an item",id:"database.calendarView.addItemButtonTooltip"});return s()(Ro.Z,{style:w?this.getWeekendDayStyle():this.getDayStyle(),store:v,canDropOnto:this.canEditCalendar()&&g,onSelectableDrop:e=>{N.createAndCommit({userAction:"Calendar.renderDay",environment:this.environment,perform:r=>{const i=d.collectionStore();if(!i)return;const n=he.default.mark("collections.drop_item_lag");he.default.measureAfterNextFlush(n,{environment:this.environment,getData:()=>j.yr({collectionContextStore:d,is_native_drop:!1,is_empty:!1})}),M.JN({...e,environment:this.environment,startOfDay:t,calendarBy:o,collectionStore:i,collectionContextStore:d,results:this.resultsStore.state,transaction:r})}})},onDoubleClick:()=>{this.canEditCalendar()&&$e.M_(this.environment)&&S&&(this.createBlockInDay(t,o),T.W2j(this.environment,{type:"page",from:"calendar_day_double_click",...(0,j.Pn)(d)}))},analyticsName:"calendar_day",shouldShowDropZone:!0},t.toString(),f&&(g||b)&&S&&this.canEditCalendar()&&s()(ht.Z,{renderTooltip:()=>k,render:e=>c.createElement(lo.Z,i()({ariaLabel:k,icon:y.Z.plus,showShadow:!0,hasBackground:!0,style:{position:"absolute",top:6,left:6,width:20,height:20},onClick:()=>{$e.M_(this.environment)&&(this.createBlockInDay(t,o),T.W2j(this.environment,{type:"page",from:"calendar_day_add_button",...(0,j.Pn)(d)}))}},(0,tt.Z)(e,{onMouseDown:re.$0})))}),s()("div",{style:{...b?this.getTodayNumberStyle():Ei.dayNumberStyle,...x&&{color:this.theme.lightTextColor}},className:l?`${q.irE} notion-shimmer-text animation-delay-${e}`:`${q.irE}`},void 0,1!==(0,ui.TE)(t)||b?(0,ui.TE)(t):`${new Intl.DateTimeFormat(u.locale,{month:"short",day:"numeric"}).format(new Date(t))} `))}renderMobileWeek(e,t,o,r){const i=[...Array(7).keys()].map((i=>{const n=(0,ui.Xz)({date:e,daysToAdd:i});return this.renderMobileDay(n,(0,ui.us)(n),t,o,r)}));return s()("div",{style:this.getMobileWeekStyle()},e.toString(),i)}renderMobileDay(e,t,o,r,n){const{collectionContextStore:l,query:a,format:d,schema:h,blockPropertyValueOverlayStore:p}=this.props,u=this.canEditCalendar(),m=o.find((o=>(0,hi.b8)(e,t,o.start,o.end?o.end:void 0))),g=(0,ui.TE)(e),S=(0,ui.Bn)({firstDate:e,secondDate:this.getCurrentlyViewedMonth()}),v=(0,ui.Y3)(e),y=!S&&!v&&"week"!==n;return s()(it.ZP,{popupType:it.Z4.SlideUp,renderOrigin:e=>c.createElement(qt.Z,i()({style:Ei.mobileDayButtonStyle},e),s()("div",{style:{...v?Ei.mobileTodayNumberStyle:Ei.mobileDayNumberStyle,...y&&{color:this.theme.lightTextColor}}},void 0,g),m&&s()("div",{style:this.getMobileDayEventDotStyle()})),render:t=>s()(ce.LazyMobileCalendarDayMenu,{collectionContextStore:l,initialStartOfDay:e,format:d,schema:h,query:a,calendarBy:r,disabled:!u,onDismiss:t.close,blockPropertyValueOverlayStore:p,resultsStore:this.resultsStore})},g.toString())}handleCalendarClick(e,t){const o=(0,ui.V7)(t.dateRangeStart.state,U.AK.state),r=this.getCalendarViewRange(this.props.collectionContextStore);if("month"===r){const t="left"===e?-1:1,i=(0,ui.IS)((0,ui.kl)((0,ui._)({date:o,monthsToAdd:t})),U.AK.state);this.setNewCalendarStart(i,r)}else{const o="left"===e?-7:7,i=(0,ui.IS)((0,ui.Xz)({date:t.dateRangeStart.state,daysToAdd:o}),U.AK.state);this.setNewCalendarStart(i,r)}}handleMount(e){const t=e.collectionViewStore();if(!t)return;const o=this.startOfWeekSettingStore.state;if(void 0===o)return;const r=this.getCalendarViewRange(e),i=vi.Z.getLocalDateRangeStart({collectionViewId:t.id,currentUserId:this.environment.currentUser.id}),n=(0,ui.IS)(i,o),s=(0,ui.IS)((0,ui.kl)(i),o),l="month"===r?s:n;this.stores.calendarStore.setState({...this.stores.calendarStore.state,startingMonth:s.valueOf()}),this.setNewCalendarStart(l,r)}getHeaderText(e,t,o){var r;const i=(0,pi.Yx)(t,"month_year_long",o);if("month"===e)return i;const n=null===(r=this.weeksStore)||void 0===r||null===(r=r.state)||void 0===r?void 0:r[0];if(void 0===n)return"";if((0,ui.Bn)({firstDate:n.start,secondDate:n.end}))return i;return`${(0,pi.Yx)(n.start,(0,ui.Xh)({firstDate:n.start,secondDate:n.end})?"month_short":"month_year_short",o)} - ${(0,pi.Yx)(n.end,"month_year_short",o)}`}setDateRange(e,t){const{collectionContextStore:o}=this.props,{calendarStore:r}=this.stores;E.t5({dateRangeStart:e,dateRangeEnd:t,collectionContextStore:o}),r.setState({...r.state,startingMonth:(0,ui.kl)((0,ui.V7)(e,U.AK.state))})}findHoveredDay(e,t){H.Ch();const{dayStoreMap:o}=this.stores.calendarStore.state,{selectableRectMap:r}=yi.Z.state,i=Array.from(o.keys()),n=Array.from(o.values());for(const[s,l]of r.entries())if(l&&Si.uh(l,e,t)&&n.indexOf(s.props.store)>=0)return i.find((e=>o.get(e)===s.props.store))}createBlockInDay(e,t){const{collectionContextStore:o}=this.props,{mainEditorCurrentBlockStore:r}=ue.default.state;N.createAndCommit({userAction:"Calendar.createBlockInDay",environment:this.environment,perform:i=>{const{newStore:n}=V.IW({environment:this.environment,collectionContextStore:o,groupsPointer:[],results:this.resultsStore.state,insertAtIndex:0,coerce:!0,initializeDefaultTemplate:!0,transaction:i,from:"calendar"});M.xD({type:"timestamp",environment:this.environment,store:n,propertyId:t,timestampMs:e,transaction:i});const s=ee.mb({store:n,mainEditorCurrentBlockStore:r,collectionContextStore:o})??(0,oe.ZP)({store:n,pageVisitSource:g.tY.Create});this.navigate(s),_.Xd({collectionContextStore:o,resultsStore:void 0})}})}setNewCalendarStart(e,t){const{collectionContextStore:o}=this.props,r=o.collectionViewStore();if(!r)return;const i=this.shouldInfinitelyLoad(),n=U.AK.state,s=(0,ui.V7)(e,n),l=(0,ui.IS)(e,n);if(vi.Z.setLocalDateRangeStart({collectionViewId:r.id,dateRangeStart:"month"===t?s:l,currentUserId:this.environment.currentUser.id}),"month"===t){const t=i?(0,ui.V7)((0,ui._)({date:s,monthsToAdd:1}),n):(0,ui.V7)((0,ui.RN)(s),n);this.setDateRange(e,t),this.verticalScrollableAncestor&&i&&(this.verticalScrollableAncestor.scrollTop=0)}else"week"===t&&this.setDateRange(e,s)}shouldInfinitelyLoad(){const{device:e}=this.environment,{collectionContextStore:t}=this.props,o="month"===this.getCalendarViewRange(t);return this.props.isFullScreen&&!e.isMobile&&o}isInMonth(e){const{startOfDay:t,startOfMonth:o}=e;return(0,ui.AD)({date:t,startOfMonth:o})}updateOrCreateCalendarProperty(e){const{schema:t}=e,{collectionContextStore:o}=this.props,r=ie.default.getIntl(),i=o.collectionStore();if(!i)return;const n=o.collectionViewStore();n&&N.createAndCommit({userAction:"Calendar.updateOrCreateCalendarProperty",environment:this.environment,perform:e=>{let o,s=ee.PD(t);if(!s){s=(0,Ze.ZP)();o={[s]:{name:r.formatMessage({id:"database.calendarView.dateProperty.defaultName",defaultMessage:"Date"}),type:"date"}}}E.Es({collectionViewStore:n,update:{calendar_by:s},transaction:e}),o&&E.xO({environment:this.environment,collectionStore:i,update:o,transaction:e})}})}canEditCalendar(){const e=this.props.collectionContextStore.permissionScopes.state;return this.canEdit()&&e.canEditContent}getHeaderStyle(){var e;const{collectionContextStore:t,isInPeekRenderer:o}=this.props;return{position:"absolute",left:0,right:0,background:(null===(e=t.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(o?this.theme.cardContentBackground:this.theme.contentBackground),zIndex:k.VT}}getHeaderMobileStyle(){return{position:"absolute",left:0,right:0,background:this.theme.contentBackground,zIndex:k.VT}}getRowsWrapStyle(){return{boxShadow:`-1px 0 0 ${this.theme.tableDividerColor}`,marginTop:1,overflow:"hidden"}}getWeekDayNameStyle(){return{flexGrow:1,flexBasis:0,textAlign:"center",fontSize:12,height:24,color:this.theme.lightTextColor}}getDayStyle(){return{position:"relative",flexGrow:1,flexShrink:0,flexBasis:0,borderRight:`1px solid ${this.theme.tableDividerColor}`,borderBottom:`1px solid ${this.theme.tableDividerColor}`,cursor:"default"}}getWeekendDayStyle(){return{...this.getDayStyle(),background:this.props.isInPeekRenderer?this.theme.cardSidebarBackground:this.theme.sidebarBackground}}getTodayNumberStyle(){return{position:"absolute",fontSize:14,top:4,right:4,height:24,width:24,lineHeight:"24px",borderRadius:"100%",textAlign:"center",color:Ho.ZP.white,background:this.theme.calendarTodayBackground}}getMobileWeekStyle(){return{display:"flex",boxShadow:`0 -1px 0 ${this.theme.tableDividerColor}`,paddingTop:8,paddingBottom:8,fontSize:14}}getMobileDayEventDotStyle(){return{width:8,height:8,background:this.theme.mediumIconColor,borderRadius:"100%",marginTop:2,marginLeft:"auto",marginRight:"auto"}}getCalendarViewRange(e){const t=e.collectionViewStore(),o=null==t?void 0:t.getFormatStore();return(null==o?void 0:o.getKeyStore("calendar_view_range").getValue())??"month"}getCurrentlyViewedMonth(){const e=this.props.collectionContextStore.dateRangeStart.state;return this.shouldInfinitelyLoad()||!e?this.stores.calendarStore.state.startingMonth:(0,ui.kl)((0,ui.V7)(e,U.AK.state))}}Ei.displayName="Calendar",Ei.contextTypes={...K.wK,...h.w},Ei.style={position:"relative",paddingLeft:1},Ei.viewRangeSelectorButtonStyle={marginRight:6,paddingRight:6},Ei.headerSpacerStyle={height:66},Ei.mobileHeaderSpacerStyle={height:74},Ei.mobileRowsWrapStyle={},Ei.weekWrapStyle={position:"relative",display:"flex"},Ei.dayNumberStyle={position:"absolute",fontSize:14,top:4,right:10,height:24,lineHeight:"24px",textAlign:"right",transition:"color 100ms ease-out"},Ei.mobileDayButtonStyle={width:"100%",height:44,borderRadius:3},Ei.mobileDayNumberStyle={height:28,display:"flex",alignItems:"center",justifyContent:"center"},Ei.mobileTodayNumberStyle={height:28,width:28,lineHeight:"28px",borderRadius:"100%",textAlign:"center",color:Ho.ZP.white,background:Ho.ZP.red,marginLeft:"auto",marginRight:"auto"},Ei.loadingSpinnerStyle={margin:"8px auto"};const Ai=Ei;var _i=o(6776);function Zi(e){const{environment:t,newStore:o,previousStore:r}=e;H.eP({environment:t,store:o}),E.Z5({store:o}),_i.Z.setState({store:o,editMode:"new",previousStore:r})}var Li=o(37190);class Oi extends Ee.Z{constructor(){super(...arguments),this.storeTypes={mouseStore:Pe.Z},this.renderProperty=e=>{const{store:t,disabled:o,blockPropertyValueOverlayStore:r,collectionContextStore:i}=this.props,n=t.getAssociatedCollectionStore();if(n)return s()(Kt.Z,{store:t,property:e,disabled:o||!t.canEdit(),locked:i.permissionScopes.state.isLocked,format:Ut.C.ListView,tableWrap:!1,blockPropertyValueOverlayStore:r,collectionStore:n,collectionViewStore:this.props.collectionContextStore.collectionViewStore(),showIfEmpty:this.isEditing.state,onBgClick:this.handleBlockPropertyExit,onEnter:this.handleBlockPropertyExit,onEsc:this.handleBlockPropertyExit,onTab:this.handleBlockPropertyTab,onUntab:this.handleBlockPropertyUntab,onClick:this.disallowEmptyItemDelete},e)},this.renderDiscussionIndicator=()=>{const{store:e}=this.props,t=It.Xp(e,{recursivelyLoadAllDiscussions:!1});if(t>0)return s()("div",{style:{display:"inline-flex",alignItems:"center",color:this.theme.lightTextColor,fontWeight:x.Z.fontWeight.semibold,fontSize:12,paddingLeft:10,paddingRight:10}},void 0,y.Z.speechBubble({width:14,height:14,marginRight:4,fill:this.theme.mediumIconColor}),t)},this.handleOpenPeekPage=()=>{this.disallowEmptyItemDelete(),this.props.handleOpenPeekPage()},this.handleRecordIconChange=e=>{const{store:t}=this.props,o=t.getIconStore();o&&N.createAndCommit({userAction:"CollectionListViewItem.handleRecordIconChange",environment:this.environment,perform:t=>{Pt.sO({store:o,value:e,transaction:t})}})},this.handleMouseMove=()=>{if(!we.Z.state){const{mouseStore:e}=this.stores;e.setState({...e.state,mouseEntered:!0})}},this.handleMouseLeave=()=>{const{mouseStore:e}=this.stores;e.setState({...e.state,mouseEntered:!1})},this.handleMouseMoveThrottled=(0,l.throttle)(this.handleMouseMove,100),this.handleMouseLeaveDebounced=(0,l.debounce)(this.handleMouseLeave,100),this.mouseIsEntered=this.createComputedStore((()=>this.stores.mouseStore.state.mouseEntered)),this.isEditing=this.createComputedStore((()=>{const e=Mt.Z.state;return Boolean(e.isActive&&e.store.id===this.props.store.id)})),this.newItemEditMode=this.createComputedStore((()=>{const e=_i.Z.state;return e.store&&e.store.id===this.props.store.id?e.editMode:void 0})),this.newItemPreviousStore=this.createComputedStore((()=>{const e=_i.Z.state;return e.store&&e.store.id===this.props.store.id?e.previousStore:void 0})),this.removeCollectionListViewItem=e=>{N.createAndCommit({userAction:"CollectionListViewItem.handleItemTextEsc",environment:this.environment,perform:t=>{V.Od({store:e,transaction:t})}})},this.disallowEmptyItemDelete=()=>{E.IH({store:this.props.store})},this.handleBlockPropertyExit=()=>{kt.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore}),H.Ys({environment:this.environment,store:this.props.store}),this.disallowEmptyItemDelete()},this.handleTitleTab=()=>{const e=this.getNonEmptyProperties(),t=this.findFirstOpenableProperty(e);this.handleTitleTabShortcuts(t)},this.handleTitleUntab=()=>{const e=this.getNonEmptyProperties(),t=this.findLastOpenableProperty(e);this.handleTitleTabShortcuts(t)},this.handleBlockPropertyTab=()=>{const e=this.findNextOpenableProperty();this.handlePropertyTabShortcuts(e)},this.handleBlockPropertyUntab=()=>{const e=this.findPreviousOpenableProperty();this.handlePropertyTabShortcuts(e)},this.shouldCaptureKeyboard=this.createComputedStore((()=>Vt.default.state.stores.length>0&&Vt.default.state.stores[0].id===this.props.store.id))}activate(){const e=this.getPeekUrl();e&&(this.props.handleOpenPeekPage(),L.navigate({environment:this.environment,url:e}))}didMount(){super.didMount(),this.isEditing.state&&"new"===this.newItemEditMode.state&&z.NX({store:this.props.store.getBlockTitleStore()})}willUnmount(){super.willUnmount(),_i.Z.reset(),Mt.Z.reset()}renderComponent(){const{device:e}=this.environment,{showProperties:t}=this.props,o=e.isPhone&&this.props.showProperties.length>0,r=this.renderToggleButton();return o?s()("div",{style:{display:"flex"}},void 0,r,s()(Yt.Z,{href:this.getBlockUrl(),metaHref:this.getPeekUrl(),external:!1,style:this.getTwoLineMobileWrapStyle(),innerStyle:{paddingRight:4,marginTop:10,marginBottom:10}},void 0,s()("div",{style:{display:"flex",alignItems:"center"}},void 0,this.renderTitle()),s()("div",{style:{display:"flex",alignItems:"center",paddingLeft:6,marginTop:4}},void 0,t.map(this.renderProperty)))):s()(Qt.Z,{capture:this.shouldCaptureKeyboard.state,onShiftEnter:this.props.onShiftEnter},void 0,s()("div",{style:{display:"flex"}},void 0,r,s()(Yt.Z,{href:this.getBlockUrl(),metaHref:this.getPeekUrl(),onClick:this.handleOpenPeekPage,external:!1,style:this.getInlineWrapStyle(this.isEditing.state?"multi":"single"),innerStyle:{display:"flex",alignItems:"center",paddingRight:4,userSelect:this.isEditing.state?void 0:"none",WebkitUserSelect:this.isEditing.state?void 0:"none"},hoveredStyle:{background:this.isEditing.state?"transparent":this.theme.buttonHoveredBackground},pressedStyle:{background:this.isEditing.state?"transparent":this.theme.buttonPressedBackground},onMouseEnter:this.handleMouseMoveThrottled,onMouseMove:this.handleMouseMoveThrottled,onMouseLeave:this.handleMouseLeaveDebounced},void 0,this.renderTitle(),t.map(this.renderProperty))))}renderTitle(){const{store:e,disabled:t,collectionContextStore:o,blockPropertyValueOverlayStore:r}=this.props,i=e.getAssociatedCollectionStore();if(!i)return;const{isSyncedCollection:n}=o.permissionScopes.state;return s()(Kt.Z,{store:e,property:n?" title":"title",disabled:t||!e.canEdit(),locked:o.permissionScopes.state.isLocked,format:Ut.C.ListView,tableWrap:!1,blockPropertyValueOverlayStore:r,collectionStore:i,collectionViewStore:o.collectionViewStore(),forceMouseEntered:this.mouseIsEntered.state,handleOpenPeekPage:this.handleOpenPeekPage,onTab:this.handleTitleTab,onUntab:this.handleTitleUntab})}renderToggleButton(){const{collectionContextStore:e,toggleButton:t,subitemPath:o}=this.props,r=e.currentSubitemFormatStore.state,i=(null==o?void 0:o.length)??0;if(!r)return;const n=Math.max((i-1)*xo.Hw,0)+xo.gY;return t?s()("div",{style:{paddingTop:4,display:"flex"}},void 0,s()("div",{style:{width:n}}),t):s()("div",{style:{minWidth:n+xo.Hw}})}handlePropertyTabShortcuts(e){const{store:t,blockPropertyValueOverlayStore:o}=this.props;if(o.state.isOpen){if("title"===e){kt.xv({environment:this.environment,blockPropertyValueOverlayStore:o});const e=t.getBlockTitleStore();H.eP({environment:this.environment,store:t}),z.NX({store:e})}else e?(kt.xv({environment:this.environment,blockPropertyValueOverlayStore:o}),kt.bA({environment:this.environment,blockPropertyValueOverlayStore:o,store:t,property:e,format:Ut.C.ListView,collectionContextStore:this.props.collectionContextStore})):kt.xv({environment:this.environment,blockPropertyValueOverlayStore:o});this.disallowEmptyItemDelete()}}handleTitleTabShortcuts(e){e&&kt.bA({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:this.props.store,property:e,format:Ut.C.ListView,collectionContextStore:this.props.collectionContextStore}),this.disallowEmptyItemDelete()}findPreviousOpenableProperty(){const{blockPropertyValueOverlayStore:e}=this.props,t=e.state,o=this.getNonEmptyProperties(),r=t.isOpen?o.findIndex((e=>e===t.property)):-1,i=a().findLast(o,((e,t)=>t<r&&this.canOpenProperty(e)));return i||(this.isEditing.state?"title":this.findLastOpenableProperty(o))}findNextOpenableProperty(){const{blockPropertyValueOverlayStore:e}=this.props,t=e.state,o=this.getNonEmptyProperties(),r=t.isOpen?o.findIndex((e=>e===t.property)):-1,i=o.find(((e,t)=>t>r&&this.canOpenProperty(e)));return i||(this.isEditing.state?"title":this.findFirstOpenableProperty(o))}findLastOpenableProperty(e){return a().findLast(e,(e=>this.canOpenProperty(e)))}findFirstOpenableProperty(e){return e.find((e=>this.canOpenProperty(e)))}canOpenProperty(e){const{schema:t}=this.props,o=t[e];return Boolean(o&&!Ct.uk.includes(o.type))}getNonEmptyProperties(){const{store:e,schema:t,showProperties:o}=this.props;return e.isDefined()?o.filter((o=>{const r="title"!==o&&this.isEditing.state;return!_t.wV({property:o,schema:t,block:e.getModel(),getRecordModel:e.getRecordModel,userId:this.environment.currentUser.id,userTimeZone:(0,je.r)(),intl:ie.default.getIntl()})||r})):[]}getPeekUrl(){const{store:e,collectionContextStore:t}=this.props,{mainEditorCurrentBlockStore:o}=ue.default.state;return ee.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})}getBlockUrl(){return(0,oe.ZP)({store:this.props.store,fullyQualified:!1,pageVisitSource:g.tY.LinkInPage})}getInlineWrapStyle(e){return{display:"flex",flexGrow:1,textDecoration:"none",overflow:"hidden",borderRadius:3,..."single"===e?{height:30}:{minHeight:30}}}getTwoLineMobileWrapStyle(){return{flexGrow:1,textDecoration:"none",overflow:"hidden",borderBottom:`1px solid ${this.theme.tableDividerColor}`}}getTitleWrapStyle(){const{device:e}=this.environment;return{display:"flex",marginRight:"auto",minWidth:e.isMobile?0:240}}getTitleStyle(){return{fontWeight:x.Z.fontWeight.medium,borderBottom:`1px solid ${this.theme.tableDividerColor}`,lineHeight:1.3}}}Oi.displayName="CollectionListViewItem",Oi.iconStyle={marginLeft:2,marginRight:6};const Gi=Oi;function Hi(e){window.__c={n:"CollectionNestedCreateSubitemButton"};const t=(0,vo.O7)(),{store:o,collectionContextStore:r,disabled:i,groupsPointer:n,collectionStore:l,subitemPath:a,indentLevel:d,onSubitemCreate:h}=e,p=(0,yo.VK)((()=>(0,ee.fk)({environment:t,collectionContextStore:r})),[r,t]),u=(0,yo.VK)((()=>{var e;return"timeline"===(null===(e=r.collectionViewStore())||void 0===e?void 0:e.getType())}),[r]),m=(0,yo.VK)((()=>{var e;return(0,$.$4)()&&"title"===(null===(e=r.collectionViewStore())||void 0===e?void 0:e.getFormat().table_subitem_toggle_column)}),[r]),g=(0,yo.VK)((()=>(0,ko.f2)({columnIndex:0,titleColumnIndex:0,shouldShowBulkActionsToolbar:p,indentLevel:d+1,isSubitemToggleOnTitleColumn:m})),[d,m,p]),S=(0,fo.yK)((t=>({newRowButton:{display:"flex",alignItems:"center",height:32,width:"100%",paddingLeft:g+8,fontSize:14,lineHeight:x.Z.lineHeight.UIRegular.desktop,borderBottom:`1px solid ${t.tableDividerColor}`,background:t.contentBackground,left:0,right:0,...u&&{background:"none",borderTop:"none"},...e.styles},newRowContainer:{display:"inline-flex",alignItems:"center",position:"sticky",left:g+8,color:t.lightTextColor},newIcon:{width:14,height:14,marginLeft:-1,marginRight:6,fill:t.lightIconColor},newText:{color:t.lightTextColor}})),[g,u,e.styles]),v=(0,yo.VK)((()=>{const e=r.permissionScopes.state,t=l.isSyncedCollection();return!i&&e.canEditContent&&!t}),[r,i,l]),f=(0,c.useCallback)((()=>{N.createAndCommit({userAction:"CollectionNestedCreateSubitemButton.handleClick",environment:t,perform:e=>{var i;const s=null===(i=r.groupsStore.getGroupState(n))||void 0===i?void 0:i.resultsStore,c=V.yk({environment:t,collectionContextStore:r,groupsPointer:n,results:(null==s?void 0:s.state)??[],store:o,before:!1,collectionStore:l,transaction:e,subitemPath:a,subitemInsertDirection:"into"});c&&h(c)}}),T.y2U(t)}),[r,t,n,l,o,a,h]);return v?s()(qt.Z,{onClick:f,onMouseDown:re.$0,style:S.newRowButton},void 0,s()("span",{style:S.newRowContainer},void 0,y.Z.plus(S.newIcon),s()("span",{style:S.newText},void 0,s()(P.FormattedMessage,{defaultMessage:"New sub-item",id:"database.tableView.nest.addSubitem"})))):null}function zi(e){window.__c={n:"ListShimmer"};const{isFullScreen:t,hasGroups:o,hasPartialResults:r,hasSearchQuery:i}=e;if(!(0,Or.Z)(!0,0,100))return null;let n=1;o||r||i||(n=t?10:3);const l=a().times(n).map((e=>s()(Xr,{},e)));return s()("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",marginLeft:3}},void 0,l)}class Ni extends h.Z{constructor(){super(...arguments),this.renderGroupHeader=e=>c.createElement(Tr,i()({},e,{height:48,getComputedStickyStyle:this.getGroupHeaderComputedStickyStyle})),this.renderGroup=e=>{const{store:t,format:o,isFullScreen:r,disabled:i,collectionContextStore:n,schema:l,blockPropertyValueOverlayStore:a}=this.props,d=e?[e]:[],h=this.getShowProperties(),p=this.isReady.state,u=n.groupsStore.getGroupState(d);if(!u)return;const m=n.permissionScopes.state,g=u.reducerResultStore.state,S=m.isSyncedCollection,v=ee.VM({collectionContextStore:n,reducerResult:g,isFullScreen:r}),y=p&&!i&&t.canEdit()&&m.canEditContent&&!S,f=!i&&t.canEdit()&&m.canEditContent&&!S,C=void 0!==g&&(null==g?void 0:g.blockIds.length)>0,b=""!==n.searchQuery.state,w=void 0!==e,x=Ge({collectionContextStore:n,groupsPointer:d});return s()("div",{style:{paddingBottom:e?16:void 0}},void 0,s()(Ao,{collectionContextStore:n,groupsPointer:d,format:o,canDrag:f,resultProps:{schema:l,collectionViewBlockStore:this.props.store,showProperties:h,disabled:i,blockPropertyValueOverlayStore:a,collectionContextStore:n,onShiftEnter:()=>this.onItemShiftEnter(u)},canDrop:!0,resultComponent:Gi,disabled:i,shouldShowHoverMenu:!0,direction:Do.Vertical,analyticsName:"list",getItemSelectableStyle:this.getItemSelectableStyle,emptyDroppableSize:0,onSelectableInsertRow:this.onSelectableInsertRow,nestedCreateSubitemButton:e=>{const{store:t,parentStore:o,subitemPath:r,indentLevel:l}=e;if(o)return s()(Hi,{store:t,collectionStore:o,subitemPath:r,indentLevel:l,collectionContextStore:n,disabled:i,groupsPointer:d,styles:{borderBottom:void 0,borderTop:void 0},onSubitemCreate:e=>{E.Z5({store:e,transient:!1}),_i.Z.setState({store:e,editMode:"new",previousStore:void 0})}})}}),x&&s()(zi,{isFullScreen:r,hasGroups:w,hasPartialResults:C,hasSearchQuery:b}),v&&s()(So,{groupsPointer:d,store:t,collectionContextStore:n,format:o,isFullScreen:r,incrementLimitsInRelatedGroups:!1}),y&&c.createElement(c.Fragment,null,v&&s()("div",{style:{width:"100%",borderTop:e?void 0:`1px solid ${this.theme.tableDividerColor}`,marginTop:4,marginBottom:4}}),this.renderAddItemButton(u)))},this.handleScrollOffsetChange=e=>{const{collectionContextStore:t,isFullScreen:o}=this.props,r=t.isLoading.state,i=t.groupsStore.getGroupState([]);if(!i)return;const n=i.reducerResultStore.state;e<Se.Z.incrementScrollOffset&&n&&!r&&n.hasMore&&V.ID({collectionContextStore:t,environment:this.environment,incrementLimitArgs:{isFullScreen:o,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})},this.handleAddItemClick=e=>{if(!$e.M_(this.environment))return;const{collectionContextStore:t}=this.props;t.collectionStore()&&N.createAndCommit({userAction:"CollectionListView.handleAddItemClick",environment:this.environment,perform:o=>{t.collectionStore()&&function(e){const{transaction:t,environment:o,results:r,resultsStore:i,collectionContextStore:n,isFullScreen:s,groupsPointer:l,insertAtIndex:a,from:c}=e;let d;n.searchQuery.state&&E.Ug({searchQuery:"",collectionContextStore:n,isFullScreen:s}),a>0&&(d=r[a]);const{newStore:h,coercionSucceeded:p}=V.IW({environment:o,collectionContextStore:n,groupsPointer:l,results:r,insertAtIndex:a,coerce:!0,initializeDefaultTemplate:!0,transaction:t,from:c});o.device.isMobile?L.navigateToBlock({environment:o,store:h,pageVisitSource:g.tY.Create}):p?Zi({environment:o,newStore:h,previousStore:d}):L.peekBlock({environment:o,store:h,peekMode:(0,ee.kr)(n.collectionViewStore()),resultsStore:i,collectionContextStore:n,pageVisitSource:g.tY.Create}),T.W2j(o,{from:c,type:"page",new_page_id:h.id,...(0,j.Pn)(n)})}({transaction:o,environment:this.environment,results:e.resultsStore.state,resultsStore:e.resultsStore,collectionContextStore:t,isFullScreen:this.props.isFullScreen,groupsPointer:e.groupsPointer,insertAtIndex:e.resultsStore.state.length,from:"list_view_add_item_bottom"})}})},this.handleGroupHeaderAddItem=(e,t,o)=>{if(this.environment.device.isMobile)L.navigateToBlock({environment:this.environment,store:e,pageVisitSource:g.tY.Create});else if(t)Zi({environment:this.environment,newStore:e,previousStore:void 0});else{const{collectionContextStore:t}=this.props,{groupFormat:r}=o,i=r?[r]:[],n=t.groupsStore.getGroupState(i);L.peekBlock({environment:this.environment,store:e,peekMode:ee.kr(t.collectionViewStore()),resultsStore:null==n?void 0:n.resultsStore,collectionContextStore:t,pageVisitSource:g.tY.Create})}},this.onItemShiftEnter=e=>{const{collectionContextStore:t}=this.props,o=t.collectionStore();if(!o||!t.shouldAllowNewItemCreation())return;const r=Vt.default.state.stores[0];if(!r)return;const i=t.subitemTreeStore.state,n=(0,wo.DY)(i.children,(e=>e.value.store===r));if(!n)return;const s=n?(0,xo.Af)(n.map((e=>e.value.store))):"",l=t.subitemExpandedStore.state.get(s),a=Boolean(null==l?void 0:l.isExpanded);N.createAndCommit({userAction:"CollectionListView.onItemShiftEnter",environment:this.environment,perform:i=>{const s=V.yk({environment:this.environment,collectionContextStore:t,groupsPointer:e.groupsPointer,results:e.resultsStore.state,store:r,before:!1,collectionStore:o,transaction:i,subitemPath:n,subitemInsertDirection:a?"into":"below"});s&&Zi({environment:this.environment,newStore:s,previousStore:r})}}),T.sdb(this.environment,"list_item_edit_mode_enter",{...(0,j.Pn)(t),block_id:r.id,from:"shiftEnter",view_type:"list"})},this.onSelectableInsertRow=(e,t)=>{Zi({environment:this.environment,newStore:t,previousStore:e})},this.isReady=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return e.groupsStore.anyGroupHasResults()})),this.getItemSelectableStyle=()=>Ni.itemSelectableStyle,this.getGroupStyle=e=>0===e.index?{}:{borderTop:`1px solid ${this.theme.tableDividerColor}`},this.getGroupHeaderComputedStickyStyle=e=>({boxShadow:e?`0 -1px 0 ${this.theme.contentBackground}`:void 0})}renderComponent(){const{store:e,format:t,paddingBottom:o,paddingLeft:r,paddingRight:n,isFullScreen:l,collectionContextStore:a}=this.props,d=ee.az(a,l),h=t.collection_group_by;return(0,We.Z)((t=>s()("div",{style:{paddingBottom:o,paddingLeft:r,paddingRight:n,minWidth:this.props.minWidth},className:q.nM$},void 0,c.createElement(Ro.Z,i()({store:e,shouldShowHalo:!l,canSelect:!l,analyticsName:"list",style:this.getWrapStyle()},t),h?this.renderGroups(h):this.renderGroup(void 0)),!d&&s()(_o.Z,{onChange:this.handleScrollOffsetChange}))))}renderGroups(e){const{store:t,format:o,collectionContextStore:r,schema:i,disabled:n,isFullScreen:l,paddingLeft:a,isRootChild:c,isInPeekRenderer:d}=this.props;return s()(si,{store:t,id:"list_groups",groupBy:e,groupsFormatKey:Ae.Uh,groupAggregationKey:Ae.dQ,format:o,schema:i,collectionContextStore:r,disabled:n,isFullScreen:l,renderGroup:this.renderGroup,renderHeader:this.renderGroupHeader,getGroupStyle:this.getGroupStyle,onGroupHeaderAddItem:this.handleGroupHeaderAddItem,paddingLeft:a,isRootChild:c,isInPeekRenderer:d,onSelectableInsertRow:this.onSelectableInsertRow})}renderAddItemButton(e){return c.createElement(qt.Z,{onClick:()=>this.handleAddItemClick(e),onMouseDown:re.$0,ref:e=>{e&&Li.registerElementForShadowCursor("db-new-in-list",e)},style:{display:"flex",alignItems:"center",height:30,borderRadius:3,fontSize:14}},y.Z.plus(this.getNewItemButtonIconStyle()),s()("div",{style:{color:this.theme.lightTextColor}},void 0,s()(P.FormattedMessage,{defaultMessage:"New",id:"database.listView.addItemButtonTitle"})))}getShowProperties(){const{format:e}=this.props;return(e.list_properties?e.list_properties:[]).filter((e=>e.visible)).map((e=>{let{property:t}=e;return t}))}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):L.navigate({environment:this.environment,url:e})}getWrapStyle(){const{format:e}=this.props;return{display:"flex",flexDirection:"column",paddingTop:e.collection_group_by?void 0:8,paddingBottom:4}}getNewItemButtonIconStyle(){return{width:14,height:14,marginLeft:4,marginRight:6,fill:this.theme.lightIconColor}}}Ni.displayName="CollectionListView",Ni.contextTypes={...K.wK,...h.w},Ni.itemSelectableStyle={marginTop:1,marginBottom:1,borderRadius:3};const Wi=Ni;var Ki=o(33665);class Ui extends m.default{getInitialState(){return{query:"",limit:20}}}const $i=Ui;var qi=o(81870),Qi=o(26909),Yi=o(44514),ji=o(45669),Xi=o(11470);const Ji=(0,P.defineMessages)({searchPlaceholder:{defaultMessage:"Search for a page…",id:"collectionNoDateMenu.searchPlaceholder"}});class en extends h.Z{constructor(){super(...arguments),this.storeTypes={store:$i,resultStore:m.default.createClass(void 0)},this.renderResults=()=>{const{collectionViewType:e}=this.props,{store:t}=this.stores,{query:o}=t.state,r=this.getCurrentResult(),n=s()(P.FormattedMessage,"calendar"===e?{defaultMessage:"Click to add to the calendar",id:"collectionNoDateMenu.addResultToCalendar.prompt"}:{defaultMessage:"Click to add to the timeline",id:"collectionNoDateMenu.addResultToTimeline.prompt"});return r?r&&0===r.blockIds.length?s()(dt.Z,{title:n},void 0,s()(rr.Z,{title:s()(P.FormattedMessage,{defaultMessage:"No results",id:"collectionNoDateMenu.noResults.title"})})):s()(st.Z,{type:st.i.Vertical,sections:[{key:"results",render:e=>c.createElement(dt.Z,i()({},e,{title:n})),items:this.getMenuListItems(r.blockIds)}],initialFocus:o?0:void 0}):s()(dt.Z,{title:n,loading:!0},void 0,s()(rr.Z,{title:s()(P.FormattedMessage,{defaultMessage:"Loading…",id:"collectionNoDateMenu.loading.message"})}))},this.handleQueryChange=e=>{this.stores.store.setState({query:e.target.value,limit:en.loadMoreIncrement})},this.handleScrollOffsetChange=e=>{const{collectionContextStore:t}=this.props,{store:o}=this.stores,r=this.getCurrentResult(),i=o.state.limit,n=t.isLoading.state;e<en.loadMoreScrollOffset&&r&&r.hasMore&&!n&&o.setState({...o.state,limit:i+en.loadMoreIncrement})},this.reducerStore=this.createComputedStore((()=>{const{property:e}=this.props,{store:t}=this.stores,{query:o,limit:r}=t.state;return{type:"results",filter:{operator:"and",filters:[{property:e,filter:{operator:"is_empty"}}]},limit:r,searchQuery:o}}))}renderComponent(){const{collectionContextStore:e}=this.props,{device:t}=this.environment,{store:o,resultStore:r}=this.stores,{query:i}=o.state;return s()(Qi.ZP,{title:this.renderTitle(),onCancel:this.props.onClose,helpButton:s()(qi.Z,{helpButtonContext:"collection_no_date_menu",href:(0,Ki.UY)("guides.databaseCalendar")}),desktopWidth:450},void 0,s()(dt.Z,{isInput:!0},void 0,s()(or.ZP,{placeholder:ie.default.formatMessage(Ji.searchPlaceholder),focus:!t.isMobile||void 0,focusAfterAnimation:!0,value:i,onChange:this.handleQueryChange})),s()(ot.Z,{id:"no_date_results",reducer:this.reducerStore.state,collectionContextStore:e,render:this.renderResults,resultStore:r}),s()(_o.Z,{onChange:this.handleScrollOffsetChange}))}renderTitle(){const{noDateTotal:e}=this.props;return this.environment.device.isMobile?s()(P.FormattedMessage,{defaultMessage:"Pages with no date",id:"collectionNoDateMenu.mobileMenuTitle"}):s()(Yi.Q,{prefix:s()(P.FormattedMessage,{defaultMessage:"{noDateTotal, plural, one {{noDateTotal} page with no date in} other {{noDateTotal} pages with no date in}}",id:"collectionNoDateMenu.pagesWithNoDateInPrefix",values:{noDateTotal:e}}),viewType:this.props.collectionViewType,viewName:s()(ji.Z,{collectionViewName:this.props.collectionViewName,collectionViewType:this.props.collectionViewType})})}renderMenuListItem(e,t,o){const{device:r}=this.environment;return c.createElement(Xi.Z,i()({},e,{store:t,hidePath:!0,right:s()(Yt.Z,{href:o,innerStyle:{display:"flex",alignItems:"center",borderRadius:3,paddingLeft:r.isMobile?8:6,paddingRight:r.isMobile?8:6,height:r.isMobile?44:22},onClick:()=>{T.tMA(this.environment)}},t.id,s()(P.FormattedMessage,{defaultMessage:"View",id:"collectionNoDateMenu.view.button.label"})),dontShrinkRight:!0}))}getMenuListItems(e){const{collectionStore:t,property:o}=this.props,r=e.map((e=>Ve.G.createChildStore(t,{table:b.iU,id:e}))).filter((e=>!_t.Gl(e.getPropertyStore(o).getValue()))).map((e=>{const{mainEditorCurrentBlockStore:t}=ue.default.state;if(!t)return;const o=(0,oe.ZP)({store:t,peekViewBlockId:e.id,pageVisitSource:g.tY.LinkInPage});return{key:e.id,render:t=>this.renderMenuListItem(t,e,o),action:()=>{this.props.onAddPage(e),T.zes(this.environment)}}}));return a().compact(r)}getCurrentResult(){return this.stores.resultStore.state}}en.displayName="CollectionNoDateMenu",en.loadMoreScrollOffset=200,en.loadMoreIncrement=20;const tn=en;var on=o(65669),rn=o(74487);const nn=rn.undefinable(rn.object({required:{blockIdToVersion:rn.record(rn.string(),rn.number())},optional:{hasMore:rn.boolean()}}));var sn=o(29477),ln=o(36054);class an{constructor(e,t){this.queuedCollectionEmit=void 0,this.queuedBlockIdsToRefetch=void 0,this.isServerRequestRequired=void 0,this.collectionContextStore=void 0,this.environment=void 0,this.isServerQueryCollectionRequired=e=>{if(!Ce.default.checkGate("client_handle_query_collection_locally"))return!0;const t=this.collectionContextStore.isClientModeEnabled.state,o=Boolean(e&&(0,ln.P9)(nn,e)&&e.hasMore);if(t&&!o)return!1;const r=this.collectionContextStore.remoteRequestStore.state;if(!r)return!0;return!!(0,cr.qP)(r.loader.reducers||{}).some((e=>{let[t,o]=e;return"results"!==o.type}))||!(e&&(0,ln.P9)(nn,e)&&!e.hasMore)},this.throttledRefetch=(0,on.Z)((e=>this.refetchFromRemote({...e,queuedTimestamp:Date.now()}))),this.processCollectionRefetch=async e=>{const t=this.queuedBlockIdsToRefetch,o=this.isServerRequestRequired;this.reset(),o?this.throttledRefetch({src:e}):B.bW(this.environment),t&&await E.fI({environment:this.environment,collectionContextStore:this.collectionContextStore,blockIdToMinimumVersion:t})},this.refetchFromRemote=async e=>{const t=Ce.default.getEligibleGroup({experimentId:"collection_client_refetch_throttle_time_ms",defaultGroup:"control"}),o="control"===t?1e3:parseInt(t);await Promise.all([E.dj(this.environment,this.collectionContextStore,e),(0,sn.Vs)(o)])},this.queuedCollectionEmit=!1,this.isServerRequestRequired=!1,this.queuedBlockIdsToRefetch={},this.collectionContextStore=e,this.environment=t}reset(){this.queuedCollectionEmit=!1,this.isServerRequestRequired=!1,this.queuedBlockIdsToRefetch={}}addBlockIdToRefetch(e,t){this.queuedBlockIdsToRefetch[e]=Math.max(this.queuedBlockIdsToRefetch[e]??0,t)}async handleCollectionEmit(e){const{src:t,passThroughData:o,shouldQueueCollectionEmit:r}=e;if((0,ln.P9)(nn,o)&&null!=o&&o.blockIdToVersion&&(0,cr.qP)(o.blockIdToVersion).forEach((e=>{let[t,o]=e;return this.addBlockIdToRefetch(t,o)})),this.isServerRequestRequired=this.isServerRequestRequired||this.isServerQueryCollectionRequired(o),!r)return await this.processCollectionRefetch(t);this.queuedCollectionEmit=!0}async maybeProcessQueuedCollectionEmit(e){if(this.queuedCollectionEmit)return await this.processCollectionRefetch(e)}}var cn=o(91007),dn=o(43664),hn=o(42858),pn=o(58202),un=o(96620),mn=o(13966),gn=o(68709),Sn=o(23063),vn=o(19387);function yn(e){return{boxShadow:`1px 0 0 ${e.regularDividerColor}`,marginRight:1}}const fn=(0,P.defineMessages)({delete:{id:"CollectionsBulkActionsToolbar.deleteButton.tooltip",defaultMessage:"Delete"}});function Cn(e){window.__c={n:"CollectionsBulkActionsToolbar"};const t=(0,W.Y$)(),{marginLeft:o}=e,r=(0,vo.O7)(),n=(0,yo.qz)(void 0,un.Z),l=(0,c.useRef)(null),[a,d]=(0,c.useState)(!1),h=(0,yo.VK)((()=>n.state.lastBlockPropertyValueOverlayCloseTime),[n]),p=(0,yo.VK)((()=>Vt.default.state.stores.filter((e=>pn.R.findBlockFromStore(e)))),[h]),u=p.length,m=(0,yo.VK)((()=>n.getNumberOfTextStoresBeingEdited()),[n]),g=(0,yo.VK)((()=>{var e;return!!(0,ee.fk)({environment:r,collectionContextStore:t})&&(m>0||p.length>=1&&(0,ee.v_)(p,null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.id))}),[t,r,m,p]),S=(0,fo.yK)((e=>({inner:{position:"absolute",top:1,left:0+(o??0),display:"inline-flex",justifyContent:"center",alignItems:"center",borderRadius:5,background:e.popoverBackground,boxShadow:e.lightBoxShadow,height:32},outer:{position:"sticky",top:0,left:0,zIndex:k.mJ,visibility:a?"visible":"hidden"},blockActionMenuButton:{width:30,height:"100%",borderRadius:void 0,borderTopRightRadius:5,borderBottomRightRadius:5},blockActionMenuButtonIcon:{fill:e.regularTextColor},trashButton:{borderRadius:0,height:"100%",border:0,...yn(e),width:28},trashButtonIcon:{width:16},trashButtonIconHovered:{fill:e.accentColors.red[500]}})),[a,o]);return s()(Sn.Z,{isVisible:g,enterAnimationStyle:{opacity:0},animationStyle:{opacity:1},exitAnimationStyle:{opacity:0},springConfig:{opacity:{stiffness:100,damping:10,precision:1e-4}},onAnimationEnd:e=>{e||d(!1)},render:()=>s()(tr.Z,{capture:!0,render:e=>c.createElement("div",i()({ref:l},e,{style:S.outer}),s()(gn.p,{allowSelectionWithin:!1},void 0,s()("div",{style:S.inner},void 0,s()(bn,{selectedItemCount:u,collectionsBulkActionsToolbarStore:n}),s()(xn,{collectionsBulkActionsToolbarStore:n,selectedItems:p,marginLeft:o,setIsReadyToRender:d,outerContainerRef:l}),s()(ht.Z,{renderTooltip:()=>s()("div",{},void 0,ie.default.formatMessage(fn.delete)),render:e=>c.createElement(lo.Z,i()({},e,{ariaLabel:ie.default.formatMessage(fn.delete),icon:()=>y.Z.trash(S.trashButtonIcon),style:S.trashButton,hoveredStyle:S.trashButtonIconHovered,hasBackground:!0,isDarkIconColor:!0,showShadow:!0,onClick:async()=>{T.dhV(r,{analyticsName:wt.sY.deleteName.defaultMessage,from:"bulk_actions_toolbar",block_type:"page"}),await hn.Qw({environment:r,blocks:p})}})),placement:ht.Z.Placement.Top}),s()(mn.Z,{store:p[0],fadeIn:!1,style:S.blockActionMenuButton,hoveredStyle:S.blockActionMenuButton,iconStyle:S.blockActionMenuButtonIcon,extraAnalyticsData:{isFromBulkActionsToolbar:!0}}))))})})}function bn(e){window.__c={n:"SelectedItemCountWidget"};const{collectionsBulkActionsToolbarStore:t,selectedItemCount:o}=e,r=(0,vo.O7)(),i=(0,yo.VK)((()=>t.getNumberOfTextStoresBeingEdited()),[t]),n=(0,yo.VK)((()=>i>0?i:o),[i,o]),l=(0,fo.yK)((e=>({button:{color:e.blueColor,fontSize:14,whiteSpace:"nowrap",height:"100%",alignItems:"center",display:"flex",paddingRight:10,paddingLeft:10,borderTopLeftRadius:5,borderBottomLeftRadius:5,fontVariantNumeric:"tabular-nums",...yn(e)}})),[]);return s()(qt.Z,{style:l.button,onClick:()=>H.ZH(r)},void 0,s()(P.FormattedMessage,{id:"SelectedItemCountWidget.numItemsSelected",defaultMessage:"{itemsSelectedCount} selected",values:{itemsSelectedCount:n}}))}const wn=["title","rollup","formula","button"];function xn(e){window.__c={n:"EditPropertyButtons"};const{outerContainerRef:t,collectionsBulkActionsToolbarStore:o,selectedItems:r,marginLeft:i,setIsReadyToRender:n}=e,l=(0,W.Y$)(),d=(0,yo.VK)((()=>l.normalizedSchemaStore.state),[l]),h=(0,c.useRef)(null),p=(0,yo.VK)((()=>{var e;const t=l.normalizedFormatStore.state;return(null==t||null===(e=t.table_properties)||void 0===e?void 0:e.filter((e=>{const t=d[e.property];return e.visible&&t&&!wn.includes(t.type)&&(0,vt.Sb)({propertySchema:t,property:e.property,blockStores:r,collectionSchema:d})})))??[]}),[l,d,r]).slice(0,6),u=(0,c.useRef)([]),[m,g]=(0,c.useState)(6),[S,v]=(0,c.useState)(!1);return(0,c.useEffect)((()=>{u.current.length>0&&u.current.forEach((e=>{var t;e&&(e.rightEdge=(null===(t=e.element)||void 0===t||null===(t=t.current)||void 0===t?void 0:t.getBoundingClientRect().right)??0)}))}),[u]),function(e){let{outerContainerRef:t,propertyButtonsContainerRef:o,propertyButtonRefs:r,marginLeft:i,setIsReadyToRender:n,setShowIconsOnly:s,setHiddenButtonsIndex:l}=e;(0,c.useEffect)((()=>{const e=a().debounce((()=>{var e,a,c;const d=(null===(e=t.current)||void 0===e?void 0:e.getBoundingClientRect().right)??window.innerWidth,h=((null===(a=t.current)||void 0===a?void 0:a.getBoundingClientRect().width)??window.innerWidth)-(i??0),p=(null===(c=o.current)||void 0===c?void 0:c.getBoundingClientRect().left)??0,u=d-150;let m=r.current.findIndex((e=>e.rightEdge>u));m=-1!==m?m:6;let g=r.current.findIndex(((e,t)=>p+32*t>u));g=-1!==g?g:6;const S=m<2||h<=450;s(S),l(S?g:m),n(!0)}),150,{maxWait:150,leading:!0,trailing:!1});if(t.current){const o=new ResizeObserver((t=>{e()}));return e(),o.observe(t.current),()=>{o.disconnect()}}}),[i,t,r,o,l,n,s])}({propertyButtonsContainerRef:h,propertyButtonRefs:u,outerContainerRef:t,marginLeft:i,setIsReadyToRender:n,setHiddenButtonsIndex:g,setShowIconsOnly:v}),c.createElement("div",{ref:h,style:{display:"flex"}},p.map(((e,t)=>{var r;let i=null===(r=u.current[t])||void 0===r?void 0:r.element;if(!i){const e=c.createRef();u.current[t]={element:e,rightEdge:0},i=e}const n=t>=m;return c.createElement("div",{ref:i,key:e.property},s()(kn,{collectionsBulkActionsToolbarStore:o,schema:d,property:e.property,isHidden:n,showIconsOnly:S},e.property))})))}function kn(e){window.__c={n:"EditPropertyButton"};const{property:t,schema:o,collectionsBulkActionsToolbarStore:r,isHidden:n,showIconsOnly:l}=e,a=(0,W.Y$)(),d=o[t],h=(0,vo.O7)(),p=(0,yo.VK)((()=>!(a.permissionScopes.state.canEditContent||"collectionTypedView"===a.contextType)),[a]),u=(0,fo.yK)((e=>({button:{display:n?"none":"flex",padding:8,...yn(e)}})),[n]),m=(0,c.useRef)(null),g=(0,yo.qz)(void 0,Pe.Z),S=(0,c.useCallback)((async e=>{var o,i;if(!m.current)return;const n=Vt.default.state.stores;e.stopPropagation(),e.preventDefault();const s=null===(o=m.current)||void 0===o?void 0:o.getBoundingClientRect(),l=n[0].getAssociatedCollectionStore();a&&s&&l&&await dn.zt({environment:h,store:n[0],additionalStores:n.slice(1),property:t,rect:s,format:Ut.C.Table,collectionStore:l,blockPropertyValueOverlayStore:U._H(),collectionContextStore:a,statusSetCheckbox:"checkbox"===(null===(i=a.getPropertyFormat(t))||void 0===i?void 0:i.statusShowAs),mouseStore:g,preventClearSelection:!0,collectionsBulkActionsToolbarStore:r})}),[m,a,h,t,g,r]),v=(0,fo.Fg)();return d?s()(ht.Z,{renderTooltip:()=>d.name,render:e=>c.createElement(qt.Z,i()({},e,{ariaLabel:d.name,ref:m,style:u.button,disabled:p,onClick:S}),s()(vn.Z,{style:{maxWidth:"250px",textOverflow:"ellipsis"},propertySchema:d,hideName:l,showIcon:!0,property:t,iconStyle:{fill:v.regularTextColor}})),disableTooltip:!l,placement:ht.Z.Placement.Top}):null}var Pn=o(54634),Tn=o(49670),Rn=o(13005),In=o(91496),Mn=o(54281),Bn=o(64815);class Vn extends m.default{getInitialState(){return{}}}const Fn=Vn,Dn=32;var En=o(35431),An=o(88108);class _n extends En.Z{findCollectionTimelineViewItems(e){return this.getMembersByDOMOrder({filter:t=>e.uiContains(t.props.store)})}}const Zn=new _n;(0,An.exposeDebugValue)("GlobalCollectionTimelineViewItemRegistry",Zn);var Ln=o(20294),On=o(55367),Gn=o(82994);const Hn={position:"absolute",left:0,top:0,zIndex:k.Gt,width:"100%",height:"100%",pointerEvents:"none"};function zn(e){const{startItemPosition:t,value:o}=e;return t&&o?(o&&t&&o.left<=t.left&&(o.right<t.left?o.left=o.right:(o.left=t.left+12,o.top=o.top-15)),o):o}function Nn(e){window.__c={n:"CollectionTimelineRelationArrow"};const{startItem:t,endItem:o,endRelationPointer:r,timelineState:i,disabled:n,isFullScreen:l,isRootChild:a,relationType:d,isUserDrawnTemp:h,isNewSubitemPlaceholder:u,renderEmitter:m}=e,g=(0,W.Y$)(),S=(0,vo.O7)(),v=(0,Ln.k)(),[y,f]=(0,c.useState)(!1),C=(0,fo.Fg)(),[b,w]=(0,c.useState)(null),[x,P]=(0,c.useState)(null),T=(0,c.useCallback)((e=>{w(e.state)}),[]),R=(0,c.useCallback)((e=>{P(e.state)}),[]),I=(0,c.useCallback)((()=>{p.default.afterNextFlush((()=>{v()}))}),[v]);(0,c.useEffect)((()=>(w(t.stores.node.state),P(o?o.stores.node.state:null),t.stores.node.addListener(T),null==o||o.stores.node.addListener(R),null==m||m.addListener(I),g.filtersBarOpenStore.addListener(I),()=>{t.stores.node.removeListener(T),null==o||o.stores.node.removeListener(R),null==m||m.removeListener(I),g.filtersBarOpenStore.removeListener(I)})),[t,o,m,T,R,I,g.filtersBarOpenStore]);const M=(0,yo.VK)((()=>On.ZP.state.isDragging&&On.ZP.state.draggedStores.includes(t.props.store)),[t]),B=(0,yo.VK)((()=>o&&On.ZP.state.isDragging&&On.ZP.state.draggedStores.includes(o.props.store)),[o]),V=(0,yo.VK)((()=>{const e=On.ZP.state;return e.isDragging?e.currentY-e.startY:0}),[]),F=b&&b.getBoundingClientRect().y+(M?V:0),D=(0,yo.VK)((()=>{const e=t.itemPositionStore.state;return F&&e?{left:e.left,right:"subitem"===d?e.left+12:e.right,top:"subitem"===d?F+15:F}:void 0}),[d,t.itemPositionStore,F]),E=x&&x.getBoundingClientRect().y+(B?V:0),A=(0,yo.VK)((()=>{const e=E&&null!=o&&o.itemPositionStore.state?{...o.itemPositionStore.state,top:E}:void 0;return"subitem"===d?zn({startItemPosition:t.itemPositionStore.state,value:e}):e}),[o,E,d,t.itemPositionStore]),_=(0,yo.VK)((()=>void 0!==i.dragState.state),[i]),Z=(0,yo.VK)((()=>void 0!==i.drawState.state),[i]),L=(0,yo.VK)((()=>i.hoveredItem.state),[i.hoveredItem]),O=y&&!_&&!Z,G=(0,c.useCallback)((()=>{r&&!n&&Mn.IL({dependency:{store:t.props.store,relationPointer:r},collectionContextStore:g,environment:S,timelineState:i,isFullScreen:l,isRootChild:a})}),[t,n,r,g,S,i,l,a]),H=(0,c.useCallback)((()=>{f(!0)}),[f]),z=(0,c.useCallback)((()=>{f(!1)}),[f]),N=(0,c.useCallback)((e=>{if(A)return s()(Wn,{topOffset:e,endPosition:A,handleCloseButtonClick:G})}),[A,G]),K=L===t.props.store,U=o&&L===o.props.store,$=K||U||O||"subitem"===d?1:.7;let q,Q=!0;"subitem"===d&&(q=C.collectionUnsetDependencyArrow,Q=!1);const Y=(0,fo.yK)((()=>({svgStyle:{zIndex:O||U?k.Gt:k.wx}})),[O,U]);return D?h?s()(Kn,{startPosition:D,timelineState:i}):u?s()(Un,{startPosition:D,timelineState:i}):t!==o&&A?s()($n,{startPosition:D,endPosition:A,strokeOpacity:$,strokeColorOverride:q,svgStyle:Y.svgStyle,cornerRadiusOverride:"subitem"===d?8:void 0,relationType:d,handleMouseMove:H,handleMouseLeave:z,renderChildren:Q&&O?N:void 0}):null:null}function Wn(e){window.__c={n:"RemoveDependencyButton"};const{topOffset:t,endPosition:o,handleCloseButtonClick:r}=e,i=(0,fo.yK)((e=>({icon:{background:e.white,borderRadius:5,fill:e.accentColors.red[500],height:14,width:14}})),[]);return c.createElement(c.Fragment,null,s()("foreignObject",{width:16,height:16,x:o.left-16,y:o.top-t+8,style:{cursor:"pointer",pointerEvents:"all"},onClick:r},void 0,y.Z.clearInput(i.icon)))}function Kn(e){window.__c={n:"UserDrawnTempDependencyArrow"};const{startPosition:t,timelineState:o}=e,r=(0,yo.VK)((()=>{const e=o.drawState.state;if(!e||void 0===e.xOffsetPx||void 0===e.yOffsetPx)return;return{left:t.right+e.xOffsetPx+18,top:t.top+e.yOffsetPx}}),[t,o.drawState]);return r?s()($n,{startPosition:t,endPosition:r,strokeOpacity:1,relationType:"dependency"}):null}function Un(e){var t;window.__c={n:"NewSubitemPlaceholderArrow"};const{startPosition:o,timelineState:r}=e,i=(0,fo.Fg)(),n=(0,yo.VK)((()=>r.dateRangePlaceholder.state),[r.dateRangePlaceholder]),l=(0,yo.VK)((()=>null!=n&&n.active?n.date:void 0),[n]),a=null!=n&&n.active?null===(t=n.newTimelineItemProps)||void 0===t?void 0:t.subitemPath:void 0,c=a?a[a.length-1].children.length:0,d=o.top+33*c+15+5,h=(0,yo.VK)((()=>{const e=(0,J.HZ)({timelineState:r,dateValue:l,placeholderDate:l,subitemPlaceholderDate:void 0}),t=d&&e?{...e,top:d}:void 0;return zn({startItemPosition:o,value:t})}),[l,d,o,r]);return h?s()($n,{startPosition:o,endPosition:h,strokeOpacity:1,strokeColorOverride:i.collectionUnsetDependencyArrow,relationType:"subitem"}):null}function $n(e){window.__c={n:"RelationArrowBase"};const{startPosition:t,endPosition:o,strokeColorOverride:r,cornerRadiusOverride:i,strokeOpacity:n,relationType:l,svgStyle:a,handleMouseMove:d,handleMouseLeave:h}=e,p=(0,W.Y$)(),u=(0,fo.Fg)(),[m,g]=(0,c.useState)(0),S=t.right,v=t.top+15-m,y=o.left-3,f=o.top+15-m,C=(0,yo.VK)((()=>{if(r)return r;return(0,J.H5)(p)&&t.right&&o.left?t.right<o.left?u.collectionValidDependencyArrow:u.collectionInvalidDependencyArrow:u.collectionUnsetDependencyArrow}),[p,o.left,t.right,r,u]);return c.createElement("svg",{style:{...Hn,...a},ref:e=>{e&&g(e.getBoundingClientRect().top)}},s()(Gn.Z,{startPoint:{x:S,y:v},endPoint:{x:y,y:f},style:{stroke:C,strokeWidth:J.lf,strokeOpacity:n},useRightAngles:"subitem"===l,showArrowHead:"dependency"===l&&!e.renderChildren,cornerRadiusOverride:i,handleMouseMove:d,handleMouseLeave:h},void 0,e.renderChildren&&e.renderChildren(m)))}function qn(e){window.__c={n:"CollectionTimelineDependenciesOverlay"};const{timelineState:t,disabled:o,isReady:r,isFullScreen:i,isRootChild:n,renderEmitter:l}=e,a=(0,W.Y$)(),d=(0,c.useCallback)((()=>{t.drawState.setState(void 0)}),[t.drawState]),h=(0,yo.VK)((()=>a.collectionViewBlockStore()),[a]),p=(0,yo.VK)((()=>a.settingsStore.state.open),[a]);if((0,c.useEffect)((()=>{var e;!p&&null!==(e=t.drawState.state)&&void 0!==e&&e.tryToCompleteDrawnArrow&&d()}),[p,t.drawState,d]),!r||!h)return null;const u=Zn.findCollectionTimelineViewItems(h);return c.createElement(c.Fragment,null,u.map((e=>{const{store:r,groupFormat:a}=e.props,d=null==a?void 0:a.value,h=d?(0,Ae.Hd)(d):"noGroup";return c.createElement(c.Fragment,null,s()(Qn,{startItem:e,timelineState:t,disabled:o,isFullScreen:i,isRootChild:n,renderEmitter:l,relationType:"dependency"},`${r.id}-${h}-${r.key}-dependency`),s()(Qn,{startItem:e,timelineState:t,disabled:o,isFullScreen:i,isRootChild:n,renderEmitter:l,relationType:"subitem"},`${r.id}-${h}-${r.key}-subitem`))})))}function Qn(e){window.__c={n:"CollectionTimelineRelationAnnotationItem"};const{startItem:t,timelineState:o,disabled:r,isFullScreen:i,isRootChild:n,relationType:l,renderEmitter:a}=e,{store:d,schema:h}=t.props,p=(0,W.Y$)(),u=(0,yo.VK)((()=>"dependency"===l?o.drawState.state:void 0),[o.drawState,l]),m=(0,yo.VK)((()=>(null==u?void 0:u.startStore)===d),[d,u]),g=(0,yo.VK)((()=>m&&!(null!=u&&u.tryToCompleteDrawnArrow)),[u,m]),S=(0,yo.VK)((()=>"dependency"===l?m&&u?u.temporaryDependencyRelationPointers:(0,J.YE)(p,d,h):"subitem"===l?(0,J.wI)(p,d,h):[]),[m,u,p,d,h,l]),v=(0,yo.VK)((()=>p.collectionViewBlockStore()),[p]),y=(0,yo.VK)((()=>{var e;const r=o.dateRangePlaceholder.state;if("subitem"!==l||null==r||!r.active||!r.newTimelineItemProps)return;const i=r.newTimelineItemProps.subitemPath;return(i?null===(e=i[i.length-1])||void 0===e?void 0:e.value.store:void 0)===t.props.store?r:void 0}),[l,t.props.store,o.dateRangePlaceholder]);if(!v)return null;const f=Zn.findCollectionTimelineViewItems(v);return c.createElement(c.Fragment,null,S.map((e=>{if(d.id===e.id)return null;const h=f.filter((t=>t.props.store.id===e.id));return c.createElement(c.Fragment,null,h.map((c=>{const d=c.props.store,h=c.props.groupFormat;return s()(Nn,{startItem:t,endItem:c,endRelationPointer:e,timelineState:o,disabled:r,isFullScreen:i,isRootChild:n,renderEmitter:a,relationType:l},`${d.id}-${null==h?void 0:h.value.value}-${d.key}`)})))})),"dependency"===l&&g&&s()(Nn,{isUserDrawnTemp:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,isFullScreen:i,isRootChild:n,relationType:"dependency"}),"subitem"===l&&y&&s()(Nn,{isNewSubitemPlaceholder:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,isFullScreen:i,isRootChild:n,relationType:"subitem"}))}var Yn=o(36488);class jn extends h.Z{constructor(){super(...arguments),this.renderZoomLevelMenu=e=>{const{zoomLevel:t,onChange:o}=this.props,{device:r}=this.environment,n=[{key:"calendar by section",render:e=>c.createElement(dt.Z,e),items:bt.H.map((t=>({key:t,render:e=>c.createElement(rt.Z,i()({},e,{title:this.renderZoomLevelText(t)})),action:()=>{o(t),e.close()}})))}];return s()(Yn.Z,{capture:!0,allowEsc:!0,render:o=>{let i;return i=r.isMobile?{menuType:et.og.Modal,title:s()(P.FormattedMessage,{defaultMessage:"Select a zoom level",id:"database.timelineView.mobileTimelineZoomPicker.title"}),right:s()(lt.DoneMenuText,{}),onClickRight:e.close,...o}:{menuType:et.og.Popup,width:180,...o},c.createElement(nt.Z,i,s()(st.Z,{type:st.i.Vertical,sections:n,initialFocus:bt.H.indexOf(t)}))}})}}renderComponent(){const{zoomLevel:e}=this.props,{device:t}=this.environment;return s()(it.ZP,{popupType:t.isMobile?ct.kQ.SlideUp:ct.kQ.Popup,renderOrigin:t=>c.createElement(at.Z,i()({isSmall:!0,isGray:!0},t),this.renderZoomLevelText(e),y.Z.chevronDown({width:10,marginLeft:4,fill:this.theme.mediumIconColor})),originGap:8,render:this.renderZoomLevelMenu})}renderZoomLevelText(e){return"hours"===e?s()(P.FormattedMessage,{id:"database.timelineView.zoomLevel.hours",defaultMessage:"Hours"}):"day"===e?s()(P.FormattedMessage,{id:"database.timelineView.zoomLevel.day",defaultMessage:"Day"}):"week"===e?s()(P.FormattedMessage,{id:"database.timelineView.zoomLevel.week",defaultMessage:"Week"}):"bi_week"===e?s()(P.FormattedMessage,{id:"database.timelineView.zoomLevel.biWeek",defaultMessage:"Bi-week"}):"month"===e?s()(P.FormattedMessage,{id:"database.timelineView.zoomLevel.month",defaultMessage:"Month"}):"quarter"===e?s()(P.FormattedMessage,{id:"database.timelineView.zoomLevel.quarter",defaultMessage:"Quarter"}):"year"===e?s()(P.FormattedMessage,{id:"database.timelineView.zoomLevel.year",defaultMessage:"Year"}):void(0,cr.t1)(e)}}jn.displayName="CollectionTimelineViewZoomLevelButtonPopup";const Xn=jn;var Jn=o(33411);class es extends h.Z{constructor(){super(...arguments),this.handleLeftArrowClick=()=>{const{timelineState:e,paddingLeft:t,format:o,isFullScreen:r,isRootChild:i,collectionContextStore:n}=this.props,s=e.zoomLevel.state,l=(e.outerSizeObserver.rect.state.width-(0,J.xI)({environment:this.environment,paddingLeft:t,format:o,isFullScreen:r,isRootChild:i}))/2,a=(0,J.al)(e)-(0,J.x2)(s,l);Mn.Nf({timelineState:e,environment:this.environment,zoomLevel:s,centerTimestamp:a}),T.Al4(this.environment,{...(0,J.Ii)({environment:this.environment,collectionContextStore:n,timelineState:e,isFullScreen:r,isRootChild:i}),type:"left"})},this.handleRightArrowClick=()=>{const{timelineState:e,paddingLeft:t,format:o,isFullScreen:r,isRootChild:i,collectionContextStore:n}=this.props,s=e.zoomLevel.state,l=(e.outerSizeObserver.rect.state.width-(0,J.xI)({environment:this.environment,paddingLeft:t,format:o,isFullScreen:r,isRootChild:i}))/2,a=(0,J.al)(e)+(0,J.x2)(s,l);Mn.Nf({timelineState:e,environment:this.environment,zoomLevel:s,centerTimestamp:a}),T.Al4(this.environment,{...(0,J.Ii)({environment:this.environment,collectionContextStore:n,timelineState:e,isFullScreen:r,isRootChild:i}),type:"right"})},this.handleTodayClick=()=>{const{timelineState:e,paddingLeft:t,format:o,collectionContextStore:r,isFullScreen:i,isRootChild:n}=this.props,s=e.zoomLevel.state,l=(0,J.bK)({timestamp:Date.now(),environment:this.environment,timelineState:e,paddingLeft:t,format:o});Mn.Nf({timelineState:e,environment:this.environment,zoomLevel:s,centerTimestamp:l}),T.H6t(this.environment,(0,J.Ii)({environment:this.environment,collectionContextStore:r,timelineState:e,isFullScreen:i,isRootChild:n}))},this.handleZoomLevelChange=e=>{const{timelineState:t,collectionContextStore:o,isFullScreen:r,isRootChild:i}=this.props;Mn.Nf({timelineState:t,environment:this.environment,zoomLevel:e,centerTimestamp:(0,J.al)(t)}),T.zIF(this.environment,(0,J.Ii)({environment:this.environment,collectionContextStore:o,timelineState:t,isFullScreen:r,isRootChild:i}))},this.handleShowTableClick=()=>{const{format:e,timelineState:t,collectionContextStore:o,isFullScreen:r,isRootChild:i}=this.props,n=o.collectionViewStore();n&&(N.createAndCommit({userAction:"CollectionTimelineViewControlBar.handleShowTableClick",environment:this.environment,perform:t=>{const o=(0,J.YP)(e,!0);Le.FH({stores:[n],update:o,transaction:t})}}),T.CBn(this.environment,{...(0,J.Ii)({environment:this.environment,collectionContextStore:o,timelineState:t,isFullScreen:r,isRootChild:i}),show:!0}))},this.currentScrolledSecondaryDisplayUnitStore=this.createComputedStore((()=>{const{timelineState:e,scrollerLeftOffset:t,paddingLeft:o,showTable:r,isFullScreen:i}=this.props,n=e.zoomLevel.state,{primaryDisplayUnit:s,secondaryDisplayUnit:l}=J.BJ[n],a=e.scrollLeft.state,{startTimestamp:c}=e.currentRange.state;if(void 0!==a){const e=c+(0,J.x2)(n,a+t+(!r&&i?o:0));return(0,J.DS)(fi.ou.fromMillis(e),s).startOf(l).valueOf()}}))}renderComponent(){var e;const{timelineState:t,showTable:o,isFullScreen:r,isRootChild:n,isReady:l,collectionContextStore:a,isInPeekRenderer:d}=this.props,{device:h}=this.environment,p=t.zoomLevel.state,{secondaryDisplayUnit:u}=J.BJ[p],m=this.currentScrolledSecondaryDisplayUnitStore.state,g=(0,J.d$)({environment:this.environment,isFullScreen:r,isRootChild:n}),S=a.permissionScopes.state,v=!o&&g&&S.canConfigureBlock,f=(null===(e=a.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(d?this.theme.cardContentBackground:this.theme.contentBackground),C=d?this.theme.cardContentBackgroundTransparent:this.theme.contentBackgroundTransparent;return s()(kr,{position:Ue.Top},void 0,s()("div",{style:this.getStyle()},void 0,m&&s()("div",{style:this.getCurrentScrolledSecondaryDisplayUnitStyle()},void 0,v&&s()(ht.Z,{render:e=>c.createElement(at.Z,i()({isSmall:!0,onClick:this.handleShowTableClick,style:{paddingLeft:4,paddingRight:4,marginLeft:2,marginRight:4,marginTop:h.isIOS?0:1,height:22,fill:this.theme.lightIconColor}},e),y.Z.doubleChevronRight({width:14})),renderTooltip:()=>s()(P.FormattedMessage,{id:"database.timelineView.controlHeader.showTableButton.title",defaultMessage:"Show table"})}),s()("span",{style:{paddingLeft:v||this.environment.device.isPhone?0:r||o?16:2}},void 0,(0,J.qG)(m,u)),!l&&!o&&this.renderLoadingSpinner(),s()("div",{style:{width:30,marginRight:-30,height:"100%",backgroundImage:`linear-gradient(to right, ${f} 20%, ${C} 100%)`}})),s()("div",{style:this.getControlBarRightStyle()},void 0,s()("div",{style:{width:30,marginLeft:-30,height:"100%",backgroundImage:`linear-gradient(to left, ${f} 20%, ${C} 100%)`}}),s()(Xn,{zoomLevel:p,onChange:this.handleZoomLevelChange}),s()(at.Z,{isSmall:!0,isGray:!0,onClick:this.handleLeftArrowClick,style:{marginLeft:4,paddingLeft:4,paddingRight:4}},void 0,y.Z.chevronLeft({width:12,fill:this.theme.mediumIconColor})),s()(at.Z,{isSmall:!0,onClick:this.handleTodayClick},void 0,s()(P.FormattedMessage,{id:"database.timelineView.controlHeader.todayButton.title",defaultMessage:"Today"})),s()(at.Z,{isSmall:!0,isGray:!0,onClick:this.handleRightArrowClick,style:{paddingLeft:4,paddingRight:4}},void 0,y.Z.chevronRight({width:12,fill:this.theme.mediumIconColor})))))}renderLoadingSpinner(){return s()(Jn.Z,{show:!0,showDelay:400,showHold:0,render:e=>e?s()(so.Z,{style:{marginLeft:8,marginTop:1}}):void 0})}getStyle(){const{timelineState:e}=this.props,{outerSizeObserver:t}=e;return{position:"sticky",left:0,width:t.rect.state.width,zIndex:k.Qm,height:0}}getCurrentScrolledSecondaryDisplayUnitStyle(){var e;const{scrollerLeftOffset:t,paddingLeft:o,isFullScreen:r,showTable:i,collectionContextStore:n,isInPeekRenderer:s}=this.props,l=(null===(e=n.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(s?this.theme.cardContentBackground:this.theme.contentBackground);return{position:"absolute",top:1,left:0,paddingLeft:r&&!i?t+o:t,display:"flex",alignItems:"center",height:32,paddingTop:6+(this.environment.device.isMobile?2:0),background:l,fontSize:14,fontWeight:x.Z.fontWeight.medium}}getControlBarRightStyle(){var e;const{paddingRight:t,collectionContextStore:o,isInPeekRenderer:r}=this.props;return{position:"absolute",top:1,right:0,paddingRight:t,display:"flex",alignItems:"center",height:32,paddingTop:7,background:(null===(e=o.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(r?this.theme.cardContentBackground:this.theme.contentBackground)}}}es.displayName="CollectionTimelineViewControlBar";const ts=es;class os extends h.Z{constructor(){super(...arguments),this.handleHideTableClick=()=>{const{format:e,collectionContextStore:t,isFullScreen:o,isRootChild:r,timelineState:i}=this.props,n=t.collectionViewStore();n&&(N.createAndCommit({userAction:"CollectionTimelineViewHideTableButton.handleHideTableClick",environment:this.environment,perform:t=>{const o=(0,J.YP)(e,!1);Le.FH({stores:[n],update:o,transaction:t})}}),T.CBn(this.environment,{...(0,J.Ii)({environment:this.environment,collectionContextStore:t,timelineState:i,isFullScreen:o,isRootChild:r}),show:!1}))}}renderComponent(){const{device:e}=this.environment,{isGrouped:t}=this.props;return s()(ht.Z,{render:o=>c.createElement(at.Z,i()({isSmall:!0,onClick:this.handleHideTableClick,style:{position:"absolute",top:t?e.isIOS?3:4:e.isIOS?7:8,right:t?6:8,zIndex:k.MC,fill:this.theme.lightIconColor}},o),y.Z.doubleChevronLeft({width:14})),renderTooltip:()=>s()(P.FormattedMessage,{id:"database.timelineView.tableGroupResults.hideTableButton.title",defaultMessage:"Hide table"})})}}os.displayName="CollectionTimelineViewHideTableButton";const rs=(0,P.injectIntl)(os);var is=o(24211);function ns(e){window.__c={n:"TimelineShimmerWrapper"};const{shouldShowShimmer:t,children:o}=e,r=(0,Or.Z)(t,0,100);return s()("div",r?{className:"notion-shimmer",style:{height:"100%"}}:{},void 0,o)}const ss=22,ls=32;class as extends h.Z{constructor(){super(...arguments),this.interval=void 0,this.handleSeconds=()=>{0===(new Date).getSeconds()&&this.enqueueForceUpdate()},this.activeRangeStore=this.createComputedStore((()=>{const{collectionContextStore:e,timelineState:t,query:o,schema:r,intl:i}=this.props,n=e.collectionStore();if(!n)return;const s=t.dragState.state,l=t.zoomLevel.state,c=t.hoveredItem.state,d=t.dateRangePlaceholder.state,{activeRangeType:h}=J.BJ[l];if(!h)return;let p;if(s)p=s.temporaryValues.map((e=>(0,J.XO)(e,"day")));else if(d.active)p=[(0,J.XO)(d.date,"day")];else{const{stores:t}=Vt.default.state,s=t.filter((e=>e.getParentCollectionId()===n.id)),l=a().uniq(a().compact([...s,c]));p=a().compact(l.map((t=>{const n=(0,J.bk)({store:t,query:o,schema:r,userId:e.getCurrentUserId(),intl:i});if(n)return(0,J.XO)(n,"day")})))}const u=a().minBy(p,(e=>{let{start:t}=e;return t.valueOf()})),m=a().maxBy(p,(e=>{let{end:t}=e;return t.valueOf()}));return u&&m?{start:u.start.valueOf(),end:m.end.valueOf()}:void 0}),!0)}willMount(e){super.willMount(e)}didMount(){super.didMount(),this.interval=setInterval(this.handleSeconds,1e3)}willUnmount(){super.willUnmount(),clearInterval(this.interval)}renderComponent(){const{collectionContextStore:e,timelineState:t}=this.props,o=t.zoomLevel.state,r=J.BJ[o],{primaryDisplayUnit:i,activeRangeType:n}=r,l=(0,J.ST)(i),a=fi.ou.now(),c=l?a.startOf("minute"):a.startOf("day"),d=a.startOf("minute"),{device:h}=this.environment,p=!e.groupsStore.anyGroupHasNonEmptyResults()&&Ge({collectionContextStore:e,groupsPointer:[]});return s()(kr,{position:Ue.Top},void 0,s()("div",{style:this.getStyle()},void 0,s()("div",{style:{height:32,position:"relative",overflow:"hidden"}},void 0,!h.isPhone&&this.renderSecondaryIndicators()),s()("div",{style:{height:ls,position:"relative",overflow:"hidden"}},void 0,s()(ns,{shouldShowShimmer:p,children:this.renderPrimaryIndicators(c)}),"highlight_days"===n&&this.renderActiveRange(),this.renderNowIndicator(c),"display_range"===n&&this.renderActiveRange()),this.renderNowCircle(d)))}renderPrimaryIndicators(e){const{timelineState:t}=this.props,o=t.zoomLevel.state,{startTimestamp:r,endTimestamp:i}=t.currentRange.state,n=J.BJ[o],{primaryDisplayUnit:s,hidePrimaryIndicatorIntersectionOffset:l}=n,a=l||0,c=this.getPrimaryDisplayUnitPosition(e,!1),d=c.left+a,h=c.left+c.width-a,p=[];let u=(0,J.DS)(fi.ou.fromMillis(r),s);for(;u.valueOf()<i;){const e=this.getPrimaryDisplayUnitPosition(u,!1),t=e.left+a,o=e.left+e.width-a;void 0!==l&&(d>=t&&d<=o||h>=t&&h<=o)||p.push(this.renderPrimaryIndicator(u,!1));u=(0,J.Ip)(u,s)}return p}renderSecondaryIndicators(){const{timelineState:e}=this.props,t=e.zoomLevel.state,{startTimestamp:o,endTimestamp:r}=e.currentRange.state,i=J.BJ[t],{primaryDisplayUnit:n,secondaryDisplayUnit:s}=i,l=[];let a=(0,J.DS)(fi.ou.fromMillis(o),s);for(;a.valueOf()<r;){l.push(this.renderSecondaryIndicator(a));const e=(0,J.Ip)(a,s);a=(0,J.xP)(e,n)}return l}renderActiveRange(){const{timelineState:e}=this.props,t=e.zoomLevel.state,{startTimestamp:o,endTimestamp:r}=e.currentRange.state,i=J.BJ[t],{activeRangeType:n}=i,l=this.activeRangeStore.state;if(l){const e=(0,J.DS)(fi.ou.fromMillis(l.start),"day"),i=(0,J.e$)(t,e.valueOf()-o);if("highlight_days"===n){const n=[];let a=fi.ou.fromMillis(Math.max(e.valueOf(),(0,J.DS)(fi.ou.fromMillis(o),"day").valueOf()));for(;a.valueOf()<l.end&&a.valueOf()<r;){n.push(a);a=(0,J.Ip)(a,"day")}const d=(0,J.e$)(t,a.valueOf()-o)-i+8,h=n.map(((e,t)=>this.renderPrimaryIndicator(e,0===t||t===n.length-1)));return c.createElement(c.Fragment,null,s()("div",{style:{position:"absolute",left:i-4,width:d,marginTop:3,height:ss,background:this.theme.timelineDarkerBackground,borderRadius:11}}),h)}{const r=(0,J.DS)(fi.ou.fromMillis(l.end),"day"),n=(0,J.cK)(fi.ou.fromMillis(l.end),"day"),a=(0,J.e$)(t,r.valueOf()-o)-i+8;return s()("div",{style:{display:"flex",alignItems:"center",position:"absolute",left:i-4,minWidth:a,marginTop:3,height:ss,background:this.theme.timelineDarkerBackground,borderRadius:11,paddingLeft:6,paddingRight:6}},void 0,this.renderActiveDisplayRangeIndicator(e,e.valueOf()!==n.valueOf()?n:void 0,a))}}}renderPrimaryIndicator(e,t){const{timelineState:o}=this.props,r=o.zoomLevel.state,{primaryDisplayUnit:i}=J.BJ[r],{left:n,width:l}=this.getPrimaryDisplayUnitPosition(e,!1);return s()("div",{style:{position:"absolute",left:n,width:l,height:28,display:"flex",alignItems:"start",lineHeight:"28px"}},n,s()("div",{style:{fontSize:12,margin:"0 auto"}},void 0,this.formatPrimaryDisplayUnit(e,r,i,t)))}renderNowIndicator(e){const{timelineState:t}=this.props,o=t.zoomLevel.state,{primaryDisplayUnit:r}=J.BJ[o],{left:i,width:n}=this.getPrimaryDisplayUnitPosition(e,!0);return s()("div",{style:{position:"absolute",left:i,width:n,height:28,display:"flex",alignItems:"center",fontWeight:500}},i,s()("div",{style:{fontSize:12,margin:"0 auto",display:"flex"}},void 0,this.formatNowIndicator(e,o,r)))}renderNowCircle(e){const{timelineState:t}=this.props,o=t.zoomLevel.state,{startTimestamp:r}=t.currentRange.state,i=Math.floor((0,J.e$)(o,e.valueOf()-r));return s()("div",{style:{position:"absolute",left:i-3.5,top:Math.floor(60.5),width:7,height:7,background:this.theme.timelineRed,borderRadius:"100%"}})}renderSecondaryIndicator(e){const{timelineState:t}=this.props,o=t.zoomLevel.state,{startTimestamp:r}=t.currentRange.state,{secondaryDisplayUnit:i}=J.BJ[o],n=(0,J.e$)(o,e.valueOf()-r);return s()("div",{style:{position:"absolute",left:n,height:ls,color:this.theme.regularTextColor,fontSize:14,fontWeight:x.Z.fontWeight.medium,verticalAlign:"middle",paddingTop:6+(this.environment.device.isMobile?2:0),display:"flex",alignItems:"center"}},n,(0,J.EW)((0,is.E2)(this.props.intl),e.valueOf(),i))}renderActiveDisplayRangeIndicator(e,t,o){return e&&t?o>=110?c.createElement(c.Fragment,null,s()("div",{style:this.getActiveDisplayRangeIndicatorStyle()},void 0,(0,pi.Yx)(e.valueOf(),"month_day",di.SP)),s()("div",{style:{flexGrow:1}}),s()("div",{style:this.getActiveDisplayRangeIndicatorStyle()},void 0,(0,pi.Yx)(t.valueOf(),"month_day",di.SP))):s()("div",{style:this.getActiveDisplayRangeIndicatorStyle()},void 0,(0,pi.Yx)(e.valueOf(),"month_day",di.SP)," – ",e.month===t.month?(0,pi.Yx)(t.valueOf(),"day",di.SP):(0,pi.Yx)(t.valueOf(),"month_day",di.SP)):s()("div",{style:this.getActiveDisplayRangeIndicatorStyle()},void 0,(0,pi.Yx)(e.valueOf(),"month_day",di.SP))}formatPrimaryDisplayUnit(e,t,o,r){const i=e.setLocale(di.SP),n=(0,J.xJ)(),l=r?this.theme.regularTextColor:this.theme.lightTextColor,a=r?this.theme.regularTextColor:this.theme.mediumTextColor,d=r?this.theme.mediumTextColor:this.theme.lightTextColor,h=i.toFormat("t").startsWith(i.toFormat("a"));if("fifteen_minutes"===o){if(n)return s()("span",{style:{color:l}},void 0,i.toFormat("H:mm"));{const e=s()("span",{style:{color:a,paddingRight:h?void 0:3}},void 0,i.toFormat("h:mm")),t=s()("span",{style:{color:d,paddingRight:h?3:void 0}},void 0,i.toFormat("a"));return h?c.createElement(c.Fragment,null,t,e):c.createElement(c.Fragment,null,e,t)}}if("hour"===o){if(n)return s()("span",{style:{color:l}},void 0,i.toFormat("H:mm"));{const e=s()("span",{style:{color:a,paddingRight:h?void 0:3}},void 0,i.toFormat("h")),t=s()("span",{style:{color:d,paddingRight:h?3:void 0}},void 0,i.toFormat("a"));return h?c.createElement(c.Fragment,null,t,e):c.createElement(c.Fragment,null,e,t)}}if("day"===o||"week"===o)return"week"===t||"bi_week"===t?c.createElement(c.Fragment,null,s()("span",{style:{color:d,paddingRight:3}},void 0,i.toFormat("ccccc")),s()("span",{style:{color:a,padding:"2px 7px"}},void 0,i.toFormat("d"))):s()("span",{style:{color:l}},void 0,i.toFormat("d"));(0,cr.t1)(o)}formatNowIndicator(e,t,o){const r=e.setLocale(di.SP),i=(0,J.ST)(o),n=(0,J.xJ)();return i?n?s()("span",{style:{color:this.theme.timelineRed}},void 0,r.toFormat("H:mm")):s()("span",{style:{color:this.theme.timelineRed,paddingRight:3}},void 0,r.toFormat("t")):"week"===t||"bi_week"===t?c.createElement(c.Fragment,null,s()("span",{style:{color:this.theme.lightTextColor,paddingRight:3}},void 0,r.toFormat("ccccc")),s()("div",{style:{position:"relative"}},void 0,s()("div",{style:this.getNowIndicatorCircleStyle()}),s()("span",{style:{position:"relative",color:"white",padding:"2px 7px"}},void 0,r.toFormat("d")))):s()("div",{style:{position:"relative"}},void 0,s()("div",{style:this.getNowIndicatorCircleStyle()}),s()("span",{style:{position:"relative",color:"white",padding:"2px 7px"}},void 0,r.toFormat("d")))}getPrimaryDisplayUnitPosition(e,t){const{timelineState:o}=this.props,r=o.zoomLevel.state,{startTimestamp:i}=o.currentRange.state,{primaryDisplayUnit:n,primaryDisplayUnitAlignment:s}=J.BJ[r],l=(0,J.DS)(e,n),a=(0,J.Ip)(e,n),c=(0,J.e$)(r,l.valueOf()-i),d=(0,J.e$)(r,e.valueOf()-i),h=(0,J.e$)(r,a.valueOf()-i)-c,p=t?4:0;return{left:("range_start"===s?d-h/2:d)-p,width:h+2*p}}getStyle(){var e;const{collectionContextStore:t,isInPeekRenderer:o}=this.props;return{position:"absolute",left:0,top:0,width:"100%",background:(null===(e=t.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(o?this.theme.cardContentBackground:this.theme.contentBackground),borderTop:t.viewIsFlushToTopbar()?`1px solid ${this.theme.tableDividerColor}`:"1px solid transparent",borderBottom:`1px solid ${this.theme.tableDividerColor}`}}getActiveDisplayRangeIndicatorStyle(){return{color:this.theme.regularTextColor,fontSize:12}}getNowIndicatorCircleStyle(){return{background:this.theme.timelineRed,width:22,height:22,borderRadius:11,position:"absolute",left:"calc(50% - 11px)",top:"calc(50% - 11px)"}}}as.displayName="CollectionTimelineViewTimeBar";const cs=(0,P.injectIntl)(as);var ds=o(1742),hs=o(29376),ps=o(97180),us=o(3072);function ms(e){window.__c={n:"TableAggregation"};const{disabled:t,property:o,schema:r,collectionContextStore:n,groupFormat:l,isHovered:a,onChange:d}=e,h=(0,yo.qz)(void 0,me.Z),p=(0,vo.O7)(),{isMobile:u}=(0,vo.Fy)(),[m,g]=(0,c.useState)(!0),S=(0,yo.VK)((()=>{const e=n.normalizedQueryStore.state,t=((null==e?void 0:e.aggregations)||[]).find((e=>e.property===o));if(!t)return;return{type:"aggregation",filter:l?(0,Ye.zk)({schema:r,group:l,timeZone:(0,je.r)()}):void 0,aggregation:t}}),[r,l,n,o]),v=(0,c.useCallback)((e=>{e?(g(!0),d(o,{aggregator:e,property:o}),T.wds(p,{view_type:"table",action:"table_change_aggregation"})):(d(o,void 0),T.wds(p,{view_type:"table",action:"table_remove_aggregation"}))}),[p,d,o]),y=(0,c.useCallback)((()=>{h.update((e=>({...e,open:!1})))}),[h]),f=(0,fo.yK)((e=>({buttonStyle:{display:"flex",alignItems:"center",justifyContent:"flex-end",width:"100%",height:32,paddingRight:8,overflow:"hidden",whiteSpace:"nowrap",userSelect:"auto",WebkitUserSelect:"auto"}})),[]);return s()(it.ZP,{popupType:u?it.Z4.SlideUp:it.Z4.Popup,buttonPopupStore:h,disabled:t,renderOrigin:e=>c.createElement(qt.Z,i()({disabled:t,style:f.buttonStyle},e),S?s()(ot.Z,{id:`table:${(0,Ae.mD)(l)}:${o}:${S.aggregation.aggregator}`,collectionContextStore:n,reducer:S,groupsPointer:l?[l]:void 0,render:e=>s()(gs,{reducer:S,reducerResult:e,schema:r,property:o,isHovered:a,disabled:t,buttonPopupStore:h,isLoading:m,setIsLoading:g})}):s()(gs,{reducer:S,schema:r,property:o,isHovered:a,disabled:t,buttonPopupStore:h,isLoading:m,setIsLoading:g})),render:()=>s()(us.Z,{property:o,schema:r,onChange:v,onClose:y,source:"tableAggregation"})})}function gs(e){window.__c={n:"TableAggregationButtonContent"};const{reducer:t,reducerResult:o,schema:r,property:i,isHovered:n,disabled:l,buttonPopupStore:a,isLoading:d,setIsLoading:h}=e,{isMobile:p}=(0,vo.Fy)(),u=(0,W.Y$)(),m=(0,yo.VK)((()=>a.getState().open),[a]),g=(0,fo.yK)((e=>({valueStyle:{display:"flex",alignItems:"center",height:"100%",fontSize:14},aggregationTypeNameStyle:{fontSize:10,textTransform:"uppercase",letterSpacing:1,color:e.mediumTextColor,marginTop:2,marginRight:4,userSelect:"none",WebkitUserSelect:"none"},placeholderWrapper:{display:"flex",alignItems:"center"},placeholderText:{marginBottom:2,color:e.lightTextColor},chevronIcon:{width:10,marginLeft:4,fill:e.lightIconColor}})),[]),{aggregationResult:S,reducerResultType:v}=(0,yo.VK)((()=>{var e,t;return{aggregationResult:null==o||null===(e=o.getState())||void 0===e?void 0:e.aggregationResult,reducerResultType:null==o||null===(t=o.getState())||void 0===t?void 0:t.type}}),[o]);(0,c.useEffect)((()=>{void 0!==S&&h(!1)}),[S,h]);const f=(0,c.useMemo)((()=>{if(!t||!o||"aggregation"!==v||!S)return;let e=Je.v6[(0,Qe.OV)(t.aggregation)];return(0,Qe.en)(t.aggregation.aggregator)&&(e=t.aggregation.aggregator.groupName in ps.ZA?ps.ZA[t.aggregation.aggregator.groupName]:t.aggregation.aggregator.groupName),e}),[S,t,o,v]),C=r[i],b=(0,yo.VK)((()=>{if(C&&("formula"===C.type||"number"===C.type))return C.number_format;if("rollup"===(null==C?void 0:C.type)&&C.relation_property&&C.target_property&&"number"===C.target_property_type){if(r[C.relation_property]){var e;const t=(0,hs.ny)(u,r[C.relation_property]),o=null==t||null===(e=t.getModel())||void 0===e?void 0:e.getNormalizedSchema(),i=null==o?void 0:o[C.target_property];if("number"===(null==i?void 0:i.type))return i.number_format}}}),[C,r,u]),w=(0,c.useMemo)((()=>void 0!==t&&void 0!==S?(0,Je.Ol)({numberFormat:b,dateFormat:void 0,aggregationType:t.aggregation.aggregator,value:S,userTimeZone:(0,je.r)(),roundDecimal:5}):void 0),[S,b,t]);return f?c.createElement(c.Fragment,null,s()("span",{style:g.aggregationTypeNameStyle},"type",f),d?s()(so.Z,{}):s()("span",{style:g.valueStyle},"value",w)):!l&&(p||n||m)?s()(Sn.Z,{isVisible:!0,animationStyle:{opacity:1},enterAnimationStyle:{opacity:0},exitAnimationStyle:{opacity:0},render:()=>s()("div",{style:g.placeholderWrapper},void 0,s()("span",{style:g.placeholderText},"placeholder",s()(P.FormattedMessage,{defaultMessage:"Calculate",id:"database.tableView.aggregationPlaceholder"})),y.Z.chevronDown(g.chevronIcon))}):null}class Ss extends h.Z{constructor(){super(...arguments),this.storeTypes={mouseStore:Pe.Z},this.renderAggregation=(e,t)=>{const{schema:o,disabled:r,collectionContextStore:i,showHoverActionsStore:n,groupFormat:l}=this.props,{mouseEntered:a}=this.stores.mouseStore.state,c=(0,ee.fk)({environment:this.environment,collectionContextStore:i});return s()("div",{style:{display:"flex",width:void 0!==e.width?e.width+(0===t&&c?ko.Xx+1:0):void 0}},e.property,s()(ms,{groupFormat:l,disabled:r,isHovered:(a||0===t&&!l&&n.state)&&!r,property:e.property,collectionContextStore:i,schema:o,onChange:this.handleTableAggregationChange}))},this.handleTableAggregationChange=(e,t)=>{const{collectionContextStore:o,query:r}=this.props,i=o.collectionViewStore();if(!i)return;let n=r.aggregations?[...r.aggregations]:[];const s=(r.aggregations||[]).findIndex((t=>t.property===e));n=s<0?a().compact([...n,t]):a().compact(n.map(((e,o)=>s===o?t:e)));const l={...r,aggregations:n};N.createAndCommit({userAction:"TableAggregationRow.handleTableAggregationChange",environment:this.environment,perform:e=>{E.iG({collectionViewStore:i,update:{query2:l},transaction:e})}})},this.captureEditorMouseDown=e=>{(0,re.ZP)({event:e,context:re.Af.EditorMouseDown,callback:()=>{}})},this.handleAggregationRowEnter=()=>{this.stores.mouseStore.enter()},this.handleAggregationRowLeave=()=>{this.stores.mouseStore.exit()}}renderComponent(){const{showPropertyFormatsStore:e,collectionContextStore:t}=this.props,o=e.state,r=this.props.collectionContextStore.collectionViewStore(),i=null==r?void 0:r.getTableFrozenColumnIndex(),n=(0,ee.bW)(i),[l,a]=(0,ee.Ql)(i)?[o.slice(0,n),o.slice(n)]:[[],o];return s()(kr,{position:Ue.Bottom},void 0,s()(gn.p,{allowSelectionWithin:!1,style:this.getAggregationsRowStyle(),onMouseMove:this.handleAggregationRowEnter,onMouseLeave:this.handleAggregationRowLeave,onMouseDown:this.captureEditorMouseDown},void 0,s()("div",{style:{display:"flex",paddingRight:!this.props.disabled&&this.props.showRightActionsSpacer?32:0}},void 0,s()("div",{style:{display:"flex"}},void 0,(0,ee.Ql)(i)&&s()("div",{style:{...(0,ko.oc)({collectionContextStore:t,isMobile:this.environment.device.isMobile,theme:this.theme}),display:"flex"}},void 0,l.map(this.renderAggregation)),a.map(((e,t)=>this.renderAggregation(e,t+n)))))))}getAggregationsRowStyle(){var e;const{collectionContextStore:t,isInPeekRenderer:o}=this.props;return{display:"flex",position:"absolute",background:(null===(e=t.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(o?this.theme.cardContentBackground:this.theme.contentBackground),zIndex:k.RJ,fontSize:14,height:Zl+(this.props.isFullScreen?ge.Z.state:0)+1,minWidth:"100%",clipPath:"polygon(0% -20%, 100% -20%, 100% 100%, 0% 100%)",left:0,borderTop:`1px solid ${this.theme.tableDividerColor}`,...this.props.style}}}Ss.displayName="TableAggregationRow";const vs=Ss;function ys(e){window.__c={n:"TableEmptyPlaceholder"};const{collectionContextStore:t,shouldShowAddRowButton:o,paddingLeft:r,handleAddRowClick:i}=e,n=(0,yo.VK)((()=>Boolean(t.currentCombinatorFilterStore.state||t.currentPropertyFiltersStore.state.length>0)),[t]),l=(0,yo.VK)((()=>t.shouldShowSpinner.state),[t]),a=(0,Or.Z)(l,ee.Mq.showDelay,ee.Mq.showHold,!0),c=(0,fo.yK)((e=>({button:{display:"flex",alignItems:"center",height:_l+1,width:"100%",paddingLeft:Ll,fontSize:14,lineHeight:x.Z.lineHeight.UIRegular.desktop,background:e.contentBackground,left:0,right:0,textAlign:"center",borderBottom:"1px solid transparent"},buttonInner:{color:e.lightTextColor,position:"sticky",left:r+Ll}})),[r]);return s()(qt.Z,{onClick:i,onMouseDown:re.$0,disabled:!o,style:c.button},void 0,s()("span",{style:c.buttonInner},void 0,s()(P.FormattedMessage,a?{defaultMessage:"Loading results…",id:"database.tableView.loadingResults"}:o?n?{defaultMessage:"No filter results. Click to add a row.",id:"database.tableView.emptyTablePlaceholderWithFilters"}:{defaultMessage:"Empty. Click to add a row.",id:"database.tableView.emptyTablePlaceholder"}:n?{defaultMessage:"No filter results.",id:"database.tableView.cannotEdit.emptyTablePlaceholderWithFilters"}:{defaultMessage:"Empty.",id:"database.tableView.cannotEdit.emptyTablePlaceholder"})))}var fs=o(46328),Cs=o(87085),bs=o(73060);class ws extends m.default{getInitialState(){return{}}}const xs=ws;var ks=o(12137),Ps=o(15095),Ts=o(25898),Rs=o(62619),Is=o(45452);const Ms={position:"absolute",display:"flex",opacity:.5,zIndex:81},Bs=function(e){window.__c={n:"DraggableSectionedGhostList"};const t=(0,c.useRef)(null),o=(0,c.useRef)(),r=(0,yo.qz)(e.store,Is.Z),n=(0,yo.VK)((()=>r.state),[r]),{direction:l,sectionedKeys:h,sectionStyles:p,keys:u,disableVerticalEdgeScroll:m,disableHorizontalEdgeScroll:g,disabled:S}=e,v={..."horizontal"===l?li.l8:li.yA,...n.isDragging&&{position:"relative",zIndex:1,width:n.savedContainerRect.width,height:n.savedContainerRect.height},...e.style};function y(e){return"string"==typeof e?e:e.key}const f=(0,yo.VK)((()=>u.map(((t,o)=>{const{renderKey:r,direction:i}=e,l=y(t),a=r(l,o,e.keys.map(y).map(y));if(n.isDragging&&n.draggingKey===l){const{savedKeyRects:e,savedContainerRect:t,currentXOffset:r,currentYOffset:c}=n,d=e[o];let h,p;"vertical"===i?(h=(0,ks.Z)(d.top+c,t.top,t.top+t.height-d.height)-t.top,p=d.left-t.left):(h=d.top-t.top,p=(0,ks.Z)(d.left+r,t.left,t.left+t.width-d.width)-t.left);const u={...Ms,left:p,top:h,width:d.width,height:d.height,zIndex:1};return s()("div",{style:u},l,a)}}))),[u,e,n]);function C(){const{direction:r}=e;return o.current||(o.current="vertical"===r?(0,le.VW)(d.findDOMNode(t.current)):(0,le.xH)(d.findDOMNode(t.current))),o.current}const b=S?{}:{onDraggableDragCancel:()=>{n.isDragging&&r.reset()},onDraggableDragEnd:()=>{if(n.isDragging){const{keys:t,onDrop:o}=e,{startKeyPosition:i,currentKeyPosition:s}=n;if(i!==s){const e=a().clone(t);e.splice(s,0,e.splice(i,1)[0]);const r=y(t[i]);o(e.map(y),{key:r,startPosition:i,endPosition:s})}e.onDragEnd&&e.onDragEnd(),r.reset()}},onDraggableDragStart:o=>{o.preventDefault();const{keys:i}=e,n=d.findDOMNode(t.current);if(!n)return;if(!(n instanceof Element))return;const s=Rs.sh(o.target,(e=>Rs.kK(e)&&e.classList.contains(q.HwD))),l=Rs.sh(o.target,(e=>e.parentNode===s));if(s&&l){const t=Ps.p4(n.children).indexOf(s),o=Ps.p4(s.children).indexOf(l);let c=0;const d=Object.keys(h);for(let e=0;e<t;e++)c+=h[d[e]].length;c+=o;const p=i[c];if("object"==typeof p&&!p.draggable)return;const u=n.getBoundingClientRect(),m=a().flatten(a().map(Object.keys(h),((e,t)=>a().map(h[e],((e,o)=>n.children[t].children[o].getBoundingClientRect()))))),g=C();if(g){const t=y(i[c]);e.onDraggingKeyChanged&&e.onDraggingKeyChanged(t),r.setState({isDragging:!1,willDrag:!0,currentXOffset:0,currentYOffset:0,draggingKey:t,startKeyPosition:c,startScrollX:g.scrollLeft,startScrollY:g.scrollTop,currentKeyPosition:c,savedContainerRect:u,savedKeyRects:m})}}},onDraggableDragMove:t=>{!n.isDragging&&n.willDrag&&n.draggingKey&&(0,Ts.Z)(t.startX,t.startY,t.currentX,t.currentY)>=se.Vc[t.device]&&(r.setState({currentXOffset:n.currentXOffset,currentYOffset:n.currentYOffset,startScrollX:n.startScrollX,startScrollY:n.startScrollY,startKeyPosition:n.startKeyPosition,currentKeyPosition:n.currentKeyPosition,savedKeyRects:n.savedKeyRects,savedContainerRect:n.savedContainerRect,draggingKey:n.draggingKey,isDragging:!0,willDrag:!1}),e.onDragStart&&e.onDragStart());const o=C();if(n.isDragging&&o){const{savedKeyRects:e,startScrollX:i,startScrollY:s}=n,l=o.scrollLeft-i,c=o.scrollTop-s,d=a().minBy(e,(e=>(0,Ts.Z)(t.currentX+l,t.currentY+c,e.left+e.width/2,e.top+e.height/2)));if(d){const o=e.indexOf(d);r.setState({...n,currentXOffset:t.diffX+l,currentYOffset:t.diffY+c,currentKeyPosition:o})}}}};return c.createElement(c.Fragment,null,c.createElement(bi.Z,i()({ref:t},b,{forceTouch:!0,allowDragWhileTextEditing:!0,disableVerticalEdgeScroll:m||"horizontal"===l,disableHorizontalEdgeScroll:g||"vertical"===l,render:t=>{let o=0;return c.createElement("div",i()({style:v},t),Object.entries(h).map((t=>{let[r,i]=t;const l=((e,t)=>s()("div",{className:q.HwD,style:null==p?void 0:p[e]},e,t))(r,i.map(((t,r)=>((t,o)=>{const{renderKey:r}=e,i=y(t),l=r(i,o,e.keys.map(y).map(y));let a="";if(n.isDragging){const{startKeyPosition:t,currentKeyPosition:r}=n;t===r?a="":"horizontal"===e.direction?r===o&&o<t?a=`inset 4px 0 ${Ho.ZP.blueWithAlpha(.5)}`:r===o&&o>t&&(a=`inset -4px 0 ${Ho.ZP.blueWithAlpha(.5)}`):"vertical"===e.direction&&(r===o&&o<t?a=`inset 0 4px ${Ho.ZP.blueWithAlpha(.5)}`:r===o&&o>t&&(a=`inset 0 -4px ${Ho.ZP.blueWithAlpha(.5)}`))}return s()("div",{style:{display:"flex",flexDirection:"vertical"===e.direction?"column":"horizontal"===e.direction?"row":(0,cr.t1)(e.direction),boxShadow:a}},i,l)})(t,r+o))));return o+=i.length,l})))}})),f)};function Vs(e){window.__c={n:"FrozenColumnDivider"};const{isScrolled:t,isCollectionViewBlockSelected:o,isCheckbox:r}=e,i=(0,vo.Fy)().isMobile,n=(0,fo.yK)((e=>{let t;return t=!o&&r?e.tableDividerColor:"dark"===e.mode?e.accentColors.gray[500]:e.accentColors.gray[200],{border:{position:"absolute",top:0,right:0,width:1,height:"calc(100% + 1px)",background:t},shadow:{position:"absolute",top:0,right:-4,width:4,height:"calc(100% + 1px)",background:"dark"===e.mode?"transparent":`linear-gradient(to right, ${Ho.se[e.mode].gray.alpha(.15).css()},\n                                ${Ho.se[e.mode].gray.alpha(.1).css()},  transparent)`}}}),[r,o]);return i?null:c.createElement(c.Fragment,null,r&&!t?null:s()("div",{style:n.border}),r?null:t&&s()(Sn.Z,{isVisible:!0,animationStyle:{opacity:t?1:0},render:()=>s()("div",{style:n.shadow})}))}function Fs(e){window.__c={n:"MultiSelectCheckbox"};const{checkedState:t,onClick:o,checkboxType:r,collectionContextStore:i,isScrolled:n}=e,l=(0,vo.O7)(),a=(0,yo.qz)(void 0,Pe.Z),d=(0,yo.VK)((()=>a.state.mouseEntered),[a]),h=(0,c.useRef)(null);(0,c.useEffect)((()=>{h.current&&(h.current.indeterminate="indeterminate"===t)}),[t]);const p=(0,yo.VK)((()=>On.ZP.state.isDragging),[]),u=(0,c.useCallback)((e=>{o(e),B.Ac({environment:l,collectionContextStore:i,checkbox_type:r})}),[r,i,l,o]),m=(0,yo.VK)((()=>{var e;const t=null===(e=i.collectionViewStore())||void 0===e?void 0:e.getTableFrozenColumnIndex();return(0,ee.eL)(l.device.isMobile,"table")&&!(0,ee.Ql)(t)}),[i,l]),g=(0,yo.VK)((()=>n&&m?{left:7,right:12}:{left:0,right:0}),[n,m]),S=(0,yo.VK)((()=>!1===t&&!d||p?n&&m?.4:0:1),[t,p,d,n,m]);return s()(Sn.Z,{isVisible:!0,animationStyle:{paddingLeft:g.left,paddingRight:g.right},render:()=>s()("div",{onMouseEnter:()=>a.enter(),onMouseLeave:()=>a.exit()},void 0,s()(Sn.Z,{isVisible:!0,animationStyle:{opacity:S},render:()=>s()("label",{style:{height:"100%",marginRight:`${ko._n}px`,alignItems:"flex-start",justifyContent:"center",display:"flex",cursor:"pointer",zIndex:1},onClick:re.Wi,onMouseDown:re.$0},void 0,s()("div",{style:{width:`${ko.bu}px`,height:`${ko.bu}px`,display:"flex",justifyContent:"center",alignItems:"center"}},void 0,c.createElement("input",{type:"checkbox",style:{width:ko.tA,height:ko.tA,cursor:"pointer",position:"relative",right:"2px"},ref:h,checked:!0===t,onChange:u})))}),m&&s()(Vs,{isScrolled:n,isCheckbox:!0}))})}var Ds=o(39068),Es=o(79362),As=o(74446),_s=o(90985),Zs=o(16956),Ls=o(4636),Os=o(80402),Gs=o(99417),Hs=o(75081),zs=o(73959),Ns=o(67695),Ws=o(30905),Ks=o(26122),Us=o(41837),$s=o(28992),qs=o(74420),Qs=o(86825),Ys=o(42402);class js extends h.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:me.Z,resultStore:m.default.createClass(void 0)},this.renderPopup=e=>c.createElement(Xs,i()({},this.props,{parent:e})),this.isCollectionViewBlockSelected=this.createComputedStore((()=>(0,zs.sY)(this.props.collectionViewBlockStore))),this.handleClick=()=>{z.ZH(this.environment),H.ZH(this.environment),E.wG()},this.handleContextMenu=e=>{this.environment.device.isMobile||(e.preventDefault(),(0,re.ZP)({event:e,context:re.Af.EditorContextMenu,callback:()=>{this.handleClick(),this.stores.buttonPopupStore.setState({open:!0})}}))}}get registries(){return[Ns.Z]}renderComponent(){var e;const{property:t,schema:o,disabled:r,collectionContextStore:n,isScrolled:l,renderSpacer:a,paddingTop:d,isLast:h,columnIndex:p}=this.props,u=o[t],{device:m}=this.environment;if(!u)return;const g=null===(e=n.collectionViewStore())||void 0===e?void 0:e.getTableFrozenColumnIndex(),S=(0,ee.Ql)(g)&&g===p,v=n.permissionScopes.state;return c.createElement(c.Fragment,null,s()("div",{style:this.getStyle(),className:q.VMO,onContextMenu:this.handleContextMenu},void 0,s()(it.ZP,{popupType:m.isMobile?ct.kQ.SlideUp:ct.kQ.Popup,disabled:!v.canConfigureBlock,originGap:1,alignmentToOrigin:it.vR.Start,buttonPopupStore:this.stores.buttonPopupStore,renderOrigin:e=>s()(ht.Z,{renderTooltip:()=>{const e=(0,Ct.q3)(u);return s()("div",{},void 0,s()("div",{},void 0,u.name),e&&e.auto_update_on_edit&&s()("div",{style:{color:this.theme.mediumInvertedTextColor}},void 0,c.createElement(P.FormattedMessage,Us.sY.keptUpToDateWithNotionAITooltip)))},delayThreshold:500,placement:ht.Z.Placement.Right,render:o=>c.createElement(qt.Z,i()({style:{display:"flex",alignItems:"center",width:"100%",height:"100%",paddingLeft:8,paddingRight:8,paddingTop:d},disabled:r},(0,tt.Z)(o,e)),a&&a(h),s()(vn.Z,{propertySchema:u,showIcon:!0,showBadge:!0,style:js.propertyStyle,property:t}),S&&s()(Vs,{isScrolled:Boolean(l),isCollectionViewBlockSelected:this.isCollectionViewBlockSelected.state}))}),render:this.renderPopup,onClick:this.handleClick})))}getStyle(){const{width:e,disableCellRightBorder:t}=this.props;return{display:"flex",flexShrink:0,overflow:"hidden",fontSize:14,padding:0,width:e,borderRight:t?void 0:`1px solid ${this.theme.tableDividerColor}`}}}js.displayName="TableHeaderCell",js.propertyStyle={fontSize:14};class Xs extends h.Z{constructor(){super(...arguments),this.storeTypes={propertyTypeButtonPopupStore:me.Z,inputStore:m.default.createClass("")},this.handlePropertyNameSubmit=e=>{if(this.shouldShowDuplicateError())return;const{property:t,collectionContextStore:o}=this.props,r=o.collectionStore();if(!r)return;const i=r.getSchema()[t];(null==i?void 0:i.name)!==e&&(N.createAndCommit({userAction:"TableHeaderCell.handlePropertyNameSubmit",environment:this.environment,perform:o=>{Zs.Bv({collectionStore:r,property:t,name:e,transaction:o})}}),B.$q({environment:this.environment,collectionContextStore:o,property:t,from:"view_settings",action:"rename"}))},this.handleHide=()=>{const{collectionContextStore:e,property:t,format:o,formatKey:r,columnIndex:i}=this.props,n=e.collectionViewStore();if(!n)return;const s=(o[r]||[]).map((e=>e.property===t?{...e,visible:!1}:e)),l={...o,[r]:s};N.createAndCommit({userAction:"TableHeaderCell.updatePropertyFormat",environment:this.environment,perform:t=>{E.iG({collectionViewStore:n,update:{format:l},transaction:t}),Os.oz({environment:this.environment,collectionContextStore:e,currentIndex:i,entrypoint:"TableHeaderCell",transaction:t,propertyAction:"hide"})}})},this.handleFreezeColumns=()=>{const{collectionContextStore:e}=this.props;N.createAndCommit({userAction:"TableHeaderCell.handleFreezeColumns",environment:this.environment,perform:t=>{Os.oz({environment:this.environment,collectionContextStore:e,currentIndex:this.props.columnIndex,transaction:t,entrypoint:"TableHeaderCell"})}})},this.getPropertyFormat=()=>{var e;const{format:t,formatKey:o,property:r}=this.props;return null===(e=t[o])||void 0===e?void 0:e.find((e=>e.property===r))},this.handleDelete=async()=>{const{collectionContextStore:e,property:t}=this.props;await Zs.TI({environment:this.environment,collectionContextStore:e,property:t,handleDeleteAccept:this.handleDeleteAccept,theme:this.theme,from:"table_column"})},this.handleDeleteAccept=()=>{const{property:e,schema:t,collectionContextStore:o,columnIndex:r}=this.props,i=o.collectionStore();if(!i)return;const n=i.getSchema()[e];N.createAndCommitAsync({environment:this.environment,userAction:"TableHeaderCell.handleDeleteAccept",waitForServerCommit:!1,perform:async n=>{await Zs.yV({environment:this.environment,collectionStore:i,schema:t,property:e,transaction:n}),Os.oz({environment:this.environment,collectionContextStore:o,currentIndex:r,entrypoint:"TableHeaderCell",transaction:n,propertyAction:"delete"})}}),n&&B.y9({environment:this.environment,collectionContextStore:o,property_type:n.type,from:"table_column",property:e})},this.handleDuplicate=async()=>{const{property:e,collectionContextStore:t,formatKey:o,columnIndex:r}=this.props,i=this.getPropertyFormat(),n=t.collectionStore(),s=t.collectionViewStore(),l=t.normalizedFormatStore.state[o]||[],a=null==n?void 0:n.getSpaceId();if(!(n&&s&&a&&i))return;const c=n.getSchema(),d=c[e];if(!d)return;const h=await(0,ee.xy)({environment:this.environment,schema:c,property:e,properties:l,parentStore:n,spaceId:a});h&&(N.createAndCommit({userAction:"TableHeaderCell.handleDuplicate",environment:this.environment,perform:e=>{E.xO({environment:this.environment,collectionStore:n,update:{[h.newProperty]:h.newPropertySchema},transaction:e}),Os.oz({environment:this.environment,collectionContextStore:t,currentIndex:r,entrypoint:"TableHeaderCell",transaction:e,propertyAction:"duplicate"}),h.automationUpdate&&E.Ki({environment:this.environment,collectionStore:n,update:h.automationUpdate,transaction:e}),o&&Le.FH({stores:[s],update:{[o]:h.newProperties},transaction:e})}}),B.wd({environment:this.environment,collectionContextStore:t,action:"duplicate_property",original_view_type:null==s?void 0:s.getType(),property_type:d.type}))},this.handleAddFilter=()=>{const{property:e,collectionContextStore:t,schema:o}=this.props,r=t.currentPropertyFiltersStore.state,i=t.collectionViewBlockStore(),n=(null==i?void 0:i.getRecordModel.getRecordValue)??As.mF.constant(void 0);let s=r.find((t=>{let{filter:o}=t;return o.property===e}));if(!s){const i=(0,Q.H_)({property:e,schema:o,getRecordValue:n});if(!i)return;const l={id:(0,ar.ZP)(),filter:i};t.filtersBarOpen.setState(!0),_s.iU({environment:this.environment,collectionContextStore:t,temporaryState:{...t.temporaryState.state,propertyFilters:{value:[...r,l]}}}),s=l}if(!s)return;const l=t.getFilterBarItemSettingsStore(s);F.wl({collectionSettingsStore:l,item:{type:"filter"}}),E.n1({collectionContextStore:t})},this.handleSortAscending=()=>{this.createSort(!0)},this.handleSortDescending=()=>{this.createSort(!1)},this.handlePropertyIconSubmit=(e,t)=>{const{property:o,collectionContextStore:r}=this.props,i=r.collectionStore();i&&(N.createAndCommit({userAction:"TableHeaderCell.handlePropertyIconSubmit",environment:this.environment,perform:t=>{Zs.OK({collectionStore:i,property:o,icon:e,transaction:t})}}),B.$q({environment:this.environment,collectionContextStore:r,property:o,icon:e,from:"table",action:"change_icon"}))},this.isFreezeColumnsEnabled=this.createComputedStore((()=>{const{device:e}=this.environment,t=this.props.collectionContextStore.collectionViewStore();return(0,ee.eL)(e.isMobile,null==t?void 0:t.getType())})),this.isRightmostFrozen=this.createComputedStore((()=>{const e=this.props.collectionContextStore.collectionViewStore();if(!e)return!1;const t=e.getTableFrozenColumnIndex();return Boolean((0,ee.Ql)(t)&&this.props.columnIndex===t)})),this.collectionViewType=this.createComputedStore((()=>{var e;return null===(e=this.props.collectionContextStore.collectionViewStore())||void 0===e||null===(e=e.getModel())||void 0===e?void 0:e.getType()}))}willMountOrUpdate(e){const{property:t,schema:o,collectionContextStore:r}=e,i=o[t];if(i&&"relation"===i.type){const e=hs.ny(r,i);null==e||e.load()}}renderComponent(){const{device:e}=this.environment;let t;t=e.isMobile?{menuType:et.og.ActionSheet}:{menuType:et.og.Popup,minWidth:220};const o=this.getMenuSections(this.props.parent);return c.createElement(nt.Z,t,s()(st.Z,{type:st.i.Vertical,initialFocus:void 0,sections:a().compact(o.map(((e,t)=>{if(e.length>0)return{key:t,render:e=>c.createElement(dt.Z,i()({},e,{topBorder:0!==t})),items:e}})))}))}shouldShowDuplicateError(){const{property:e,schema:t}=this.props,{inputStore:o}=this.stores,r=o.state,i=Object.keys(t).find((o=>{var i;return o!==e&&(null===(i=t[o])||void 0===i?void 0:i.name)===r}));return Boolean(i)}getMenuSections(e){var t;const{property:o,schema:r,collectionContextStore:n,formatKey:l,allowHidingTitle:a,format:d}=this.props,{environment:h,theme:p}=this,{device:u}=h,m=r[o],g=n.permissionScopes.state,S=n.settingsStore,v=n.collectionViewStore(),f=n.collectionStore();if(!v||!m)return[];const C=(0,_t.wl)(o),b=Boolean((null===(t=this.getPropertyFormat())||void 0===t?void 0:t.wrap)||v.getFormat().table_wrap)&&"timeline"!==v.getType(),w=n.databaseType,x=Boolean(f&&w&&$.cR(w,o,f)),k="title"===m.type,T=[];if(C&&"person"===m.type){const e=[];T.push(e),e.push({key:"synced_person",render:e=>c.createElement($s.Z,i()({},e,{title:m.name||"",icon:y.Z.info({width:14}),caption:s()("div",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",minWidth:300,maxWidth:350}},void 0,s()(P.FormattedMessage,{defaultMessage:"People synced from external sources may require additional set up. Visit <helpcenterlink>the help center</helpcenterlink> for more information.",id:"database.tableHeaderCell.syncedPersonPropertyCaption",values:{helpcenterlink:function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return s()(Ys.Z,{href:(0,Ki.UY)("guides.syncedContent")},void 0,t)}}}))})),action:()=>{}})}if(g.canConfigureCollection&&!C){const t=[];if(T.push(t),t.push({key:"rename",render:t=>s()(dt.Z,{},void 0,c.createElement(Ks.Z,i()({},t,{initialValue:m.name||"",placeholder:ie.default.formatMessage(Us.sY.inputPlaceholder),focusInitial:!0,inputStore:this.stores.inputStore,onBlur:this.handlePropertyNameSubmit,onSubmit:t=>{this.handlePropertyNameSubmit(t),e.close()},iconButton:{icon:e=>s()(Ds.ZP,{type:m.type,icon:m.icon,size:16,theme:p,style:e}),iconStyle:{fill:Es.Lr[p.mode].gray},enforceIconColor:"gray",onSubmit:this.handlePropertyIconSubmit}})),this.shouldShowDuplicateError()&&s()(Us.mJ,{propertyName:this.stores.inputStore.state,styles:u.isMobile?{paddingBottom:5,paddingLeft:16,paddingRight:16,margin:0,boxShadow:`inset 0 -1px 0 ${p.regularDividerColor}`}:{}})),action:()=>{B.wd({environment:this.environment,collectionContextStore:n,action:"table_header_rename"}),E.n1({collectionContextStore:n}),e.close()}}),t.push({key:"edit_property",render:e=>s()(ht.Z,{placement:ht.Z.Placement.Left,render:t=>c.createElement(rt.Z,i()({disabled:void 0===f,title:s()(P.FormattedMessage,{defaultMessage:"Edit property",id:"database.tableHeaderCell.editProperty"}),icon:y.Z.options({width:14})},(0,tt.Z)(e,t))),style:{whiteSpace:"normal"},renderTooltip:()=>s()(P.FormattedMessage,{defaultMessage:"Edit property name, type, and other options...",id:"database.tableHeaderCell.editPropertyTooltip"})}),action:()=>{f&&(B.wd({environment:this.environment,collectionContextStore:n,action:"table_header_edit"}),E.n1({collectionContextStore:n}),e.close(),F.r$({collectionContextStore:n,collectionSettingsStore:S}),F.H4({collectionSettingsStore:S,item:{type:"properties",timelineViewTab:"table"}}),F.H4({collectionSettingsStore:S,item:{type:"property",formatKey:l,property:o}}))}}),f&&(0,Gs.Zt)(this.environment)&&(0,Ct.qQ)(m)){const r=(0,Ct.q3)(m),a=bt.De(f.getFormat(),o);r?t.push({key:"fill_all_pages",render:e=>s()(ht.Z,{placement:ht.Z.Placement.Left,renderTooltip:()=>s()(Ws.qQ,{collectionStore:f,propertySchema:m}),render:t=>c.createElement(rt.Z,i()({titleStyle:{color:a.isRunning?p.lightTextColor:void 0},disabled:a.isRunning||!f,icon:s()(Ws.Xh,{updateAiInferencesTaskStatus:a,iconStyle:{marginLeft:-1,marginRight:-1},progressIconStyle:{marginTop:4,marginLeft:0,marginRight:-3}}),title:s()(Ws.ZP,{updateAiInferencesTaskStatus:a}),caption:void 0!==a.numPagesFilled&&void 0!==a.numPagesRequested&&s()(Ws.Y7,{updateAiInferencesTaskStatus:a})},(0,tt.Z)(e,t)))}),action:async()=>{await Ls.ge({environment:h,collectionStore:f,propertySchema:m,property:o})}}):t.push({key:"autofill_with_ai",render:e=>c.createElement(rt.Z,i()({disabled:void 0===f,title:s()("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"}},void 0,s()(P.FormattedMessage,{defaultMessage:"Set up AI autofill",id:"database.tableHeaderCell.autofillWithAI"}),s()(qs.Z,{style:{display:"inline-block"}})),icon:y.Z.magicWand({width:14,fill:p.aiPurpleColor})},e)),action:()=>{f&&(e.close(),F.r$({collectionContextStore:n,collectionSettingsStore:S}),F.H4({collectionSettingsStore:S,item:{type:"properties",timelineViewTab:"table"}}),F.H4({collectionSettingsStore:S,item:{type:"property",formatKey:l,property:o}}),F.H4({collectionSettingsStore:S,item:{type:"propertyAiAutofill",propertySchema:m,property:o}}))}})}}if(g.canConfigureBlock){const t=[];T.push(t),t.push({key:"sort_asc",render:e=>c.createElement(rt.Z,i()({},e,{title:s()(P.FormattedMessage,{defaultMessage:"Sort ascending",id:"database.tableHeaderCell.sortAscending"}),icon:y.Z.arrowUp({width:14})})),action:()=>{B.wd({environment:this.environment,collectionContextStore:n,action:"table_header_sort_asc"}),e.close(),this.handleSortAscending()}}),t.push({key:"sort_desc",render:e=>c.createElement(rt.Z,i()({},e,{title:s()(P.FormattedMessage,{defaultMessage:"Sort descending",id:"database.tableHeaderCell.sortDescending"}),icon:y.Z.arrowDown({width:14})})),action:()=>{B.wd({environment:this.environment,collectionContextStore:n,action:"table_header_sort_desc"}),e.close(),this.handleSortDescending()}}),t.push({key:"filter",render:e=>c.createElement(rt.Z,i()({},e,{title:s()(P.FormattedMessage,{defaultMessage:"Filter",id:"database.tableHeaderCell.filter"}),icon:y.Z.filter({width:14})})),action:()=>{"collectionVirtualView"!==n.contextType&&(B.wd({environment:this.environment,collectionContextStore:n,action:"table_header_filter"}),e.close(),this.handleAddFilter())}})}const R=[];if(T.push(R),(a||"title"!==m.type)&&g.canConfigureBlock&&R.push({key:"hide",render:e=>c.createElement(rt.Z,i()({},e,{title:s()(P.FormattedMessage,{defaultMessage:"Hide in view",id:"database.tableHeaderCell.hideInView"}),icon:y.Z.eyeHidePadded({width:22,marginLeft:-4,marginRight:-4})})),action:()=>{B.wd({environment:this.environment,collectionContextStore:n,action:"table_header_hide"}),e.close(),this.handleHide()}}),this.isFreezeColumnsEnabled.state&&g.canConfigureBlock&&R.push({key:"freeze_column",render:e=>c.createElement(rt.Z,i()({},e,{title:this.isRightmostFrozen.state?s()(P.FormattedMessage,{defaultMessage:"Unfreeze columns",id:"database.tableHeaderCell.unfreezeColumns"}):s()(P.FormattedMessage,{defaultMessage:"Freeze up to column",id:"database.tableHeaderCell.freezeUpToColumn"}),icon:this.isRightmostFrozen.state?y.Z.pinStrikethrough({width:14}):y.Z.pin({width:12,margin:"0px 1px"})})),action:()=>{this.handleFreezeColumns()}}),!vt.Tr.includes(m.type)||(0,Ct.dx)(m)||!g.canConfigureCollection||C||k||R.push({key:"duplicate",render:e=>c.createElement(rt.Z,i()({},e,{title:s()(P.FormattedMessage,{defaultMessage:"Duplicate property",id:"database.tableHeaderCell.duplicateProperty"}),icon:y.Z.duplicate({width:14})})),action:async()=>{B.wd({environment:this.environment,collectionContextStore:n,action:"table_header_duplicate"}),e.close(),await this.handleDuplicate()}}),vt.Tr.includes(m.type)&&g.canConfigureCollection&&!C&&!k&&R.push({key:"delete",render:e=>s()(ht.Z,{placement:ht.Z.Placement.Left,disableTooltip:!x,renderTooltip:e=>(0,Hs.A7)(w,e),render:t=>c.createElement(rt.Z,i()({},e,t,{disabled:x,disabledFeedback:x,title:s()(P.FormattedMessage,{defaultMessage:"Delete property",id:"database.tableHeaderCell.deleteProperty"}),caption:this.environment.device.isMobile&&x?(0,Hs.A7)(w):null,icon:x?c.createElement("div",t,y.Z.lockedFilled({width:14})):y.Z.trash({width:14})}))}),action:async()=>{e.close(),await this.handleDelete()}}),g.canConfigureBlock&&"timeline"!==v.getType()){const e=[];T.push(e),e.push({key:"wrap_cell",render:e=>c.createElement(Qs.Z,i()({},e,{title:s()(P.FormattedMessage,{defaultMessage:"Wrap column",id:"database.tableHeaderCell.wrapColumn"}),on:b})),action:()=>{Os.K4({currentValue:b,environment:this.environment,property:o,collectionViewStore:v,format:d,formatKey:l}),B.wd({environment:this.environment,collectionContextStore:n,action:"table_header_wrap_column"})}})}return T}createSort(e){const{property:t,collectionContextStore:o,schema:r}=this.props;if(!r[t])return;const i=[{property:t,direction:e?"ascending":"descending"}];o.filtersBarOpen.setState(!0),_s.iU({environment:this.environment,collectionContextStore:o,temporaryState:{...o.temporaryState.state,sorts:{value:i}}}),E.n1({collectionContextStore:o})}}Xs.displayName="TableHeaderCellMenu";const Js=(0,P.injectIntl)(js);var el=o(35011),tl=o(58299);class ol extends h.Z{constructor(){super(...arguments),this.resizeStartLeftFormat=void 0,this.storeTypes={mouseStore:Pe.Z,resultStore:m.default.createClass(void 0)},this.handleDragStart=e=>{e.preventDefault(),this.resizeStartLeftFormat=this.props.leftFormat,this.stores.mouseStore.setState({...this.stores.mouseStore.state,mousePressed:!0})},this.handleDragMove=e=>{const t=this.getNewFormat(e);t&&this.props.onTemporaryResize(t)},this.handleDragEnd=e=>{const t=this.getNewFormat(e);t&&this.props.onAccept(t),this.stores.mouseStore.setState({...this.stores.mouseStore.state,mousePressed:!1})},this.handleDragCancel=()=>{this.props.onCancel(),this.resizeStartLeftFormat=void 0,this.stores.mouseStore.setState({...this.stores.mouseStore.state,mousePressed:!1})},this.handleDoubleClick=()=>{const e=this.stores.resultStore.state?this.stores.resultStore.state.blockIds:[],t=l.compact(e.map((e=>{const t=tl.Z.findBlockPropertyValueByBlockId(e,this.props.leftFormat.property),o=null==t?void 0:t.getNode();if(o)return this.calculateMaxWidth(o)})));if(this.props.leftFormat.width){const e={...this.props.leftFormat,width:Math.min(800,Math.max(Math.max(...t),rl(this.props.propertySchema,this.props.leftFormat)))};this.props.onAccept(e)}}}renderComponent(){const{device:e}=this.environment,{mouseEntered:t,mousePressed:o}=this.stores.mouseStore.state,r=(o||t)&&!e.isPhone;return s()("div",{style:ol.style,onMouseMove:()=>this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0}),onMouseLeave:()=>this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1})},void 0,s()(bi.Z,{onDraggableDragStart:this.handleDragStart,onDraggableDragMove:this.handleDragMove,onDraggableDragEnd:this.handleDragEnd,onDraggableDragCancel:this.handleDragCancel,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,render:e=>c.createElement("div",i()({style:r?this.getInnerActiveStyle():this.getInnerStyle(),onDoubleClick:this.handleDoubleClick},e))}))}getInnerStyle(){return{width:5,marginLeft:-3,marginTop:-1,height:this.props.height,transition:"background 200ms ease-out",background:Ho.ZP.blueWithAlpha(0),cursor:"col-resize"}}getInnerActiveStyle(){return{...this.getInnerStyle(),background:Ho.ZP.blueWithAlpha(.8)}}calculateMaxWidth(e){const t=e.cloneNode(!0);let o=!1;"relative"===(null==e?void 0:e.style.position)&&(e.style.position="unset",o=!0);const r=getComputedStyle(e);for(let s=0;s<r.length;s++){const e=r[s],o=r.getPropertyValue(e);t.style[e]=o}o&&(e.style.position="relative"),t.id="notion-table-view-cell-shadow",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.width="auto",t.style.opacity="0",t.style.display="flex",t.style.position="absolute";const i=t.querySelectorAll("*");for(const s of i)s.style&&(s.style.pointerEvents="none",s.style.width="auto");document.body.appendChild(t);const n=t.getBoundingClientRect();return t.remove(),null!=n&&n.width?Math.ceil(n.width):void 0}getNewFormat(e){if(this.resizeStartLeftFormat&&this.resizeStartLeftFormat.width){const t=Math.max(this.resizeStartLeftFormat.width+e.diffX,rl(this.props.propertySchema,this.props.leftFormat));return{...this.resizeStartLeftFormat,width:t}}}getTableColumnMinWidth(e,t){if("checkbox"===(null==e?void 0:e.type)||"status"===(null==e?void 0:e.type)&&"checkbox"===t.statusShowAs)return 32;var o;if(("number"===(null==e?void 0:e.type)||"formula"===(null==e?void 0:e.type)&&"number"===(0,el.mm)(e))&&"ring"===(null==e||null===(o=e.show_as)||void 0===o?void 0:o.type))return 32;return"auto_increment_id"===(null==e?void 0:e.type)?64:100}}function rl(e,t){if("checkbox"===(null==e?void 0:e.type)||"status"===(null==e?void 0:e.type)&&"checkbox"===t.statusShowAs)return 32;var o;if(("number"===(null==e?void 0:e.type)||"formula"===(null==e?void 0:e.type)&&"number"===(0,el.mm)(e))&&"ring"===(null==e||null===(o=e.show_as)||void 0===o?void 0:o.type))return 32;return"auto_increment_id"===(null==e?void 0:e.type)?64:100}ol.displayName="TableHeaderResizer",ol.style={position:"absolute",right:0,width:0,flexGrow:0,zIndex:1};const il=ol;var nl=o(81415);function sl(e){window.__c={n:"LearnMoreLink"};const{href:t,style:o}=e,r=(0,fo.yK)((e=>({default:{display:"flex",marginTop:7,marginBottom:7,alignItems:"center",cursor:"pointer",textDecoration:"none",pointerEvents:"auto",width:"fit-content",color:e.mediumTextColor}})),[]);return s()("a",{href:t,target:"_blank",style:{...r.default,...o}},void 0,y.Z.help({width:14,marginRight:4}),s()(P.FormattedMessage,{id:"LearnMoreLink.learnMore",defaultMessage:"Learn more"}))}var ll=o(71424);function al(e){window.__c={n:"WikiPropertiesOnboardingTooltip"};const{origin:t,propertyType:o}=e,r=(0,vo.O7)();return s()(nl.U,{origin:t,placementToOrigin:"bottom",header:function(){switch(o){case"owner":return s()(P.FormattedMessage,{id:"WikiPropertiesOnboardingTooltip.header.ownerProperty",defaultMessage:"Owner"});case"verification":return s()(P.FormattedMessage,{id:"WikiPropertiesOnboardingTooltip.header.verificationProperty",defaultMessage:"Verification"});case"tags":return s()(P.FormattedMessage,{id:"WikiPropertiesOnboardingTooltip.header.tagsProperty",defaultMessage:"Add tags and more"});default:(0,cr.t1)(o)}}(),content:function(){switch(o){case"owner":return s()(P.FormattedMessage,{defaultMessage:"Owners are responsible for keeping the page updated. By default, the owner is the page creator",id:"WikiPropertiesOnboardingTooltip.content.ownerProperty",values:{bold:e=>s()("span",{style:{fontWeight:x.Z.fontWeight.semibold}},void 0,e)}});case"verification":return c.createElement(c.Fragment,null,s()(P.FormattedMessage,{defaultMessage:"Page owners can mark a page as verified or expired, to help viewers understand whether they can trust the content",id:"WikiPropertiesOnboardingTooltip.content.verificationProperty"}),s()(sl,{href:(0,Ki.UY)("guides.wikis"),style:{color:Ho.ZP.uiLightGray}}));case"tags":return c.createElement(c.Fragment,null,s()(P.FormattedMessage,{defaultMessage:"Customize your wiki with tags or other database properties",id:"WikiPropertiesOnboardingTooltip.content.tagsProperty"}),s()(sl,{href:(0,Ki.UY)("guides.databaseProperties"),style:{color:Ho.ZP.uiLightGray}}));default:(0,cr.t1)(o)}}(),numSteps:3,currStepIndex:function(){switch(o){case"owner":return 0;case"verification":return 1;case"tags":return 2;default:(0,cr.t1)(o)}}(),onCloseClick:()=>{bs.nX(r)},onPrimaryButtonClick:()=>bs.Rg(r),onBackButtonClick:()=>bs.FO(r),shouldDismissUponOutsideClick:!0,pointerLength:ll.EZ,pointerOffset:ll.FD,style:{width:ll.G5}})}class cl extends h.Z{constructor(){super(...arguments),this.storeTypes={tableHeaderRowStore:xs,resultStore:m.default.createClass(void 0)},this.propertyRef=c.createRef(),this.renderHeaderRowCells=(e,t,o)=>{var r,i,n,l;const{device:a}=this.environment,{store:d,collectionContextStore:h,schema:p,query:u,resultStore:m,disabled:g,formatKey:v,isScrolled:y,disableCellRightBorder:f,renderSpacer:C,allowHidingTitle:b,paddingTop:w,groupFormat:x}=this.props,k=this.getCurrentFormat(),P=this.props.showPropertyFormatsStore.state[t],T=t===o.length-1,R=x?[x]:[],I=bs.B1(),M=(null===(r=h.collectionStore())||void 0===r?void 0:r.getFormat().app_config_uri)===S.GZ&&d.isCollectionViewPageWithContent()&&d.id===(null===(i=h.collectionViewBlockStore())||void 0===i?void 0:i.id),B=M&&e===fs.k.Owner&&"owner"===I,V=M&&"verification"===(null===(n=p[e])||void 0===n?void 0:n.type)&&"verification"===I,F=M&&"multi_select"===(null===(l=p[e])||void 0===l?void 0:l.type)&&"tags"===I,D=!a.isMobile&&(B||V||F),E=c.createElement(c.Fragment,null,D&&s()(al,{origin:this.propertyRef,propertyType:I}),P&&P.width&&s()(Js,{format:k,schema:p,query:u,property:e,width:P.width,collectionViewBlockStore:d,collectionContextStore:h,isScrolled:y,disabled:g,formatKey:v,isLast:T,disableCellRightBorder:f,allowHidingTitle:b,renderSpacer:C,paddingTop:w,columnIndex:t,resultStore:m,groupsPointer:R}),!g&&!a.isPhone&&s()(il,{leftFormat:P,onTemporaryResize:this.handleTemporaryColumnResize,onAccept:this.handleColumnResizeAccept,onCancel:this.handleTemporaryColumnResizeCancel,height:this.props.height,propertySchema:p[e],resultStore:m}));return c.createElement("div",{key:e,style:this.getHeaderCellWrapStyle(),ref:D?this.propertyRef:void 0},E)},this.handleColumnReorder=e=>{const{collectionContextStore:t,formatKey:o}=this.props,r=t.collectionViewStore();if(!r)return;const i={...this.getCurrentFormat(),[o]:a().sortBy(this.getProperties(),(t=>{const o=e.indexOf(t.property);return o>=0?o:1/0}))};N.createAndCommit({userAction:"TableHeaderRow.handleColumnReorder",environment:this.environment,perform:e=>{E.iG({collectionViewStore:r,update:{format:i},transaction:e})}}),B.wd({environment:this.environment,collectionContextStore:t,action:"table_reorder_columns"})},this.handleTemporaryColumnResize=e=>{this.props.tableStore.setState({...this.props.tableStore.state,temporaryFormat:this.getNewResizeFormat(e)})},this.handleColumnResizeAccept=e=>{const{collectionContextStore:t,formatKey:o}=this.props,r=t.collectionViewStore();if(!r)return;const i={...this.getCurrentFormat(),[o]:this.getProperties().map((t=>t.property===e.property?e:t))};N.createAndCommit({userAction:"TableHeaderRow.handleColumnResizeAccept",environment:this.environment,perform:e=>{E.iG({collectionViewStore:r,update:{format:i},transaction:e})}}),this.props.tableStore.setState({...this.props.tableStore.state,temporaryFormat:void 0}),B.wd({environment:this.environment,collectionContextStore:t,action:"table_resize_columns"})},this.handleTemporaryColumnResizeCancel=()=>{this.props.tableStore.setState({...this.props.tableStore.state,temporaryFormat:void 0})},this.handleAddColumnClick=()=>{const{collectionContextStore:e}=this.props,t=e.collectionStore();t&&(z.ZH(this.environment),H.ZH(this.environment),E.wG(),B.wd({environment:this.environment,collectionContextStore:e,action:"click_new_property"}),F.wl({collectionSettingsStore:e.settingsStore,item:{type:"propertyType",propertyTypes:(0,vt.TP)({isSyncedCollection:t.isSyncedCollection(),collectionContextStore:e,environment:this.environment}),onAccept:(t,o)=>{Cs.PW({environment:this.environment,collectionContextStore:e,propertyType:t,propertyName:o,from:"table"})}}}))},this.handleConfigureColumnsClick=()=>{const{collectionContextStore:e}=this.props;F.r$({collectionContextStore:e,collectionSettingsStore:e.settingsStore}),B.wd({environment:this.environment,collectionContextStore:e,action:"click_table_header_dot_menu"}),F.H4({collectionSettingsStore:e.settingsStore,item:{type:"properties",timelineViewTab:"timeline"}})},this.captureEditorMouseDown=e=>{(0,re.ZP)({event:e,context:re.Af.EditorMouseDown,callback:()=>{}})},this.shouldShowMultiSelectCheckbox=()=>{const{collectionContextStore:e}=this.props;return(0,ee.fk)({environment:this.environment,collectionContextStore:e})}}renderComponent(){var e;const{disabled:t,showRightActions:o,disableHorizontalEdgeScroll:r,collectionContextStore:i,groupFormat:n,isScrolled:l}=this.props,a=i.permissionScopes.state,d=this.props.showPropertyFormatsStore.state.map((e=>e.property)),h=this.environment.device.isMobile,p=null===(e=i.collectionViewStore())||void 0===e?void 0:e.getTableFrozenColumnIndex(),u=(0,ee.bW)(p),m={...(0,ee.eL)(h,"table")?(0,ko.oc)({collectionContextStore:i,isMobile:h,stickyLeft:24,theme:this.theme}):{}},g=d.slice(0,u),S=d.slice(u),v=!t&&o?c.createElement(c.Fragment,null,this.renderAddColumnButton(),this.renderConfigureColumnsButton()):null,y=n?[n]:[],f=this.shouldShowMultiSelectCheckbox()&&s()(dl,{groupsPointer:y,collectionContextStore:i,isScrolled:Boolean(l)});return t||!a.canConfigureBlock?s()(kr,{position:Ue.Top},void 0,s()("div",{style:this.getHeaderRowStyle()},void 0,s()("div",{style:(0,ko.oc)({collectionContextStore:i,isMobile:h,stickyLeft:0,theme:this.theme})},void 0,f),s()("div",{style:li.l8},void 0,s()("div",{style:{display:"flex",...m}},void 0,g.map(this.renderHeaderRowCells)),S.map(((e,t,o)=>this.renderHeaderRowCells(e,t+u,o)))),v,this.props.children)):(0,ee.Ql)(p)?s()(kr,{position:Ue.Top},void 0,s()("div",{style:this.getHeaderRowStyle()},void 0,s()("div",{style:(0,ko.oc)({collectionContextStore:i,isMobile:h,stickyLeft:0,theme:this.theme})},void 0,f),s()(Bs,{style:{display:"flex"},direction:"horizontal",keys:d,sectionedKeys:{frozen:g,unfrozen:S},sectionStyles:{frozen:{display:"flex",...m},unfrozen:{display:"flex"}},renderKey:this.renderHeaderRowCells,onDrop:this.handleColumnReorder,disableHorizontalEdgeScroll:r}),v,this.props.children)):s()(kr,{position:Ue.Top},void 0,s()("div",{style:{...this.getHeaderRowStyle()}},void 0,f,s()(li.ZP,{direction:"horizontal",keys:d,renderKey:this.renderHeaderRowCells,onDrop:this.handleColumnReorder,disableHorizontalEdgeScroll:r}),v,this.props.children))}renderAddColumnButton(){return s()(qt.Z,{style:this.getAddColumnStyle(),onMouseDown:this.captureEditorMouseDown,onClick:this.handleAddColumnClick,className:q.V6y},void 0,s()("div",{style:cl.addColumnIconWrapStyle},void 0,y.Z.plus({width:12,fill:this.theme.mediumIconColor})))}renderConfigureColumnsButton(){return s()(qt.Z,{style:this.getConfigureColumnsStyle(),onMouseDown:this.captureEditorMouseDown,onClick:this.handleConfigureColumnsClick,className:q.V6y},void 0,s()("div",{style:cl.addColumnIconWrapStyle},void 0,y.Z.dots({width:12,fill:this.theme.mediumIconColor})))}getCurrentFormat(){const{format:e}=this.props,{temporaryFormat:t}=this.props.tableStore.state;return t||e}getNewResizeFormat(e){const{formatKey:t}=this.props;return{...this.getCurrentFormat(),[t]:this.getProperties().map((t=>t.property===e.property?e:t))}}getProperties(){const{formatKey:e}=this.props;return this.getCurrentFormat()[e]||[]}getHeaderCellWrapStyle(){return{display:"flex",position:"relative"}}getHeaderRowStyle(){var e;const{collectionContextStore:t,isInPeekRenderer:o,height:r,minWidth:i,disableTopBorder:n}=this.props,s=t.collectionViewStore();if(!s)return{};const l=(null===(e=t.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(o?this.theme.cardContentBackground:this.theme.contentBackground);return{display:"flex",position:"absolute",background:l,zIndex:k.VT,height:r-1,color:this.theme.mediumTextColor,borderTop:n?void 0:`1px solid ${this.theme.tableDividerColor}`,boxShadow:`\n\t\t\t\t-3px 0 0 ${l},\n\t\t\t\t0 1px 0 ${this.theme.tableDividerColor}\n\t\t\t`,minWidth:i,left:"timeline"===s.getType()?void 0:0,right:"timeline"===s.getType()?void 0:0}}getAddColumnStyle(){return{display:"flex",justifyContent:"flex-start",width:32}}getConfigureColumnsStyle(){return{display:"flex",justifyContent:"flex-start",flexGrow:1,width:32}}}function dl(e){window.__c={n:"GroupSelectCheckbox"};const{groupsPointer:t,collectionContextStore:o,isScrolled:r}=e,i=(0,vo.O7)(),n=(0,c.useCallback)((()=>(0,xo.A7)(t[0],o)),[o,t]),l=(0,yo.VK)((()=>{const e=n(),t=e.length;if(0===t)return!1;const o=Vt.default.state.stores.filter((t=>e.includes(t))).length;return 0!==o&&(o===t||"indeterminate")}),[n]),d=(0,yo.VK)((()=>{var e;const t=o.collectionViewStore(),r=null===(e=o.collectionViewStore())||void 0===e?void 0:e.getTableFrozenColumnIndex();return(0,ee.eL)(i.device.isMobile,null==t?void 0:t.getType())&&!(0,ee.Ql)(r)}),[o,i.device.isMobile]),h=(0,c.useCallback)((e=>{var t;const r=n(),s=Vt.default.state.stores,c=(0,ko.vg)({collectionViewBlockId:null===(t=o.collectionViewBlockStore())||void 0===t?void 0:t.id})?[]:s;!1===l||"indeterminate"===l?H.Z5({environment:i,stores:a().union(c,r)}):!0===l&&H.Z5({environment:i,stores:a().without(c,...r)}),e.stopPropagation()}),[l,o,i,n]),p=(0,fo.Fg)(),u=(0,yo.VK)((()=>d?(0,ko.oc)({collectionContextStore:o,isMobile:i.device.isMobile,stickyLeft:0,theme:p}):{}),[d,o,i.device.isMobile,p]);return s()("div",{style:u},void 0,s()(Fs,{checkedState:l,onClick:h,checkboxType:"group",collectionContextStore:o,isScrolled:r}))}cl.displayName="TableHeaderRow",cl.contextTypes={...h.w,...W.xm},cl.addColumnIconWrapStyle={display:"flex",width:32,height:"100%",alignItems:"center",justifyContent:"center"};const hl=(0,P.injectIntl)(cl);var pl=o(86486),ul=o(29370);class ml extends Ee.Z{activate(){const{collectionContextStore:e,handleOpenPeekPage:t,store:o}=this.props,{mainEditorCurrentBlockStore:r}=ue.default.state,i=ee.mb({store:o,mainEditorCurrentBlockStore:r,collectionContextStore:e,fullyQualified:!1});i&&(t(),L.navigate({environment:this.environment,url:i}))}renderPersisted(){return c.createElement(gl,this.props)}}function gl(e){window.__c={n:"TableRowFunctional"};const{disabled:t,store:o,groupFormat:r,collectionContextStore:n,propertyFormats:l,showRightActionsSpacer:a,disableTableWrap:d,...h}=e,{isMobile:p}=(0,vo.Fy)(),u=(0,yo.VK)((()=>!t&&o.canEdit()),[t,o]),m=(0,yo.VK)((()=>(0,xo.A7)(r,n).findIndex((e=>e===o))),[n,r,o]),g=(0,yo.VK)((()=>{const e=n.collectionViewBlockStore();return!!e&&(0,zs.sY)(e)}),[n]),S=(0,yo.VK)((()=>{var t;const{collectionContextStore:o,groupFormat:r}=e,i=ul.Z.state,n=o.collectionViewBlockStore();if(!n)return!1;if(!i.isActive||!(0,ul.N)(i.selectionKey,{collectionViewBlockStore:n,groupFormat:r}))return!1;const{selection:s}=i,{start:l}=s,a=null===(t=o.collectionViewStore())||void 0===t?void 0:t.getTableFrozenColumnIndex();return ee.Ql(a)&&m===l.row&&l.col<=a}),[e,m]),v=(0,fo.Fg)(),y=(0,yo.VK)((()=>{var e;return null===(e=n.collectionViewStore())||void 0===e?void 0:e.getTableFrozenColumnIndex()}),[n]),f=(0,yo.VK)((()=>ee.bW(y)),[y]),C=(0,yo.VK)((()=>{var e;return ee.eL(p,null===(e=n.collectionViewStore())||void 0===e?void 0:e.getType())}),[p,n]),b=(0,yo.VK)((()=>C?{...(0,ko.oc)({collectionContextStore:n,isMobile:p,theme:v}),display:"flex",...S?{zIndex:k.I5+1}:{},...e.isScrolled&&-1===y&&{height:"calc(100% + 1px)",borderBottom:`1px solid ${v.tableDividerColor}`}}:{}),[n,y,p,S,e.isScrolled,C,v]),[w,x]=(0,c.useMemo)((()=>C&&void 0!==y?[l.slice(0,y+1),l.slice(y+1)]:[[],l]),[y,l,C]),P=(0,yo.VK)((()=>{var e;return Boolean(!d&&(null===(e=n.collectionViewStore())||void 0===e?void 0:e.getFormatStore().getKeyStore("table_wrap").getValue()))}),[n,d]),T=(0,yo.VK)((()=>{var e;return Boolean("timeline"===(null===(e=n.collectionViewStore())||void 0===e?void 0:e.getType())||!P&&!l.some((e=>e.wrap)))}),[n,l,P]),R=(0,yo.VK)((()=>{const e=n.permissionScopes.state;return e.isLocked||!e.canConfigureCollection||!e.canConfigureBlock}),[n.permissionScopes]);return s()(c.Fragment,{},void 0,s()("div",{style:{display:"flex"}},void 0,s()("div",{style:{display:"flex"}},void 0,s()("div",{style:C?b:{}},void 0,s()("div",{style:{display:"flex",background:g?Ho.ZP.blueWithAlpha(.14):void 0}},void 0,s()(fl,{store:o,isScrolled:e.isScrolled}),c.createElement(Sl,i()({store:o,canEdit:u,propertyFormats:w,shouldSetCellHeight:T,indexAddendum:0,rowIndex:m,disabled:t,groupFormat:r,disableTableWrap:d,isLocked:R},h)))),c.createElement(Sl,i()({store:o,canEdit:u,propertyFormats:x,shouldSetCellHeight:T,indexAddendum:f,rowIndex:m,disabled:t,groupFormat:r,disableTableWrap:d,isLocked:R},h)))),a&&!R&&s()(Cl,{}))}function Sl(e){window.__c={n:"TableRowValues"};const{blockPropertyValueOverlayStore:t,propertyFormats:o,store:r,disableTableWrap:n,shouldSetCellHeight:s,indexAddendum:l,...a}=e,d=(0,W.Y$)(),h=(0,yo.VK)((()=>d.collectionViewStore()),[d]),p=(0,yo.VK)((()=>!!h&&Boolean(!n&&h.getFormatStore().getKeyStore("table_wrap").getValue())),[h,n]),u=(0,yo.VK)((()=>{const e=pl.default.state;return Boolean(e.isOpen&&e.currentStore===r)}),[r]),m=(0,yo.VK)((()=>!t.state.isOpen&&Vt.default.state.stores.length>0&&Vt.default.state.stores[0].id===r.id),[r.id,t]),g=(0,yo.VK)((()=>d.currentSubitemFormatStore.state),[d.currentSubitemFormatStore]),S=(0,yo.VK)((()=>(0,$.$4)()&&"title"===(null==h?void 0:h.getFormat().table_subitem_toggle_column)),[h]),v=(0,yo.VK)((()=>{var e;return null===(e=d.collectionViewStore())||void 0===e?void 0:e.getTableFrozenColumnIndex()}),[d]);return c.createElement(c.Fragment,null,o.map(((e,o)=>c.createElement(vl,i()({index:o+(l??0),key:e.property,store:r,propertyFormat:e,isLastColumn:o+(l??0)===length-1,isRightMostFrozenColumn:ee.Ql(v)&&v===o+(l??0),collectionViewStore:h,tableWrap:p,shouldSetCellHeight:s,isShowingHoverMenu:u,shouldCaptureKeyboard:m,subitemFormat:g,isSubitemToggleOnTitleColumn:S,blockPropertyValueOverlayStore:t},a)))))}ml.displayName="TableRow";const vl=e=>{window.__c={n:"TableRowValue"};const{propertyFormat:t,index:o,canEdit:r,isLastColumn:i,isRightMostFrozenColumn:n,store:l,schema:d,disabled:h,disableCellBorderRight:p,subitemPath:u,onShiftEnter:m,tableWrap:g,subitemFormat:S,isShowingHoverMenu:v,shouldCaptureKeyboard:y,isLocked:f,toggleButton:C,onPropertyClick:b,titleColumnIndex:w,isSubitemToggleOnTitleColumn:x,disableLastCellBorderRight:k,onPropertyTab:P,onPropertyUntab:T,onPropertyEnter:R,onPropertyEsc:I,onPropertyBgClick:M,onPropertyContextMenu:B,collectionViewStore:V,blockPropertyValueOverlayStore:F,isScrolled:D,shouldSetCellHeight:E,onOpenProperty:A,disableHorizontalEdgeScroll:_,handleOpenPeekPage:Z,groupFormat:L,rowIndex:O}=e,{width:G,property:H,wrap:z}=t,N=(0,W.Y$)(),K=(0,yo.VK)((()=>l.getAssociatedCollectionStore()),[l]),U=(null==u?void 0:u.length)??0,$=S&&(0,ko.lO)({columnIndex:o,titleColumnIndex:w,isSubitemToggleOnTitleColumn:x}),Q=(0,c.useMemo)((()=>{if(void 0!==G)return $?G-(0,ko.lZ)({columnIndex:o,indentLevel:U,titleColumnIndex:w,isSubitemToggleOnTitleColumn:x}):G}),[U,o,x,$,w,G]),Y=(0,c.useMemo)((()=>$&&s()(yl,{subitemFormat:S,toggleButton:C,subitemPath:u})),[$,S,u,C]),j=(0,c.useCallback)((()=>b(l,H,d)),[b,H,d,l]),X=h||!r,J=(0,yo.VK)((()=>{const e=N.collectionViewBlockStore();return!!e&&(0,zs.sY)(e)}),[N]),ee=(0,yo.VK)((()=>{const e=ul.Z.state,t=N.collectionViewBlockStore();if(!t)return!1;if(!e.isActive||!(0,ul.N)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:L}))return!1;const{selection:r}=e,{start:i,end:n}=r,s=O===i.row||O===n.row||a().inRange(O,i.row,n.row),l=o===i.col||o===n.col||a().inRange(o,i.col,n.col);return s&&l}),[N,L,o,O]),te=(0,yo.VK)((()=>{const e=ul.Z.state,t=N.collectionViewBlockStore();if(!t)return!1;if(!e.isActive||!(0,ul.N)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:L}))return!1;const{selection:r}=e,{start:i}=r;return O===i.row&&o===i.col}),[N,L,o,O]),oe=(0,fo.yK)((e=>({tableCell:{width:G||void 0,height:"calc(100% + 1px)",position:"relative",borderRight:p||n||i&&k?"none":`1px solid ${e.tableDividerColor}`,background:ee?Ho.ZP.blueWithAlpha(.07):void 0},tableSelectionOverlay:{borderRadius:te?3:void 0,boxShadow:te?e.outlineBlueInputBoxShadow:void 0,position:"absolute",pointerEvents:"none",left:0,top:0,width:"100%",height:"100%"},propertyValueContainer:{display:"flex",overflowX:"hidden",height:"100%",width:G||void 0}})),[p,k,ee,i,n,te,G]),re=s()(Qt.Z,{capture:y,onShiftEnter:m},void 0,s()(Kt.Z,{collectionStore:K,store:l,property:H,disabled:X,locked:f,width:Q,format:Ut.C.Table,forceMouseEntered:"title"===H&&r?v:void 0,tableWrap:Boolean(g||z),isLast:i,disableTableBorderRight:p||n||i&&k||$,indentLevel:0===o&&u?u.length:void 0,onTab:P,onUntab:T,onEnter:R,onClick:j,onEsc:I,onBgClick:M,onContextMenu:B,collectionViewStore:V,shouldSetCellHeight:E,onOpenProperty:A,blockPropertyValueOverlayStore:F,disableHorizontalEdgeScroll:_,handleOpenPeekPage:Z},H),n&&s()(Vs,{isScrolled:D,isCollectionViewBlockSelected:J}));return s()("div",{className:q.mWS,"data-row-index":O,"data-col-index":o,style:oe.tableCell},void 0,s()("div",{style:oe.propertyValueContainer},void 0,$&&Y,re),te&&s()("div",{style:oe.tableSelectionOverlay}))};function yl(e){const{toggleButton:t,subitemPath:o}=e,r=(null==o?void 0:o.length)??0,i=Math.max((r-1)*xo.Hw,0)+xo.gY;return t?s()("div",{style:{paddingTop:4,display:"flex"}},void 0,s()("div",{style:{width:i}}),t):s()("div",{style:{minWidth:i+xo.Hw}})}const fl=c.memo((e=>{window.__c={n:"RowSelectCheckboxMaybe"};const{store:t,isScrolled:o}=e,r=(0,W.Y$)(),i=(0,vo.O7)(),n=(0,yo.VK)((()=>Vt.default.state.stores.some((e=>e===t))),[t]),l=(0,yo.VK)((()=>ee.fk({environment:i,collectionContextStore:r})),[r,i]),a=(0,c.useCallback)((e=>{var o;(0,ko.vg)({collectionViewBlockId:null===(o=r.collectionViewBlockStore())||void 0===o?void 0:o.id})?H.Z5({environment:i,stores:[t]}):H.Ys({environment:i,store:t,toggle:!0}),e.stopPropagation()}),[r,i,t]);return l?s()(Fs,{checkedState:n,onClick:a,checkboxType:"single_row",collectionContextStore:r,isScrolled:o}):null}));function Cl(){return s()("div",{style:{display:"flex",justifyContent:"flex-start",flexGrow:1,width:64}})}const bl=ml;var wl=o(55061),xl=o(11302),kl=o(39865),Pl=o(4708),Tl=o(25464),Rl=function(e){return e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Up=2]="Up",e[e.Down=3]="Down",e}(Rl||{});class Il extends h.Z{constructor(){super(...arguments),this.rowsWrapEl=null,this.observer=void 0,this.storeTypes={dragAndFillStore:m.default.createClass(void 0)},this.handleDragStart=e=>{e.preventDefault();const t=this.normalizedTableSelectionStore.state;t&&this.isDragAndFillEnabled()&&this.isTargetWithinDragAndFillHandle(e.target)?this.stores.dragAndFillStore.setState({...t}):E.wG()},this.handleDragMove=e=>{if(se.X9()){var t;const o=this.getTableCellPositionFromTarget(e.target);if(!o)return;const r=this.stores.dragAndFillStore.state,i=(null==r?void 0:r.start)??(null===(t=this.normalizedTableSelectionStore.state)||void 0===t?void 0:t.start)??o;if(!i)return;const n=o;if(this.stores.dragAndFillStore.state&&i.col!==n.col)return;this.setSelection({selection:{start:i,end:n},shouldNormalize:!0})}},this.handleDragEnd=()=>{this.dragAndFillCells()},this.handleDragCancel=()=>{this.stores.dragAndFillStore.reset(),E.wG()},this.handleLeft=e=>{e.preventDefault&&e.preventDefault(),Bt.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(!t)return;const o=this.props.collectionContextStore.collectionViewBlockStore();o&&(Os.e2({environment:this.environment,selectionKey:{collectionViewBlockStore:o,groupFormat:this.props.groupFormat},selection:t,shiftKey:"shiftKey"in e&&e.shiftKey||!1,columnCount:this.getCurrentColumnCount()}),this.updateSelectionScroll(Rl.Left))},this.handleRight=e=>{e.preventDefault&&e.preventDefault(),Bt.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(!t)return;const o=this.props.collectionContextStore.collectionViewBlockStore();o&&(Os.FC({environment:this.environment,selectionKey:{collectionViewBlockStore:o,groupFormat:this.props.groupFormat},selection:t,columnCount:this.getCurrentColumnCount(),rowCount:this.allRowsStore.state.length,shiftKey:"shiftKey"in e&&e.shiftKey||!1}),this.updateSelectionScroll(Rl.Right))},this.handleUp=e=>{e.preventDefault&&e.preventDefault(),Bt.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(!t)return;const o=this.props.collectionContextStore.collectionViewBlockStore();o&&(Os.zJ({environment:this.environment,selectionKey:{collectionViewBlockStore:o,groupFormat:this.props.groupFormat},selection:t,shiftKey:"shiftKey"in e&&e.shiftKey||!1}),this.updateSelectionScroll(Rl.Up))},this.handleDown=e=>{e.preventDefault&&e.preventDefault(),Bt.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(!t)return;const o=this.props.collectionContextStore.collectionViewBlockStore();o&&(Os.DI({environment:this.environment,selectionKey:{collectionViewBlockStore:o,groupFormat:this.props.groupFormat},selection:t,rowCount:this.allRowsStore.state.length,shiftKey:"shiftKey"in e&&e.shiftKey||!1}),this.updateSelectionScroll(Rl.Down))},this.handleEnter=e=>{e.preventDefault&&e.preventDefault(),Bt.Z.setKeyboardMode(!0);const{schema:t}=this.props,o=this.normalizedTableSelectionStore.state;if(!o)return;const r=this.allRowsStore.state,i=r[o.start.row],n=this.props.showPropertyFormatsStore.state[o.start.col].property,s=t[n];if(s&&!this.props.disabled)if(Ct.uk.includes(s.type)){if("checkbox"===s.type){const e=i.getPropertyStore(n),t=_t.Ml(e.getValue()),s=r.slice(o.start.row,o.end.row+1);N.createAndCommit({userAction:"TableSelectionOverlay.handleEnter",environment:this.environment,perform:e=>{for(const o of s)Pt.sO({store:o.getPropertyStore(n),value:_t._I(!t),transaction:e})}})}}else kt.bA({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:i,property:n,format:Ut.C.Table,disableHorizontalEdgeScroll:this.props.disableHorizontalEdgeScroll,collectionContextStore:this.props.collectionContextStore}),E.wG()},this.handleTab=e=>{e.preventDefault(),Bt.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(!t)return;const o=this.props.collectionContextStore.collectionViewBlockStore();o&&(Os.FC({environment:this.environment,selectionKey:{collectionViewBlockStore:o,groupFormat:this.props.groupFormat},selection:t,columnCount:this.getCurrentColumnCount(),rowCount:this.allRowsStore.state.length,shiftKey:!1}),this.updateSelectionScroll(Rl.Right))},this.handleUntab=e=>{e.preventDefault(),Bt.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(!t)return;const o=this.props.collectionContextStore.collectionViewBlockStore();o&&(Os.e2({environment:this.environment,selectionKey:{collectionViewBlockStore:o,groupFormat:this.props.groupFormat},selection:t,shiftKey:!1,columnCount:this.getCurrentColumnCount()}),this.updateSelectionScroll(Rl.Left))},this.handleEsc=e=>{const{device:t}=this.environment;if(t.isMobile)return;e.preventDefault(),Bt.Z.setKeyboardMode(!0);const o=this.normalizedTableSelectionStore.state;if(E.wG(),o){const e=(0,ko.AV)(o),t=this.allRowsStore.state.slice(e.minRow,e.maxRow+1);H.Z5({environment:this.environment,stores:t})}},this.handleMoveTo=e=>{e.preventDefault&&e.preventDefault(),Bt.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(E.wG(),t){const e=(0,ko.AV)(t),o=this.allRowsStore.state.slice(e.minRow,e.maxRow+1);if(0===o.length)return;H.Z5({environment:this.environment,stores:o});const r=gi.C.getRectFromStore(o[0]);xl.bA({environment:this.environment,blocks:o,originRect:r,moveToContext:"action_menu"})}},this.handleDelete=e=>{const t=this.normalizedTableSelectionStore.state,o=this.props.collectionContextStore.normalizedSchemaStore.state;t&&!this.props.disabled&&N.createAndCommit({userAction:"TableSelectionOverlay.handleDelete",environment:this.environment,perform:e=>{Os.NE({selection:t,schema:o,currentPropertyFormats:this.props.showPropertyFormatsStore.state,currentRows:this.allRowsStore.state,transaction:e})}})},this.handleCut=e=>{const t=this.normalizedTableSelectionStore.state,o=this.props.collectionContextStore.normalizedSchemaStore.state,r=this.props.collectionContextStore.collectionViewBlockStore();r&&t&&!this.props.disabled&&N.createAndCommit({userAction:"TableSelectionOverlay.handleCut",environment:this.environment,perform:i=>{Os.nA({selectionKey:{collectionViewBlockStore:r,groupFormat:this.props.groupFormat},schema:o,selection:t,currentPropertyFormats:this.props.showPropertyFormatsStore.state,currentRows:this.allRowsStore.state,event:e,transaction:i})}})},this.handleCopy=e=>{const t=this.normalizedTableSelectionStore.state,o=this.props.collectionContextStore.normalizedSchemaStore.state,r=this.props.collectionContextStore.collectionViewBlockStore();r&&t&&Os.qn({selectionKey:{collectionViewBlockStore:r,groupFormat:this.props.groupFormat},schema:o,selection:t,currentPropertyFormats:this.props.showPropertyFormatsStore.state,currentRows:this.allRowsStore.state,event:e})},this.handlePaste=e=>{const{collectionContextStore:t,groupFormat:o,schema:r,showPropertyFormatsStore:i}=this.props,n=this.normalizedTableSelectionStore.state,s=this.props.collectionContextStore.collectionViewBlockStore();s&&n&&!this.props.disabled&&N.createAndCommit({userAction:"TableSelectionOverlay.handlePaste",environment:this.environment,perform:l=>{Os.j0({environment:this.environment,collectionContextStore:t,selectionKey:{collectionViewBlockStore:s,groupFormat:o},selection:n,currentPropertyFormats:i.state,currentRows:this.allRowsStore.state,event:e,transaction:l,schema:r})}})},this.handleCommandEnter=e=>{const{device:t}=this.environment,o=this.normalizedTableSelectionStore.state;if(t.isMobile||!o)return;const{collectionContextStore:r}=this.props,i=this.allRowsStore.state[o.start.row],{mainEditorCurrentBlockStore:n}=ue.default.state,s=ee.mb({store:i,mainEditorCurrentBlockStore:n,collectionContextStore:r,fullyQualified:!1});s&&this.navigate(s)},this.handleShiftEnter=()=>{const{device:e}=this.environment;if(e.isMobile)return;const t=this.normalizedTableSelectionStore.state;if(!t)return;if(!$e.M_(this.environment))return;const{collectionContextStore:o,groupFormat:r}=this.props;if(!o.shouldAllowNewItemCreation())return;const i=this.allRowsStore.state,n=i[t.start.row],s=o.subitemTreeStore.state,l=(0,wo.DY)(s.children,(e=>e.value.store===n)),a="table_selection_overlay_shift_enter";if(l){const e=l?(0,xo.Af)(l.map((e=>e.value.store))):"",s=o.subitemExpandedStore.state.get(e),c=Boolean(null==s?void 0:s.isExpanded),d=[...l].splice(0,l.length-1),h=d?(0,xo.Af)(d.map((e=>e.value.store))):"",u=o.subitemExpandedStore.state.get(h),m=Boolean(null==u?void 0:u.isExpanded);if(c||m)N.createAndCommit({userAction:"TableSelectionOverlay.handleNestedItemShiftEnter",environment:this.environment,perform:e=>{const t=o.collectionStore();if(!t)return;const s=V.yk({environment:this.environment,collectionContextStore:o,groupsPointer:r?[r]:[],results:i,store:n,before:!1,collectionStore:t,transaction:e,subitemPath:l,subitemInsertDirection:m&&!c?"below":"into"});s&&this.props.blockPropertyValueOverlayStore&&p.default.afterNextFlush((()=>{p.default.afterNextFlush((()=>{kt.bA({isNewBlock:!0,environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:s,property:"title",format:Ut.C.Table,collectionContextStore:o})}))}))}});else{const e={col:t.end.col,row:o.currentViewHasSort()?i.length:t.end.row+1};N.createAndCommit({userAction:"TableSelectionOverlay.handleShiftEnter",environment:this.environment,perform:t=>{const{coercionSucceeded:n,newStore:s}=V.IW({environment:this.environment,collectionContextStore:o,groupsPointer:r?[r]:[],results:i,insertAtIndex:e.row,coerce:!0,initializeDefaultTemplate:!0,transaction:t,from:a});if(!n){const e=r?[r]:[],t=o.groupsStore.getGroupState(e);L.peekBlock({environment:this.environment,store:s,peekMode:ee.kr(o.collectionViewStore()),resultsStore:null==t?void 0:t.resultsStore,collectionContextStore:o,pageVisitSource:g.tY.Create})}}}),p.default.afterNextFlush((()=>{this.setSelection({selection:{start:e,end:e},shouldNormalize:!1})}))}}else{const e={col:t.end.col,row:o.currentViewHasSort()?i.length:t.end.row+1};N.createAndCommit({userAction:"TableSelectionOverlay.handleShiftEnter",environment:this.environment,perform:t=>{const{coercionSucceeded:n,newStore:s}=V.IW({environment:this.environment,collectionContextStore:o,groupsPointer:r?[r]:[],results:i,insertAtIndex:e.row,coerce:!0,initializeDefaultTemplate:!0,transaction:t,from:a});if(!n){const e=r?[r]:[],t=o.groupsStore.getGroupState(e);L.peekBlock({environment:this.environment,store:s,peekMode:ee.kr(o.collectionViewStore()),resultsStore:null==t?void 0:t.resultsStore,collectionContextStore:o,pageVisitSource:g.tY.Create})}}}),p.default.afterNextFlush((()=>{this.setSelection({selection:{start:e,end:e},shouldNormalize:!1})}))}this.updateSelectionScroll(Rl.Down),kt.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore})},this.handleDuplicate=e=>{const{device:t}=this.environment;if(t.isMobile)return;const o=this.normalizedTableSelectionStore.state;o&&o.start.col===o.end.col&&!this.props.disabled&&$e.M_(this.environment)&&(e.preventDefault(),N.createAndCommit({userAction:"TableSelectionOverlay.handleDuplicate",environment:this.environment,perform:e=>{this.copyValuesToSelectionFromStart({transaction:e,selection:o,start:o.start})}}))},this.handleCommandShiftEnter=e=>{const{device:t}=this.environment;if(t.isMobile)return;const o=this.normalizedTableSelectionStore.state;if(o){const e=this.allRowsStore.state[o.start.row],t=(0,oe.ZP)({store:e,fullyQualified:!1,pageVisitSource:g.tY.LinkInPage});L.navigateToExternalURL({environment:this.environment,url:t})}},this.handleKeypress=e=>{if(!e.key||e.metaKey||e.ctrlKey)return;e.preventDefault(),Bt.Z.setKeyboardMode(!0);const{schema:t}=this.props,o=this.normalizedTableSelectionStore.state;if(!o)return;const r=this.allRowsStore.state[o.start.row],i=this.props.showPropertyFormatsStore.state[o.start.col].property,n=t[i];n&&!this.props.disabled&&Ct.ub.includes(n.type)&&e.key&&1===e.key.length&&(kt.bA({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:r,property:i,format:Ut.C.Table,disableHorizontalEdgeScroll:this.props.disableHorizontalEdgeScroll,insertChar:e.key,collectionContextStore:this.props.collectionContextStore}),E.wG())},this.handlePropertyTab=()=>{const e=this.props.blockPropertyValueOverlayStore.state;if(e.isOpen){const{store:t,property:o}=e,r=this.getCellPositionOfStore(t,o),i=this.props.showPropertyFormatsStore.state,n={col:Math.min(r.col+1,i.length-1),row:r.row};this.setSelection({selection:{start:n,end:n},shouldNormalize:!0}),this.updateSelectionScroll(Rl.Right),kt.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore})}},this.handlePropertyUntab=()=>{const e=this.props.blockPropertyValueOverlayStore.state;if(e.isOpen){const{store:t,property:o}=e,r=this.getCellPositionOfStore(t,o),i={col:Math.max(r.col-1,0),row:r.row};this.setSelection({selection:{start:i,end:i},shouldNormalize:!0}),this.updateSelectionScroll(Rl.Left),kt.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore})}},this.handlePropertyEnter=()=>{const e=this.props.blockPropertyValueOverlayStore.state;if(!e.isOpen)return;const{store:t,property:o}=e,r=this.getCellPositionOfStore(t,o),i={col:r.col,row:r.row+1};p.default.afterNextFlush((()=>{this.shouldMoveSelectionToNextRow()&&this.setSelection({selection:{start:i,end:i},shouldNormalize:!0})})),this.updateSelectionScroll(Rl.Down),kt.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore})},this.handlePropertyClick=(e,t,o)=>{var r;const{device:i}=this.environment;if("checkbox"!==(null===(r=o[t])||void 0===r?void 0:r.type)||i.isMobile)E.wG();else{const o=this.getCellPositionOfStore(e,t);this.setSelection({selection:{start:o,end:o},shouldNormalize:!0})}},this.dismissPropertyOverlay=e=>{const{device:t}=this.environment,o=this.props.blockPropertyValueOverlayStore.state;if(o.isOpen){const{store:r,property:i}=o,n=this.getCellPositionOfStore(r,i);t.isMobile?E.wG():this.shouldMoveSelectionToNextRow()&&this.setSelection({selection:{start:n,end:n},shouldNormalize:!0}),this.updateSelectionScroll(Rl.Down),kt.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore}),null==e||e(o)}},this.handlePropertyBgClick=()=>{this.dismissPropertyOverlay()},this.handlePropertyEsc=()=>{this.dismissPropertyOverlay((e=>{const{isNewBlock:t,store:o}=e;t&&o.isEmptyTitle()&&o.isEmptyPage()&&N.createAndCommit({userAction:"TableSelectionOverlay.handlePropertyEsc",environment:this.environment,perform:e=>{kl.y8({environment:this.environment,blocks:[o],transaction:e}),e.postSubmitCallbacks.push((e=>{if(!e){const e=this.props.collectionContextStore.collectionStore(),t=this.props.collectionContextStore.collectionViewBlockStore();T.dhV(this.environment,{analyticsName:"delete",from:"collection_esc_shortcut",block_id:o.id,block_type:"page",collection_id:null==e?void 0:e.id,collection_view_id:null==t?void 0:t.id})}}))}})}))},this.handlePropertyOpenProperty=e=>{const t=this.props.blockPropertyValueOverlayStore.state;if(t.isOpen){const{store:o}=t;kt.bA({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:o,property:e,format:Ut.C.Table,disableHorizontalEdgeScroll:this.props.disableHorizontalEdgeScroll,collectionContextStore:this.props.collectionContextStore})}},this.handlePropertyContextMenu=e=>{e.preventDefault();const t=this.allRowsStore.state,o=this.normalizedTableSelectionStore.state,r=this.getTableCellPositionFromTarget(e.target);let i=!1;if(o&&r){const n=Math.min(o.start.row,o.end.row),s=Math.max(o.start.row,o.end.row);if(r.row>=n&&r.row<=s){const o=t.slice(n,s+1);o.length>0&&(H.Z5({environment:this.environment,stores:o}),H.Ys({environment:this.environment,store:o[0]}),xt.Qn({environment:this.environment,stores:Vt.default.state.stores,left:e.clientX,top:e.clientY,actions:wt.Qi,showInput:!0,analyticsFrom:"content_block_menu"}),i=!0)}}if(!i&&r){const o=t[r.row];o&&(H.Ys({environment:this.environment,store:o}),xt.Qn({environment:this.environment,stores:Vt.default.state.stores,left:e.clientX,top:e.clientY,actions:wt.Qi,showInput:!0,analyticsFrom:"content_block_menu"}))}},this.handleRowSelectableEnter=e=>{const t=this.allRowsStore.state,o=e.blocks.map((e=>t.indexOf(e))),r=a().min(o)||0,i=a().max(o)||0;r>=0&&i>=0&&this.setSelection({selection:{start:{col:0,row:r},end:{col:0,row:i}},shouldNormalize:!0})},this.handleRowsWrapMount=e=>{this.rowsWrapEl=e},this.handleRowsObserverChange=()=>{this.selectionStartRectStore.recompute()},this.allRowsStore=this.createComputedStore((()=>{const{groupFormat:e,collectionContextStore:t}=this.props;return(0,xo.A7)(e,t)})),this.normalizedTableSelectionStore=this.createComputedStore((()=>{const e=ul.Z.state,t=this.props.collectionContextStore.collectionViewBlockStore();if(!t)return;const{groupFormat:o}=this.props;if(!e.isActive||!(0,ul.N)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:o}))return;const{selection:r}=e;return this.normalizeTableSelection(r)}),!0),this.selectionStartRectStore=this.createComputedStore((()=>{const e=this.normalizedTableSelectionStore.state;if(e)return this.getCellRect(e.start)}),!0),this.isFrozenColumnsEnabledStore=this.createComputedStore((()=>{const e=this.props.collectionContextStore.collectionViewStore();return ee.eL(this.environment.device.isMobile,null==e?void 0:e.getType())})),this.frozenIndexStore=this.createComputedStore((()=>{const e=this.props.collectionContextStore.collectionViewStore();return null==e?void 0:e.getTableFrozenColumnIndex()})),this.frozenSectionWidthStore=this.createComputedStore((()=>{const e=this.frozenIndexStore.state;var t;if(this.isFrozenColumnsEnabledStore.state)return ee.Ql(e)?null===(t=this.getCellRect({col:e,row:0}))||void 0===t?void 0:t.right:ko.bu}),!0)}willUnmount(){super.willUnmount(),this.observer&&this.observer.disconnect()}didMount(){super.didMount(),this.rowsWrapEl&&(this.observer=new MutationObserver(this.handleRowsObserverChange),this.observer.observe(this.rowsWrapEl,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):L.navigate({environment:this.environment,url:e})}renderComponent(){const{store:e,schema:t,showPropertyFormatsStore:o}=this.props,r=this.normalizedTableSelectionStore.state,n=this.isDragAndFillEnabled()&&r&&(r.start.col===r.end.col&&r.start.row===r.end.row||this.stores.dragAndFillStore.state)?s()(Ml,{store:e,schema:t,selection:r,dragAndFillStore:this.stores.dragAndFillStore,showPropertyFormatsStore:o,selectionStartRectStore:this.selectionStartRectStore,rowsWrapRect:this.getRowsWrapRect(),frozenIndexStore:this.frozenIndexStore,currentRowsStore:this.allRowsStore,isScrolled:this.props.isScrolled}):null,l=this.props.render({onPropertyTab:this.handlePropertyTab,onPropertyUntab:this.handlePropertyUntab,onPropertyEnter:this.handlePropertyEnter,onPropertyClick:this.handlePropertyClick,onPropertyEsc:this.handlePropertyEsc,onPropertyBgClick:this.handlePropertyBgClick,onPropertyContextMenu:this.handlePropertyContextMenu,onOpenProperty:this.handlePropertyOpenProperty,onSelectableEnter:this.handleRowSelectableEnter});return s()(Qt.Z,{capture:void 0!==this.normalizedTableSelectionStore.state,onLeft:this.handleLeft,onRight:this.handleRight,onUp:this.handleUp,onDown:this.handleDown,onEnter:this.handleEnter,onTab:this.handleTab,onUntab:this.handleUntab,onEsc:this.handleEsc,onDelete:this.handleDelete,onBackspace:this.handleDelete,onCut:this.handleCut,onCopy:this.handleCopy,onPaste:this.handlePaste,onCommandEnter:this.handleCommandEnter,onShiftEnter:this.handleShiftEnter,onCommandShiftEnter:this.handleCommandShiftEnter,onDuplicate:this.handleDuplicate,onKeypress:this.handleKeypress,onMoveTo:this.handleMoveTo},void 0,s()(bi.Z,{onDraggableDragStart:this.handleDragStart,onDraggableDragMove:this.handleDragMove,onDraggableDragEnd:this.handleDragEnd,onDraggableDragCancel:this.handleDragCancel,disableHorizontalEdgeScroll:this.props.disableHorizontalEdgeScroll,render:e=>c.createElement("div",i()({style:{position:"relative",minWidth:this.props.minWidth}},e,{ref:this.handleRowsWrapMount}),n,l)}))}getTableCellPositionFromTarget(e){let t=e;for(;null!==t&&!t.classList.contains(q.mWS);)t=t.parentElement;if(null===t)return;return{col:parseInt(t.getAttribute("data-col-index")??"0"),row:parseInt(t.getAttribute("data-row-index")??"0")}}dragAndFillCells(){var e;const t=this.stores.dragAndFillStore.state;if(!t)return;const{start:o,end:r}=t;if(o.col!==r.col||o.row!==r.row)return;const{showPropertyFormatsStore:i,schema:n,collectionContextStore:s}=this.props,l=null===(e=n[i.state[o.col].property])||void 0===e?void 0:e.type;if("verification"===l)return;const a=this.normalizedTableSelectionStore.state;if(!a)return;N.createAndCommit({userAction:"TableSelectionOverlay.handleDragAndFill",environment:this.environment,perform:e=>{this.copyValuesToSelectionFromStart({transaction:e,selection:a,start:o})}});const c=Math.min(a.start.row,a.end.row),d=Math.max(a.start.row,a.end.row);l&&d!==c&&B.qm({environment:this.environment,collectionContextStore:s,property_type:l,num_rows:d-c}),this.stores.dragAndFillStore.reset()}shouldMoveSelectionToNextRow(){if(!(0,Pl.zq)(this.environment))return!0;const e=this.props.blockPropertyValueOverlayStore.state;return!e.isOpen||0===e.additionalStores.length}isDragAndFillEnabled(){const{disabled:e,collectionContextStore:t}=this.props,o=t.permissionScopes.state;return!(e||!o.canEditContent)&&"on"===Ce.default.getEligibleGroup({experimentId:"collection_table_drag_and_fill",defaultGroup:"control"})}setSelection(e){const{selection:t,shouldNormalize:o}=e,r=this.props.collectionContextStore.collectionViewBlockStore();r&&(Os.Z5({environment:this.environment,selectionKey:{collectionViewBlockStore:r,groupFormat:this.props.groupFormat},selection:o?this.normalizeTableSelection(t):t}),this.selectionStartRectStore.recompute())}getRowRect(e){const{rowsWrapEl:t}=this;if(!t)return;const o=gi.C.findSelectablesFromStore(e).map((e=>e.getNode())).find((e=>t.contains(e)));return o?o.getBoundingClientRect():void 0}isTargetWithinDragAndFillHandle(e){let t=e;for(;null!==t;){if(t.classList.contains(q.JR_))return!0;t=t.parentElement}return!1}getCurrentColumnCount(){return this.props.showPropertyFormatsStore.state.length}getCellPositionOfStore(e,t){const o=this.allRowsStore.state;return{col:this.props.showPropertyFormatsStore.state.findIndex((e=>e.property===t)),row:o.findIndex((t=>e===t))}}getRowsWrapRect(){return this.rowsWrapEl?this.rowsWrapEl.getBoundingClientRect():void 0}updateSelectionScroll(e){const t=this.normalizedTableSelectionStore.state;if(t){let o;o=e===Rl.Down?t.start.row>t.end.row?t.start:t.end:e===Rl.Up?t.start.row<t.end.row?t.start:t.end:e===Rl.Right?t.start.col>t.end.row?t.start:t.end:t.start.col<t.end.row?t.start:t.end;const r=this.allRowsStore.state[o.row],i=this.props.showPropertyFormatsStore.state[o.col].property,n=tl.Z.findBlockPropertyValue(r,i),s=(null==n?void 0:n.getNode())??null;if(s){const e=this.frozenSectionWidthStore.state??0,o=this.frozenIndexStore.state,r=this.props.disableHorizontalEdgeScroll||o&&t.start.col<=o&&t.end.col<=o;O.bx({element:s,vertical:{reveal:"closest",paddingToTopEdge:96,paddingToBottomEdge:48},horizontal:r?void 0:{reveal:"closest",paddingToLeftEdge:e},scrollers:{verticalScroller:null==n?void 0:n.getContextVerticalScroller(),horizontalScroller:null==n?void 0:n.getContextHorizontalScroller()}})}}}copyValuesToSelectionFromStart(e){const{transaction:t,selection:o,start:r}=e,{showPropertyFormatsStore:i}=this.props,n=this.allRowsStore.state,s=i.state[r.col],l=n[r.row].getPropertyValue(s.property)||[],a=Math.min(o.start.row,o.end.row),c=Math.max(o.start.row,o.end.row);n.slice(a,c+1).forEach((e=>{e.pointer!==n[r.row].pointer&&Pt.sO({store:e.getPropertyStore(s.property),value:l,transaction:t})}))}normalizeTableSelection(e){const t=this.getCurrentColumnCount(),o=this.allRowsStore.state.length;return{start:{col:(0,ks.Z)(e.start.col,0,t-1),row:(0,ks.Z)(e.start.row,0,o-1)},end:{col:(0,ks.Z)(e.end.col,0,t-1),row:(0,ks.Z)(e.end.row,0,o-1)}}}getXForFirstCellInRow(){const{collectionContextStore:e}=this.props;return(0,ee.fk)({environment:this.environment,collectionContextStore:e})?ko.Xx:0}getCellRect(e){const{rowsWrapEl:t}=this;if(!t)return;const{showPropertyFormatsStore:o}=this.props,r=o.state,i=this.allRowsStore.state[e.row],n=this.getRowRect(i);if(!n)return;const s=t.getBoundingClientRect(),l=n.height,a=n.top-s.top-1,c=r[e.col].width||0,d=l+1;let h=this.getXForFirstCellInRow();for(let p=0;p<e.col;p++){const e=r[p];e.width&&(h+=e.width)}return new DOMRect(h-1,a,c+1,d)}}Il.displayName="TableSelectionOverlay",Il.contextTypes={...K.wK,...h.w};function Ml(e){var t;window.__c={n:"DragAndFillHandle"};const{store:o,schema:r,selection:n,dragAndFillStore:l,currentRowsStore:a,showPropertyFormatsStore:d,selectionStartRectStore:h,rowsWrapRect:p,frozenIndexStore:u,isScrolled:m}=e,g=(0,yo.VK)((()=>l.state),[l]),S=(0,yo.VK)((()=>{const e=(null==g?void 0:g.start)||n.start;return d.state[e.col]}),[g,n,d]),v=(0,P.useIntl)(),y=(0,yo.VK)((()=>{if(!g||!S)return[];const{start:e}=g,t=a.state[e.row].getModel();return t?(0,wl.v4)({property:S.property,schema:r,block:t,getRecordValue:o.getRecordValue,userTimeZone:(0,je.r)(),baseURL:void 0,intl:v}):""}),[a,g,v,S,r,o]),f=S?null===(t=r[S.property])||void 0===t?void 0:t.type:void 0,C=(0,yo.VK)((()=>h.state),[h]),b=(0,yo.VK)((()=>u.state),[u]),w=(0,yo.VK)((()=>ee.Ql(b)&&n.start.col<=b),[b,n]),T=(0,yo.VK)((()=>m&&-1===b?19:0),[b,m]),R=(0,fo.yK)((e=>({dragAndFillContainer:{zIndex:w?k.I5+2:void 0,display:"flex",position:"relative"},dragAndFillOutsideStickyWrapper:{display:"flex",width:"calc(100% - 64px)"},dragAndFillInsideStickyWrapper:{position:w?"sticky":void 0,left:"0"},tooltipContainer:{position:"absolute",left:C?C.left+C.width-5:void 0,zIndex:k.xP},tooltipOrigin:{position:"absolute",left:0,top:C?C.bottom-7:void 0,width:10,height:15,pointerEvents:"auto",cursor:"ns-resize"},tooltipCircle:{position:"absolute",left:0,top:C?C.bottom-5:void 0,width:9,height:9,border:`2px solid ${Ho.ZP.blueWithAlpha(.57)}`,transform:g?"scale(1.3)":void 0,transition:"transform 0.2s ease",background:e.contentBackground,borderRadius:"50%",cursor:"ns-resize"},tooltipText:{color:e.mediumInvertedTextColor,maxWidth:200,...x.Z.textOverflowStyle}})),[w,C,g]);if(!C)return null;if(!f||Ct.ZY(f)||"rollup"===f||"formula"===f||"verification"===f)return null;const I=p?new DOMRect(C.x+p.x+C.width-4,C.y+p.y+C.height-4,7,7):void 0;return I&&-1===b&&(I.x+=T),s()(ht.Z,{renderTooltip:()=>{const e=s()(P.FormattedMessage,{id:"tableView.selectionOverlay.dragAndFill.tooltip",defaultMessage:"Drag vertically to fill value"});return g?s()("div",{style:{display:"flex",flexDirection:"column"}},void 0,e,s()("div",{style:R.tooltipText},void 0,y)):e},delayThreshold:300,forceVisibleState:!!g||void 0,originRect:I,placement:Tl.u.Right,render:e=>c.createElement("div",i()({},e,{className:q.JR_,style:R.dragAndFillContainer}),s()("div",{style:R.dragAndFillOutsideStickyWrapper},void 0,s()("div",{style:R.dragAndFillInsideStickyWrapper},void 0,s()(Sn.Z,{isVisible:!0,animationStyle:{translateX:T},render:()=>s()("div",{style:R.tooltipContainer},void 0,s()("div",{style:R.tooltipOrigin}),s()("div",{style:R.tooltipCircle}))}))))})}const Bl=Il;function Vl(e){window.__c={n:"TableShimmer"};const{isFullScreen:t,hasGroups:o,propertyWidths:r,hasPartialResults:i,hasSearchQuery:n}=e,l=(0,fo.yK)((e=>({container:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},rowsContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},rowContainer:{display:"flex",padding:"0px 16px",alignItems:"flex-start",gap:1,alignSelf:"stretch",borderBottom:`1px solid ${e.regularDividerColor}`},lastRowContainerOverride:{borderBottom:void 0},rowShimmer:{width:200,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor,marginLeft:6},firstRowPartialResultsOverride:{borderTop:`1px solid ${e.regularDividerColor}`},column:{display:"flex",width:200,height:34,padding:"6px 8px",alignItems:"center",gap:6}})),[]);if(!(0,Or.Z)(!0,0,100))return null;const a=r.map(((e,t)=>s()("div",{style:{...l.column,width:e}},t,s()(Wr.Z,{style:{...l.rowShimmer,width:.6*e}}))));let c=1;o||i||n||(c=t?10:3);const d=[...Array(c)].map(((e,t)=>{const o=i?l.firstRowPartialResultsOverride:{},r=t===c-1?l.lastRowContainerOverride:{};return s()("div",{style:{...l.rowContainer,...o,...r}},t,a)}));return s()("div",{style:l.container},void 0,s()("div",{style:l.rowsContainer},void 0,d))}class Fl extends Ee.Z{constructor(){super(...arguments),this.useExperimentalTableSelectionOverlay=this.createComputedStore((()=>Ce.default.checkGate("layout_functional_inner_table_overlay"))),this.onItemShiftEnter=()=>{const e=this.groupStateStore.state;if(!e)return;const{collectionContextStore:t,blockPropertyValueOverlayStore:o}=this.props,r=t.collectionStore();if(!r||!t.shouldAllowNewItemCreation())return;const i=Vt.default.state.stores[0];if(!i)return;const n=t.subitemTreeStore.state,s=(0,wo.DY)(n.children,(e=>e.value.store===i));if(!s)return;const l=s?(0,xo.Af)(s.map((e=>e.value.store))):"",a=t.subitemExpandedStore.state.get(l);Boolean(null==a?void 0:a.isExpanded)&&N.createAndCommit({userAction:"TableGroupResults.onItemShiftEnter",environment:this.environment,perform:n=>{const l=V.yk({environment:this.environment,collectionContextStore:t,groupsPointer:e.groupsPointer,results:e.resultsStore.state,store:i,before:!1,collectionStore:r,transaction:n,subitemPath:s,subitemInsertDirection:"into"});l&&o&&p.default.afterNextFlush((()=>{p.default.afterNextFlush((()=>{kt.bA({isNewBlock:!0,environment:this.environment,blockPropertyValueOverlayStore:o,store:l,property:"title",format:Ut.C.Table,collectionContextStore:t})}))}))}})},this.handleAddRowClick=()=>{const e=new ds.sA(this.environment,"handleAddRowClick"),{collectionContextStore:t,isFullScreen:o,groupFormat:r}=this.props,{device:i}=this.environment,n=r?[r]:[],s=t.groupsStore.getGroupState(n);if(!$e.M_(this.environment)||!s)return void e.fail("invalid_state");t.searchQuery.state&&E.Ug({searchQuery:"",collectionContextStore:t,isFullScreen:o});const l=s.resultsStore.state;N.createAndCommit({userAction:"TableGroupResults.handleAddRowClick",environment:this.environment,perform:o=>{const{coercionSucceeded:n,newStore:a}=V.IW({environment:this.environment,collectionContextStore:t,groupsPointer:r?[r]:[],results:l,insertAtIndex:l.length,coerce:!0,initializeDefaultTemplate:!0,transaction:o,from:"table_group_results",tracker:e});if(i.isMobile){const e=(0,oe.ZP)({store:a,fullyQualified:!1,pageVisitSource:g.tY.Create});this.navigate(e)}else{p.default.afterNextFlush((()=>{p.default.afterNextFlush((()=>{p.default.afterNextFlush((()=>{n?kt.bA({isNewBlock:!0,environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:a,property:"title",format:Ut.C.Table,collectionContextStore:this.props.collectionContextStore}):L.peekBlock({environment:this.environment,store:a,peekMode:ee.kr(t.collectionViewStore()),resultsStore:s.resultsStore,collectionContextStore:t,pageVisitSource:g.tY.Create})}))}))}));const e=t.subitemTreeStore.state;T.W2j(this.environment,{from:e.children?"table_add_parent_item_bottom":"table_add_item_bottom",type:"page",new_page_id:a.id,...(0,j.Pn)(t)})}}})},this.handleLoadMoreClick=e=>{const{collectionContextStore:t,groupFormat:o}=this.props,r=t.groupsStore.getGroupState(o);if(!r)return;const i=r.reducerResultStore.state;(0,re.Wi)(e),H.ZH(this.environment),i&&V.ID({collectionContextStore:t,environment:this.environment,incrementLimitArgs:{isFullScreen:this.props.isFullScreen,currentResultCount:i.blockIds.length,groupsPointer:r.groupsPointer,incrementLimitsInRelatedGroups:!1}}),T.uDZ(this.environment)},this.groupStateStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupFormat:t}=this.props,o=t?[t]:[];return e.groupsStore.getGroupState(o)})),this.showPropertyFormatsStore=this.createComputedStore((()=>this.getTableProperties().filter((e=>e.visible))),!0),this.tableWidthStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return this.showPropertyFormatsStore.state.reduce(((e,t)=>e+(t.width||0)),0)+(e.permissionScopes.getState().canEditContent?32:0)})),this.propertiesWidthStore=this.createComputedStore((()=>this.showPropertyFormatsStore.state.map((e=>e.width||bt.Nx)))),this.titleColumnIndexStore=this.createComputedStore((()=>this.showPropertyFormatsStore.state.findIndex((e=>"title"===e.property)))),this.getItemSelectableStyle=e=>({display:"flex",height:"calc(100% + 2px)",borderBottom:e?void 0:`1px solid ${this.theme.tableDividerColor}`})}renderComponent(){const{collectionContextStore:e,isFullScreen:t,groupFormat:o}=this.props,r=this.groupStateStore.state;if(!r)return;const i=r.reducerResultStore.state,n=void 0!==i,l=ee.VM({collectionContextStore:e,reducerResult:i,isFullScreen:t}),a=void 0!==o,d=o?[o]:[],h=void 0!==i&&(null==i?void 0:i.blockIds.length)>0,p=""!==e.searchQuery.state,u=Ge({collectionContextStore:e,groupsPointer:d}),m=n&&!u&&0===(null==i?void 0:i.blockIds.length);return c.createElement(c.Fragment,null,this.renderHeaderRow(r),s()("div",{style:{height:Al}}),this.renderRows(r),u&&s()(Vl,{isFullScreen:t,hasGroups:a,propertyWidths:this.propertiesWidthStore.state,hasPartialResults:h,hasSearchQuery:p}),m&&s()(ys,{collectionContextStore:this.props.collectionContextStore,shouldShowAddRowButton:this.shouldShowAddRowButton(),handleAddRowClick:this.handleAddRowClick,paddingLeft:this.props.paddingLeft}),s()("div",{style:{width:this.tableWidthStore.state}}),l&&this.renderLoadMoreButton(),this.shouldShowAddRowButton()&&this.renderAddRowButton(),this.renderAggregationRow(),s()("div",{style:{height:Zl}}))}renderHeaderRow(e){const{store:t,schema:o,query:r,disabled:i,collectionContextStore:n,minWidth:l,paddingBottom:a,isScrolled:c,isInPeekRenderer:d,blockPropertyValueOverlayStore:h,groupFormat:p}=this.props,u=n.viewIsFlushToTopbar(),m=n.permissionScopes.state,g=Boolean(p),S=u&&!g,v=Boolean(n.normalizedFormatStore.state.hide_table_vertical_lines);return s()(hl,{store:t,format:this.getCurrentFormat(),groupFormat:p,schema:o,query:r,collectionContextStore:n,isInPeekRenderer:d,minWidth:l,paddingBottom:a,blockPropertyValueOverlayStore:h,resultStore:e.reducerResultStore,showPropertyFormatsStore:this.showPropertyFormatsStore,showRightActions:m.canConfigureCollection&&m.canConfigureBlock,allowHidingTitle:!1,tableStore:this.props.tableStore,formatKey:"table_properties",disabled:i||!m.canConfigureCollection&&!m.canConfigureBlock,disableTopBorder:!S,disableCellRightBorder:!S||v,height:Al,isScrolled:c})}renderRows(e){const{device:t}=this.environment,{store:o,schema:r,query:i,disabled:n,collectionContextStore:l,minWidth:a,blockPropertyValueOverlayStore:c,groupFormat:d}=this.props,h=l.collectionViewStore();if(!h)return;const u=d?[d]:[],m=this.showPropertyFormatsStore.state,g=l.permissionScopes.state,S=this.canEditTable()&&t.isMobile&&!h.isSyncedCollection(),v=Boolean(l.normalizedFormatStore.state.hide_table_vertical_lines),y=this.titleColumnIndexStore.state;return s()(Bl,{store:o,format:this.getCurrentFormat(),schema:r,query:i,collectionContextStore:l,minWidth:a,blockPropertyValueOverlayStore:c,showPropertyFormatsStore:this.showPropertyFormatsStore,disabled:!this.canEditTable(),groupFormat:d,isScrolled:Boolean(this.props.isScrolled),render:e=>this.useExperimentalTableSelectionOverlay.state?s()(Dl,{args:e,collectionContextStore:l,collectionViewFormat:this.getCurrentFormat(),blockPropertyValueOverlayStore:c,isScrolled:Boolean(this.props.isScrolled),groupFormat:d,propertyFormats:this.showPropertyFormatsStore.state,schema:r,canDrag:S,disabled:n,titleColumnIndex:y,onShiftEnter:this.onItemShiftEnter}):s()(Ao,{collectionContextStore:l,groupsPointer:u,format:this.getCurrentFormat(),canDrag:S,resultProps:{schema:r,collectionContextStore:l,propertyFormats:m,onPropertyTab:e.onPropertyTab,onPropertyUntab:e.onPropertyUntab,onPropertyEnter:e.onPropertyEnter,onPropertyClick:e.onPropertyClick,onPropertyEsc:e.onPropertyEsc,onPropertyBgClick:e.onPropertyBgClick,onPropertyContextMenu:e.onPropertyContextMenu,onOpenProperty:e.onOpenProperty,disabled:n,blockPropertyValueOverlayStore:c,isScrolled:Boolean(this.props.isScrolled),showRightActionsSpacer:g.canConfigureCollection,disableCellBorderRight:v,disableHorizontalEdgeScroll:!1,disableLastCellBorderRight:!1,disableTableWrap:!1,onShiftEnter:()=>this.onItemShiftEnter(),titleColumnIndex:y,groupFormat:d},canDrop:!0,resultComponent:bl,disabled:n,direction:Do.Vertical,getItemSelectableStyle:this.getItemSelectableStyle,itemSelectableHaloStyle:{borderRadius:0},shouldShowHoverMenu:!0,analyticsName:"table",emptyDroppableSize:0,touchDragOnly:!0,onSelectableEnter:e.onSelectableEnter,blockPropertyValueOverlayStore:c,titleColumnIndex:y,nestedCreateSubitemButton:e=>{const{store:t,parentStore:o,subitemPath:r,indentLevel:i}=e;if(o)return s()(Hi,{store:t,collectionStore:o,subitemPath:r,indentLevel:i,collectionContextStore:l,disabled:n,groupsPointer:u,onSubitemCreate:e=>{c&&p.default.afterNextFlush((()=>{p.default.afterNextFlush((()=>{kt.bA({isNewBlock:!0,environment:this.environment,blockPropertyValueOverlayStore:c,store:e,property:"title",format:Ut.C.Table,collectionContextStore:l})}))}))}})}})})}renderLoadMoreButton(){const{collectionContextStore:e,format:t,groupFormat:o}=this.props,r=ze({collectionContextStore:e,groupsPointer:o?[o]:[]});return s()(qt.Z,{onMouseDown:re.$0,onClick:this.handleLoadMoreClick,disabled:r,hoveredStyle:r?{background:this.theme.whiteButtonBackground}:{},style:{display:"flex",alignItems:"center",height:_l+1,width:"100%",paddingLeft:Ll,paddingBottom:2,fontSize:14,lineHeight:x.Z.lineHeight.UIRegular.desktop,boxShadow:`0 -1px 0 ${this.theme.tableDividerColor}`,whiteSpace:"break-spaces"}},void 0,s()("span",{style:{display:"flex",alignItems:"center",color:this.theme.lightTextColor,position:"sticky",left:(this.props.paddingLeft||0)+Ll}},void 0,y.Z.arrowDown(this.getNewRowButtonIconStyle()),s()(P.FormattedMessage,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"}),r?s()("div",{style:{marginTop:1,marginLeft:8,marginRight:8}},void 0,s()(so.Z,{style:{width:12,height:12}})):this.canEditTable()&&s()(mo,{collectionContextStore:e,format:t})))}renderAggregationRow(){const{store:e,schema:t,query:o,disabled:r,collectionContextStore:i,blockPropertyValueOverlayStore:n,showHoverActionsStore:l,minWidth:a,paddingBottom:c,isInPeekRenderer:d,isFullScreen:h,groupFormat:p}=this.props,u=i.permissionScopes.state;return s()(vs,{store:e,groupFormat:p,disabled:r||!u.canConfigureBlock,format:this.getCurrentFormat(),schema:t,query:o,collectionContextStore:i,blockPropertyValueOverlayStore:n,isInPeekRenderer:d,isFullScreen:h,minWidth:a,paddingBottom:c,showPropertyFormatsStore:this.showPropertyFormatsStore,showRightActionsSpacer:u.canConfigureCollection,showHoverActionsStore:l,style:{...!this.isReady()&&{opacity:0,pointerEvents:"none",left:0,right:0}}})}renderAddRowButton(){var e;const{collectionContextStore:t,isInPeekRenderer:o}=this.props,r=(null===(e=t.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(o?this.theme.cardContentBackground:this.theme.contentBackground);return s()(qt.Z,{onClick:this.handleAddRowClick,onMouseDown:re.$0,style:{display:"flex",alignItems:"center",height:_l,width:"100%",paddingLeft:8,fontSize:14,lineHeight:x.Z.lineHeight.UIRegular.desktop,borderTop:`1px solid ${this.theme.tableDividerColor}`,background:r,left:0,right:0},className:q.tfM},void 0,s()("span",{style:{display:"inline-flex",alignItems:"center",position:"sticky",left:this.props.paddingLeft+8,color:this.theme.lightTextColor}},void 0,y.Z.plus(this.getNewRowButtonIconStyle()),s()(P.FormattedMessage,{defaultMessage:"New",id:"database.tableView.addRowButton"})))}getCurrentFormat(){const{format:e}=this.props,{temporaryFormat:t}=this.props.tableStore.state;return t||e}getTableProperties(){const e=this.getCurrentFormat();return e&&e.table_properties?e.table_properties:[]}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):L.navigate({environment:this.environment,url:e})}shouldShowAddRowButton(){const{collectionContextStore:e}=this.props;return Boolean(this.isReady()&&this.canEditTable()&&e.shouldAllowNewItemCreation())}isReady(){var e;return void 0!==(null===(e=this.groupStateStore.state)||void 0===e?void 0:e.reducerResultStore.state)}canEditTable(){const{collectionContextStore:e}=this.props,t=e.permissionScopes.state;return!!this.canEdit()&&(!t.isSyncedCollection&&t.canEditContent)}getNewRowButtonIconStyle(){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:this.theme.lightIconColor}}}function Dl(e){window.__c={n:"TableSelectionOverlayInner"};const t=(0,vo.O7)(),{args:o,collectionContextStore:r,collectionViewFormat:i,blockPropertyValueOverlayStore:n,isScrolled:l,groupFormat:a,propertyFormats:d,schema:h,canDrag:u,disabled:m,titleColumnIndex:g,onShiftEnter:S}=e,v=(0,c.useMemo)((()=>a?[a]:[]),[a]),y=(0,yo.VK)((()=>r.permissionScopes.state),[r.permissionScopes]),f=(0,yo.VK)((()=>Boolean(r.normalizedFormatStore.state.hide_table_vertical_lines)),[r.normalizedFormatStore]),C=(0,fo.yK)((e=>({itemSelectableHalo:{borderRadius:0,zIndex:k.I5}})),[]),b=(0,fo.Fg)(),w=(0,c.useCallback)((e=>({display:"flex",height:"calc(100% + 2px)",borderBottom:e?void 0:`1px solid ${b.tableDividerColor}`})),[b.tableDividerColor]),x=(0,c.useCallback)((e=>{const{store:o,parentStore:i,subitemPath:l,indentLevel:a}=e;if(i)return s()(Hi,{store:o,collectionStore:i,subitemPath:l,indentLevel:a,collectionContextStore:r,disabled:m,groupsPointer:v,onSubitemCreate:e=>{n&&p.default.afterNextFlush((()=>{p.default.afterNextFlush((()=>{kt.bA({isNewBlock:!0,environment:t,blockPropertyValueOverlayStore:n,store:e,property:"title",format:Ut.C.Table,collectionContextStore:r})}))}))}})}),[n,r,m,t,v]),P=(0,c.useMemo)((()=>({schema:h,collectionContextStore:r,propertyFormats:d,onPropertyTab:o.onPropertyTab,onPropertyUntab:o.onPropertyUntab,onPropertyEnter:o.onPropertyEnter,onPropertyClick:o.onPropertyClick,onPropertyEsc:o.onPropertyEsc,onPropertyBgClick:o.onPropertyBgClick,onPropertyContextMenu:o.onPropertyContextMenu,onOpenProperty:o.onOpenProperty,disabled:m,blockPropertyValueOverlayStore:n,isScrolled:l,showRightActionsSpacer:y.canConfigureCollection,disableCellBorderRight:f,disableHorizontalEdgeScroll:!1,disableLastCellBorderRight:!1,disableTableWrap:!1,onShiftEnter:S,titleColumnIndex:g,groupFormat:a})),[o.onOpenProperty,o.onPropertyBgClick,o.onPropertyClick,o.onPropertyContextMenu,o.onPropertyEnter,o.onPropertyEsc,o.onPropertyTab,o.onPropertyUntab,n,r,m,f,l,S,y.canConfigureCollection,d,h,g,a]);return s()(Ao,{collectionContextStore:r,groupsPointer:v,format:i,canDrag:u,resultProps:P,canDrop:!0,resultComponent:bl,disabled:m,direction:Do.Vertical,getItemSelectableStyle:w,itemSelectableHaloStyle:C.itemSelectableHalo,shouldShowHoverMenu:!0,analyticsName:"table",emptyDroppableSize:0,touchDragOnly:!0,onSelectableEnter:o.onSelectableEnter,blockPropertyValueOverlayStore:n,titleColumnIndex:g,nestedCreateSubitemButton:x})}Fl.contextTypes={...K.wK,...h.w};const El=(0,P.injectIntl)(Fl),Al=34,_l=32,Zl=32,Ll=8;class Ol extends Ee.Z{constructor(){super(...arguments),this.storeTypes={tableStore:Fn},this.renderGroupHeader=e=>c.createElement(Tr,i()({},e,{height:42,paddingTop:8,toggleClosedMarginBottom:8,getComputedStickyStyle:this.getGroupHeaderComputedStickyStyle})),this.handleScrollOffsetChange=e=>{const{collectionContextStore:t,isFullScreen:o}=this.props,r=t.isLoading.state,i=t.groupsStore.getGroupState([]),n=null==i?void 0:i.reducerResultStore.state;e<Se.Z.incrementScrollOffset&&n&&!r&&n.hasMore&&V.ID({collectionContextStore:t,environment:this.environment,incrementLimitArgs:{isFullScreen:o,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})},this.handleGroupHeaderAddItem=(e,t,o)=>{if(this.environment.device.isMobile)L.navigateToBlock({environment:this.environment,store:e,pageVisitSource:g.tY.Create});else{const{collectionContextStore:t}=this.props,{groupFormat:r}=o,i=r?[r]:[],n=t.groupsStore.getGroupState(i);L.peekBlock({environment:this.environment,store:e,peekMode:ee.kr(t.collectionViewStore()),resultsStore:null==n?void 0:n.resultsStore,collectionContextStore:t,pageVisitSource:g.tY.Create})}},this.viewSettingsSidebarOpen=this.createComputedStore((()=>{var e;return this.props.collectionContextStore.settingsStore.state.open&&"sidebar"===(null===(e=this.props.viewSettingsPlacementStore)||void 0===e?void 0:e.state)})),this.getGroupStyle=e=>{const{collectionContextStore:t}=this.props,o=t.viewIsFlushToTopbar();if(0===e.index&&!o)return{};return t.shouldShowSpinner.state&&"on"===Ce.default.getEligibleGroup({experimentId:"collections_loading_state",defaultGroup:"control"})&&e.index>0?{}:{borderTop:`1px solid ${this.theme.tableDividerColor}`}},this.getGroupHeaderComputedStickyStyle=e=>({boxShadow:e?`0 -1px 0 ${this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground}`:void 0})}renderPersisted(){const{store:e,paddingBottom:t,paddingLeft:o,paddingRight:r,isFullScreen:n,collectionContextStore:l,format:a}=this.props,d=ee.az(l,n),h=a.collection_group_by;return(0,We.Z)((a=>{const p=c.createElement(Ro.Z,i()({store:e,shouldShowHalo:!n,canSelect:!n,analyticsName:"table",style:{position:"relative"}},a),h?this.renderGroups(h):this.renderGroupResults(void 0));return s()("div",{style:{...Ol.style,paddingBottom:t,paddingLeft:o,paddingRight:r+(this.viewSettingsSidebarOpen.state?Rn.nJ+20:0)},className:q._so},void 0,h?p:s()(Fr,{renderEmitter:l.renderEmitter,isFullScreen:n},void 0,p),!d&&s()(_o.Z,{onChange:this.handleScrollOffsetChange}))}))}renderGroups(e){const{store:t,format:o,collectionContextStore:r,schema:i,disabled:n,isFullScreen:l,paddingLeft:a,isRootChild:c,isInPeekRenderer:d}=this.props;return s()(si,{store:t,id:"table_groups",groupBy:e,groupsFormatKey:Ae.Uh,groupAggregationKey:Ae.dQ,format:o,schema:i,collectionContextStore:r,disabled:n,isFullScreen:l,renderGroup:e=>this.renderGroupResults(e),renderHeader:this.renderGroupHeader,onGroupHeaderAddItem:this.handleGroupHeaderAddItem,paddingLeft:a,getGroupStyle:this.getGroupStyle,isRootChild:c,isInPeekRenderer:d,stickyLeft:!0})}renderGroupResults(e){const{store:t,format:o,schema:r,query:i,collectionContextStore:n,showHoverActionsStore:l,isScrolled:a,isFullScreen:c,isInPeekRenderer:d,disabled:h,blockPropertyValueOverlayStore:p,minWidth:u,paddingBottom:m,paddingLeft:g}=this.props;if(n.groupsStore.getGroupState(e?[e]:[]))return s()(El,{tableStore:this.stores.tableStore,groupFormat:e,store:t,format:o,schema:r,query:i,collectionContextStore:n,showHoverActionsStore:l,isScrolled:a,isFullScreen:c,isInPeekRenderer:d,disabled:h,blockPropertyValueOverlayStore:p,minWidth:u,paddingBottom:m,paddingLeft:g})}}Ol.displayName="Table",Ol.style={position:"relative",float:"left",minWidth:"100%",WebkitUserSelect:"none",fontVariantNumeric:"lining-nums tabular-nums"};const Gl=(0,P.injectIntl)(Ol);class Hl extends h.Z{constructor(){super(...arguments),this.interval=void 0,this.handleSeconds=()=>{0===(new Date).getSeconds()&&this.enqueueForceUpdate()}}didMount(){super.didMount(),this.interval=setInterval(this.handleSeconds,1e3)}willUnmount(){super.willUnmount(),clearInterval(this.interval)}renderComponent(){return s()("div",{style:{position:"absolute",width:"100%",height:"100%",overflow:"hidden",cursor:"default"}},void 0,this.renderWeekendIndicators(),this.renderVerticalDividers(),this.renderNowVerticalDivider())}renderWeekendIndicators(){const{timelineState:e}=this.props,t=e.zoomLevel.state,{showWeekendIndicators:o}=J.BJ[t];if(!o)return;const{startTimestamp:r,endTimestamp:i}=e.currentRange.state;let n=(0,J.DS)(fi.ou.fromMillis(r),"day");const s=[];for(;n.valueOf()<i;){6===n.weekday&&s.push(this.renderWeekendIndicator(n));n=(0,J.Ip)(n,"day")}return s}renderWeekendIndicator(e){const{timelineState:t}=this.props,o=t.zoomLevel.state,{startTimestamp:r}=t.currentRange.state,i=e.plus({day:2}).startOf("day"),n=(0,J.e$)(o,e.valueOf()-r),l=(0,J.e$)(o,i.valueOf()-r);return s()("div",{style:{position:"absolute",left:n,width:l-n,height:"100%",background:this.theme.timelineDarkerBackground}},e.valueOf())}renderVerticalDividers(){const{timelineState:e}=this.props,t=e.zoomLevel.state,{verticalDividerUnit:o}=J.BJ[t];if(!o)return;const{startTimestamp:r,endTimestamp:i}=e.currentRange.state,n=[];let s=(0,J.DS)(fi.ou.fromMillis(r),o);for(;s.valueOf()<i;){n.push(this.renderVerticalDivider(s.valueOf()));s=(0,J.Ip)(s,o)}return n}renderVerticalDivider(e){const{timelineState:t}=this.props,o=t.zoomLevel.state,{startTimestamp:r}=t.currentRange.state,i=(0,J.e$)(o,e-r);return s()("div",{style:{position:"absolute",left:i,height:"100%",borderRight:`1px solid ${this.theme.regularDividerColor}`}},e)}renderNowVerticalDivider(){const{timelineState:e}=this.props,t=e.zoomLevel.state,{startTimestamp:o}=e.currentRange.state,r=fi.ou.now().startOf("minute"),i=Math.floor((0,J.e$)(t,r.valueOf()-o));return s()("div",{style:{position:"absolute",left:i,height:"100%",borderRight:`1px solid ${this.theme.timelineRed}`}})}}Hl.displayName="TimelineBackground";const zl=Hl;class Nl extends h.Z{constructor(){super(...arguments),this.handleRemove=e=>{const{store:t,collectionContextStore:o}=this.props,{transaction:r}=e;o.collectionStore()&&V.Od({store:t,transaction:r})},this.handleDrop=e=>{const{droppedDirection:t,droppedStores:o,duplicate:r}=e,{store:i,collectionContextStore:n,collectionStore:s,resultsStore:l,groupFormat:a}=this.props,c=n.subitemTreeStore.state,d=(0,wo.DY)(c.children,(e=>e.value.store===i)),h=he.default.mark("collections.drop_item_lag");he.default.measureAfterNextFlush(h,{environment:this.environment,getData:()=>j.yr({collectionContextStore:n,is_native_drop:!1,is_empty:!1})}),N.createAndCommit({userAction:"CollectionTimelineViewDroppableRow.handleDrop",environment:this.environment,perform:e=>{V.by({environment:this.environment,collectionStore:s,targetStore:i,droppedDirection:t,collectionContextStore:n,groupsPointer:a?[a]:[],droppedStores:o,results:l.state,duplicate:r,transaction:e,subitemPath:d})}})},this.handleInsertBelow=e=>{const{insertStores:t,transaction:o}=e,{store:r,collectionContextStore:i,collectionStore:n,resultsStore:s,groupFormat:l}=this.props;return V.$T({environment:this.environment,collectionStore:n,collectionContextStore:i,groupsPointer:l?[l]:[],results:s.state,insertStores:t,store:r,before:!1,transaction:o})},this.handleInsertAbove=e=>{const{insertStores:t,transaction:o}=e,{store:r,collectionContextStore:i,collectionStore:n,resultsStore:s,groupFormat:l}=this.props;return V.$T({environment:this.environment,collectionStore:n,collectionContextStore:i,groupsPointer:l?[l]:[],results:s.state,insertStores:t,store:r,before:!0,transaction:o})},this.handleNativeDrop=e=>{const{files:t,droppedDirection:o}=e,{collectionContextStore:r,collectionStore:i,resultsStore:n,groupFormat:s}=this.props,l=r.collectionViewBlockStore(),a=he.default.mark("collections.drop_item_lag");he.default.measureAfterNextFlush(a,{environment:this.environment,getData:()=>j.yr({collectionContextStore:r,is_native_drop:!0,is_empty:!1})}),l&&N.createAndCommit({userAction:"CollectionTimelineViewDroppableRow.handleNativeDrop",environment:this.environment,perform:e=>{V.tQ({environment:this.environment,collectionStore:i,targetStore:l,droppedDirection:o,collectionContextStore:r,groupsPointer:s?[s]:[],files:t,results:n.state,transaction:e})}})}}renderComponent(){const{store:e}=this.props;return s()(Ro.Z,{store:e,style:{width:"100%",height:33},canDropBelow:!0,canNativeDropBelow:!0,shouldShowDropZone:!0,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,canInsertAbove:!0,canInsertBelow:!0,onInsertBelow:this.handleInsertBelow,onInsertAbove:this.handleInsertAbove,onSelectableDrop:this.handleDrop,onNativeDrop:this.handleNativeDrop,onRemove:this.handleRemove,analyticsName:"timeline"},e.id)}}Nl.displayName="CollectionTimelineViewDroppableRow";const Wl=Nl;class Kl extends h.Z{constructor(){super(...arguments),this.instanceStore=void 0,this.renderRowDropzoneSelectable=e=>{const{collectionContextStore:t,groupFormat:o}=this.props,r=t.collectionStore();if(!r)return;const i=t.groupsStore.getGroupState(o);return i?s()(Wl,{store:e,groupFormat:o,collectionStore:r,collectionContextStore:t,resultsStore:i.resultsStore,isLast:!1,handleOpenPeekPage:()=>{}},e.id):void 0},this.handleEmptyDroppableDrop=e=>{const{droppedDirection:t,droppedStores:o,duplicate:r}=e,{groupFormat:i,collectionContextStore:n}=this.props,s=n.collectionStore();if(!s)return;const l=n.groupsStore.getGroupState(i);if(!l)return;const a=n.collectionViewBlockStore(),c=he.default.mark("collections.drop_item_lag");he.default.measureAfterNextFlush(c,{environment:this.environment,getData:()=>j.yr({collectionContextStore:n,is_native_drop:!1,is_empty:!0})}),a&&N.createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableDrop",environment:this.environment,perform:e=>{V.by({environment:this.environment,collectionStore:s,targetStore:a,droppedDirection:t,collectionContextStore:n,groupsPointer:l.groupsPointer,droppedStores:o,results:l.resultsStore.state,duplicate:r,transaction:e})}})},this.handleEmptyDroppableNativeDrop=e=>{const{files:t,droppedDirection:o}=e,{collectionContextStore:r,groupFormat:i}=this.props,n=r.collectionStore();if(!n)return;const s=r.groupsStore.getGroupState(i);if(!s)return;const l=r.collectionViewBlockStore(),a=he.default.mark("collections.drop_item_lag");he.default.measureAfterNextFlush(a,{environment:this.environment,getData:()=>j.yr({collectionContextStore:r,is_native_drop:!0,is_empty:!0})}),l&&N.createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableNativeDrop",environment:this.environment,perform:e=>{V.tQ({environment:this.environment,collectionStore:n,targetStore:l,droppedDirection:o,collectionContextStore:r,groupsPointer:i?[i]:[],files:t,results:s.resultsStore.state,transaction:e})}})}}willMount(e){super.willMount(e),this.instanceStore=new Ve.G(this.environment,e.store.pointer)}renderComponent(){const{device:e}=this.environment,{groupFormat:t,canEdit:o,disabled:r,format:i,collectionContextStore:n}=this.props,l=n.groupsStore.getGroupState(t);if(!l)return;const a=n.permissionScopes.state,d=n.collectionStore(),h=n.collectionViewStore(),p=o&&a.canEditContent&&!a.isSyncedCollection&&e.isMobile&&!(null!=h&&h.isSyncedCollection());return c.createElement(c.Fragment,null,this.renderEmptyDroppable(),l&&d?s()(Ao,{collectionContextStore:n,groupsPointer:t?[t]:[],format:i,canDrag:p,disableRequest:!0,resultProps:{groupFormat:t,collectionStore:d,collectionContextStore:n,resultsStore:l.resultsStore,isLast:!1,handleOpenPeekPage:()=>{}},canDrop:!0,resultComponent:Wl,disabled:r,direction:Do.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,touchDragOnly:!0,disableSelectable:!0,nestedCreateSubitemButton:e=>s()("div",{style:{width:"100%",height:33}})}):l.resultsStore.state.map(this.renderRowDropzoneSelectable))}renderEmptyDroppable(){if(this.instanceStore){const{canEdit:e}=this.props;return s()(Ro.Z,{store:this.instanceStore,shouldShowDropZone:e,canDropBelow:e,canNativeDropBelow:e,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:this.handleEmptyDroppableDrop,onNativeDrop:this.handleEmptyDroppableNativeDrop,analyticsName:"timeline",style:{width:"100%"}})}}}Kl.displayName="TimelineDropzoneSelectableGroupResults";const Ul=Kl;var $l=o(42239);function ql(e){window.__c={n:"TimelineItemDependencyDrawHandle"};const{store:t,schema:o,timelineState:r,dateValueStore:n,collectionContextStore:l,isFullScreen:a,isRootChild:d}=e,h=(0,c.useRef)(null),[p,u]=(0,c.useState)(!1),m=(0,vo.O7)(),g=(0,yo.VK)((()=>{const e=r.drawState.state;if(e)return e.startStore===t}),[t,r.drawState]),S=(0,yo.VK)((()=>!g&&r.hoveredItem.state===t&&!we.Z.state),[g,t,r.hoveredItem]),v=(0,yo.VK)((()=>(0,J.H5)(l)),[l]),y=(0,c.useCallback)((e=>{if(e.preventDefault(),!r.scrollLeft.state||!h.current)return;const i=(0,le.VW)(h.current);Mn.J4({timelineState:r,store:t,startX:e.startX,startY:e.startY,schema:o,collectionContextStore:l,verticalScroller:i}),u(!1)}),[l,o,t,r]),f=(0,c.useCallback)((e=>{if(!h.current)return;const t=(0,le.VW)(h.current);Mn.mz({timelineState:r,currentX:e.currentX,currentY:e.currentY,verticalScroller:t})}),[r]),C=(0,c.useCallback)((()=>{N.createAndCommit({userAction:"TimelineItemDependencyDrawHandle.handleDraggableDragEnd",environment:m,perform:e=>{Mn.$o({timelineState:r,environment:m,transaction:e,collectionContextStore:l,isFullScreen:a,isRootChild:d})}})}),[m,r,l,a,d]),b=(0,c.useCallback)((e=>{Mn.x({timelineState:r,environment:m})}),[m,r]),w=(0,c.useCallback)((()=>{u(!0)}),[u]),x=(0,c.useCallback)((()=>{u(!1)}),[u]),k=(0,fo.yK)((e=>({draggableStyle:{position:"absolute",top:0,right:-24,width:24,height:"100%",zIndex:1},draggableSvgStyle:{position:"absolute",left:0,cursor:"pointer"},svgPathStyle:{stroke:v?e.collectionValidDependencyArrow:e.collectionUnsetDependencyArrow,strokeWidth:J.lf},svgCircleFill:{color:e.white}})),[v]),P=(0,c.useCallback)((e=>{if(!n.state)return;return c.createElement("div",i()({ref:h,style:k.draggableStyle},e),S&&c.createElement(c.Fragment,null,s()("div",{style:k.draggableSvgStyle},void 0,s()("svg",{style:{width:22,height:30},onMouseMove:w,onMouseLeave:x},void 0,s()(Gn.Z,{startPoint:{x:0,y:14},endPoint:{x:10,y:14},style:k.svgPathStyle,showArrowHead:p}),s()("circle",{cx:p?10+J.S7:10,cy:14,r:p?J.S7:J.Wk,style:k.svgPathStyle,fill:k.svgCircleFill.color})))))}),[n,x,w,S,k.draggableStyle,k.draggableSvgStyle,k.svgCircleFill.color,k.svgPathStyle,p]);return s()(bi.Z,{render:P,onDraggableDragStart:y,onDraggableDragMove:f,onDraggableDragEnd:C,onDraggableDragCancel:b})}class Ql extends h.Z{constructor(){super(...arguments),this.storeTypes={hovered:m.default.createClass(!1)},this.renderDraggableInner=e=>{const{type:t,timelineState:o,dateValueStore:r}=this.props,n="left"===t,l=r.state,a=o.zoomLevel.state,d=this.isActiveStore.state;if(l)return c.createElement("div",i()({style:n?Ql.leftDraggableStyle:Ql.rightDraggableStyle,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave},e),d&&c.createElement(c.Fragment,null,s()("div",{style:n?this.getLeftDraggableIndicatorStyle():this.getRightDraggableIndicatorStyle()}),s()("span",{style:n?this.getLeftDraggableLabelStyle():this.getRightDraggableLabelStyle()},void 0,s()("span",{style:{background:this.props.isInPeekRenderer?this.theme.peekTimelineBackground:this.theme.timelineBackground,padding:4,borderRadius:4}},void 0,n?(0,J.yk)(l,a):(0,J.fc)(l,a)))))},this.handleLeftResizerDragStart=e=>{e.preventDefault();const{type:t,store:o,timelineState:r,query:i,schema:n,intl:s}=this.props;Mn.f$({timelineState:r,store:o,startX:e.startX,type:"left"===t?J.px.LeftResizer:J.px.RightResizer,query:i,schema:n,intl:s,environment:this.environment})},this.handleDraggableDragMove=e=>{const{timelineState:t}=this.props;Mn.td({timelineState:t,currentX:e.currentX})},this.handleDraggableDragEnd=()=>{const{timelineState:e,query:t,schema:o,intl:r,collectionContextStore:i,isFullScreen:n,isRootChild:s,type:l}=this.props;N.createAndCommit({userAction:"TimelineItemResizer.handleDraggableDragEnd",environment:this.environment,perform:i=>{Mn.fX({timelineState:e,query:t,schema:o,intl:r,environment:this.environment,transaction:i})}}),T.neX(this.environment,{...(0,J.Ii)({environment:this.environment,collectionContextStore:i,timelineState:e,isFullScreen:n,isRootChild:s}),type:l})},this.handleDraggableDragCancel=e=>{const{timelineState:t}=this.props;Mn.cQ({timelineState:t,environment:this.environment})},this.handleMouseMove=()=>{this.stores.hovered.setState(!0)},this.handleMouseLeave=()=>{this.stores.hovered.setState(!1)},this.isActiveStore=this.createComputedStore((()=>{const{store:e,type:t,timelineState:o}=this.props,r=this.stores.hovered.state,i=o.dragState.state;return i?i.stores[0]===e&&("left"===t?i.type===J.px.LeftResizer:i.type===J.px.RightResizer):r&&!we.Z.state}))}renderComponent(){return s()(bi.Z,{render:this.renderDraggableInner,onDraggableDragStart:this.handleLeftResizerDragStart,onDraggableDragMove:this.handleDraggableDragMove,onDraggableDragEnd:this.handleDraggableDragEnd,onDraggableDragCancel:this.handleDraggableDragCancel})}getLeftDraggableIndicatorStyle(){return{position:"absolute",left:Math.ceil(3.5)+1,top:6,borderRadius:3,width:3,bottom:6,background:this.theme.regularTextColor}}getRightDraggableIndicatorStyle(){return{position:"absolute",left:Math.floor(.5),top:6,borderRadius:3,width:3,bottom:6,background:this.theme.regularTextColor}}getLeftDraggableLabelStyle(){return{fontSize:12,position:"absolute",right:12,textAlign:"right",width:200,lineHeight:"32px",pointerEvents:"none"}}getRightDraggableLabelStyle(){return{fontSize:12,position:"absolute",left:12,width:200,lineHeight:"32px",pointerEvents:"none"}}}Ql.displayName="TimelineItemResizer",Ql.leftDraggableStyle={position:"absolute",top:0,left:-6,width:8,height:"100%",zIndex:1,cursor:"col-resize"},Ql.rightDraggableStyle={position:"absolute",top:0,right:-6,width:8,height:"100%",zIndex:1,cursor:"col-resize"};const Yl=Ql,jl=(0,P.defineMessages)({typeAName:{defaultMessage:"Type a name…",id:"timelineItem.itemName.placeholder"}});var Xl=function(e){return e[e.Absolute=0]="Absolute",e[e.Sticky=1]="Sticky",e}(Xl||{});class Jl extends h.Z{constructor(){super(...arguments),this.propertiesWrapEl=c.createRef(),this.renderProperty=(e,t)=>{const{showProperties:o,store:r,disabled:i,blockPropertyValueOverlayStore:n,clonedStore:l}=this.props,a=t===o.length-1,c=null==r?void 0:r.getAssociatedCollectionStore();if(c){if("title"===e)return this.renderTitle(a);if(r&&l)return s()(Kt.Z,{store:l,property:e,disabled:i||!r.canEdit(),locked:!1,format:Ut.C.Timeline,tableWrap:!1,isLast:a,blockPropertyValueOverlayStore:n,enablePointerEventsForInteractiveTypes:!0,collectionStore:c,collectionViewStore:this.props.collectionContextStore.collectionViewStore()},e)}},this.handleSelectableDragStart=e=>{e.preventDefault()},this.handleSelectableDragMove=e=>{const{store:t,timelineState:o,query:r,schema:i,intl:n}=this.props;t&&(o.dragState.state||Mn.f$({timelineState:o,store:t,startX:e.startX,type:J.px.ItemDrag,query:r,schema:i,intl:n,environment:this.environment}),Mn.td({timelineState:o,currentX:e.currentX}))},this.handleSelectableDragEnd=()=>{const{timelineState:e,query:t,schema:o,intl:r}=this.props;N.createAndCommit({userAction:"TimelineItemDateRange.handleSelectableDragEnd",environment:this.environment,perform:i=>{Mn.fX({timelineState:e,query:t,schema:o,intl:r,environment:this.environment,transaction:i})}})},this.handleSelectableDragCancel=()=>{const{timelineState:e}=this.props;Mn.cQ({timelineState:e,environment:this.environment})},this.handleDateRangeButtonMouseMove=()=>{const{store:e,timelineState:t}=this.props,o=t.dragState.state;(we.Z.state||o)&&!this.isDrawingDependencyStore.state||this.environment.device.isPhone||t.hoveredItem.setState(e)},this.handleDateRangeButtonMouseLeave=()=>{const{timelineState:e}=this.props,t=e.dragState.state;(we.Z.state||t)&&!this.isDrawingDependencyStore.state||e.hoveredItem.setState(void 0)},this.handleGetGhostElement=e=>{const t=gi.C.findSelectablesFromStore(e),o=a().compact(t.map((e=>e.getNode()))),r=a().compact(o.map((e=>e.closest(`.${q.o4s}`))))[0];if(r){const e=$l.eN(r),t=e.cloned.querySelector(`.${q.ovr}`),o=e.cloned.querySelector(`.${q.z_z}`);return t&&o&&"sticky"===o.style.position&&(o.style.position="absolute",o.style.left=t.style.left),[e]}return o.map($l.eN)},this.handleTextEnterOrEsc=()=>{const{store:e}=this.props;e&&H.Ys({environment:this.environment,store:e})},this.handleAnimationStateChange=()=>{const{current:e}=this.propertiesWrapEl,t=this.animationStateStore.state;e&&t&&(e.style.position=t.position===Xl.Absolute?"absolute":"sticky",e.style.left=`${t.left}px`)},this.pageURLStore=this.createComputedStore((()=>{const{store:e}=this.props;if(e)return(0,oe.ZP)({store:e,fullyQualified:!1,pageVisitSource:g.tY.LinkInPage})})),this.peekURLStore=this.createComputedStore((()=>{const{store:e,collectionContextStore:t}=this.props,{mainEditorCurrentBlockStore:o}=ue.default.state;if(e&&o)return ee.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})})),this.isHoveredStore=this.createComputedStore((()=>{const{store:e,timelineState:t}=this.props;return t.hoveredItem.state===e})),this.isDrawingDependencyStore=this.createComputedStore((()=>{const{store:e,timelineState:t}=this.props,o=t.drawState.state;return o&&o.startStore!==e})),this.editingTitleStore=this.createComputedStore((()=>{var e;const{store:t}=this.props,o=Ft.default.state;if("editing"!==o.mode)return!1;const r=null===(e=(0,Rt.QY)(o.multiSelection))||void 0===e?void 0:e.store;return t&&r&&r===t.getBlockTitleStore()})),this.animationStateStore=this.createComputedStore((()=>{const{timelineState:e,scrollerLeftOffset:t,itemPositionStore:o}=this.props,r=o.state;if(r){const{left:o,right:i}=r,n=i-o;if(!(this.canPerformantlyUpdateOnScroll()&&n>50))return{position:Xl.Absolute,left:o};{const r=e.scrollLeft.state;if(void 0!==r){const e=r+t-o+21;if(e<0)return{position:Xl.Absolute,left:o};if(e>n)return{position:Xl.Absolute,left:i};if(e>0)return{position:Xl.Sticky,left:t+21}}}}})),this.passesFilterStore=this.createComputedStore((()=>{var e,t;const o=(0,Q.m1)({collectionContextStore:this.props.collectionContextStore,environment:this.environment}),r=null===(e=this.props.store)||void 0===e?void 0:e.getModel(),i=null===(t=this.props.store)||void 0===t?void 0:t.getRecordModel;if(!o||!r||!i)return!0;return(0,Co.q)(o)({block:r,getRecordModel:i,propertyMapping:void 0})})),this.shouldShowHighlightHalo=this.createComputedStore((()=>!!this.props.store&&ee.Sc(this.props.store)))}didMount(){super.didMount(),this.animationStateStore.addListener(this.handleAnimationStateChange),this.handleAnimationStateChange()}willUnmount(){super.willUnmount(),this.animationStateStore.removeListener(this.handleAnimationStateChange)}willUpdate(){this.animationStateStore.enqueueRecompute()}renderComponent(){const{itemPositionStore:e,store:t,timelineState:o,query:r,schema:i,dateValueStore:n,disabled:l,isDraggingViaTimelineItemStore:a,collectionContextStore:d,isFullScreen:h,isRootChild:p,intl:u}=this.props,m=e.state;if(!m)return;const g=(0,J.H5)(d),{left:S,right:v,maskPercent:y}=m,f=this.isHoveredStore.state,C=this.pageURLStore.state,b=this.peekURLStore.state,w=!l&&(null==t?void 0:t.canEdit()),x=this.environment.device.isPhone,k=w&&!x&&(g||d.permissionScopes.state.canConfigureBlock),P=d.currentSubitemFormatStore.state?42:10,T=Math.max(v-S,P)+1,R=a.state,I=this.renderToggleButton(),M=this.passesFilterStore.state;return t&&!m.isPlaceholder?c.createElement(c.Fragment,null,s()(Ro.Z,{style:this.getStyle(S,T,R,m,M),haloStyle:this.getHaloStyle(),className:q.ovr,store:t,canSelect:!0,shouldShowHalo:!0,shouldForceRenderSelectionHalo:this.shouldShowHighlightHalo.state,canDrag:w,analyticsName:"timeline",onDraggableDragStart:this.handleSelectableDragStart,onDraggableDragMove:this.handleSelectableDragMove,onDraggableDragEnd:this.handleSelectableDragEnd,onDraggableDragCancel:this.handleSelectableDragCancel,canTriggerContextMenu:w,getGhostElement:this.handleGetGhostElement,disableScrollToReveal:!0,onMouseMove:this.handleDateRangeButtonMouseMove,onMouseLeave:this.handleDateRangeButtonMouseLeave,showBlockMenuInput:!0},void 0,I,s()(Yt.Z,{style:this.getLinkBoxStyle(),innerStyle:this.getLinkBoxInnerStyle(),onClick:this.props.handleOpenPeekPage,href:C,metaHref:b,hovered:f,ignoreLocalHoverState:!0}),k&&this.renderTimelineItemDependencyDrawHandle(),w&&!x&&s()(Yl,{type:"left",store:t,query:r,schema:i,timelineState:o,dateValueStore:n,collectionContextStore:d,isFullScreen:h,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:p,intl:u,resultStore:this.props.resultStore}),w&&!x&&s()(Yl,{type:"right",store:t,query:r,schema:i,timelineState:o,dateValueStore:n,collectionContextStore:d,isFullScreen:h,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:p,intl:u,resultStore:this.props.resultStore})),this.renderProperties(y,R,M)):c.createElement(c.Fragment,null,s()("div",{style:this.getStyle(S,T,R,m,M),className:q.ovr}),this.renderProperties(y,R,M))}renderToggleButton(){const{collectionContextStore:e,toggleButton:t,itemPositionStore:o}=this.props,r=e.currentSubitemFormatStore.state,i=o.state;if(r&&t&&(null==i||!i.isExistingSubitemPlaceholder))return s()("span",{style:{zIndex:1,paddingTop:3}},void 0,t)}renderTimelineItemDependencyDrawHandle(){const{store:e,isFullScreen:t,isRootChild:o}=this.props;if(e)return s()(ql,{store:e,schema:this.props.schema,timelineState:this.props.timelineState,dateValueStore:this.props.dateValueStore,collectionContextStore:this.props.collectionContextStore,isFullScreen:t,isRootChild:o})}renderProperties(e,t,o){const{showProperties:r}=this.props;return s()("div",{style:this.getPropertiesWrapStyle(e,t,o)},void 0,c.createElement("div",{style:this.getPropertiesWrapInnerStyle(),ref:this.propertiesWrapEl,className:q.z_z},r.map(this.renderProperty)))}renderTitle(e){var t;const{store:o}=this.props,r=o?o.getIcon():void 0,i=null==o?void 0:o.hasError(),n=!o||o.isEmptyPage(),l=this.editingTitleStore.state,{parentStore:c,collectionContextStore:d}=this.props,h=d.currentSubitemFormatStore.state,p=h&&c?null===(t=c.getSchema()[h.property])||void 0===t?void 0:t.name:"";return s()("div",{style:{display:"flex",marginRight:e?0:10,fontSize:14,fontWeight:x.Z.fontWeight.medium,alignItems:"center"}},"title",r&&!i&&s()(jt.Z,{disabled:!0,icon:r,isEmptyPage:n,size:20,style:{marginLeft:2,marginRight:6}}),i&&y.Z.warning({display:"inline-block",verticalAlign:"text-top",marginLeft:4,marginRight:7,width:16,fill:this.theme.accentColors.orange[500]}),o&&!l&&s()(wi.Z,{style:{whiteSpace:"nowrap",maxWidth:400},store:o}),l&&o&&s()(Jt.Z,{store:o.getBlockTitleStore(),style:{whiteSpace:this.environment.device.isFirefox?"pre":"nowrap"},disabled:!1,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableEmbedMenu:!0,onEnter:this.handleTextEnterOrEsc,onEsc:this.handleTextEnterOrEsc,onTab:a().identity,placeholder:ie.default.formatMessage(jl.typeAName),disableSelectAllBlocks:!0,pasteBehavior:"inline"}),!o&&s()("span",{},void 0,s()(P.FormattedMessage,c&&p?{defaultMessage:"New page in {propertyName}",id:"timeline.itemPlaceholder.nest.addSubitemWithPropertyName",values:{propertyName:p}}:{id:"timeline.itemPlaceholder.newPage",defaultMessage:"New page"})))}canPerformantlyUpdateOnScroll(){return(0,J.Tp)(this.environment)}getStyle(e,t,o,r,i){const n=this.theme.mode;return{position:"absolute",left:e,marginTop:1,marginBottom:1,width:t,height:30,borderRadius:4,display:"flex",...r.isExistingSubitemPlaceholder?void 0:{..."light"===n?{background:r.isPlaceholder?this.theme.buttonHoveredBackground:this.theme.contentBackground,boxShadow:r.isPlaceholder?void 0:this.theme.buttonBoxShadow}:{background:this.props.isInPeekRenderer?this.theme.calendarItemBackground:this.theme.popoverBackground,boxShadow:r.isPlaceholder?void 0:this.theme.lightBoxShadow}},...r.isPlaceholder&&{cursor:"crosshair"},...o&&{display:"none"},...!i&&{opacity:.5},zIndex:k.ov}}getPropertiesWrapStyle(e,t,o){return{width:"100%",WebkitMaskImage:e<1&&this.isHoveredStore.state?`linear-gradient(90deg, rgba(0,0,0,1) ${100*e}%, rgba(0,0,0,0.4) ${100*e}%)`:void 0,pointerEvents:"none",...t&&{display:"none"},zIndex:k.ov,opacity:o?1:.5}}getPropertiesWrapInnerStyle(){const{collectionContextStore:e,toggleButton:t}=this.props;return{display:"flex",height:31,paddingLeft:e.currentSubitemFormatStore.state&&t?24:6,width:800,overflow:"hidden"}}getHaloStyle(){return{borderRadius:4,...ee.pB(this.shouldShowHighlightHalo.state,this.theme)}}getLinkBoxStyle(){return{width:"100%",height:"100%",borderRadius:4}}getLinkBoxInnerStyle(){return{width:"100%",height:"100%",display:"flex",paddingLeft:6,paddingRight:6,borderRadius:4}}}Jl.displayName="TimelineItemDateRange";const ea=Jl;var ta=function(e){return e[e.Hidden=0]="Hidden",e[e.VisibleInItem=1]="VisibleInItem",e[e.VisibleOutOfItem=2]="VisibleOutOfItem",e[e.NotDefined=3]="NotDefined",e}(ta||{});class oa extends h.Z{constructor(){super(...arguments),this.lastVisibilityState=ta.NotDefined,this.buttonRef=c.createRef(),this.wrapRef=c.createRef(),this.arrowButtonHovered=m.default.createValue(!1),this.handleIsVisibleChange=()=>{const e=this.buttonRef.current,t=this.wrapRef.current;if(e&&t){const o=this.isVisibleStore.state,r=o===ta.VisibleInItem||o===ta.VisibleOutOfItem;e.style.opacity=""+(r?1:0),e.style.transform=`scale(${r?1:.3})`,t.style.pointerEvents=o===ta.VisibleOutOfItem?"":"none";this.lastVisibilityState!==ta.NotDefined&&o!==ta.NotDefined&&!e.style.transition&&(e.style.transition="transform 160ms ease-in-out, opacity 160ms ease-in-out"),this.lastVisibilityState=o}},this.handleClick=()=>{const{store:e,type:t,timelineState:o,dateValueStore:r,paddingLeft:i,format:n,collectionContextStore:s,isFullScreen:l,isRootChild:a}=this.props,c=r.state,d=o.zoomLevel.state,{snapUnit:h}=J.BJ[d],p=(0,J.x2)(d,200);if(c)if("left"===t){const{start:e}=(0,J.XO)(c,h),t=(0,J.GK)({timestamp:e.valueOf(),environment:this.environment,timelineState:o,paddingLeft:i,format:n})-p;Mn.Nf({timelineState:o,environment:this.environment,zoomLevel:d,centerTimestamp:t})}else{const{end:e}=(0,J.XO)(c,h),t=(0,J.PF)({timestamp:e.valueOf(),timelineState:o})+p;Mn.Nf({timelineState:o,environment:this.environment,zoomLevel:d,centerTimestamp:t})}this.arrowButtonHovered.setState(!1),H.Ys({environment:this.environment,store:e}),T.gw_(this.environment,{...(0,J.Ii)({environment:this.environment,collectionContextStore:s,timelineState:o,isFullScreen:l,isRootChild:a}),type:t})},this.handleMouseOver=()=>{this.environment.device.isPhone||we.Z.state||this.arrowButtonHovered.setState(!0)},this.handleMouseOut=()=>{this.environment.device.isPhone||this.arrowButtonHovered.setState(!1)},this.isVisibleStore=this.createComputedStore((()=>{const{type:e,timelineState:t,scrollerLeftOffset:o,itemPositionStore:r,isDraggingViaTimelineItemStore:i}=this.props,n=r.state;if(n){const{left:r,right:s}=n;if(i.state)return ta.Hidden;const l=t.scrollLeft.state;if(void 0!==l){if("left"===e){const e=l+o;if(e-s>0)return ta.VisibleOutOfItem;if(e-r>0)return ta.VisibleInItem}else{const{outerSizeObserver:e}=t,o=l+e.rect.state.width;if(r-o>0)return ta.VisibleOutOfItem;if(s-o>0)return ta.VisibleInItem}return ta.Hidden}}return ta.NotDefined}))}didMount(){super.didMount(),this.isVisibleStore.addListener(this.handleIsVisibleChange),this.handleIsVisibleChange()}willUnmount(){super.willUnmount(),this.isVisibleStore.removeListener(this.handleIsVisibleChange)}willUpdate(){this.isVisibleStore.enqueueRecompute()}renderComponent(){const{type:e}=this.props,t=this.arrowButtonHovered.state,o="left"===e?y.Z.collectionTimelineArrowLeft:y.Z.collectionTimelineArrowRight;return c.createElement("div",{style:this.getWrapStyle(),onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onMouseDown:re.$0,onClick:this.handleClick,ref:this.wrapRef},c.createElement("div",{style:this.getArrowStyle(),ref:this.buttonRef},o({height:6,fill:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground})),t&&this.renderDateRange())}renderDateRange(){const{dateValueStore:e,timelineState:t}=this.props,o=e.state;if(!o)return;const r=t.zoomLevel.state;return s()("span",{style:this.getDateRangeStyle()},void 0,(0,J._Q)(o,r))}getWrapStyle(){const{type:e,scrollerLeftOffset:t,timelineState:o}=this.props,{outerSizeObserver:r}=o;return{position:"sticky",left:"left"===e?t:r.rect.state.width-220,width:220,height:Al-6,marginTop:2,display:"flex",alignItems:"center",cursor:"pointer",flexDirection:"right"===e?"row-reverse":void 0,whiteSpace:"nowrap",textOverflow:"ellipsis",zIndex:k.fQ}}getArrowStyle(){const{type:e}=this.props;return{display:"flex",alignItems:"center",width:16,height:16,flexShrink:0,pointerEvents:"auto",background:this.arrowButtonHovered.state?this.theme.regularIconColor:this.theme.mediumIconColor,borderRadius:3,border:`1px solid ${this.theme.contentBackground}`,..."left"===e&&{marginLeft:8,marginRight:4},..."right"===e&&{marginRight:8,marginLeft:4}}}getDateRangeStyle(){return{fontSize:12,paddingLeft:4,paddingRight:4,borderRadius:4,background:this.props.isInPeekRenderer?this.theme.peekTimelineBackground:this.theme.timelineBackground,pointerEvents:"none"}}}oa.displayName="TimelineScrollArrow";const ra=oa;class ia extends h.Z{constructor(){super(...arguments),this.clonedStore=void 0,this.dateRangeRef=c.createRef(),this.storeTypes={node:m.default.createClass(null)},this.handleEditorMouseDown=e=>{this.environment.device.isMobile||(0,re.ZP)({event:e,context:re.Af.EditorMouseDown,callback:()=>{e.preventDefault(),Z.AI({environment:this.environment,target:e.target,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})},this.handleMouseMove=e=>{const{timelineState:t,store:o,groupFormat:r,disabled:i,query:n,schema:s}=this.props,l=t.dragState.state,a=t.drawState.state,{horizontalScroller:c}=t,d=t.scrollLeft.state,h=t.zoomLevel.state,p=t.currentRange.state,{snapUnit:u,getDateRangePlaceholderDuration:m}=J.BJ[h];if(!a&&we.Z.state||l||this.getPersistedDateValue()||!c||void 0===d||i)return;const g=c.getBoundingClientRect(),S=d+(e.clientX-g.left),v=(0,J.x2)(h,S),y=fi.ou.fromMillis(p.startTimestamp+v),f=(0,J.DS)(y,u),C=(0,J.DS)(m(y),u),b=(0,ui.hT)(f.valueOf(),(0,je.r)()),w=(0,J.AZ)({startValue:b,snapUnit:u,desiredStart:f,desiredEnd:C});t.dateRangePlaceholder.setState({active:!0,store:o,parentStore:this.parentCollectionStore.state,groupFormat:r,date:w,newTimelineItemProps:void 0,existingTimelineItemProps:{query:n,schema:s}})},this.handleMouseLeave=()=>{const{timelineState:e}=this.props;e.dateRangePlaceholder.setState({active:!1})},this.handleClick=e=>{const{store:t,query:o,schema:r,timelineState:i,groupFormat:n,collectionContextStore:s}=this.props,l=i.dateRangePlaceholder.state,a=s.groupsStore.getGroupState(n);if(a)if(l.active){const{date:e}=l;N.createAndCommit({userAction:"CollectionTimelineViewItem.handleClick",environment:this.environment,perform:i=>{Mn.oP({environment:this.environment,store:t,query:o,schema:r,date:e,transaction:i})}}),i.dateRangePlaceholder.setState({active:!1})}else{const{timelineState:o,collectionContextStore:r}=this.props,{horizontalScroller:i}=o,n=o.scrollLeft.state,s=this.itemPositionStore.state,l=this.dateRangeRef.current;if(!i||void 0===n||!s||!l)return;const c=i.getBoundingClientRect(),d=n+(e.clientX-c.left),h=l.propertiesWrapEl.current;if(!h)return;const p=h.lastElementChild;if(!p)return;const u=n+(p.getBoundingClientRect().right-c.left);d>s.right&&d<=u&&(0,re.ZP)({event,context:re.Af.EditorClick,callback:()=>{(0,se.X9)()||L.peekBlock({environment:this.environment,store:t,openInNew:te.DJ(e),peekMode:(0,ee.kr)(r.collectionViewStore()),resultsStore:a.resultsStore,collectionContextStore:r,pageVisitSource:g.tY.PeekOpen})}})}},this.onRefChange=e=>{this.stores.node.setState(e)},this.itemPositionStore=this.createComputedStore((()=>{const{timelineState:e}=this.props;return(0,J.HZ)({timelineState:e,dateValue:this.dateValueStore.state,placeholderDate:this.placeholderDateStore.state,subitemPlaceholderDate:this.subitemPlaceholderDateStore.state})})),this.shouldRenderDateRangeStore=this.createComputedStore((()=>{const e=this.itemPositionStore.state;return Boolean(e)})),this.shouldRenderScrollArrowsStore=this.createComputedStore((()=>{const e=this.itemPositionStore.state;return Boolean(e&&!e.isPlaceholder)})),this.subitemPlaceholderDateStore=this.createComputedStore((()=>{const{subitemPath:e}=this.props,t=(0,wo.ub)(e);if(!t||Boolean(this.dateValueStore.state))return;const o=t.value.store,r=Zn.findCollectionTimelineViewItems(o);if(r.length>0){return r[0].dateValueStore.state}})),this.placeholderDateStore=this.createComputedStore((()=>{const{store:e,timelineState:t,groupFormat:o}=this.props,r=t.dateRangePlaceholder.state;if(r.active&&r.store===e&&!r.newTimelineItemProps&&(0,Ae.ZH)(r.groupFormat,o))return r.date})),this.dateValueStore=this.createComputedStore((()=>{const{store:e,timelineState:t}=this.props,o=t.dragState.state,r=this.placeholderDateStore.state;if(r)return r;if(o){const t=o.stores.indexOf(e);if(t>=0)return o.temporaryValues[t]}return this.getPersistedDateValue()}),!0),this.isDraggingViaTimelineItemStore=this.createComputedStore((()=>{const{store:e,timelineState:t}=this.props,o=t.dragState.state,r=On.ZP.state;return Boolean(o&&o.stores.includes(e)&&r.isDragging&&r.draggedStores.includes(e))})),this.parentCollectionStore=this.createComputedStore((()=>this.props.store.getAssociatedCollectionStore()))}get registries(){return[Zn]}willMount(e){super.willMount(e),this.clonedStore=e.store.clone()}renderComponent(){var e;const{store:t,timelineState:o,scrollerLeftOffset:r,paddingLeft:i,format:n,query:l,schema:a,blockPropertyValueOverlayStore:d,disabled:h,showProperties:p,showTable:u,collectionContextStore:m,isFullScreen:g,isRootChild:S,toggleButton:v,groupFormat:y}=this.props,f=this.shouldRenderDateRangeStore.state,C=this.shouldRenderScrollArrowsStore.state,b=Boolean(this.placeholderDateStore.state)||Boolean(this.subitemPlaceholderDateStore.state),w=null===(e=m.groupsStore.getGroupState(y))||void 0===e?void 0:e.reducerResultStore;if(w)return c.createElement(c.Fragment,null,s()("div",{style:{display:"flex",height:0}},void 0,C&&s()(ra,{store:t,type:"left",timelineState:o,scrollerLeftOffset:r,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,paddingLeft:i,format:n,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:m,isFullScreen:g,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:S,resultStore:w}),C&&s()(ra,{store:t,type:"right",timelineState:o,scrollerLeftOffset:r,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,paddingLeft:i,format:n,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:m,isInPeekRenderer:this.props.isInPeekRenderer,isFullScreen:g,isRootChild:S,resultStore:w})),c.createElement("div",{style:this.getStyle(b,u),onMouseDown:this.handleEditorMouseDown,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onClick:this.handleClick,className:q.o4s,ref:this.onRefChange},f&&c.createElement(ea,{store:t,parentStore:this.parentCollectionStore.state,toggleButton:v,clonedStore:this.clonedStore,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,query:l,schema:a,timelineState:o,blockPropertyValueOverlayStore:d,disabled:h,showProperties:p,scrollerLeftOffset:r,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:m,isFullScreen:g,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:S,intl:ie.default.getIntl(),ref:this.dateRangeRef,resultStore:w,handleOpenPeekPage:this.props.handleOpenPeekPage})))}getPersistedDateValue(){const{store:e,query:t,schema:o}=this.props;return(0,J.bk)({store:e,query:t,schema:o,userId:this.environment.currentUser.id,intl:ie.default.getIntl()})}getStyle(e,t){return{display:"flex",height:Dn+(e?2:1),width:"100%",...e&&{borderTop:`1px solid ${this.theme.regularDividerColor}`,marginBottom:-1},...e&&!t&&{borderBottom:`1px solid ${this.theme.regularDividerColor}`},cursor:"default"}}}ia.displayName="CollectionTimelineViewItem";const na=ia;class sa extends h.Z{constructor(){super(...arguments),this.clonedStore=void 0,this.handleEditorMouseDown=e=>{this.environment.device.isMobile||(0,re.ZP)({event:e,context:re.Af.EditorMouseDown,callback:()=>{e.preventDefault(),Z.AI({environment:this.environment,target:e.target,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})},this.handleMouseMove=e=>{var t;const{timelineState:o,store:r,parentStore:i,groupFormat:n,disabled:s,query:l,schema:a,isFullScreen:c,canEditTimelineItems:d,subitemPath:h,collectionContextStore:p}=this.props,u=o.drawState.state,m=o.dragState.state,{horizontalScroller:g}=o,S=o.scrollLeft.state,v=o.zoomLevel.state,y=o.currentRange.state,{snapUnit:f,getDateRangePlaceholderDuration:C}=J.BJ[v];if(!u&&we.Z.state||m||!g||void 0===S||s)return;const b=null===(t=p.groupsStore.getGroupState(n))||void 0===t?void 0:t.resultsStore;if(!b)return;const w=g.getBoundingClientRect(),x=S+(e.clientX-w.left),k=(0,J.x2)(v,x),P=fi.ou.fromMillis(y.startTimestamp+k),T=(0,J.DS)(P,f),R=(0,J.DS)(C(P),f),I=(0,ui.hT)(T.valueOf(),(0,je.r)()),M=(0,J.AZ)({startValue:I,snapUnit:f,desiredStart:T,desiredEnd:R});o.dateRangePlaceholder.setState({active:!0,store:r,parentStore:i,groupFormat:n,date:M,newTimelineItemProps:{query:l,schema:a,resultsStore:b,isFullScreen:c,canEditTimelineItems:d,subitemPath:h},existingTimelineItemProps:void 0})},this.handleMouseLeave=()=>{const{timelineState:e}=this.props;e.dateRangePlaceholder.setState({active:!1})},this.handleClick=e=>{var t;const{parentStore:o,query:r,schema:i,timelineState:n,isFullScreen:s,groupFormat:l,canEditTimelineItems:a,collectionContextStore:c,subitemPath:d}=this.props,h=n.dateRangePlaceholder.state,p=null===(t=c.groupsStore.getGroupState(l))||void 0===t?void 0:t.resultsStore;if(p&&h.active){const{date:e}=h,t=d?"timeline_add_parent_item_bottom":"timeline_add_item_bottom";N.createAndCommit({userAction:"CollectionTimelineViewItem.handleClick",environment:this.environment,perform:n=>{Mn.mg({environment:this.environment,transaction:n,date:e,store:this.props.store,parentStore:o,query:r,schema:i,resultsStore:p,isFullScreen:s,groupFormat:l,canEditTimelineItems:a,collectionContextStore:c,subitemPath:d,from:t}),T.W2j(this.environment,{from:t,type:"page",...(0,j.Pn)(c)})}}),n.dateRangePlaceholder.setState({active:!1})}},this.itemPositionStore=this.createComputedStore((()=>{const{timelineState:e}=this.props;return(0,J.HZ)({timelineState:e,dateValue:this.dateValueStore.state,placeholderDate:this.placeholderDateStore.state,subitemPlaceholderDate:void 0})})),this.shouldRenderDateRangeStore=this.createComputedStore((()=>{const e=this.itemPositionStore.state;return Boolean(e)})),this.isDraggingViaTimelineItemStore=this.createComputedStore((()=>!1)),this.placeholderDateStore=this.createComputedStore((()=>{const{store:e,parentStore:t,timelineState:o,groupFormat:r}=this.props,i=o.dateRangePlaceholder.state;if(i.active&&i.store===e&&i.newTimelineItemProps&&i.parentStore===t&&(0,Ae.ZH)(i.groupFormat,r))return i.date})),this.dateValueStore=this.createComputedStore((()=>{const e=this.placeholderDateStore.state;if(e)return e}),!0)}willMount(e){super.willMount(e),e.store&&(this.clonedStore=e.store.clone())}renderComponent(){var e;const{store:t,parentStore:o,timelineState:r,scrollerLeftOffset:i,query:n,schema:l,blockPropertyValueOverlayStore:a,disabled:d,showProperties:h,showTable:p,collectionContextStore:u,isFullScreen:m,isRootChild:g,toggleButton:S,groupFormat:v}=this.props,y=Boolean(this.placeholderDateStore.state),f=this.shouldRenderDateRangeStore.state,C=null===(e=u.groupsStore.getGroupState(v))||void 0===e?void 0:e.reducerResultStore,b=!t&&!f&&u.shouldAllowNewItemCreation();if(C)return c.createElement(c.Fragment,null,s()("div",{style:this.getStyle(y,p),onMouseDown:this.handleEditorMouseDown,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onClick:this.handleClick,className:q.o4s},void 0,f&&s()(ea,{store:o?void 0:t,parentStore:o,toggleButton:S,clonedStore:this.clonedStore,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,query:n,schema:l,timelineState:r,blockPropertyValueOverlayStore:a,disabled:d,showProperties:h,scrollerLeftOffset:i,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:u,isFullScreen:m,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:g,intl:ie.default.getIntl(),resultStore:C,handleOpenPeekPage:()=>{}}),b&&this.renderAddRowIndicator()))}renderAddRowIndicator(){var e;const{parentStore:t,collectionContextStore:o}=this.props,r=o.currentSubitemFormatStore.state,i=r&&t?null===(e=t.getSchema()[r.property])||void 0===e?void 0:e.name:"";return s()("div",{style:this.getAddRowIndicatorWrapStyle()},void 0,s()("div",{style:this.getAddRowIndicatorStyle()},void 0,y.Z.plus(this.getNewRowIndicatorIconStyle()),s()("span",{style:{color:this.theme.mediumTextColor}},void 0,s()(P.FormattedMessage,t&&i?{defaultMessage:"New page in {propertyName}",id:"database.timelineView.nest.addSubitemWithPropertyName",values:{propertyName:i}}:{defaultMessage:"New",id:"database.timelineView.item.addRowButton"}))))}getStyle(e,t){let o=e?2:1;return this.props.parentStore&&(o=e?1:0),{display:"flex",height:Dn+o,width:"100%",...e&&{borderTop:`1px solid ${this.theme.regularDividerColor}`,marginBottom:-1},...e&&!t&&{borderBottom:`1px solid ${this.theme.regularDividerColor}`},cursor:"default"}}getNewRowIndicatorIconStyle(){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:this.theme.mediumIconColor}}getAddRowIndicatorWrapStyle(){const{paddingLeft:e,isFullScreen:t,showTable:o}=this.props;return{position:"sticky",left:t&&!o?e+8:8,display:"flex",alignItems:"center"}}getAddRowIndicatorStyle(){return{display:"flex",alignItems:"center",paddingBottom:2,fontSize:14,height:_l,lineHeight:x.Z.lineHeight.UIRegular.desktop}}}sa.displayName="CollectionTimelineViewItemNew";const la=sa;class aa extends h.Z{constructor(){super(...arguments),this.renderTimelineItem=e=>{const{timelineState:t,disabled:o,query:r,format:i,schema:n,collectionContextStore:l,blockPropertyValueOverlayStore:a,isFullScreen:c,isRootChild:d,groupFormat:h,paddingLeft:p,showTimelinePropertiesStore:u,scrollerLeftOffsetStore:m,showTable:g,canEditTimelineItems:S,isInPeekRenderer:v}=this.props;if(!l.groupsStore.getGroupState(h))return;const y=l.permissionScopes.state,f="collectionTypedView"===l.contextType||y.canEditContent;return s()(na,{store:e,disabled:o||!f,timelineState:t,schema:n,query:r,format:i,scrollerLeftOffset:m.state,paddingLeft:p,showProperties:u.state,blockPropertyValueOverlayStore:a,collectionContextStore:l,isFullScreen:c,showTable:g,isRootChild:d,groupFormat:h,canEditTimelineItems:S,isInPeekRenderer:v,handleOpenPeekPage:this.handleOpenPeekPage,isLast:!1},e.id)},this.handleOpenPeekPage=()=>{const{collectionContextStore:e,groupFormat:t}=this.props,o=e.groupsStore.getGroupState(t);if(!o)return;he.default.mark("collections.open_item_page_lag");const r=e.collectionViewStore();_.Xd({collectionContextStore:e,resultsStore:o.resultsStore});const i=null==r?void 0:r.getFormat().collection_peek_mode,n=i||To.Ls.timeline;T.hym(this.environment,{is_peek:!0,from:"timeline",peek_mode:n})},this.resultsReducerStore=this.createComputedStore((()=>{const{collectionContextStore:e,schema:t,groupFormat:o,query:r,showTable:i}=this.props;if(!r.timeline_by)return;const n=e.groupsStore.getGroupState(o);if(!n)return;const s=n.currentLimit.state,l=a().compact([o&&(0,Ye.Ko)({schema:t,group:o,timeZone:(0,je.r)()}),!i&&{property:r.timeline_by,filter:{operator:"is_not_empty"}}]);return{type:"results",filter:l.length>0?{operator:"and",filters:l}:void 0,limit:s}}))}renderComponent(){const{store:e,format:t,groupFormat:o,collectionContextStore:r,isFullScreen:n,paddingLeft:l,showTable:a}=this.props,d=r.groupsStore.getGroupState(o);if(!d)return;const h=o?[o]:[],p=this.resultsReducerStore.state,u=d.reducerResultStore.state,m=ee.VM({collectionContextStore:r,reducerResult:u,isFullScreen:n});return c.createElement(c.Fragment,null,p&&s()(ot.Z,{id:h.length>0?`results:${(0,Ae.KW)(h)}`:"timeline_results",reducer:p,groupsPointer:h,collectionContextStore:r,resultStore:d.reducerResultStore}),this.renderCollectionGroupResults(),m&&s()("div",{style:{width:"100%"}},void 0,a?s()("div",{style:{height:33}}):s()(So,{style:{position:"sticky",left:n?l:3,width:"max-content",height:33},groupsPointer:h,store:e,collectionContextStore:r,format:t,isFullScreen:n,incrementLimitsInRelatedGroups:!1})),c.createElement(ca,i()({},this.props,{store:void 0,indentLevel:0,handleOpenPeekPage:this.handleOpenPeekPage})))}renderCollectionGroupResults(){const{groupFormat:e,disabled:t,query:o,format:r,schema:n,blockPropertyValueOverlayStore:l,collectionContextStore:a,isFullScreen:d,isRootChild:h,showTable:p,canEditTimelineItems:u,scrollerLeftOffsetStore:m,timelineState:g,paddingLeft:S,showTimelinePropertiesStore:v,isInPeekRenderer:y}=this.props;if(!a.groupsStore.getGroupState(e))return;const f=a.permissionScopes.state,C="collectionTypedView"===a.contextType||f.canEditContent;return s()(Ao,{disableSelectable:!0,collectionContextStore:a,groupsPointer:e?[e]:[],format:r,canDrag:!1,disableRequest:!0,resultProps:{disabled:t||!C,timelineState:g,schema:n,query:o,format:r,scrollerLeftOffset:m.state,paddingLeft:S,showProperties:v.state,blockPropertyValueOverlayStore:l,collectionContextStore:a,isFullScreen:d,showTable:p,isRootChild:h,groupFormat:e,canEditTimelineItems:u,isInPeekRenderer:y,handleOpenPeekPage:this.handleOpenPeekPage,isLast:!1},canDrop:!1,resultComponent:na,disabled:!0,direction:Do.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,nestedCreateSubitemButton:e=>c.createElement(ca,i()({},this.props,{store:e.store,indentLevel:e.indentLevel,parentStore:e.parentStore,subitemPath:e.subitemPath,handleOpenPeekPage:this.handleOpenPeekPage}))})}}function ca(e){window.__c={n:"AddRowTimelineItem"};const{store:t,parentStore:o,subitemPath:r,timelineState:i,disabled:n,query:l,format:a,schema:c,collectionContextStore:d,blockPropertyValueOverlayStore:h,isFullScreen:p,isRootChild:u,groupFormat:m,paddingLeft:g,showTimelinePropertiesStore:S,scrollerLeftOffsetStore:v,showTable:y,canEditTimelineItems:f,isInPeekRenderer:C,isReady:b,canEdit:w}=e,x=(0,yo.VK)((()=>d.groupsStore.getGroupState(m)),[d,m]),k=(0,yo.VK)((()=>d.permissionScopes.state),[d.permissionScopes]),P=(0,yo.VK)((()=>v.state),[v]),T=(0,yo.VK)((()=>S.state),[S]);return x&&b&&w&&!k.isSyncedCollection?s()(la,{store:t,disabled:n||!k.canEditContent,timelineState:i,schema:c,query:l,format:a,scrollerLeftOffset:P,paddingLeft:g,showProperties:T,blockPropertyValueOverlayStore:h,collectionContextStore:d,isFullScreen:p,showTable:y,isRootChild:u,groupFormat:m,canEditTimelineItems:f,isInPeekRenderer:C,parentStore:o,subitemPath:r}):null}aa.displayName="TimelineItemGroupResults";const da=(0,P.injectIntl)(aa);function ha(){window.__c={n:"TimelineTableShimmer"};const e=(0,fo.yK)((e=>({rowContainer:{display:"flex",height:34,padding:"7px 0px",alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0",borderBottom:`1px solid ${e.regularDividerColor}`},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor}})),[]);return s()("div",{style:e.rowContainer},void 0,s()(Wr.Z,{style:e.rowShimmer}))}class pa extends h.Z{constructor(){super(...arguments),this.handleAddRowClick=()=>{const{collectionContextStore:e,isFullScreen:t,groupFormat:o}=this.props,{device:r}=this.environment,i=o?[o]:[],n=e.groupsStore.getGroupState(i);if(!$e.M_(this.environment)||!n)return;e.searchQuery.state&&E.Ug({searchQuery:"",collectionContextStore:e,isFullScreen:t});const s=n.resultsStore.state;N.createAndCommit({userAction:"TimelineTableGroupResults.handleAddRowClick",environment:this.environment,perform:t=>{const{coercionSucceeded:i,newStore:n}=V.IW({environment:this.environment,collectionContextStore:e,groupsPointer:o?[o]:[],results:s,insertAtIndex:s.length,coerce:!0,initializeDefaultTemplate:!0,transaction:t,from:"timeline_table_group_results"});if(r.isMobile){const e=(0,oe.ZP)({store:n,fullyQualified:!1,pageVisitSource:g.tY.Create});this.navigate(e)}else p.default.afterNextFlush((()=>{p.default.afterNextFlush((()=>{if(i)kt.bA({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:n,property:"title",format:Ut.C.Table,collectionContextStore:e,disableHorizontalEdgeScroll:!0});else{const t=o?[o]:[],r=e.groupsStore.getGroupState(t);L.peekBlock({environment:this.environment,store:n,peekMode:(0,ee.kr)(e.collectionViewStore()),resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:e,pageVisitSource:g.tY.Create})}}))}));T.W2j(this.environment,{from:"timeline_add_item_bottom",type:"page",new_page_id:n.id,...(0,j.Pn)(e)})}})},this.handleLoadMoreClick=e=>{const{collectionContextStore:t,groupFormat:o}=this.props,r=t.groupsStore.getGroupState(o);if(!r)return;const i=r.reducerResultStore.state;(0,re.Wi)(e),H.ZH(this.environment),i&&V.ID({collectionContextStore:t,environment:this.environment,incrementLimitArgs:{isFullScreen:this.props.isFullScreen,currentResultCount:i.blockIds.length,groupsPointer:r.groupsPointer,incrementLimitsInRelatedGroups:!1}}),T.uDZ(this.environment)},this.titleColumnIndexStore=this.createComputedStore((()=>{const{showTablePropertyFormatsStore:e}=this.props;return e.state.findIndex((e=>"title"===e.property))})),this.getItemSelectableStyle=()=>({display:"flex",borderBottom:`1px solid ${this.theme.tableDividerColor}`,width:"fit-content",height:33})}renderComponent(){const{groupFormat:e,isFullScreen:t,collectionContextStore:o,blockPropertyValueOverlayStore:r,isReady:i,store:n,disabled:l,format:a,schema:d,isInPeekRenderer:h,paddingBottom:p,query:u,showTablePropertyFormatsStore:m,showHoverActionsStore:g}=this.props,S=e?[e]:[],v=o.groupsStore.getGroupState(S);if(!v)return;const y=v.reducerResultStore.state,f=(0,ee.VM)({collectionContextStore:o,reducerResult:y,isFullScreen:t}),C=o.shouldShowSpinner.state&&"on"===Ce.default.getEligibleGroup({experimentId:"collections_loading_state",defaultGroup:"control"}),b=i&&0===(null==y?void 0:y.blockIds.length)&&!C,w=o.permissionScopes.state;return c.createElement(c.Fragment,null,this.renderTableHeaderRow(e),s()("div",{style:{height:(0,J.vX)(Boolean(e)),width:0}}),b&&this.renderEmptyTablePlaceholder(),this.renderTableRows(e),C&&s()(ha,{}),f&&this.renderLoadMoreButton(),this.shouldShowAddRowButton()&&this.renderTableAddRowButton(),s()(vs,{groupFormat:e,style:this.getAggregationRowStyle(),store:n,disabled:l||!w.canConfigureBlock,format:a,schema:d,query:u,collectionContextStore:o,isInPeekRenderer:h,isFullScreen:t,minWidth:void 0,paddingBottom:p,blockPropertyValueOverlayStore:r,showPropertyFormatsStore:m,showHoverActionsStore:g,showRightActionsSpacer:!1}),(e||t)&&s()("div",{style:{height:Zl,width:0,marginBottom:e?J.y1:void 0}}))}renderTableHeaderRow(e){const{store:t,format:o,schema:r,query:i,collectionContextStore:n,paddingBottom:l,isInPeekRenderer:a,blockPropertyValueOverlayStore:c,tableStore:d,showTablePropertyFormatsStore:h,timelineState:p,isFullScreen:u,isRootChild:m}=this.props;if(!n.groupsStore.getGroupState(e))return;const g=Boolean(e),S=n.permissionScopes.state,v=n.viewIsFlushToTopbar();return s()(hl,{store:t,format:o,schema:r,query:i,collectionContextStore:n,isInPeekRenderer:a,minWidth:void 0,paddingBottom:l,blockPropertyValueOverlayStore:c,showPropertyFormatsStore:h,showRightActions:!1,allowHidingTitle:!0,tableStore:d,formatKey:"timeline_table_properties",disabled:!S.canConfigureCollection,disableHorizontalEdgeScroll:!0,height:(0,J.vX)(g),paddingTop:g?0:J.Ne-J.pe,disableTopBorder:!v||g,disableCellRightBorder:!0,groupFormat:e},void 0,!g&&S.canConfigureBlock&&s()(rs,{isGrouped:!1,format:o,collectionContextStore:n,timelineState:p,isFullScreen:u,isRootChild:m}))}renderTableRows(e){const{device:t}=this.environment,{store:o,schema:r,query:i,disabled:n,collectionContextStore:l,blockPropertyValueOverlayStore:a,showTablePropertyFormatsStore:c,canEdit:d,format:h}=this.props,u=l.collectionViewStore();if(!u)return;const m=e?[e]:[];if(!l.groupsStore.getGroupState(e))return;const g=c.state,S=!d&&t.isMobile&&!u.isSyncedCollection(),v=this.titleColumnIndexStore.state;return s()(Bl,{store:o,format:h,schema:r,query:i,collectionContextStore:l,minWidth:void 0,blockPropertyValueOverlayStore:a,showPropertyFormatsStore:c,disabled:!d,disableHorizontalEdgeScroll:!0,groupFormat:e,isScrolled:!1,render:t=>s()(Ao,{collectionContextStore:l,groupsPointer:m,disableRequest:!0,format:h,canDrag:S,resultProps:{schema:r,collectionContextStore:l,propertyFormats:g,onPropertyTab:t.onPropertyTab,onPropertyUntab:t.onPropertyUntab,onPropertyEnter:t.onPropertyEnter,onPropertyClick:t.onPropertyClick,onPropertyEsc:t.onPropertyEsc,onPropertyBgClick:t.onPropertyBgClick,onPropertyContextMenu:t.onPropertyContextMenu,onOpenProperty:t.onOpenProperty,disabled:n,blockPropertyValueOverlayStore:a,isScrolled:!1,showRightActionsSpacer:!1,disableHorizontalEdgeScroll:!0,disableLastCellBorderRight:!0,disableTableWrap:!0,disableCellBorderRight:!0,onShiftEnter:()=>{},titleColumnIndex:v,groupFormat:e},resultComponent:bl,canDrop:!1,disabled:n,direction:Do.Vertical,getItemSelectableStyle:this.getItemSelectableStyle,shouldShowHoverMenu:!0,analyticsName:"timeline",emptyDroppableSize:0,onSelectableEnter:t.onSelectableEnter,disableScrollToRevealHorizontal:!0,blockPropertyValueOverlayStore:a,titleColumnIndex:v,nestedCreateSubitemButton:e=>{const{store:t,parentStore:o,subitemPath:r,indentLevel:i}=e;if(o)return s()(Hi,{store:t,collectionStore:o,subitemPath:r,indentLevel:i,collectionContextStore:l,disabled:n,groupsPointer:m,onSubitemCreate:e=>{a&&p.default.afterNextFlush((()=>{p.default.afterNextFlush((()=>{kt.bA({isNewBlock:!0,environment:this.environment,blockPropertyValueOverlayStore:a,store:e,property:"title",format:Ut.C.Table,collectionContextStore:l,disableHorizontalEdgeScroll:!0})}))}))}})}})})}renderEmptyTablePlaceholder(){const{canEdit:e}=this.props;return s()(qt.Z,{onClick:this.handleAddRowClick,onMouseDown:re.$0,disabled:!e,style:{display:"flex",alignItems:"center",height:_l,width:"100%",paddingLeft:8,fontSize:14,lineHeight:x.Z.lineHeight.UIRegular.desktop,background:this.theme.contentBackground,left:0,right:0,borderBottom:"1px solid transparent"}},void 0,s()("span",{style:{color:this.theme.lightTextColor}},void 0,s()(P.FormattedMessage,e?{defaultMessage:"Empty. Click to add a row.",id:"database.timelineView.emptyTablePlaceholder"}:{defaultMessage:"Empty.",id:"database.timelineView.cannotEdit.emptyTablePlaceholder"})))}renderLoadMoreButton(){const{collectionContextStore:e,groupFormat:t,format:o,canEdit:r}=this.props,i=t?[t]:[];if(!e.groupsStore.getGroupState(i))return;const n=ze({collectionContextStore:e,groupsPointer:i});return s()(qt.Z,{onMouseDown:re.$0,onClick:this.handleLoadMoreClick,disabled:n,hoveredStyle:n?{background:this.theme.whiteButtonBackground}:{},style:{display:"flex",alignItems:"center",height:_l+1,width:"100%",paddingLeft:8,paddingBottom:2,fontSize:14,lineHeight:x.Z.lineHeight.UIRegular.desktop,boxShadow:`0 -1px 0 ${this.theme.tableDividerColor}`,whiteSpace:"break-spaces"}},void 0,y.Z.arrowDown(this.getTableNewRowButtonIconStyle()),s()("span",{style:{color:this.theme.lightTextColor}},void 0,s()(P.FormattedMessage,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})),n?s()("div",{style:{marginTop:1,marginLeft:8,marginRight:8}},void 0,s()(so.Z,{style:{width:12,height:12}})):r&&s()(mo,{collectionContextStore:e,format:o}))}renderTableAddRowButton(){return s()(qt.Z,{onClick:this.handleAddRowClick,style:this.getTableAddRowButtonStyle(),className:q.tfM,onMouseDown:re.$0},void 0,y.Z.plus(this.getTableNewRowButtonIconStyle()),s()("span",{style:{color:this.theme.lightTextColor}},void 0,s()(P.FormattedMessage,{defaultMessage:"New",id:"database.timelineView.addRowButton"})))}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):L.navigate({environment:this.environment,url:e})}shouldShowAddRowButton(){const{collectionContextStore:e,isReady:t,canEdit:o}=this.props,r=e.permissionScopes.state;return Boolean(t&&o&&!r.isSyncedCollection)}getTableAddRowButtonStyle(){return{display:"flex",alignItems:"center",height:_l,width:"100%",paddingLeft:8,fontSize:14,lineHeight:x.Z.lineHeight.UIRegular.desktop,background:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground}}getTableNewRowButtonIconStyle(){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:this.theme.lightIconColor}}getAggregationRowStyle(){const{isReady:e,groupFormat:t,isFullScreen:o,paddingLeft:r}=this.props;return{...!e&&{opacity:0,pointerEvents:"none"},...!o&&!t&&{position:"sticky",left:r},...o&&!t&&{left:r}}}}pa.displayName="TimelineTableGroupResults",pa.contextTypes={...K.wK,...h.w};const ua=(0,P.injectIntl)(pa);class ma extends Ee.Z{constructor(){super(...arguments),this.widthEl=null,this.storeTypes={tableStore:Fn,hiddenGroupsVisible:m.default.createClass(!1),groupsReducerResultStore:m.default.createClass(void 0)},this.renderTableGroupHeader=e=>{const{format:t,collectionContextStore:o,isFullScreen:r,isRootChild:n}=this.props,l=o.permissionScopes.state;return c.createElement(Tr,i()({},e,{height:J.Zn-1,paddingTop:J.xd,toggleClosedMarginBottom:J.xd,getComputedStickyStyle:this.getTableGroupHeaderComputedStickyStyle,style:this.getGroupHeaderStyle(e.index)}),0===e.index&&l.canConfigureBlock&&s()(rs,{isGrouped:!0,format:t,collectionContextStore:o,timelineState:this.timelineState,isFullScreen:r,isRootChild:n})," ")},this.renderTableGroupResults=e=>{const{store:t,isFullScreen:o,schema:r,query:i,isInPeekRenderer:n,collectionContextStore:l,blockPropertyValueOverlayStore:a,showHoverActionsStore:c,paddingBottom:d,isRootChild:h,disabled:p}=this.props,u=this.isReady.state,m=this.getPaddingLeft();if(l.groupsStore.getGroupState(e))return s()(ua,{store:t,groupFormat:e,schema:r,query:i,isInPeekRenderer:n,timelineState:this.timelineState,collectionContextStore:l,blockPropertyValueOverlayStore:a,showTablePropertyFormatsStore:this.showTablePropertyFormatsStore,showHoverActionsStore:c,tableStore:this.stores.tableStore,paddingLeft:m,paddingBottom:d,format:this.getCurrentFormat(),isFullScreen:o,isRootChild:h,isReady:u,canEdit:this.canEditCollectionTimeline(),disabled:p&&this.canEditCollectionTimeline()})},this.renderTimelineItemGroupResults=e=>{const{store:t,isFullScreen:o,schema:r,query:i,isInPeekRenderer:n,collectionContextStore:l,blockPropertyValueOverlayStore:a,isRootChild:c,disabled:d}=this.props,h=this.isReady.state,p=this.getPaddingLeft();return s()(da,{store:t,groupFormat:e,schema:r,query:i,isInPeekRenderer:n,timelineState:this.timelineState,collectionContextStore:l,blockPropertyValueOverlayStore:a,showTimelinePropertiesStore:this.showTimelinePropertiesStore,paddingLeft:p,format:this.getCurrentFormat(),isFullScreen:o,isRootChild:c,isReady:h,canEdit:this.canEditCollectionTimeline(),disabled:d,showTable:this.showTableStore.state,canEditTimelineItems:this.canEditTimelineItemsStore.state,scrollerLeftOffsetStore:this.scrollerLeftOffsetStore})},this.renderTimelineItemGroupHeader=e=>{if(this.showTableStore.state)return;const t=this.timelineState.outerSizeObserver.rect.state.width;return s()("div",{style:{position:"sticky",left:0,width:t,height:J.Zn,zIndex:k.sL}},void 0,c.createElement(Tr,i()({},e,{style:{width:"100%",height:"100%",paddingLeft:this.props.isFullScreen?this.getPaddingLeft():32,zIndex:void 0,transition:"background 200ms ease-in-out, border 200ms  ease-in-out",background:"transparent",borderBottom:"1px solid transparent"},getComputedStickyStyle:this.getTimelineItemGroupHeaderStickyStyle,preventToggleBackground:this.props.isInPeekRenderer})))},this.renderTimelineItemHiddenGroupsButton=e=>{if(this.showTableStore.state)return;const{isFullScreen:t}=this.props;return s()("div",{style:{width:"100%",height:34,display:"flex"}},void 0,c.createElement(Lr,i()({},e,{style:{position:"sticky",left:t?this.getPaddingLeft():3,width:"max-content",paddingLeft:4,paddingRight:8}})))},this.renderTimelineAddGroupButton=e=>{if(this.showTableStore.state)return;const{isFullScreen:t,collectionContextStore:o}=this.props;return"collectionTypedView"!==o.contextType?s()("div",{style:{width:"100%",height:32,display:"flex"}},void 0,c.createElement(pr,i()({},e,{style:{position:"sticky",left:t?this.getPaddingLeft():3,width:"max-content",paddingLeft:4,paddingRight:8}}))):void 0},this.renderTimelineGroupsLoadMoreButton=e=>{if(this.showTableStore.state)return;const{isFullScreen:t}=this.props;return s()("div",{style:{width:"100%",height:38,display:"flex"}},void 0,c.createElement(_r,i()({},e,{style:{position:"sticky",left:t?this.getPaddingLeft():3,width:"max-content",paddingLeft:4,paddingRight:8}})))},this.renderRowDropzoneSelectableGroupResults=e=>{const{collectionContextStore:t,store:o,isFullScreen:r,format:i,disabled:n}=this.props;return s()(Ul,{store:o,groupFormat:e,collectionContextStore:t,isFullScreen:r,canEdit:this.canEditCollectionTimeline(),format:i,disabled:n&&this.canEditCollectionTimeline()})},this.renderDropzoneSelectableGroupHeader=()=>{},this.renderDropzoneSelectableHiddenGroupsButton=()=>{},this.renderDropzoneSelectableAddGroupButton=()=>{},this.renderDropzoneSelectableGroupsLoadMoreButton=()=>{},this.handleScrollOffsetChange=e=>{const{collectionContextStore:t,isFullScreen:o}=this.props,r=t.isLoading.state,i=t.groupsStore.getGroupState([]);if(!i)return;const n=i.reducerResultStore.state;e<Se.Z.incrementScrollOffset&&n&&!r&&n.hasMore&&V.ID({collectionContextStore:t,environment:this.environment,incrementLimitArgs:{isFullScreen:o,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})},this.handleHorizontalScroll=()=>{const{timelineState:e}=this,{horizontalScroller:t,savePreference:o}=e;if(!t)return;const r=t.scrollLeft,i=e.scrollLeft.state;this.environment.device.isIOS&&void 0!==i&&0===r&&i>J.lx?t.scrollLeft=i:(o&&o(),e.scrollLeft.setState(r),(0,J.rr)(this.environment)?this.resetWindowForScrollDebounced():this.resetWindowForScroll())},this.resetWindowForScroll=()=>{const{timelineState:e}=this,{horizontalScroller:t,outerSizeObserver:o}=e;if(!t)return;const r=e.zoomLevel.state,{startTimestamp:i,endTimestamp:n}=e.currentRange.state,s=t.scrollLeft,l=o.rect.state.width,a=(0,J.e$)(r,n-i),c=(0,J.al)(e);if(s<J.lx){const t=-(0,J.x2)(r,J.Ge);e.currentRange.setState({startTimestamp:i+t,endTimestamp:n+t}),Mn.Nf({timelineState:e,environment:this.environment,zoomLevel:r,centerTimestamp:c})}else if(s+l>a-J.lx){const t=(0,J.x2)(r,J.Ge);e.currentRange.setState({startTimestamp:i+t,endTimestamp:n+t}),Mn.Nf({timelineState:e,environment:this.environment,zoomLevel:r,centerTimestamp:c})}},this.resetWindowForScrollDebounced=a().debounce(this.resetWindowForScroll,200),this.handleWidthElMount=e=>{if(this.widthEl=e,e){const{timelineState:t}=this,{outerSizeObserver:o}=t;o.observe(e);const r=(0,le.xH)(e);r&&(t.horizontalScroller=r,(0,te.lj)(r,"scroll",this.handleHorizontalScroll),t.outerSizeObserver.rect.addListener(this.scrollToCenteredTimestamp),this.scrollToCenteredTimestamp())}},this.handleTimelineElMount=e=>{if(e){const{timelineState:t}=this,{timelineSizeObserver:o}=t;o.observe(e)}},this.scrollToCenteredTimestamp=()=>{const{timelineState:e}=this,{startTimestamp:t,endTimestamp:o}=e.currentRange.state;Mn.KA({timelineState:e,centerTimestamp:(t+o)/2})},this.handleGroupHeaderAddItem=(e,t,o)=>{if(this.environment.device.isMobile)L.navigateToBlock({environment:this.environment,store:e,pageVisitSource:g.tY.Create});else{const{collectionContextStore:t}=this.props,{groupFormat:r}=o,i=r?[r]:[],n=t.groupsStore.getGroupState(i);L.peekBlock({environment:this.environment,store:e,peekMode:ee.kr(t.collectionViewStore()),resultsStore:null==n?void 0:n.resultsStore,collectionContextStore:t,pageVisitSource:g.tY.Create})}},this.showTablePropertyFormatsStore=this.createComputedStore((()=>this.getTimelineTableProperties().filter((e=>e.visible))),!0),this.tableWidthStore=this.createComputedStore((()=>this.showTableStore.state?this.showTablePropertyFormatsStore.state.reduce(((e,t)=>e+(t.width||0)),0):0)),this.scrollerLeftOffsetStore=this.createComputedStore((()=>(0,J.xI)({environment:this.environment,paddingLeft:this.getPaddingLeft(),format:this.props.format,isFullScreen:this.props.isFullScreen,isRootChild:this.props.isRootChild}))),this.scrollPixelWidthStore=this.createComputedStore((()=>{const{timelineState:e}=this,t=e.zoomLevel.state,{startTimestamp:o,endTimestamp:r}=e.currentRange.state;return(0,J.e$)(t,r-o)})),this.showTimelinePropertiesStore=this.createComputedStore((()=>{const{format:e}=this.props;return(e.timeline_properties||[]).filter((e=>{let{visible:t}=e;return t})).map((e=>{let{property:t}=e;return t}))})),this.showTableStore=this.createComputedStore((()=>{const{format:e,isFullScreen:t,isRootChild:o}=this.props;return(0,J.C1)({environment:this.environment,format:e,isFullScreen:t,isRootChild:o})})),this.canEditTimelineItemsStore=this.createComputedStore((()=>{const{query:e,schema:t}=this.props;return ee.D2({query:e,schema:t})})),this.isReady=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return e.groupsStore.anyGroupHasResults()})),this.getTimelineItemGroupStyle=e=>{const t=this.showTableStore.state,o=this.getGroupPaddingState(e);let r=0,i=0;return o.groupHeader&&t&&(r+=J.Zn-1),o.tableHeaderRow&&(r+=J.pe),o.tableEmptyRow&&(r+=_l),o.tableAggregationRow&&(i+=Zl),o.hiddenGroupsButton&&t&&(i+=34),o.groupsLoadMoreButton&&t&&(i+=38),o.addGroupButton&&t&&(i+=32),o.groupPaddingBottom&&(i+=J.y1),o.extraGroupMarginBottom&&(i+=J.xd+1),{paddingTop:r,paddingBottom:i,minHeight:J.Zn,boxShadow:e.index>0&&(!t||o.tableHeaderRow)?`0 -1px 0 ${this.theme.tableDividerColor}`:void 0}},this.getRowDropzoneSelectableGroupStyle=e=>{if(!e)return{paddingTop:0,paddingBottom:0};const t=this.getGroupPaddingState(e);let o=0,r=0;return t.groupHeader&&(o+=J.Zn),t.tableHeaderRow&&(o+=J.pe),t.tableEmptyRow&&(o+=_l),t.addItemRow&&(r+=Dn),t.loadMoreButton&&(r+=33),t.tableAggregationRow&&(r+=Zl),t.hiddenGroupsButton&&(r+=34),t.groupsLoadMoreButton&&(r+=38),t.groupPaddingBottom&&(r+=J.y1),t.extraGroupMarginBottom&&(r+=J.xd),t.addGroupButton&&(r+=32),t.dropZoneSelectableGroupExtraBottomPadding&&(r+=1),{paddingTop:o,paddingBottom:r}},this.getTableGroupHeaderComputedStickyStyle=e=>({boxShadow:e?`0 -1px 0 ${this.theme.tableDividerColor}`:void 0}),this.getTimelineItemGroupHeaderStickyStyle=e=>e?{background:this.theme.contentBackground,boxShadow:`0 1px 0 ${this.theme.tableDividerColor}`}:{background:"transparent",boxShadow:void 0}}get registries(){return super.registries.concat(Bn.Z)}willMount(e){super.willMount(e),this.timelineState=(0,J.Gz)({isFullScreen:e.isFullScreen,isRootChild:e.isRootChild});const{collectionContextStore:t}=e,o=t.collectionStore(),r=t.collectionViewStore();o&&r&&Mn.j2({timelineState:this.timelineState,environment:this.environment,collectionViewStore:r,collectionContextStore:t})}willMountOrUpdate(e){super.willMountOrUpdate(e);const{timelineState:t}=this,{query:o,collectionContextStore:r}=e;we.Z.state&&t.hoveredItem.setState(void 0);const i=r.collectionStore();if(!i)return;const n=r.permissionScopes.state;!o.timeline_by&&n.canConfigureCollection&&n.canConfigureBlock&&i.isDefined()&&this.updateOrCreateTimelineProperty(e)}didMountOrUpdate(){super.didMountOrUpdate();const e=this.timelineState,{collectionContextStore:t,isFullScreen:o,isRootChild:r}=this.props;T.iRP(this.environment,(0,J.Ii)({environment:this.environment,collectionContextStore:t,timelineState:e,isFullScreen:o,isRootChild:r}));const i=e.drawState.state;if(null!=i&&i.tryToCompleteDrawnArrow){(0,J.H5)(t)&&N.createAndCommit({userAction:"TimelineItemDependencyDrawHandle.completeUserDrawnArrow",environment:this.environment,perform:i=>{Mn.$o({timelineState:e,environment:this.environment,transaction:i,collectionContextStore:t,isFullScreen:o,isRootChild:r})}})}}willUnmount(){super.willUnmount();const{timelineState:e}=this,{horizontalScroller:t,outerSizeObserver:o,timelineSizeObserver:r}=e;o.destroy(),r.destroy(),e.destroyed=!0,t&&(0,te.ZV)(t,"scroll",this.handleHorizontalScroll)}customizeEdgeScrollRect(e){const t=this.scrollerLeftOffsetStore.state;return Si.iL.from({top:e.top,height:e.height,left:e.left+t,width:e.width-t})}addBlockToView(e){const{store:t,transaction:o}=e,{collectionContextStore:r}=this.props,i=r.collectionStore();if(i)return Mn.Fv({environment:this.environment,store:t,timelineState:this.timelineState,query:this.props.query,collectionStore:i,collectionContextStore:this.props.collectionContextStore,groupFormat:void 0,transaction:o})}renderPersisted(){const{store:e,isInPeekRenderer:t,paddingRight:o,isFullScreen:r,isRootChild:n,query:l,schema:a,format:d,collectionContextStore:h,disabled:p}=this.props,{timeline_by:u}=l;if(!u)return this.renderMissingDateProperty();const m=a[u];if(!m||!Ct.Lt(m))return this.renderMissingDateProperty();const{timelineState:g}=this,S=this.scrollerLeftOffsetStore.state,v=this.showTableStore.state,y=this.getPaddingLeft(),f=ee.az(h,r),C=d.collection_group_by,b=h.viewIsFlushToTopbar(),w=(0,We.Z)((u=>s()(Fr,{isFullScreen:r,renderEmitter:h.renderEmitter},void 0,c.createElement("div",i()({style:this.getStyle(v),className:q.kDE},u),s()(Ro.Z,{store:e,analyticsName:"timeline",shouldShowHalo:!r,canSelect:!r},void 0,s()(zl,{timelineState:g,isInPeekRenderer:this.props.isInPeekRenderer}),c.createElement("div",{style:{position:"absolute",width:"100%",zIndex:0,top:J.Ne},ref:this.handleTimelineElMount},C?this.renderTimelineItemGroups(C):this.renderTimelineItemGroupResults(void 0),s()(qn,{timelineState:g,disabled:p,isReady:this.isReady.state,renderEmitter:h.renderEmitter,isFullScreen:r,isRootChild:n})),s()(cs,{isInPeekRenderer:t,timelineState:g,query:l,schema:a,scrollerLeftOffset:S,collectionContextStore:h,showTable:v}),s()(ts,{timelineState:g,isInPeekRenderer:t,paddingLeft:y,paddingRight:!r&&n?8:o,format:d,scrollerLeftOffset:S,isFullScreen:r,isRootChild:n,showTable:v,collectionContextStore:h,isReady:this.isReady.state}),v&&this.renderTable(C,y),s()("div",{style:{paddingTop:J.Ne,pointerEvents:"none"}},void 0,C?this.renderRowDropzoneSelectableGroups(C):s()("div",{style:this.getRowDropzoneSelectableGroupStyle(void 0)},void 0,this.renderRowDropzoneSelectableGroupResults(void 0))),!f&&s()(_o.Z,{onChange:this.handleScrollOffsetChange}))))));return c.createElement(c.Fragment,null,c.createElement("div",{ref:this.handleWidthElMount}),!b&&s()("div",{style:{height:4}}),w)}renderMissingDateProperty(){return s()("div",{style:{paddingLeft:this.getPaddingLeft(),paddingRight:this.props.paddingRight}},void 0,s()(P.FormattedMessage,{defaultMessage:"Unable to render this view because the database is missing a date property.",id:"database.timelineView.missingDateProperty"}))}renderTable(e,t){const{store:o,isFullScreen:r,collectionContextStore:i}=this.props;return s()("div",{style:{position:"sticky",left:0,height:0,width:this.tableWidthStore.state,zIndex:k.eU}},void 0,s()(Ro.Z,{style:this.getTableSelectableStyle(t),store:o,shouldShowHalo:!1,canSelect:!r,analyticsName:"timeline"},void 0,e?this.renderTableGroups(e):s()(Fr,{isFullScreen:r,ignoreAncestorContainer:!0,renderEmitter:i.renderEmitter},void 0,s()("div",{},void 0,this.renderTableGroupResults(void 0)))))}renderTableGroups(e){const{store:t,format:o,collectionContextStore:r,schema:i,disabled:n,isFullScreen:l,paddingLeft:a,isRootChild:c,isInPeekRenderer:d}=this.props;return s()(si,{store:t,id:"timeline_groups",groupBy:e,groupsFormatKey:Ae.Uh,groupAggregationKey:Ae.dQ,format:o,schema:i,collectionContextStore:r,disabled:n,isFullScreen:l,renderGroup:this.renderTableGroupResults,renderHeader:this.renderTableGroupHeader,onGroupHeaderAddItem:this.handleGroupHeaderAddItem,hiddenGroupsVisible:this.stores.hiddenGroupsVisible,reducerResultStore:this.stores.groupsReducerResultStore,disableReducerRequest:!0,ignoreAncestorStickyContainer:!0,paddingLeft:a,isRootChild:c,isInPeekRenderer:d})}renderTimelineItemGroups(e){const{store:t,format:o,collectionContextStore:r,schema:i,disabled:n,isFullScreen:l,paddingLeft:a,isRootChild:c,isInPeekRenderer:d}=this.props;return s()(si,{store:t,id:"timeline_groups",groupBy:e,groupsFormatKey:Ae.Uh,groupAggregationKey:Ae.dQ,format:o,schema:i,collectionContextStore:r,disabled:n,isFullScreen:l,renderGroup:this.renderTimelineItemGroupResults,onGroupHeaderAddItem:this.handleGroupHeaderAddItem,hiddenGroupsVisible:this.stores.hiddenGroupsVisible,renderHeader:this.renderTimelineItemGroupHeader,getGroupStyle:this.getTimelineItemGroupStyle,reducerResultStore:this.stores.groupsReducerResultStore,renderHiddenGroupsButton:this.renderTimelineItemHiddenGroupsButton,renderAddGroupButton:this.renderTimelineAddGroupButton,renderGroupsLoadMoreButton:this.renderTimelineGroupsLoadMoreButton,paddingLeft:a,isRootChild:c,isInPeekRenderer:d,shouldSurpressShimmer:!0})}renderRowDropzoneSelectableGroups(e){const{store:t,format:o,collectionContextStore:r,schema:i,disabled:n,isFullScreen:l,paddingLeft:a,isRootChild:c,isInPeekRenderer:d}=this.props;return s()(si,{store:t,id:"timeline_groups",groupBy:e,groupsFormatKey:Ae.Uh,groupAggregationKey:Ae.dQ,format:o,schema:i,collectionContextStore:r,disabled:n,isFullScreen:l,renderGroup:this.renderRowDropzoneSelectableGroupResults,onGroupHeaderAddItem:this.handleGroupHeaderAddItem,hiddenGroupsVisible:this.stores.hiddenGroupsVisible,renderHeader:this.renderDropzoneSelectableGroupHeader,getGroupStyle:this.getRowDropzoneSelectableGroupStyle,reducerResultStore:this.stores.groupsReducerResultStore,disableReducerRequest:!0,renderHiddenGroupsButton:this.renderDropzoneSelectableHiddenGroupsButton,renderAddGroupButton:this.renderDropzoneSelectableAddGroupButton,renderGroupsLoadMoreButton:this.renderDropzoneSelectableGroupsLoadMoreButton,paddingLeft:a,isRootChild:c,isInPeekRenderer:d,shouldSurpressShimmer:!0})}getCurrentFormat(){const{format:e}=this.props,{temporaryFormat:t}=this.stores.tableStore.state;return t||e}getTimelineTableProperties(){const e=this.getCurrentFormat();return e&&e.timeline_table_properties?e.timeline_table_properties:[]}updateOrCreateTimelineProperty(e){const{schema:t}=e,{collectionContextStore:o}=this.props,r=o.collectionStore();if(!r)return;const i=o.collectionViewStore();if(!i)return;const n=(0,P.defineMessages)({date:{id:"database.timelineView.dateProperty.defaultName",defaultMessage:"Date"}});N.createAndCommit({userAction:"CollectionTimelineView.updateOrCreateTimelineProperty",environment:this.environment,perform:e=>{let o,s=ee.HI(t);if(!s){s=(0,Ze.ZP)();o={[s]:{name:ie.default.formatMessage(n.date),type:"date"}}}E.Es({collectionViewStore:i,update:{timeline_by:s},transaction:e}),o&&E.xO({environment:this.environment,collectionStore:r,update:o,transaction:e})}})}canEditCollectionTimeline(){const e=this.props.collectionContextStore.permissionScopes.state;return this.canEdit()&&e.canEditContent&&!e.isSyncedCollection}isInlineFullWidth(){const{isRootChild:e,isFullScreen:t,format:o}=this.props;return(0,J.fj)({environment:this.environment,isRootChild:e,isFullScreen:t,format:o})}getGroupPaddingState(e){const{groupFormat:t,currentGroups:o,visibleGroups:r,hiddenGroups:i,total:n}=e,{collectionContextStore:s,isFullScreen:l,disabled:a,format:c}=this.props,{hiddenGroupsVisible:d}=this.stores,h=c.collection_group_by,p=this.showTableStore.state,u=s.groupsStore.getGroupState(t),m=Boolean(t&&!(null!=u&&u.toggleStateStore.state)),g=this.isFirstNonCollapsedGroup(t,m,o),S=null==u?void 0:u.reducerResultStore.state,v=ee.VM({collectionContextStore:s,reducerResult:S,isFullScreen:l}),y=t===i[i.length-1],f=t===r[r.length-1],C=r.length<n,b=d.state?y:f,w=s.permissionScopes.state,x=b&&!a&&w.canConfigureBlock&&h&&(0,Ae.Wz)(h,w.canConfigureCollection),k=S&&0===S.blockIds.length;return{groupHeader:Boolean(t&&(!p||!g)),tableHeaderRow:Boolean(p&&!m&&!g),tableAggregationRow:Boolean(p&&!m),addItemRow:Boolean(this.canEditCollectionTimeline()&&!m),hiddenGroupsButton:Boolean(f&&i.length>0),groupsLoadMoreButton:Boolean(f&&C),loadMoreButton:Boolean(!m&&v),groupPaddingBottom:Boolean(!m),tableEmptyRow:Boolean(p&&!m&&k),extraGroupMarginBottom:Boolean(p&&m),addGroupButton:Boolean(x),dropZoneSelectableGroupExtraBottomPadding:Boolean(!p)}}isFirstNonCollapsedGroup(e,t,o){const{collectionContextStore:r}=this.props;if(!e)return!0;const i=o.indexOf(e);return!t&&!o.find(((e,t)=>{if(t<i){const t=r.groupsStore.getGroupState([e]);return null==t?void 0:t.toggleStateStore.state}return!1}))}getPaddingLeft(){return this.isInlineFullWidth()?J.Qw:this.props.paddingLeft}getStyle(e){const{isFullScreen:t,paddingBottom:o}=this.props,r=this.scrollPixelWidthStore.state,i=this.isReady.state;return{position:"relative",float:"left",minWidth:"100%",width:r,background:this.props.isInPeekRenderer?this.theme.peekTimelineBackground:this.theme.timelineBackground,...!t&&!e&&{borderBottom:`1px solid ${this.theme.tableDividerColor}`},...!i&&{minHeight:150},...t&&{paddingBottom:o},height:this.getComputedOuterHeight()}}getTableSelectableStyle(e){return{whiteSpace:"nowrap",background:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground,paddingLeft:e,borderRight:`1px solid ${this.theme.tableDividerColor}`,boxShadow:this.theme.timelineTableBoxShadow,clipPath:"polygon(0% 0%, 120% 0%, 120% 100%, 0% 100%)",width:this.tableWidthStore.state+e+1,height:this.getComputedOuterHeight()}}getComputedOuterHeight(){const{device:e}=this.environment,{paddingBottom:t,isFullScreen:o}=this.props,{timelineSizeObserver:r}=this.timelineState,i=r.rect.state.height||120,n=this.showTableStore.state;return i+t+(o?0:72)+(!o&&n?28:0)+(o&&e.isMobile?72:0)}getGroupHeaderStyle(e){const{collectionContextStore:t}=this.props,o=t.viewIsFlushToTopbar();return 0!==e||o?{borderTop:`1px solid ${this.theme.tableDividerColor}`}:{}}}ma.displayName="CollectionTimelineView",ma.contextTypes={...K.wK,...h.w};const ga=ma;var Sa=o(89086),va=o(44862);class ya extends h.Z{renderComponent(){const{store:e,titleStyle:t,actionButton:o,collectionContextStore:r}=this.props;return s()("div",{},void 0,s()("div",{style:{display:"flex"}},void 0,s()(wi.Z,{store:e,style:t}),o),s()(va.Z,{collectionStore:e,collectionContextStore:r}))}}ya.displayName="CollectionHeader";const fa=ya;var Ca=o(40662);const ba=(0,P.defineMessages)({titlePlaceholder:{defaultMessage:"Untitled",id:"database.source.titlePlaceholder"}});class wa extends h.Z{constructor(){super(...arguments),this.getIconSize=()=>{const{collectionContextStore:e}=this.props,t=e.collectionStore();if(!t)return 22;return t.isSyncedCollection()?58:22},this.renderActionsPopup=e=>{const{collectionContextStore:t}=this.props,o=t.permissionScopes.state,r=t.collectionStore();if(!r)return;const n=r.isSyncedCollection(),a=l.compact([{key:"view",render:e=>c.createElement(rt.Z,i()({},e,{title:s()(P.FormattedMessage,{id:"database.source.viewDatabase.title",defaultMessage:"View database"}),icon:y.Z.alias(this.getSvgIconStyle())})),action:o=>{const r=this.getHref();if(!r)return;const i=te.DJ(o.event);L.navigate({environment:this.environment,url:r,openInNew:i}),i||e.close(),B.wd({environment:this.environment,collectionContextStore:t,action:"click_source_view"})}},o.canConfigureCollection&&!n&&{key:"edit_name",render:e=>c.createElement(rt.Z,i()({},e,{title:s()(P.FormattedMessage,{id:"database.source.editTitle.title",defaultMessage:"Edit database title"}),icon:y.Z.pencil(this.getSvgIconStyle())})),action:()=>{z.mT({environment:this.environment,store:r.getNameStore(),canSelectAllBlocks:!1}),e.close(),B.wd({environment:this.environment,collectionContextStore:t,action:"click_source_edit_title"})}}]),d={key:"show_title",render:e=>c.createElement(rt.Z,i()({},e,{icon:y.Z.eyeHidePadded(this.getSvgIconStyle(!0)),title:s()(P.FormattedMessage,{id:"database.source.hideTitle.title",defaultMessage:"Hide database title"})})),action:()=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();o&&(N.createAndCommit({userAction:"CollectionViewBlockSource.showTitleItem",environment:this.environment,perform:e=>{Le.FH({stores:[o],update:{hide_linked_collection_name:!0},transaction:e})}}),e.close(),B.wd({environment:this.environment,collectionContextStore:t,action:"click_source_hide_title"}))}};return s()(st.Z,{type:st.i.Vertical,sections:l.compact([{key:"actions",render:e=>c.createElement(dt.Z,e),items:a},o.canConfigureBlock&&{key:"show_title",render:e=>c.createElement(dt.Z,i()({},e,{topBorder:!0})),items:[d]}]),initialFocus:void 0})},this.handleRecordIconChange=e=>{const{collectionContextStore:t}=this.props,o=t.collectionStore();if(!o)return;const r=o&&o.getIconStore();r&&N.createAndCommit({userAction:"CollectionViewBlockSource.handleRecordIconChange",environment:this.environment,perform:t=>{Pt.sO({store:r,value:e,transaction:t})}})},this.handleNameBlur=()=>{H.ZH(this.environment)},this.handleNameButtonClick=()=>{const{collectionContextStore:e}=this.props;B.wd({environment:this.environment,collectionContextStore:e,action:"click_collection_name_link_button"})},this.handleNameInputClick=()=>{const{collectionContextStore:e}=this.props;B.wd({environment:this.environment,collectionContextStore:e,action:"click_collection_name_input"})},this.isEditingName=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.collectionStore();if(!t)return!1;const o=t.getNameStore();return Boolean((0,Sa.J5)(o))})),this.isInFrameWhenSidePeekOpen=this.createComputedStore((()=>{const{store:e}=this.props,t=Be.default.state;return(0,ee.Ks)(e)||!(0,ee.en)(e)&&t.open&&t.isClosing}))}renderComponent(){var e;const{collectionContextStore:t,isFullScreen:o,canEdit:r}=this.props,i=t.collectionStore(),n=t.permissionScopes.state,l=t.collectionViewBlockStore();if(!i||!l)return;const a=Boolean((null===(e=i.getParentBlockStore())||void 0===e?void 0:e.id)===l.id),c=Boolean(i.isSyncedCollection()),d=this.isEditingName.state,h=this.isInFrameWhenSidePeekOpen.state,{WindowSizeStore:p}=this.environment,u=Math.min(U.CC,p.state.width),m=(a||d)&&n.canConfigureCollection&&!c;return s()("div",{style:{...(o||h)&&(0,le.eA)(this.environment)&&{position:"sticky",left:0},paddingTop:8,boxSizing:h?"content-box":void 0,width:h?u:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"}},void 0,m?this.renderNameInput():this.renderLinkButton(),c&&s()("div",{style:{display:"flex"}},void 0,s()(Ca.Z,{canEdit:r,store:l,buttonStyle:{margin:0}})))}renderActionButton(){const{showHoverActionsStore:e}=this.props;return s()(Sn.Z,{isVisible:!0,animationStyle:{opacity:e.state?1:0},render:()=>s()("div",{style:{display:"flex",alignItems:"center",marginLeft:4}},void 0,s()(it.ZP,{popupType:this.environment.device.isMobile?ct.kQ.SlideUp:ct.kQ.Popup,render:this.renderActionsPopup,renderOrigin:e=>c.createElement(lo.Z,i()({icon:y.Z.dots},e)),style:{width:240},originGap:4}))})}renderLinkButton(){const{collectionContextStore:e}=this.props,t=e.collectionStore(),o=e.collectionViewBlockStore();if(t&&o)return s()(Yt.Z,{style:{width:"max-content",maxWidth:"100%",marginRight:4,...x.Z.textOverflowStyle},innerStyle:{paddingLeft:4,paddingRight:4,display:"flex",alignItems:"center",borderRadius:3},href:this.getHref(),onClick:this.handleNameButtonClick},void 0,this.renderIcon(!0),s()(fa,{actionButton:this.renderActionButton(),store:t,collectionContextStore:e,titleStyle:this.getTitleStyle()}))}renderNameInput(){const{collectionContextStore:e}=this.props,t=e.collectionStore(),o=e.collectionViewBlockStore();if(t&&o)return s()("div",{style:{display:"flex",alignItems:"center",marginLeft:4,marginRight:4}},void 0,this.renderIcon(!1),s()(Jt.Z,{store:t.getNameStore(),style:{...this.getTitleStyle(),marginRight:4},disabled:!1,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableMobileActionBar:!1,disableComment:!0,placeholder:ie.default.formatMessage(ba.titlePlaceholder),onEnter:this.handleNameBlur,onEsc:this.handleNameBlur,onClick:this.handleNameInputClick,disableShiftEnter:!0,pasteBehavior:"inline"}),this.renderActionButton())}renderIcon(e){var t;const{collectionContextStore:o}=this.props,r=o.collectionStore(),i=o.collectionViewBlockStore();if(!r||!i)return;const n=r.getIcon(),l=Boolean((null===(t=r.getParentBlockStore())||void 0===t?void 0:t.id)===i.id);return n?s()("div",{style:{position:"relative",width:this.getIconSize()+2,height:this.getIconSize()+2,marginRight:4}},void 0,s()(jt.Z,e?{disabled:!0,bucket:"secure",store:r,icon:n,isEmptyPage:!1,style:this.getIconStyle(),size:this.getIconSize()}:{disabled:!1,bucket:"secure",store:r,icon:n,isEmptyPage:!1,style:this.getIconStyle(),size:this.getIconSize(),iconLoggingData:{recordTable:r.table,source:"inline_collection",block_type:i.getType(),collection_id:r.id},onChange:this.handleRecordIconChange}),!l&&y.Z.pageLinkIndicator({position:"absolute",width:"50%",height:"50%",right:0,bottom:0,fill:"dark"===this.theme.mode?this.theme.regularTextColor:"#3E3C38",stroke:"dark"===this.theme.mode?this.theme.sidebarBackground:"white",strokeWidth:"dark"===this.theme.mode?"1.85px":"1.5px"})):!l&&s()("div",{style:{width:20,marginRight:4}},void 0,y.Z.alias({width:20}))}getHref(){const{collectionContextStore:e}=this.props,t=e.collectionStore();if(!t)return;const o=t.getParentBlockStore();return o?(0,oe.ZP)({store:o,fullyQualified:!1,pageVisitSource:g.tY.Breadcrumb}):void 0}getTitleStyle(){return{fontWeight:x.Z.fontWeight.bold,fontSize:22}}getIconStyle(){return{width:this.getIconSize(),height:this.getIconSize(),marginRight:4}}getSvgIconStyle(e){return{width:24,height:e?24:16,fill:this.theme.regularIconColor}}}wa.displayName="CollectionViewBlockSource";const xa=(0,P.injectIntl)(wa);var ka=o(37709),Pa=o(80503),Ta=o(31194),Ra=o(12323);class Ia extends h.Z{constructor(){super(...arguments),this.storeTypes={placementStore:m.default.createClass(void 0),headerRectStore:m.default.createClass(void 0),shouldScrollIntoViewStore:m.default.createClass(!1)},this.lastPlacement=void 0,this.justOpened=!1,this.renderMenu=e=>{const{collectionContextStore:t}=this.props;if(!this.stores.shouldScrollIntoViewStore.state)return s()(Pn.P,{context:X.HV.ViewSettings,collectionContextStore:t,collectionSettingsStore:t.settingsStore,fullHeight:e})},this.handleClose=e=>{(0,re.ZP)({event:e,context:re.Af.CollectionSettingsClick,callback:()=>{const{collectionContextStore:e}=this.props;F.E3({collectionSettingsStore:e.settingsStore})}})},this.captureMouseDown=e=>{(0,re.ZP)({event:e,context:re.Af.EditorMouseDown,callback:()=>{z.ZH(this.environment)}})},this.sidebarLayoutStore=this.createComputedStore((()=>{const e=this.props.headerSizeObserver.rect.state,t=this.environment.WindowSizeStore.state.height,o=e.height-Ra.L;return{maxHeight:t-(e.top+Ra.L),moveUp:o}}))}willMountOrUpdate(e){const{collectionContextStore:t}=e,o=this.settingsOpen(),r=this.stores.placementStore.state;o&&!r&&this.props.headerSizeObserver.recompute();const i=this.props.headerSizeObserver.rect.state;if(o&&!r&&i){const e=this.getPlacement(i);this.stores.placementStore.setState(e),this.justOpened=!0,this.lastPlacement=e}else this.justOpened=!1;o||this.stores.placementStore.setState(void 0),this.justOpened&&(!t.isFullScreen.state&&"popup"!==this.stores.placementStore.state||Be.default.isSidePeekOpen())&&this.stores.shouldScrollIntoViewStore.setState(!0)}didMountOrUpdate(){const{collectionContextStore:e}=this.props,{shouldScrollIntoViewStore:t}=this.stores;if(t.state){const o=e.collectionViewBlockStore();if(o){const t=pn.R.findCollectionViewBlockFromStore(o);if(t){const o=d.findDOMNode(t);if(o){const t=o.getBoundingClientRect(),r=this.environment.WindowSizeStore.state.height-t.bottom,i=t.top;(r<Rn.j9||i<Pa.Aj||e.isInPeekRenderer.state)&&((0,le.Wr)(o,{edgeDist:0,animate:!1}),this.props.headerSizeObserver.recompute())}}}t.setState(!1)}}renderComponent(){const{paddingRight:e,collectionContextStore:t}=this.props,o=this.settingsOpen(),r=this.lastPlacement,n=t.isFullScreen.state,l=t.viewIsFlushToTopbar(),a=this.getCurrentViewType(),d=("timeline"===a||"table"===a)&&l;if(r){if("sidebar"===r){const t=this.sidebarLayoutStore.state;if(!t)return;const{maxHeight:r,moveUp:l}=t;return s()(Sn.Z,{isVisible:o,enterAnimationStyle:{opacity:0,translateX:12},animationStyle:{opacity:1,translateX:0},exitAnimationStyle:{opacity:0,translateX:12},springConfig:Ma,render:()=>s()(Yn.Z,{capture:o,allowMobileAutoScroll:!0,allowUndo:!0,render:t=>c.createElement("div",i()({style:{position:"absolute",top:(d?1:0)-l,right:-e,height:`calc(100% + ${l}px)`,background:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground,borderLeft:`1px solid ${this.theme.tableDividerColor}`,paddingRight:e,zIndex:k.Nm,...n&&{height:r},...!n&&{maxHeight:r}},className:q.Dkf},(0,tt.Z)({onMouseDown:this.captureMouseDown},t)),s()("div",{style:{display:"flex",height:"100%"}},void 0,s()("div",{style:{boxShadow:`0 -1px 0 ${this.theme.tableDividerColor}`}},void 0,this.renderMenu(!0)),s()("div",{style:{width:e}})))})})}return s()(ct.ZP,{popupType:this.environment.device.isMobile?ct.kQ.SlideUp:ct.kQ.Popup,open:o,placementToOrigin:Ta.Iw.Bottom,alignmentToOrigin:Ta.lU.End,style:{marginTop:-1},origin:s()("div",{}),render:this.renderMenu,onDismiss:this.handleClose,originRect:this.props.headerSizeObserver.rect.state})}}settingsOpen(){const{collectionContextStore:e}=this.props,t=e.settingsStore.state;return t.open&&!0!==t.hideSettingsPopup}getPlacement(e){const{collectionContextStore:t}=this.props;if(!this.settingsOpen())return;const o=(null==e?void 0:e.width)||0;return this.environment.device.isMobile||Be.default.isSidePeekOpen()||!(t.isFullScreen.state||o>600)?"popup":"sidebar"}getCurrentViewType(){var e;const{collectionContextStore:t}=this.props,o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType();if(!o)throw new Error("View type was not defined.");return o}}Ia.displayName="CollectionViewSettingsPopup";const Ma={translateX:{stiffness:120,damping:12,precision:.1},opacity:{stiffness:120,damping:10,precision:.001}},Ba=(0,P.injectIntl)(Ia);let Va;class Fa{constructor(e){this.style=void 0,this.lastResult=void 0,this.style=e.style}measure(e){var t;if(e===(null===(t=this.lastResult)||void 0===t?void 0:t.text))return this.lastResult.rect;Va||(Va=document.createElement("div"),Va.style.position="absolute",Va.style.left="0",Va.style.top="0",Va.style.pointerEvents="none",Va.style.opacity="0",document.body.appendChild(Va)),a().forOwn(this.style,((e,t)=>{Va&&(Va.style[t]=e)})),Va.textContent=e;const o=Va.getBoundingClientRect();return this.lastResult={text:e,rect:o},o}}var Da=o(1136),Ea=o(29798),Aa=o(13401),_a=o(73657);class Za extends h.Z{renderComponent(){const e=this.getMenuSections();return s()(st.Z,{type:st.i.Vertical,initialFocus:void 0,sections:l.compact(e.map(((e,t)=>{if(e.length>0)return{key:t,render:e=>c.createElement(dt.Z,i()({},e,{topBorder:0!==t})),items:e}})))})}getMenuSections(){const{onClose:e,collectionContextStore:t,collectionViewStore:o,intl:r}=this.props,n=t.permissionScopes.state,l=t.collectionViewStore(),a=t.collectionViewBlockStore();if(!l||!a)return[];const d=l.id===o.id,h=o.getAppConfigUri(),p=!(0,cr.$K)(h)||!(0,$.xB)(h),u=[];if(u.push([]),n.canConfigureBlock){if(u[0].push({key:"rename",render:e=>s()(ht.Z,{placement:ht.Z.Placement.Left,disableTooltip:p,render:t=>c.createElement(rt.Z,i()({},e,{disabled:!p,disabledFeedback:!0,title:s()(P.FormattedMessage,{defaultMessage:"Rename",id:"database.viewSettings.viewActionMenu.rename"}),icon:y.Z.rename(this.getSvgIconStyle(!1))},t)),renderTooltip:()=>s()(P.FormattedMessage,{id:"database.viewSettings.viewActionMenu.cannotRename",defaultMessage:"This view can’t be renamed."})}),action:()=>{B.wd({environment:this.environment,collectionContextStore:t,action:"view_action_menu_rename"}),null==e||e(!0),d||E.f8({environment:this.environment,collectionContextStore:t,collectionViewId:o.id,isFullScreen:t.isFullScreen.state,isRootChild:t.isRootChild.state,isInPeekRenderer:t.isInPeekRenderer.state}),F.r$({collectionContextStore:t,collectionSettingsStore:t.settingsStore,selectViewNameInitial:!0})}}),"page"===o.getType())return u;u[0].push({key:"edit",render:e=>c.createElement(rt.Z,i()({},e,{title:s()(P.FormattedMessage,{defaultMessage:"Edit view",id:"database.viewSettings.viewActionMenu.editView"}),icon:y.Z.options(this.getSvgIconStyle(!1))})),action:()=>{B.wd({environment:this.environment,collectionContextStore:t,action:"view_action_menu_edit"}),null==e||e(!0),d||E.f8({environment:this.environment,collectionContextStore:t,collectionViewId:o.id,isFullScreen:t.isFullScreen.state,isRootChild:t.isRootChild.state,isInPeekRenderer:t.isInPeekRenderer.state}),F.r$({collectionContextStore:t,collectionSettingsStore:t.settingsStore})}})}u.push([]),u[1].push({key:"copyLink",render:e=>c.createElement(rt.Z,i()({},e,{title:s()(P.FormattedMessage,{defaultMessage:"Copy link to view",id:"database.viewSettings.viewActionMenu.copyLink"}),icon:y.Z.link(this.getSvgIconStyle(!1))})),action:async()=>{B.wd({environment:this.environment,collectionContextStore:t,action:"view_action_menu_copy_link"}),await F.Ol({environment:this.environment,collectionContextStore:t,collectionViewStore:o}),null==e||e(!1)}});return o.getFormat().hide_linked_collection_name&&n.canConfigureBlock&&u[1].push({key:"showDatabaseTitle",render:e=>c.createElement(rt.Z,i()({},e,{title:s()(P.FormattedMessage,{defaultMessage:"Show database title",id:"database.viewSettings.viewActionMenu.showDatabaseTitle"}),icon:y.Z.eyePadded(this.getSvgIconStyle(!0))})),action:()=>{B.wd({environment:this.environment,collectionContextStore:t,action:"click_source_show_title"}),N.createAndCommit({userAction:"CollectionViewActionMenu.getMenuSections",environment:this.environment,perform:e=>{Le.FH({stores:[o],update:{hide_linked_collection_name:!1},transaction:e})}}),null==e||e(!1)}}),u.push([]),n.canConfigureBlock&&u[2].push({key:"duplicate",render:e=>c.createElement(rt.Z,i()({},e,{title:s()(P.FormattedMessage,{defaultMessage:"Duplicate",id:"database.viewSettings.viewActionMenu.duplicate"}),icon:y.Z.duplicate(this.getSvgIconStyle(!1))})),action:()=>{B.wd({environment:this.environment,collectionContextStore:t,action:"view_action_menu_duplicate"}),F.zt({environment:this.environment,collectionContextStore:t,collectionViewStore:o,collectionSettingsStore:t.settingsStore,intl:r}),null==e||e(!0)}}),n.canConfigureBlock&&u[2].push({key:"delete",render:e=>c.createElement(rt.Z,i()({},e,{title:s()(P.FormattedMessage,{defaultMessage:"Delete",id:"database.viewSettings.viewActionMenu.delete"}),icon:y.Z.trash(this.getSvgIconStyle(!1))})),action:async()=>{B.wd({environment:this.environment,collectionContextStore:t,action:"view_action_menu_delete"});await F.TT({environment:this.environment,collectionContextStore:t,collectionViewStore:o,collectionSettingsStore:t.settingsStore,from:"view_action_menu"})&&(null==e||e(!1))}}),a.getAppContainerBlockStore()&&u.push([{key:"edit settings",render:e=>c.createElement(rt.Z,i()({},e,{icon:y.Z.options(this.getSvgIconStyle(!1)),title:s()(P.FormattedMessage,{defaultMessage:"Edit {databaseName} settings",id:"CollectionViewActionMenu.editSettings",values:{databaseName:s()(wi.Z,{store:a,style:{display:"inline"}})}})})),action:()=>{F.tS({environment:this.environment,store:a}),null==e||e(!0)}}]),u}getSvgIconStyle(e){return{width:24,height:e?24:16,fill:this.theme.regularIconColor}}}Za.displayName="CollectionViewActionMenu";const La=(0,P.injectIntl)(Za);class Oa extends h.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:me.Z},this.renderActionMenu=()=>{const{device:e}=this.environment;let t;return t=e.isMobile?{menuType:et.og.ActionSheet}:{menuType:et.og.Popup,width:220},c.createElement(nt.Z,t,c.createElement(La,i()({},this.props,{onClose:this.handleClose})))},this.handleClose=e=>{this.stores.buttonPopupStore.setState({open:!1}),e&&this.props.onClose()}}renderComponent(){const{collectionViewStore:e,menuListItemProps:t}=this.props,o=e.getName(),r=e.getType(),n=e.getFormat().collection_view_icon;if(void 0!==r)return c.createElement(rt.Z,i()({title:s()(ji.Z,{collectionViewType:r,collectionViewName:o}),icon:s()(Da.F,{color:"regular",viewIcon:n,viewType:r}),showDragHandle:this.showDragHandle(),right:this.renderActionsPopup(),rightStyle:{marginRight:8}},t))}renderActionsPopup(){const{device:e}=this.environment,{buttonPopupStore:t}=this.stores,{collectionContextStore:o}=this.props;if(o.permissionScopes.state.canConfigureBlock)return s()(it.ZP,{popupType:e.isMobile?it.Z4.SlideUp:it.Z4.Popup,renderOrigin:e=>c.createElement(lo.Z,i()({icon:y.Z.dots},e)),render:this.renderActionMenu,buttonPopupStore:t})}showDragHandle(){const{collectionContextStore:e}=this.props,t=e.permissionScopes.state,{device:o}=this.environment;return!o.isMobile&&t.canConfigureBlock}}Oa.displayName="CollectionViewSelectItem";const Ga=(0,P.injectIntl)(Oa),Ha=(0,P.defineMessages)({suggestedSectionTitle:{defaultMessage:"Suggested",id:"database.collectionViewSuggestedViews.suggestedTitle"}});function za(e,t){const o=(0,vo.O7)(),r=(0,yo.VK)((()=>ue.default.state.currentSpaceViewStore),[]),n=(0,yo.VK)((()=>e.collectionViewBlockStore()),[e]),l=(0,yo.VK)((()=>e.collectionStore()),[e]),a=(0,yo.VK)((()=>{var e;if(!l)return;const t=null===(e=l.getFormat())||void 0===e?void 0:e.app_config_uri;return t?(0,$.vi)(t):void 0}),[l]),d=c.useCallback((i=>{if(!n||!a||!r)return;const s=n.getParentStore();if(!s||"block"!==s.table&&"space"!==s.table&&"team"!==s.table)return;if(1!==i.dependencies.length)return;const l=i.dependencies[0];N.createAndCommit({userAction:"CollectionViewSuggestedViews.createView",environment:o,perform:c=>{var d;I.aT({environment:o,spaceViewStore:r,appParentStore:s,appUri:a.uri,features:[{type:"simple",featureUri:i.uri}],appCollectionViewBlockStores:[n],createOrModify:"modify",transaction:c});const h=((null===(d=n.getFormat())||void 0===d?void 0:d.app_uri_map)??{})[l.uri];E.f8({environment:o,collectionContextStore:e,collectionViewId:h,isFullScreen:e.isFullScreen.state,isRootChild:e.isRootChild.state,isInPeekRenderer:e.isInPeekRenderer.state}),t()}}),B.xb({environment:o,collectionContextStore:e,view_type:l.value.type,view_config_uri:i.uri})}),[n,a,r,o,e,t]);return{renderSuggestedView:c.useCallback((e=>({key:e.uri,render:t=>s()(ht.Z,{placement:ht.Z.Placement.Left,render:o=>((e,t)=>{var o;const r=e.dependencies[0],n=s()(Da.F,{color:"regular",viewIcon:null===(o=r.value.format)||void 0===o?void 0:o.collection_view_icon,viewType:r.value.type});return c.createElement(rt.Z,i()({title:r.value.name?r.value.name:"New View",icon:n},t))})(e,{...t,...o,onMouseEnter:e=>{var r,i;null===(r=o.onMouseEnter)||void 0===r||r.call(o,e),null===(i=t.onMouseEnter)||void 0===i||i.call(t,e)}}),renderTooltip:()=>e.description}),action:()=>{d(e)}})),[d])}}function Na(e){window.__c={n:"CollectionViewSuggestedViews"};const t=(0,vo.O7)().device,o=(0,fo.yK)((e=>({showMoreLabel:{color:e.mediumTextColor}})),[]),r=e.suggestedViews,{renderSuggestedView:n}=za(e.collectionContextStore,e.onClose),[l,a]=(0,c.useState)(!1),{collectionContextStore:d,onClose:h,onNewEmptyViewClick:p}=e,u=(0,yo.VK)((()=>d.permissionScopes.state),[d]),m=(null==r?void 0:r.map((e=>n(e))))??[],g={key:"showMore",render:e=>c.createElement(rt.Z,i()({},e,{style:o.showMoreLabel,title:s()(P.FormattedMessage,{defaultMessage:"Show more...",id:"collectionViewSuggestedViews.showMore.label"})})),action:()=>{a(!0)}},S=s()(st.Z,{type:st.i.Vertical,initialFocus:0,sections:[{key:"suggested_views",render:e=>c.createElement(dt.Z,e),items:l||m.length<=5?m:[...m.slice(0,5),g]}]}),v=u.canConfigureBlock&&s()(dt.Z,{topBorder:!0},void 0,s()(Aa.Z,{title:s()(P.FormattedMessage,{defaultMessage:"New empty view",id:"database.collectionViewSuggestedViews.newEmptyViewTitle"}),onClick:()=>{p("CollectionViewSuggestedViews2.handleNewEmptyViewClick"),h()},focused:!1}));return s()(Yn.Z,{capture:!0,allowEsc:!0,render:e=>{let o;return o=t.isMobile?{menuType:et.og.Modal,title:ie.default.formatMessage(Ha.suggestedSectionTitle),right:s()(lt.DoneMenuText,{}),onClickRight:h,...e}:{menuType:et.og.Popup,minWidth:290,maxWidth:320,maxHeight:"50vh",...e},c.createElement(nt.Z,o,m.length&&s()(dt.Z,{title:!t.isMobile&&ie.default.formatMessage(Ha.suggestedSectionTitle),disableMobilePadding:!0,topBorder:!1,desktopTitleStyle:{marginTop:2,marginBottom:2},style:{paddingBottom:0}},void 0,S),v)}})}class Wa extends h.Z{constructor(){super(...arguments),this.initialMenuListFocus=0,this.storeTypes={menuListStore:Ea.Z,viewFilterQueryStore:m.default.createClass("")},this.renderViewsSection=e=>{if(this.isDraggable()){const t=this.getFilteredViewStores().map((e=>e.id));return c.createElement(dt.Z,i()({},e,{children:s()(li.ZP,{direction:"vertical",keys:t,renderKey:o=>e.children[t.indexOf(o)],onDrop:this.handleViewsDrop})}))}return c.createElement(dt.Z,e)},this.renderViewMenuItem=(e,t)=>{const{collectionContextStore:o,onClose:r}=this.props;return s()(Ga,{collectionContextStore:o,collectionViewStore:e,onClose:r,menuListItemProps:t})},this.handleViewClick=(e,t)=>{const o=this.props.collectionContextStore.collectionViewStore();o&&this.props.onViewClick({currentCollectionViewStore:o,newCollectionViewStore:e,openInNew:t}),this.setCurrentView(e,t),t||this.props.onClose()},this.handleCreateButtonClick=()=>{this.props.onAddViewClick("CollectionViewSelect2.handleCreateButtonClick"),this.props.onClose()},this.handleViewsDrop=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewBlockStore();o&&(N.createAndCommit({userAction:"CollectionViewSelect2.handleViewsDrop",environment:this.environment,perform:t=>{E.Wu({collectionViewBlockStore:o,newViewIds:e,transaction:t})}}),this.stores.menuListStore.reset())},this.handleViewFilterQueryChange=e=>{this.stores.viewFilterQueryStore.setState(e.target.value),this.stores.menuListStore.setState({...this.stores.menuListStore.state,focus:{section:0,indexLocal:0,indexGlobal:0}})},this.filterView=e=>(0,ee.D)(e,this.stores.viewFilterQueryStore.state)}willMount(e){var t,o;const{collectionContextStore:r}=e,i=null===(t=r.collectionViewStore())||void 0===t?void 0:t.id,n=((null===(o=r.collectionViewBlockStore())||void 0===o?void 0:o.getCollectionViewStores())||[]).findIndex((e=>e.id===i));n>=0&&(this.initialMenuListFocus=n),this.stores.viewFilterQueryStore.setState("")}renderComponent(){const{intl:e,collectionContextStore:t,onClose:o,onAddViewClick:r}=this.props,{device:n}=this.environment,l=t.permissionScopes.state,a=s()(Aa.Z,{title:s()(P.FormattedMessage,{defaultMessage:"Add view",id:"database.collectionViewSelect.addViewButtonTitle"}),onClick:this.handleCreateButtonClick,focused:!1});return s()(Yn.Z,{capture:!0,allowEsc:!0,render:d=>{var h,p;let u;u=n.isMobile?{menuType:et.og.Modal,title:this.renderMenuTitle(),right:s()(lt.DoneMenuText,{}),onClickRight:this.props.onClose,...d}:{menuType:et.og.Popup,minWidth:290,maxWidth:320,maxHeight:"50vh",...d};const m=l.canConfigureBlock&&s()(dt.Z,{topBorder:!0},void 0,this.props.suggestedViews&&this.props.suggestedViews.length?s()(it.ZP,{popupType:this.environment.device.isMobile?ct.kQ.SlideUp:ct.kQ.Popup,alignmentToOrigin:it.vR.Center,placementToOrigin:it.pO.Right,renderOrigin:e=>c.createElement(Aa.Z,i()({title:s()(P.FormattedMessage,{defaultMessage:"Add view",id:"database.collectionViewSelect.addViewButtonTitle"}),focused:!1},e)),render:()=>s()(Na,{collectionContextStore:t,suggestedViews:this.props.suggestedViews??[],onClose:o,onNewEmptyViewClick:r})}):a);return c.createElement(nt.Z,i()({},u,{header:!n.isMobile&&!(null!==(h=t.collectionViewBlockStore())&&void 0!==h&&h.isCollectionViewPageWithContent())&&s()(or.ZP,{value:this.stores.viewFilterQueryStore.state,focus:!0,style:{marginTop:8,marginBottom:4},textWrapperStyle:{marginLeft:8,marginRight:8},onChange:this.handleViewFilterQueryChange,placeholder:e.formatMessage({defaultMessage:"Search for a view...",id:"collectionViewSelect.viewSearch.label"})}),footer:!n.isMobile&&m}),s()(dt.Z,{title:!n.isMobile&&!(null!==(p=t.collectionViewBlockStore())&&void 0!==p&&p.isCollectionViewPageWithContent)&&this.renderMenuTitle(),disableMobilePadding:!0,topBorder:!1,desktopTitleStyle:{marginTop:0,marginBottom:0}},void 0,this.renderMenuList()),this.stores.viewFilterQueryStore.state&&0===this.getFilteredViewStores().length&&s()(_a.Z,{caption:s()(P.FormattedMessage,{defaultMessage:"No results",id:"database.collectionViewSelect.noResultsTitle"})}),n.isMobile&&m)}})}renderMenuList(){const e=this.getFilteredViewStores();if(e.length>0)return s()(st.Z,{type:st.i.Vertical,initialFocus:this.initialMenuListFocus,sections:[{key:"views",render:this.renderViewsSection,items:e.map((e=>({key:e.id,render:t=>this.renderViewMenuItem(e,t),action:t=>{let{event:o}=t;this.handleViewClick(e,te.DJ(o))}})))}],store:this.stores.menuListStore})}renderMenuTitle(){return s()(P.FormattedMessage,{defaultMessage:"{numberOfViews, plural, one {{numberOfViews} view} other {{numberOfViews} views}}",id:"database.mobileSelectViewMenu.title",values:{numberOfViews:this.getViewStores().length}})}setCurrentView(e,t){E.f8({environment:this.environment,collectionContextStore:this.props.collectionContextStore,collectionViewId:e.id,openInNew:t,isFullScreen:this.props.isFullScreen,isRootChild:this.props.isRootChild,isInPeekRenderer:this.props.isInPeekRenderer}),B.wd({environment:this.environment,collectionContextStore:this.props.collectionContextStore,action:"click_view_in_dropdown",new_view_type:e.getType(),new_view_id:e.id})}getViewStores(){var e;const{collectionContextStore:t}=this.props;return(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())||[]}getFilteredViewStores(){return this.getViewStores().filter(this.filterView)}isDraggable(){return this.showDragHandle()&&""===this.stores.viewFilterQueryStore.state}showDragHandle(){const{collectionContextStore:e}=this.props,t=e.permissionScopes.state,{device:o}=this.environment;return!o.isMobile&&t.canConfigureBlock}}Wa.displayName="CollectionViewSelect";const Ka=(0,P.injectIntl)(Wa);var Ua=o(14976),$a=o(26991);class qa extends h.Z{constructor(){super(...arguments),this.storeTypes={popupOpen:m.default.createClass(!1)},this.renderPopup=()=>{const{device:e}=this.environment;let t;return t=e.isPhone?{menuType:et.og.Modal,right:s()(lt.DoneMenuText,{}),onClickRight:this.handleClose}:{menuType:et.og.Popup,minWidth:220},c.createElement(nt.Z,t,c.createElement(La,i()({},this.props,{onClose:this.handleClose})))},this.handleClick=e=>{const{collectionViewStore:t,collectionContextStore:o}=this.props,r=o.collectionViewStore();if(!r)return;const i=te.DJ(e);this.props.onViewClick({currentCollectionViewStore:r,newCollectionViewStore:t,openInNew:i}),r.id===t.id?this.stores.popupOpen.setState(!0):this.setCurrentView(t.id,i),B.wd({environment:this.environment,collectionContextStore:o,action:"click_view_tab",new_view_type:t.getType(),new_view_id:t.id})},this.handleContextMenu=e=>{e.preventDefault(),(0,re.ZP)({event:e,context:re.Af.EditorContextMenu,callback:()=>{this.stores.popupOpen.setState(!0)}})},this.handleClose=()=>{this.stores.popupOpen.setState(!1)}}renderComponent(){var e,t,o;const{collectionViewStore:r,collectionContextStore:n}=this.props,{popupOpen:l}=this.stores,{device:a}=this.environment,d=(0,c.createRef)(),h=this.getCurrentCollectionViewStore();if(!r.isDefined()||!h)return;const p=r.getType(),u=r.getFormat().collection_view_icon,m=h.id===r.id,g=(null===(e=n.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||"none",v=n.collectionViewBlockStore();if(!v)return c.createElement(c.Fragment,null);const y=v.getSpaceId()!==(null===(t=ue.default.state.currentSpaceStore)||void 0===t?void 0:t.id),f=r.getFormat().app_config_uri===S.g3&&(0,$.wY)()&&"sprint_board"===(null===(o=ue.default.state.mainEditorCurrentBlockStore)||void 0===o?void 0:o.getFormat().special_page_for_pm_launch)&&!y;return s()(ct.ZP,{popupType:a.isMobile?ct.kQ.SlideUp:ct.kQ.Popup,alignmentToOrigin:ct.ZP.Alignment.Start,open:l.state,render:this.renderPopup,onDismiss:this.handleClose,origin:s()("div",{className:q.rTm,style:{display:"flex",alignItems:"center",background:g,height:"100%",...m&&{borderBottom:`2px solid ${this.theme.regularTextColor}`,paddingTop:2}},onContextMenu:this.handleContextMenu},void 0,f&&s()($t.FF,{origin:d}),s()(Qa,{collectionViewStore:r,render:e=>c.createElement(at.Z,i()({"aria-selected":m,role:"tab",ref:d,key:r.id,style:{display:"flex",alignItems:"center",fontSize:14,fontWeight:x.Z.fontWeight.medium,color:m?this.theme.regularTextColor:this.theme.mediumTextColor,maxWidth:tc},hovered:l.state,onClick:this.handleClick},e),s()(Da.F,{color:m?"regular":"light",viewIcon:u,viewType:p,style:{marginRight:6}}),s()("span",{style:{...x.Z.textOverflowStyle,marginTop:1}},void 0,s()(Ya,{collectionContextStore:n,collectionViewStore:r})))}))})}setCurrentView(e,t){const{collectionContextStore:o}=this.props;E.f8({environment:this.environment,collectionContextStore:o,collectionViewId:e,openInNew:t,isFullScreen:o.isFullScreen.state,isRootChild:o.isRootChild.state,isInPeekRenderer:o.isInPeekRenderer.state})}getCurrentCollectionViewStore(){return this.props.collectionContextStore.collectionViewStore()}}function Qa(e){window.__c={n:"CollectionViewTabTooltip"};const t=(0,fo.Fg)(),o=(0,P.useIntl)(),{collectionViewStore:r,render:i}=e,n=(0,yo.VK)((()=>r.getCollectionStore()),[r]),l=(0,yo.VK)((()=>null==n?void 0:n.getModel()),[n]),a=(0,yo.VK)((()=>r.getModel()),[r]);return a?s()(ht.Z,{placement:ht.Z.Placement.Bottom,alignment:ht.Z.Alignment.Start,delayThreshold:800,render:i,renderTooltip:()=>c.createElement(c.Fragment,null,s()("div",{},void 0,(0,ee.Cc)({collectionViewName:a.getName(),collectionViewType:a.getType()})),n&&l&&s()("div",{style:{color:t.mediumInvertedTextColor}},void 0,s()(P.FormattedMessage,{defaultMessage:"{viewType, select, Table {Table view of {collection}} Board {Board view of {collection}} Timeline {Timeline view of {collection}} Calendar {Calendar view of {collection}} List {List view of {collection}} Gallery {Gallery view of {collection}} other {collection}}",id:"collectionTabBar.viewTab.tooltip",values:{viewType:vt.Bh[a.getType()],collection:(0,Ua.Xh)(n.getName(),n)||l.getEmptyTitlePlaceholder({intl:o})}})))}):null}function Ya(e){window.__c={n:"CollectionViewTabTitle"};const{collectionViewStore:t,collectionContextStore:o}=e,[r,i]=(0,yo.VK)((()=>{const e=o.settingsStore.state;return[e.open,a().last(e.stack)]}),[o.settingsStore]),n=(0,yo.VK)((()=>o.collectionViewStore()),[o]),l=(0,yo.VK)((()=>t.getCollectionStore()),[t]),c=(0,yo.VK)((()=>{if(t.isDefined()){return(null==t?void 0:t.getFormatStore().getKeyStore("app_config_uri").getValue())===S.g3&&null!=l&&l.isDefined()?{name:(0,$a.fz)(o,t,l.getSchema()),type:t.getType()}:{name:t.getName(),type:t.getType()}}}),[t,l,o]);return!c||n&&n.id===t.id&&r&&i&&("duplicateExistingView"===i.type||"createViewSource"===i.type||"createView"===i.type)?s()(P.FormattedMessage,{defaultMessage:"New view",id:"collectionTabBar.newViewPlaceholder.title"}):s()(ji.Z,{collectionViewName:c.name,collectionViewType:c.type})}qa.displayName="CollectionViewTab";const ja=(0,P.injectIntl)(qa);var Xa=o(78454);function Ja(e){window.__c={n:"WikiHomeOnboardingTooltip"};const{origin:t}=e,o=(0,vo.O7)();return s()(nl.U,{origin:t,placementToOrigin:"bottom",header:s()(P.FormattedMessage,{id:"WikiHomeOnboardingTooltip.header",defaultMessage:"Welcome to your new wiki!"}),content:s()(P.FormattedMessage,{defaultMessage:"Viewers will have the same reading experience as before, but editors have new features to keep content up to date",id:"WikiHomeOnboardingTooltip.content"}),onCloseClick:()=>{bs.Rg(o)},shouldDismissUponOutsideClick:!0,pointerPosition:"18%",pointerLength:ll.EZ,pointerOffset:ll.rK,style:{width:ll.G5}})}function ec(e){window.__c={n:"WikiViewsOnboardingTooltip"};const{origin:t}=e,o=(0,vo.O7)();return s()(nl.U,{origin:t,placementToOrigin:"right",header:s()(P.FormattedMessage,{id:"WikiViewsOnboardingTooltip.header",defaultMessage:"New views"}),content:s()(P.FormattedMessage,{defaultMessage:"The <bold>All pages</bold> and <bold>Pages I own</bold> views will give you an overview of pages in your wiki",id:"WikiViewsOnboardingTooltip.content",values:{bold:e=>s()("span",{style:{fontWeight:x.Z.fontWeight.semibold}},void 0,e)}}),onCloseClick:()=>{bs.Rg(o)},pointerPosition:"50%",pointerLength:ll.EZ,pointerOffset:ll.FD,shouldDismissUponOutsideClick:!0,style:{width:ll.G5}})}const tc=220;class oc extends h.Z{constructor(){super(...arguments),this.viewSelectContainerSizeObserver=new De.E({throttleMs:200}),this.viewIdWidthEstimatorMap=new Map,this.homeViewRef=c.createRef(),this.viewsDropdownRef=c.createRef(),this.storeTypes={buttonPopupStore:me.Z},this.renderViewsPopup=(e,t)=>{var o;const{collectionContextStore:r}=this.props,{device:i}=this.environment,n=r.isFullScreen.state,l=r.isRootChild.state,a=r.isInPeekRenderer.state,d=(null===(o=r.collectionStore())||void 0===o?void 0:o.getFormat().app_config_uri)===S.GZ;return c.createElement(c.Fragment,null,!i.isMobile&&"views"===bs.B1()&&d&&s()(ec,{origin:this.viewsDropdownRef}),c.createElement("div",{ref:this.viewsDropdownRef},s()(Ka,{collectionContextStore:r,onAddViewClick:this.handleAddViewClick,suggestedViews:t,onClose:e.close,isFullScreen:n,isRootChild:l,isInPeekRenderer:a,onViewClick:this.props.onViewClick})))},this.renderViewTab=e=>{const{collectionContextStore:t,onViewClick:o}=this.props;return s()(ja,{collectionContextStore:t,collectionViewStore:e,onViewClick:o})},this.handleViewSelectContainerMount=e=>{e&&this.viewSelectContainerSizeObserver.observe(e)},this.handleViewTabsDrop=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewBlockStore();o&&N.createAndCommit({userAction:"CollectionViewTabBar.handleViewTabsDrop",environment:this.environment,perform:t=>{E.Wu({collectionViewBlockStore:o,newViewIds:e,transaction:t})}})},this.renderSuggestedViewsPopup=(e,t)=>{const{collectionContextStore:o}=this.props;return s()(Na,{collectionContextStore:o,suggestedViews:t,onClose:e.close,onNewEmptyViewClick:this.handleAddViewClick})},this.handleAddViewClick=e=>{const{collectionContextStore:t}=this.props;N.createAndCommit({userAction:e,environment:this.environment,perform:e=>{E.ME({environment:this.environment,collectionContextStore:t,transaction:e})}}),B.xb({environment:this.environment,collectionContextStore:t,view_type:"table"})},this.handleMoreViewsClick=()=>{const{collectionContextStore:e}=this.props;B.wd({environment:this.environment,collectionContextStore:e,action:"click_views_dropdown"})},this.renderStateStore=this.createComputedStore((()=>{var e;const{collectionContextStore:t,showHoverActionsStore:o}=this.props,{device:r}=this.environment,i=this.getViewStores(),n=this.showViewTabsStore.state,s=(null==n?void 0:n.length)||0,l=i.length-s,a=(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.isCollectionViewPageWithContent())||r.isPhone||n&&(0===s||1===s&&i.length>1)?"dropdown":l>0?"someTabsNotVisible":"allTabsVisible",c=t.isFullScreen.state||o.state;return{showMoreViewsButton:"someTabsNotVisible"===a||"dropdown"===a,showAddViewButton:this.shouldAttemptToShowAddViewButton()&&"allTabsVisible"===a,addViewButtonAnimatedIn:c,viewSelectState:a,moreViewsCount:l}})),this.showViewTabsStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=this.getViewStores(),o=e.collectionViewStore();if(!o)return;const r=Math.max(100,this.shouldAttemptToShowAddViewButton()?105:0);let i=this.viewSelectContainerSizeObserver.rect.state.width-r;const n=[],s=this.measureViewTabWidth(o);if(!(s<i))return n;n.push(o),i-=s;for(const c of t)if(c.id!==o.id){const e=this.measureViewTabWidth(c);if(!(e<i))break;n.push(c),i-=e}const l=n.filter((e=>e.id!==o.id)),a=t.findIndex((e=>e.id===o.id));return l.splice(a,0,o),l}))}willUnmount(){super.willUnmount(),this.viewSelectContainerSizeObserver.destroy()}renderComponent(){const e=this.renderStateStore.state,t=this.getSuggestedViewsForTypedDB();return c.createElement("div",{role:"tablist",style:{display:"flex",alignItems:"center",height:"100%",flexGrow:1},ref:this.handleViewSelectContainerMount},this.renderViewTabs(),e.showMoreViewsButton&&s()(it.ZP,{popupType:this.environment.device.isMobile?ct.kQ.SlideUp:ct.kQ.Popup,render:e=>this.renderViewsPopup(e,t),renderOrigin:e=>this.renderViewSelectButton(e),onClick:this.handleMoreViewsClick}),e.showAddViewButton&&s()(Sn.Z,{isVisible:!0,animationStyle:{opacity:e.addViewButtonAnimatedIn?1:0},render:()=>t&&t.length?s()(it.ZP,{popupType:it.Z4.Popup,alignmentToOrigin:Xa.v2.Center,render:e=>this.renderSuggestedViewsPopup(e,t),renderOrigin:e=>c.createElement(lo.Z,i()({className:q.rVO,icon:y.Z.plus},e))},"suggested-views"):s()(lo.Z,{className:q.rVO,icon:y.Z.plus,onClick:()=>this.handleAddViewClick("CollectionViewTabBar.handleAddViewClick")})}))}renderViewSelectButton(e){var t;const{collectionContextStore:o}=this.props,{device:r}=this.environment,n=this.renderStateStore.state,l=this.getCurrentCollectionViewStore();if(!l)return;if(!l.isDefined())return;const a=(null===(t=o.collectionStore())||void 0===t?void 0:t.getFormat().app_config_uri)===S.GZ&&"page"===l.getType();if("dropdown"===n.viewSelectState){const t=l.getType(),n=l.getFormat().collection_view_icon;return c.createElement(c.Fragment,null,!r.isMobile&&a&&"home"===bs.B1()&&s()(Ja,{origin:this.homeViewRef}),s()(Qa,{collectionViewStore:l,render:r=>c.createElement(at.Z,i()({ref:this.homeViewRef,style:{display:"flex",alignItems:"center",fontSize:x.Z.fontSize.UIRegular.desktop,fontWeight:x.Z.fontWeight.semibold,color:this.theme.regularTextColor,maxWidth:tc}},e,r),s()(Da.F,{color:"regular",viewType:t,viewIcon:n,style:{marginRight:6}}),s()("span",{style:{...x.Z.textOverflowStyle,marginRight:6,marginTop:1}},void 0,s()(Ya,{collectionContextStore:o,collectionViewStore:l})),y.Z.chevronDown({marginTop:2,width:10,height:10,fill:this.theme.lightIconColor}))}))}return"someTabsNotVisible"===n.viewSelectState?c.createElement(at.Z,i()({style:{display:"flex",alignItems:"center",fontSize:x.Z.fontSize.UIRegular.desktop,color:this.theme.mediumTextColor}},e),s()("span",{style:{marginTop:1}},void 0,s()(P.FormattedMessage,{defaultMessage:"{moreViewsCount} more…",id:"collectionTabBar.showMoreViews.title",values:{moreViewsCount:n.moreViewsCount}}))):void 0}renderViewTabs(){const{collectionContextStore:e}=this.props,t=e.permissionScopes.state,o=this.showViewTabsStore.state,r=this.renderStateStore.state;if(o&&"dropdown"!==r.viewSelectState)return t.canConfigureBlock?s()(li.ZP,{direction:"horizontal",keys:o.map((e=>e.id)),style:{height:"100%"},disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,renderKey:e=>{const t=o.find((t=>t.id===e));if(t)return this.renderViewTab(t)},onDrop:this.handleViewTabsDrop}):o.map(this.renderViewTab)}shouldAttemptToShowAddViewButton(){const{collectionContextStore:e,isPlaceholderExternalCollectionStore:t}=this.props;return e.permissionScopes.state.canConfigureBlock&&!t.state}measureViewTabWidth(e){const t=e.getName(),o=e.getType();if(!o)return 0;let r=this.viewIdWidthEstimatorMap.get(e.id);r||(r=new Fa({style:{fontSize:`${x.Z.fontSize.UIRegular.desktop}px`,fontWeight:x.Z.fontWeight.medium}}),this.viewIdWidthEstimatorMap.set(e.id,r));const i=(0,ee.Cc)({collectionViewName:t,collectionViewType:o}),n=r.measure(i);return Math.min(40+n.width,tc)}getViewStores(){var e;return(null===(e=this.getCurrentCollectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())||[]}getCurrentCollectionViewBlockStore(){return this.props.collectionContextStore.collectionViewBlockStore()}getCurrentCollectionViewStore(){return this.props.collectionContextStore.collectionViewStore()}getSuggestedViewsForTypedDB(){const e=this.props.collectionContextStore.collectionStore(),t=this.props.collectionContextStore.collectionViewBlockStore();if(!e||!t)return;const o=e.getFormat().app_config_uri,r=o?(0,$.vi)(o):void 0;return r?(0,$.AG)(r,e,t):void 0}}oc.displayName="CollectionViewTabBar";const rc=(0,P.injectIntl)(oc);var ic=o(68689),nc=o(74194),sc=o(25821),lc=o(18647),ac=o(76745),cc=o(46736),dc=o(90530),hc=o(95691),pc=o(51944);class uc extends m.default{getInitialState(){return{stage:"NOT_TRACKING"}}}function mc(e){window.__c={n:"SetupInitialDatabaseItemsVisibleTracker"};const{collectionContextStore:t}=e,{handleInitialDatabaseRender:o,handleItemMount:r}=function(e){const t=(0,vo.O7)(),o=(0,yo.qz)(void 0,uc),r=(0,c.useRef)(0),i=(0,c.useCallback)((()=>{"NOT_TRACKING"===o.state.stage&&o.setState({stage:"COUNTING_VISIBLE_ITEMS"})}),[o]),n=(0,c.useCallback)((()=>{if("COUNTING_VISIBLE_ITEMS"===o.state.stage&&(r.current++,1===r.current)){const e=performance.now();p.default.afterNextFlush((()=>{"COUNTING_VISIBLE_ITEMS"===o.state.stage&&o.setState({stage:"SHOULD_TRACK",endTime:e})}))}}),[o]),s=(0,c.useCallback)((o=>{"SHOULD_TRACK"===o.state.stage&&(he.default.measureFromAppStart({metricName:"initial_database_items_visible",endTime:o.state.endTime},{environment:t,data:j.Pp({collectionContextStore:e,visibleItemsCount:r.current||0})}),o.reset(),r.current=0)}),[e,t]);return(0,c.useEffect)((()=>(o.addListener(s),()=>{o.removeListener(s)})),[s,o]),{handleInitialDatabaseRender:i,handleItemMount:n}}(t);return t.initialDatabaseItemsVisibleTracker||(t.initialDatabaseItemsVisibleTracker={handleInitialDatabaseRender:o,handleItemMount:r}),null}const gc=["table","board"],Sc=["timeline"],vc=(0,P.defineMessages)({searchInputPlaceholder:{defaultMessage:"Type to search...",id:"database.searchInputPlaceholder"},openAutomationsSettingsButtonTooltip:{defaultMessage:"Create and view automations",id:"database.collectionViewBlock.openAutomationsSettingsButton.tooltip"},openAutomationsSettingsButtonAriaLabel:{defaultMessage:"Create and view automations",id:"database.collectionViewBlock.openAutomationsSettingsButton.ariaLabel"},openFullscreenPageButtonTooltip:{defaultMessage:"Open as full page",id:"database.collectionViewBlock.openFullscreenPageButton.tooltip"}});class yc{constructor(e,t,o){this.listener=void 0,this.didEmit=void 0,this.lastValue=void 0,this.handleEmit=(e,t,o)=>{let r=!0;this.didEmit||(this.didEmit=!0,r=!1),this.lastValue===t?r=!1:this.lastValue=t,r&&this.onEmit(t,o)},this.environment=e,this.listenerEventKey=t,this.onEmit=o,this.didEmit=!1,this.lastValue=void 0}subscribe(){this.listener=de.Z.addListener(this.listenerEventKey,this.handleEmit,void 0,this.environment)}unsubscribe(){this.listener&&de.Z.removeListener(this.listener,this.environment)}}class fc extends Ee.Z{constructor(){super(...arguments),this.isCollectionViewBlock=!0,this.collectionContextStore=new Se.Z(this.environment),this.headerSizeObserver=new De.E,this.headerEl=null,this.horizontalScrollerEl=null,this.timelineViewRef=c.createRef(),this.parentNode=void 0,this.renderStartTime=void 0,this.subscriptions=new Map,this.collectionTypeChangeSubscription=void 0,this.collectionRefetcher=new an(this.collectionContextStore,this.environment),this.syncStateTimeout=void 0,this.switchViewMetric=void 0,this.storeTypes={collectionContextStore:Se.Z,mouseStore:Pe.Z,headerMouseStore:Pe.Z,focusStore:m.default.createClass(!1),scrollStore:m.default.createClass(!1),noDateResultStore:m.default.createClass(void 0),templateButtonPopupStore:me.Z,filterBarSettingsStore:m.default.createClass({open:!1,stack:[]}),createFilterButtonPopupStore:me.Z,createFilterSettingsStore:m.default.createClass({open:!1,stack:[]}),filterBarCreateFilterSettingsStore:m.default.createClass({open:!1,stack:[]}),createSortSettingsStore:m.default.createClass({open:!1,stack:[]}),viewSettingsPlacementStore:m.default.createClass(void 0),saveControlMoreActionsButtonPopupStore:me.Z},this.renderCreateFilterPopup=()=>{const{collectionContextStore:e}=this,{createFilterSettingsStore:t}=this.stores;return s()(Pn.P,{context:X.HV.TopbarFilterPopup,collectionContextStore:e,collectionSettingsStore:t,hideDesktopHeader:!0})},this.renderCreateSortPopup=()=>{const{collectionContextStore:e}=this,{createSortSettingsStore:t}=this.stores;return s()(Pn.P,{context:X.HV.TopbarSortPopup,collectionContextStore:e,collectionSettingsStore:t,hideDesktopHeader:!0})},this.renderViewSettings=()=>{const e=this.isInPeekRenderer(),t=(0,ee.Ks)(this.props.store)?{paddingLeft:0,paddingRight:0}:this.leftRightPadding.state;if(t)return c.createElement(Ba,i()({collectionContextStore:this.collectionContextStore,headerSizeObserver:this.headerSizeObserver,placementStore:this.stores.viewSettingsPlacementStore,isInPeekRenderer:e},t))},this.renderTemplatesPopup=()=>{const{collectionContextStore:e}=this,{store:t}=this.props,o=e.collectionStore();if(o){if(fe.Z.state.online){const r=e.permissionScopes.state;return s()(In.Z,{isOverlay:!0,collectionStore:o,canConfigureCollection:r.canConfigureCollection,onEmptyPageClick:this.handleTemplateEmptyPageClick,onEmptyEnter:this.handleTemplateEmptyPageClick,onTemplateClick:this.handleTemplateClick,onCancelClick:this.handleTemplateCancelClick,locked:t.isLocked()})}return s()("div",{style:{fontSize:14,color:this.theme.mediumTextColor,width:280,padding:8}},void 0,s()(P.FormattedMessage,{defaultMessage:"Please go online to use a template.",id:"collectionViewBlock.actionBar.offlineTemplatePicker.message"}))}},this.renderNoDatePopup=e=>{const{collectionContextStore:t}=this,o=this.noDateTotal.state,r=t.collectionStore(),i=t.collectionViewStore(),n=this.getNoDateProperty();if(!r||!i||!n)return;const l=i.getType(),a=i.getName();return!i.isDefined()||"timeline"!==l&&"calendar"!==l?void 0:s()(tn,{collectionStore:r,collectionViewId:i.id,property:n,onClose:e.close,onAddPage:this.handleNoDateAddPage,collectionViewType:l,collectionViewName:a,collectionContextStore:t,noDateTotal:o})},this.handleViewSettingsClick=e=>{(0,re.ZP)({event:e,context:re.Af.CollectionSettingsClick,callback:this.handleViewSettingsClickInner}),B.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_view_settings"}),this.projManagementTooltipTourComplete()},this.handleViewSettingsClickInner=()=>{const{collectionContextStore:e}=this,t=e.settingsStore,o=t.state.open,r=(0,ve.n)(t);o&&"main"===(null==r?void 0:r.type)?F.E3({collectionSettingsStore:t}):F.r$({collectionContextStore:e,collectionSettingsStore:t})},this.handleViewAutomationSettingsClick=e=>{(0,re.ZP)({event:e,context:re.Af.CollectionAutomationSettingsClick,callback:this.handleViewAutomationSettingsClickInner})},this.handleViewAutomationSettingsClickInner=()=>{const{collectionContextStore:e}=this,t=e.settingsStore,o=t.state.open,r=(0,ve.n)(t);o&&"automationSettings"===(null==r?void 0:r.type)?F.E3({collectionSettingsStore:t}):(F.r$({collectionContextStore:e,collectionSettingsStore:t}),F.wl({collectionSettingsStore:t,item:{source:"collection_view_settings",type:"automationSettings"}}))},this.handleViewClick=e=>{let{currentCollectionViewStore:t,newCollectionViewStore:o,openInNew:r}=e;if(t.id!==o.id&&!r){const e=t.getType(),r=o.getType();var i;if(e&&r)this.switchViewMetric={from:e,to:r,metric:he.default.mark("collections.switch_view_lag"),sizeHintAtStart:null===(i=this.collectionContextStore.remoteResult.state)||void 0===i?void 0:i.sizeHint}}},this.handleFilterClick=()=>{const{collectionContextStore:e}=this,{createFilterSettingsStore:t}=this.stores,o=e.permissionScopes.state.canConfigureBlock?e.currentCombinatorFilterStore.state:void 0,r=e.currentPropertyFiltersStore.state,i=e.filtersBarOpenStore.state;i||r.length>0||o?e.filtersBarOpen.setState(!i):F.wl({collectionSettingsStore:t,item:{type:"createFilter"}}),B.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_filter"})},this.handleSortClick=()=>{const{collectionContextStore:e}=this,{createSortSettingsStore:t}=this.stores;this.hasSort.state?(e.filtersBarOpen.setState(!0),F.wl({collectionSettingsStore:e.filterBarSortSettingsStore,item:{type:"sort"}})):F.wl({collectionSettingsStore:t,item:{type:"createSort"}}),B.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_sort"})},this.handleCreateFilterPopupDismiss=()=>{const{createFilterSettingsStore:e}=this.stores;F.E3({collectionSettingsStore:e})},this.handleCreateSortPopupDismiss=()=>{const{createSortSettingsStore:e}=this.stores;F.E3({collectionSettingsStore:e})},this.handleCollectionEmit=(e,t)=>{this.collectionRefetcher.handleCollectionEmit({src:"msg",passThroughData:t,shouldQueueCollectionEmit:this.shouldQueueCollectionEmit()})},this.handlePageVisibilityChange=()=>{this.shouldRefetch()&&this.collectionRefetcher.maybeProcessQueuedCollectionEmit("page_show")},this.handlePeekViewChange=()=>{this.shouldRefetch()&&this.collectionRefetcher.maybeProcessQueuedCollectionEmit("exit_peek")},this.shouldQueueCollectionEmit=()=>{var e;return!Ie.Z.state.isVisible||!(!Be.default.isMiniOrCenterPeekOpen()||null!==(e=Be.default.peekTarget.state)&&void 0!==e&&e.uiContains(this.props.store))},this.shouldRefetch=()=>{if(!Be.default.isMiniOrCenterPeekOpen()&&Ie.Z.state.isVisible)return!0},this.handleHeaderMount=e=>{e&&this.headerSizeObserver.observe(e),this.headerEl=e},this.handleHorizontalScrollerMount=e=>{var t;const o=null===(t=this.getCurrentCollectionViewStore())||void 0===t?void 0:t.getType();if(o)if("table"===o){var r;var i;if(null==e||null===(r=e.scrollerEl())||void 0===r?void 0:r.classList.contains(q.PBs))this.horizontalScrollerEl=e;else this.horizontalScrollerEl=(null==e||null===(i=e.context.scrollerContext)||void 0===i?void 0:i.horizontalScroller)||null}else this.horizontalScrollerEl=e},this.handleEditorMouseDown=e=>{const{device:t}=this.environment,o=this.getCurrentCollectionViewStore();if(!o||t.isMobile)return;const r=o.getType();r&&(0,re.ZP)({event:e,context:re.Af.EditorMouseDown,callback:()=>{e.preventDefault(),Z.AI({environment:this.environment,target:e.target,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:"board"===r||"table"===r})}})},this.handleEditorClick=(e,t)=>{(0,re.ZP)({event:e,context:re.Af.EditorClick,callback:()=>{if(this.isInPeekRenderer()||_.E5(this.environment),"page"===t&&!se.X9()){const{clientX:t,clientY:o,target:r}=e;p.default.afterNextFlush((()=>{N.createAndCommit({userAction:"CollectionViewBlock.PageView.click",environment:this.environment,perform:e=>{z.jh(this.environment,{x:t,y:o,target:r instanceof Element?r:void 0},e)}})}))}}})},this.handleScroll=e=>{var t,o;const r=null===(t=this.horizontalScrollerEl)||void 0===t||null===(t=t.scrollerEl())||void 0===t?void 0:t.scrollLeft,i=null===(o=this.leftRightPadding.state)||void 0===o?void 0:o.paddingLeft;void 0!==r&&i&&(r>i?this.stores.scrollStore.setState(!0):this.stores.scrollStore.setState(!1))},this.handleFocusIn=e=>{const t=e.target;null!==t&&t instanceof HTMLElement&&(0,u.E)(t)&&this.stores.focusStore.setState(!0)},this.handleFocusOut=()=>{this.stores.focusStore.setState(!1)},this.handleMouseMove=()=>{we.Z.state||this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0})},this.handleMouseLeave=()=>{this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1})},this.handleHeaderMouseMove=()=>{we.Z.state||this.stores.headerMouseStore.setState({...this.stores.headerMouseStore.state,mouseEntered:!0})},this.handleHeaderMouseLeave=()=>{this.stores.headerMouseStore.setState({...this.stores.headerMouseStore.state,mouseEntered:!1})},this.handleLoadedStoreChange=()=>{if(!this.isLoadedStore.state||!this.componentIsMounted||this.collectionContextStore.wasCreatedThisSession.state||!this.isFullScreen())return;const e=this.environment.RouterStore.state;let t;"page"===e.route.name&&(t=e.route.mobileData);const o=()=>{var e,o,r,i;return{is_push:(null===(e=t)||void 0===e?void 0:e.isPush)??!1,collectionViewType:null===(o=this.collectionContextStore.collectionViewStore())||void 0===o?void 0:o.getType(),initial_route:this.environment.RouterStore.state.initialRoute.name,is_client_mode_enabled:this.collectionContextStore.isClientModeEnabled.state,prefetchCache:null===(r=this.environment.prefetchCache)||void 0===r||null===(r=r.getPrefetchAnalytic("queryCollection"))||void 0===r?void 0:r.type,row_count_category:(0,j.ZO)(null===(i=this.collectionContextStore.remoteResult.state)||void 0===i?void 0:i.sizeHint)}};var r;ke.Z.state.initialRenderCompleted?he.default.measureAfterNextFlush("navigation_database_render",{environment:this.environment,getData:o}):(A.setInitialRenderCompleted(),he.default.measureFromAppStartAfterNextFlush("initial_database_render",{environment:this.environment,getData:o,shouldSendIfStatsigNotInitialized:!0}),this.renderStartTime&&he.default.measureAfterNextFlush({metricName:"initial_database_render_from_component_mount",startTime:this.renderStartTime},{environment:this.environment,getData:o}),this.renderStartTime=void 0,null===(r=this.collectionContextStore.initialDatabaseItemsVisibleTracker)||void 0===r||r.handleInitialDatabaseRender())},this.handleSearchButtonClick=()=>{this.collectionContextStore.searchOpen.setState(!0),B.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_search"})},this.handleSearchQueryChange=e=>{E.Ug({searchQuery:e.target.value,collectionContextStore:this.collectionContextStore,isFullScreen:Boolean(this.props.isFullScreen)}),T.ikP(this.environment,{view_type:this.getCurrentViewType()})},this.handleSearchBlur=()=>{this.collectionContextStore.searchQuery.state||this.handleClearSearch()},this.handleSearchKeyDown=e=>{27===e.keyCode&&this.handleClearSearch()},this.handleClearSearch=()=>{this.collectionContextStore.searchQuery.setState(""),this.collectionContextStore.searchOpen.setState(!1)},this.handleAddItemClick=()=>{N.createAndCommit({userAction:"CollectionViewBlock.handleAddItemClick",environment:this.environment,perform:e=>{this.createItem({transaction:e,coerce:!0,from:"cvb_add_item"})}}),B.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_new_item"}),this.projManagementTooltipTourAssignToSomeone()},this.handleTemplatesDropdownClick=()=>{B.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_templates_dropdown"})},this.handleTemplateClick=e=>{N.createAndCommit({userAction:"CollectionViewBlock.handleTemplateClick",environment:this.environment,perform:t=>{const o=this.createItem({transaction:t,coerce:!1,from:"cvb_template"});D.ob({title:"template",environment:this.environment,store:o,templateStore:e.templateStore,isKeyboard:e.isKeyboard,isCreateIn:!1,transaction:t,from:"collection_view_block"})}}),this.projManagementTooltipTourAssignToSomeone(),this.stores.templateButtonPopupStore.reset()},this.handleTemplateEmptyPageClick=()=>{N.createAndCommit({userAction:"CollectionViewBlock.handleTemplateEmptyPageClick",environment:this.environment,perform:e=>{this.createItem({transaction:e,coerce:!1,from:"cvb_template_empty_page"})}}),this.stores.templateButtonPopupStore.reset()},this.handleTemplateCancelClick=()=>{this.stores.templateButtonPopupStore.reset()},this.handleSetSourceClick=()=>{const{collectionContextStore:e}=this,t=e.settingsStore;this.isPlaceholderExternalCollectionStore.state?F.NG({collectionSettingsStore:t}):(F.r$({collectionContextStore:e,collectionSettingsStore:t}),B.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_select_data_source"}))},this.handleNoDateAddPage=e=>{const{collectionContextStore:t}=this,o=this.getCollectionStore(),r=this.getCurrentCollectionViewStore(),i=this.timelineViewRef.current;if(!r||!o)return;if(!r.isDefined())return;const{performResult:n}=N.createAndCommit({userAction:"CollectionViewBlock.insertedStore",environment:this.environment,perform:n=>"calendar"===r.getType()?M.Fv({environment:this.environment,store:e,collectionStore:o,collectionContextStore:t,startDayOfWeek:U.AK.state,results:this.getDefaultResults(),transaction:n}):i?i.addBlockToView({store:e,transaction:n}):void 0});n&&H.Z5({environment:this.environment,stores:[n]})},this.handleOpenAsPageClick=()=>{T.Jin(this.environment,{view_type:this.getCurrentViewType()})},this.handleNoDateButtonClick=()=>{B.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_no_date"})},this.initializeSyncStatePolling=async()=>{if(this.isSyncingStore.state){const e=this.getCollectionStore(),t=null==e?void 0:e.getFormat().uri,o=null==e?void 0:e.getFormat().bot_id,r=null==e?void 0:e.id;if(!t||!o||!r)return;await this.pollSyncState({uri:t,botId:o,collectionId:r})}},this.pollSyncState=async e=>{const t=await R.getExternalCollectionSyncState(this.environment,e);if("success"===t.type&&t.data.result){const o=t.data.result,r=this.collectionContextStore.numberChildrenReceived,i=this.collectionContextStore.numberChildrenUnfurled;r.setState(o.numberChildrenReceived),i.setState(o.numberChildrenUnfurled),i.state/r.state<1&&(this.syncStateTimeout=setTimeout((async()=>{await this.pollSyncState(e)}),1e4))}},this.resetCollectionSubscriptions=e=>{const t=Array.from(this.subscriptions.keys()),o=a().difference(t,e),r=a().difference(e,t);for(const n of o){var i;null===(i=this.subscriptions.get(n))||void 0===i||i.unsubscribe(),this.subscriptions.delete(n)}for(const n of r){const e=new yc(this.environment,(0,C.jY)(n),this.handleCollectionEmit);e.subscribe(),this.subscriptions.set(n,e)}},this.subscribeToTypeChanges=()=>{const e=this.collectionContextStore.contextType,t=this.collectionContextStore.databaseType;if("collectionTypedView"!==e||!t||this.collectionTypeChangeSubscription)return;const o=new yc(this.environment,(0,C.JY)({spaceId:this.props.store.getSpaceId(),databaseType:t}),this.handleCollectionEmit);o.subscribe(),this.collectionTypeChangeSubscription=o},this.isSyncingStore=this.createComputedStore((()=>{var e;const t=this.getCollectionStore(),o=null==t?void 0:t.isSyncedCollection(),r=!0===(null==t||null===(e=t.getFormat().sync_state)||void 0===e?void 0:e.syncing),i=this.environment.device.isMobile;return Boolean(o&&r&&!i)})),this.canShowPmIntroTooltipStore=this.createComputedStore((()=>{if(this.environment.device.isMobile)return!1;const e=ue.default.state.currentUserSettingsStore,t=ue.default.state.currentSpaceStore;if(!(0,$.jH)(e,t)&&(!t||t.getCreatedTime()<$.VL))return!1;if(!this.isTasksDB())return!1;if(this.props.store.pathIsDead())return!1;return!!this.collectionContextStore.permissionScopes.state.canEditContent&&(!!(0,$.Z0)()&&ue.default.state.inAppCalloutStore.canShow("pm_intro_tooltip"))})),this.isTasksDB=()=>{const e=this.collectionContextStore.collectionViewBlockStore();return(null==e?void 0:e.getFormat().app_config_uri)===S.TZ},this.shouldRestrictHeaderWidthForMarginComments=()=>this.isRootOrDirectChild()&&!(0,ee._5)(this.props.store)&&this.marginCommentsVisible.state,this.shouldRenderOptions=()=>void 0!==this.collectionContextStore.collectionStore()||"collectionTypedView"===this.collectionContextStore.contextType,this.shouldRestrictWidthForMarginComments=this.createComputedStore((()=>{const e=this.getCurrentCollectionViewStore(),t=null==e?void 0:e.getType();return this.shouldRestrictHeaderWidthForMarginComments()&&t&&(ee.bu.has(t)||"timeline"===t&&this.collectionContextStore.collectionStore()&&!(0,J.C1)({environment:this.environment,format:this.collectionContextStore.normalizedFormatStore.state,isFullScreen:this.isFullScreen(),isRootChild:this.isRootOrDirectChild()}))})),this.isPlaceholderExternalCollectionStore=this.createComputedStore((()=>{const e=this.getCollectionStore();return!!e&&(0,v.OY)(e.getValue())})),this.getExternalIntegrationId=this.createComputedStore((()=>{const e=this.getCollectionStore();if(e)return e.getFormat().integration_id})),this.leftRightPadding=this.createComputedStore((()=>{var e;const{store:t,isFullScreen:o,overridePaddingLeft:r,overridePaddingRight:i,experimentalLayout:n}=this.props;if(n)return{paddingLeft:0,paddingRight:0};const s=(0,ee.Bs)({environment:this.environment,store:t,isFullScreen:o,sizeObserver:this.headerSizeObserver,viewType:null===(e=this.collectionContextStore.collectionViewStore())||void 0===e?void 0:e.getType()});s&&void 0!==r&&(s.paddingLeft=r),s&&void 0!==i&&(s.paddingRight=i);const l=this.shouldRestrictWidthForMarginComments.state;return s&&l&&(s.paddingRight+=(0,ne.gC)(this.environment,(0,ee.en)(t),this.isInFrameWhenSidePeekOpen.state)),s})),this.isLoadedStore=this.createComputedStore((()=>Boolean(this.collectionContextStore.remoteResult.state))),this.leftRightMargin=this.createComputedStore((()=>{if(!this.isRootOrDirectChild()||!this.marginCommentsVisible.state||!(0,ee._5)(this.props.store)||this.props.store.isCollectionViewPageWithContent())return{marginLeft:void 0,marginRight:void 0};const e=ne.QB/2;return{marginLeft:e,marginRight:-e}})),this.noDateTotal=this.createComputedStore((()=>{if(this.noDateReducerStore.state){const e=this.stores.noDateResultStore.state;return e&&"aggregation"===e.type&&"number"===e.aggregationResult.type&&e.aggregationResult.value?e.aggregationResult.value:0}return 0})),this.noDateReducerStore=this.createComputedStore((()=>{const e=this.getNoDateProperty();if(e){return{type:"aggregation",filter:{operator:"and",filters:[{property:e,filter:{operator:"is_empty"}}]},aggregation:{aggregator:"count"}}}})),this.hasAppliedFilter=this.createComputedStore((()=>(0,Q.RL)({collectionContextStore:this.collectionContextStore,applySubitemFilter:!1}).length>0)),this.hasSort=this.createComputedStore((()=>{const{collectionContextStore:e}=this;return e.currentSortsStore.state.length>0})),this.showHoverActionsStore=this.createComputedStore((()=>{const{device:e}=this.environment,{mouseStore:t,headerMouseStore:o,focusStore:r,createSortSettingsStore:i,createFilterSettingsStore:n,filterBarCreateFilterSettingsStore:s,saveControlMoreActionsButtonPopupStore:l}=this.stores,{collectionContextStore:a}=this,c=this.isFullScreen(),d=r.state,h=a.settingsStore.state.open,p=a.searchOpen.state,u=i.state.open,m=n.state.open,g=s.state.open,S=a.filterBarSortSettingsStore.state.open,v=Array.from(a.filterBarItemSettingsStoreMap.values()),y=l.state.open,f=v.some((e=>e.state.open));return Boolean(t.state.mouseEntered||o.state.mouseEntered||d||c||this.shouldShowProjManagementTooltipTour()||e.isMobile||h||f||u||m||g||p||y||S)})),this.isCollectionScrolled=this.createComputedStore((()=>this.stores.scrollStore.state)),this.showCompactDesktopHeaderStore=this.createComputedStore((()=>{const{device:e}=this.environment,t=this.headerSizeObserver.rect.state;return!e.isMobile&&t.width&&t.width<400})),this.isInFrameWhenSidePeekOpen=this.createComputedStore((()=>(0,ee.Ks)(this.props.store))),this.isInPeek=this.createComputedStore((()=>(0,ee.en)(this.props.store)))}insertBlocks(e,t){const o=this.getCollectionStore();if(o)for(const r of e)V.mp({environment:this.environment,store:r,collectionStore:o,collectionContextStore:this.collectionContextStore,coerce:!0,groupsPointer:[],results:this.getDefaultResults(),transaction:t});return[]}handleCreated(){H.ZH(this.environment),p.default.afterNextFlush((()=>{const{collectionContextStore:e}=this,t=e.collectionStore(),o=e.collectionViewBlockStore(),r=e.settingsStore;if(!o)return;const i=o.getCollectionViewSourceCollectionStore();if(this.isPlaceholderExternalCollectionStore.state)F.NG({collectionSettingsStore:r});else if(i)E.W1({environment:this.environment,collectionContextStore:e});else if(t)F.r$({collectionContextStore:e,collectionSettingsStore:r}),(0,Tn.V)({collectionStore:t,collectionContextStore:e,collectionSettingsStore:r});else{const t=Ce.default.checkGate("typed_db_creation");F.r$({collectionContextStore:e,collectionSettingsStore:r}),t?F.wl({collectionSettingsStore:r,item:{type:"createTypedDB"}}):F.wl({collectionSettingsStore:r,item:{type:"createViewSource"}})}}))}willMount(e){super.willMount(e),this.trackRenderTime({isFirstRender:!0}),this.isLoadedStore.addListener(this.handleLoadedStoreChange),this.handleLoadedStoreChange(),this.renderStartTime=performance.now()}willMountOrUpdate(e){super.willMountOrUpdate(e);const{store:t}=e,o=t.id,{collectionContextStore:r}=this,i=this.collectionContextStore.collectionViewStore(),n=this.collectionContextStore.collectionStore(),s=this.environment.currentUser.id,l=i?i.id:void 0,a=n?n.id:void 0,c=this.getViewStores().map((e=>e.id)),d=this.getDefaultCollectionViewStore(),h=f.Z.get({userId:s,key:Se.Z.getLocalViewPreferenceKey(o)});let p;if(e.viewId&&c.indexOf(e.viewId)>=0?p=e.viewId:i&&c.indexOf(i.id)>=0?p=i.id:h&&c.indexOf(h)>=0?p=h:d&&c.indexOf(d.id)>=0&&(p=d.id),p){const e=Ve.Xr.createChildStore(t,{table:w.n,id:p}),i=e.getCollectionStore(),n=!i||i.isDefined();e.isDefined()&&n&&(p!==h&&f.Z.set({userId:s,key:Se.Z.getLocalViewPreferenceKey(o),value:p}),(p!==l||i&&i.id!==a)&&E.mc({environment:this.environment,collectionViewBlockStore:t,collectionViewStore:e,collectionStore:i,collectionContextStore:r,isFullScreen:this.isFullScreen(),isRootChild:this.isRootOrDirectChild(),isInPeekRenderer:this.isInPeekRenderer()}))}const u=r.collectionStore();if(u){u.getTemplatePageStores().map((e=>e.getValue()))}this.isSyncingStore.addListener(this.initializeSyncStatePolling),this.ensureStoreListeners()}willUpdate(){this.trackRenderTime({isFirstRender:!1})}didMount(){super.didMount(),Ie.Z.addListener(this.handlePageVisibilityChange),Be.default.addListener(this.handlePeekViewChange);const e=this.collectionContextStore.collectionViewStore(),t=this.collectionContextStore.collectionStore();if(e&&t){const o=e.getType();o&&T.esN(this.environment,{collection_id:t.id,collection_view_id:e.id,collection_view_block_id:this.props.store.id,type:o,is_full_screen:this.isFullScreen(),is_peek:this.isInPeekRenderer(),peek_mode:Be.default.state.mode})}if(e&&"collectionTypedView"===this.collectionContextStore.contextType){const t=this.collectionContextStore.databaseType,o=xe.Z.state.userHomePageId,r=e.getType();t&&r&&T.Wg6(this.environment,{collection_view_id:e.id,collection_view_block_id:this.props.store.id,type:r,databaseType:t,is_my_tasks:o===this.props.store.id})}Ce.default.checkGate("collection_settings_skip_preload")||ce.deps.CollectionSettings.loader()}didMountOrUpdate(){var e;const t=this.getCollectionStore();var o;(t&&this.resetCollectionSubscriptions([t.id]),this.collectionContextStore.remoteCollectionIds.addListener((e=>this.resetCollectionSubscriptions(e.state))),this.subscribeToTypeChanges(),this.parentNode)||(this.parentNode=null===(o=d.findDOMNode(this))||void 0===o?void 0:o.parentElement,this.parentNode&&((0,te.lj)(this.parentNode,"focusin",this.handleFocusIn),(0,te.lj)(this.parentNode,"focusout",this.handleFocusOut),(0,te.lj)(this.parentNode,"mousemove",this.handleMouseMove),(0,te.lj)(this.parentNode,"mouseleave",this.handleMouseLeave)));const r=null===(e=this.horizontalScrollerEl)||void 0===e?void 0:e.scrollerEl();r&&(0,te.lj)(r,"scroll",this.handleScroll)}didUpdate(e){this.trackSwitchViewLag()}willUnmount(){var e;super.willUnmount();const{collectionContextStore:t}=this;E.ob({collectionContextStore:t}),this.unsubscribeAll(),this.headerSizeObserver.destroy(),Ie.Z.removeListener(this.handlePageVisibilityChange),Be.default.removeListener(this.handlePeekViewChange),this.isLoadedStore.removeListener(this.handleLoadedStoreChange),this.parentNode&&((0,te.ZV)(this.parentNode,"focusin",this.handleFocusIn),(0,te.ZV)(this.parentNode,"focusout",this.handleFocusOut),(0,te.ZV)(this.parentNode,"mousemove",this.handleMouseMove),(0,te.ZV)(this.parentNode,"mouseleave",this.handleMouseLeave));const o=null===(e=this.horizontalScrollerEl)||void 0===e?void 0:e.scrollerEl();o&&(0,te.ZV)(o,"scroll",this.handleScroll),this.isSyncingStore.removeListener(this.initializeSyncStatePolling),clearTimeout(this.syncStateTimeout)}renderPersisted(){const{collectionContextStore:e}=this,t=this.getCurrentCollectionViewStore(),o=this.getCollectionStore(),r=e.normalizedSchemaStore.state,i=e.normalizedQueryStore.state,n=e.normalizedFormatStore.state,l=this.isFullScreen();if(!(t&&r&&i&&n))return;const a=t.getType();if(!a)return;if(o&&!o.isDefined())return;if(this.isCollectionViewOfExternalCollectionWithoutExternalObjectId())return s()(W.L1,{value:this.collectionContextStore},void 0,c.createElement(gn.p,{allowSelectionWithin:!0,style:this.getHeaderWrapStyle(),onMouseDown:this.handleEditorMouseDown,onMouseMove:this.handleHeaderMouseMove,onMouseLeave:this.handleHeaderMouseLeave,onClick:this.handleEditorClick,ref:this.handleHeaderMount},s()(Ro.Z,{store:this.props.store,shouldShowHoverMenu:!0,analyticsName:this.collectionViewTypeToAnalyticsType(a),shouldShowHalo:!this.isFullScreen(),canSelect:!this.isFullScreen()},void 0,s()(ac.Z,{store:this.props.store,style:{width:"auto"},disabled:!1}))));const d=(0,ae.$3)(this.environment)-U.CC,h=this.isInFrameWhenSidePeekOpen.state&&!this.props.isFullScreen&&!(0,ee._5)(this.props.store)&&d>0,p=this.renderView(o,t,a,r,i,n),u=this.props.experimentalLayout&&!Sc.includes(a)?p:c.createElement(lc.Z,{type:this.isInPeek.state?pe.Z.X:(0,U.p5)({environment:this.environment,isFullScreen:this.isFullScreen()}),className:q.x9t,onMouseDown:this.handleEditorMouseDown,preventType:this.isInPeek.state?pe.Z.None:O.Q7(this.environment),onClick:e=>this.handleEditorClick(e,a),style:this.getScrollerStyle(a,n,h?d/2:void 0),ref:this.handleHorizontalScrollerMount},p),m={flexGrow:1,flexShrink:0,display:"flex",flexDirection:"column",...this.leftRightMargin.state},g=l?c.createElement(c.Fragment,null,s()("div",{style:{position:"sticky",height:0,left:0,zIndex:k.Nm}},void 0,this.renderViewSettings()),s()(gn.p,{allowSelectionWithin:!0,style:{...m,position:"relative"}},void 0,u)):s()(gn.p,{allowSelectionWithin:!0,style:{flexGrow:1,flexShrink:0,display:"flex",flexDirection:"column",...this.leftRightMargin.state,...h&&{marginLeft:-d/2}}},void 0,s()("div",{style:{position:"relative"}},void 0,u,this.renderViewSettings()));return this.props.experimentalLayout?s()(W.L1,{value:this.collectionContextStore},void 0,s()(sc.cx,{},void 0,s()(sc.bU,{},void 0,this.renderMultiSelectToolbar(),!this.props.hideHeader&&this.renderHeader(a)),gc.includes(a)?s()(sc.i2,{},void 0,g):s()(sc.bU,{},void 0,g),s()(sc.bU,{},void 0,this.renderBottomBorderForViewSettings(),s()(mc,{collectionContextStore:this.collectionContextStore})))):s()(W.L1,{value:this.collectionContextStore},void 0,this.renderMultiSelectToolbar(),!this.props.hideHeader&&this.renderHeader(a),g,this.renderBottomBorderForViewSettings(),s()(mc,{collectionContextStore:this.collectionContextStore}))}renderHeader(e){var t,o,r;const{device:i}=this.environment,{store:n,disableHoverMenu:l,experimentalLayout:a}=this.props,d=this.isFullScreen(),h=this.noDateReducerStore.state,p=this.showHoverActionsStore.state,u=this.showCompactDesktopHeaderStore.state,m=null===(t=ye.Z.state)||void 0===t?void 0:t.collectionSettingsStore.state.open,g=this.leftRightPadding.state,S=(null===(o=this.collectionContextStore.collectionViewBlockStore())||void 0===o?void 0:o.isCollectionViewPageWithContent())&&"page"===(null===(r=this.collectionContextStore.collectionViewStore())||void 0===r?void 0:r.getType()),v=this.shouldShowProjManagementTooltipTour()?s()(cn.Z,{store:n,origin:this.renderViewSettingsButton(),isFirstTooltip:!1,phase:"click_view_settings"}):this.renderViewSettingsButton();return c.createElement(gn.p,{allowSelectionWithin:!0,style:this.getHeaderWrapStyle(),onMouseDown:this.handleEditorMouseDown,onMouseMove:this.handleHeaderMouseMove,onMouseLeave:this.handleHeaderMouseLeave,ref:this.handleHeaderMount},g&&s()(Ro.Z,{store:n,shouldShowCopyLinkButton:n.isLocked(),shouldShowHoverMenu:!l&&this.canEdit()&&!d,analyticsName:this.collectionViewTypeToAnalyticsType(e),useGrid:a&&n.isRootOrDirectChild()},void 0,i.isPhone?s()("div",{style:this.getHeaderStyle()},void 0,this.renderViewTabBar(),!this.props.hideHeaderActions&&s()(Sn.Z,{isVisible:!0,animationStyle:{opacity:p?1:0},render:()=>s()("div",{style:{display:"flex",alignItems:"center"}},void 0,this.renderLoadingSpinner(),this.renderFullScreenButton(),v,this.renderAddItemButton())})):s()("div",{style:this.getHeaderStyle()},void 0,this.renderViewTabBar(),!m&&!this.props.hideHeaderActions&&s()(Sn.Z,{isVisible:!0,animationStyle:{opacity:p?1:0},render:()=>s()("div",{style:{display:"flex",alignItems:"center",gap:2}},void 0,this.renderLoadingSpinner(),!u&&this.renderLockIndicator(),!u&&this.renderNoDateButton(),!u&&"page"!==e&&this.renderFilterButton(),!u&&"page"!==e&&this.renderSortButton(),this.renderAutomationSettingsButton(),!u&&"page"!==e&&this.renderSearch(),S&&this.renderPageViewSearch(),this.renderFullScreenButton(),v,this.renderAddItemButton())})),h&&s()(ot.Z,{id:"no_date_count",collectionContextStore:this.collectionContextStore,reducer:h,resultStore:this.stores.noDateResultStore})),s()("div",{style:this.getHeaderPositioningStyle()},void 0,this.renderSource(),this.renderFilterBar()))}renderLockIndicator(){const{device:e}=this.environment,{store:t}=this.props;if(!this.isFullScreen()&&!e.isPhone&&t.canEditCollection())return s()(cc.Z,{store:t,isMobile:!1,isInlineCollection:!0,disableTooltip:!0,buttonStyle:{marginLeft:4,marginRight:4}})}renderViewTabBar(){return s()(rc,{collectionContextStore:this.collectionContextStore,showHoverActionsStore:this.showHoverActionsStore,isPlaceholderExternalCollectionStore:this.isPlaceholderExternalCollectionStore,onViewClick:this.handleViewClick})}renderFullScreenButton(){const{store:e}=this.props;if(this.isFullScreen())return;const t=(0,oe.ZP)({store:e,fullyQualified:!1,pageVisitSource:g.tY.Expand}),o=ie.default.formatMessage(vc.openFullscreenPageButtonTooltip);return s()(ht.Z,{renderTooltip:()=>o,render:e=>c.createElement(lo.Z,i()({ariaLabel:o,href:t,onClick:this.handleOpenAsPageClick,icon:y.Z.openAsPageThick,style:this.getTopbarIconButtonStyle(),iconStyle:{fill:this.theme.mediumTextColor,width:16}},e))})}renderAutomationSettingsButton(){const{collectionContextStore:e}=this,t=this.getCurrentCollectionViewStore(),o=null==t?void 0:t.getType(),r=e.settingsStore,n=r.state.open,l=(0,ve.n)(r),a=Ce.default.checkGate("status_automations"),d=Cc({isStatusAutomationExperimentEnabled:a,tab:l}),h=e.aliveAutomationCount.state;if("page"===o||!a||this.isPlaceholderExternalCollectionStore.state)return;const p=h>0;return s()(ht.Z,{renderTooltip:()=>ie.default.formatMessage(vc.openAutomationsSettingsButtonTooltip),render:e=>c.createElement(lo.Z,i()({ariaLabel:ie.default.formatMessage(vc.openAutomationsSettingsButtonAriaLabel),className:q.RIA,icon:y.Z.boltFilled,style:this.getTopbarIconButtonStyle(),iconStyle:{width:void 0,height:14,fill:p?this.theme.icon.interactive:this.theme.mediumTextColor},hovered:n&&d,onClick:this.handleViewAutomationSettingsClick},e))})}renderViewSettingsButton(){const{collectionContextStore:e}=this,t=this.getCurrentCollectionViewStore(),o=null==t?void 0:t.getType(),r=e.settingsStore,n=r.state.open,l=e.permissionScopes.state,a=(0,ve.n)(r),d=!Cc({isStatusAutomationExperimentEnabled:Ce.default.checkGate("status_automations"),tab:a});if("page"!==o&&(l.canEditContent||"collectionTypedView"===e.contextType)&&!this.isPlaceholderExternalCollectionStore.state)return s()(ht.Z,{renderTooltip:()=>s()(P.FormattedMessage,{defaultMessage:"Edit view layout, grouping and more...",id:"database.collectionViewBlock.openViewSettingsButton.tooltip"}),render:e=>c.createElement(lo.Z,i()({className:q.xvU,icon:y.Z.dots,style:this.getTopbarIconButtonStyle(),iconStyle:{width:void 0,height:3,fill:this.theme.mediumTextColor},hovered:n&&d,onClick:this.handleViewSettingsClick},e,{onMouseEnter:function(){for(var t,o=arguments.length,r=new Array(o),i=0;i<o;i++)r[i]=arguments[i];null===(t=e.onMouseEnter)||void 0===t||t.call(e,...r)}}))})}renderFilterButton(){const{device:e}=this.environment,{createFilterSettingsStore:t}=this.stores;if(this.shouldRenderOptions()&&!this.isPlaceholderExternalCollectionStore.state)return s()(ct.ZP,{popupType:e.isMobile?it.Z4.SlideUp:it.Z4.Popup,open:t.state.open,origin:this.renderFilterButtonOrigin(),onDismiss:this.handleCreateFilterPopupDismiss,originGap:4,render:this.renderCreateFilterPopup})}renderFilterButtonOrigin(){const e=this.hasAppliedFilter.state;return s()(at.Z,{style:this.getTopbarActionButtonStyle(e),isBlue:e,onClick:this.handleFilterClick},void 0,s()(P.FormattedMessage,{defaultMessage:"Filter",id:"collectionViewBlock.action.filter.title"}))}renderSortButton(){const{device:e}=this.environment;if(!this.shouldRenderOptions()||this.isPlaceholderExternalCollectionStore.state)return;const{createSortSettingsStore:t}=this.stores;return s()(ct.ZP,{popupType:e.isMobile?it.Z4.SlideUp:it.Z4.Popup,open:t.state.open,origin:this.renderSortButtonOrigin(),onDismiss:this.handleCreateSortPopupDismiss,originGap:4,render:this.renderCreateSortPopup})}renderSortButtonOrigin(){const e=this.hasSort.state;return s()(at.Z,{style:this.getTopbarActionButtonStyle(e),isBlue:e,onClick:this.handleSortClick},void 0,s()(P.FormattedMessage,{defaultMessage:"Sort",id:"collectionViewBlock.action.sort.title"}))}renderSearch(){const{collectionContextStore:e}=this;if(!this.shouldRenderOptions()||this.isPlaceholderExternalCollectionStore.state)return;const t=e.searchOpen.state,o=e.searchQuery.state;return c.createElement(c.Fragment,null,s()(lo.Z,{icon:y.Z.collectionSearch,iconStyle:{width:14,height:void 0,fill:this.theme.mediumTextColor},style:this.getTopbarIconButtonStyle(),onClick:this.handleSearchButtonClick}),s()(Sn.Z,{isVisible:t,animationStyle:{width:150,opacity:1},enterAnimationStyle:{width:0,opacity:0},exitAnimationStyle:{width:0,opacity:0},render:()=>s()(Yn.Z,{capture:t,allowEsc:!0,render:e=>c.createElement("div",e,s()("div",{style:{display:"flex",alignItems:"center",overflow:"hidden"}},void 0,s()(nc.Z,{style:this.getSearchInputStyle(),format:nc.Z.Format.Transparent,value:o,onChange:this.handleSearchQueryChange,placeholder:ie.default.formatMessage(vc.searchInputPlaceholder),focusInitial:t,showClearButton:!0,onBlur:this.handleSearchBlur,onCancel:this.handleClearSearch,onClick:re.Wi,onClearButtonClick:this.handleClearSearch,onKeyDown:this.handleSearchKeyDown})))})}))}renderPageViewSearch(){var e;const t=this.getCurrentCollectionViewStore();if("page"!==(null==t?void 0:t.getType()))return null;const o=null===(e=this.collectionContextStore.collectionViewBlockStore())||void 0===e?void 0:e.id;return o?s()(at.Z,{style:{display:"flex",alignItems:"center",fontSize:14,fontWeight:x.Z.fontWeight.medium,color:this.theme.mediumTextColor},onClick:()=>{G.Kf({environment:this.environment,analyticsFrom:"wiki-home-collection-view"}),Fe.ZP.updateFilters({ancestors:[o]})}},void 0,y.Z.collectionSearch({width:14,fill:this.theme.mediumIconColor,marginRight:6}),s()(P.FormattedMessage,{defaultMessage:"Search",id:"database.collectionViewBlock.pageView.search"})):null}renderAddItemButton(){const{collectionContextStore:e}=this,t=this.getCurrentCollectionViewStore();if("page"===(null==t?void 0:t.getType())||this.isPlaceholderExternalCollectionStore.state||!e.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const o="collectionTypedView"===e.contextType?s()(P.FormattedMessage,{defaultMessage:"New {singleItemName}",id:"collectionViewBlock.action.newItem.typedDatabaseTitle",values:{singleItemName:ie.default.formatMessage((0,S.hf)(e.databaseType))}}):s()(P.FormattedMessage,{defaultMessage:"New",id:"collectionViewBlock.action.newItem.nonTypedDatabaseTitle"}),r={marginLeft:8,fontSize:14,height:28};if("collectionTypedView"===e.contextType)return c.createElement(c.Fragment,null);const i=e=>s()(hc.Z,{title:o,color:"blue",onClick:this.handleAddItemClick,dropdownEvents:e,style:r,className:q.sqL});return s()(it.ZP,{popupType:this.environment.device.isMobile?ct.kQ.SlideUp:ct.kQ.Popup,render:this.renderTemplatesPopup,originGap:4,onClick:this.handleTemplatesDropdownClick,renderOrigin:e=>this.shouldShowProjManagementTooltipTour()?s()(cn.Z,{store:this.props.store,origin:i(e),isFirstTooltip:!0,phase:"create_a_task"}):i(e),buttonPopupStore:this.stores.templateButtonPopupStore})}renderNoDateButton(){const e=this.noDateTotal.state,{collectionContextStore:t}=this,o=t.permissionScopes.state;if(t.collectionStore()&&0!==e&&o.canEditContent)return s()(it.ZP,{popupType:this.environment.device.isMobile?ct.kQ.SlideUp:ct.kQ.Popup,render:this.renderNoDatePopup,onClick:this.handleNoDateButtonClick,renderOrigin:t=>c.createElement(at.Z,i()({isGray:!0,style:this.getTopbarActionButtonStyle(!1)},t),s()(P.FormattedMessage,{defaultMessage:"No date ({noDateTotal})",id:"collectionViewBlock.action.noDateButton.noProperty.label",values:{noDateTotal:e}}))})}renderFilterBar(){const{collectionContextStore:e}=this,t=e.filtersBarOpenStore.state,o=this.getCurrentCollectionViewStore();if("page"!==(null==o?void 0:o.getType())){if(!t){const t=e.getCompleteSprintButtonContext.state;if(!t)return;return s()("div",{style:{display:"flex",marginTop:9}},void 0,s()("div",{style:{flex:1}}),s()(ic.v,{collectionContextStore:e,completeSprintAutomationContext:t}))}return s()(ka.Z,{collectionContextStore:this.collectionContextStore,showHoverActionsStore:this.showHoverActionsStore,createFilterSettingsStore:this.stores.filterBarCreateFilterSettingsStore,saveControlMoreActionsButtonPopupStore:this.stores.saveControlMoreActionsButtonPopupStore})}}renderSource(){if(!this.isPlaceholderExternalCollectionStore.state)return this.collectionContextStore.shouldShowSource.state?s()(xa,{store:this.props.store,collectionContextStore:this.collectionContextStore,isFullScreen:this.isFullScreen(),showHoverActionsStore:this.showHoverActionsStore,canEdit:this.canEdit()}):void 0}renderView(e,t,o,r,n,l){const{store:a}=this.props,{collectionContextStore:d}=this,h=!this.canEdit();"rendered"!==ue.default.state.renderPhase&&ue.default.setState({...ue.default.state,renderPhase:"rendered"});const p=this.isFullScreen(),u=this.isInPeekRenderer(),m=this.getBlockPropertyValueOverlayStore(),g=this.isRootOrDirectChild();let S=this.leftRightPadding.state;if(S){if(!e&&this.collectionContextStore.hasSingleCollection())return this.renderNoSourcePlaceholder(o);if(this.isPlaceholderExternalCollectionStore.state)return this.renderNoSourceExternalCollectionPlaceholder(o);if("table"===o)return c.createElement(Gl,i()({key:t.id,schema:r,format:l,query:n,store:a,collectionContextStore:d,showHoverActionsStore:this.showHoverActionsStore,isScrolled:this.isCollectionScrolled.state,isFullScreen:p,isInPeekRenderer:u},S,{minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:h,blockPropertyValueOverlayStore:m,isRootChild:g,viewSettingsPlacementStore:this.stores.viewSettingsPlacementStore}));if("board"===o)return c.createElement(ci,i()({key:t.id,schema:r,format:l,query:n,store:a,collectionContextStore:d,isFullScreen:p,isInPeekRenderer:u},S,{paddingBottom:this.getPaddingBottom(o),disabled:h,blockPropertyValueOverlayStore:m,isRootChild:g}));if("page"===o){const e=t.getFormat().page_pointer,o=d.settingsStore;if(!e)return s()("div",{style:{fontSize:17,fontWeight:x.Z.fontWeight.medium,color:this.theme.lightTextColor,textAlign:"center",marginTop:20,display:"inline-block",width:"100%"}},void 0,s()(P.FormattedMessage,{defaultMessage:"No page specified",id:"collectionViewBlock.noPagePlaceholder.title"}),s()("div",{style:{fontSize:11}},void 0,s()(qt.Z,{onClick:()=>F.r$({collectionContextStore:d,collectionSettingsStore:o})},void 0,"Enter a page ID to continue")));const r=this.createComputedStore((()=>a.id===e.id?a:Ve.G.createChildStore(a,{table:e.table,id:e.id}))),i=(0,U.ui)(this.environment);return s()(dc.Z,{context:Re.S.CollectionPageView,store:r.state,paddingBottom:dc.Z.paddingBottom(this.environment),paddingLeft:i,paddingRight:i,pageCoverHeight:0,disabled:this.props.store.isLocked()||this.props.disabled,loadingContainerStore:void 0,preventDefaultTitleTabBehavior:!0,preventDefaultTitleUntabBehavior:!0})}return"calendar"===o?c.createElement(Ai,i()({key:t.id,schema:r,format:l,query:n,store:a,collectionContextStore:d,isFullScreen:p,isInPeekRenderer:u},S,{minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:h,blockPropertyValueOverlayStore:m,isRootChild:g})):"list"===o?(this.isInFrameWhenSidePeekOpen.state&&(S={...S,paddingRight:24}),c.createElement(Wi,i()({key:t.id,schema:r,format:l,query:n,store:a,collectionContextStore:d,isFullScreen:p,isInPeekRenderer:u},S,{minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:h,blockPropertyValueOverlayStore:m,isRootChild:g}))):"gallery"===o?c.createElement(Qr,i()({key:t.id,schema:r,format:l,query:n,store:a,collectionContextStore:d,isFullScreen:p,isInPeekRenderer:u},S,{minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:h,blockPropertyValueOverlayStore:m,isRootChild:g})):"timeline"===o?c.createElement(ga,i()({key:t.id,schema:r,format:l,query:n,store:a,collectionContextStore:d,isFullScreen:p,isRootChild:g,isInPeekRenderer:u,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:h,blockPropertyValueOverlayStore:m,showHoverActionsStore:this.showHoverActionsStore,ref:this.timelineViewRef},S)):void 0}}renderNoSourcePlaceholder(e){const t=this.isFullScreen(),o=this.collectionContextStore.permissionScopes.state,r=this.collectionContextStore.settingsStore.state.open,i={display:"inline",padding:"1px 2px",borderRadius:3,textDecoration:"underline"};return s()("div",{style:{...this.leftRightPadding.state,paddingTop:8,paddingBottom:t?void 0:this.getPaddingBottom(e),height:250,display:"flex",alignItems:"center",justifyContent:"center"}},void 0,s()("div",{style:{paddingRight:r?Rn.nJ:void 0}},void 0,y.Z.folderUnknownLarge({height:48,fill:this.theme.lightIconColor,margin:"0 auto"}),s()("div",{style:{fontSize:17,fontWeight:x.Z.fontWeight.medium,color:this.theme.lightTextColor,textAlign:"center",marginBottom:-2}},void 0,s()(P.FormattedMessage,{defaultMessage:"No data source",id:"collectionViewBlock.noSourcePlaceholder.title"})),o.canConfigureBlock&&s()("div",{style:{margin:"0 auto",width:"max-content",fontSize:14,color:this.theme.lightTextColor}},void 0,s()(P.FormattedMessage,{defaultMessage:"<button>Select a data source</button> to continue",id:"collectionViewBlock.setSourceButton.title",values:{button:e=>s()(qt.Z,{style:i,onClick:this.handleSetSourceClick},void 0,e)}}))))}renderNoSourceExternalCollectionPlaceholder(e){var t;const o=this.isFullScreen(),r=this.collectionContextStore.permissionScopes.state,i=this.collectionContextStore.settingsStore.state.open,n={display:"inline",padding:"1px 2px",borderRadius:3,textDecoration:"underline"},l=this.getExternalIntegrationId.state,a=be.Z.integrations.state.find((e=>e.id===l)),c=!(this.environment.device.isMobileBrowser&&this.isPlaceholderExternalCollectionStore.state&&!this.isUserAuthenticated());if(a)return s()("div",{style:{...this.leftRightPadding.state,paddingTop:8,paddingBottom:o?void 0:this.getPaddingBottom(e),height:250,display:"flex",alignItems:"center",justifyContent:"center"}},void 0,s()("div",{style:{paddingRight:i?Rn.nJ:void 0,display:"flex",flexDirection:"column",alignItems:"center"}},void 0,s()(jt.Z,{icon:null===(t=this.collectionContextStore.collectionStore())||void 0===t?void 0:t.getIcon(),size:48,disabled:!0,isEmptyPage:!1}),s()("div",{style:{fontSize:17,fontWeight:x.Z.fontWeight.medium,color:this.theme.lightTextColor,textAlign:"center",marginBottom:-2}},void 0,s()(P.FormattedMessage,{defaultMessage:"{integrationName}",id:"collectionViewBlock.setExternalSource.title",values:{integrationName:a.name}})),r.canConfigureBlock&&s()("div",{style:{margin:"0 auto",width:"max-content",fontSize:14,textAlign:"center",color:this.theme.lightTextColor}},void 0,c&&s()(P.FormattedMessage,{defaultMessage:"<button>Link to {integrationName}</button> to continue",id:"collectionViewBlock.setExternalSourceButton.title",values:{integrationName:a.name,button:e=>s()(qt.Z,{style:n,onClick:this.handleSetSourceClick},void 0,e)}}))))}renderLoadingSpinner(){const e=this.collectionContextStore.shouldShowSpinner.state;return c.createElement(Jn.Z,i()({key:"loading-spinner",show:e},ee.Mq,{render:e=>e?s()("div",{style:{display:"flex",alignItems:"center",flexDirection:"column",marginRight:4}},void 0,s()(so.Z,{style:{width:14,height:14}})):void 0}))}renderBottomBorderForViewSettings(){const{collectionContextStore:e}=this;if(e.settingsStore.state.open&&"sidebar"===this.stores.viewSettingsPlacementStore.state)return s()("div",{style:{...this.leftRightPadding.state,...this.leftRightMargin.state,borderTop:`1px solid ${this.theme.tableDividerColor}`,height:12}})}renderMultiSelectToolbar(){if((0,ee.fk)({environment:this.environment,collectionContextStore:this.collectionContextStore})){var e;const t=(null===(e=this.leftRightPadding.state)||void 0===e?void 0:e.paddingLeft)??0,o=this.leftRightMargin.state.marginLeft??0;return s()(Cn,{marginLeft:t+o})}}unsubscribeAll(){for(const e of this.subscriptions.values())e.unsubscribe();this.collectionTypeChangeSubscription&&this.collectionTypeChangeSubscription.unsubscribe()}isCollectionViewOfExternalCollectionWithoutExternalObjectId(){var e;const t=null===(e=this.getCollectionStore())||void 0===e?void 0:e.getValue();return Boolean(t&&(0,v.Ev)(t))}isUserAuthenticated(){const e=this.collectionContextStore.collectionStore();if(!e)return!1;const t=e.getFormat().integration_id,o=be.Z.integrations.state.find((e=>e.id===t));return!(!t||!o)&&(0,Y.NP)(t).length>0}createItem(e){const{transaction:t,coerce:o,from:r}=e,{collectionContextStore:i}=this,{newStore:n}=V.IW({environment:this.environment,collectionContextStore:i,groupsPointer:[],results:this.getDefaultResults(),insertAtIndex:0,coerce:o,initializeDefaultTemplate:o,transaction:t,from:r}),s=this.isTasksDB()&&"on"===Ce.default.getEligibleGroup({experimentId:"quick_capture_tasks_with_layer",defaultGroup:"control"})?"mini_peek":(0,ee.kr)(i.collectionViewStore());L.peekBlock({environment:this.environment,store:n,peekMode:s,resultsStore:void 0,collectionContextStore:i,pageVisitSource:g.tY.Create});const l=i.subitemTreeStore.state;return T.W2j(this.environment,{from:l.children?"collection_view_new_parent_item":"collection_view_new_item",type:"page",new_page_id:n.id,...j.Pn(i)}),n}getViewStores(){const{store:e}=this.props;return e.getCollectionViewStores()}getCurrentCollectionViewStore(){return this.collectionContextStore.collectionViewStore()}getDefaultCollectionViewStore(){var e;const t=this.getViewStores();if(null!==(e=t[0])&&void 0!==e&&e.isDefined())return t[0]}getCollectionStore(){return this.collectionContextStore.collectionStore()}getMinWidth(){const{store:e}=this.props,{device:t}=this.environment,o=t.isPhone,r=this.isFullScreen(),i=this.getCurrentViewType(),n=("gallery"===i||("calendar"===i||"list"===i)&&r)&&this.isInFrameWhenSidePeekOpen.state,s=(0,ae.ll)(this.environment,this.isInPeekRenderer()),l=Be.default.state;return r||this.isRootOrDirectChild()?o?`calc(100% - ${2*(0,U.ui)(this.environment)}px - ${s}px)`:this.isInPeekRenderer()?`calc(100% - ${2*Be.PeekModePadding.horizontal[l.mode]}px - ${s}px)`:this.isInFrameWhenSidePeekOpen.state?(0,ae.$3)(this.environment)+(n?(0,ae.vJ)(this.environment):0):r?`calc(100% - ${2*(0,U.CP)(this.environment)}px - ${s}px)`:(0,ee._5)(e)?`calc(100% - ${2*(0,U.ui)(this.environment)}px - ${s}px)`:U.CC-2*(0,U.ui)(this.environment)-s:`calc(100% - ${s}px)`}isInPeekRenderer(){return(0,ee.en)(this.props.store)}getBlockPropertyValueOverlayStore(){return this.isInPeekRenderer()?Me.Z:Te.Z}resetLeftScrollAfterFlush(){p.default.afterNextFlush((()=>{var e;const t=null===(e=this.horizontalScrollerEl)||void 0===e?void 0:e.scrollerEl();if(t){t.scrollLeft=0;const e=le.xH(t);e&&(e.scrollLeft=0)}}))}isFullScreen(){return Boolean(this.props.isFullScreen)}getDefaultResults(){const e=this.collectionContextStore.localResultStore.state,t=this.getCollectionStore();if(t&&e&&"reducer"===e.type){const o=a().find(e.reducerResults,(e=>"results"===e.type));if(o)return o.blockIds.map((e=>Ve.G.createChildStore(t,{id:e,table:b.iU})))}return[]}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):L.navigate({environment:this.environment,url:e})}getCurrentViewType(){var e;const{collectionContextStore:t}=this,o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType();if(!o)throw new Error("View type was not defined.");return o}getNoDateProperty(){const e=this.collectionContextStore.collectionViewStore(),t=this.collectionContextStore.normalizedQueryStore.state;if(!e||!t)return;const o=e.getType();return"timeline"===o&&t.timeline_by?t.timeline_by:"calendar"===o&&t.calendar_by?t.calendar_by:void 0}ensureStoreListeners(){const{collectionContextStore:e}=this,{store:t}=this.props;e.blockIsPrivateStore.state;for(const o of t.getCollectionViewStores())o.getValue()}getScrollerStyle(e,t,o){const{store:r}=this.props,i=this.isFullScreen(),n=this.isRootOrDirectChild(),s=Be.default.isSidePeekClosing.state?{paddingLeft:0,paddingRight:0}:this.leftRightPadding.state,l=this.getPaddingBottom(e),a=this.collectionContextStore.settingsStore.state.open;return{flexGrow:1,flexShrink:0,...r.isLocked()&&{cursor:"default"},..."timeline"===e&&this.collectionContextStore.collectionStore()&&!i&&!(0,J.fj)({environment:this.environment,isFullScreen:i,isRootChild:n,format:t})&&s&&{marginLeft:s.paddingLeft,marginRight:s.paddingRight,marginBottom:l},...a&&!i&&"sidebar"===this.stores.viewSettingsPlacementStore.state&&{minHeight:Rn.j9},...this.isInFrameWhenSidePeekOpen.state?{position:"sticky",left:0,paddingLeft:o,width:(0,ae.$3)(this.environment)}:{}}}getPaddingBottom(e){return this.props.isFullScreen?"timeline"===e?96:180:"timeline"===e||"gallery"===e?0:ge.Z.state}getHeaderWrapStyle(){const e=this.leftRightPadding.state,t=(0,ae.$3)(this.environment),o=(0,ee._5)(this.props.store)||this.isFullScreen()?t:Math.min(U.CC,t),r=this.isInFrameWhenSidePeekOpen.state&&!Be.default.isSidePeekOpening.state;return{minHeight:pc.L,paddingLeft:null==e?void 0:e.paddingLeft,paddingRight:r?0:null==e?void 0:e.paddingRight,flexShrink:0,...(this.isFullScreen()||r)&&{position:"sticky",zIndex:86,left:0,width:r&&e?o-(e.paddingLeft/2??0):void 0},...this.props.store.isLocked()&&{cursor:"default"},...this.leftRightMargin.state}}getHeaderStyle(){const{collectionContextStore:e}=this,t=this.getCurrentViewType(),o=e.viewIsFlushToTopbar(),r=("timeline"===t||"table"===t)&&o;return{display:"flex",alignItems:"center",height:pc.L,boxShadow:r?void 0:`inset 0 -1px 0 ${this.theme.tableDividerColor}`,...this.getHeaderPositioningStyle()}}getHeaderPositioningStyle(){const e=this.leftRightPadding.state;return{left:null==e?void 0:e.paddingLeft,width:"100%"}}getSearchInputStyle(){return{fontSize:14,lineHeight:1,paddingRight:4,color:this.theme.regularTextColor,marginBottom:1}}getTopbarActionButtonStyle(e){return{display:"flex",alignItems:"center",fontSize:14,height:28,padding:6,color:e?this.theme.blueColor:this.theme.mediumTextColor,fontWeight:x.Z.fontWeight.regular,lineHeight:1,borderRadius:3}}getTopbarIconButtonStyle(){return{display:"flex",alignItems:"center",fontSize:14,height:28,width:28,padding:6,color:this.theme.mediumTextColor,fill:this.theme.mediumIconColor,fontWeight:x.Z.fontWeight.regular,lineHeight:1,borderRadius:3}}collectionViewTypeToAnalyticsType(e){return"page"===e?"page_view":e}shouldShowProjManagementTooltipTour(){return this.canShowPmIntroTooltipStore.state}projManagementTooltipTourAssignToSomeone(){const e=ue.default.state.currentUserSettingsStore,t=ue.default.state.currentSpaceStore;e&&t&&I.uR({environment:this.environment,requiredCurrPhase:"create_a_task",nextPhase:"assign_to_someone",currentUserSettingsStore:e,currentSpaceStore:t})}projManagementTooltipTourComplete(){const e=ue.default.state.currentUserSettingsStore,t=ue.default.state.currentSpaceStore;if(e&&t){"click_view_settings"===(0,$.jH)(e,t)&&I.uR({environment:this.environment,requiredCurrPhase:void 0,nextPhase:"complete",currentUserSettingsStore:e,currentSpaceStore:t})}}trackRenderTime(e){let{isFirstRender:t}=e;const o=he.default.mark("collections.collection_view_block_render");he.default.measureAfterNextFlush(o,{environment:this.environment,getData:()=>({...j.vS(this.collectionContextStore),is_first_render:t})})}trackSwitchViewLag(){if(!this.switchViewMetric)return;const{from:e,to:t,metric:o,sizeHintAtStart:r}=this.switchViewMetric;he.default.measureAfterNextFlush(o,{environment:this.environment,getData:()=>{const o=j.vS(this.collectionContextStore),{view_type:i,row_count_category:n,...s}=o;return{from:e,to:t,did_trigger_fetch:this.collectionContextStore.isLoading.state,row_count_category:j.ZO(r),...s}}}),this.switchViewMetric=void 0}}function Cc(e){const{isStatusAutomationExperimentEnabled:t,tab:o}=e;return t&&("automationSettings"===(null==o?void 0:o.type)||"automationCreateSettings"===(null==o?void 0:o.type)||"automationEditSettings"===(null==o?void 0:o.type))}fc.displayName="CollectionViewBlock",fc.contextTypes={...K.wK,...h.w};const bc=fc}}]);