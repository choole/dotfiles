"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[1655],{66580:(e,t,o)=>{o.r(t),o.d(t,{AutomationButtonActionList:()=>ot,PlacedButtonBlockEditor:()=>bt,useButtonAnalysisStore:()=>vt});var n=o(10434),i=o.n(n),r=o(23174),a=o.n(r),l=o(67294),s=o(480),c=o(81954),d=o(24405),u=o(53397),p=o(5366),m=o(98963),g=o(98114),h=o(12359),S=o(63362),y=o(97428),v=o(4615),f=o(97880),b=o(23223),C=o(98742),w=o(24457),k=o(63474),M=o(52275),x=o(78140),T=o(32163),P=o(72495),_=o(58032),A=o(60442);function V(e){window.__c={n:"AddActionMenu"};const{contextStore:t,onActionAdded:o,insertionPoint:n}=e,r=(0,p.useIntl)(),d=(0,s.O7)(),u=(0,k.D)(),m=(0,w.F)({width:280}),V=function(e){const{contextStore:t}=e,[o,n]=(0,l.useState)([]),i=(0,c.VK)((()=>(0,b.uV)(t.context.automationStore,t.context.type)),[t.context.automationStore,t.context.type]),r=(0,l.useMemo)((()=>(0,y.P)("display")),[]);return(0,c.VK)((async()=>{if(i){const e=await Promise.all(r.map((async e=>await e.isAvailableForContext(i))));return n(function(e){const t=e=>e?1:-1;return e.slice().sort(((e,o)=>t(o.display.hasSideEffects)-t(e.display.hasSideEffects)))}(r.filter(((t,o)=>e[o]))))}o.length>0&&n([])}),[i,o.length,r]),o}({contextStore:t}).map((e=>{const{display:s}=e;return{key:e.type,render:e=>{const t=t=>l.createElement(M.Z,i()({},(0,C.Z)(t??{},e),{icon:a()(F,{display:s}),disabled:!1,title:r.formatMessage(s.name)})),o=s.description;return o?a()(_.Z,{renderTooltip:()=>a()(A.Z,{caption:r.formatMessage(o)}),placement:_.Z.Placement.Right,delayThreshold:0,render:t}):t()},action:()=>{const i=(0,v.ZP)(),a=t.context.automationStore;h.createAndCommit({userAction:"AutomationActionList.addAction",environment:d,perform:t=>{g.zY({actionId:i,actionType:e.type,automationStore:a,environment:d,intl:r,transaction:t,insertionPoint:n})}}),(0,S.eI)(u,{automation_id:a.id,automation_action_id:i,automation_action_type:e.type}),o(i)}}})).filter(f.$K);return l.createElement(x.Z,m,a()(T.Z,{type:T.i.Vertical,sections:[{key:0,render:e=>l.createElement(P.Z,i()({enableActionSheetTitle:!0},e)),items:V}],initialFocus:0}))}function F(e){window.__c={n:"AddActionIcon"};const{display:t}=e,o=(0,d.yK)((e=>({icon:{width:13,height:13,fill:t.hasSideEffects?e.blueColor:e.mediumIconColor},iconWrapper:{width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",background:t.hasSideEffects?"rgba(35, 131, 226, 0.14)":e.accentColors.gray[50],borderRadius:3,marginLeft:-2}})),[t.hasSideEffects]);return a()("div",{style:o.iconWrapper},void 0,t.icon(o.icon))}var Z=o(23290),B=o(82990),E=o(9953),I=o(92223),R=o(5971),O=o(89733),K=o(29502),L=o(28267),D=o(1533),W=o(23063),H=o(31945),z=o(50478),Q=o(73063),N=o(91839),G=o(44532),U=o(27186);const q=(0,p.defineMessages)({moreActionsButtonAriaLabel:{defaultMessage:"More actions",id:"buttonBlock.button.moreActionsButtonAriaLabel"}});function j(e){window.__c={n:"AutomationActionHeader"};const{contextStore:t,actionStore:o,disabled:n,dragging:i,title:r,picker:s,onActionAdded:u}=e,p=(0,l.useRef)(null),m=(0,L.X)(p),g=(0,l.useMemo)((()=>Boolean(m&&m.width<320)),[m]),h=(0,c.qz)(void 0,D.Z),S=(0,c.VK)((()=>i||h.state.hovered),[i,h]),v=(0,d.yK)((e=>({iconHandle:{display:"flex",justifyContent:"center",left:0,position:"absolute",top:0,width:24},iconWrap:{position:"relative",width:24},nameRow:{display:"flex",alignItems:g?"flex-start":"center"},name:{flexGrow:1,fontWeight:B.Z.fontWeight.medium,display:"flex",overflow:"hidden",...g?{flexDirection:"row",flexWrap:"wrap",marginLeft:8,alignItems:"center"}:{alignItems:"center",marginLeft:8}},title:{whiteSpace:"nowrap"},picker:{position:"relative",left:-4,...g?{flexShrink:1,display:"inline-flex",minWidth:0}:{flexGrow:1,width:0}}})),[g]),f=(0,c.VK)((()=>o.getType()),[o]);if(!f)return null;const b=(0,y.z)(f),{display:C}=b;return l.createElement("div",{onMouseLeave:e=>O.iV({store:h,event:e,disabled:n}),onMouseMove:e=>O.Js({store:h,event:e,disabled:n}),style:v.nameRow,ref:p},a()("div",{style:v.iconWrap},void 0,a()(W.Z,{isVisible:!0,animationStyle:{opacity:S?0:1},enterAnimationStyle:{opacity:1},exitAnimationStyle:{opacity:1},render:()=>a()(Y,{display:C})}),a()(W.Z,{isVisible:!n,animationStyle:{opacity:S?1:0},enterAnimationStyle:{opacity:0},exitAnimationStyle:{opacity:0},render:()=>a()("div",{style:v.iconHandle},void 0,a()(z.ZP,{hideClickMessage:!0}))})),a()("div",{style:v.name},void 0,a()("div",{style:v.title},void 0,r),!g&&l.createElement(l.Fragment,null," "),s&&a()("div",{style:v.picker},void 0,s)),!n&&a()($,{contextStore:t,actionStore:o,onActionAdded:u}))}function Y(e){window.__c={n:"ActionIcon"};const{display:t}=e,o=(0,d.yK)((e=>({iconWrap:{width:24,height:24,display:"flex",alignItems:"center",borderRadius:4,background:t.hasSideEffects?"rgba(35, 131, 226, 0.14)":e.accentColors.gray[50],flexShrink:0},icon:{width:14,height:14,fill:t.hasSideEffects?e.blueColor:e.accentColors.gray[500],margin:"0 auto"}})),[t.hasSideEffects]);return a()("div",{style:o.iconWrap},void 0,t.icon(o.icon))}function $(e){window.__c={n:"MoreActionsButton"};const{contextStore:t,actionStore:o,onActionAdded:n}=e,r=(0,p.useIntl)(),s=(0,K.d)(),[c,d]=(0,l.useState)("closed"),[m,g]=l.useState(void 0);return l.createElement(l.Fragment,null,a()(H.ZP,{popupType:s,alignmentToOrigin:H.vR.Center,placementToOrigin:H.pO.Bottom,originGap:0,renderOrigin:e=>l.createElement(Q.Z,i()({ariaLabel:r.formatMessage(q.moreActionsButtonAriaLabel),icon:u.Z.dots},e)),render:t=>l.createElement(X,i()({onClose:()=>t.close(),onAddStep:e=>{g(new DOMRect(U.IL.x,U.IL.y,1,1)),d(e?"above":"below"),t.close()}},e))}),a()(G.ZP,{popupType:s,open:"closed"!==c,originRect:m,placementToOrigin:G.ZP.Placement.Bottom,alignmentToOrigin:G.ZP.Alignment.Center,render:()=>a()(V,{contextStore:t,onActionAdded:e=>{n(e),d("closed")},insertionPoint:"above"===c?{beforeActionId:o.id}:{afterActionId:o.id}}),onDismiss:()=>d("closed")}))}function J(e,t,o){if(t<0||t>=e.length||o<0||o>=e.length)return e;const n=[...e];return n[t]=e[o],n[o]=e[t],n}function X(e){window.__c={n:"MoreActionsMenu"};const{onClose:t,contextStore:o,actionStore:n,onAddStep:r}=e,d=(0,p.useIntl)(),y=(0,s.O7)(),v=(0,k.D)(),b=(0,c.VK)((()=>o.context.automationStore),[o]),C=(0,c.VK)((()=>b.getActionIds()),[b]),[_,A]=(0,l.useState)(!1),V=C.length<m.FT,F=C.indexOf(n.id),Z=0===F,B=F===C.length-1,E=(0,w.F)(),I={key:"duplicate",action:async()=>{A(!0);const e=h.createAndCommit({userAction:"AutomationAction.duplicateAction",environment:y,perform:e=>g.AN({actionStore:n,automationStore:b,environment:y,intl:d,transaction:e})});n.isDefined()&&(0,S.eI)(v,{automation_id:o.context.automationStore.id,automation_action_id:n.id,automation_action_type:n.getType(),from:"duplicate"});try{await e.performResult.onComplete}finally{A(!1)}t()},render:e=>{const t=_?a()(N.Z,{}):u.Z.duplicate({height:16,width:16}),o=a()(p.FormattedMessage,_?{id:"automations.duplicatingActionButton.label",defaultMessage:"Duplicating..."}:{id:"automations.duplicateBelowActionButton.label",defaultMessage:"Duplicate below"});return l.createElement(M.Z,i()({},e,{disabled:_,icon:t,title:o}))}},R={key:"delete",action:()=>{h.createAndCommit({userAction:"AutomationAction.removeAction",environment:y,perform:e=>{g.sl({clientContext:o.context,actionStore:n,transaction:e}),n.isDefined()&&(0,S.co)(v,{automation_id:o.context.automationStore.id,automation_action_id:n.id,automation_action_type:n.getType()})}}),t()},render:e=>l.createElement(M.Z,i()({},e,{icon:u.Z.trash({height:16,width:16}),title:a()(p.FormattedMessage,{id:"automations.deleteActionButton.label",defaultMessage:"Delete"})}))},O=[!0,!1].map((e=>{if(!(e&&Z||!e&&B))return{key:e?"moveUp":"moveDown",action:()=>{h.createAndCommit({userAction:"AutomationAction.moveAction",environment:y,perform:t=>{let n;n=J(C,e?F-1:F+1,F),g.kM({clientContext:o.context,transaction:t,newActionIds:n})}}),t()},render:t=>l.createElement(M.Z,i()({},t,{icon:(e?u.Z.arrowUp:u.Z.arrowDown)({width:16,height:16}),title:a()(p.FormattedMessage,e?{id:"automations.moveUpButton.label",defaultMessage:"Move up"}:{id:"automations.moveDownButton.label",defaultMessage:"Move down"})}))}})).filter(f.$K),K=[!0,!1].map((e=>({key:e?"addStepAbove":"addStepBelow",action:()=>{r(e)},render:t=>l.createElement(M.Z,i()({},t,{disabledFeedback:!0,icon:e?u.Z.insertUp({width:16,height:16}):u.Z.insertDown({width:16,height:16}),title:a()(p.FormattedMessage,e?{id:"automations.addStepAboveButton.label",defaultMessage:"Add step above"}:{id:"automations.addStepBelowButton.label",defaultMessage:"Add step below"})}))})));return l.createElement(x.Z,E,a()(T.Z,{type:T.i.Vertical,sections:[...O.length>0?[{key:"movement",render:e=>l.createElement(P.Z,i()({enableActionSheetTitle:!0},e)),items:O}]:[],...V?[{key:"addSteps",render:e=>l.createElement(P.Z,i()({enableActionSheetTitle:!0,topBorder:!0},e)),items:K},{key:"duplicate",render:e=>l.createElement(P.Z,i()({enableActionSheetTitle:!0,topBorder:!0},e)),items:[I]}]:[],{key:"delete",render:e=>l.createElement(P.Z,i()({enableActionSheetTitle:!0,topBorder:!0},e)),items:[R]}],initialFocus:0}))}var ee=o(87494),te=o(68214),oe=o(96486),ne=o.n(oe),ie=o(21202),re=o(68216),ae=o(40071),le=o(76798),se=o(38752);function ce(e){window.__c={n:"AutomationCollectionTemplatePicker"};const{collectionStore:t,currentTemplateId:o,onChange:n,disabled:r,errorMessage:d}=e,u=(0,s.O7)(),{device:m}=u,g=(0,c.VK)((()=>{let e=o;if(!e&&t){const o=t.getFormat().collection_default_template;o&&"empty"!==o&&(e=o.template_page_id)}if(e&&t)return re.G.createChildStore(t,{table:ie.iU,id:e,spaceId:t.getSpaceId()})}),[t,o]),h=(0,K.d)(),S=(0,se.d)({errorMessage:d,hasValue:!0}),y=(0,c.VK)((()=>{var e;return(null==t||null===(e=t.getTemplatePageStores())||void 0===e?void 0:e.filter((e=>e.pathIsAccessibleAndAlive())))??[]}),[t]),v=Boolean(o);return a()(H.ZP,{popupType:h,alignmentToOrigin:H.vR.End,placementToOrigin:H.pO.Bottom,originGap:0,disabled:r,renderOrigin:e=>l.createElement(se.S,i()({},S,e,{disabled:r,style:{minWidth:50}}),g&&(v||g.pathIsAccessibleAndAlive())?a()(le.Z,{store:g}):a()(p.FormattedMessage,{id:"automations.templatePicker.buttonPlaceholder",defaultMessage:"Empty"})),render:e=>{const o=(0,w.U)({device:m,width:280});return l.createElement(x.Z,o,t&&a()(de,{collectionStore:t,templatePageStores:y,parent:e,onChange:n}))}})}function de(e){window.__c={n:"AutomationCollectionTemplateMenuList"};const{collectionStore:t,templatePageStores:o,parent:n,onChange:r}=e,d=(0,s.O7)(),{device:u}=d,m=(0,c.VK)((()=>t.getDefaultTemplatePageStore()),[t]),g=o.map((e=>({key:e.id,render:o=>l.createElement(ae.Z,i()({},o,{key:e.id,isOverlay:!0,collectionStore:t,canConfigureCollection:!1,templateStore:e,isMobile:u.isMobile,locked:!0,isDefault:m===e,onCancelClick:()=>{},draggable:!1})),action:t=>{r(e.id),n.close()}}))),h={key:"empty",render:e=>l.createElement(ae.Z,i()({},e,{key:"empty",isOverlay:!0,collectionStore:t,canConfigureCollection:!1,templateStore:void 0,isMobile:u.isMobile,locked:!0,onCancelClick:()=>{},draggable:!1})),action:e=>{r(void 0),n.close()}};return a()(T.Z,{type:T.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>l.createElement(P.Z,i()({},e,{title:a()(p.FormattedMessage,{id:"automations.templatePicker.menuHeader",defaultMessage:"Select a template"})})),items:ne().compact([...g,m?void 0:h])}]})}var ue=o(43250),pe=o(12534),me=o(61134),ge=o(68709),he=o(17748),Se=o(92628);const ye=(0,p.defineMessages)({aboveButtonLabel:{id:"automations.DuplicateBlocksAction.aboveButtonLabel",defaultMessage:"Above button"},belowButtonLabel:{id:"automations.DuplicateBlocksAction.belowButtonLabel",defaultMessage:"Below button"}});function ve(e){window.__c={n:"DuplicateBlocksActionEditor"};const{actionStore:t,disabled:o,contentParentPointer:n}=e,i=(0,s.O7)(),r=(0,d.yK)((e=>({listWrap:{background:e.contentBackground,boxShadow:e.inputBoxShadow,padding:"3px 9px",borderRadius:5,minHeight:64,..."dark"===e.mode?{backgroundColor:e.inputBackground}:{}},emptyPlaceholder:{caretColor:e.mediumTextColor,color:e.lightTextColor,fontSize:14,padding:"5px 0",display:"inline-block"}})),[]),u=(0,c.VK)((()=>re.G.createChildStore(t,n)),[t,n]),m=(0,c.VK)((()=>u.getContentStore()),[u]),S=(0,l.useCallback)((e=>{(0,pe.ZP)({event:e,context:pe.Af.EditorClick,callback:()=>{if(!m)return;(m.getValue()||[]).length>0||h.createAndCommit({userAction:"DuplicateBlocksAction.handleListClick",environment:i,perform:e=>{g.Nj({environment:i,parentStore:m,transaction:e})}})}})}),[i,m]);return m?l.createElement(l.Fragment,null,a()(Se.Z,{store:u,analyticsName:"duplicate_blocks_action",isListContainer:!0},void 0,a()(ge.p,{allowSelectionWithin:!0},void 0,a()("div",{style:r.listWrap,onClick:S,className:ue.Wh_},void 0,a()(me.O,{displayName:"DuplicateBlocksActionContent",disabled:o},void 0,a()(he.Z,{disabled:o,store:m,emptyPlaceholder:a()("div",{style:r.emptyPlaceholder},void 0,a()(p.FormattedMessage,{id:"automations.DuplicateBlocksAction.emptyPlaceholder",defaultMessage:"Click to edit or drop blocks here…"})),disableCommentMenu:!0,disableHoverMenu:!1,disableDrag:!1})))))):null}const fe={before:{icon:u.Z.insertUp({width:16}),key:"before",title:ye.aboveButtonLabel},after:{icon:u.Z.insertDown({width:16}),key:"after",title:ye.belowButtonLabel}};function be(e){window.__c={n:"InsertBlockInDropdownButton"};const{actionStore:t,disabled:o}=e,n=(0,p.useIntl)(),r=(0,d.yK)((e=>({button:{fontWeight:"normal"}})),[]),s=(0,K.d)(),u=(0,c.VK)((()=>t.getInsertionPoint()),[t]),m=Object.values(fe),g=m.find((e=>e.key===u));return g?a()(H.ZP,{popupType:s,alignmentToOrigin:H.vR.End,disabled:o,placementToOrigin:H.pO.Bottom,originGap:0,renderOrigin:e=>l.createElement(se.S,i()({disabled:o,style:r.button,variant:"gray"},e),n.formatMessage(g.title)),render:e=>a()(Ce,{actionStore:t,currentOption:g,options:m,parent:e})}):null}function Ce(e){window.__c={n:"InsertBlockInDropdownMenu"};const{actionStore:t,currentOption:o,options:n,parent:r}=e,c=(0,s.O7)(),d=(0,p.useIntl)(),u=(0,l.useCallback)((e=>{h.createAndCommit({userAction:"DuplicateBlocksAction.setInsertionPoint",environment:c,perform:o=>{E.sW({store:t.getConfigStore(),data:{insertion_point:e},transaction:o})}})}),[c,t]),m=(0,w.F)({maxWidth:360}),g=n.map((e=>({key:e.key,render:t=>l.createElement(M.Z,i()({},t,{checkState:o.key===e.key,icon:e.icon,title:d.formatMessage(e.title)})),action:()=>{u(e.key),r.close()}})));return l.createElement(x.Z,m,a()(T.Z,{initialFocus:0,sections:[{key:0,render:e=>l.createElement(P.Z,i()({enableActionSheetTitle:!0},e)),items:g}],type:T.i.Vertical}))}var we=o(72865),ke=o(10052);const Me=(0,p.defineMessages)({confirmationInputPlaceholder:{defaultMessage:"Write a message to show users…",id:"automations.BaseModalAction.confirmationPlaceholder"},continueButtonHint:{defaultMessage:"Completes button action",id:"automations.BaseModalAction.continueButtonHint"},cancelButtonHint:{defaultMessage:"Stops button action",id:"automations.BaseModalAction.cancelButtonHint"}});function xe(e){window.__c={n:"WithRightOverlay"};const{children:t,overlayContent:o}=e,n=(0,d.yK)((e=>({wrap:{position:"relative"},overlay:{position:"absolute",height:"100%",display:"flex",alignItems:"center",top:0,right:10,color:e.lightTextColor}})),[]);return a()("div",{style:n.wrap},void 0,t,a()("div",{style:n.overlay},void 0,o))}var Te=o(98421);function Pe(e){window.__c={n:"AutomationKeyValueRow"};const{keyComp:t,valueComp:o,style:n}=e,i=(0,d.yK)((()=>({container:{display:"flex",alignItems:"center",justifyContent:"space-between",...n}})),[n]);return a()("div",{style:i.container},void 0,t,o)}function _e(e){return a()("div",{style:{marginRight:4,flexShrink:0}},void 0,e.text)}var Ae=o(84619),Ve=o(61766),Fe=o(21396),Ze=o(29758);function Be(e){window.__c={n:"AutomationPagePicker"};const{contextStore:t,actionStore:o,target:n,onChange:r,disabled:s,errorMessage:d}=e,u=(0,c.qz)(void 0,Ve.Z),m=(0,c.VK)((()=>{if(n&&"variable"===n.type)return t.getContextValueForActionById(o.id,n.id)}),[n,t,o.id]),g=(0,K.d)(),h=(0,se.d)({errorMessage:d,hasValue:Boolean(n)}),S=(0,l.useCallback)((e=>{"page"!==e.type&&"variable"!==e.type||(r(e),u.reset())}),[r,u]),y=(0,l.useCallback)((()=>u.reset()),[u]);return a()(H.ZP,{buttonPopupStore:u,popupType:g,alignmentToOrigin:H.vR.End,placementToOrigin:H.pO.Bottom,originGap:0,disabled:s,renderOrigin:e=>l.createElement(se.S,i()({disabled:s},h,e),n&&"page"===n.type?a()(le.Z,{store:re.G.createChildStore(t.context.parentRecordStore,n.page)}):m?a()(Fe.F,{value:m,format:Ae.l.Medium,isSingle:!0}):a()(p.FormattedMessage,{id:"automations.AutomationPagePicker.pagesDropdown.label",defaultMessage:"Select page"})),render:e=>a()(Ze.L,{actionId:o.id,automationContextStore:t,onChange:S,onClose:y,selectedTarget:n,skipCollections:!0})})}function Ee(e){window.__c={n:"OpenPageInDropdownButton"};const{actionStore:t,disabled:o}=e,n=(0,d.Fg)(),r=(0,c.VK)((()=>t.getOpenPageIn()),[t]),s=(0,K.d)(),u=(0,Te.v)({currentViewType:void 0,theme:n}).find((e=>e.key===r));return u?a()(H.ZP,{popupType:s,alignmentToOrigin:H.vR.End,placementToOrigin:H.pO.Bottom,originGap:0,disabled:o,renderOrigin:e=>l.createElement(se.S,i()({disabled:o,variant:"gray"},e),u.title),render:t=>l.createElement(Ie,i()({currentOpenPageIn:r,parent:t},e))}):null}function Ie(e){window.__c={n:"OpenPageInDropdownMenu"};const{currentOpenPageIn:t,actionStore:o,parent:n}=e,r=(0,s.O7)(),c=(0,d.Fg)(),u=(0,d.yK)((()=>({menuItem:{paddingTop:8,paddingBottom:8}})),[]),p=(0,l.useCallback)((e=>{h.createAndCommit({userAction:"OpenPageAction.setTarget",environment:r,perform:t=>{E.sW({store:o.getConfigStore(),data:{open_in:e},transaction:t})}})}),[r,o]),m=(0,w.F)({width:280,maxWidth:360}),g=(0,Te.v)({currentViewType:void 0,theme:c}),S=oe.compact(g.map(((e,o)=>({key:o,render:o=>l.createElement(M.Z,i()({},o,{disabled:!1,title:e.title,icon:e.icon,caption:e.caption,body:e.body,style:u.menuItem,checkState:t===e.key},o)),action:()=>{p(e.key),n.close()}}))));return l.createElement(x.Z,m,a()(T.Z,{type:T.i.Vertical,sections:[{key:0,render:e=>l.createElement(P.Z,i()({enableActionSheetTitle:!0},e)),items:S}],initialFocus:0}))}o(57658);var Re=o(87279),Oe=o(61053),Ke=o(41418),Le=o(80117);const De=(0,p.defineMessages)({addSortLimit:{id:"automations.QueryCollectionAction.addSortLimitButton.addSortLimit",defaultMessage:"Add sort, limit"},addLimit:{id:"automations.QueryCollectionAction.addSortLimitButton.addLimit",defaultMessage:"Add limit"},addSort:{id:"automations.QueryCollectionAction.addSortLimitButton.addSort",defaultMessage:"Add sort"},limitDescription:{id:"automations.QueryCollectionAction.limitPopup.limitDescription",defaultMessage:"{numberOfPages, plural, one {{numberOfPages} page} other {{numberOfPages} pages}}"},unlimitedDescription:{id:"automations.QueryCollectionAction.limitPopup.unlimitedDescription",defaultMessage:"Unlimited"}});function We(e){window.__c={n:"AddSortLimitButton"};const{actionStore:t,collectionStore:o,disabled:n,onSortAdded:r,onLimitAdded:d}=e,u=(0,s.Fy)(),m=(0,s.O7)(),[g,S]=(0,l.useState)(!1);let y;y=u.isMobile?{menuType:Re.og.ActionSheet}:{menuType:Re.og.Popup,width:250};const v=(0,l.useRef)(null),[f,b]=l.useState(void 0),C=(0,c.VK)((()=>o.getSchema()??{}),[o]),w=(0,c.VK)((()=>o.getFormat()??{}),[o]),k=(0,l.useCallback)((()=>Object.keys(o.getSchema())),[o]),M=(0,c.VK)((()=>t.hasSort()),[t]),T=(0,c.VK)((()=>t.hasLimit()),[t]),P=(0,l.useCallback)((e=>{e&&h.createAndCommit({userAction:"QueryCollectionAction.setInitialSort",environment:m,perform:o=>{E.sW({store:t.getConfigStore(),data:{sort:[{property:e,direction:"ascending"}]},transaction:o})}}),S(!1),r()}),[t,m,r]),_=(0,l.useCallback)((()=>{h.createAndCommit({userAction:"QueryCollectionAction.setInitialLimit",environment:m,perform:e=>{E.sW({store:t.getConfigStore(),data:{limit:1},transaction:e})}}),d()}),[t,m,d]);if(M&&T)return null;let A;return A=M?De.addLimit:T?De.addSort:De.addSortLimit,l.createElement(l.Fragment,null,a()(H.ZP,{popupType:u.isMobile?G.kQ.SlideUp:G.kQ.Popup,alignmentToOrigin:H.vR.Start,placementToOrigin:H.pO.Bottom,originGap:0,disabled:n,renderOrigin:e=>l.createElement(se.S,i()({disabled:n,variant:"gray",ref:v},e),l.createElement(p.FormattedMessage,A)),render:e=>a()(He,{showSortOption:!M,showLimitOption:!T,onSortSelected:()=>{var t;S(!0),b(null===(t=v.current)||void 0===t?void 0:t.getBoundingClientRect()),e.close()},onLimitSelected:()=>{_(),e.close()}})}),a()(G.ZP,{popupType:u.isMobile?G.kQ.SlideUp:G.kQ.Popup,open:g,placementToOrigin:G.ZP.Placement.Bottom,alignmentToOrigin:G.ZP.Alignment.Start,originRect:f,render:()=>l.createElement(x.Z,y,a()(Oe.Z,{schema:C,format:w,currentProperty:void 0,getProperties:k,onAccept:P})),onDismiss:()=>S(!1)}))}function He(e){window.__c={n:"AddSortLimitMenu"};const{showSortOption:t,showLimitOption:o,onSortSelected:n,onLimitSelected:r}=e;let c;c=(0,s.Fy)().isMobile?{menuType:Re.og.ActionSheet}:{menuType:Re.og.Popup,width:250};const d=[];return t&&d.push({key:"sort",action:n,render:e=>l.createElement(M.Z,i()({},e,{title:"Sort",icon:u.Z.arrowsUpDown({width:16})}))}),o&&d.push({key:"limit",action:r,render:e=>l.createElement(M.Z,i()({},e,{title:"Limit",icon:u.Z.arrowDown({width:16})}))}),l.createElement(x.Z,c,a()(T.Z,{type:T.i.Vertical,sections:[{key:0,render:e=>l.createElement(P.Z,i()({enableActionSheetTitle:!0},e)),items:d}],initialFocus:0}))}function ze(e){window.__c={n:"SortPopup"};const{contextStore:t,actionStore:o,collectionStore:n,disabled:r,buttonPopupStore:d}=e,u=(0,s.O7)(),{device:m}=u,g=(0,c.VK)((()=>{var e;return(null===(e=o.getConfig())||void 0===e||null===(e=e.sort)||void 0===e?void 0:e.length)??0}),[o]);return a()(H.ZP,{popupType:m.isMobile?G.kQ.SlideUp:G.kQ.Popup,alignmentToOrigin:H.vR.End,placementToOrigin:H.pO.Bottom,originGap:0,disabled:r,buttonPopupStore:d,renderOrigin:e=>l.createElement(se.S,i()({disabled:r,variant:"gray"},e),a()(p.FormattedMessage,g>0?{defaultMessage:"{numberOfSorts, plural, one {{numberOfSorts} sort} other {{numberOfSorts} sorts}}",values:{numberOfSorts:g},id:"automations.QueryCollectionAction.oneOrMoreSorts.title"}:{defaultMessage:"None",id:"automations.QueryCollectionAction.noSorts.title"})),render:e=>a()(Qe,{contextStore:t,collectionStore:n,actionStore:o,disabled:r})})}function Qe(e){window.__c={n:"SortMenu"};const{contextStore:t,actionStore:o,collectionStore:n,disabled:i}=e,r=(0,s.O7)(),{device:d}=r;let u;u=d.isMobile?{menuType:Re.og.ActionSheet}:{menuType:Re.og.Popup,minWidth:300};const p=(0,l.useCallback)((e=>{h.createAndCommit({userAction:"QueryCollectionAction.setSort",environment:r,perform:t=>{E.sW({store:o.getConfigStore(),data:{sort:e},transaction:t})}})}),[r,o]),m=(0,c.VK)((()=>o.getConfigStore().getKeyStore("sort").getValue()??[]),[o]),g=(0,c.VK)((()=>n.getSchema()),[n]),S=(0,c.VK)((()=>n.getFormat()),[n]);return l.createElement(x.Z,u,a()(Ke.Z,{schema:g,format:S,collectionViewStore:void 0,sorts:m,disabled:i,parentStore:t.context.parentRecordStore,onChange:p}))}function Ne(e){window.__c={n:"LimitPopup"};const{actionStore:t,disabled:o,buttonPopupStore:n}=e,r=(0,s.O7)(),{device:d}=r,u=(0,c.VK)((()=>t.getConfigStore().getKeyStore("limit").getValue()),[t]);return a()(H.ZP,{popupType:d.isMobile?G.kQ.SlideUp:G.kQ.Popup,alignmentToOrigin:H.vR.End,placementToOrigin:H.pO.Bottom,originGap:0,disabled:o,buttonPopupStore:n,renderOrigin:e=>l.createElement(se.S,i()({disabled:o,variant:"gray"},e),(0,f.$K)(u)&&l.createElement(p.FormattedMessage,i()({},De.limitDescription,{values:{numberOfPages:u}}))),render:e=>a()(Ge,{onLimitChanged:o=>{(e=>{h.createAndCommit({userAction:"QueryCollectionAction.setLimit",environment:r,perform:o=>{E.sW({store:t.getConfigStore(),data:{limit:e},transaction:o})}})})(o),e.close()}})})}function Ge(e){window.__c={n:"LimitMenu"};const{onLimitChanged:t}=e;let o;o=(0,s.Fy)().isMobile?{menuType:Re.og.ActionSheet}:{menuType:Re.og.Popup,minWidth:250};const n=[];for(let r=1;r<=5;r++)n.push({key:`limit-${r}`,action:()=>{t(r)},render:e=>l.createElement(M.Z,i()({},e,{title:l.createElement(p.FormattedMessage,i()({},De.limitDescription,{values:{numberOfPages:r}}))}))});return n.push({key:"unlimited",action:()=>{t(void 0)},render:e=>l.createElement(M.Z,i()({},e,{title:l.createElement(p.FormattedMessage,De.unlimitedDescription)}))}),l.createElement(x.Z,o,a()(T.Z,{type:T.i.Vertical,sections:[{key:0,render:e=>l.createElement(P.Z,i()({enableActionSheetTitle:!0},e)),items:n}],initialFocus:0}))}o(21703);var Ue=o(43690),qe=o(78106),je=o(68626),Ye=o(37034);function $e(e){window.__c={n:"TargetPicker"};const{contextStore:t,actionStore:o,disabled:n,errorMessage:r}=e,d=(0,s.O7)(),u=(0,c.VK)((()=>{const e=o.getVariableTargetStore();if(e)return e.getValue();const t=o.getCollectionTargetStore();if(t){const e=t.getKeyStore("collection").getValue();if(e)return{collection:e,type:"collection"}}}),[o]),m=(0,c.VK)((()=>{if(u&&"variable"===u.type)return t.getContextValueForActionById(o.id,u.id)}),[t,o,u]),g=(0,se.d)({errorMessage:r,hasValue:Boolean(u||m)}),S=(0,c.qz)(void 0,Ve.Z),y=(0,K.d)(),v=(0,l.useCallback)((e=>{let t;if("collection"===e.type)t="UpdatePageAction.updateCollection";else if("variable"===e.type)t="UpdatePageAction.updateVariable";else{if("page"===e.type)throw new Error("Not implemented yet.");(0,f.t1)(e)}h.createAndCommit({userAction:t,environment:d,perform:t=>{E.sW({store:o.getConfigStore(),transaction:t,data:{target:e,properties:null,values:null}})}}),S.reset()}),[d,o,S]),b=(0,l.useCallback)((()=>S.reset()),[S]);return a()(H.ZP,{buttonPopupStore:S,popupType:y,alignmentToOrigin:H.vR.End,placementToOrigin:H.pO.Bottom,originGap:0,disabled:n,renderOrigin:e=>l.createElement(se.S,i()({disabled:n},g,e),u&&"collection"===u.type?a()(le.Z,{store:re.NW.createChildStore(t.context.parentRecordStore,u.collection)}):m?a()(Fe.F,{value:m,format:Ae.l.Medium,isSingle:!0}):a()(p.FormattedMessage,{id:"automations.UpdatePagesAction.pagesDropdown.label",defaultMessage:"Select database"})),render:e=>a()(Ze.L,{actionId:o.id,automationContextStore:t,onChange:v,onClose:b,selectedTarget:u,skipPages:!0})})}const Je={create_page:function(e){window.__c={n:"CreatePageAction"};const{contextStore:t,actionStore:o,disabled:n,showErrorIfPresent:r}=e,d=(0,s.O7)(),u=(0,c.VK)((()=>o.getCollectionStore()),[o]),m=(0,c.VK)((()=>{var e;return null===(e=o.getConfig())||void 0===e?void 0:e.collection}),[o]),g=(0,c.VK)((()=>{var e;return null===(e=o.getConfig())||void 0===e?void 0:e.template_page_id}),[o]),S=(0,c.VK)((()=>{var e;if(!u)return[];return((null===(e=u.getTemplatePageStores())||void 0===e?void 0:e.filter((e=>e.pathIsAccessibleAndAlive())))??[]).length>0}),[u]),y=(0,R.E)("create_page_with_template_action"),v=(0,l.useCallback)((e=>{h.createAndCommit({userAction:"CreatePageAction.setCollection",environment:d,perform:t=>{E.sW({store:o.getConfigStore(),data:{collection:e,properties:["title"],values:null,template_page_id:null},transaction:t})}})}),[d,o]),f=(0,l.useCallback)((e=>{h.createAndCommit({userAction:"CreatePageAction.setTemplate",environment:d,perform:t=>{const n=o.getConfig();if(!n)return;const{properties:i,values:r}=n;let a=!1;if(e&&i&&1===i.length&&i.includes("title")){var l;const e=null==r?void 0:r.title;e&&null!==(l=e.value)&&void 0!==l&&l.value||(a=!0)}E.sW({store:o.getConfigStore(),data:{template_page_id:e??null,...a&&{properties:[]}},transaction:t})}})}),[d,o]),b=(0,I.TU)({contextStore:t,actionId:o.id,shouldShow:r,errorKey:"collection"}),C=(0,I.TU)({contextStore:t,actionId:o.id,shouldShow:r,errorKey:"template"});return l.createElement(l.Fragment,null,l.createElement(j,i()({},e,{title:a()(p.FormattedMessage,{id:"automations.CreatePageAction.header",defaultMessage:"Add page to"}),picker:a()("div",{style:{display:"flex",alignItems:"center",whiteSpace:"normal"}},void 0,a()(te.a,{currentValue:m,contextStore:t,onChange:v,disabled:n,errorMessage:b}),u&&S&&y&&a()(p.FormattedMessage,{id:"automations.CreatePageAction.asTemplate",defaultMessage:"as {templateName}",values:{templateName:a()(ce,{collectionStore:u,currentTemplateId:g,onChange:f,disabled:n,errorMessage:C})}}))})),u&&a()(ee.QF,{contextStore:t,collectionStore:u,actionStore:o,disabled:n,showSetPropertyActions:!1}))},update_pages:function(e){window.__c={n:"UpdatePagesAction"};const{contextStore:t,actionStore:o,disabled:n,showErrorIfPresent:r}=e,d=(0,s.O7)(),u=(0,p.useIntl)(),m=(0,c.VK)((()=>o.getTargetStore()),[o]),g=(0,c.VK)((()=>"collection"===m.getKeyStore("type").getValue()),[m]),S=(0,c.VK)((()=>{var e;const t=o.getCollectionTargetStore();return null==t||null===(e=t.getKeyStore("filter"))||void 0===e?void 0:e.getValue()}),[o]),y=(0,l.useCallback)((e=>{h.createAndCommit({userAction:"QueryCollectionAction.setFilter",environment:d,perform:t=>{E.sW({store:m,transaction:t,data:{filter:e}})}})}),[d,m]),v=(0,c.VK)((()=>{const e=m.getValue();if(e){if("collection"===e.type)return re.NW.createChildStore(t.context.parentRecordStore,e.collection);if("variable"===e.type){const o=t.compilationResultStore.state;if(je.x.isFail(o))return;const n=(0,qe.vx)(o.value.valueTypes,e.id);if(n&&"block"===n.type.type&&n.type.collection)return re.NW.createChildStore(t.context.parentRecordStore,n.type.collection);if(n&&"array"===n.type.type&&"block"===n.type.of.type&&n.type.of.collection)return re.NW.createChildStore(t.context.parentRecordStore,n.type.of.collection)}else{if("page"===e.type)return;(0,f.t1)(e)}}}),[m,t.context.parentRecordStore,t.compilationResultStore]),b=(0,c.VK)((()=>v?(0,Ye.vU)({environment:d,intl:u,store:v}):void 0),[v,u,d]),C=(0,c.VK)((()=>S?(0,Ue.Ih)(S,(null==v?void 0:v.getSchema())||{}):void 0),[S,v]),w=(0,I.TU)({contextStore:t,actionId:o.id,shouldShow:r}),k=(0,c.VK)((()=>{var e;const n=null===(e=o.getVariableTargetStore())||void 0===e?void 0:e.getValue();if(!n)return!1;const i=t.getContextValueForActionById(o.id,n.id);return!!i&&"block"===i.type.type}),[o,t]);return l.createElement(l.Fragment,null,l.createElement(j,i()({},e,{title:a()(p.FormattedMessage,k?{id:"automations.UpdatePagesAction.singularHeader",defaultMessage:"Edit"}:{id:"automations.UpdatePagesAction.header",defaultMessage:"Edit pages in"}),picker:a()($e,{contextStore:t,actionStore:o,disabled:n,errorMessage:w})})),g&&v&&a()("div",{style:{margin:"0 0 -4px 8px"}},void 0,a()(Pe,{keyComp:a()(_e,{text:a()(p.FormattedMessage,{id:"automations.UpdatePagesAction.filter.label",defaultMessage:"Pages to edit"})}),valueComp:a()(Le.W,{contextStore:t,filter:C,collectionStore:v,onChange:y,disabled:n,noFiltersMessage:(0,f.$K)(b)?a()(p.FormattedMessage,{defaultMessage:"All pages in {collectionName}",id:"automations.UpdatePagesAction.filterRuleCount.noFilters.label",values:{collectionName:b}}):a()(p.FormattedMessage,{defaultMessage:"All pages in database",id:"automations.UpdatePagesAction.filterRuleCount.noFilters.fallbackLabel",values:{collectionName:b}})})})),v&&a()(ee.QF,{contextStore:t,collectionStore:v,actionStore:o,disabled:n,showSetPropertyActions:!0}))},query_collection:function(e){window.__c={n:"QueryCollectionAction"};const{contextStore:t,actionStore:o,disabled:n}=e,r=(0,s.O7)(),d=(0,c.VK)((()=>o.getCollectionStore()),[o]),u=(0,c.VK)((()=>o.getConfigStore().getKeyStore("collection").getValue()),[o]),m=(0,c.VK)((()=>o.getConfigStore().getKeyStore("filter").getValue()),[o]),g=(0,c.VK)((()=>o.hasSort()),[o]),S=(0,c.VK)((()=>o.hasLimit()),[o]),y=(0,c.qz)(void 0,Ve.Z),v=(0,c.qz)(void 0,Ve.Z),f=(0,l.useCallback)((e=>{h.createAndCommit({userAction:"QueryCollectionAction.setCollection",environment:r,perform:t=>{E.sW({store:o.getConfigStore(),data:{collection:e,filter:void 0,sort:void 0},transaction:t})}})}),[r,o]),b=(0,l.useCallback)((e=>{h.createAndCommit({userAction:"QueryCollectionAction.setFilter",environment:r,perform:t=>{E.sW({store:o.getConfigStore(),data:{filter:e},transaction:t})}})}),[r,o]),C=(0,l.useCallback)((()=>{y.setState({open:!0})}),[y]),w=(0,l.useCallback)((()=>{v.setState({open:!0})}),[v]);return l.createElement(l.Fragment,null,l.createElement(j,i()({},e,{title:a()(p.FormattedMessage,{id:"automations.QueryCollectionAction.title",defaultMessage:"Get pages from"}),picker:a()(te.a,{currentValue:u,contextStore:t,onChange:f,disabled:n})})),d&&l.createElement(l.Fragment,null,a()("div",{style:{margin:"0 8px"}},void 0,a()(Pe,{keyComp:a()(_e,{text:a()(p.FormattedMessage,{id:"automations.QueryCollectionAction.filter.label",defaultMessage:"Filter"})}),valueComp:a()(Le.W,{contextStore:t,collectionStore:d,filter:m,onChange:b,disabled:n,noFiltersMessage:a()(p.FormattedMessage,{defaultMessage:"Return all pages",id:"automations.QueryCollectionAction.filterRuleCount.noFilters.label"})})}),g&&a()(Pe,{keyComp:a()(_e,{text:a()(p.FormattedMessage,{id:"automations.QueryCollectionAction.sort.label",defaultMessage:"Sort"})}),valueComp:a()(ze,{contextStore:t,collectionStore:d,actionStore:o,disabled:n,buttonPopupStore:y})}),S&&a()(Pe,{keyComp:a()(_e,{text:a()(p.FormattedMessage,{id:"automations.QueryCollectionAction.limit.label",defaultMessage:"Limit"})}),valueComp:a()(Ne,{actionStore:o,disabled:n,buttonPopupStore:v})})),a()(We,{collectionStore:d,actionStore:o,disabled:n,onSortAdded:C,onLimitAdded:w})))},open_page:function(e){window.__c={n:"OpenPageAction"};const{contextStore:t,actionStore:o,disabled:n,showErrorIfPresent:r}=e,d=(0,s.O7)(),u=(0,l.useCallback)((e=>{h.createAndCommit({userAction:"OpenPageAction.setTarget",environment:d,perform:t=>{E.sW({store:o.getConfigStore(),data:{target:e},transaction:t})}})}),[d,o]),m=(0,c.VK)((()=>{var e;return null===(e=o.getConfig())||void 0===e?void 0:e.target}),[o]),g=(0,I.TU)({contextStore:t,actionId:o.id,shouldShow:r});return l.createElement(l.Fragment,null,l.createElement(j,i()({},e,{title:a()(p.FormattedMessage,{id:"automations.OpenPageAction.header",defaultMessage:"Open"}),picker:a()(Be,{actionStore:o,target:m,onChange:u,contextStore:t,disabled:n,errorMessage:g})})),a()("div",{style:{margin:"0 8px"}},void 0,a()(Pe,{keyComp:a()(_e,{text:a()(p.FormattedMessage,{id:"automations.OpenPageAction.openPageIn.label",defaultMessage:"Open page in"})}),valueComp:l.createElement(Ee,e)})))},duplicate_blocks:function(e){window.__c={n:"DuplicateBlocksAction"};const{actionStore:t,disabled:o}=e,n=(0,c.VK)((()=>oe.first(t.getBlockPointers())),[t],{useDeepEqual:!0});return l.createElement(l.Fragment,null,l.createElement(j,i()({},e,{title:a()(p.FormattedMessage,{id:"automations.DuplicateBlocksAction.header",defaultMessage:"Insert blocks"}),picker:a()(be,{actionStore:t,disabled:o})})),n?l.createElement(ve,i()({},e,{contentParentPointer:n})):null)},modal_confirmation:function(e){window.__c={n:"ModalConfirmationAction"};const{actionStore:t,disabled:o}=e,n=(0,s.O7)(),r=(0,p.useIntl)(),u=(0,d.yK)((e=>({wrap:{display:"flex",flexDirection:"column",gap:10},plainTextInput:{backgroundColor:e.contentBackground,paddingTop:6,paddingBottom:6}})),[]),g=(0,c.VK)((()=>t.getType()),[t]),S=(0,c.VK)((()=>t.getConfigStore().getKeyStore("text")),[t]),v=(0,c.VK)((()=>S.getValue()),[S]),f=(0,l.useCallback)((e=>{h.createAndCommit({userAction:"BaseModalAction.handleTextChange",environment:n,perform:t=>{E.sO({store:S,value:e,transaction:t})}})}),[n,S]),b=t.getConfigStore().getKeyStore("continue_button").getKeyStore("text"),C=(0,c.VK)((()=>t.getConfigStore().getKeyStore("cancel_button").getKeyStore("text")),[t]);if(!g)return null;const w=(0,y.z)(g);return l.createElement(l.Fragment,null,l.createElement(j,i()({},e,{title:l.createElement(p.FormattedMessage,w.display.name)})),a()("div",{style:u.wrap},void 0,a()(we.D,{disabled:o,value:v,onChange:f,multiline:!0,placeholder:r.formatMessage(Me.confirmationInputPlaceholder),disableFormattingAndMentions:!0,disableMobileActionBar:!0}),a()(xe,{overlayContent:l.createElement(p.FormattedMessage,Me.continueButtonHint)},void 0,a()(ke.Y,{disabled:o,maxlength:m.OO,style:u.plainTextInput,store:b})),a()(xe,{overlayContent:l.createElement(p.FormattedMessage,Me.cancelButtonHint)},void 0,a()(ke.Y,{disabled:o,maxlength:m.OO,style:u.plainTextInput,store:C}))))},slack_notification:()=>null};function Xe(e){window.__c={n:"AutomationAction"};const{contextStore:t,actionStore:o,disabled:n,dragging:i,showErrorIfPresent:r,onActionAdded:l}=e,s=(0,d.yK)((e=>({container:{background:e.contentBackground,borderRadius:5,display:"flex",flexDirection:"column",gap:8,padding:8,marginLeft:12,marginRight:12,marginBottom:8,fontSize:14,boxShadow:i?e.mediumBoxShadow:e.lightBoxShadow,width:"calc(100% - 24px)"},nameRow:{display:"flex",alignItems:"center",marginBottom:4},name:{flexGrow:1,fontWeight:B.Z.fontWeight.medium,marginLeft:8},iconWrap:{width:24,height:24,display:"flex",alignItems:"center",borderRadius:4,background:"rgba(35, 131, 226, 0.14)"},icon:{width:14,height:14,fill:e.blueColor,margin:"0 auto"}})),[i]),u=(0,c.VK)((()=>o.getType()),[o]);if(!u||!(0,Z.lK)(u,"display"))return null;const p=Je[u];return a()("div",{style:s.container},void 0,a()(p,{contextStore:t,actionStore:o,disabled:n,dragging:i,showErrorIfPresent:r,onActionAdded:l}))}var et=o(79131),tt=o(45452);function ot(e){window.__c={n:"AutomationButtonActionList"};const{contextStore:t,disabled:o,suppressErrors:n,onActionAdded:i}=e,r=(0,s.O7)(),u=(0,c.VK)((()=>t.context.automationStore.getActionStores()),[t.context.automationStore]),p=(0,c.VK)((()=>u.map((e=>e.id))),[u]),S=(0,c.qz)(void 0,tt.Z),y=(0,c.VK)((()=>S.state.isDragging),[S]),v=(0,c.VK)((()=>S.state.isDragging&&S.state.draggingKey),[S]),f=!o&&u.length<m.FT,b=(0,d.yK)((e=>({actionsLineWrap:{cursor:y?"grabbing":void 0,position:"relative"},actionLine:{position:"absolute",top:0,bottom:8,left:28,width:4,background:e.accentColors.gray[100],zIndex:1},actionsWrap:{position:"relative",zIndex:2}})),[y]);return l.createElement(l.Fragment,null,a()("div",{style:b.actionsLineWrap},void 0,a()("div",{style:b.actionLine}),a()("div",{style:b.actionsWrap},void 0,a()(et.ZP,{direction:"vertical",disabled:o,keys:p,onDrop:e=>{h.createAndCommit({userAction:"AutomationButtonAction.moveAction",environment:r,perform:o=>{g.kM({clientContext:t.context,transaction:o,newActionIds:e})}})},renderKey:e=>{const r=u.find((t=>t.id===e));return r?a()(Xe,{actionStore:r,contextStore:t,disabled:o,dragging:v===e,onActionAdded:i,showErrorIfPresent:Array.isArray(n)?!n.includes(r.id):!n},r.id):null},store:S}))),f&&a()(nt,{contextStore:t,disabled:o,onActionAdded:i}))}function nt(e){window.__c={n:"AddActionButton"};const{contextStore:t,disabled:o,onActionAdded:n}=e,r=(0,s.O7)(),{device:m}=r,[g,h]=(0,l.useState)(!0),S=(0,d.yK)((e=>({buttonWrap:{boxShadow:"initial",background:"transparent"},button:{color:e.mediumTextColor,fill:e.mediumIconColor},buttonIcon:{width:24,height:m.isMobile?18:16,marginRight:-2}})),[m.isMobile]),y=(0,c.qz)(void 0,Ve.Z),v=(0,K.d)(),f=(0,c.VK)((()=>t.context.automationStore.hasAnyActions()),[t.context.automationStore]);return(0,l.useEffect)((()=>{!f&&g&&(y.setState({open:!0}),h(!1))}),[y,f,g]),a()(H.ZP,{popupType:v,alignmentToOrigin:H.vR.Start,placementToOrigin:H.pO.Bottom,originGap:0,buttonPopupStore:y,disabled:o,renderOrigin:e=>l.createElement(M.Z,i()({focused:!1,style:S.buttonWrap,buttonStyle:S.button,icon:u.Z.plus(S.buttonIcon),title:a()(p.FormattedMessage,f?{id:"automations.addActionButton.nonEmpty.label",defaultMessage:"Add another step"}:{id:"automations.addActionButton.empty.label",defaultMessage:"Add a step"})},e)),render:e=>a()(V,{contextStore:t,onActionAdded:t=>{n(t),e.close()}})})}var it=o(27153),rt=o(24677),at=o(98104),lt=o(42922),st=o(31278),ct=o(18647),dt=o(38797),ut=o(42402);const pt="https://www.notion.so/help/template-buttons";function mt(e){window.__c={n:"FactoryButtonMigrationBanner"};const{handleDismissBanner:t}=e,o=(0,d.yK)((e=>({banner:{width:"100%",display:"flex",alignItems:"start",backgroundColor:e.accentColors.blue["light"===e.mode?50:300],borderRadius:4,padding:12,fontSize:12,lineHeight:1.5,gap:8},icon:{width:12,color:e.blueColor},bannerContent:{flex:"1 1 auto"},bannerTitle:{fontWeight:B.Z.fontWeight.medium},bannerCaption:{color:e.mediumTextColor},closeButton:{borderRadius:"50%"},starIcon:{flex:"0 0 auto",marginBlockStart:3},link:{color:e.text.interactive}})),[]);return a()("div",{style:o.banner},void 0,a()("div",{style:o.starIcon},void 0,u.Z.starFilled(o.icon)),a()("div",{style:o.bannerContent},void 0,a()("div",{style:o.bannerTitle},void 0,a()(p.FormattedMessage,{id:"factoryButton.deprecationBanner.title",defaultMessage:"Your buttons just got better"})),a()("div",{style:o.bannerCaption},void 0,a()(p.FormattedMessage,{id:"factoryButton.deprecationBanner.caption",defaultMessage:"Now you can create, edit and open pages and <buttonsHelpCenterLink>more</buttonsHelpCenterLink>.",values:{buttonsHelpCenterLink:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return a()(ut.Z,{href:pt,disableUnderline:!0,style:o.link},void 0,t)}}}))),a()(Q.Z,{icon:u.Z.close,ariaLabel:"closeButton",style:o.closeButton,onClick:()=>t()}))}var gt=o(59557),ht=o(33929),St=o(34859),yt=o(68910);function vt(e){const{store:t,automationStore:o}=e,n=(0,s.O7)().currentUser.id;return(0,c.VK)((()=>{const e=t.getRecordStoreUIRoot();if(o&&e instanceof re.G)return(0,b.Gb)({type:"button_block",persisted:!0,automationStore:o,blockStore:t,pageStore:e,intl:ht.default.getIntl(),parentRecordStore:o,currentUserId:n})}),[o,t,n])}const ft=(0,p.defineMessages)({addIconButtonAriaLabel:{defaultMessage:"Add icon",id:"buttonBlock.button.addIconButtonAriaLabel"},editButtonAriaLabel:{defaultMessage:"Edit button",id:"buttonBlock.button.editButtonAriaLabel"},buttonPlaceholder:{defaultMessage:"New button",id:"buttonBlock.button.placeholder"},buttonInsufficientPermissions:{defaultMessage:"You don’t have permission to run this button",id:"buttonBlock.button.insufficientPermissions"},clickToEdit:{defaultMessage:"Click to edit button",id:"buttonBlock.button.clickToEdit"}});function bt(e){window.__c={n:"PlacedButtonBlockEditor"};const{buttonBlockStore:t}=e,o=(0,c.VK)((()=>t.state.editing?t.state:void 0),[t]),n=(0,d.yK)((e=>({popup:{width:400},editor:{background:e.sidebarBackground,..."inline"===(null==o?void 0:o.placement.type)?{marginTop:6,borderRadius:6,border:`1px solid ${e.regularDividerColor}`,maxWidth:600}:{}}})),[null==o?void 0:o.placement.type]),r=(0,K.d)({tabletBehavior:"slideUp"});return o?"popup"===o.placement.type?a()(G.ZP,{open:!0,popupType:r,render:()=>l.createElement(Ct,i()({},e,{style:n.editor})),originRect:o.placement.originRect,style:n.popup,originGap:4,onDismiss:()=>{t.stopEditing()}}):"inline"===o.placement.type?l.createElement(Ct,i()({},e,{style:n.editor})):void(0,f.t1)(o.placement):null}function Ct(e){window.__c={n:"ButtonBlockEditor"};const{disabled:t,store:o,buttonBlockStore:n}=e,r=(0,s.O7)(),m=r.currentUser.id,g=(0,p.useIntl)(),y=(0,d.yK)((e=>({header:{display:"flex",alignItems:"center",padding:"12px 12px 8px 12px",gap:6},scroller:{maxHeight:"75vh"},nameInputWrap:{flexGrow:"1"},factoryButtonDeprecationBanner:{margin:"12px 12px 6px 12px"}})),[]),v=(0,k.D)(),f=(0,c.VK)((()=>o.getAutomationStore()),[o]),b=(0,c.VK)((()=>null==f?void 0:f.getNameStore()),[f]),w=(0,c.VK)((()=>null==f?void 0:f.getIconStore()),[f]),M=(0,c.VK)((()=>(null==b?void 0:b.getValue())??""),[b]),x=vt({store:o,automationStore:f}),T=(0,c.VK)((()=>{var e;return o.canEdit()&&"sufficient"===(null==x||null===(e=x.state)||void 0===e?void 0:e.executionPermissionStatus)}),[o,x]),{showFactoryButtonDeprecationBanner:A,handleDismissFactoryButtonMigrationBanner:V}=(0,gt.N)({blockStore:o}),F=(0,c.VK)((()=>null==w?void 0:w.getValue()),[w]),Z=(0,c.VK)((()=>{const e=o.getRecordStoreUIRoot();if(e instanceof re.G)return e}),[o]),B=(0,l.useMemo)((()=>{if(f&&Z)return new yt.L({type:"button_block",persisted:!0,automationStore:f,blockStore:o,pageStore:Z,intl:ht.default.getIntl(),parentRecordStore:f,currentUserId:m})}),[f,Z,o,m]),I=(0,l.useCallback)((e=>{(0,pe.ZP)({event:e,context:pe.Af.EditorClick,callback:()=>{at.ZH(r),rt.ZH(r)}})}),[r]),R=(0,l.useCallback)((()=>{n.stopEditing(),(0,S.lN)(v,{block_id:o.id,automation_id:null==f?void 0:f.id})}),[f,n,o,v]),O=(0,l.useCallback)(((e,t)=>{f&&h.createAndCommit({userAction:"ButtonBlock.updateProperty",environment:r,perform:o=>{E.sW({store:f.getPropertiesStore(),transaction:o,data:{[e]:t??null}})}})}),[f,r]),K=(0,l.useCallback)((e=>O("icon",e)),[O]),L=(0,l.useCallback)((e=>O("name",e)),[O]),D=(0,l.useCallback)((e=>{it.$(r,{originRect:e.currentTarget.getBoundingClientRect(),originGap:4,popupWidth:dt.ZP.desktopPopupWidth,popupHeight:dt.ZP.desktopPopupHeight,isSmallWidth:!1,title:g.formatMessage({defaultMessage:"Icon",id:"buttonBlock.button.iconHeading"}),currentTab:"icon",tabs:[{type:"icon",onChange:e=>{K(e),it.Z()}},{type:"emoji",onChange:(e,t)=>{K(e),it.Z()}}],onDelete:()=>{K(void 0),it.Z()}})}),[r,K,g]),W=(0,c.VK)((()=>n.state.suppressErrorsForActionIds),[n]),H=t||!T;if(!B)return null;const z=e=>l.createElement(Q.Z,i()({ariaLabel:g.formatMessage(ft.addIconButtonAriaLabel),style:{width:26,height:26},iconStyle:{width:16,height:16},hasBackground:!0,disabled:H,showShadow:!0,icon:e=>F?a()(st.Z,{disabled:!0,isEmptyPage:!1,size:24,icon:{icon:F,pointer:o.pointer},style:e}):u.Z.addPageIcon(e)},(0,C.Z)(e??{},{onClick:D}))),N=F?z():a()(_.Z,{renderTooltip:()=>a()(p.FormattedMessage,{defaultMessage:"Add an icon",id:"buttonBlock.button.addIcon"}),delayThreshold:300,render:z});return a()("div",{style:e.style,onClick:I},void 0,A&&a()("div",{style:y.factoryButtonDeprecationBanner},void 0,a()(mt,{handleDismissBanner:V})),a()(ge.p,{allowSelectionWithin:!0,style:y.header},void 0,N,a()(ke.b,{onChange:L,value:M,disabled:H,placeholder:ht.default.formatMessage(ft.buttonPlaceholder),wrapStyle:y.nameInputWrap}),a()(lt.Z,{onClick:R},void 0,a()(p.FormattedMessage,{defaultMessage:"Done",id:"buttonBlock.button.done"}))),a()(ct.Z,{style:y.scroller,type:St.Z.Y},void 0,a()(P.Z,{mobileStyle:{boxShadow:"initial"},mobileTitleStyle:{textTransform:"none",marginTop:8},title:a()(p.FormattedMessage,{id:"buttonBlock.actions",defaultMessage:"When button is clicked"})},void 0,a()(ot,{contextStore:B,disabled:H,suppressErrors:W,onActionAdded:e=>{n.suppressErrorsForAction(e)}}),a()("div",{}))))}},21269:(e,t,o)=>{o.d(t,{Z:()=>d});var n=o(23174),i=o.n(n),r=(o(67294),o(480)),a=o(53397),l=o(50906),s=o(42917),c=o(16354);const d=function(e){window.__c={n:"CollectionSettingsLearnMoreButton"};const{title:t,href:o,analyticsFrom:n}=e,d=(0,r.O7)();return i()(c.Z,{href:o,onClick:()=>l.Fsx(d,{from:n}),external:!0},void 0,i()(s.Z,{icon:a.Z.help,title:t,isGray:!0}))}},61053:(e,t,o)=>{o.d(t,{Z:()=>P});var n=o(23174),i=o.n(n),r=o(10434),a=o.n(r),l=(o(57658),o(43261)),s=o.n(l),c=o(96486),d=o(67294),u=o(83355),p=o(49085),m=o(6695),g=o(53397),h=o(5366),S=o(52821),y=o(33929),v=o(29798),f=o(73657),b=o(52275),C=o(68894),w=o(32163),k=o(72495),M=o(69872);const x=(0,h.defineMessages)({inputPlaceholder:{defaultMessage:"Search for a property…",id:"database.viewSettings.propertySelect.inputPlaceholder"},none:{defaultMessage:"None",id:"database.viewSettings.propertySelect.noneMessage"},remove:{defaultMessage:"Remove",id:"database.viewSettings.propertySelect.removeMessage"}});class T extends u.Z{constructor(){super(...arguments),this.storeTypes={inputStore:p.default.createClass(""),menuListStore:v.Z,showAllProperties:p.default.createClass(!1)}}renderComponent(){const{currentProperty:e,showNoneOption:t,showRemoveOption:o,getProperties:n,onAccept:r,intl:l,inputPlaceholder:u,defaultShowPropertyCount:p,schema:v,format:M}=this.props,{device:T}=this.environment,{inputStore:P,menuListStore:_}=this.stores,A=P.state,V=(0,m.iB)(M,v,void 0,m.j5.Page).collection_page_properties||[],F=!p||this.stores.showAllProperties.state,Z=l.formatMessage(x.none),B=t?{key:"none",render:t=>d.createElement(b.Z,a()({},t,{checkState:!e,title:Z})),action:()=>{r(void 0)}}:void 0,E=o?{key:"remove",render:e=>d.createElement(b.Z,a()({},e,{icon:g.Z.trash({width:16,fill:this.theme.mediumTextColor,marginLeft:4,marginRight:2}),title:l.formatMessage(x.remove)})),action:()=>{r(void 0)}}:void 0,I=n();let R=c.sortBy(I,(e=>V.findIndex((t=>t.property===e))));if(A){const e=new Map;let t=R.map((t=>{const o=v[t],n=o?`${o.name} ${S.SO[o.type]}`:"";return e.set(t,n),n}));t=s().filter(A,t).map((e=>{let{original:t}=e;return t})),R=R.filter((o=>t.includes(e.get(o)||"")))}else!F&&p&&(R=R.slice(0,p));const O=c.compact([!A||s().test(A,Z)?B:void 0,...R.map((e=>this.renderPropertyMenuItem(e)))]);if(!F&&I.length>R.length&&!A){const e={key:"show_more",render:e=>d.createElement(b.Z,a()({},e,{icon:g.Z.dots({width:16,fill:this.theme.mediumTextColor,marginLeft:4,marginRight:2}),style:{color:this.theme.mediumTextColor},title:i()(h.FormattedMessage,{defaultMessage:"{moreCount} more",id:"database.viewSettings.propertySelect.showMoreTitle",values:{moreCount:I.length-R.length}})})),action:()=>{this.stores.showAllProperties.setState(!0)}};O.push(e)}const K=O.length>0,L=Boolean(A),D=!E||K||L;D&&!K&&O.push({action:c.noop,key:"noResults",render:e=>d.createElement(f.Z,a()({},e,{caption:i()(h.FormattedMessage,{defaultMessage:"No results",id:"database.viewSettings.propertySelect.noResultsTitle"})}))});const W=[];return D&&W.push({key:"input",comp:i()(k.Z,{},void 0,i()(C.ZP,{focusInitial:!T.isMobile||void 0,focus:!T.isMobile||void 0,value:A,onChange:e=>{P.setState(e.target.value),_.setState({..._.state,focus:{section:0,indexLocal:0,indexGlobal:0}}),this.stores.showAllProperties.setState(!1)},placeholder:u||y.default.formatMessage(x.inputPlaceholder)}))}),(O.length>0||E)&&W.push({key:"properties",comp:i()(w.Z,{type:w.i.Vertical,initialFocus:0,sections:[...O.length>0?[{key:"results",render:e=>d.createElement(k.Z,e),items:O}]:[],...E?[{key:"remove",render:e=>d.createElement(k.Z,a()({topBorder:O.length>0},e)),items:[E]}]:[]],store:_})}),d.createElement(d.Fragment,null,W.map((e=>{let{key:t,comp:o}=e;return i()(d.Fragment,{},t,o)})))}renderPropertyMenuItem(e){const{schema:t,currentProperty:o,onAccept:n,renderProperty:i}=this.props,r=t[e];if(!r)return;return{key:e,render:t=>{const n=e===o;return i?i(t,e,n,r):d.createElement(M.Z,a()({},t,{propertySchema:r,format:M.Z.DisplayFormat.Name,checkState:n}))},action:()=>{n(e)}}}}T.displayName="CollectionSettingsPropertySelectMenu";const P=(0,h.injectIntl)(T)},71846:(e,t,o)=>{o.d(t,{S:()=>P,Z:()=>V});var n=o(10434),i=o.n(n),r=o(23174),a=o.n(r),l=(o(57658),o(67294)),s=o(83355),c=o(49085),d=o(53397),u=o(6287),p=o(5366),m=o(77162),g=o(31299),h=o(33929),S=o(29798),y=o(68216),v=o(73657),f=o(52275),b=o(68894),C=o(32163),w=o(11470),k=o(77137),M=o(72495),x=o(58032),T=o(78948);let P=function(e){return e[e.Source=0]="Source",e[e.Relation=1]="Relation",e[e.Automation=2]="Automation",e}({});const _=(0,p.defineMessages)({linkedInputPlaceholder:{defaultMessage:"Link to a database…",id:"database.viewSettings.searchCollections.linkedInputPlaceholder"},linkedOrSourceInputPlaceholder:{defaultMessage:"Link or create a database…",id:"database.viewSettings.searchCollections.linkedOrSourceInputPlaceholder"},automationInputPlaceholder:{id:"automations.databasePicker.automationInputPlaceholder",defaultMessage:"Select a database…"}});class A extends s.Z{constructor(){super(...arguments),this.storeTypes={inputStore:c.default.createClass(""),limitStore:c.default.createClass(5),menuListStore:S.Z},this.performSearchCollections=async e=>{const{query:t,limit:o}=e,{collectionContextStore:n,parentStore:i,requireEditPermissions:r}=this.props,a=null==n?void 0:n.collectionViewBlockStore(),l=await g.RT({environment:this.environment,collectionViewBlockStore:a,parentStore:i,query:t,limit:o,requireEditPermissions:r});return{results:l.results,showMore:Math.max(0,l.total-l.results.length)}}}renderComponent(){const{collectionContextStore:e,selectedCollectionStore:t,context:o,parentStore:n}=this.props,{device:r}=this.environment,{limitStore:s,inputStore:c,menuListStore:m}=this.stores,S=c.state,x="linked"===(null==e?void 0:e.getCollectionViewBlockSourceState())||o===P.Relation?_.linkedInputPlaceholder:o===P.Source?_.linkedOrSourceInputPlaceholder:_.automationInputPlaceholder;return l.createElement(l.Fragment,null,a()(M.Z,{},void 0,a()(b.ZP,{focusInitial:!r.isMobile||void 0,value:S,onChange:e=>{c.setState(e.target.value),s.setState(e.target.value?20:5),m.setState({focus:{section:0,indexLocal:0,indexGlobal:0}})},placeholder:h.default.formatMessage(x),showClearButton:!0})),a()(k.Z,{request:{query:S,limit:s.state},performRequest:this.performSearchCollections,debounce:g.vp,render:(r,c,g)=>{if(!c)return a()(M.Z,{},void 0,a()(T.Z,{}));const{results:h,showMore:S}=c,b=h.map((r=>{const a=y.NW.createChildStore(n,{table:u.v,id:r});return{key:r,render:n=>{var s;return l.createElement(w.Z,i()({},n,{checkState:t&&t.id===r,store:a,right:o===P.Relation&&(null==e||null===(s=e.collectionStore())||void 0===s?void 0:s.id)===r&&this.renderSelfDatabaseIconTooltip()}))},action:e=>{const{index:t}=e;this.handleAcceptExistingCollection({collectionStore:a,totalResults:h.length,clickedIndex:t})}}}));if(S>0){const e={key:"showMore",render:e=>l.createElement(f.Z,i()({},e,{buttonStyle:{color:this.theme.mediumTextColor,fill:this.theme.mediumIconColor},icon:d.Z.dots({width:16,height:16}),title:a()(p.FormattedMessage,{defaultMessage:"Show {showMore} more",id:"database.viewSettings.searchCollections.showMore.title",values:{showMore:Math.min(S,20)}})})),action:()=>{s.setState(s.state+20)}};b.push(e)}return l.createElement(l.Fragment,null,h.length>0&&a()(C.Z,{type:C.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>l.createElement(M.Z,e),items:b}],store:m}),0===h.length&&a()(v.Z,{caption:a()(p.FormattedMessage,{defaultMessage:"No results",id:"database.viewSettings.searchCollections.noResultsTitle"})}))}}))}renderSelfDatabaseIconTooltip(){return a()(x.Z,{renderTooltip:()=>a()(p.FormattedMessage,{defaultMessage:"This database",id:"database.viewSettigs.searchCollections.thisDatabase.tooltip"}),render:e=>l.createElement("div",e,d.Z.info({width:14,height:14}))})}handleAcceptExistingCollection(e){const{collectionStore:t,totalResults:o,clickedIndex:n}=e,{collectionContextStore:i,searchSessionId:r,context:a}=this.props,{inputStore:l}=this.stores;i&&m.wd({environment:this.environment,collectionContextStore:i,action:"select_existing_collection"});const{onAccept:s}=this.props;s(t),m.tW({environment:this.environment,eventName:"select_search_item",totalResults:o,clickedIndex:n,sessionId:r,source:a,queryLength:l.state.length})}}A.displayName="CollectionSettingsSearchCollections";const V=(0,p.injectIntl)(A)},98421:(e,t,o)=>{o.d(t,{Z:()=>ce,v:()=>se});var n=o(10434),i=o.n(n),r=o(23174),a=o.n(r),l=(o(21703),o(96486)),s=o(67294),c=o(83355),d=o(49085),u=o(15145),p=o(6906),m=o(99036),g=o(39068),h=o(53877),S=o(6695),y=o(4615),v=o(82990),f=o(5366),b=o(50906),C=o(77162),w=o(5149),k=o(64434),M=o(96802),x=o(5978),T=o(80402),P=o(12359),_=o(28020),A=o(40863),V=o(33929);const F=(0,f.defineMessages)({none:{defaultMessage:"None",id:"database.viewPropertiesMenu.coverFormat.none"},page_content:{defaultMessage:"Page content",id:"database.viewPropertiesMenu.coverFormat.pageContent"},page_cover:{defaultMessage:"Page cover",id:"database.viewPropertiesMenu.coverFormat.pageCover"}}),Z=(0,f.defineMessages)({small:{defaultMessage:"Small",id:"database.viewPropertiesMenu.coverSize.small"},medium:{defaultMessage:"Medium",id:"database.viewPropertiesMenu.coverSize.medium"},large:{defaultMessage:"Large",id:"database.viewPropertiesMenu.coverSize.large"}}),B=function(e){return e?"page_content"===e.type?V.default.formatMessage(F.page_content):"page_cover"===e.type?V.default.formatMessage(F.page_cover):void 0:V.default.formatMessage(F.none)},E=e=>{switch(e){case"small":return V.default.formatMessage(Z.small);case"medium":return V.default.formatMessage(Z.medium);case"large":return V.default.formatMessage(Z.large)}};var I=o(90833),R=o(52821),O=o(48543),K=o(65742),L=o(78316),D=o(84210),W=o(87279),H=o(33665),z=o(79315),Q=o(61766),N=o(36857),G=o(88923),U=o(21269),q=o(42917),j=o(13709),Y=o(61053),$=o(75544),J=o(42922),X=o(64921),ee=o(31945),te=o(74194),oe=o(78140),ne=o(44532),ie=o(72495),re=o(86825);class ae extends c.Z{constructor(){super(...arguments),this.storeTypes={hoveredType:d.default.createClass(void 0),timelineByButtonPopupStore:Q.Z,timelineByEndButtonPopupStore:Q.Z,calendarByButtonPopupStore:Q.Z},this.renderViewTypeButton=e=>{const{intl:t,collectionContextStore:o}=this.props,n=this.getCurrentViewType(),i=o.permissionScopes.state,r=n===e,l=r||!i.canConfigureBlock;return a()(X.Z,{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"calc(33% - 12px)",flexGrow:0,flexShrink:0,fontSize:11,borderRadius:3,margin:6,padding:6,boxShadow:`0 0 0 1px ${this.theme.regularDividerColor}`,color:this.theme.mediumTextColor,fill:this.theme.mediumTextColor,...r&&{boxShadow:`0 0 0 2px ${this.theme.blueColor}`,color:this.theme.blueColor,fill:this.theme.blueColor,fontWeight:500}},disabled:l,onClick:()=>{P.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.renderViewTypeButton",environment:this.environment,perform:n=>{k.z2({environment:this.environment,collectionContextStore:o,newViewType:e,transaction:n,intl:t})}}),C.wd({environment:this.environment,collectionContextStore:o,action:"change_type",original_view_type:n})},onMouseMove:()=>{this.stores.hoveredType.setState(e)}},void 0,R.aW[e]({width:void 0,height:20,marginBottom:4,marginTop:4}),a()("div",{},void 0,R.Bh[e]))},this.handleCoverFormatChange=e=>{const{collectionContextStore:t}=this.props,o=this.getCoverFormatKey(),n=t.collectionViewStore();o&&n&&(P.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.handleCoverFormatChange",environment:this.environment,perform:t=>{M.FH({stores:[n],update:{[o]:e},transaction:t})}}),C.wd({environment:this.environment,collectionContextStore:t,action:"update_cover_format"}))},this.handleCoverSizeFormatChange=e=>{const{collectionContextStore:t}=this.props,o=this.getCoverSizeFormatKey(),n=t.collectionViewStore();o&&n&&(P.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.handleCoverSizeFormatChange",environment:this.environment,perform:t=>{M.FH({stores:[n],update:{[o]:e},transaction:t})}}),C.wd({environment:this.environment,collectionContextStore:t,action:"toggle_cover_size_format"}))},this.handleCoverAspectFormatToggle=()=>{const{collectionContextStore:e}=this.props,t=this.getCoverAspectFormatKey(),o=e.collectionViewStore(),n=e.normalizedFormatStore.state;t&&o&&(P.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.handleCoverAspectFormatToggle",environment:this.environment,perform:e=>{M.FH({stores:[o],update:{[t]:"contain"===n[t]?"cover":"contain"},transaction:e})}}),C.wd({environment:this.environment,collectionContextStore:e,action:"toggle_cover_aspect_format"}))},this.handleShowCollectionTitleClick=()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore();if(!t)return;const o=!e.shouldShowSource.state;P.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.handleShowCollectionTitleClick",environment:this.environment,perform:e=>{M.FH({stores:[t],update:{hide_linked_collection_name:!o},transaction:e})}}),C.wd({environment:this.environment,collectionContextStore:e,action:"toggle_show_collection_title"})},this.handleTableWrapCellsToggle=()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore();if(!t)return;const o=Boolean(e.normalizedFormatStore.state.table_wrap);T.qY({environment:this.environment,collectionViewStore:t,currentValue:o}),b.wds(this.environment,{view_type:this.getCurrentViewType(),action:"set_first_load_limit"}),C.wd({environment:this.environment,collectionContextStore:e,action:"toggle_table_wrap_cells"})},this.handleTableVerticalLinesToggle=()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore();if(!t)return;const o=Boolean(e.normalizedFormatStore.state.hide_table_vertical_lines);T.AU({environment:this.environment,collectionViewStore:t,currentValue:o}),C.wd({environment:this.environment,collectionContextStore:e,action:"toggle_table_vertical_lines"})},this.handleTableSubitemToggleOnTitleToggle=()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore();t&&(T.d1({environment:this.environment,collectionViewStore:t,currentValue:e.normalizedFormatStore.state.table_subitem_toggle_column}),C.wd({environment:this.environment,collectionContextStore:e,action:"toggle_table_subitem_toggle_on_title"}))},this.handleTimelineSeparateDatesClick=()=>{const{collectionContextStore:e}=this.props,t=e.normalizedQueryStore.state,o=e.collectionViewStore(),n=null==t?void 0:t.timeline_by,i=null==t?void 0:t.timeline_by_end;if(!n||!o)return;const r=i?void 0:n;P.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.handleTimelineSeparateDatesClick",environment:this.environment,perform:e=>{k.Es({collectionViewStore:o,update:{timeline_by_end:r??null},transaction:e})}}),C.wd({environment:this.environment,collectionContextStore:e,action:"toggle_timeline_separate_dates"})},this.handleOpenPeekModePicker=()=>{C.nS({environment:this.environment,collectionContextStore:this.props.collectionContextStore,from:"collection_view_settings"})},this.handleCalendarViewRangeOptionClick=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();if(!o)return;const{serverCommitResult:n}=P.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.handleViewRangeOptionClick",environment:this.environment,perform:t=>{M.FH({stores:[o],update:{calendar_view_range:e},transaction:t})}}),i=_.AK.state,r=t.dateRangeStart.state,a=t.dateRangeEnd.state,{newDateRangeStart:l,newDateRangeEnd:s}=this.getNewDateRange({oldCalendarEnd:a,newViewRange:e,startOfWeekSetting:i});k.t5({dateRangeStart:l,dateRangeEnd:s,collectionContextStore:t}),n.then((()=>{C.wd({environment:this.environment,collectionContextStore:t,action:"update_calendar_view_range"})})).catch((()=>{k.t5({dateRangeStart:r,dateRangeEnd:a,collectionContextStore:t})}))},this.handlePeekModeFormatClick=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();if(o&&e&&(P.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.handlePeekModeFormatClick",environment:this.environment,perform:t=>{M.FH({stores:[o],update:{collection_peek_mode:e},transaction:t})}}),C.gl({environment:this.environment,collectionContextStore:t,peek_mode:e,from:"collection_view_settings"}),G.default.state.open&&G.default.state.collectionContextStore===t)){const{mainEditorCurrentBlockStore:t}=z.default.state,o="full_page"===e?(0,D.ZP)({store:G.default.state.target,fullyQualified:!1,pageVisitSource:u.tY.Expand}):(0,L.mb)({store:G.default.state.target,mainEditorCurrentBlockStore:t,collectionContextStore:G.default.state.collectionContextStore,fullyQualified:!1,overridePeekMode:(0,G.getPeekModeFromCollectionPeekModeFormat)(e)});o&&x.navigate({environment:this.environment,url:o})}},this.handleViewTypeAreaMouseLeave=()=>{this.stores.hoveredType.setState(void 0)},this.handleDoneClick=()=>{const{collectionSettingsStore:e,collectionContextStore:t}=this.props;w.wl({collectionSettingsStore:e,item:{type:"main"}}),C.wd({environment:this.environment,collectionContextStore:t,action:"click_create_view_done"})}}renderComponent(){const{collectionContextStore:e,showDoneButton:t}=this.props,{hoveredType:o}=this.stores,{device:n}=this.environment,i=e.normalizedQueryStore.state,r=e.normalizedSchemaStore.state,l=e.normalizedFormatStore.state,c=e.isFullScreen.state,d=e.isRootChild.state,u=this.getCurrentViewType(),p=Boolean(this.getCoverFormatKey()),g="table"===u,h="table"===u,S=Object.keys(r).filter((e=>{const t=r[e];return t&&(0,m.Lt)(t)})),y="timeline"===u&&S.length>0,v="timeline"===u&&S.length>1,b="timeline"===u&&Boolean(null==i?void 0:i.timeline_by_end),C="calendar"===u&&S.length>0,w="calendar"===u,k="board"===u,M=(0,K.d$)({environment:this.environment,isFullScreen:c,isRootChild:d}),x="timeline"===u&&Boolean(l.timeline_show_table)&&M,T="timeline"===u&&M,P=e.collectionViewBlockStore();if(!P)return;const _=P.getCollectionViewSourceCollectionStore(),A=!("collectionTypedView"===e.contextType||_&&c),V=e.permissionScopes.state,F="page"===u;return s.createElement(s.Fragment,null,a()(ie.Z,{topBorder:!1,shouldShowBottomDivider:n.isMobile},void 0,a()("div",{style:{...!n.isMobile&&{width:"100%",paddingLeft:8,paddingRight:8},...n.isMobile&&{background:this.theme.contentBackground,width:"100%",paddingTop:12,paddingBottom:12}},onMouseLeave:this.handleViewTypeAreaMouseLeave},void 0,a()("div",{style:{display:"flex",flexFlow:"wrap",justifyContent:"center"}},void 0,["table","board","timeline","calendar","list","gallery"].map(this.renderViewTypeButton)),a()("div",{style:{color:this.theme.lightTextColor,fontSize:12,margin:"6px 8px 0px 8px"}},void 0,R.sN[o.state||u]))),a()(ie.Z,{},void 0,A&&a()(re.Z,{title:a()(f.FormattedMessage,{defaultMessage:"Show database title",id:"database.viewSettings.layoutTab.showDatabaseTitle.title"}),focused:!1,on:e.shouldShowSource.state,onClick:this.handleShowCollectionTitleClick,disabled:!V.canConfigureBlock,textWrapperStyle:{opacity:1}}),p&&this.renderCardSettings(),h&&this.renderTableVerticalLinesSetting(),g&&this.renderTableWrapCellsSetting(),F&&this.renderPageViewSetting(),y&&this.renderTimelineBySetting(),b&&this.renderTimelineEndSetting(),v&&this.renderTimelineSeparateDatesSetting(),C&&this.renderCalendarBySetting(),w&&this.renderCalendarViewRangeSetting(),T&&a()($.N,{collectionContextStore:e}),x&&this.renderTimelineTableProperties(),k&&this.renderBoardGroupByShortcuts(),this.renderPeekModeSetting()),t&&a()(ie.Z,{disableMobileBorders:!0},void 0,a()(J.Z,{style:{display:"flex",margin:"0 14px"},onClick:this.handleDoneClick},void 0,a()(f.FormattedMessage,{defaultMessage:"Done",id:"database.viewSettings.createViewTab.doneButton.title"}))),a()(ie.Z,{topBorder:!1},void 0,a()(U.Z,{href:(0,H.UY)("guides.databaseView"),title:a()(f.FormattedMessage,{defaultMessage:"Learn about views",id:"database.viewSettings.layoutTab.learnMoreButton.title"}),analyticsFrom:"view_settings_layout"})))}renderCardSettings(){const{device:e}=this.environment,{collectionContextStore:t}=this.props,o=this.getCoverFormat(),n=this.getCoverSizeFormat(),i=!e.isMobile||"board"===this.getCurrentViewType(),r=t.permissionScopes.state;return s.createElement(s.Fragment,null,a()(j.Z,{title:a()(f.FormattedMessage,{defaultMessage:"Card preview",id:"database.viewSettings.layoutTab.cardPreviewButtonTitle"}),selectedKey:o,popupStyle:{minWidth:190},options:this.getCoverFormatOptions(),onChange:this.handleCoverFormatChange,disabled:!r.canConfigureBlock}),i&&a()(j.Z,{title:a()(f.FormattedMessage,{defaultMessage:"Card size",id:"databdatabase.viewSettings.layoutTab.cardSizeButtonTitle"}),selectedKey:n,popupStyle:{minWidth:190},options:this.getCoverSizeFormatOptions(),onChange:this.handleCoverSizeFormatChange,disabled:!r.canConfigureBlock}),o&&a()(re.Z,{title:a()(f.FormattedMessage,{defaultMessage:"Fit image",id:"databdatabase.viewSettings.layoutTab.fitImageButtonTitle"}),on:"contain"===this.getCoverAspectFormat(),focused:!1,onClick:this.handleCoverAspectFormatToggle,disabled:!r.canConfigureBlock,textWrapperStyle:{opacity:1}}))}getCoverFormatOptions(){const{collectionContextStore:e}=this.props,t=e.normalizedSchemaStore.state;let o=Object.keys(t);o=l.sortBy(o,(e=>{const o=t[e];return o?o.name:""}));const{theme:n}=this,i=l.compact(o.map((e=>{const o=t[e];if(o&&"file"===o.type){return{key:{type:"property",property:e},title:o.name,icon:a()(g.ZP,{type:o.type,icon:o.icon,size:this.environment.device.isMobile?16:14,theme:n,style:{fill:n.regularIconColor}})}}})));return[...[void 0,{type:"page_cover"},{type:"page_content"}].map((e=>({key:e,title:B(e)}))),...i]}getCoverSizeFormatOptions(){return["small","medium","large"].map((e=>({key:e,title:E(e)})))}renderTableVerticalLinesSetting(){const{collectionContextStore:e}=this.props,t=e.permissionScopes.state;return a()(re.Z,{title:a()(f.FormattedMessage,{defaultMessage:"Show vertical lines",id:"database.viewSettings.layoutTab.tableShowVerticalLines"}),on:!Boolean(e.normalizedFormatStore.state.hide_table_vertical_lines),focused:!1,onClick:this.handleTableVerticalLinesToggle,disabled:!t.canConfigureBlock,textWrapperStyle:{opacity:1}})}renderTableWrapCellsSetting(){const{collectionContextStore:e}=this.props,t=e.normalizedFormatStore.state,o=e.permissionScopes.state;return a()(re.Z,{title:a()(f.FormattedMessage,{defaultMessage:"Wrap all columns",id:"database.viewSettings.layoutTab.tableWrapAllColumns"}),on:Boolean(t.table_wrap),focused:!1,onClick:this.handleTableWrapCellsToggle,disabled:!o.canConfigureBlock,textWrapperStyle:{opacity:1}})}renderPageViewSetting(){const e=this.props.collectionContextStore.collectionViewStore();if(e)return a()("div",{style:{padding:5}},void 0,a()(te.Z,{showClearButton:!0,placeholder:"Enter page ID",focusInitial:!0,onChange:e=>{N.Z.setState({pageId:e.target.value})},onSubmit:t=>{const o=N.Z.state.pageId;o&&P.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.renderPageViewSettings",environment:this.environment,perform:t=>{M.FH({stores:[e],update:{page_pointer:{id:(0,y.Mt)(o),spaceId:t.spaceId,table:"block"}},transaction:t})}})}}))}renderTimelineBySetting(){var e,t;const{device:o}=this.environment,{collectionContextStore:n}=this.props,r=null===(e=n.normalizedQueryStore.state)||void 0===e?void 0:e.timeline_by,l=null===(t=n.normalizedQueryStore.state)||void 0===t?void 0:t.timeline_by_end,c=n.normalizedSchemaStore.state,d=n.collectionViewStore(),u=n.permissionScopes.state,p=n.collectionStore();if(!r||!d||!p)return;const g=c[r];return g?a()(ee.ZP,{popupType:o.isPhone?ne.kQ.SlideUp:ne.kQ.Popup,alignmentToOrigin:ee.vR.End,placementToOrigin:ee.pO.Bottom,originGap:0,renderOrigin:e=>s.createElement(q.Z,i()({title:a()(f.FormattedMessage,l?{defaultMessage:"Start date",id:"database.viewSettings.layoutTab.timelineStartDate.title"}:{defaultMessage:"Show timeline by",id:"database.viewSettings.layoutTab.showTimelineByProperty.title"}),disabled:!u.canConfigureBlock,showChevron:!0,right:a()("div",{style:v.Z.textOverflowStyle},void 0,g.name),rightStyle:{flexShrink:1},textWrapperStyle:{flexShrink:0}},e)),render:e=>{let t;return t=o.isPhone?{menuType:W.og.ActionSheet}:{menuType:W.og.Popup,width:300},s.createElement(oe.Z,t,a()(Y.Z,{schema:p.getSchema(),format:p.getFormat(),currentProperty:r,getProperties:()=>Object.keys(c).filter((e=>{const t=c[e];return t&&(0,m.Lt)(t)})),onAccept:t=>{t&&(P.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.renderTimelineBySetting",environment:this.environment,perform:e=>{k.Es({collectionViewStore:d,update:{timeline_by:t},transaction:e})}}),e.close(),C.wd({environment:this.environment,collectionContextStore:n,action:"update_timeline_by",original_view_type:void 0,property_type:g[t].type}))}}))}}):void 0}renderTimelineEndSetting(){var e;const{device:t}=this.environment,{collectionContextStore:o}=this.props,n=null===(e=o.normalizedQueryStore.state)||void 0===e?void 0:e.timeline_by_end,r=o.normalizedSchemaStore.state,l=o.permissionScopes.state,c=o.collectionViewStore(),d=o.collectionStore();if(!n||!c||!d)return;const u=r[n];return u?a()(ee.ZP,{popupType:t.isPhone?ne.kQ.SlideUp:ne.kQ.Popup,alignmentToOrigin:ee.vR.End,placementToOrigin:ee.pO.Bottom,originGap:0,renderOrigin:e=>s.createElement(q.Z,i()({title:a()(f.FormattedMessage,{defaultMessage:"End date",id:"database.viewSettings.layoutTab.timelineEndDate.title"}),showChevron:!0,right:u.name,disabled:!l.canConfigureBlock},e)),render:e=>{let i;return i=t.isPhone?{menuType:W.og.ActionSheet}:{menuType:W.og.Popup,width:300},s.createElement(oe.Z,i,a()(Y.Z,{schema:d.getSchema(),format:d.getFormat(),currentProperty:n,getProperties:()=>Object.keys(r).filter((e=>{const t=r[e];return t&&(0,m.Lt)(t)})),onAccept:t=>{t&&(P.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.renderTimelineEndSetting",environment:this.environment,perform:e=>{k.Es({collectionViewStore:c,update:{timeline_by_end:t},transaction:e})}}),e.close(),C.wd({environment:this.environment,collectionContextStore:o,action:"update_timeline_by_end",original_view_type:void 0,property_type:u[t].type}))}}))}}):void 0}renderTimelineSeparateDatesSetting(){const{collectionContextStore:e}=this.props,t=e.normalizedQueryStore.state,o=null==t?void 0:t.timeline_by_end,n=e.permissionScopes.state;return a()(re.Z,{title:a()(f.FormattedMessage,{defaultMessage:"Separate start and end dates",id:"database.viewSettings.layoutTab.timelineUseSeparateDates.title"}),focused:!1,on:Boolean(o),onClick:this.handleTimelineSeparateDatesClick,disabled:!n.canConfigureBlock,textWrapperStyle:{opacity:1}})}renderCalendarViewRangeSetting(){const{collectionContextStore:e}=this.props,t=e.permissionScopes.state,o=this.getCalendarViewRange();return a()(j.Z,{title:a()(f.FormattedMessage,{defaultMessage:"Show calendar as",id:"database.viewSettings.layoutTab.showCalendarAs.title"}),collectionContextStore:e,openButtonPopup:"peekModeFormat"===e.settingsStore.state.openButtonPopup,selectedKey:o,popupStyle:{minWidth:190},options:le(),onChange:this.handleCalendarViewRangeOptionClick,disabled:!t.canConfigureBlock})}renderCalendarBySetting(){var e;const{device:t}=this.environment,{collectionContextStore:o}=this.props,n=null===(e=o.normalizedQueryStore.state)||void 0===e?void 0:e.calendar_by,r=o.permissionScopes.state,l=o.normalizedSchemaStore.state,c=o.collectionViewStore(),d=o.collectionStore();if(!n||!c||!d)return;const u=l[n];return u?a()(ee.ZP,{popupType:t.isPhone?ne.kQ.SlideUp:ne.kQ.Popup,alignmentToOrigin:ee.vR.End,placementToOrigin:ee.pO.Bottom,originGap:0,renderOrigin:e=>s.createElement(q.Z,i()({title:a()(f.FormattedMessage,{defaultMessage:"Show calendar by",id:"database.viewSettings.layoutTab.showCalendarByProperty.title"}),disabled:!r.canConfigureBlock,showChevron:!0,right:a()("div",{style:v.Z.textOverflowStyle},void 0,u.name),rightStyle:{flexShrink:1},textWrapperStyle:{flexShrink:0}},e)),render:e=>{let i;return i=t.isPhone?{menuType:W.og.ActionSheet}:{menuType:W.og.Popup,width:300},s.createElement(oe.Z,i,a()(Y.Z,{schema:d.getSchema(),format:d.getFormat(),currentProperty:n,getProperties:()=>Object.keys(l).filter((e=>{const t=l[e];return t&&(0,m.Lt)(t)})),onAccept:t=>{t&&(P.createAndCommit({userAction:"CollectionSettingsViewLayoutMenu.renderCalendarBySetting",environment:this.environment,perform:e=>{k.Es({collectionViewStore:c,update:{calendar_by:t},transaction:e})}}),e.close(),C.wd({environment:this.environment,collectionContextStore:o,action:"update_calendar_by",original_view_type:void 0,property_type:u[t].type}))}}))}}):void 0}renderTimelineTableProperties(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=(e.normalizedFormatStore.state.timeline_table_properties||[]).filter((e=>Boolean(e.visible))).length,n=e.permissionScopes.state;return a()(q.Z,{title:a()(f.FormattedMessage,{defaultMessage:"Table properties",id:"database.viewSettings.layoutTab.tablePropertiesButton.title"}),showChevron:!0,right:a()(f.FormattedMessage,{defaultMessage:"{propertiesShown} shown",id:"database.viewSettings.layoutTab.propertiesButton.propertiesShown.title",values:{propertiesShown:o}}),onClick:()=>{w.H4({collectionSettingsStore:t,item:{type:"properties",timelineViewTab:"table"}}),C.wd({environment:this.environment,collectionContextStore:e,action:"click_timeline_table_properties"})},disabled:!n.canConfigureBlock})}renderBoardGroupByShortcuts(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=e.normalizedFormatStore.state.board_columns_by,n=e.normalizedSchemaStore.state;if(!o)return;const i=e.permissionScopes.state,r=n[o.property];return r?s.createElement(s.Fragment,null,a()(q.Z,{title:a()(f.FormattedMessage,{defaultMessage:"Group by",id:"database.viewSettings.layoutTab.boardGroupByButton.title"}),showChevron:!0,right:r.name,onClick:()=>{w.H4({collectionSettingsStore:t,item:{type:"group",groupByKey:"board_columns_by",groupsFormatKey:"board_columns"}}),C.wd({environment:this.environment,collectionContextStore:e,action:"click_board_group_by",original_view_type:void 0,property_type:r.type})},disabled:!i.canConfigureBlock}),a()(re.Z,{title:a()(f.FormattedMessage,{defaultMessage:"Color columns",id:"database.viewSettings.groupTab.colorColumns"}),on:!(0,I.h6)(this.environment,e),focused:!1,onClick:()=>{w.iN({environment:this.environment,collectionContextStore:e})},disabled:!i.canConfigureBlock,textWrapperStyle:{opacity:1}})):void 0}renderPeekModeSetting(){const{collectionContextStore:e}=this.props,t=e.permissionScopes.state,o=this.getPeekModeFormat();return a()(j.Z,{title:a()(f.FormattedMessage,{defaultMessage:"Open pages in",id:"database.viewSettings.layoutTab.peekModeTitle"}),collectionContextStore:e,openButtonPopup:"peekModeFormat"===e.settingsStore.state.openButtonPopup,selectedKey:o,popupStyle:{minWidth:190},options:se({currentViewType:this.getCurrentViewType(),theme:this.theme}),menuItemOptionsStyle:{paddingTop:8,paddingBottom:8},onClick:this.handleOpenPeekModePicker,onChange:this.handlePeekModeFormatClick,disabled:!t.canConfigureBlock})}getNewDateRange(e){const{newViewRange:t,oldCalendarEnd:o,startOfWeekSetting:n}=e;if("month"===t){const e=(0,h.IS)((0,h.kl)(o),n);return{newDateRangeStart:e,newDateRangeEnd:(0,h.V7)((0,h._)({date:e,monthsToAdd:1}),n)}}{const e=(0,h.IS)(o,n);return{newDateRangeStart:e,newDateRangeEnd:(0,h.V7)(e,n)}}}getCurrentViewType(){var e;const{collectionContextStore:t}=this.props,o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType();if(!o)throw new Error("View type was not defined.");return o}getCoverFormatKey(){return R.DL[this.getCurrentViewType()]}getCoverFormat(){const{collectionContextStore:e}=this.props,t=e.normalizedFormatStore.state,o=this.getCoverFormatKey();if(o&&t)return t[o]}getCoverSizeFormatKey(){return R.oy[this.getCurrentViewType()]}getCoverSizeFormat(){const{collectionContextStore:e}=this.props,t=e.normalizedFormatStore.state,o=this.getCoverSizeFormatKey();if(o&&t){const e=t[o];if(e)return e}return S.PZ}getPeekModeFormat(){const{collectionContextStore:e}=this.props,t=e.normalizedFormatStore.state,o=this.getCurrentViewType();return(null==t?void 0:t.collection_peek_mode)||O.Ls[o]}getCalendarViewRange(){const{collectionContextStore:e}=this.props,t=e.normalizedFormatStore.state;return(null==t?void 0:t.calendar_view_range)||"month"}getCoverAspectFormatKey(){return R._Y[this.getCurrentViewType()]}getCoverAspectFormat(){const{collectionContextStore:e}=this.props,t=e.normalizedFormatStore.state,o=this.getCoverAspectFormatKey();if(o&&t)return t[o]}}function le(){return["month","week"].map((e=>({key:e,title:V.default.formatMessage(A.Lh[e])})))}function se(e){const{currentViewType:t,theme:o}=e,n=t?O.Ls[t]:void 0;return["side_peek","center_peek","full_page"].map((e=>({key:e,title:(0,O.LQ)(e),body:s.createElement(s.Fragment,null,(0,O.RI)(e),n&&t&&e===n&&a()("div",{style:{marginTop:2,fontWeight:500,color:o.blueColor}},void 0,a()(f.FormattedMessage,{defaultMessage:"Default for {view}",id:"database.viewPropertiesMenu.peekMode.defaultForView",values:{view:(0,p.Z)(t)}}))),icon:(0,O.RO)(e)({width:16,fill:o.mediumTextColor})})))}ae.displayName="CollectionSettingsViewLayoutMenu";const ce=(0,f.injectIntl)(ae)},75544:(e,t,o)=>{o.d(t,{N:()=>ee,Z:()=>te});var n=o(10434),i=o.n(n),r=o(23174),a=o.n(r),l=o(43261),s=o.n(l),c=o(96486),d=o(67294),u=o(83355),p=o(480),m=o(81954),g=o(49085),h=o(99036),S=o(80951),y=o(39068),v=o(6695),f=o(53397),b=o(97880),C=o(82990),w=o(5366),k=o(77162),M=o(5149),x=o(87085),T=o(64434),P=o(96802),_=o(80402),A=o(12359),V=o(52821),F=o(68641),Z=o(65742),B=o(78316),E=o(33929),I=o(33665),R=o(29798),O=o(73657),K=o(21269),L=o(13005),D=o(42917),W=o(54119),H=o(52275),z=o(79131),Q=o(5145),N=o(73063),G=o(68894),U=o(32163),q=o(89728),j=o(72495),Y=o(86825),$=o(66957);const J=(0,w.defineMessages)({inputPlaceholder:{defaultMessage:"Search for a property…",id:"database.viewSettings.propertiesTab.inputPlaceholder"},toggleFrozenColumnsAriaLabel:{defaultMessage:"Toggle frozen columns",id:"database.viewSettings.propertiesTab.toggleFrozenColumnsAriaLabel"},togglePropertyVisibilityAriaLabel:{defaultMessage:"Toggle property visibility",id:"database.viewSettings.propertiesTab.togglePropertyVisibilityAriaLabel"}});class X extends u.Z{constructor(){super(...arguments),this.storeTypes={inputStore:g.default.createClass(""),menuListStore:R.Z},this.handleHideAllClick=e=>{const{collectionContextStore:t}=this.props;k.wd({environment:this.environment,collectionContextStore:t,action:"click_hide_all_properties"}),this.setAllPropertiesVisibility({formatKey:e,visibility:!1})},this.handleShowAllClick=e=>{const{collectionContextStore:t}=this.props;k.wd({environment:this.environment,collectionContextStore:t,action:"click_show_all_properties"}),this.setAllPropertiesVisibility({formatKey:e,visibility:!0})},this.handlePropertyReorder=e=>{const{formatKey:t,newPropertyKeys:o}=e,{collectionContextStore:n}=this.props,i=n.collectionViewStore();if(!i)return;const r=n.normalizedFormatStore.state[t]||[],a=o.indexOf("group-header-hidden-property"),l=[...c.compact(o.filter((e=>!e.startsWith("group-header-"))).map(((e,t)=>{const o=r.find((t=>t.property===e));if(o)return a>=0?{...o,visible:Boolean(t<a)}:o}))),...r.filter((e=>!o.includes(e.property)))];A.createAndCommit({userAction:"CollectionSettingsViewProperties.handlePropertyReorder",environment:this.environment,perform:e=>{P.FH({stores:[i],update:{[t]:l},transaction:e})}}),k.wd({environment:this.environment,collectionContextStore:n,action:"reorder_properties",original_view_type:i.getType()}),this.stores.menuListStore.reset()},this.handleTogglePropertyVisibility=e=>{var t;const{formatKey:o,propertyFormat:n,index:i}=e,{collectionContextStore:r}=this.props,a=r.collectionViewStore();if(!a)return;const l=r.normalizedFormatStore.state,s=(l[o]||[]).filter((e=>e.property!==n.property)),c=s.filter((e=>e.visible)),d=s.filter((e=>!e.visible)),u={...n,visible:!n.visible},p=[...c,u,...d],m={...l,[o]:p};A.createAndCommit({userAction:"CollectionSettingsViewProperties.handleTogglePropertyVisibility",environment:this.environment,perform:e=>{T.iG({collectionViewStore:a,update:{format:m},transaction:e}),_.oz({environment:this.environment,collectionContextStore:r,currentIndex:i,entrypoint:"CollectionSettingsViewProperties",transaction:e,propertyAction:n.visible?"hide":"show"})}}),k.wd({environment:this.environment,collectionContextStore:r,action:"toggle_property_visibility",original_view_type:a.getType(),property_type:null===(t=a.getCollectionStore())||void 0===t||null===(t=t.getSchema()[u.property])||void 0===t?void 0:t.type}),this.clearInput()},this.handlePropertyClick=e=>{var t,o,n;const{collectionSettingsStore:i,collectionContextStore:r}=this.props,a=(null===(t=r.collectionStore())||void 0===t?void 0:t.getSchema())||r.normalizedSchemaStore.state||{},{formatKey:l,propertyFormat:s}=e;k.wd({environment:this.environment,collectionContextStore:r,action:"click_property",original_view_type:null==r||null===(o=r.collectionViewStore())||void 0===o?void 0:o.getType(),property_type:null===(n=a[s.property])||void 0===n?void 0:n.type}),M.H4({collectionSettingsStore:i,item:{type:"property",formatKey:l,property:s.property}})},this.handleViewDeletedPropertiesClick=()=>{const{collectionSettingsStore:e,collectionContextStore:t,timelineViewTab:o}=this.props;t.collectionStore()&&(k.wd({environment:this.environment,collectionContextStore:t,action:"click_deleted_properties"}),M.H4({collectionSettingsStore:e,item:{type:"deletedProperties",timelineViewTab:o}}))},this.handleNewPropertyClick=()=>{const{collectionContextStore:e}=this.props,t=e.collectionStore();t&&(k.wd({environment:this.environment,collectionContextStore:e,action:"click_new_property"}),M.wl({collectionSettingsStore:e.settingsStore,item:{type:"propertyType",propertyTypes:(0,V.TP)({isSyncedCollection:t.isSyncedCollection(),collectionContextStore:e,environment:this.environment}),onAccept:(t,o)=>{x.PW({environment:this.environment,propertyType:t,propertyName:o,collectionContextStore:e,from:"view_settings"})}}}))},this.handleTabChange=e=>{const{collectionSettingsStore:t,collectionContextStore:o}=this.props;k.wd({environment:this.environment,collectionContextStore:o,action:0===e?"click_properties_tab_timeline":"click_properties_tab_table"}),M.FK({collectionSettingsStore:t,item:{type:"properties",timelineViewTab:0===e?"timeline":"table"}}),this.clearInput()},this.handleShowTableClick=()=>{this.clearInput()},this.isFreezeColumnsEnabled=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore();return(0,B.eL)(this.environment.device.isMobile,null==t?void 0:t.getType())}))}renderComponent(){const{collectionContextStore:e,timelineViewTab:t}=this.props,{device:o}=this.environment,{inputStore:n,menuListStore:r}=this.stores,l=n.state,s=(0,F.WY)({collectionContextStore:e}),c=(0,F.jI)({timelineViewTab:t,collectionContextStore:e}),u=(0,Z.d$)({environment:this.environment,isFullScreen:e.isFullScreen.state,isRootChild:e.isRootChild.state});return d.createElement(L.ZP,i()({},this.props,{title:a()(w.FormattedMessage,{defaultMessage:"Properties",id:"database.viewSettings.propertiesTab.title"}),header:a()(j.Z,{},void 0,a()(G.ZP,{focusInitial:!o.isMobile,value:l,showClearButton:!0,onChange:e=>{n.setState(e.target.value),r.setState({...r.state,focus:{section:0,indexLocal:0,indexGlobal:0}})},placeholder:E.default.formatMessage(J.inputPlaceholder)})),footer:this.renderFooter()}),"timeline"===s&&u&&this.renderTimelineControls(),c&&this.renderPropertyFormatList(c),a()(j.Z,{},void 0,this.renderDeletedProperties()))}renderTimelineControls(){const{timelineViewTab:e,collectionContextStore:t}=this.props,o="timeline"===e?0:1;return d.createElement(d.Fragment,null,a()($.Z,{tabs:[a()(w.FormattedMessage,{defaultMessage:"Timeline",id:"database.viewSettings.propertiesTab.timelineProperties"},"database.viewSettings.propertiesTab.timelineProperties"),a()(w.FormattedMessage,{defaultMessage:"Table",id:"database.viewSettings.propertiesTab.tableProperties"},"database.viewSettings.propertiesTab.tableProperties")],selectedIndex:o,onChange:this.handleTabChange}),"table"===e&&a()(j.Z,{},void 0,a()(ee,{collectionContextStore:t,onClick:this.handleShowTableClick})))}renderPropertyFormatList(e){const{collectionContextStore:t}=this.props,o=t.permissionScopes.state,n=t.normalizedFormatStore.state,r=t.normalizedSchemaStore.state,{inputStore:l}=this.stores,u=l.state;let p=n[e]||[];if(u){let e=p.map((e=>{const t=(0,S.Qm)({schema:r,property:e.property});return null==t?void 0:t.name}));e=s().filter(u,e).map((e=>{let{original:t}=e;return t})),p=p.filter((t=>{const o=r[t.property];return o&&o.name&&e.includes(o.name)}))}const m=p.filter((e=>Boolean(e.visible))),g=p.filter((e=>!Boolean(e.visible))),h="timeline_table_properties"===e?"table":(0,F.WY)({collectionContextStore:t});return d.createElement(d.Fragment,null,0===p.length&&a()(j.Z,{},void 0,a()(O.Z,{caption:a()(w.FormattedMessage,{defaultMessage:"No results",id:"database.viewSettings.propertiesTab.noResults"})})),p.length>0&&a()(U.Z,{type:U.i.Vertical,store:this.stores.menuListStore,initialFocus:void 0,sections:c.compact([m.length>0&&{key:"visible_and_hidden_properties",render:t=>d.createElement(j.Z,i()({},t,{noTextOverflow:!0,isTitleUppercase:!1,title:this.renderShownInViewMessage(h),desktopTitleStyle:{height:19},right:!u&&o.canConfigureBlock&&a()(q.Z,{isSmall:!0,shouldShrink:!0,isBlue:!0,style:{fontSize:12,height:void 0,paddingTop:2,paddingBottom:2},onClick:()=>this.handleHideAllClick(e)},void 0,a()(w.FormattedMessage,{id:"database.viewSettings.propertiesTab.hideAllProperties",defaultMessage:"Hide all"})),children:this.renderPropertySortList({formatKey:e,visibleProperties:m,hiddenProperties:g,children:t.children})})),items:c.compact([...this.renderPropertySortListItems({formatKey:e,properties:m}),g.length>0&&{key:"group-header-hidden-property",render:t=>this.renderHiddenPropertySectionHeader({props:t,formatKey:e,children:d.createElement(d.Fragment,null)}),action:()=>{}},...this.renderPropertySortListItems({formatKey:e,properties:g})])},0===m.length&&g.length>0&&{key:"hidden_properties",render:t=>this.renderHiddenPropertySectionHeader({props:t,formatKey:e,children:this.renderPropertySortList({formatKey:e,visibleProperties:m,hiddenProperties:g,children:t.children})}),items:this.renderPropertySortListItems({formatKey:e,properties:g})}])}))}renderHiddenPropertySectionHeader(e){const{props:t,formatKey:o,children:n}=e,{collectionContextStore:r}=this.props,l=r.permissionScopes.state,{inputStore:s}=this.stores,c=s.state,u="timeline_table_properties"===o?"table":(0,F.WY)({collectionContextStore:r});return d.createElement(j.Z,i()({},t,{noTextOverflow:!0,isTitleUppercase:!1,title:this.renderHiddenInViewMessage(u),desktopTitleStyle:{height:19},right:!c&&l.canConfigureBlock&&a()(q.Z,{isSmall:!0,shouldShrink:!0,isBlue:!0,style:{fontSize:12,height:void 0,paddingTop:2,paddingBottom:2},onClick:()=>this.handleShowAllClick(o)},void 0,a()(w.FormattedMessage,{id:"database.viewSettings.propertiesTab.showAllProperties",defaultMessage:"Show all"})),style:{width:"100%",paddingBottom:0},children:n}))}renderFooter(){const{collectionContextStore:e,timelineViewTab:t}=this.props,o=e.permissionScopes.state,n="timeline"===(0,F.WY)({collectionContextStore:e})&&"table"===t&&!(0,F.vw)({collectionContextStore:e}),i=o.canConfigureCollection&&!n;return a()(j.Z,{topBorder:!0},void 0,i&&a()(D.Z,{icon:f.Z.plus,title:a()(w.FormattedMessage,{id:"database.viewSettings.propertiesTab.newProperty",defaultMessage:"New property"}),isGray:!0,onClick:this.handleNewPropertyClick}),a()(K.Z,{href:(0,I.UY)("guides.databaseProperties"),title:a()(w.FormattedMessage,{defaultMessage:"Learn about properties",id:"database.viewSettings.propertiesTab.learnMoreButton.title"}),analyticsFrom:"view_settings_properties"}))}renderPropertySortList(e){const{formatKey:t,visibleProperties:o,hiddenProperties:n,children:i}=e,r=c.compact([...o.map((e=>e.property)),o.length>0&&n.length>0&&{key:"group-header-hidden-property",draggable:!1},...n.map((e=>e.property))]);return this.canReorder()?a()(z.ZP,{direction:"vertical",keys:r,renderKey:(e,t)=>i[t],onDrop:(e,o)=>{this.handlePropertyReorder({formatKey:t,newPropertyKeys:e})}}):i}renderPropertySortListItems(e){const{formatKey:t,properties:o}=e;return c.compact(o.map(((e,o)=>this.renderPropertySortListItem({formatKey:t,propertyFormat:e,index:o}))))}renderPropertySortListItem(e){var t;const{formatKey:o,propertyFormat:n,index:r}=e,{collectionContextStore:l}=this.props,s=null===(t=l.collectionStore())||void 0===t?void 0:t.isSyncedCollection(),c=l.permissionScopes.state,u=!n.visible,p=l.normalizedSchemaStore.state,m=(0,S.Qm)({schema:p,property:n.property}),g="title"!==n.property||this.primaryPropertyFormatAllowsHidingTitle(o);let v=!c.canConfigureCollection||s&&((0,S.wl)(n.property)||(0,h.HF)(n.property));if("collectionTypedView"===l.contextType&&c.canConfigureBlock&&(v=!1),!m)return;const{theme:b}=this;return{key:n.property,render:e=>d.createElement(H.Z,i()({},e,{title:a()("div",{style:{display:"flex",alignItems:"center"}},void 0,this.canReorder()&&a()(Q.ZP,{iconSize:12,style:{marginRight:8}}),a()(y.ZP,{type:m.type,icon:m.icon,size:16,theme:b,style:{fill:b.regularIconColor}}),a()("span",{style:{marginLeft:8,...C.Z.textOverflowStyle}},void 0,m.name),(0,h.q3)(m)&&a()(W.Z,{})),right:a()("div",{style:{display:"flex",alignItems:"center"}},void 0,a()(N.Z,{icon:u?f.Z.eyeHide:f.Z.eye,iconStyle:{width:16,height:16},isDarkIconColor:!u,onClick:()=>{this.handleTogglePropertyVisibility({formatKey:o,propertyFormat:n,index:r})},ariaLabel:this.props.intl.formatMessage(J.togglePropertyVisibilityAriaLabel),disabled:!g||!c.canConfigureBlock}),!v&&f.Z.chevronRight({width:12,fill:b.lightTextColor,marginLeft:5}))})),action:()=>{v||this.handlePropertyClick({formatKey:o,propertyFormat:n})}}}renderShownInViewMessage(e){return"table"===e?a()(w.FormattedMessage,{defaultMessage:"Shown in table",id:"database.viewSettings.propertiesTab.shownInTableTitle"}):"timeline"===e?a()(w.FormattedMessage,{defaultMessage:"Shown in timeline",id:"database.viewSettings.propertiesTab.shownInTimelineTitle"}):"board"===e?a()(w.FormattedMessage,{defaultMessage:"Shown in board",id:"database.viewSettings.propertiesTab.shownInBoardTitle"}):"list"===e?a()(w.FormattedMessage,{defaultMessage:"Shown in list",id:"database.viewSettings.propertiesTab.shownInListTitle"}):"gallery"===e?a()(w.FormattedMessage,{defaultMessage:"Shown in gallery",id:"database.viewSettings.propertiesTab.shownInGalleryTitle"}):"calendar"===e?a()(w.FormattedMessage,{defaultMessage:"Shown in calendar",id:"database.viewSettings.propertiesTab.shownInCalendarTitle"}):"page"===e?null:void(0,b.t1)(e)}renderHiddenInViewMessage(e){return"table"===e?a()(w.FormattedMessage,{defaultMessage:"Hidden in table",id:"database.viewSettings.propertiesTab.hiddenInTableTitle"}):"timeline"===e?a()(w.FormattedMessage,{defaultMessage:"Hidden in timeline",id:"database.viewSettings.propertiesTab.hiddenInTimelineTitle"}):"board"===e?a()(w.FormattedMessage,{defaultMessage:"Hidden in board",id:"database.viewSettings.propertiesTab.hiddenInBoardTitle"}):"list"===e?a()(w.FormattedMessage,{defaultMessage:"Hidden in list",id:"database.viewSettings.propertiesTab.hiddenInListTitle"}):"gallery"===e?a()(w.FormattedMessage,{defaultMessage:"Hidden in gallery",id:"database.viewSettings.propertiesTab.hiddenInGalleryTitle"}):"calendar"===e?a()(w.FormattedMessage,{defaultMessage:"Hidden in calendar",id:"database.viewSettings.propertiesTab.hiddenInCalendarTitle"}):"page"===e?null:void(0,b.t1)(e)}renderDeletedProperties(){const{collectionContextStore:e}=this.props,t=e.normalizedDeletedSchemaStore.state,o=Object.keys(t).length;if(e.permissionScopes.state.canConfigureCollection&&o>0)return a()(D.Z,{icon:f.Z.trash,title:a()(w.FormattedMessage,{id:"database.viewSettings.propertiesTab.deletedProperties",defaultMessage:"Deleted properties"}),isGray:!0,onClick:this.handleViewDeletedPropertiesClick,right:o,showChevron:!0})}canReorder(){const{inputStore:e}=this.stores,t=e.state,{collectionContextStore:o}=this.props,n=o.permissionScopes.state;return!this.environment.device.isMobile&&n.canConfigureBlock&&!t}setAllPropertiesVisibility(e){const{formatKey:t,visibility:o}=e,{collectionContextStore:n}=this.props,i=n.collectionViewStore();if(!i)return;const r=n.normalizedFormatStore.state[t]||[],a=r.filter((e=>Boolean(e.visible))),l=r.filter((e=>!Boolean(e.visible))),s=[...a.map((e=>({...e,visible:o}))),...l.map((e=>({...e,visible:o})))];A.createAndCommit({userAction:"CollectionSettingsViewProperties.setAllPropertiesVisibility",environment:this.environment,perform:e=>{P.FH({stores:[i],update:{[t]:s},transaction:e})}})}primaryPropertyFormatAllowsHidingTitle(e){const{collectionContextStore:t}=this.props,o=t.normalizedFormatStore.state,n=(0,F.WY)({collectionContextStore:t});return"board"===n?(0,v.Lw)(o.board_cover):"gallery"===n?(0,v.Lw)(o.gallery_cover):"timeline"===n&&("timeline_table_properties"===e||(0,v.vP)(Boolean(o.timeline_show_table),o.timeline_table_properties||[]))}clearInput(){this.stores.inputStore.reset()}}function ee(e){window.__c={n:"TimelineShowTableSwitcher"};const{collectionContextStore:t,onClick:o}=e,n=(0,p.O7)(),i=(0,m.Kw)(t.normalizedFormatStore),r=Boolean(i.timeline_show_table),l=(0,m.Kw)(t.permissionScopes);return a()(Y.Z,{title:a()(w.FormattedMessage,{defaultMessage:"Show table",id:"database.viewSettings.propertiesTab.showTable"}),on:r,focused:!1,onClick:()=>{const e=t.collectionViewStore();e&&(A.createAndCommit({userAction:"CollectionSettingsViewProperties.TimelineShowTableSwitcher",environment:n,perform:t=>{P.FH({stores:[e],update:{timeline_show_table:!r,timeline_table_properties:[{property:"name",visible:!0}]},transaction:t})}}),null==o||o(),k.wd({environment:n,collectionContextStore:t,action:"timeline_toggle_show_table"}))},disabled:!l.canConfigureBlock,textWrapperStyle:{opacity:1}})}X.displayName="CollectionSettingsViewProperties";const te=(0,w.injectIntl)(X)},41418:(e,t,o)=>{o.d(t,{Z:()=>K});var n=o(10434),i=o.n(n),r=o(23174),a=o.n(r),l=o(96486),s=o(67294),c=o(83355),d=o(8848),u=o(53397),p=o(5366),m=o(50906),g=o(12534),h=o(33929),S=o(87279),y=o(31339),v=o(42917),f=o(61053),b=o(60246),C=o(52275),w=o(31945),k=o(14871),M=o(77498),x=o(62045),T=o(50542);class P extends c.Z{constructor(){super(...arguments),this.handleAccept=e=>{const{sort:t,collectionViewType:o}=this.props,n={...t,property:e};this.props.onChange(this.props.index,n),o&&m.wds(this.environment,{view_type:o,action:"set_sort_property"})}}renderComponent(){const{schema:e,sort:t}=this.props,o=e[t.property];if(o)return a()(s.Fragment,{},void 0,this.renderPropertyDropdown(o),this.renderSortDirection())}renderPropertyDropdown(e){const{device:t}=this.environment,{disabled:o}=this.props;return a()(w.ZP,{popupType:t.isMobile?w.Z4.SlideUp:w.Z4.Popup,renderOrigin:t=>s.createElement(T.Z,i()({},t,{propertySchema:e,disabled:o,textWrapperStyle:{opacity:1}})),render:e=>a()(M.Z,{isRelationProperty:!1,schema:this.props.schema,onAccept:this.handleAccept,onClose:e.close}),disabled:o})}renderSortDirection(){const{sort:e,index:t,onChange:o,collectionViewType:n,intl:r,disabled:a}=this.props,l=e.direction,c={menuTitle:r.formatMessage({id:"collectionSortMenuRow.sortDirectionSelectMenu.title",defaultMessage:"Sort"}),items:[...b.C6],getKey:e=>e,selectedItem:l,disabled:a,onSelect:i=>{const r={...e,direction:i};o(t,r),n&&m.wds(this.environment,{view_type:n,action:"set_sort_direction"})},renderItem:e=>s.createElement(C.Z,i()({title:P.sortDirectionMessage[e.value]},e)),renderOrigin:e=>s.createElement(x.Z,i()({},e,{placeholder:r.formatMessage({id:"collectionSortMenuRow.sortDirectionSelectMenu.placeholder",defaultMessage:"Empty"}),title:l&&P.sortDirectionMessage[l],disabled:a,desktopStyle:{opacity:1}}))};return s.createElement(k.Z,i()({key:"direction"},c,{mobileActionSheet:!0}))}}P.displayName="CollectionSortMenuRow",P.sortDirectionMessage={ascending:a()(p.FormattedMessage,{defaultMessage:"Ascending",id:"collectionSortMenuRow.sortDirectionSelectMenu.ascending"}),descending:a()(p.FormattedMessage,{defaultMessage:"Descending",id:"collectionSortMenuRow.sortDirectionSelectMenu.descending"})};const _=(0,p.injectIntl)(P);var A=o(79131),V=o(73063),F=o(78140),Z=o(28992),B=o(44532),E=o(72495),I=o(58032);const R=(0,p.defineMessages)({inputPlaceholder:{defaultMessage:"Search for a property…",id:"database.viewSettings.collectionSortMenu.inputPlaceholder"}});class O extends c.Z{constructor(){super(...arguments),this.handleDraggableListDrop=e=>{const{onChange:t}=this.props,{sorts:o}=this.props;t(l.compact(e.map((e=>o[parseInt(e)]))));const n=this.getCurrentViewType();n&&m.wds(this.environment,{action:"reorder_sorts",view_type:n})},this.handleChangeSort=(e,t)=>{const{onChange:o}=this.props,{sorts:n}=this.props;o(n.map(((o,n)=>n===e?t:o)));const i=this.getCurrentViewType();i&&m.wds(this.environment,{action:"update_sort",view_type:i})},this.handleDeleteSort=e=>{const{onChange:t}=this.props,{sorts:o}=this.props;t(o.filter(((t,o)=>o!==e)));const n=this.getCurrentViewType();n&&m.wds(this.environment,{action:"delete_sort",view_type:n})},this.handleDeleteAllSortsClick=()=>{const{onChange:e,onDeleteAll:t}=this.props;e([]),null==t||t();const o=this.getCurrentViewType();o&&m.wds(this.environment,{action:"delete_all_sorts",view_type:o})},this.handleNewPropertyAccept=e=>{var t;if(!e)return;const{schema:o,sorts:n,onChange:i}=this.props,r=null===(t=o[e])||void 0===t?void 0:t.type;i([...n,{property:e,direction:"ascending"}]);const a=this.getCurrentViewType();a&&m.wds(this.environment,{action:"create_sort_accept",view_type:a,property_type:r})}}renderComponent(){const{device:e}=this.environment,{schema:t,format:o,sorts:n,showDeleteAll:r}=this.props,l=!!Object.keys(t).some((e=>!n.find((t=>t.property===e)))),c=r&&n.length>0;return s.createElement(s.Fragment,null,this.renderSorts(),(l||c)&&a()(E.Z,{},void 0,l&&a()(w.ZP,{popupType:e.isMobile?B.kQ.SlideUp:B.kQ.Popup,renderOrigin:e=>s.createElement(v.Z,i()({icon:u.Z.plus,isGray:!0,title:a()(p.FormattedMessage,{id:"database.viewSettings.sortTab.newSort",defaultMessage:"Add sort"})},e)),render:i=>{let r;return r=e.isMobile?{menuType:S.og.ActionSheet}:{menuType:S.og.Popup,width:280,height:287},s.createElement(F.Z,r,a()(f.Z,{schema:t,format:o,getProperties:()=>Object.keys(t).filter((e=>!n.find((t=>t.property===e)))),onAccept:e=>{this.handleNewPropertyAccept(e),i.close()},inputPlaceholder:h.default.formatMessage(R.inputPlaceholder)}))}}),c&&a()(v.Z,{icon:u.Z.trash,isRed:!0,isGray:!0,title:a()(p.FormattedMessage,{id:"database.viewSettings.sortTab.deleteAllSorts",defaultMessage:"Delete sort"}),onClick:this.handleDeleteAllSortsClick})))}renderSorts(){const{device:e}=this.environment,{sorts:t}=this.props;if(e.isMobile)return t.map(((e,t)=>this.renderSort(e,t)));{const e=t.map(((e,t)=>t.toString()));return e.length>0&&a()("div",{style:{marginBottom:2}},void 0,a()(A.ZP,{direction:"vertical",keys:e,renderKey:e=>this.renderSort(t[parseInt(e)],parseInt(e)),onDrop:this.handleDraggableListDrop}))}}renderSort(e,t){const{device:o}=this.environment,{schema:n,disabled:i,parentStore:r}=this.props;return o.isMobile?a()(E.Z,{},t,a()(_,{index:t,sort:e,schema:n,parentStore:r,collectionViewType:this.getCurrentViewType(),onChange:this.handleChangeSort}),!i&&this.renderMobileDeleteButtonMenuItem(t)):a()(E.Z,{extraTopPadding:!0,desktopStyle:{padding:"8px 0 0 8px",width:"100%"}},t,a()(Z.Z,{showDragHandle:!o.isMobile&&!i,title:a()("div",{style:{display:"flex",alignItems:"center",flexGrow:1,whiteSpace:"nowrap"},onMouseDown:g.$0},void 0,a()(_,{index:t,sort:e,schema:n,parentStore:r,collectionViewType:this.getCurrentViewType(),onChange:this.handleChangeSort})),right:!i&&this.renderDesktopDeleteButton(t)}))}renderMobileDeleteButtonMenuItem(e){return a()(C.Z,{title:a()("div",{style:{color:d.ZP.red}},void 0,a()(p.FormattedMessage,{defaultMessage:"Delete",id:"database.viewSettings.sortTab.mobileDeleteButtonTitle"})),icon:a()(y.Z,{icon:u.Z.trash,styles:{color:d.ZP.red}}),onClick:()=>this.handleDeleteSort(e),focused:!1})}renderDesktopDeleteButton(e){return a()(I.Z,{render:t=>s.createElement(V.Z,i()({icon:u.Z.collectionDeleteRule,onClick:()=>this.handleDeleteSort(e),style:{marginRight:-6}},t)),renderTooltip:()=>a()(p.FormattedMessage,{defaultMessage:"Remove sort rule",id:"database.sortMenu.deleteButtonTooltip"})})}getCurrentViewType(){const{collectionViewStore:e}=this.props;return null==e?void 0:e.getType()}}O.displayName="CollectionSortMenu";const K=(0,p.injectIntl)(O)},87494:(e,t,o)=>{o.d(t,{vV:()=>de,QF:()=>se,li:()=>Se});var n=o(10434),i=o.n(n),r=o(23174),a=o.n(r),l=o(96486),s=o(67294),c=o(480),d=o(81954),u=o(24405),p=o(3865),m=o(48777),g=o(23290),h=o(76218),S=o(5366),y=o(6287),v=o(97880),f=o(9953),b=o(12359),C=o(30950),w=o(24457),k=o(29502),M=o(28267),x=o(52275),T=o(31945),P=o(78140),_=o(32163),A=o(72495),V=o(61766),F=o(38752),Z=o(44532),B=o(72865),E=o(68626),I=o(87279),R=o(77907),O=o(40721),K=o(28405);const L=(0,R.withDependency)(R.deps.formulas,((e,t)=>s.createElement(D,i()({},t,{formulas:e}))));function D(e){window.__c={n:"FormulaInputMenu"};const{value:t,onChange:o,onClose:n,disabled:i,contextStore:r,formulas:l}=e,u=(0,c.Fy)(),p=(0,s.useCallback)((()=>{o({type:"simple",value:null==t?void 0:t.value}),n()}),[o,n,null==t?void 0:t.value]),m=(0,s.useCallback)((e=>{void 0!==e&&e[0][0].length?o({type:"formula",value:e}):o(void 0),n()}),[o,n]),g=(0,d.VK)((()=>r.context.parentRecordStore.getSpaceId()),[r.context.parentRecordStore]),h=(0,d.Kw)(r.compilationResultStore),S=(0,s.useMemo)((()=>l.createFormulaDataRequestHandler(r.context.parentRecordStore.getRecordValue,r.context.parentRecordStore.loadRecordValue)),[r.context.parentRecordStore.getRecordValue,r.context.parentRecordStore.loadRecordValue,l]),y=(0,d.VK)((()=>{if(E.x.isFail(h))return;return{valueTypes:h.value.valueTypes,handleDataRequest:S}}),[h,S],{useDeepEqual:!0});let v;return v=u.isMobile?{menuType:I.og.Modal,right:a()(O.DoneMenuText,{}),onClickRight:parent.close}:{menuType:I.og.Popup,maxHeight:"50vh",width:600,height:320,disableHeaderBorder:!0},g&&y?s.createElement(P.Z,v,a()(K.Z,{formulas:l,initialCode:null==t?void 0:t.value,typecheckContext:y,handleClose:m,handleBack:p,parentSpaceId:g,disabled:i,focus:!0,evaluationErrors:[],getRecordModel:r.context.parentRecordStore.getRecordModel})):null}var W=o(70203),H=o(17809),z=o(65187);function Q(e){window.__c={n:"NumberInput"};const{value:t,disabled:o,buttonPopupStore:n,onChange:i}=e,r=(0,u.yK)((e=>({wrap:{flexGrow:1,flexShrink:1,boxShadow:e.inputBoxShadow,borderRadius:3,padding:4}})),[]),l=(0,s.useCallback)((e=>{"="===(0,W.Q)(e)&&(0,H.formulaButtonsEnabled)()?(i({type:"formula",value:void 0}),n.setState({open:!0})):i({type:"simple",value:e})}),[i,n]),{store:c}=(0,H.useMockTextStore)({initialValue:null==t?void 0:t.value,onChange:l});return a()("div",{style:r.wrap},void 0,a()(z.Z,{disabled:o,store:c,pasteBehavior:"inline",disableSlashCommands:!0,disableEmojiCommands:!0,disableMentions:!0,disableDateMentions:!0,disableDateReminderMentions:!0,disableEmbedMenu:!0,disableMobileActionBar:!0,disableComment:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableStyleAnnotations:!0,disableEquationInteraction:!0}))}var N=o(55950),G=o(18466),U=o(13991),q=o(53397),j=o(82990),Y=o(14976),$=o(17731),J=o(75311),X=o(30387);function ee(e){window.__c={n:"ValuePickerValue"};const{value:t,type:o,currentSimpleFormulaValueTokens:n,contextStore:i,context:r}=e,{collectionStore:l,property:c}=r,p=(0,u.yK)((()=>({tokenWrap:{display:"flex",alignItems:"center",flexGrow:1,overflow:"hidden",marginTop:6}})),[]),m=(0,J.M)(l,c),g=(0,d.VK)((()=>(0,H.formulaButtonsEnabled)()),[]);if("formula"===(null==t?void 0:t.type)&&t.value&&g)return s.createElement(oe,e);if("text"===o.type||"number"===o.type)return null;if("date"===o.type||"select"===o.type||"checkbox"===o.type){const e=n[0];return void 0===e?a()(te,{}):a()("div",{style:p.tokenWrap},void 0,a()(N.K,{token:e,contextStore:i,disabled:!0,currentSimpleFormulaValueTokens:n,context:r}))}if("person_array"===o.type||"block_array"===o.type||"select_array"===o.type)return 0===n.length?a()(te,{}):a()("div",{style:p.tokenWrap},void 0,m(n,"first").map(((e,t)=>a()(N.K,{token:e,contextStore:i,disabled:!0,currentSimpleFormulaValueTokens:n,context:r},t))));(0,v.t1)(o)}function te(){window.__c={n:"ValueEmptyPlaceholder"};const e=(0,u.yK)((e=>({placeholderText:{color:e.lightTextColor}})),[]);return a()("div",{style:e.placeholderText},void 0,s.createElement(S.FormattedMessage,X.s.personSelect))}function oe(e){window.__c={n:"MinimalFormulaText"};const{value:t,contextStore:o}=e,n=(0,c.O7)(),i=(0,u.Fg)(),r=(0,u.yK)((e=>({wrap:{display:"flex",alignItems:"center",pointerEvents:"none",fontFamily:j.Z.getCompositeFontFamily(U.SP).githubMono,fontSize:12,flexGrow:1,...j.Z.textOverflowStyle},icon:{width:14,fill:e.mediumIconColor,marginRight:6}})),[]),l=(0,$.kw)(),p=(0,d.VK)((()=>n.KatexStore.getKatex()),[n]),m=(0,d.VK)((()=>o.context.parentRecordStore.getSpaceId()),[o.context.parentRecordStore]),g=(0,d.Kw)(o.compilationResultStore),h=E.x.isSuccess(g)?g.value.valueTypes:void 0,S=(0,s.useMemo)((()=>G.Z.withListenerIgnored((()=>(0,Y.IY)({environment:n,textValue:null!=t&&t.value&&m?{value:t.value,spaceId:m}:void 0,parentStore:o.context.parentRecordStore,disableHover:!1,disableStyleAnnotations:!1,disableDateStyleAnnotations:!1,disabled:!0,theme:i,emojiType:l,katex:p,parentBlockId:void 0,renderedPageBlockId:void 0,formulaValueTypes:h||[]})))),[t,m,n,o.context.parentRecordStore,l,p,i,h]);return a()("div",{style:r.wrap},void 0,q.Z.typesFormula(r.icon),S)}function ne(e){window.__c={n:"SimpleFormulaValuePicker"};const{type:t,value:o,disabled:n}=e,r=(0,c.Fy)(),l=!o||"simple"===o.type,p=(0,d.VK)((()=>(0,h.A6)(null==o?void 0:o.value)),[o]),m=(0,u.yK)((e=>({button:{flexGrow:1,flexShrink:1,boxShadow:e.inputBoxShadow}})),[]),g=(0,d.qz)(void 0,V.Z);return"number"===t.type&&l?s.createElement(Q,i()({},e,{buttonPopupStore:g})):"text"===t.type?s.createElement(B.D,e):a()(T.ZP,{popupType:r.isMobile?Z.kQ.SlideUp:Z.kQ.Popup,alignmentToOrigin:T.vR.End,placementToOrigin:T.pO.Bottom,originGap:0,buttonPopupStore:g,disabled:n,renderOrigin:t=>s.createElement(F.S,i()({disabled:n,variant:"gray"},t,{style:m.button}),s.createElement(ee,i()({},e,{currentSimpleFormulaValueTokens:p}))),render:t=>l?s.createElement(N.a,i()({},e,{onClose:t.close,currentSimpleFormulaValueTokens:p})):s.createElement(L,i()({},e,{onClose:t.close}))})}var ie=o(39068),re=o(61053);function ae(e){window.__c={n:"AutomationPropertyPicker"};const{availablePropertyIds:t,currentValue:o,collectionStore:n,onChange:r,onRemove:l,disabled:p,alreadyHaveProperties:m}=e,g=(0,c.O7)(),h=(0,u.Fg)(),{device:y}=g,v=(0,d.VK)((()=>n.getSchema()??{}),[n]),f=(0,d.VK)((()=>n.getFormat()??{}),[n]),b=(0,d.VK)((()=>o?n.getSchema()[o]:void 0),[o,n]),C=(0,u.yK)((e=>({propertyIcon:{fill:e.lightTextColor,height:"auto",marginRight:4,width:16}})),[]),M=(0,s.useCallback)((()=>t),[t]),x=(0,k.d)();return a()(T.ZP,{popupType:x,alignmentToOrigin:T.vR.End,placementToOrigin:T.pO.Bottom,originGap:0,disabled:p,renderOrigin:e=>s.createElement(F.S,i()({},e,{disabled:p,icon:b?e=>a()(ie.ZP,{icon:void 0,type:b.type,size:16,theme:h,style:{...e,...C.propertyIcon}}):void 0,variant:m||b?b?"default":"gray":"blue"}),b?s.createElement(s.Fragment,null,a()("div",{style:{fontWeight:j.Z.fontWeight.medium,...j.Z.textOverflowStyle}},void 0,b.name)):a()(S.FormattedMessage,m?{id:"automations.propertyPicker.buttonPlaceholderAlreadyHaveProperties",defaultMessage:"Edit another property"}:{id:"automations.propertyPicker.buttonPlaceholder",defaultMessage:"Edit a property"})),render:e=>{const t=(0,w.U)({device:y,width:280,paddingTop:4});return s.createElement(P.Z,t,a()(re.Z,{schema:v,format:f,showRemoveOption:Boolean(l),currentProperty:o,getProperties:M,onAccept:t=>{t&&t!==o?r(t):void 0===t&&(null==l||l(o)),e.close()}}))}})}const le=(0,S.defineMessages)({replaceActionLabel:{id:"automations.AutomationActionSetPropertiesSection.replaceAction.label",defaultMessage:"Replace with"},appendActionLabel:{id:"automations.AutomationActionSetPropertiesSection.appendAction.label",defaultMessage:"Add"},removeActionLabel:{id:"automations.AutomationActionSetPropertiesSection.removeAction.label",defaultMessage:"Remove"},titlePlaceholder:{id:"automations.AutomationActionSetPropertiesSection.titlePlaceholder",defaultMessage:"Untitled"}});function se(e){window.__c={n:"ButtonAutomationActionSetPropertiesSection"};const{contextStore:t,actionStore:o,collectionStore:n,disabled:i,showSetPropertyActions:r}=e,l=(0,c.O7)(),u=(0,d.VK)((()=>o.id),[o.id]),p=(0,d.VK)((()=>{var e;return(null===(e=o.getConfig())||void 0===e?void 0:e.values)??{}}),[o]),m=(0,d.VK)((()=>{var e;return(null===(e=o.getConfig())||void 0===e?void 0:e.properties)??[]}),[o]),g=(0,s.useMemo)((()=>({properties:m,values:p})),[m,p]),h=(0,s.useCallback)((e=>{const t=m.concat([e]),n={...p,[e]:void 0};b.createAndCommit({userAction:"AutomationActionSetPropertiesSection.propertiesChange",environment:l,perform:e=>{ce({configStore:o.getConfigStore(),properties:t,transaction:e,values:n})}})}),[l,m,p,o]),S=(0,s.useCallback)(((e,t)=>{const n=m.indexOf(e);if(-1===n)return;const i=m.slice(0);i[n]=t;const r={...p,[t]:void 0};b.createAndCommit({userAction:"AutomationActionSetPropertiesSection.setProperties",environment:l,perform:e=>{ce({configStore:o.getConfigStore(),properties:i,transaction:e,values:r})}})}),[l,m,p,o]),y=(0,s.useCallback)((e=>{const t=m.filter((t=>t!==e)),n={...p,[e]:void 0};b.createAndCommit({userAction:"AutomationActionSetPropertiesSection.removeProperty",environment:l,perform:e=>{ce({configStore:o.getConfigStore(),properties:t,transaction:e,values:n})}})}),[l,m,p,o]),v=(0,s.useCallback)(((e,t)=>{const n={...p,[e]:t};b.createAndCommit({userAction:"AutomationActionSetPropertiesSection.handleValueChange",environment:l,perform:e=>{ce({configStore:o.getConfigStore(),properties:m,transaction:e,values:n})}})}),[l,m,p,o]);return a()(de,{contextStore:t,actionId:u,config:g,onPropertyAdd:h,onPropertyChange:S,onPropertyRemove:y,onPropertyValueChange:v,collectionStore:n,showSetPropertyActions:r,disabled:i})}function ce(e){const{configStore:t,properties:o,transaction:n,values:i}=e;f.sW({store:t,data:{properties:o,values:i},transaction:n})}function de(e){window.__c={n:"AutomationActionSetPropertiesSection"};const{contextStore:t,actionId:o,config:n,collectionStore:i,onPropertyAdd:r,onPropertyChange:l,onPropertyRemove:c,onPropertyValueChange:m,disabled:g,showSetPropertyActions:h}=e,S=(0,u.yK)((e=>({addPropertyValuePlaceholder:{color:e.mediumTextColor,flexGrow:1,textAlign:"right"},addPropertyRow:{display:"flex",alignItems:"center"}})),[]),y=(0,d.VK)((()=>(0,p.cO)({collectionFormat:i.getFormat(),collectionSchema:i.getSchema(),sort:!1,sourcePropertyIds:n.properties})),[i,n.properties]),v=(0,d.VK)((()=>(0,p.cO)({collectionFormat:i.getFormat(),collectionSchema:i.getSchema(),filter:e=>{let[t]=e;return!y.includes(t)}})),[i,y]),f=0===v.length;return s.createElement(s.Fragment,null,y.length>0&&a()(ue,{availablePropertyIds:v,contextStore:t,actionId:o,config:{properties:y,values:n.values},collectionStore:i,onPropertyChange:l,onPropertyRemove:c,onPropertyValueChange:m,showSetPropertyActions:h,disabled:g}),!g&&!f&&a()("div",{style:S.addPropertyRow},void 0,a()(ae,{availablePropertyIds:v,currentValue:void 0,collectionStore:i,contextStore:t,onChange:r,disabled:g,alreadyHaveProperties:y.length>0})))}function ue(e){window.__c={n:"PropertySectionList"};const{availablePropertyIds:t,contextStore:o,actionId:n,config:i,collectionStore:r,onPropertyChange:l,onPropertyRemove:c,onPropertyValueChange:d,showSetPropertyActions:p,disabled:m}=e,g=(0,s.useRef)(null),h=(0,M.X)(g),S=(0,C.a)(h),y=(0,u.yK)((()=>({wrap:{alignItems:"center",columnGap:4,display:"grid",gridTemplateColumns:S?"100%":"140px 1fr",rowGap:S?4:8},propertyValue:{...S?{fontSize:14,marginBlockEnd:16}:{}},lastPropertyValue:{...S?{fontSize:14,marginBlockEnd:0}:{}}})),[S]);return s.createElement("div",{style:y.wrap,ref:g},i.properties.map(((e,s)=>{const u=s===i.properties.length-1;return a()(pe,{actionId:n,availablePropertyIds:t,collectionStore:r,contextStore:o,disabled:m,onPropertyChange:l,onPropertyRemove:c,onPropertyValueChange:d,property:e,showSetPropertyActions:p,value:i.values[e],valueStyle:u?y.lastPropertyValue:y.propertyValue},e)})))}function pe(e){window.__c={n:"PropertySection"};const{actionId:t,availablePropertyIds:o,collectionStore:n,contextStore:r,disabled:l,onPropertyChange:c,onPropertyRemove:p,onPropertyValueChange:v,property:f,showSetPropertyActions:b,value:C,valueStyle:w}=e,k={type:"collection",collectionStore:n,property:f},M=(0,S.useIntl)(),x=(0,u.yK)((e=>({propertyName:{},propertyValue:{display:"flex",gap:4,minWidth:50,...w}})),[w]),T=(0,s.useMemo)((()=>{if("title"===f)return M.formatMessage(le.titlePlaceholder)}),[M,f]),P=(0,d.VK)((()=>{const e=n.getSchema()[f];if(e)return e}),[n,f]),_=(0,d.VK)((()=>{if(P)return(0,h.qW)({table:y.v,id:n.id,spaceId:n.getSpaceId()},f,P)}),[n,P,f]),A=(0,d.VK)((()=>null==P?void 0:P.type),[P]),V=null==C?void 0:C.value,F=(0,d.VK)((()=>(0,g.o9)(C)),[C]),Z=(0,d.VK)((()=>r.context.parentRecordStore.getSpaceId()),[r.context.parentRecordStore]),B=(0,d.VK)((()=>r.getContextValuesForAction(t)),[r,t]),E=(0,s.useCallback)((e=>{c(f,e)}),[c,f]),I=(0,s.useCallback)((()=>p(f)),[p,f]),R=(0,s.useCallback)((e=>{v(f,e)}),[v,f]),O=(0,s.useCallback)((e=>{R({action:e,value:V})}),[V,R]),K=(0,s.useCallback)((e=>{R({action:F,value:e})}),[F,R]);if(!_||!Z)return null;const L=Se(A);return s.createElement(s.Fragment,null,a()("div",{style:x.propertyName},void 0,a()(ae,{availablePropertyIds:o,currentValue:f,contextStore:r,collectionStore:n,onChange:E,disabled:l,onRemove:I})),a()("div",{style:x.propertyValue},void 0,b&&P&&m.Y[P.type]&&a()(me,{disabled:l,onChange:O,value:F}),s.createElement(ne,i()({},L,{type:_,value:null==C?void 0:C.value,onChange:K,disabled:l,contextStore:r,context:k,placeholder:T,disableMobileActionBar:!0,formulaTypecheckContextValues:B,disableTemplateVariableMentions:!0}))))}function me(e){window.__c={n:"SetPropertyListActionDropdownButton"};const{disabled:t,onChange:o,value:n}=e,r=(0,k.d)();return a()(T.ZP,{popupType:r,alignmentToOrigin:T.vR.End,placementToOrigin:T.pO.Bottom,originGap:0,disabled:t,renderOrigin:e=>s.createElement(F.S,i()({disabled:t,variant:"gray"},e),a()(he,{action:n})),render:e=>a()(ge,{onChange:o,parent:e,value:n})})}function ge(e){window.__c={n:"SetPropertyListActionDropdownMenu"};const{value:t,onChange:o,parent:n}=e,r=(0,w.F)({width:250}),c=l.compact(g.E2.map(((e,r)=>({key:r,render:o=>s.createElement(x.Z,i()({},o,{disabled:!1,title:a()(he,{action:e}),checkState:t===e})),action:()=>{e!==t&&o(e),n.close()}}))));return s.createElement(P.Z,r,a()(_.Z,{type:_.i.Vertical,sections:[{key:0,render:e=>s.createElement(A.Z,i()({enableActionSheetTitle:!0},e)),items:c}],initialFocus:0}))}function he(e){const{action:t}=e;return"replace"===t?s.createElement(S.FormattedMessage,le.replaceActionLabel):"append"===t?s.createElement(S.FormattedMessage,le.appendActionLabel):"remove"===t?s.createElement(S.FormattedMessage,le.removeActionLabel):void(0,v.t1)(t)}function Se(e){return"email"===e||"phone_number"===e||"url"===e?{disableEmojiCommands:!0,disableFormattingAndMentions:!0}:{}}},68214:(e,t,o)=>{o.d(t,{a:()=>y});var n=o(10434),i=o.n(n),r=o(23174),a=o.n(r),l=o(67294),s=o(81954),c=o(5366),d=o(29502),u=o(61766),p=o(68216),m=o(31945),g=o(76798),h=o(38752),S=o(29758);function y(e){window.__c={n:"AutomationCollectionPicker"};const{actionStore:t,currentValue:o,contextStore:n,onChange:r,disabled:y,errorMessage:v}=e,f=(0,s.qz)(void 0,u.Z),b=(0,s.VK)((()=>o?p.NW.createChildStore(n.context.parentRecordStore,o):void 0),[o,n.context.parentRecordStore]),C=(0,s.VK)((()=>{if(b)return{collection:b.getSpaceShardedPointer(),type:"collection"}}),[b]),w=(0,l.useCallback)((e=>{"collection"===e.type&&(r(e.collection),f.reset())}),[r,f]),k=(0,l.useCallback)((()=>f.reset()),[f]),M=(0,d.d)(),x=(0,h.d)({errorMessage:v,hasValue:Boolean(b)});return a()(m.ZP,{buttonPopupStore:f,popupType:M,alignmentToOrigin:m.vR.End,placementToOrigin:m.pO.Bottom,originGap:0,disabled:y,renderOrigin:e=>l.createElement(h.S,i()({},x,e,{disabled:y}),b?a()(g.Z,{store:b}):a()(c.FormattedMessage,{id:"automations.databasePicker.buttonPlaceholder",defaultMessage:"Select database"})),render:e=>a()(S.L,{actionId:null==t?void 0:t.id,automationContextStore:n,onChange:w,onClose:k,selectedTarget:C,skipPages:!0})})}},80117:(e,t,o)=>{o.d(t,{W:()=>b});var n=o(10434),i=o.n(n),r=o(23174),a=o.n(r),l=o(67294),s=o(81954),c=o(76205),d=o(5366),u=o(24457),p=o(29502),m=o(77985),g=o(42917),h=o(31945),S=o(8982),y=o(78140),v=o(72495),f=o(38752);function b(e){var t;window.__c={n:"AutomationCombinatorFilterPopup"};const{contextStore:o,filter:n,onChange:r,noFiltersMessage:s,collectionStore:u,disabled:m}=e,g=(0,p.d)({tabletBehavior:"slideUp"}),S=(null==n||null===(t=n.filters)||void 0===t?void 0:t.length)||0;return a()(h.ZP,{popupType:g,alignmentToOrigin:h.vR.End,placementToOrigin:h.pO.Bottom,originGap:0,disabled:m,renderOrigin:e=>l.createElement(f.S,i()({disabled:m,variant:"gray"},e,{onClick:t=>{e.onClick(t),0===S&&r(c.TI)}}),S>0?a()(d.FormattedMessage,{defaultMessage:"{ruleCount, plural, one {{ruleCount} filter} other {{ruleCount} filters}}",id:"automations.QueryCollectionAction.filterRuleCount.label",values:{ruleCount:S}}):s),render:e=>a()(C,{contextStore:o,filter:n,disabled:m,onChange:r,onClose:()=>e.close(),collectionStore:u})})}function C(e){window.__c={n:"AutomationCombinatorFilterMenu"};const{contextStore:t,filter:o,onChange:n,onClose:i,collectionStore:r}=e,p=(0,s.VK)((()=>r.getSchema()),[r]),h=(0,u.F)({minWidth:300,tabletBehavior:"actionSheet"}),f=(0,l.useCallback)(((e,t)=>{n(t)}),[n]),b=(0,l.useCallback)((()=>{n(void 0),i()}),[n,i]);return l.createElement(y.Z,h,a()(S.D,{},void 0,a()(m.Pq,{index:0,level:0,combinatorFilter:o||c.hh,schema:p,onChange:f,collectionViewType:"table",collectionViewId:"test",parentStore:t.context.parentRecordStore})),a()(v.Z,{topBorder:!0},void 0,a()(g.Z,{title:a()(d.FormattedMessage,{defaultMessage:"Delete filter",id:"automations.AutomationCombinatorFilterPopup.deleteFilter.label"}),onClick:b})))}},38752:(e,t,o)=>{o.d(t,{S:()=>S,d:()=>y});var n=o(10434),i=o.n(n),r=o(23174),a=o.n(r),l=o(67294),s=o(480),c=o(24405),d=o(53397),u=o(82990),p=o(24677),m=o(98104),g=o(89728),h=o(58032);const S=l.forwardRef(((e,t)=>{window.__c={n:"AutomationDropdownButton"};const{variant:o,onClick:n,style:r,icon:S,children:y,disabled:v}=e,f=(0,s.O7)(),b=(0,c.yK)((e=>({button:{..."gray"===o&&{color:e.mediumTextColor},..."blue"===o&&{color:e.blueColor,fontWeight:500},..."error"===o&&{color:e.errorText},maxWidth:"calc(100% + 2px)",marginLeft:1,padding:"0 8px 0 5px",...r},warningIcon:{width:12,height:12,marginLeft:-6,marginLeft:6,fill:e.errorText,color:e.errorText},chevronIcon:{width:10,height:10,marginLeft:4,marginTop:2,fill:e.lightIconColor},spacer:{flexGrow:1}})),[o,r]),C=(0,l.useCallback)((e=>{m.ZH(f),p.ZH(f),null==n||n(e)}),[n,f]);return a()(h.Z,{renderTooltip:()=>"error"===o?e.errorMessage:null,placement:h.Z.Placement.Bottom,disableTooltip:"error"!==o,delayThreshold:0,render:e=>l.createElement(g.Z,i()({},e,{style:b.button,icon:S,onClick:C,ref:t,shouldShrink:!0,disabled:v,disabledFeedback:v}),a()("div",{style:{...u.Z.textOverflowStyle}},void 0,y),a()("div",{style:b.spacer}),"error"===o&&d.Z.warning(b.warningIcon),d.Z.chevronDown(b.chevronIcon))})}));function y(e){const{errorMessage:t,hasValue:o}=e;return(0,l.useMemo)((()=>t?{variant:"error",errorMessage:t}:o?{variant:"gray"}:{variant:"blue"}),[t,o])}},10052:(e,t,o)=>{o.d(t,{b:()=>S,Y:()=>y});var n=o(23174),i=o.n(n),r=o(10434),a=o.n(r),l=o(67294),s=o(480),c=o(81954),d=o(9953),u=o(98104),p=o(12359),m=o(21199),g=o(1743),h=o(74194);function S(e){window.__c={n:"AutomationPlainTextInput"};const{value:t,onChange:o,wrapStyle:n,...r}=e,[s,c]=(0,l.useState)(!1);return i()(g.Z,{capture:s},void 0,i()(m.Z,{capture:!0,render:e=>l.createElement("div",a()({},e,{style:n}),l.createElement(h.Z,a()({value:t,onChange:e=>o(e.currentTarget.value),onBlur:()=>{c(!1)},onFocus:()=>{u.o9(),c(!0)}},r)))}))}function y(e){window.__c={n:"ConnectedAutomationPlainTextInput"};const{store:t,...o}=e,n=(0,s.O7)(),i=(0,c.VK)((()=>t.getValue()??""),[t]),r=(0,l.useCallback)((e=>{p.createAndCommit({userAction:"AutomationPlainTextInput.setValue",environment:n,perform:o=>{d.sO({store:t,transaction:o,value:e})}})}),[n,t]);return l.createElement(S,a()({value:i,onChange:r},o))}},29758:(e,t,o)=>{o.d(t,{L:()=>z,H:()=>Q});var n=o(23174),i=o.n(n),r=o(10434),a=o.n(r),l=(o(57658),o(21703),o(96486)),s=o.n(l),c=o(67294),d=o(480),u=o(81954),p=o(24405),m=o(84619),g=o(23790),h=o(84116),S=o(58573),y=o(59054),v=o(53397),f=o(5366),b=o(4615),C=o(21202),w=o(6287),k=o(97880),M=o(77162),x=o(31299),T=o(87279),P=o(98742),_=o(24457),A=o(29798),V=o(68216),F=o(73657),Z=o(71846),B=o(52275),E=o(68894),I=o(78140),R=o(32163),O=o(11470),K=o(72495),L=o(58032),D=o(21396),W=o(78948);const H=(0,f.defineMessages)({searchInputPlaceholder:{defaultMessage:"Select blocks to edit…",id:"automations.AutomationTargetPickerMenu.search.placeholder"}});function z(e){window.__c={n:"AutomationTargetPickerMenu"};const t=(0,d.O7)(),o=(0,_.F)({maxWidth:360,paddingTop:12,width:280}),n=(0,c.useMemo)((()=>(0,b.ZP)()),[]),i=(0,c.useCallback)((()=>{M.tW({environment:t,eventName:"abandoned_search",sessionId:n,source:Z.S.Automation})}),[t,n]);return o.menuType===T.og.Popup&&(o.onClickOutside=i),c.createElement(I.Z,o,c.createElement(Q,a()({},e,{searchSessionId:n})))}function Q(e){window.__c={n:"AutomationTargetPickerMenuChildren"};const{actionId:t,automationContextStore:o,onChange:n,onClose:r,selectedTarget:l,skipCollections:p,skipPages:v,skipVariables:b,searchSessionId:T}=e,_=(0,d.O7)(),E=(0,u.qz)(void 0,A.Z),I=(0,u.VK)((()=>{const{context:e}=o;if("button_property"===e.type)return e.collectionContextStore.collectionViewBlockStore()}),[o]),H=(0,u.VK)((()=>{if(b||!t)return[];const e=o.getContextValuesForAction(t);if(e){return Object.values(e).filter((e=>(0,g.uy)(e.type,{type:"block"})))}return[]}),[b,o,t],{useDeepEqual:!0}),z=(0,c.useMemo)((()=>o.context.parentRecordStore),[o.context]),Q=(0,u.VK)((()=>z.getSpaceId()),[z]),[j,Y]=(0,c.useReducer)(U,{automationVariables:[],collectionQueryLimit:5,pageQueryLimit:5,searchTerm:""});(0,c.useEffect)((()=>{if(j.searchTerm){const e=(0,S.ZP)(j.searchTerm,H,(e=>e.kind===h.yp.ContextValue?e.name:""));Y({type:"set_variables",variables:e})}else Y({type:"set_variables",variables:H})}),[j.searchTerm,H]);const $=function(e){const{collectionViewBlockStore:t,limit:o,parentStore:n,searchTerm:i,skip:r}=e,a=(0,d.O7)(),[l,s]=(0,c.useReducer)(q,{error:void 0,isLoading:Boolean(r),results:void 0,total:void 0}),[u]=(0,y.r5)((async()=>{if(r)return;const e=await x.RT({collectionViewBlockStore:t,environment:a,limit:o,parentStore:n,query:i,requireEditPermissions:!0});return{results:e.results,total:e.total}}),[t,a,o,n,i,r],{debounce:x.vp});return(0,c.useEffect)((()=>{if("pending"===u.status||"idle"===u.status)s({type:"query_loadstart"});else if("resolved"===u.status){var e,t;s({results:null===(e=u.value)||void 0===e?void 0:e.results,total:null===(t=u.value)||void 0===t?void 0:t.total,type:"query_finish"})}else"rejected"===u.status?s({error:u.error,type:"query_error"}):(0,k.t1)(u)}),[u]),l}({collectionViewBlockStore:I,limit:j.collectionQueryLimit,parentStore:z,searchTerm:j.searchTerm,skip:p}),J=function(e){const{limit:t,searchTerm:o,skip:n,spaceId:i}=e,r=(0,d.O7)(),[a,l]=(0,c.useReducer)(q,{error:void 0,isLoading:Boolean(n),results:void 0,total:void 0}),[s]=(0,y.r5)((async()=>{if(n||!i)return;const e=await x.D7({boostRecentlyViewedPages:!0,environment:r,excludeTemplates:!0,limit:t,query:o,requireEditPermissions:!1,source:"automation_page_picker",spaceId:i});return{results:e.results.map((e=>e.id)),total:e.total}}),[r,t,o,n,i],{debounce:x.vp});return(0,c.useEffect)((()=>{if("pending"===s.status||"idle"===s.status)l({type:"query_loadstart"});else if("resolved"===s.status){var e,t;l({results:null===(e=s.value)||void 0===e?void 0:e.results,total:null===(t=s.value)||void 0===t?void 0:t.total,type:"query_finish"})}else"rejected"===s.status?l({error:s.error,type:"query_error"}):(0,k.t1)(s)}),[s]),a}({limit:j.pageQueryLimit,searchTerm:j.searchTerm,skip:v,spaceId:Q}),X=(0,c.useCallback)((e=>{"collection"===e.type&&M.tW({environment:_,eventName:"select_search_item",queryLength:j.searchTerm.length,sessionId:T,source:Z.S.Automation,totalResults:$.total}),l&&!s().isEqual(l,e)?n(e):l?r():n(e)}),[_,T,j.searchTerm,$.total,l,n,r]),ee=(0,c.useCallback)((e=>{const t=e.target.value;Y({searchTerm:t,type:"set_search_term"}),E.setState({focus:{section:0,indexLocal:0,indexGlobal:0}})}),[E]),te=(0,c.useCallback)((()=>{Y({queryLimit:j.collectionQueryLimit+20,type:"set_collection_query_limit"})}),[j.collectionQueryLimit]),oe=(0,c.useCallback)((()=>{Y({queryLimit:j.pageQueryLimit+20,type:"set_page_query_limit"})}),[j.pageQueryLimit]),ne="variable"===(null==l?void 0:l.type)?l.id:void 0,ie="collection"===(null==l?void 0:l.type)?l.collection.id:void 0,re="page"===(null==l?void 0:l.type)?l.page.id:void 0,ae=[],le=function(e){const{automationVariables:t,onClick:o,selectedVariableId:n}=e,r=t.map((e=>{if(e.kind!==h.yp.ContextValue)throw new Error("Not implemented yet.");return{action:()=>o({id:e.id,type:"variable"}),key:e.id,render:t=>i()(L.Z,{placement:L.Z.Placement.Right,render:o=>c.createElement(B.Z,a()({},(0,P.Z)(o,t),{checkState:e.id===n,title:i()("div",{style:{display:"flex"}},void 0,i()(D.F,{value:e,format:m.l.Medium,isSingle:!0,shouldShrink:!0}))})),renderTooltip:()=>e.name,textWrap:!0})}}));if(0===r.length)return;return{key:"variable_results",items:r,render:e=>c.createElement(K.Z,a()({},e,{title:i()(f.FormattedMessage,{defaultMessage:"From this automation",id:"automations.AutomationTargetPickerMenu.variablesSection.title"})}))}}({automationVariables:j.automationVariables,onClick:X,selectedVariableId:ne});le&&ae.push(le);const se=function(e){const{collectionQueryResult:t,onCollectionMenuItemClick:o,onShowMoreItemClick:n,parentRecordStore:r,selectedCollectionId:l}=e;if(t.isLoading)return;let s=[];if(t.error)s.push({action:n,key:"show_more_collection_results",render:e=>c.createElement(F.Z,a()({},e,{caption:i()(f.FormattedMessage,{defaultMessage:"Sorry, something went wrong while searching for databases.",id:"automations.AutomationTargetPickerMenu.errorCollections.label"}),shouldWrapCaption:!0}))});else{const e=t.results??[],i=e.length;s=e.map((e=>{const t=V.NW.createChildStore(r,{table:w.v,id:e});return{action:()=>o({collection:t.getSpaceShardedPointer(),type:"collection"}),key:e,render:o=>c.createElement(O.Z,a()({},o,{checkState:e===l,store:t}))}}));const d=t.total??0,u=Math.max(0,d-i);u>0&&s.push({action:n,key:"show_more_collection_results",render:e=>c.createElement(G,a()({},e,{showMoreCount:u}))})}if(0===s.length)return;return{key:"collection_results",items:s,render:e=>c.createElement(K.Z,a()({},e,{title:i()(f.FormattedMessage,{defaultMessage:"Databases",id:"automations.AutomationTargetPickerMenu.collectionsSection.title"})}))}}({collectionQueryResult:$,onCollectionMenuItemClick:X,onShowMoreItemClick:te,parentRecordStore:z,selectedCollectionId:ie});se&&ae.push(se);const ce=function(e){const{pageQueryResult:t,onPageMenuItemClick:o,onShowMoreItemClick:n,parentRecordStore:r,selectedPageId:l}=e;if(t.isLoading)return;let s=[];if(t.error)s.push({action:n,key:"show_more_collection_results",render:e=>c.createElement(F.Z,a()({},e,{caption:i()(f.FormattedMessage,{defaultMessage:"Sorry, something went wrong while searching for pages.",id:"automations.AutomationTargetPickerMenu.errorPages.label"}),shouldWrapCaption:!0}))});else{const e=t.results??[],i=e.length;s=e.map((e=>{const t=V.G.createChildStore(r,{table:C.iU,id:e});return{key:e,render:o=>c.createElement(O.Z,a()({},o,{checkState:e===l,store:t})),action:()=>o({page:t.getSpaceShardedPointer(),type:"page"})}}));const d=t.total??0,u=Math.max(0,d-i);u>0&&s.push({action:n,key:"show_more_page_results",render:e=>c.createElement(G,a()({},e,{showMoreCount:u}))})}if(0===s.length)return;return{key:"page_results",items:s,render:e=>c.createElement(K.Z,a()({},e,{title:i()(f.FormattedMessage,{defaultMessage:"Pages",id:"automations.AutomationTargetPickerMenu.pagesSection.title"})}))}}({onPageMenuItemClick:X,onShowMoreItemClick:oe,pageQueryResult:J,parentRecordStore:z,selectedPageId:re});ce&&ae.push(ce);const de=$.isLoading||J.isLoading;return c.createElement(c.Fragment,null,i()(N,{onChange:ee,value:j.searchTerm}),de?i()(K.Z,{},void 0,i()(W.Z,{})):!de&&ae.length>0?i()(R.Z,{initialFocus:0,sections:ae,store:E,type:R.i.Vertical}):i()(F.Z,{caption:i()(f.FormattedMessage,{defaultMessage:"No results",id:"automations.AutomationTargetPickerMenu.noResults.label"})}))}function N(e){window.__c={n:"SearchInputSection"};const{onChange:t,value:o}=e,{isMobile:n}=(0,d.Fy)(),r=(0,f.useIntl)(),a=(0,p.yK)((()=>({section:{paddingBlockStart:0}})),[]);return i()(K.Z,{style:a.section},void 0,i()(E.ZP,{focusInitial:!n||void 0,onChange:t,placeholder:r.formatMessage(H.searchInputPlaceholder),showClearButton:!0,value:o??""}))}const G=(0,c.forwardRef)((function(e,t){window.__c={n:"ShowMoreButtonMenuItem"};const{showMoreCount:o}=e,n=(0,p.yK)((e=>({showMoreButton:{color:e.mediumTextColor,fill:e.mediumIconColor}})),[]);return c.createElement(B.Z,a()({},e,{icon:v.Z.dots({width:16,height:16}),ref:t,style:n.showMoreButton,title:i()(f.FormattedMessage,{defaultMessage:"Show {showMore} more",id:"automations.AutomationTargetPickerMenu.showMore.label",values:{showMore:Math.min(o,20)}})}))}));function U(e,t){if("set_variables"===t.type)return{...e,automationVariables:t.variables.slice(0)};if("set_search_term"===t.type){const o=t.searchTerm?20:5;return{...e,collectionQueryLimit:o,pageQueryLimit:o,searchTerm:t.searchTerm}}if("set_collection_query_limit"===t.type){if(e.collectionQueryLimit!==t.queryLimit)return{...e,collectionQueryLimit:t.queryLimit}}else if("set_page_query_limit"===t.type){if(e.pageQueryLimit!==t.queryLimit)return{...e,pageQueryLimit:t.queryLimit}}else(0,k.t1)(t);return e}function q(e,t){if("query_loadstart"===t.type){if(!e.isLoading)return{...e,isLoading:!0}}else{if("query_finish"===t.type)return{...e,error:void 0,isLoading:!1,results:t.results,total:t.total};if("query_error"===t.type)return{...e,error:t.error,isLoading:!1,results:void 0,total:void 0};(0,k.t1)(t)}return e}},54119:(e,t,o)=>{o.d(t,{Z:()=>m});var n=o(23174),i=o.n(n),r=(o(67294),o(480)),a=o(81954),l=o(24405),s=o(5366),c=o(99417),d=o(79315),u=o(96026),p=o(90403);function m(e){window.__c={n:"AiBadge"};const t=(0,l.Fg)(),o=(0,r.O7)();return(0,a.VK)((()=>{const e=d.default.state.mainEditorCurrentBlockStore,t=e&&u.Z.getMode(o,e);return(0,c.GD)(o,t)}),[o])?i()(p.Z,{style:{fontSize:11,fontWeight:500,padding:"1px 4px",borderRadius:4,display:"inline-flex",flexDirection:"row",alignItems:"center",gap:4,background:"light"===t.mode?t.accentColors.purple[50]:t.accentColors.purple[200],color:"light"===t.mode?t.accentColors.purple[500]:t.accentColors.purple[700],...e.style},content:i()(s.FormattedMessage,{id:"aiBadgeComponent.label",defaultMessage:"AI"})}):null}},72865:(e,t,o)=>{o.d(t,{D:()=>S});var n=o(23174),i=o.n(n),r=o(10434),a=o.n(r),l=o(67294),s=o(480),c=o(24405),d=o(993),u=o(12359),p=o(43250),m=o(17809),g=o(24666),h=o(65187);function S(e){window.__c={n:"SimpleFormulaValueTextInput"};const{value:t,disabled:o,onChange:n,multiline:r,placeholder:S,disableFormattingAndMentions:y,disableMobileActionBar:v,disableEmojiCommands:f,disableTemplateVariableMentions:b}=e,C=(0,s.O7)(),w=(0,c.yK)((e=>({wrap:{flexGrow:1,flexShrink:1,boxShadow:e.inputBoxShadow,borderRadius:4,padding:r?"6px 10px":"4px 8px",overflow:"hidden",..."dark"===e.mode?{backgroundColor:e.inputBackground}:{}},text:r?{minHeight:60}:{whiteSpace:"pre"},placeholder:r?{minHeight:60}:{}})),[r]),k=(0,l.useCallback)((e=>{n({type:"simple",value:e})}),[n]),{store:M}=(0,m.useMockTextStore)({initialValue:null==t?void 0:t.value,onChange:k}),x=(0,l.useMemo)((()=>r?()=>{const e=g.default.state;"editing"===e.mode&&u.createAndCommit({userAction:"SimpleFormulaValueTextInput.handleEnter",environment:C,perform:t=>{d.hJ({environment:C,string:"\n",multiSelection:e.multiSelection,disableMentions:!0,disableDateMentions:!0,disableDateReminderMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:t})}})}:void 0),[C,r]);return i()("div",{style:w.wrap,className:p.Wh_},void 0,l.createElement(h.Z,a()({placeholder:S,disabled:o,store:M,style:w.text,placeholderStyle:w.placeholder,pasteBehavior:"inline",disableSlashCommands:!0,disableEmbedMenu:!0,disableEmojiCommands:f,disableComment:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,onEnter:x,disableMobileActionBar:v,disableTemplateVariableMentions:b},y?{disableDateMentions:!0,disableDateReminderMentions:!0,disableMentions:!0,disableStyleAnnotations:!0}:{})))}},55950:(e,t,o)=>{o.d(t,{a:()=>Ce,K:()=>P});var n=o(23174),i=o.n(n),r=o(10434),a=o.n(r),l=o(67294),s=o(480),c=o(81954),d=o(66897),u=o(99036),p=o(80951),m=o(84619),g=o(78106),h=o(76218),S=o(68626),y=o(19889),v=o(70203),f=o(97880),b=o(12508),C=o(92864),w=o(89845),k=o(69265),M=o(22084),x=o(21396),T=o(75311);function P(e){window.__c={n:"ValuePickerMenuToken"};const{token:t,contextStore:o,disabled:n,setCurrentTokens:r,currentSimpleFormulaValueTokens:P,context:_}=e,A=(0,s.Fy)(),V=(0,c.Kw)(o.compilationResultStore),F=(0,c.VK)((()=>{if((0,h.S3)(t)&&(0,v.IW)(t)){const e=(0,v.zE)(t);if(e)return(0,d.Hl)({pointer:{table:y.KJ,id:e},getRecordValue:o.context.parentRecordStore.getRecordValue})}}),[o.context.parentRecordStore,t]),Z=(0,c.VK)((()=>(0,T._)(_)),[_]),B=(0,c.VK)((()=>_.collectionStore.getSchema()[_.property]),[_]);if("string"==typeof t){if(!B||!(0,u.t)(B))return null;const e=(0,p.i7)((null==B?void 0:B.options)??[],t);if(!e)return null;const o={value:e.value,color:e.color,isSingle:!1,showRemoveButton:!n,format:A.isMobile?m.l.Medium:m.l.Small,onClickRemove:()=>{null==r||r((0,h.Ck)(P,t))}};if((0,u.gB)(B)){var E;const t=null===(E=B.groups)||void 0===E||null===(E=E.find((t=>{var o;return null===(o=t.optionIds)||void 0===o?void 0:o.includes(e.id)})))||void 0===E?void 0:E.color;return l.createElement(M.F,a()({},o,{groupColor:t}))}return l.createElement(M.a,o)}if("boolean"==typeof t)return i()(b.Z,{checked:t,disabled:!0,size:16,checkSize:12,style:{marginBottom:6}},t.toString());if((0,v.IW)(t))return null!=F&&F.asActor?i()(C.ZP,{actor:F,format:A.isMobile?C.ZP.Format.Medium:C.ZP.Format.Small,showRemoveButton:!n,onClickRemove:()=>{null==r||r((0,h.Ck)(P,t))},shouldShrink:!0,isSingle:!1},F.id):null;if((0,v.wj)(t)){const e=(0,v.vm)(t).id,o=S.x.isSuccess(V)?(0,g.vx)(V.value.valueTypes,e):void 0;return o?i()(x.F,{value:o,format:m.l.Small,isSingle:!1,shouldShrink:!0,showRemoveButton:!n,onClickRemove:()=>{null==r||r((0,h.Ck)(P,t))}}):null}if((0,v.fp)(t)){const e=P[0],t=e&&(0,h.S3)(e)&&(0,v.fp)(e)?(0,v.Ot)(e):void 0;return t?i()(w.Z,{value:t,dateFormat:Z.dateFormat,timeFormat:Z.timeFormat,style:{marginBottom:6}}):null}if((0,v.ST)(t)){const e=(0,v.TO)(t);return e?i()(k.Z,{format:A.isMobile?m.l.Medium:m.l.Small,blockId:e,shouldWrap:!1,shouldShrink:!0,isSingle:!1,parentStore:o.context.parentRecordStore,showRemoveButton:!n,onClickRemove:()=>{null==r||r((0,h.Ck)(P,t))}},e):null}(0,f.t1)(t)}o(57658);var _=o(96486),A=o.n(_),V=o(23790),F=o(84116),Z=o(58573),B=o(59054),E=o(5366),I=o(31299),R=o(17809),O=o(87279),K=o(29798),L=o(78140),D=o(32163),W=o(43765),H=o(40721),z=o(72495),Q=o(78948),N=o(47082),G=o(30387),U=o(53397),q=o(24405),j=o(52275);function Y(e){window.__c={n:"IconMenuItem"};const t=(0,q.yK)((e=>({icon:{width:14,fill:e.mediumIconColor},chevronRight:{width:12,fill:e.mediumIconColor}})),[]);return i()(j.Z,{icon:e.icon(t.icon),title:e.title,focused:!1,right:U.Z.chevronRight(t.chevronRight),onClick:e.onClick})}function $(e){window.__c={n:"CustomFormulaItem"};const{value:t,onChange:o}=e,n=(0,l.useCallback)((()=>{o({type:"formula",value:null==t?void 0:t.value})}),[t,o]);return i()(Y,{icon:U.Z.typesFormula,title:l.createElement(E.FormattedMessage,G.s.customFormula),onClick:n})}o(21703);var J=o(21202),X=o(68216),ee=o(11470),te=o(58032);function oe(e){window.__c={n:"ValuePickerMenuItem"};const{token:t,contextStore:o,args:n,checkState:r,checkType:w,context:k,onCheckboxClick:T}=e,P=(0,s.Fy)(),_=(0,c.VK)((()=>o.context.parentRecordStore.getSpaceId()),[o.context.parentRecordStore]),A=(0,c.VK)((()=>{if((0,h.S3)(t)&&(0,v.IW)(t)){const e=(0,v.zE)(t);if(e)return(0,d.Hl)({pointer:{table:y.KJ,id:e},getRecordValue:o.context.parentRecordStore.getRecordValue})}}),[o.context.parentRecordStore,t]),V=(0,c.VK)((()=>k.collectionStore.getSchema()[k.property]),[k]),F=(0,c.VK)((()=>V&&(0,u.t)(V)?V.options??[]:[]),[V]),Z=(0,c.VK)((()=>V&&(0,u.gB)(V)?V.groups??[]:[]),[V]),B=(0,c.Kw)(o.compilationResultStore),E=Boolean(V&&(0,u.gB)(V)),I="single"===w?{checkState:r}:{icon:i()(b.Z,{checked:r,size:14,onClick:T})};if("string"==typeof t){if(E){const e=(0,p.i7)(F,t),o=Z.find((t=>{var o;return e&&(null===(o=t.optionIds)||void 0===o?void 0:o.includes(e.id))}));return e?l.createElement(j.Z,a()({},n,I,{title:i()(M.F,{format:P.isMobile?m.l.Large:m.l.Small,isSingle:!0,value:e.value,color:e.color,groupColor:null==o?void 0:o.color,shouldShrink:!0,showRemoveButton:!1},t),isTokenTitle:!0},n)):null}{const e=(0,p.i7)(F,t);return e?l.createElement(j.Z,a()({},n,I,{title:i()(M.a,{value:e.value,color:e.color,showRemoveButton:!1,isSingle:!0,shouldShrink:!0,format:P.isMobile?m.l.Large:m.l.Small}),isTokenTitle:!0},n)):null}}if("boolean"==typeof t)return null;if((0,v.IW)(t))return null!=A&&A.asActor&&A.table===y.KJ?l.createElement(j.Z,a()({},n,I,{title:i()(C.vw,{isSingle:!0,shouldShrink:!0,format:P.isMobile?C.vw.Format.Large:C.vw.Format.Medium,userValue:A.asActor}),isTokenTitle:!0})):null;if((0,v.wj)(t)){const e=(0,v.vm)(t).id,o=S.x.isSuccess(B)?(0,g.vx)(B.value.valueTypes,e):void 0;return o?l.createElement(j.Z,a()({},I,{title:i()(te.Z,{renderTooltip:()=>(0,x.e)(o),placement:te.Z.Placement.Right,render:e=>l.createElement("div",a()({style:{display:"flex"}},e),i()(x.F,{value:o,format:m.l.Medium,isSingle:!0,shouldShrink:!0}))})},n)):null}if((0,v.fp)(t))return null;if((0,v.ST)(t)){const e=(0,v.TO)(t);if(!e)return null;if(!_)return null;const i=X.G.createChildStore(o.context.parentRecordStore,{table:J.iU,id:e,spaceId:_});return l.createElement(ee.Z,a()({store:i,checkState:r,hidePath:!0},n))}(0,f.t1)(t)}function ne(e){const{currentSimpleFormulaValueTokens:t,value:o,contextStore:n,setCurrentTokens:r,action:a,context:l,checkType:s,onCheckboxClick:c}=e;if(o.kind!==F.yp.ContextValue)throw new Error("Not implemented yet.");const d=Boolean(t.find((e=>(0,h.S3)(e)&&(0,v.wj)(e)&&(0,v.vm)(e).id===o.id))),u=(0,v._Q)({id:o.id}),p=()=>{r("append"===a?d?(0,h.Ck)(t,u):[...t,u]:[u]),null==c||c()};return{key:o.id,render:e=>i()(oe,{token:u,contextStore:n,args:e,checkState:d,checkType:s,context:l,onCheckboxClick:p}),action:p}}function ie(e){var t,o;window.__c={n:"ValuePickerMenuBlockArray"};const{currentSimpleFormulaValueTokens:n,menuProps:r,onClose:d,onChange:p,contextStore:m,formulaTypecheckContextValues:g,context:S,showClearButton:y,showInputMenuItem:f,type:b}=e,C=(0,s.Fy)(),w=(0,E.useIntl)(),k=(0,s.O7)(),[M,x]=(0,l.useState)(""),_=(0,c.qz)(void 0,K.Z),{collectionStore:U,property:q}=S,j=(0,T.M)(U,q),Y=j(n,"first"),J=(0,c.VK)((()=>U.getSchema()[S.property]),[U,S.property]),X=(0,c.VK)((()=>!(!J||!(0,u.en)(J))&&1===J.limit),[J]),ee=(0,l.useMemo)((()=>{const e="relation"===(null==J?void 0:J.type)?(0,u.j0)(J):void 0;return g.filter((t=>(0,V.uy)(t.type,{type:"block",collection:e},!0)))}),[g,J]),[te]=(0,B.r5)((async()=>{const e=M?(0,Z.ZP)(M,ee,(e=>e.kind===F.yp.ContextValue?e.name:"")):ee,{results:t}=await I.df({environment:k,query:M,collectionId:b.collection.id,limit:20,spaceId:b.collection.spaceId,excludeTemplates:!0,source:"simple_formula_value_page_search",includePublicPagesWithoutExplicitAccess:!1,boostRecentlyViewedPages:!1});return{valueResults:e,pageResults:t}}),[k,M,ee,b],{debounce:I.vp}),ie=(0,l.useCallback)((()=>{x(""),_.setState({..._.state,focus:{section:0,indexLocal:0,indexGlobal:0}})}),[_]),re=(0,l.useCallback)((e=>{const t=j(e,"last");p({type:"simple",value:(0,h.iC)(t)}),ie()}),[p,ie,j]),ae=(0,c.VK)((()=>(0,R.formulaButtonsEnabled)()),[]),le=A().compact(Y.map(((e,t)=>i()(P,{token:e,contextStore:m,disabled:!1,currentSimpleFormulaValueTokens:Y,setCurrentTokens:re,context:S},t)))),se=i()(N.Z,{focus:!C.isMobile||void 0,focusAfterAnimation:!0,format:N.Z.Format.FilterValue,tokens:le,placeholder:w.formatMessage(G.s.pageSearchPlaceholder),onRemoveLastToken:()=>{re(Y.slice(0,Y.length-1))},onClearButtonClick:()=>{re([])},value:M,onChange:e=>{x(e.target.value)},dontShowBorderBottom:C.isAndroid,showClearButton:y}),ce=void 0!==(null==r?void 0:r.header)?r.header:i()(z.Z,{style:{paddingBottom:0},title:w.formatMessage(G.s.genericMenuHeader)});let de;de=C.isMobile?{menuType:O.og.Modal,right:i()(H.DoneMenuText,{}),onClickRight:d}:{menuType:O.og.Popup,maxHeight:"50vh",width:260,paddingTop:0,footer:ae&&i()(z.Z,{topBorder:!0},void 0,l.createElement($,e)),disableHeaderBorder:!0};const ue={...de,...r,header:C.isMobile?null:ce},pe=X?"single":"multi",me=[],ge=[...A().compact(((null===(t=te.value)||void 0===t?void 0:t.valueResults)||[]).map((e=>ne({currentSimpleFormulaValueTokens:Y,value:e,setCurrentTokens:re,contextStore:m,action:"append",context:S,checkType:pe})))),...A().compact(((null===(o=te.value)||void 0===o?void 0:o.pageResults)||[]).map((e=>{const t=Boolean(Y.find((t=>(0,h.S3)(t)&&(0,v.ST)(t)&&(0,v.TO)(t)===e))),o=(0,v.$0)(e,b.collection.spaceId),n=()=>{re(t?(0,h.Ck)(Y,o):[...Y,o])};return{key:e,render:e=>i()(oe,{token:o,contextStore:m,args:e,checkState:t,checkType:pe,context:S,onCheckboxClick:n}),action:n}})))];if(f){const e=Boolean(ce);me.push({key:"search-input",render:t=>l.createElement(z.Z,a()({},t,{style:{...e&&{paddingTop:0}}})),items:[{action:()=>{},key:"input",render:()=>se}]})}if(ge.length>0){const e=Boolean(ce)||f;me.push({key:"values",render:t=>l.createElement(z.Z,a()({topBorder:e},t)),items:ge})}return l.createElement(L.Z,ue,te.error&&i()(z.Z,{},void 0,i()(W.Z,{title:l.createElement(E.FormattedMessage,G.s.somethingWentWrong)})),0===me.length&&te.value&&i()(z.Z,{},void 0,i()(W.Z,{title:l.createElement(E.FormattedMessage,G.s.noResults)})),!te.value&&!te.error&&i()(z.Z,{},void 0,i()(Q.Z,{})),me.length>0&&i()(D.Z,{type:D.i.Vertical,initialFocus:0,sections:me,store:_}))}function re(e){window.__c={n:"ValuePickerMenuCheckbox"};const{context:t,contextStore:o,currentSimpleFormulaValueTokens:n,formulaTypecheckContextValues:r,menuProps:d,onChange:u,onClose:p}=e,m=(0,E.useIntl)(),g=(0,s.Fy)(),S=r.filter((e=>"checkbox"===e.type.type)),y=(0,l.useCallback)((e=>{u({type:"simple",value:void 0!==e[0]?(0,h.YD)(e[0]):void 0})}),[u]),v=(0,l.useCallback)((e=>{y(e),p()}),[y,p]),f=(0,c.VK)((()=>(0,R.formulaButtonsEnabled)()),[]),b=A().compact(S.map((e=>ne({currentSimpleFormulaValueTokens:n,value:e,setCurrentTokens:v,contextStore:o,action:"replace",context:t,checkType:"single"})))),C=[],w=n.some((e=>!0===e)),k=[...b,...[{key:0,render:e=>l.createElement(j.Z,a()({title:l.createElement(E.FormattedMessage,G.s.unchecked),checkState:!w},e)),action:()=>{v([!1])}},{key:1,render:e=>l.createElement(j.Z,a()({title:l.createElement(E.FormattedMessage,G.s.checked),checkState:w},e)),action:()=>{v([!0])}}]],M=void 0!==(null==d?void 0:d.header)?d.header:i()(z.Z,{style:{paddingBottom:0},title:m.formatMessage(G.s.genericMenuHeader)}),x=Boolean(M);let T;C.push({key:"checkbox",render:e=>l.createElement(z.Z,a()({},e,{topBorder:x})),items:k}),T=g.isMobile?{menuType:O.og.Modal,right:i()(H.DoneMenuText,{}),onClickRight:p}:{header:M,menuType:O.og.Popup,maxHeight:"50vh",width:260,footer:f&&i()(z.Z,{topBorder:!0},void 0,l.createElement($,e)),disableHeaderBorder:!0};const P={...T,...d,header:g.isMobile?null:M};return l.createElement(L.Z,P,i()(D.Z,{type:D.i.Vertical,initialFocus:0,sections:C}))}var ae=o(28020),le=o(77907),se=o(73063),ce=o(89728);function de(e){window.__c={n:"ValueDatePicker"};const{currentSimpleFormulaValueTokens:t,disabled:o,setInDatePicker:n,onClose:r,setCurrentTokens:a,context:s}=e,d=t[0],u=d&&(0,h.S3)(d)&&(0,v.fp)(d)?(0,v.Ot)(d):void 0,p=(0,E.useIntl)(),m=(0,c.Kw)(ae.AK),g=(0,l.useCallback)((()=>{n(!1)}),[n]),S=(0,l.useCallback)((e=>{a(e?[(0,v.pZ)(e)]:[])}),[a]),y=(0,q.yK)((e=>({header:{display:"flex",alignItems:"center",fontSize:12,paddingInline:14,color:e.mediumTextColor,marginTop:8,fontWeight:500},iconWrap:{width:18,height:18,marginRight:4},icon:{width:12,height:12},title:{flex:"1 1 auto"}})),[]),f=(0,c.VK)((()=>(0,T._)(s)),[s]);return i()(le.DependencyConsumer,{dependency:le.deps.menus},void 0,(e=>{let{DatePropertyMenu:t}=e;return i()(t,{firstDayOfWeek:m,value:u,canConfigureCollection:!1,onChangeValue:S,dateFormat:f.dateFormat,timeFormat:f.timeFormat,onDismiss:r,disabled:o,shouldShowReminder:!1,header:i()("div",{style:y.header},void 0,i()(se.Z,{ariaLabel:p.formatMessage(G.s.back),icon:U.Z.historyBack,onClick:g,style:y.iconWrap,iconStyle:y.icon}),i()("span",{style:y.title},void 0,l.createElement(E.FormattedMessage,G.s.pickADate)),i()(ce.Z,{onClick:r,isBlue:!0},void 0,i()(H.DoneMenuText,{})))})}))}function ue(e){window.__c={n:"ValuePickerMenuDate"};const{currentSimpleFormulaValueTokens:t,onClose:o,onChange:n,contextStore:r,formulaTypecheckContextValues:d,context:u,menuProps:p}=e,m=(0,E.useIntl)(),g=(0,s.Fy)(),[S,y]=(0,l.useState)(!1),v=d.filter((e=>"date"===e.type.type)),f=(0,l.useCallback)((e=>{n({type:"simple",value:void 0!==e[0]?(0,h.YD)(e[0]):void 0})}),[n]),b=(0,l.useCallback)((e=>{f(e),o()}),[f,o]),C=(0,l.useCallback)((()=>{y(!0)}),[]),w=(0,l.useCallback)((()=>{f([]),o()}),[f,o]),k=(0,c.VK)((()=>(0,R.formulaButtonsEnabled)()),[]);if(S)return l.createElement(de,a()({},e,{setInDatePicker:y,setCurrentTokens:f,currentSimpleFormulaValueTokens:t}));const M=void 0!==(null==p?void 0:p.header)?p.header:i()(z.Z,{style:{paddingBottom:0},title:m.formatMessage(G.s.genericMenuHeader)}),x=A().compact(v.map((e=>ne({currentSimpleFormulaValueTokens:t,value:e,setCurrentTokens:b,contextStore:r,action:"replace",context:u,checkType:"single"})))),T=[];if(x.length>0){const e=Boolean(M);T.push({key:"values",render:t=>l.createElement(z.Z,a()({topBorder:e},t)),items:x})}const P=l.createElement(l.Fragment,null,i()(z.Z,{topBorder:!0},void 0,i()(Y,{icon:U.Z.typesDate,title:l.createElement(E.FormattedMessage,G.s.pickADate),onClick:C}),k&&l.createElement($,e)),t.length>0&&i()(z.Z,{topBorder:!0},void 0,i()(j.Z,{title:l.createElement(E.FormattedMessage,G.s.clear),focused:!1,onClick:w})));let _;_=g.isMobile?{menuType:O.og.Modal,right:i()(H.DoneMenuText,{}),onClickRight:o,footer:P}:{menuType:O.og.Popup,maxHeight:"50vh",width:260,footer:P,disableHeaderBorder:!0};const V={..._,...p,header:g.isMobile?null:M};return l.createElement(L.Z,V,i()(D.Z,{type:D.i.Vertical,initialFocus:0,sections:T}))}var pe=o(68894);function me(e){window.__c={n:"ValuePickerMenuNumber"};const{context:t,contextStore:o,currentSimpleFormulaValueTokens:n,formulaTypecheckContextValues:r,menuProps:d,onChange:u,onClose:p,value:m}=e,g=(0,E.useIntl)(),S=(0,s.Fy)(),y=r.filter((e=>"number"===e.type.type)),f=(0,l.useCallback)((e=>{u({type:"simple",value:e})}),[u]),b=(0,l.useCallback)((e=>{f(e),p()}),[f,p]),C=(0,l.useCallback)((e=>{const t=e.target.value;let o;o=""===t?void 0:[[t]],f(o)}),[f]),w=(0,l.useCallback)((e=>{const t=A().get(e,"event.target.value");let o;o="string"==typeof t&&""!==t?[[t]]:void 0,b(o)}),[b]),k=(0,l.useCallback)((e=>{const t=void 0!==e[0]?(0,h.YD)(e[0]):void 0;b(t)}),[b]),M=(0,c.VK)((()=>(0,R.formulaButtonsEnabled)()),[]),x=[],T=[...[{action:w,key:"input",render:e=>{const t=n[0],o="string"==typeof t?t:(0,v.Q)(null==m?void 0:m.value);return l.createElement(pe.ZP,a()({},e,{focus:!0,onChange:C,onClick:void 0,value:o}))}}],...A().compact(y.map((e=>ne({currentSimpleFormulaValueTokens:n,value:e,setCurrentTokens:k,contextStore:o,action:"replace",context:t,checkType:"single"}))))],P=void 0!==(null==d?void 0:d.header)?d.header:i()(z.Z,{style:{paddingBottom:0},title:g.formatMessage(G.s.genericMenuHeader)});let _;x.push({key:"textbox",render:e=>l.createElement(z.Z,e),items:T}),_=S.isMobile?{menuType:O.og.Modal,right:i()(H.DoneMenuText,{}),onClickRight:p}:{menuType:O.og.Popup,maxHeight:"50vh",width:260,footer:M&&i()(z.Z,{topBorder:!0},void 0,l.createElement($,e)),disableHeaderBorder:!0};const V={..._,...d,header:S.isMobile?null:P};return l.createElement(L.Z,V,i()(D.Z,{initialFocus:0,sections:x,type:D.i.Vertical}))}var ge=o(1302);function he(e){var t,o;window.__c={n:"ValuePickerMenuPersonArray"};const{context:n,contextStore:r,currentSimpleFormulaValueTokens:d,formulaTypecheckContextValues:p,menuProps:m,onChange:g,onClose:S,showClearButton:y,showInputMenuItem:f}=e,b=(0,s.Fy)(),C=(0,E.useIntl)(),w=(0,s.O7)(),{collectionStore:k,property:M}=n,[x,_]=(0,l.useState)(""),U=(0,c.qz)(void 0,K.Z),q=(0,T.M)(k,M),j=q(d,"first"),Y=(0,c.VK)((()=>{const e=k.getSchema()[n.property];return!(!e||!(0,u.en)(e))&&1===e.limit}),[k,n]),J=p.filter((e=>(0,V.uy)(e.type,{type:"person"}))),[X]=(0,B.r5)((async()=>({valueResults:x?(0,Z.ZP)(x,J,(e=>e.kind===F.yp.ContextValue?e.name:"")):J,userResults:(await I.Yu({environment:w,query:x,membersOnly:!1})).map((e=>e.id)).slice(0,20)})),[w,x,J],{debounce:I.vp}),ee=(0,l.useCallback)((()=>{_(""),U.setState({...U.state,focus:{section:0,indexLocal:0,indexGlobal:0}})}),[U]),te=(0,l.useCallback)((e=>{const t=q(e,"last");g({type:"simple",value:(0,h.iC)(t)}),ee()}),[g,ee,q]),ie=(0,c.VK)((()=>(0,R.formulaButtonsEnabled)()),[]),re=A().compact(j.map(((e,t)=>i()(P,{token:e,contextStore:r,disabled:!1,currentSimpleFormulaValueTokens:j,setCurrentTokens:te,context:n},t)))),ae=i()(N.Z,{focus:!b.isMobile||void 0,focusAfterAnimation:!0,format:N.Z.Format.FilterValue,tokens:re,placeholder:C.formatMessage(G.s.personSearchPlaceholder),onRemoveLastToken:()=>{te(j.slice(0,j.length-1))},onClearButtonClick:()=>{te([])},value:x,onChange:e=>{_(e.target.value)},dontShowBorderBottom:b.isAndroid,showClearButton:y}),le=void 0!==(null==m?void 0:m.header)?m.header:i()(z.Z,{style:{paddingBottom:0},title:C.formatMessage(G.s.genericMenuHeader)});let se;se=b.isMobile?{menuType:O.og.Modal,right:i()(H.DoneMenuText,{}),onClickRight:S}:{menuType:O.og.Popup,maxHeight:"50vh",width:260,footer:ie&&i()(z.Z,{topBorder:!0},void 0,l.createElement($,e)),disableHeaderBorder:!0};const ce={...se,...m,header:b.isMobile?null:le},de=Y?"single":"multi",ue=[...A().compact(((null===(t=X.value)||void 0===t?void 0:t.valueResults)||[]).map((e=>ne({currentSimpleFormulaValueTokens:j,value:e,setCurrentTokens:te,contextStore:r,action:"append",context:n,checkType:de,onCheckboxClick:()=>{Y&&ge.default.afterNextFlush((()=>{S()}))}})))),...A().compact(((null===(o=X.value)||void 0===o?void 0:o.userResults)||[]).map((e=>{const t=Boolean(j.find((t=>(0,h.S3)(t)&&(0,v.IW)(t)&&(0,v.zE)(t)===e))),o=(0,v.tE)(e),a=()=>{te(t?(0,h.Ck)(j,o):[...j,o]),Y&&ge.default.afterNextFlush((()=>{S()}))};return{key:e,render:e=>i()(oe,{token:o,contextStore:r,args:e,checkState:t,checkType:de,context:n,onCheckboxClick:a}),action:a}})))],pe=[];if(f){const e=Boolean(le);pe.push({key:"search-input",render:t=>l.createElement(z.Z,a()({},t,{style:{...e&&{paddingTop:0}}})),items:[{action:()=>{},key:"input",render:()=>ae}]})}if(ue.length>0){const e=Boolean(le)||f;pe.push({key:"users",render:t=>l.createElement(z.Z,a()({topBorder:e},t)),items:ue})}return l.createElement(L.Z,ce,X.error&&i()(z.Z,{},void 0,i()(W.Z,{title:l.createElement(E.FormattedMessage,G.s.somethingWentWrong)})),0===pe.length&&X.value&&i()(z.Z,{},void 0,i()(W.Z,{title:l.createElement(E.FormattedMessage,G.s.noResults)})),!X.value&&!X.error&&i()(z.Z,{},void 0,i()(Q.Z,{})),pe.length>0&&i()(D.Z,{type:D.i.Vertical,initialFocus:0,sections:pe,store:U}))}function Se(e){window.__c={n:"ValuePickerMenuSelect"};const{context:t,contextStore:o,currentSimpleFormulaValueTokens:n,formulaTypecheckContextValues:r,isSingle:d,menuProps:p,onChange:m,onClose:g,showClearButton:S,showInputMenuItem:y,type:v}=e,b=(0,s.Fy)(),C=(0,E.useIntl)(),[w,k]=(0,l.useState)(""),M=(0,c.qz)(void 0,K.Z),x=X.NW.createChildStore(o.context.parentRecordStore,v.collection),T=(0,c.VK)((()=>x.getSchema()[v.property]),[x,v]),_=(0,c.VK)((()=>T&&(0,u.gB)(T)?T.groups??[]:[]),[T]),B=(0,c.VK)((()=>T&&(0,u.t)(T)&&T.options||[]),[T]),I=r.filter((e=>(0,V.uy)(e.type,{type:"select",collection:v.collection,property:v.property}))),Q=(0,c.VK)((()=>({valueResults:w?(0,Z.ZP)(w,I,(e=>e.kind===F.yp.ContextValue?e.name:"")):I,selectResults:w?(0,Z.ZP)(w,B,(e=>e.value)):B})),[w,I,B]),U=(0,l.useCallback)((()=>{k(""),M.setState({...M.state,focus:{section:0,indexLocal:0,indexGlobal:0}})}),[M]),q=(0,l.useCallback)((e=>{m({type:"simple",value:d?(0,h.YD)(e[0]):(0,h.iC)(e)}),U()}),[m,U,d]),j=(0,c.VK)((()=>(0,R.formulaButtonsEnabled)()),[]),Y=A().compact(n.map(((e,r)=>i()(P,{token:e,contextStore:o,disabled:!1,currentSimpleFormulaValueTokens:n,setCurrentTokens:q,context:t},r)))),J=void 0!==(null==p?void 0:p.header)?p.header:i()(z.Z,{style:{paddingBottom:0},title:C.formatMessage(G.s.genericMenuHeader)}),ee=i()(N.Z,{focus:!b.isMobile||void 0,focusAfterAnimation:!0,format:N.Z.Format.FilterValue,tokens:Y,placeholder:C.formatMessage(G.s.searchPlaceHolder),onRemoveLastToken:()=>{q(n.slice(0,n.length-1))},onClearButtonClick:()=>{q([])},value:w,onChange:e=>{k(e.target.value)},dontShowBorderBottom:b.isAndroid,showClearButton:S}),te=[];if(y){const e=Boolean(J);te.push({key:"search-input",render:t=>l.createElement(z.Z,a()({},t,{style:{...e&&{paddingTop:0}}})),items:[{action:()=>{},key:"input",render:()=>ee}]})}const ie=Boolean(T&&(0,u.gB)(T)),re={automationContextValues:Q.valueResults??[],onClose:g,context:t,contextStore:o,currentSimpleFormulaValueTokens:n,isSingle:d,groupOptions:_,selectOptions:Q.selectResults??[],setCurrentTokens:q},ae=ie?function(e){const{automationContextValues:t,onClose:o,context:n,contextStore:r,currentSimpleFormulaValueTokens:s,isSingle:c,groupOptions:d,selectOptions:u,setCurrentTokens:p}=e,m=[],g=c?"single":"multi",S=A().compact(t.map((e=>ne({currentSimpleFormulaValueTokens:s,value:e,setCurrentTokens:p,contextStore:r,action:c?"replace":"append",context:n,checkType:g,onCheckboxClick:()=>{c&&ge.default.afterNextFlush((()=>{o()}))}}))));S.length>0&&m.push({key:"automation-variables",render:e=>l.createElement(z.Z,a()({title:l.createElement(E.FormattedMessage,G.s.valuesFromThisAutomation),topBorder:!0},e)),items:S});const y=new Map(u.map((e=>[e.id,e]))),v=d.map((e=>{const t=(e.optionIds??[]).map((e=>y.get(e))).filter(f.$K).map((e=>{const t=Boolean(s.find((t=>"string"==typeof t&&t===e.value))),a=()=>{p(c?t?[]:[e.value]:t?(0,h.Ck)(s,e.value):[...s,e.value]),c&&ge.default.afterNextFlush((()=>{o()}))};return{key:e.id,render:o=>i()(oe,{token:e.value,contextStore:r,args:o,checkState:t,checkType:g,context:n,onCheckboxClick:a}),action:a}}));return{key:e.id,items:t,render:t=>l.createElement(z.Z,a()({title:e.name,topBorder:!0},t))}})).filter((e=>e.items.length>0));return m.push(...v),m}(re):function(e){const{automationContextValues:t,onClose:o,context:n,contextStore:r,currentSimpleFormulaValueTokens:s,isSingle:c,selectOptions:d,setCurrentTokens:u}=e,p=[],m=c?"single":"multi",g=A().compact(t.map((e=>ne({currentSimpleFormulaValueTokens:s,value:e,setCurrentTokens:u,contextStore:r,action:c?"replace":"append",context:n,checkType:m,onCheckboxClick:()=>{c&&ge.default.afterNextFlush((()=>{o()}))}})))),S=A().compact(d.map((e=>{const t=Boolean(s.find((t=>"string"==typeof t&&t===e.value))),a=()=>{u(c?t?[]:[e.value]:t?(0,h.Ck)(s,e.value):[...s,e.value]),c&&ge.default.afterNextFlush((()=>{o()}))};return{key:e.id,render:o=>i()(oe,{token:e.value,contextStore:r,args:o,checkState:t,checkType:m,context:n,onCheckboxClick:a}),action:a}}))),y=[...g,...S];y.length>0&&p.push({key:"options",render:e=>l.createElement(z.Z,a()({topBorder:!0},e)),items:y});return p}(re);let le;te.push(...ae),le=b.isMobile?{menuType:O.og.Modal,right:i()(H.DoneMenuText,{}),onClickRight:g}:{menuType:O.og.Popup,maxHeight:"50vh",width:260,paddingTop:0,footer:j&&i()(z.Z,{topBorder:!0},void 0,l.createElement($,e)),disableHeaderBorder:!0};const se={...le,...p,header:b.isMobile?null:J};return l.createElement(L.Z,se,0===te.length&&i()(z.Z,{},void 0,i()(W.Z,{title:l.createElement(E.FormattedMessage,G.s.noResults)})),te.length>0&&i()(D.Z,{type:D.i.Vertical,initialFocus:0,sections:te,store:M}))}var ye=o(65187),ve=o(43250),fe=o(28992);function be(e){window.__c={n:"ValuePickerMenuText"};const{context:t,contextStore:o,currentSimpleFormulaValueTokens:n,formulaTypecheckContextValues:r,menuProps:d,onChange:u,onClose:p,value:m,disableEmojiCommands:g,disableFormattingAndMentions:S,disableMobileActionBar:y,disableTemplateVariableMentions:v}=e,f=(0,E.useIntl)(),{isMobile:b}=(0,s.Fy)(),C=(0,q.yK)((e=>({wrap:{background:e.inputBackground,borderRadius:4,boxShadow:e.inputBoxShadow,lineHeight:"24px",padding:1,marginBlock:b?12:0},text:{maxHeight:120,overflow:"auto",padding:"4px 10px"}})),[b]),w=(0,c.VK)((()=>(0,R.formulaButtonsEnabled)()),[]),k=(0,l.useMemo)((()=>r.filter((e=>"text"===e.type.type))),[r]),M=(0,l.useCallback)((e=>{u({type:"simple",value:e})}),[u]),x=(0,l.useCallback)((e=>{M(e),p()}),[M,p]),T=(0,l.useCallback)((e=>{const t=void 0!==e[0]?(0,h.YD)(e[0]):void 0;x(t)}),[x]),{store:P}=(0,R.useMockTextStore)({initialValue:null==m?void 0:m.value,onChange:M}),_=[],V=[...A().compact(k.map((e=>ne({currentSimpleFormulaValueTokens:n,value:e,setCurrentTokens:T,contextStore:o,action:"replace",context:t,checkType:"single"})))),...[{action:A().noop,key:"input",render:e=>l.createElement(fe.Z,a()({},e,{title:i()("div",{className:ve.Wh_,style:C.wrap},void 0,l.createElement(ye.Z,a()({disableComment:!0,disabled:!1,disableEmbedMenu:!0,disableEmojiCommands:g,disableMobileActionBar:y,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableSlashCommands:!0,disableTemplateVariableMentions:v},S?{disableDateMentions:!0,disableDateReminderMentions:!0,disableMentions:!0,disableStyleAnnotations:!0}:{},{onEnter:p,pasteBehavior:"inline",store:P,style:C.text})))}))}]],F=void 0!==(null==d?void 0:d.header)?d.header:i()(z.Z,{style:{paddingBottom:0},title:f.formatMessage(G.s.genericMenuHeader)});let Z;_.push({key:"textbox",render:e=>l.createElement(z.Z,e),items:V}),Z=b?{menuType:O.og.Modal,right:i()(H.DoneMenuText,{}),onClickRight:p}:{menuType:O.og.Popup,maxHeight:"50vh",width:260,footer:w&&i()(z.Z,{topBorder:!0},void 0,l.createElement($,e)),disableHeaderBorder:!0};const B={...Z,...d,header:b?null:F};return l.createElement(L.Z,B,i()(D.Z,{initialFocus:0,sections:_,type:D.i.Vertical}))}function Ce(e){const{showClearButton:t,showInputMenuItem:o,type:n}=e;return"text"===n.type?l.createElement(be,a()({},e,{type:n})):"number"===n.type?l.createElement(me,a()({},e,{type:n})):"checkbox"===n.type?l.createElement(re,a()({},e,{type:n})):"date"===n.type?l.createElement(ue,a()({},e,{type:n})):"person_array"===n.type?l.createElement(he,a()({},e,{showClearButton:t??!0,showInputMenuItem:o??!0,type:n})):"block_array"===n.type?l.createElement(ie,a()({},e,{showClearButton:t??!0,showInputMenuItem:o??!0,type:n})):"select"===n.type?l.createElement(Se,a()({},e,{showClearButton:t??!0,showInputMenuItem:o??!0,type:n,isSingle:!0})):"select_array"===n.type?l.createElement(Se,a()({},e,{showClearButton:t??!0,showInputMenuItem:o??!0,type:n,isSingle:!1})):void(0,f.t1)(n)}},75311:(e,t,o)=>{o.d(t,{M:()=>s,_:()=>c});var n=o(67294),i=o(81954),r=o(99036),a=o(40506),l=o(97880);function s(e,t){const o=(0,i.VK)((()=>{const o=e.getSchema()[t];let n;return o&&(0,r.en)(o)&&(n=o.limit),n}),[e,t]);return(0,n.useCallback)(((e,t)=>(0,l.$K)(o)?"first"===t?e.slice(0,o):"last"===t?e.slice(-o):void(0,l.t1)(t):e),[o])}function c(e){var t;const o=null===(t=e.collectionStore.getSchema())||void 0===t?void 0:t[e.property];return o&&"date"===o.type?{dateFormat:o.date_format||a.sF,timeFormat:o.time_format||a.c_}:{dateFormat:a.sF,timeFormat:a.c_}}},30387:(e,t,o)=>{o.d(t,{s:()=>n});const n=(0,o(5366).defineMessages)({back:{defaultMessage:"Back",id:"formulas.SimpleFormulaValuePicker.back"},valuesFromThisAutomation:{defaultMessage:"From this automation",id:"formulas.SimpleFormulaValuePicker.valuesFromThisAutomation"},pickADate:{defaultMessage:"Pick a date",id:"formulas.SimpleFormulaValuePicker.pickADate"},clear:{defaultMessage:"Clear",id:"formulas.SimpleFormulaValuePicker.clear"},unchecked:{defaultMessage:"Unchecked",id:"formulas.SimpleFormulaValuePicker.checkbox.unchecked"},checked:{defaultMessage:"Checked",id:"formulas.SimpleFormulaValuePicker.checkbox.checked"},checkboxOptions:{defaultMessage:"Checkbox options",id:"formulas.SimpleFormulaValuePicker.checkbox.sectionHeader"},searchPlaceHolder:{defaultMessage:"Select one or more options…",id:"formulas.SimpleFormulaValuePicker.select.searchPlaceholder"},selectOptionsSectionHeader:{defaultMessage:"Select an option",id:"formulas.SimpleFormulaValuePicker.select.sectionHeader"},noResults:{defaultMessage:"No results",id:"formulas.simpleValuePicker.noResults"},pageSearchPlaceholder:{defaultMessage:"Search for one or more pages…",id:"formulas.SimpleFormulaValuePicker.pages.searchPlaceholder"},pages:{defaultMessage:"Pages",id:"formulas.SimpleFormulaValuePicker.pages.sectionHeader"},somethingWentWrong:{defaultMessage:"Something went wrong.",id:"formulas.simpleValuePicker.errorMessage"},personSelect:{defaultMessage:"Select...",id:"formulas.SimpleFormulaValuePicker.chooseAValue"},personSearchPlaceholder:{defaultMessage:"Search for one or more people…",id:"formulas.SimpleFormulaValuePicker.people.searchPlaceholder"},customFormula:{defaultMessage:"Custom formula",id:"formulas.SimpleFormulaValuePicker.customFormula"},peopleInWorkspace:{defaultMessage:"People",id:"formulas.SimpleFormulaValuePicker.people.sectionHeader"},genericMenuHeader:{defaultMessage:"Set property to",id:"formulas.SimpleFormulaValuePicker.genericMenuHeader"}})},40863:(e,t,o)=>{o.d(t,{Ft:()=>m,YG:()=>g,y$:()=>S,du:()=>y,BO:()=>v,Lh:()=>w});o(57658);var n=o(96486),i=o.n(n),r=o(17126),a=o(30823),l=o(40506),s=o(53877),c=o(42875),d=o(55384),u=o(5366),p=o(28020);function m(e){const{collectionContextStore:t}=e,o=t.collectionViewStore();if(!o)return;const n=t.normalizedSchemaStore.state,i=o.getQuery(n);if(!i||!i.calendar_by)return;const r=t.dateRangeStart.state,a=t.dateRangeEnd.state,l=(0,s.hT)(r,(0,c.r)()),d=(0,s.hT)(a,(0,c.r)());return h({calendarBy:i.calendar_by,dateRangeStartDate:l,dateRangeEndDate:d})}function g(e){const{collectionContextStore:t,startOfDay:o}=e,n=t.collectionViewStore();if(!n)return;const i=t.normalizedSchemaStore.state,a=n.getQuery(i);if(!a||!a.calendar_by)return;const l=r.ou.fromMillis(o).endOf("day").valueOf(),d=(0,s.hT)(o,(0,c.r)()),u=(0,s.hT)(l,(0,c.r)());return h({calendarBy:a.calendar_by,dateRangeStartDate:d,dateRangeEndDate:u})}function h(e){const{dateRangeStartDate:t,dateRangeEndDate:o,calendarBy:n}=e;return{type:"results",filter:{operator:"and",filters:[{property:n,filter:{operator:"date_is_on_or_after",use_end:!0,value:{type:"exact",value:t}}},{property:n,filter:{operator:"date_is_on_or_before",value:{type:"exact",value:o}}}]},limit:5e3}}function S(e){const{collectionContextStore:t,results:o,getRecordValue:n,intl:r}=e,a=t.collectionViewStore(),d=t.normalizedQueryStore.state,u=t.normalizedSchemaStore.state,m=d?d.calendar_by:void 0,g=t.dateRangeStart.state,h=t.dateRangeEnd.state,S=p.AK.state,b=(0,c.r)(),C=t.getCurrentUserId();if(!(a&&d&&m&&u))return;const w=i().compact(o.map((e=>v({blockStore:e,calendarBy:m,schema:u,getRecordValue:n,userId:C,intl:r})))),k={};o.forEach(((e,t)=>{k[e.id]=t}));0===(d.sort||[]).length&&w.sort(((e,t)=>{const o=e.start.valueOf(),n=t.start.valueOf();if(o===n){return k[e.id]-k[t.id]}return o-n}));const M=(0,s.em)(g,S,b),x=(0,s.gQ)(h,S,b);let T=M;const P=[];do{const e=(0,s.gQ)(T.valueOf(),S,b),t={},o=w.filter((t=>(0,l.b8)(T.valueOf(),e.valueOf(),t.start.valueOf(),t.end?t.end.valueOf():void 0))).map((o=>{const{id:n,start:i,end:r,includeTime:a,timeZone:l}=o,{startColumn:s,columnCount:c}=y({startUnixTimestampMS:i.valueOf(),endUnixTimestampMS:r?r.valueOf():void 0,startOfWeekUnixTimestampMS:T.valueOf(),endOfWeekUnixTimestampMS:e.valueOf()}),d=f(s,c,t);return{id:n,start:i.valueOf(),end:r?r.valueOf():void 0,row:d,includeTime:a,timeZone:l}}));P.push({start:T.valueOf(),end:e.valueOf(),items:o}),T=(0,s.em)(T.plus({week:1}).plus({hour:25}).valueOf(),S,b)}while(T<x);return P}function y(e){const t=r.ou.fromMillis(e.startUnixTimestampMS),o=e.endUnixTimestampMS?r.ou.fromMillis(e.endUnixTimestampMS):void 0,n=r.ou.fromMillis(e.startOfWeekUnixTimestampMS),i=r.ou.fromMillis(e.endOfWeekUnixTimestampMS),a=t.startOf("day"),l=r.ou.max(n,a),s=l.diff(n,"days").get("days");let c=1;if(o){const e=o.endOf("day"),t=r.ou.min(i,e);c=Math.ceil(t.diff(l,"days").get("days"))}return{start:t,end:o,startOfWeek:n,endOfWeek:i,startColumn:s,columnCount:c}}function v(e){const{blockStore:t,calendarBy:o,schema:n,getRecordValue:i,intl:r,userId:l}=e,u=t.getModel();if(!u)return;const p=(0,a.FT)({property:o,schema:n,block:u,getRecordModel:d.om.fromGetRecordValueFn(i),userId:l,userTimeZone:(0,c.r)(),depth:0,intl:r,propertyMapping:void 0,visitedProperties:new Set,resultCache:{}}).next().value;if("date"!==p.type)return;const m=p.value,g=m&&(0,s.NK)(m,(0,c.r)());if(!m||!g)return;return{id:u.id,start:g.start,end:g.end,includeTime:"datetime"===m.type||"datetimerange"===m.type,timeZone:"datetime"===m.type||"datetimerange"===m.type?m.time_zone:void 0}}function f(e,t,o){let n=0;for(;;){let i=!1;for(let r=0;r<t;r++)b(o,e+r,n)&&(i=!0);if(!i)break;n++}for(let i=0;i<t;i++)C(o,e+i,n);return n}function b(e,t,o){return Boolean(e[o]&&e[o][t])}function C(e,t,o){e[o]||(e[o]={}),e[o][t]=!0}const w=(0,u.defineMessages)({week:{defaultMessage:"Week",id:"calendar.viewRanges.week"},month:{defaultMessage:"Month",id:"calendar.viewRanges.month"}})},30950:(e,t,o)=>{o.d(t,{a:()=>i});var n=o(67294);function i(e){return(0,n.useMemo)((()=>Boolean(e&&e.width<400)),[e])}},24457:(e,t,o)=>{o.d(t,{U:()=>a,F:()=>l});var n=o(480),i=o(81954),r=o(87279);function a(e){return e.device.isPhone||"actionSheet"===e.tabletBehavior&&e.device.isTablet?{menuType:r.og.ActionSheet}:{menuType:r.og.Popup,maxHeight:e.maxHeight,maxWidth:e.maxWidth,paddingTop:e.paddingTop,paddingBottom:e.paddingBottom,width:e.width,minWidth:e.minWidth}}function l(e){const t=(0,n.Fy)();return(0,i.VK)((()=>a({device:t,maxHeight:null==e?void 0:e.maxHeight,maxWidth:null==e?void 0:e.maxWidth,paddingTop:null==e?void 0:e.paddingTop,paddingBottom:null==e?void 0:e.paddingBottom,width:null==e?void 0:e.width,minWidth:null==e?void 0:e.minWidth,tabletBehavior:null==e?void 0:e.tabletBehavior})),[t,null==e?void 0:e.maxHeight,null==e?void 0:e.maxWidth,null==e?void 0:e.paddingTop,null==e?void 0:e.paddingBottom,null==e?void 0:e.width,null==e?void 0:e.minWidth,null==e?void 0:e.tabletBehavior])}},29502:(e,t,o)=>{o.d(t,{d:()=>a});var n=o(480),i=o(81954),r=o(44532);function a(e){const t=(0,n.Fy)();return(0,i.VK)((()=>t.isPhone||"slideUp"===(null==e?void 0:e.tabletBehavior)&&t.isTablet?r.kQ.SlideUp:r.kQ.Popup),[t,null==e?void 0:e.tabletBehavior])}},28267:(e,t,o)=>{o.d(t,{X:()=>r});var n=o(67294),i=o(77794);function r(e){const[t,o]=(0,n.useState)(void 0);return(0,n.useEffect)((()=>{if(!e.current)return;const t=new i.E;return t.observe(e.current),t.rect.addListener((e=>{o(e.state)})),()=>{t.destroy()}}),[e]),t}},68910:(e,t,o)=>{o.d(t,{L:()=>c});var n=o(96486),i=o.n(n),r=o(14577),a=o(78106),l=o(68626),s=o(23223);class c{constructor(e){this.context=void 0,this.compilationResultStore=new r.Z((()=>(0,s.pt)({context:this.context})),{useDeepEqual:!0,debugName:"compilationResultsStore"}),this.context=e}getAllContextValues(){const e=this.compilationResultStore.state;return l.x.isFail(e)?[]:i().clone(e.value.valueTypes)}getContextValuesForAction(e){const t=this.compilationResultStore.state;return l.x.isFail(t)?[]:t.value.actionInputValueTypes[e]??[]}getValidationErrorsForAction(e){const t=this.compilationResultStore.state;return l.x.isFail(t)?[]:t.value.actionValidationFailures[e]??[]}getContextValueForActionById(e,t){const o=this.getContextValuesForAction(e);return(0,a.vx)(o,t)}}},36857:(e,t,o)=>{o.d(t,{Z:()=>r});var n=o(49085);class i extends n.default{getInitialState(){return{pageId:void 0}}}const r=new i}}]);