"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[5741],{30038:(e,t,n)=>{n.r(t),n.d(t,{CompletionPopup:()=>Zt});var o=n(10434),i=n.n(o),a=n(23174),r=n.n(a),s=n(67294),l=n(18466),c=n(26263),d=n(1302),u=n(480),p=n(81954),m=n(24405),f=n(42875),g=n(66673),v=n(62965),y=n(44805),h=n(97880),w=n(5366),b=n(96323),k=n(50906),S=n(43132),C=n(73928),M=n(12359),I=n(3386),x=n(43250),P=n(99417),E=n(43455),_=n(16772),A=n(29798),Z=n(89626),T=n(16091),L=n(92022),F=n(53397),B=n(72897),R=n(32163),N=n(53953),D=n(63296),O=n(72495),H=n(34859);function V(e){window.__c={n:"ExitConfirmationDialog"};const{open:t,onCancelExit:n,onConfirmExit:o}=e,i=(0,s.useCallback)((()=>r()(U,{onConfirmExit:o,onCancelExit:n})),[o,n]);return r()(N.Z,{open:t,render:i,disableAnimation:!0,onDismiss:n})}function U(e){window.__c={n:"ExitConfirmationDialogContent"};const t=(0,m.yK)((e=>({wrapper:{padding:24,display:"flex",flexDirection:"column",minWidth:280},question:{fontWeight:500,maxWidth:240,textAlign:"center",marginTop:8,marginBottom:8,lineHeight:"1.2em"},icon:{width:32,height:32,alignSelf:"center",paddingTop:8,fill:e.accentColors.purple[400]}})),[]),n={width:"100%",marginTop:8},o=[{key:"confirm",render:e=>s.createElement(D.Z,i()({style:n},e),r()(w.FormattedMessage,{id:"completions.ExitConfirmationDialog.confirmExit",defaultMessage:"Discard"})),action:e.onConfirmExit},{key:"cancel",render:e=>s.createElement(D.Z,i()({style:n},e),r()(w.FormattedMessage,{id:"completions.ExitConfirmationDialog.cancelExit",defaultMessage:"Cancel"})),action:e.onCancelExit}];return r()(B.Z,{capture:!0,preventType:H.Z.All},void 0,r()("div",{style:t.wrapper},void 0,F.Z.sparkles(t.icon),r()("p",{style:t.question},void 0,r()(w.FormattedMessage,{id:"completions.ExitConfirmationDialog.question",defaultMessage:"Do you want to discard the AI response?"})),r()(R.Z,{type:R.i.Vertical,initialFocus:0,sections:[{key:"dialog",render:e=>s.createElement(O.Z,i()({topBorder:!1,disableMobileBorders:!0},e)),items:o}]})))}var K=n(10534),W=n(62967),z=n(48019),$=n(73063),J=n(68894),q=n(78140),G=n(86825),j=n(64369),Y=n(33929),Q=n(87279),X=n(79315),ee=n(71184);const te=(0,w.defineMessages)({save:{id:"ai.favorites.save",defaultMessage:"Save changes"},delete:{id:"ai.favorites.delete",defaultMessage:"Delete"},runImmediately:{id:"ai.favorites.runImmediately",defaultMessage:"Run immediately"},actionNameLabel:{id:"ai.favorites.actionNameLabel",defaultMessage:"Action name"},cancelAndGoBack:{id:"ai.favorites.cancelAndGoBack",defaultMessage:"Cancel and go back"}});function ne(e){window.__c={n:"FavoriteEditorMenuPopupContent"};const{state:t,context:n,sessionId:o}=e,a=(0,w.useIntl)(),l=(0,u.O7)(),c=(0,s.useMemo)((()=>new A.Z),[]),d=(0,W.PH)({key:"input",analyticsName:"TODO",displayName:te.save,validators:[],closeParentMenu:!1,render:()=>r()(O.Z,{isInput:!0,style:{marginTop:0}},void 0,r()(J.ZP,{value:t.current.name,onChange:e=>{t.set({...t.current,name:e.target.value}),c.setState({focus:{section:0,indexLocal:1,indexGlobal:1}})},placeholder:Y.default.formatMessage(te.actionNameLabel),focusInitial:!0})),action(e,t){}}),p=[(0,W.$J)({key:"favorite options section",render:e=>s.createElement(O.Z,e),actions:[d,(0,W.PH)({key:"runImmediately",analyticsName:"TODO",displayName:te.runImmediately,validators:[],render:(e,n,o)=>{let{blocks:a,environment:r}=n;const l=Boolean(t.current.executeImmediately);return s.createElement(G.Z,i()({},e,{title:Y.default.formatMessage(te.runImmediately),on:l}))},closeParentMenu:!1,action(e,n){t.set({...t.current,executeImmediately:!t.current.executeImmediately})}})]}),(0,W.$J)({actions:[(0,W.PH)({key:"save",analyticsName:"TODO",displayName:te.save,validators:[],svg:F.Z.save,closeParentMenu:!1,action(e,n){(0,K.m5)({state:t,environment:l,sessionId:o})}})],key:"actions",render:e=>s.createElement(O.Z,e)}),(0,W.$J)({key:"delete action section",render:e=>s.createElement(O.Z,e),actions:[(0,W.PH)({key:"delete",analyticsName:"TODO",displayName:te.delete,validators:[],svg:F.Z.trash,closeParentMenu:!1,action(e,n){const{currentUserSettingsStore:i}=X.default.state;i&&(M.createAndCommit({userAction:"ai.favoriteEditorPopup.delete",environment:l,perform(e){(0,ee.QC)(t.current,i,e)}}),t.clear(),k.VoR(l,{type:"delete",session_id:o,gtm_favorite_id:t.current.gtmFavoriteId}))}})]})],m=(0,s.useCallback)((()=>{}),[]);return r()("div",{style:{display:"flex",flexDirection:"column"}},void 0,r()("div",{style:{display:"flex",alignItems:"center",padding:"8px 8px 0 8px"}},void 0,r()($.Z,{icon:F.Z.backward,onClick:()=>{(0,K.ny)({environment:l,state:t})},ariaLabel:a.formatMessage(te.cancelAndGoBack)}),r()(j.Z,{isSecondaryColor:!0,isSmall:!0,style:{fontWeight:700}},void 0,r()(w.FormattedMessage,{id:"ai.favorites.saveHeader",defaultMessage:"Save AI action"}))),r()(q.Z,{menuType:Q.og.Popup,width:"100%",maxHeight:"min(40vh, 320px)",minHeight:"100%"},void 0,r()(z.Z,{menuListStore:c,sections:p,onAccept:m,initialFocus:0,context:n})))}var oe=n(57819),ie=n(10161);const ae=(0,w.defineMessages)({undoAriaLabel:{defaultMessage:"Go to previous AI response",id:"id.completions.undoAriaLabel"},redoAriaLabel:{defaultMessage:"Go to next AI response",id:"id.completions.redoAriaLabel"},historyLabel:{defaultMessage:"{currentRevision} of {totalRevisions}",id:"id.completions.historyLabel"}}),re={display:"flex",alignItems:"center",marginLeft:-2,marginRight:-2},se={width:20,height:20,marginLeft:2,marginRight:2};function le(e){window.__c={n:"CompletionHistory"};const{onUndo:t,onRedo:n,historyLabel:o}=e,i=(0,w.useIntl)();return t||n?r()("div",{style:re},void 0,r()($.Z,{icon:F.Z.chevronLeft,ariaLabel:i.formatMessage(ae.undoAriaLabel),disabled:!t,onClick:t,style:se}),r()(j.Z,{isSmall:!0,isSecondaryColor:!0,style:{fontVariantNumeric:"tabular-nums"}},void 0,o),r()($.Z,{icon:F.Z.chevronRight,ariaLabel:i.formatMessage(ae.redoAriaLabel),disabled:!n,onClick:n,style:se})):null}const ce={onUndo:void 0,onRedo:void 0,historyLabel:void 0};function de(e,t){const n=_.default.state;if("completionPopup"!==n.type||"results"!==n.stage)return;const{sessionId:o}=n,i=(0,P.xM)(n);k.BpO(e,{session_id:o,inference_id:i.inferenceId,type:t})}var ue=n(56863),pe=n(81598),me=n(82375),fe=n(11066),ge=n(1743),ve=n(74194);const ye=(0,w.defineMessages)({promptLabel:{defaultMessage:"Prompt for action",id:"ai.favoritePromptEditor.promptLabel"}});function he(e,t){e.set({...e.current,action:{...e.current.action,prompt:t}})}function we(e){window.__c={n:"FavoritePromptEditorContent"};const{state:t,inputRef:n,sessionId:o}=e,i=(0,u.O7)(),a=(0,oe.bJ)(),l=(0,w.useIntl)().formatMessage(ye.promptLabel);return r()(ge.Z,{capture:!0,allowMenuList:!1,allowEsc:!0},void 0,s.createElement(ve.Z,{ref:n,format:ve.Z.Format.Transparent,placeholder:l,selectAll:!0,value:t.current.action.prompt,textarea:!0,textareaSubmitOnEnter:!1,autosize:!0,style:{minHeight:28,paddingTop:4,paddingBottom:4},onChange:e=>he(t,e.target.value),onKeyDown:e=>{"Enter"===e.key&&he(t,`${t.current.action.prompt}\n`)},focusInitial:!1}),r()("div",{style:a.inputActions},void 0,r()(fe.Z,{style:a.purpleButton,onClick:()=>(0,K.m5)({state:t,environment:i,sessionId:o})},void 0,r()(w.FormattedMessage,{defaultMessage:"Done",id:"ai.favoritePromptEditor.done"}))))}var be=n(61519);function ke(e){window.__c={n:"PromptOrActionInput"};const{query:t,setQuery:n,onDismiss:o,onSubmit:i,inputRef:a,submitOnEnter:l,inputPlaceholder:c,children:d}=e,[u,p]=(0,s.useState)(void 0);return r()(ge.Z,{capture:!0,allowMenuList:!1,allowEsc:!0},void 0,s.createElement(ve.Z,{ref:a,format:ve.Z.Format.Transparent,placeholder:c,selectAll:!0,value:t,textarea:!0,textareaSubmitOnEnter:!0,autosize:!0,style:{minHeight:28,paddingTop:4,paddingBottom:4},onSubmit:e=>{t&&l&&(e.stopPropagation(),null==i||i())},onChange:e=>{n(e.target.value)},onKeyUp:e=>{"Backspace"===e.key&&(""===u&&o(),p(void 0))},onKeyDown:e=>{"Backspace"===e.key&&void 0===u&&p(t)},focusInitial:!0}),d)}var Se=n(58261),Ce=n(58032);function Me(e){window.__c={n:"SubmitAIPromptButton"};const{onSubmit:t,canSend:n}=e,o=(0,oe.bJ)(),a=(0,u.O7)(),l=(0,p.VK)((()=>a.device.isPhone),[a]);return r()(Ce.Z,{renderTooltip:()=>r()("div",{},void 0,r()(w.FormattedMessage,{defaultMessage:"Send to AI",id:"completions.CompletionMenuActionBar.sendTooltip"}),r()(Se.Z,{style:o.keyboardShortcutInverted,name:"enter"})),placement:Ce.Z.Placement.Bottom,render:e=>s.createElement($.Z,i()({icon:F.Z.sendArrow,onClick:t,isPurple:n,disabled:!n,iconStyle:{height:l?24:20,width:l?24:20},style:{pointerEvents:"auto",height:l?24:20,width:l?24:20}},e))})}const Ie=(0,w.defineMessages)({followUpInputPlaceholder:{id:"AlternativeCommandPalette.followUp.inputPlaceholder",defaultMessage:"Tell AI what to do next…"}}),xe={padding:"8px 10px 8px 14px"};function Pe(e){window.__c={n:"CompletionFinishedContent"};const t=(0,oe.bJ)(),n=(0,w.useIntl)(),o=0===e.query.trim().length,a=(0,u.O7)(),l=(0,p.VK)((()=>{if(!(0,P.E8)(a.device)||!(0,P.Gw)())return!1;const e=me.XN.state;return Boolean(e&&e.previewingStep)}),[a]);return s.createElement(ke,i()({},e,{inputPlaceholder:n.formatMessage(Ie.followUpInputPlaceholder)},l&&{onSubmit:void 0}),r()("div",{style:t.inputActions},void 0,r()(Me,{onSubmit:e.onSubmit,canSend:!o&&!l}),(e.onUndo||e.onRedo)&&s.createElement(s.Fragment,null,r()(be.Z,{vertical:!0,size:1,style:xe}),s.createElement(le,e))))}var Ee=n(64921),_e=n(91839);function Ae(e){window.__c={n:"CompletionInProgressContent"};const{onStop:t,onRetry:n}=e,o=(0,oe.bJ)(),i=(0,u.O7)().device,a=i.isMobileNative&&i.isIOS;return r()(I.Z,{capture:!0,onEnter:()=>{t()},onEsc:()=>{t()},onKeypress:e=>{e.metaKey||"r"!==e.key||n()}},void 0,r()("div",{style:o.writingLabel},void 0,r()(w.FormattedMessage,{id:"AlternativeCompletionsPopupContent.writing",defaultMessage:"AI is writing"}),r()(_e.Z,{style:o.loadingDots})),!a&&r()(Ee.Z,{style:o.lightweightButton,onClick:n},void 0,r()(w.FormattedMessage,{id:"AlternativeCompletionsPopupContent.tryAgain.label",defaultMessage:"Try again"}),r()("span",{style:o.keyboardShortcut},void 0,r()(w.FormattedMessage,{id:"AlternativeCompletionsPopupContent.startOver.shortcut",defaultMessage:"r"}))),r()(Ee.Z,{style:o.lightweightButton,onClick:t},void 0,r()(w.FormattedMessage,a?{id:"AlternativeCompletionsPopupContent.cancel.label",defaultMessage:"Cancel"}:{id:"AlternativeCompletionsPopupContent.stop.label",defaultMessage:"Stop"}),r()("span",{style:o.keyboardShortcut},void 0,r()(w.FormattedMessage,{id:"AlternativeCompletionsPopupContent.stop.shortcut",defaultMessage:"esc"}))))}var Ze=n(96486),Te=n.n(Ze),Le=n(61134),Fe=n(18647),Be=n(17748);function Re(e){window.__c={n:"CompletionPreview"};const{temporaryListStore:t,isLoading:n}=e,o=(0,u.O7)(),i=(0,s.useRef)(null),a=null==i?void 0:i.current,l=null==a?void 0:a.getStore(),c=(0,p.VK)((()=>o.device.isPhone),[o]),d=(0,oe.jq)({resetWhenScrolledToBottom:!0,areWeLoading:n,scrollerStore:l});(0,s.useEffect)((()=>{a&&(d?Ne.cancel():Ne(a))}),[a,t,d]);const m={scroller:{maxHeight:c?"min(15vh, 200px)":"min(40vh, 320px)",width:"100%"}};return r()(s.Fragment,{},void 0,s.createElement(Fe.Z,{type:Fe.Z.OverflowType.Y,style:m.scroller,ref:i},r()(Le.O,{displayName:"CompletionPopupContent",disabled:!0},void 0,r()(Be.Z,{store:t,disabled:!0,disableCommentMenu:!0,disableHoverMenu:!0,disableDrag:!0}))))}const Ne=Te().debounce((e=>{e.scrollToBottom({animate:!0})}),60);var De=n(63594),Oe=n(42402);function He(){window.__c={n:"AiWarningNotice"};const e=(0,s.useCallback)((()=>{window.open("/help/guides/using-notion-ai#what-are-the-current-limitations-of-notion-ai")}),[]),t=(0,m.yK)((e=>({icon:{width:12,height:12,fill:e.lightIconColor,marginLeft:2},link:{color:e.lightTextColor,fontWeight:500}})),[]);return s.createElement(s.Fragment,null,F.Z.warning(t.icon),r()(j.Z,{isSecondaryColor:!0,isSmall:!0},void 0,r()(w.FormattedMessage,{id:"completions.AiWarning.warning",defaultMessage:"AI responses can be inaccurate or misleading."})),r()(j.Z,{isSmall:!0},void 0,r()(Oe.Z,{onClick:e,style:t.link,disableHover:!0,disableUnderline:!0},void 0,r()(w.FormattedMessage,{id:"completions.AiWarning.learnMore",defaultMessage:"Learn more"}))))}var Ve=n(935),Ue=n(99498),Ke=n(1865),We=n(21115),ze=n(8323),$e=n(78291);function Je(){window.__c={n:"UpsellNotice"};const e=(0,u.O7)(),t=(0,p.VK)((()=>e.device.isMobile),[e]),n=(0,p.VK)((()=>{const e=$e.default.state.data;return We.GJ(e)}),[]),o=(0,s.useCallback)((()=>{t?Ue.k2():Ke.y(e,{from:"ai_upsell_notice",for:(0,ze.zt)(),addOnFeature:"ai"})}),[e,t]),i=(0,m.yK)((e=>({upsellIcon:{width:14,height:14,fill:e.lightIconColor},upsellLink:{color:e.blueColor,fontWeight:500}})),[]);return s.createElement(s.Fragment,null,F.Z.giftOutline(i.upsellIcon),r()(j.Z,{isSecondaryColor:!0,isSmall:!0},void 0,r()(w.FormattedMessage,{id:"UpsellNotice.label",defaultMessage:"All free AI responses have been used for this workspace."}),!n&&s.createElement(s.Fragment,null," ",r()(w.FormattedMessage,{id:"UpsellNotice.contactWorkspaceOwner.label",defaultMessage:"Contact your workspace owner to add Notion AI."}))),n&&s.createElement(s.Fragment,null,r()(j.Z,{isSmall:!0},void 0,r()(Oe.Z,{onClick:o,style:i.upsellLink,disableHover:!0,disableUnderline:!0},void 0,r()(w.FormattedMessage,{id:"UpsellNotice.link.label",defaultMessage:"Go unlimited"})))))}function qe(e){window.__c={n:"MainPopupFooter"};const{state:t}=e,n=(0,u.O7)(),o=(0,p.VK)((()=>n.device.isPhone),[n]),i=(0,m.yK)((e=>({wrapper:{background:"dark"===e.mode?e.accentColors.gray[100]:e.accentColors.gray[30],display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0 12px",borderTop:`1px solid ${e.lightDividerColor}`,gap:8,color:e.lightTextColor,fontSize:12,minHeight:36},noticeContent:{display:"flex",alignItems:"center",gap:8},actionContent:{display:"flex",alignItems:"center"}})),[]),a=(0,p.VK)((()=>!De.Z.state),[]);if(o)return null;let s,l;return a&&(s=r()(Je,{})),"results"!==t.stage||t.loading||(s=s??r()(He,{}),l=r()(Ve.u,{revision:(0,P.xM)(t)})),s?r()("div",{style:i.wrapper},void 0,r()("div",{style:i.noticeContent},void 0,s),l&&r()("div",{style:i.actionContent},void 0,l)):null}const Ge=(0,w.defineMessages)({writeInputPlaceholder:{defaultMessage:"Ask AI to write anything…",id:"completions.PromptMenu.alternativeUiWriteInputPlaceholder"},editInputPlaceholder:{defaultMessage:"Ask AI to edit or generate…",id:"completions.PromptMenu.alternativeUiEditInputPlaceholder"}});function je(e){window.__c={n:"MainPopupContent"};const{state:t,onDismiss:n,onCompletionRetry:o,onCompletionStop:a,temporaryListStore:l,favoriteEditingState:c}=e,d=(0,s.useRef)(null);(0,s.useEffect)((()=>{ue.w()}),[]);const f=(0,u.O7)(),g=(0,p.VK)((()=>f.device.isPhone),[f]),v=(0,p.VK)((()=>X.default.state.currentSpaceStore),[]),y=(0,p.VK)((()=>{if(!(0,P.E8)(f.device))return;const e=me.XN.state;return e?e.temporaryClientSteps.filter((e=>"assistantChat"===e.type||"assistantLoadPage"===e.type||"assistantSearch"===e.type)):void 0}),[f],{useDeepEqual:!0}),h=(0,m.yK)((e=>({icon:{height:18,width:18,paddingLeft:g?0:4,marginLeft:g?-4:void 0,fill:"dark"===e.mode?e.accentColors.purple[600]:e.accentColors.purple[300]},outer:{width:"100%",minHeight:g?44:36,padding:g?"2px 16px 2px 16px":"2px 12px 2px 8px",display:"flex",flexDirection:"column",justifyContent:"center",gap:2,fontSize:g?16:14}})),[g]),w=r()("div",{style:{height:36,alignItems:"center",display:"flex"}},void 0,F.Z.sparkles(h.icon));if("active"===c.type)return s.createElement("div",{style:h.outer,ref:d},r()("div",{style:{display:"flex",gap:8,width:"100%"}},void 0,w,r()(we,{state:c,inputRef:e.inputRef,sessionId:t.sessionId})));const b=s.createElement("div",{style:h.outer,ref:d},l&&r()(Re,{temporaryListStore:l,isLoading:"results"===t.stage&&t.loading}),y&&v&&s.createElement(s.Fragment,null,y.map(((e,t)=>r()(pe.qS,{clientStep:e,parentStore:v,parentSpaceId:v.id},t)))),r()("div",{style:{display:"flex",gap:8,width:"100%"}},void 0,w,"initialPrompt"===t.stage||"initialPromptForAIBlock"===t.stage?s.createElement(Ye,i()({},e,{paletteMode:(0,oe.rR)(t)})):t.loading?r()(Ae,{onDismiss:n,state:t,onRetry:o,onStop:a}):s.createElement(Pe,e)));return s.createElement(s.Fragment,null,b,r()(qe,{state:t}))}function Ye(e){window.__c={n:"MainPopupInitialPromptContent"};const{query:t,onSubmit:n,paletteMode:o}=e,a=(0,oe.bJ)(),l=(0,w.useIntl)(),c="edit"===o?l.formatMessage(Ge.editInputPlaceholder):l.formatMessage(Ge.writeInputPlaceholder),d=t.trim().length>0;return s.createElement(ke,i()({},e,{inputPlaceholder:c}),r()("div",{style:a.inputActions},void 0,r()(Me,{onSubmit:n,canSend:d})))}n(30541),n(57658);var Qe=n(8848),Xe=n(68204),et=(n(21703),n(36769)),tt=n(37181),nt=n(30793);const ot="recent-actions",it=(0,w.defineMessages)({recentActions:{defaultMessage:"Recents",id:"commandPalette.recentActions.title"},more:{defaultMessage:"See more",id:"commandPalette.recentActions.more"},removeFromMenu:{defaultMessage:"Remove this action from the menu",id:"commandPalette.recentActions.removeFromMenu"},addToFavorites:{defaultMessage:"Add to favorites",id:"commandPalette.recentActions.addToFavorites"}});function at(e){window.__c={n:"FavoriteButton"};const{focused:t,recentAction:n,state:o,intl:i,sessionId:a}=e,s=(0,u.O7)();return r()($.Z,{style:{visibility:t?"visible":"hidden",width:18,height:18},onClick:()=>{k.VoR(s,{type:"create_from_recent",session_id:a,gtm_favorite_id:void 0}),o.set((0,ee.kg)(n))},icon:F.Z.star,ariaLabel:i.formatMessage(it.addToFavorites)})}function rt(){window.__c={n:"MoreIcon"};const e=(0,m.Fg)();return F.Z.dots({width:12,fill:e.mediumIconColor,marginLeft:2,marginRight:2})}function st(e){if("completionPopup"!==e.type||"results"!==e.stage)return;const t=(0,P.xM)(e);return"initial"===t.type?t:void 0}(0,et.exposeDebugEnvironmentValue)("resetRecentAndFavoriteAIActions",(e=>()=>{const{currentUserSettingsStore:t}=X.default.state;if(!t)throw new Error("currentUserSettingsStore not found");M.createAndCommit({userAction:"recentActions.debugging.resetRecentAndFavoriteAIActions",environment:e,perform(e){tt.d2({userSettingsStore:t,transaction:e,data:{recent_ai_actions:[],favorite_ai_actions:[]}})}})}));const lt="This string should never show up in analytics",ct=(0,w.defineMessages)({clickToEditAndRetry:{id:"completions.CompletionMenuActionBar.tryAgain.clickToEditAndRetry",defaultMessage:"Click to edit prompt and retry"},clickToRetry:{id:"completions.CompletionMenuActionBar.tryAgain.clickToRetry",defaultMessage:"Click to retry"},tryAgain:{id:"completions.CompletionMenuActionBar.tryAgain",defaultMessage:"Try again"},delete:{id:"completions.CompletionMenuActionBar.delete",defaultMessage:"Discard"},close:{id:"completions.CompletionMenuActionBar.close",defaultMessage:"Close"},keep:{id:"completions.CompletionMenuActionBar.done",defaultMessage:"Done"},replace:{id:"completions.CompletionMenuActionBar.replace",defaultMessage:"Replace selection"},insert:{id:"completions.CompletionMenuActionBar.insert",defaultMessage:"Insert below"},addToFavorites:{id:"completions.CompletionMenuActionBar.addToFavorites",defaultMessage:"Add to favorites"}});function dt(e){const{filter:t,state:n,from:o,favoriteEditingState:i,onUpdatePromptState:a,onImprove:l,context:c,intl:d,environment:u,completionResultInfo:p}=e,m=(0,P.E8)(u.device);let f;switch(n.stage){case"initialPrompt":case"initialPromptForAIBlock":f=function(e){const{state:t,environment:n,intl:o,filter:i,from:a,onUpdatePromptState:l,favoriteEditingState:c,type:d}=e,{currentUserSettingsStore:u}=X.default.state;if((0,P.E8)(n.device))return[];const p=u?function(e,t,n,o,i){const a=i.filterOut.toLocaleLowerCase().trim(),l=(0,nt.pz)(n),c=[];let d=0;for(const s of l){const l="recentAction."+d++,u=a=>r()("div",{style:{display:"flex"}},void 0,r()($.Z,{style:{visibility:a.focused?"visible":"hidden",width:18,height:18},onClick:()=>M.createAndCommit({userAction:"ai.recentActions.renderRemoveButton",environment:o,perform(e){(0,nt.lG)(s,n,e)}}),icon:F.Z.closeSmall,ariaLabel:t.formatMessage(it.removeFromMenu)}),"inactive"===i.favoriteEditingState.type?r()(at,{sessionId:e.sessionId,state:i.favoriteEditingState,focused:a.focused,recentAction:s,intl:t}):r()(b.xj,{type:"updatePrompt",focused:a.focused}));let p;if(s.prompt.toLocaleLowerCase().trim()!==a){switch(s.type){case"helpMeEdit":"initialPrompt"!==e.stage||"blockSelection"!==e.context.type&&"textSelection"!==e.context.type||(p=(0,b.cK)({key:l,name:s.prompt,analyticsName:"recentAction",right:u,onUpdatePromptState:i.onUpdatePromptState,renderTooltip:W.zz}));break;case"helpMeWrite":"initialPromptForAIBlock"!==e.stage&&"cursor"!==e.context.type||(p=(0,b.cK)({key:l,name:s.prompt,analyticsName:"recentAction",right:u,onUpdatePromptState:i.onUpdatePromptState,renderTooltip:W.zz}));break;default:(0,h.t1)(s)}p&&c.push(p)}}const u=c.slice(0,3),p=c.slice(3);if(p.length){const e=(0,W.$J)({key:"more recent actions",render:e=>s.createElement(O.Z,e),actions:p}),t=(0,W.MV)({key:"more recent actions extension",displayName:it.more,analyticsName:"Completions - more",validators:[],svg:()=>r()(rt,{}),subActions:()=>[e],collapseSubActionsIntoParent:!0,width:400});u.push(t)}return[(0,W.$J)({key:ot,title:it.recentActions,render:e=>s.createElement(O.Z,e),actions:u})]}(t,o,u,n,{onUpdatePromptState:l,favoriteEditingState:c,filterOut:i}):[],m=[...u&&"disabled"!==c.type?(0,K.Mi)(n,t,o,u,{onUpdatePromptState:l,favoriteEditingState:c,filterOut:i}):[]];"initialPromptForAIBlock"===t.stage?m.push((0,b.xI)({store:t.store,from:a})):"aiBlock"!==d&&m.push(...(0,b.LK)({from:a,type:d,onUpdatePromptState:l}));return m.push(...p),m}({state:n,environment:u,intl:d,filter:t,from:o,context:c,favoriteEditingState:i,onUpdatePromptState:a,type:(0,oe.VZ)(n)});break;case"results":f=n.loading?[]:function(e){const{environment:t,state:n,defaultAction:o,isAssistant:i,closeOrDiscard:a,favoriteEditingState:l}=e,c={key:"insert",analyticsName:lt,displayName:ct.insert,validators:[],closeParentMenu:!0,svg:F.Z.insertDown,action(){e.onInsert()}},d={key:"delete",analyticsName:lt,displayName:ct.delete,validators:[],closeParentMenu:!0,svg:F.Z.trash,action(){e.onCancel()}},u=function(e){const{state:t,onRetry:n}=e;if("results"!==t.stage)return;return{key:"tryAgain",analyticsName:lt,displayName:ct.tryAgain,validators:[],closeParentMenu:!0,svg:F.Z.undo,renderTooltip:()=>r()(pt,{state:t}),action(){n()}}}({...e}),p=[],m=F.Z.thinCheck;if(i)return[(0,W.$J)({key:"main",render:e=>s.createElement(O.Z,e),actions:[(0,W.PH)({key:"keep",analyticsName:lt,displayName:ct.keep,validators:[],closeParentMenu:!0,svg:m,action(){e.onAccept({exitType:"accept"})}})]})];"accept"===o?p.push((0,W.PH)({key:"keep",analyticsName:lt,displayName:ct.keep,validators:[],closeParentMenu:!0,svg:m,action(){e.onAccept({exitType:"accept"})}})):"replace"===o?p.push((0,W.PH)({key:"replace",analyticsName:lt,displayName:ct.replace,validators:[],closeParentMenu:!0,svg:m,action(){e.onReplace()}}),(0,W.PH)(c)):"insert"===o?p.push((0,W.PH)({...c,svg:m})):(0,h.t1)(o);p.push((0,W.PH)({key:"continueWriting",analyticsName:lt,displayName:P.Dr.continueWriting,validators:[],closeParentMenu:!0,svg:mt(F.Z.pencil),action(){e.onImprove({type:"continueWriting"})}}),(0,W.PH)({key:"makeLonger",analyticsName:lt,displayName:P.Dr.makeLonger,validators:[],closeParentMenu:!0,svg:mt(F.Z.aiMakeLonger),action(){e.onImprove({type:"makeLonger"})}}),(0,W.PH)({key:"addToFavorites",analyticsName:lt,displayName:ct.addToFavorites,validators:[()=>Boolean(ft(n,l))],closeParentMenu:!0,svg:mt(F.Z.star),action(){const e=ft(n,l);if(!e)return;const o=(0,ee.kg)(e.recentAction);e.favoriteEditingState.set(o),k.VoR(t,{type:"create_from_completion",session_id:n.sessionId,gtm_favorite_id:void 0})}}),(0,W.PH)({key:"convertToAiBlock",analyticsName:lt,displayName:P.Dr.insertAIBlock,validators:[()=>{if("completionPopup"!==n.type||"results"!==n.stage||"cursor"!==n.context.type)return!1;const e=st(n);return!!e&&Boolean(P.Xi[e.clientPrompt.key])}],closeParentMenu:!0,svg:mt(F.Z.sparkles),action(){e.onAccept({exitType:"convert_to_ai_block"})}}));const f=[u?(0,W.PH)(u):void 0,"discard"===a?(0,W.PH)(d):(0,W.PH)({key:"close",analyticsName:lt,displayName:ct.close,validators:[],closeParentMenu:!0,svg:F.Z.close,shortcuts:["esc"],action(){e.onAccept({exitType:"click_outside_window_accept",selectInsertion:!0})}})],g=(0,W.$J)({key:"main",render:e=>s.createElement(O.Z,e),actions:p}),v=(0,W.$J)({key:"final",render:e=>s.createElement(O.Z,e),actions:f.filter(h.$K)});return[g,v]}({environment:u,state:n,onImprove:l,closeOrDiscard:"cursor"===n.context.type?"close":"discard",isAssistant:m,favoriteEditingState:i,...p});break;default:(0,h.t1)(n)}let g=(0,Xe.sG)({sections:f,context:c,query:t});if(1===g.length&&g[0].key===ot){const e=g[0].actions.slice();(0,P.LN)(t,d)||e.unshift((0,b.sH)({customPrompt:t,execute:p.onSubmit})),g=[(0,W.$J)({key:"actions",render:e=>s.createElement(O.Z,e),actions:e})]}else(function(e){let t=!1;for(const n of e)if(n.key===K.YX)t=!0;else if(n.key!==ot)return!1;return t})(g)&&g.push((0,W.$J)({key:"literal-actions",render:e=>s.createElement(O.Z,e),actions:[(0,b.sH)({customPrompt:t,execute:p.onSubmit})]}));return g}function ut(e,t){switch(t.type){case"continueWriting":return e.formatMessage(P.Dr.continueWriting);case"makeLonger":return e.formatMessage(P.Dr.makeLonger);case"helpMeEdit":return t.prompt}}function pt(e){window.__c={n:"TryAgainTooltip"};const{state:t}=e,n=(0,m.yK)((e=>({hint:{color:e.mediumInvertedTextColor}})),[]),o=(0,P.xM)(t),i=(0,w.useIntl)();let a,l=ct.clickToEditAndRetry;if("initial"===o.type)if(C.mN(o))a=(0,P.gY)(o);else{l=ct.clickToRetry;const e=o.clientPrompt.name;a="string"==typeof e?e:i.formatMessage(e)}else"followup"===o.type?a=ut(i,o.improvement):(0,h.t1)(o);return s.createElement(s.Fragment,null,r()("div",{},void 0,a),r()("div",{style:n.hint},void 0,i.formatMessage(l)))}function mt(e){return()=>r()(b.lA,{svg:e,svgFill:Qe.FN.light.purple[400]})}function ft(e,t){if("disabled"===t.type)return;const n=st(e);if(!n)return;const{currentUserSettingsStore:o}=X.default.state;if(!o)return;const i=(0,nt.BG)({clientPrompt:n.clientPrompt,additionalContext:n.additionalContext,promptTitle:n.promptTitle});return i&&!(0,ee.Gl)(o,i)?{currentInitialRevision:n,recentAction:i,favoriteEditingState:t,currentUserSettingsStore:o}:void 0}function gt(e){window.__c={n:"MenuPopupContent"};const{sections:t,onCloseParentMenu:n,context:o,menuListStore:i}=e,a=(0,s.useCallback)((e=>{e.closeParentMenu&&n()}),[n]),l=(0,u.O7)(),c=(0,p.VK)((()=>l.device.isPhone),[l]);return r()(q.Z,{menuType:c?Q.og.ActionSheet:Q.og.Popup,width:"100%",maxHeight:c?"min(17vh, 160px)":"min(40vh, 320px)",maxWidth:"100%"},void 0,r()(z.Z,{menuListStore:i,sections:t,onAccept:a,initialFocus:0,context:o}))}var vt=n(51454),yt=n(69454),ht=n(77794),wt=n(21199),bt=n(45010),kt=n(68216);function St(e){window.__c={n:"PopupPositioner"};const{scrollerStore:t,openState:n,children:o}=e,[a,l]=(0,s.useState)(Date.now()),c=(0,s.useCallback)((()=>l(Date.now())),[]),d=(0,s.useRef)(null),[u,f]=(0,s.useState)(void 0),[g,v]=(0,s.useState)(void 0),y=(0,p.VK)((()=>{const e=(0,oe.$b)(n);if(!e)return;const o=(0,P.wA)(e);if(!o)return;const{origin:i}=e;"results"!==n.stage&&o&&i instanceof kt.G&&("spacebar"===n.from||i.isEmptyEditableBlock())&&(o.height=0);const a=t.state,r=a.clientRect??new DOMRect,s=a.scrollTop;return function(e){const{openState:t,originRect:n,scrollerRect:o,scrollerScrollTop:i,popupRect:a}=e,r=(null==a?void 0:a.height)??0,s=(null==a?void 0:a.width)??0,l=Math.min(Math.max(n.width,500),730);let c;const d=n.bottom-o.top+i+Mt;n.bottom+r+Mt+It>o.bottom&&(c=d-(o.height-r-It+i));let u;s+xt+Pt>o.width?u=xt:n.left+s>o.right?u=o.width-s-Pt:(u=n.left-o.left,"initialPromptForAIBlock"===t.stage&&(u-=s-n.width));return{top:d,left:u,width:l,scrollTopIntoView:c}}({openState:n,originRect:o,scrollerRect:r,scrollerScrollTop:s,popupRect:u})}),[t,u,n]);(0,s.useEffect)((()=>{y&&v(y)}),[y]);const h=y??g;(0,s.useEffect)((()=>{if(Date.now()-a>500)return;const e=null==h?void 0:h.scrollTopIntoView;if(!e)return;const n=Et(t);n&&Ct(e,n)}),[null==h?void 0:h.scrollTopIntoView,t,a]);const w=(0,m.yK)((e=>({wrap:{position:"absolute",left:null==h?void 0:h.left,top:null==h?void 0:h.top,width:null==h?void 0:h.width,zIndex:vt.lB}})),[h]);(0,s.useEffect)((()=>{const e=new ht.E;if(!d.current)throw new Error("ref.current is null");return e.observe(d.current),e.rect.addListener((e=>{f(e.state)})),()=>{e.destroy()}}),[]);const b="results"===n.stage&&!n.loading;(0,s.useEffect)((()=>{b&&c()}),[b,c]);const k="results"===n.stage&&n.loading,S=(0,oe.jq)({resetWhenScrolledToBottom:!1,areWeLoading:k,scrollerStore:t}),C="results"===n.stage&&"cursor"===n.context.type,[M,I]=(0,s.useState)(!1);return(0,s.useEffect)((()=>{!k||!C&&M||(S?Ct.cancel():null!=h&&h.scrollTopIntoView&&(c(),I(!0)))}),[S,M,C,k,h,c]),r()(wt.Z,{capture:!0,render:e=>r()(ge.Z,{capture:!0,allowMenuList:!0,allowEsc:!0},void 0,s.createElement("div",i()({style:w.wrap,ref:d},e),h&&o))})}const Ct=Te().debounce(((e,t)=>{t.scrollByOffset(e,0,{animate:!0}),bt.Z.MenuScroller&&bt.Z.MenuScroller.scrollToTop()}),60),Mt=4,It=6,xt=6,Pt=16;function Et(e){var t,n;return e===(null===(t=bt.Z.PageScroller)||void 0===t?void 0:t.stores.store)?bt.Z.PageScroller:e===(null===(n=bt.Z.PeekViewScroller)||void 0===n?void 0:n.stores.store)?bt.Z.PeekViewScroller:void 0}function _t(e){window.__c={n:"MobilePopupPositioner"};const{children:t,scrollerStore:n,openState:o}=e,[i,a]=(0,s.useState)(Date.now()),r=(0,s.useRef)(null),[l,c]=(0,s.useState)(void 0),d=(0,s.useCallback)((()=>a(Date.now())),[]),{WindowSizeStore:m}=(0,u.O7)();(0,s.useEffect)((()=>{const e=new ht.E,t=r.current;if(!t)throw new Error("ref.current is null");e.observe(t);let n=t.getBoundingClientRect().top;e.rect.addListener((e=>{n=e.state.top,c(e.state)}));const o=setInterval((()=>{const o=t.getBoundingClientRect().top;o!==n&&(n=o,e.recompute())}),50);return()=>{e.destroy(),clearInterval(o)}}),[]);const f="results"===o.stage&&!o.loading,v=("results"===o.stage||"initialPrompt"===o.stage)&&"cursor"===o.context.type,y=(0,p.VK)((()=>{const e=(0,oe.$b)(o);if(!e)return;const t=(0,P.wA)(e);if(!t)return;if(!l)return;const n=t.bottom-l.top;return n>0?n:void 0}),[o,l]);(0,s.useEffect)((()=>{if(Date.now()-i>500)return;if(!y)return;const e=Et(n);e&&Ct(y,e)}),[y,n,i]),(0,s.useEffect)((()=>{f&&v&&d()}),[f,v,d]);const h="results"===o.stage&&o.loading,w=(0,g.D9)(h),[b,k]=(0,s.useState)();(0,s.useEffect)((()=>{w&&!h&&k(Date.now())}),[h,w]),(0,s.useEffect)((()=>{const e=!!b&&Date.now()-b<1e3;(h||e)&&v&&y&&d()}),[v,h,d,y,b]);const S=(0,p.VK)((()=>{const e=yt.Z.state.phase===yt.i.hidden||yt.Z.state.phase===yt.i.willHide,t=yt.Z.estimatedNativeWebBottomOverlap()+It;return e?m.getSafePaddingBottomPx(t):t}),[m]);return s.createElement("div",{ref:r,style:{position:"absolute",bottom:S,left:xt,right:xt,zIndex:vt.Mo}},t)}const At="notion-alternate-ai-ui";function Zt(e){window.__c={n:"CompletionPopup"};const{scrollerStore:t}=e,n=(0,u.O7)(),o=(0,p.VK)((()=>_.default.state),[]);(0,Z.w9)(o);const i=(0,s.useMemo)((()=>(0,oe.RR)(o)),[o]),a=(0,p.VK)((()=>i&&(0,oe.$b)(i)),[i]),l=(0,p.VK)((()=>n.device.isPhone),[n]);return i?t!==(null==a?void 0:a.scrollerStore)?null:r()(l?_t:St,{scrollerStore:t,openState:i},void 0,r()(Tt,{openState:i})):null}function Tt(e){window.__c={n:"PopupContent"};const{openState:t}=e,n=(0,u.O7)(),o=(0,w.useIntl)(),a=(0,s.useState)(function(e){switch(e.stage){case"results":return"";case"initialPromptForAIBlock":return e.prompt??e.prefilledValue;case"initialPrompt":return e.prefilledValue}}(t))[0],[F,B]=function(e){const t=(0,w.useIntl)(),[n,o]=(0,s.useState)("");return[(0,p.VK)((()=>{if("initialPromptForAIBlock"!==e.stage||!(0,P.dU)())return n;const o=e.store.getTitleValue();return(0,y.Xh)({intl:t,textValue:o,getRecordModel:e.store.getRecordModel,userTimeZone:(0,f.r)()})}),[n,t,e]),o]}(t),[R,N]=(0,s.useState)(!1),[D,O]=(0,s.useState)(!1),[H,U]=(0,s.useState)(""),W=(0,K.mY)(),z=(0,s.useRef)(null),$=(0,oe.rR)(t),J=(0,s.useMemo)((()=>({environment:n,blocks:[],publicEditMode:void 0})),[n]);(0,Z.lZ)(t);const q=(0,s.useCallback)((e=>{k.ovL(n,{session_id:t.sessionId,type:e.analyticsName,gtm_favorite_id:e.gtmFavoriteId}),B(e.insertText),C.so(n,e.insertText),e.executeImmediately&&N(!0),z.current&&z.current.focusInput()}),[t.sessionId,n,B]),G="results"===t.stage?(0,P.xM)(t).completion:void 0,j=(0,g.Z_)(G,C.Z1,v.Z),Y="results"===t.stage?t:void 0,Q=(0,s.useMemo)((()=>{if(!Y||"textSelection"!==Y.context.type&&"blockSelection"!==Y.context.type)return;const{userSearchCache:e}=(0,P.xM)(Y);return j?l.Z.withListenerIgnored((()=>{const t=new c.Z({name:"CompletionPopup.PopupContent",isTemporaryData:!0}),o=M.createAndCommit({userAction:"CompletionPopup.temporarymarkdownToBlocks",environment:n,canUndo:!1,perform:o=>{const i=S.Mt({environment:n,text:j,inMemoryRecordCache:t,transaction:o,markdownOptions:(0,E.N9)(e)});if(i)return C.Q(n,i),S.Lh({environment:n,stores:i,inMemoryRecordCache:t,transaction:o})}}).performResult;return t.addCacheFallback(n.defaultRecordCache.inMemoryRecordCache),o})):void 0}),[Y,j,n]),X=(0,p.VK)((()=>{if(!Q||!Y||"completionPopup"!==Y.type||"results"!==Y.stage||"textSelection"!==Y.context.type&&"blockSelection"!==Y.context.type)return;return Y.context.stores.every((e=>{const t=e.getType();return!!t&&("blockSelection"===Y.context.type?Boolean(P.d5[t]):"textSelection"===Y.context.type&&Boolean(P.DD[t]))}))}),[Y,Q]);let ee=!0,te=!1;switch(t.stage){case"initialPrompt":if(t.futureRevisions.length>0)break;case"initialPromptForAIBlock":ee=!1;break;case"results":t.loading||"cursor"!==t.context.type||""!==F||(te=!0);break;default:(0,h.t1)(t)}const re=function(e){const{environment:t,sessionId:n}=e,o=(0,s.useCallback)((e=>{let{exitType:o,selectInsertion:i}=e;const a=_.default.state;"completionPopup"!==a.type||"results"!==a.stage||a.loading||(k.HCf(t,{session_id:n,inference_id:(0,P.xM)(a).inferenceId,exit_type:o}),M.createAndCommit({userAction:"CompletionPopup.handleAccept",environment:t,perform:e=>{C.y3({environment:t,transaction:e,selectInsertion:i,exitType:o})}}))}),[t,n]),i=(0,s.useCallback)((()=>{const e=_.default.state;"completionPopup"!==e.type||"results"!==e.stage||e.loading||((0,oe.Tq)(t),k.HCf(t,{session_id:n,inference_id:(0,P.xM)(e).inferenceId,exit_type:"insert"}),"textSelection"===e.context.type?M.createAndCommit({userAction:"CompletionPopup.handleInsert",environment:t,perform:e=>{C.QS({environment:t,transaction:e})}}):"blockSelection"===e.context.type&&M.createAndCommit({userAction:"CompletionPopup.handleInsert",environment:t,perform:e=>{C.Jt({environment:t,transaction:e,replace:!1})}}))}),[t,n]),a=(0,s.useCallback)((()=>{const e=_.default.state;"completionPopup"!==e.type||"results"!==e.stage||e.loading||"textSelection"!==e.context.type&&"blockSelection"!==e.context.type||((0,oe.Tq)(t),k.HCf(t,{session_id:n,inference_id:(0,P.xM)(e).inferenceId,exit_type:"replace"}),"textSelection"===e.context.type?M.createAndCommit({userAction:"CompletionPopup.handleReplace",environment:t,perform:e=>{C.w_({environment:t,transaction:e})}}):"blockSelection"===e.context.type&&M.createAndCommit({userAction:"CompletionPopup.handleReplace",environment:t,perform:e=>{C.Jt({environment:t,transaction:e,replace:!0})}}))}),[t,n]);return(0,s.useMemo)((()=>({onAccept:o,onInsert:i,onReplace:a})),[o,i,a])}({environment:n,sessionId:t.sessionId});(0,s.useEffect)((()=>{B(a),z.current&&z.current.focusInput()}),[a,B]);const se="results"===t.stage&&t.hasErrored,le=(0,g.D9)(se),ue=se&&!le,pe=(0,s.useCallback)((e=>{const{purgeFromHistory:t}=e,i=C.me({environment:n,purgeFromHistory:t});i&&"followup"===i.type&&(B(ut(o,i.improvement)),z.current&&z.current.focusInput())}),[n,o,B]),me=(0,s.useCallback)((()=>{"results"===t.stage&&(C.me({environment:n,purgeFromHistory:!1}),z.current&&z.current.focusInput())}),[t,n]),fe=(0,s.useCallback)((()=>{"results"===t.stage&&(C.p_(n),z.current&&z.current.focusInput())}),[n,t]);(0,s.useEffect)((()=>{if(!ue||"results"!==t.stage)return;const{sessionId:e}=t;if((0,P.sr)(t))return void pe({purgeFromHistory:!0});const o=(0,P.Iz)(t);C.mN(o)?(B(H),(0,L.jn)({environment:n})):C.oy({environment:n,sessionId:e,inferenceId:o.inferenceId,exitType:"error_modal"})}),[n,ue,t,H,pe,B]);const ge=(0,s.useCallback)((()=>{if("results"!==t.stage)return;const{sessionId:e}=t,o=(0,P.xM)(t);if((0,P.sr)(t))return k.XwB(n,{session_id:e,inference_id:o.inferenceId,is_reverting_follow_up_improvement:!0}),void pe({purgeFromHistory:!1});k.XwB(n,{session_id:e,inference_id:o.inferenceId,is_reverting_follow_up_improvement:!1});const i=(0,P.Iz)(t);C.mN(i)?(B((0,P.gY)(i)),(0,L.jn)({environment:n})):C.Wv({environment:n})}),[n,t,pe,B]),ve=(0,s.useCallback)((()=>{if("results"!==t.stage)return;if(!(0,P.xM)(t).completion)return(0,P.sr)(t)?void pe({purgeFromHistory:!0}):(B(H),void(0,L.jn)({environment:n}));C.jN(n)}),[t,n,pe,H,B]),ye=(0,s.useCallback)((()=>{O(!1),d.default.afterNextFlush((()=>{z.current&&z.current.focusInput()}))}),[]),he=(0,s.useCallback)((()=>{switch(t.stage){case"initialPromptForAIBlock":k.HCf(n,{session_id:t.sessionId,inference_id:void 0,exit_type:"accept"}),(0,L.fz)();break;case"initialPrompt":B(""),(0,L.sj)();break;case"results":break;default:(0,h.t1)(t)}}),[t,n,B]),we=(0,s.useCallback)((e=>{switch((0,oe.Tq)(n),O(!1),t.stage){case"initialPrompt":case"initialPromptForAIBlock":k.HCf(n,{session_id:t.sessionId,inference_id:void 0,exit_type:e}),(0,L.fz)();break;case"results":C.oy({environment:n,sessionId:t.sessionId,inferenceId:(0,P.xM)(t).inferenceId,exitType:e});break;default:(0,h.t1)(t)}}),[t,n]),be=(0,s.useCallback)((()=>we("cancel")),[we]),ke=(0,s.useCallback)((()=>{"active"!==W.type?te?re.onAccept({exitType:"click_outside_window_accept",selectInsertion:!0}):ee?O(!0):we("click_outside_window_cancel"):(0,K.bi)({state:W})}),[W,te,re,we,ee]),Se=(0,p.VK)((()=>(0,P.dU)()),[]);(0,s.useEffect)((()=>{function e(e){return!!(e instanceof Element&&(e.closest(`.${At}`)||e.closest(`.${x.YPt}`)||e.closest(`.${x.p4m}`)||e.closest(`.${x.zov}`)))}function t(t){Se||!e(t.target)&&e(t.relatedTarget)&&t.relatedTarget instanceof HTMLElement&&t.relatedTarget.focus()}function n(t){e(t.target)||("click"!==t.type&&"contextmenu"!==t.type||ke(),Se||(t.preventDefault(),t.stopPropagation()))}if(!D)return window.addEventListener("focus",t,!0),window.addEventListener("click",n,!0),window.addEventListener("contextmenu",n,!0),window.addEventListener("mousedown",n,!0),window.addEventListener("mouseup",n,!0),window.addEventListener("mouseover",n,!0),window.addEventListener("mouseout",n,!0),window.addEventListener("mouseenter",n,!0),window.addEventListener("mouseleave",n,!0),window.addEventListener("mousemove",n,!0),()=>{window.removeEventListener("focus",t,!0),window.removeEventListener("click",n,!0),window.removeEventListener("contextmenu",n,!0),window.removeEventListener("mousedown",n,!0),window.removeEventListener("mouseup",n,!0),window.removeEventListener("mouseover",n,!0),window.removeEventListener("mouseout",n,!0),window.removeEventListener("mouseenter",n,!0),window.removeEventListener("mouseleave",n,!0),window.removeEventListener("mousemove",n,!0)}}),[ke,D,Se]);const Ce=(0,s.useCallback)((e=>{U(F),B(""),C.Vk(n,e)}),[n,F,B]),Me=(0,s.useCallback)((()=>{switch(t.stage){case"initialPrompt":(0,L.sj)(),U(F),B(""),(0,b.Hh)({environment:n,inputValue:F,from:t.from,mode:$});break;case"initialPromptForAIBlock":k.HCf(n,{session_id:t.sessionId,inference_id:void 0,exit_type:"accept"}),(0,L.fz)(),U(F),B(""),(0,b.F0)({environment:n,inputValue:F,store:t.store});break;case"results":Ce({type:"helpMeEdit",prompt:F});break;default:(0,h.t1)(t)}}),[F,$,t,n,Ce,B]);(0,s.useEffect)((()=>{R&&(N(!1),Me())}),[R,Me]);let Ie="insert";"results"===t.stage&&"cursor"===t.context.type?Ie="accept":X&&(Ie="replace");const xe=(0,p.VK)((()=>t?dt({environment:n,intl:o,filter:F,state:t,from:t.from,favoriteEditingState:W,onUpdatePromptState:q,onImprove:Ce,context:J,completionResultInfo:{...re,onRetry:ge,onSubmit:Me,onCancel:be,defaultAction:Ie}}):[]),[W,J,n,q,Me,Ce,F,o,t,re,ge,be,Ie]),Pe=xe.length>0,Ee=(0,s.useMemo)((()=>new A.Z),[]);(0,s.useEffect)((()=>{Ee.setState({focus:{section:0,indexLocal:0,indexGlobal:0}})}),[F,Ee]);const _e=(0,p.VK)((()=>n.device.isPhone),[n]),Ae=(0,m.yK)((e=>({mainPopup:{borderRadius:6,background:e.popoverBackground,boxShadow:e.mediumBoxShadow,overflow:"hidden",isolation:"isolate"},menuPopup:{marginTop:4,marginBottom:4,borderRadius:6,background:e.popoverBackground,boxShadow:e.mediumBoxShadow,width:_e?"100%":320,overflow:"hidden",isolation:"isolate"}})),[_e]),Ze=(0,s.useRef)(null);let Te;"active"===W.type?Te=s.createElement("div",{style:Ae.menuPopup,ref:Ze,className:At},r()(ne,{sessionId:t.sessionId,state:W,context:J})):Pe&&(Te=s.createElement(s.Fragment,null,s.createElement("div",{style:Ae.menuPopup,ref:Ze,className:At},r()(gt,{sections:xe,onCloseParentMenu:he,context:J,menuListStore:Ee})),r()(T.gl,{originRef:Ze,openState:t,isInputEmpty:!F})));const Le=(0,s.useRef)(null),Fe=function(e){const{openState:t,undoRevision:n,redoRevision:o}=e,i=(0,u.O7)(),a=(0,w.useIntl)(),r=(0,p.VK)((()=>ie.default.checkGate("ai_multi_level_undo")),[]),l=(0,s.useCallback)((()=>{n(),de(i,"undo")}),[i,n]),c=(0,s.useCallback)((()=>{o(),de(i,"redo")}),[i,o]);if("results"!==t.stage||!r)return ce;const d=t.revisions.length,m=t.futureRevisions.length,f=d+m,g=d;return 1===f?ce:{onUndo:d>1?l:void 0,onRedo:m>0?c:void 0,historyLabel:a.formatMessage(ae.historyLabel,{currentRevision:g.toString(),totalRevisions:f.toString()})}}({openState:t,undoRevision:me,redoRevision:fe});return Se?s.createElement(s.Fragment,null,r()(I.Z,{capture:!0,onEsc:ke}),Te):s.createElement(s.Fragment,null,r()(I.Z,{capture:!0,onEsc:ke}),_e&&Te,r()(T.RD,{originRef:Le,openState:t}),s.createElement("div",{ref:Le,className:At,style:Ae.mainPopup},s.createElement(je,i()({state:t,onDismiss:ke,onCompletionRetry:ge,onCompletionStop:ve,query:F,setQuery:B,onSubmit:Me,submitOnEnter:!Pe&&!D,inputRef:z,temporaryListStore:Q,favoriteEditingState:W},Fe))),!_e&&Te,r()(V,{open:D,onConfirmExit:be,onCancelExit:ye}))}},45145:(e,t,n)=>{n.d(t,{d:()=>Z});var o=n(10434),i=n.n(o),a=n(23174),r=n.n(a),s=n(67294),l=n(480),c=n(5366),d=n(73063),u=n(44532),p=n(58032),m=n(935),f=n(24405),g=n(53397),v=n(82990),y=n(42922),h=n(64921),w=n(12508),b=n(1743),k=n(74194),S=n(16354),C=n(64369),M=n(42402),I=n(43250),x=n(33665);function P(e){const{checked:t,onChange:n}=e;return r()("div",{style:{display:"flex",gap:6,alignItems:"center"}},void 0,r()(w.Z,{checked:t,onClick:n,size:14}),r()("div",{onClick:n},void 0,r()(C.Z,{style:{cursor:"pointer"},isSmall:!0},void 0,r()(c.FormattedMessage,{defaultMessage:"Share this AI session with Notion",id:"completions.FeedbackPopup.shareWithNotion"}))))}function E(){window.__c={n:"OptInLearnMore"};const e=(0,f.yK)((e=>({container:{display:"flex",flexDirection:"row"},giftIcon:{width:16,height:16,fill:e.lightIconColor},message:{marginLeft:9,color:e.mediumTextColor,fontSize:12}})),[]);return r()("div",{style:e.container},void 0,g.Z.giftOutline(e.giftIcon),r()("div",{style:e.message},void 0,r()(c.FormattedMessage,{defaultMessage:"You’re sharing data with Notion for AI quality improvement. <aiTerms>Learn more</aiTerms>",id:"completions.OptInLearnMore.description",values:{aiTerms:e=>r()(M.Z,{external:!0,href:(0,x.UY)("ai.dataSharingTerms")},void 0,e)}})))}function _(e){window.__c={n:"ShareDataPopup"};const{onSubmit:t}=e,n=(0,f.yK)((e=>({container:{width:300,display:"flex",flexDirection:"column",alignItems:"center",padding:19,position:"relative"},closeButtonContainer:{position:"absolute",top:10,right:10},closeButton:{zIndex:10,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"100%",background:e.buttonHoveredBackground,width:20,height:20,padding:4},closeButtonHover:{background:e.buttonPressedBackground},closeButtonIcon:{width:16,fill:e.mediumTextColor},giftIcon:{width:24,height:24,fill:e.lightIconColor},terms:{color:e.mediumTextColor,textAlign:"center",fontSize:13},shareButton:{width:"100%",marginTop:17,paddingTop:7,paddingBottom:7},notNowButton:{color:e.mediumTextColor,fontSize:14,marginTop:15},title:{textAlign:"center",marginTop:9,marginBottom:8,fontWeight:v.Z.fontWeight.semibold}})),[]);return r()("div",{style:n.container},void 0,r()("div",{style:n.closeButtonContainer},void 0,r()(h.Z,{onClick:()=>{t({optIn:!1})},style:n.closeButton,hoveredStyle:n.closeButtonHover},void 0,g.Z.closeSmall(n.closeButtonIcon))),g.Z.giftOutline(n.giftIcon),r()("div",{style:n.title},void 0,r()(c.FormattedMessage,{defaultMessage:"Always share data to improve Notion AI?",id:"completions.ShareDataPopup.title"})),r()("div",{style:n.terms},void 0,r()(c.FormattedMessage,{defaultMessage:"Help Notion improve AI quality by automatically sharing data from your usage of AI powered features.{br}By continuing, you agree to <aiTerms>AI Data Sharing Terms</aiTerms>",id:"completions.ShareDataPopup.description",values:{br:r()("br",{}),aiTerms:e=>r()(M.Z,{external:!0,href:(0,x.UY)("ai.dataSharingTerms")},void 0,e)}})),r()(y.Z,{style:n.shareButton,onClick:()=>{t({optIn:!0})}},void 0,r()(c.FormattedMessage,{defaultMessage:"Always share",id:"completions.ShareDataPopup.alwaysShareButton"})),r()(S.Z,{style:n.notNowButton,onClick:()=>{t({optIn:!1})}},void 0,r()(c.FormattedMessage,{defaultMessage:"Not now",id:"completions.ShareDataPopup.notNowButton"})))}function A(e){window.__c={n:"FeedbackPopup"};const{state:t,onUpdate:n,onSubmit:o,onCancel:i,userOptIn:a}=e,u=(0,s.useCallback)((()=>{n({...t,shareWithNotion:!t.shareWithNotion})}),[t,n]),p=(0,s.useCallback)((()=>{o(t)}),[o,t]),m=(0,s.useCallback)((e=>{n({...t,userContent:e.target.value})}),[n,t]),f=(0,c.useIntl)(),v=(0,l.O7)(),y=!a;return r()("div",{style:{padding:14,...v.device.isMobile?{width:"100%"}:{minWidth:400}},className:I.YOJ},void 0,r()(b.Z,{capture:!0},void 0,r()(k.Z,{value:t.userContent,onChange:m,onSubmit:e=>{e.stopPropagation(),p()},onCancel:i,focusInitial:!0,placeholder:f.formatMessage({id:"completions.FeedbackPopup.userCommentPlaceholder",defaultMessage:"How could the output be improved? (optional)"})}),r()("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingTop:10}},void 0,y?r()(P,{checked:t.shareWithNotion,onChange:u}):r()(E,{}),r()(d.Z,{icon:g.Z.sendArrow,onClick:p,ariaLabel:f.formatMessage({id:"completions.FeedbackPopup.submitButtonLabel",defaultMessage:"Submit feedback"}),isBlue:!0,iconStyle:{height:24,width:24},style:{height:20,width:20}}))))}function Z(e){window.__c={n:"FeedbackButtonWithPopup"};const{type:t,ariaLabel:n,onClick:o,feedbackState:a,onDismiss:f,onSubmit:g,onUpdate:v,showShareDataPopup:y,onDataShareSubmit:h,userOptIn:w,iconButtonStyles:b}=e,k=(0,l.O7)(),S=t===(null==a?void 0:a.type),C=(0,m.L)(t,S),M=(0,s.useCallback)((()=>o(t)),[o,t]),I=r()(p.Z,{renderTooltip:()=>r()("div",{},void 0,r()(c.FormattedMessage,{defaultMessage:"Share feedback with Notion",id:"completions.CompletionMenuActionBar.feedbackTooltip"})),placement:p.Z.Placement.Bottom,render:e=>s.createElement(d.Z,i()({onClick:M,icon:C,ariaLabel:n,style:{...b}},e))});return r()(u.ZP,{origin:I,open:(null==a?void 0:a.type)===t,popupType:k.device.isMobile?u.kQ.SlideUp:u.kQ.Popup,onDismiss:f,render:()=>a?y?r()(_,{onCancel:f,onSubmit:h}):r()(A,{state:a,onSubmit:g,onUpdate:v,onCancel:f,userOptIn:w}):null})}},935:(e,t,n)=>{n.d(t,{L:()=>w,u:()=>b});var o=n(23174),i=n.n(o),a=n(67294),r=n(480),s=n(81954),l=n(53397),c=n(5366),d=n(50906),u=n(73928),p=n(64964),m=n(12359),f=n(37181),g=n(8323),v=n(79315),y=n(10161),h=n(45145);function w(e,t){switch(e){case"thumbsup":return t?l.Z.thumbUpFilled:l.Z.thumbUp;case"thumbsdown":return t?l.Z.thumbDownFilled:l.Z.thumbDown}}function b(e){window.__c={n:"FeedbackButtons"};const{revision:t}=e,n=(0,c.useIntl)(),o=(0,r.O7)(),[l,w]=(0,a.useState)(void 0),[b,k]=(0,a.useState)(!1),S=(0,a.useRef)(null),C=(0,s.VK)((()=>y.default.checkGate("ai_data_sharing")),[]),M=(0,s.VK)((()=>v.default.state.currentUserSettingsStore),[]),I=(0,s.VK)((()=>{var e;const t=null==M||null===(e=M.getSettings())||void 0===e?void 0:e.seen_ai_data_share_prompt_at,n=!(0,g.mq)();return!Boolean(t)&&n}),[M]),x=(0,s.VK)((()=>{var e;return(null==M||null===(e=M.getSettings())||void 0===e?void 0:e.ai_data_share_opt_in)??false}),[M]),P=(0,a.useCallback)((()=>{p.oV({label:n.formatMessage({id:"completions.CompletionMenuFooter.showFeedbackThanksMessage",defaultMessage:"Thanks for submitting feedback!"})})}),[n]),E=(0,a.useCallback)((e=>{S.current=document.activeElement,w((t=>({userContent:"",shareWithNotion:true,...t,type:e})))}),[]),_=(0,a.useCallback)((e=>{e.shareWithNotion&&I&&C?k(!0):(P(),w(void 0)),u.bl({...e,environment:o,revision:t,userOptIn:x})}),[t,o,x,I,C,P]),A=(0,a.useCallback)((e=>{e&&e.stopPropagation&&e.stopPropagation(),w(void 0),S.current&&S.current instanceof HTMLElement&&S.current.focus()}),[]),Z=(0,a.useCallback)((e=>{const{optIn:t}=e;M&&(m.createAndCommit({userAction:"FeedbackButtons.aiDataShareOptIn",environment:o,userId:M.id,perform:e=>{f.d2({userSettingsStore:M,data:{ai_data_share_opt_in:t,seen_ai_data_share_prompt_at:Date.now()},transaction:e})}}),d.bd0(o,{user_opt_in:t}),t?p.oV({label:n.formatMessage({id:"completions.CompletionMenuFooter.dataShareThanks",defaultMessage:"Thank you for your help making Notion better!"})}):P(),k(!1),w(void 0))}),[n,M,o,P]);return t.hasFeedback&&!b?null:a.createElement(a.Fragment,null,i()(h.d,{type:"thumbsup",ariaLabel:n.formatMessage({id:"completions.CompletionMenuFooter.thumbsUp",defaultMessage:"Submit positive feedback"}),onClick:E,feedbackState:l,onDismiss:A,onSubmit:_,onUpdate:w,showShareDataPopup:b,onDataShareSubmit:Z,userOptIn:x}),i()(h.d,{type:"thumbsdown",ariaLabel:n.formatMessage({id:"completions.CompletionMenuFooter.thumbsDown",defaultMessage:"Submit negative feedback"}),onClick:E,feedbackState:l,onDismiss:A,onSubmit:_,onUpdate:w,showShareDataPopup:b,onDataShareSubmit:Z,userOptIn:x}))}},91839:(e,t,n)=>{n.d(t,{Z:()=>r});var o=n(23174),i=n.n(o),a=(n(67294),n(5366));const r=function(e){let{style:t}=e;window.__c={n:"LoadingDots"};const n=(0,a.useIntl)();return i()("div",{"aria-valuetext":n.formatMessage({id:"loadingDots.label",defaultMessage:"Loading..."}),role:"progressbar",className:"loading-dots"},void 0,i()("div",{className:"loading-dot",style:{...t}}),i()("div",{className:"loading-dot",style:{...t}}),i()("div",{className:"loading-dot",style:{...t}}))}}}]);